require(["jquery","jquery-ui","jquery-ui-iPad","js/jquery.WebGME","bootstrap","bootstrap-notify","underscore","backbone","js/WebGME","js/util","text!/gmeConfig.json","text!/package.json","js/logger","superagent","q","ravenjs","angular","angular-ui-bootstrap","isis-ui-components","isis-ui-components-templates"],function(t,e,n,i,o,r,s,a,l,c,d,h,p,g,u,f){"use strict";function m(t){function e(t){return t.charAt(0).toUpperCase()+t.slice(1)}function n(t){var n=u.defer();return D.debug("requestExtensionPoint",t),g.get("/api/"+t).end(function(i,o){var r="all"+e(t);200===o.status?(WebGMEGlobal[r]=o.body,D.debug("/api/"+t,WebGMEGlobal[r]),n.resolve()):(D.error("/api/"+t+"failed"),WebGMEGlobal[r]=[],n.reject(i))}),n.promise}function i(){var t=u.defer();return g.get("/api/plugins/metadata").end(function(e,n){200===n.status?(WebGMEGlobal.allPlugins=Object.keys(n.body),WebGMEGlobal.allPluginsMetadata=n.body,t.resolve()):(D.error("/api/"+name+"failed"),WebGMEGlobal.allPlugins=[],WebGMEGlobal.allPluginsMetadata={},t.reject(e))}),t.promise}return u.all([n("visualizers"),i(),n("decorators"),n("seeds"),n("addOns")]).nodeify(t)}function _(t){function e(t,e){var i=u.defer();return g.get("/api/orgs/"+e).end(function(e,o){200===o.status?o.body.admins.indexOf(t)>-1&&n.adminOrgs.push(o.body):D.error("failed getting org info",e),i.resolve()}),i.promise}var n,i=u.defer();return g.get("/api/user").end(function(t,o){200===o.status?(n=o.body||{_id:"N/A",orgs:[]},n.adminOrgs=[],u.allSettled(n.orgs.map(function(t){return e(n._id,t)})).then(function(){WebGMEGlobal.userInfo=n,i.resolve(n)})["catch"](i.reject)):i.reject(t)}),i.promise.nodeify(t)}function b(t){var e=u.defer();return g.get("/api/componentSettings").end(function(t,n){200===n.status?WebGMEGlobal.componentSettings=n.body:(D.warn("Could not obtain any default component settings (./config/components.json"),WebGMEGlobal.componentSettings={}),e.resolve()}),e.promise.nodeify(t)}function y(t){var e=u.defer();return C.visualization.extraCss.length>0?require(C.visualization.extraCss.map(function(t){return"css!"+t}),e.resolve,e.reject):e.resolve(),e.promise.nodeify(t)}var v,C=JSON.parse(d),E=JSON.parse(h),D=p.create("gme:main",C.client.log),I=u.defer(),P={release:E.version};C.client.errorReporting.enable===!0&&f.config(C.client.errorReporting.DSN,C.client.errorReporting.ravenOptions||P).install(),WebGMEGlobal.gmeConfig=C,WebGMEGlobal.version=E.version,WebGMEGlobal.NpmVersion=E.dist?E.version:"",WebGMEGlobal.GitHubVersion="",E._from&&(v=E._from.split("/"),WebGMEGlobal.GitHubVersion=v[v.length-1]),$(function(){var e,n,i,o;for(C.debug&&(DEBUG=C.debug),D.debug("domReady, got gmeConfig"),e=c.getURLParameterByName("debug").toLowerCase(),"true"===e?DEBUG=!0:"false"===e&&(DEBUG=!1),n=Object.keys(C.requirejsPaths),i=0;i<n.length;i+=1)C.requirejsPaths[n[i]]="/extlib/"+C.requirejsPaths[n[i]],D.debug("Requirejs path resolved: ",n[i],C.requirejsPaths[n[i]]);require.config({paths:C.requirejsPaths}),t.fn.extend({disable:function(t){return this.each(function(){var e=$(this);e.is("input, button")?this.disabled=t:e.toggleClass("disabled",t)})}}),o=angular.module("gmeApp",["ui.bootstrap","isis.ui.components","gme.ui.headerPanel"]).config(["$locationProvider",function(t){t.html5Mode({enabled:!0,requireBase:!1})}]),I.resolve(o)}),u.all([I.promise,y(),m(),_(),b()]).then(function(t){var e=t[0];l.start(function(t){e.value("gmeClient",t),angular.bootstrap(document,["gmeApp"])})})["catch"](function(t){throw D.error("Error at start up",t),t})}),define("js/jquery.WebGME",["jquery"],function(){"use strict";$.fn.extend({editOnDblClick:function(t){this.each(function(){$(this).on("dblclick.editOnDblClick",null,function(e){$(this).editInPlace(t),e.stopPropagation(),e.preventDefault()})})}}),$.fn.extend({editInPlace:function(t){function e(e){var c,d,h,p,g=e.width(),u=e.height();if(e.data("already-editing")===!0)return void e.find("input").select().focus();for(e.data("already-editing",!0),c=e.text(),t&&t.value&&(c=t.value),d=$("<input/>",{type:"text",value:c}),n&&""!==n&&d.addClass(n),h=Object.keys(i),p=h.length-1;p>=0;p--)d.css(h[p],i[h[p]]);u=Math.max(u,a),d.outerWidth(g).outerHeight(u),d.css({"box-sizing":"border-box",margin:"0px","line-height":u+"px","font-size":u-l}),e.html(d),d.focus(),d.keydown(function(t){switch(t.which){case 27:d.val(c),t.preventDefault(),t.stopPropagation(),$(this).blur();break;case 13:t.preventDefault(),t.stopPropagation(),$(this).blur();break;case 46:t.stopPropagation()}}).blur(function(){var t=d.val();""===t&&s===!1&&(t=c),e.html("").text(t),e.removeData("already-editing"),t!==c&&o&&o.call(e,c,t),r&&r.call(e)})}var n=t&&t["class"]||null,i=t&&t.css||{},o=t&&t.onChange||null,r=t&&t.onFinish||null,s=t&&t.enableEmpty||!1,a=16,l=5;this.each(function(){e($(this))})}}),document.createElement("canvas").getContext&&$.extend(window.CanvasRenderingContext2D.prototype,{ellipse:function(t,e,n,i,o){var r,s,a,l,c,d,h,p;t-=n,e-=i,r=2*n,s=2*i,a=r/2*.5522848,l=s/2*.5522848,c=t+r,d=e+s,h=t+r/2,p=e+s/2,this.beginPath(),this.moveTo(t,p),this.bezierCurveTo(t,p-l,h-a,e,h,e),this.bezierCurveTo(h+a,e,c,p-l,c,p),this.bezierCurveTo(c,p+l,h+a,d,h,d),this.bezierCurveTo(h-a,d,t,p+l,t,p),this.closePath(),o&&this.fill(),this.stroke()},circle:function(t,e,n,i){this.ellipse(t,e,n,n,i)}}),$.fn.extend({textWidth:function(){var t,e,n;return t=$(this).html(),e="<span>"+t+"</span>",$(this).html(e),n=$(this).find("span:first").width(),$(this).html(t),n}}),$.fn.extend({groupedAlphabetTabs:function(t){var e,n,i,o,r,s={groups:["A - E","F - J","K - O","P - T","U - Z"]},a={},l=$('<ul class="nav nav-tabs"></ul>'),c=$('<li class=""><a href="#" data-toggle="tab"></a></li>'),d=!1;for($.extend(a,s,t),e=l.clone(),a.extraTabs&&a.extraTabs.forEach(function(t){n=c.clone(),t.active===!0&&(n.addClass("active"),d=!0),n.find("a").text(t.title),n.data("filter",t.data),e.append(n)}),n=c.clone(),d===!1&&n.addClass("active"),n.find("a").text("ALL"),e.append(n),i=0;i<a.groups.length;i+=1)o=a.groups[i].split("-")[0].trim(),r=a.groups[i].split("-")[1].trim(),n=c.clone(),n.find("a").text(a.groups[i]),n.data("filter",[o,r]),e.append(n);this.each(function(){$(this).append(e.clone(!0)),$(this).on("click.groupedAlphabetTabs","li",function(e){var n=$(this).data("filter");t&&t.onClick&&t.onClick(n),e.preventDefault()})})}})}),define("js/logger",["debug"],function(t){"use strict";function e(n,i){var o,r="undefined"==typeof debug?t(n):debug(n),s={silly:0,input:1,verbose:2,prompt:3,debug:4,info:5,data:6,help:7,warn:8,error:9};if(!i)throw new Error("options required in logger");if(i.hasOwnProperty("level")===!1)throw new Error("options.level required in logger");return o=s[i.level],"undefined"==typeof o&&(o=s.info),r.debug=function(){r.enabled&&o<=s.debug&&(console.debug?r.log=console.debug.bind(console):r.log=console.log.bind(console),r.apply(this,arguments))},r.info=function(){r.enabled&&o<=s.info&&(r.log=console.info.bind(console),r.apply(this,arguments))},r.warn=function(){r.enabled&&o<=s.warn&&(r.log=console.warn.bind(console),r.apply(this,arguments))},r.error=function(){r.enabled&&o<=s.error?(r.log=console.error.bind(console),r.apply(this,arguments)):console.error.apply(console,arguments)},r.fork=function(t,o){return t=o?t:n+":"+t,e(t,i)},r.forkWithOptions=function(t,n){return e(t,n)},r}function n(t,n){return e(t,n.client.log)}return{create:e,createWithGmeConfig:n}}),define("common/storage/constants",[],function(){"use strict";return{VERSION:"1.1.0",MONGO_ID:"_id",COMMIT_TYPE:"commit",PROJECT_INFO_ID:"*info*",EMPTY_PROJECT_DATA:"empty",PROJECT_ID_SEP:"+",PROJECT_DISPLAYED_NAME_SEP:"/",DATABASE_ROOM:"database",ROOM_DIVIDER:"%",CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED",RECONNECTED:"RECONNECTED",INCOMPATIBLE_CONNECTION:"INCOMPATIBLE_CONNECTION",CONNECTION_ERROR:"CONNECTION_ERROR",SYNCED:"SYNCED",FORKED:"FORKED",CANCELED:"CANCELED",MERGED:"MERGED",BRANCH_STATUS:{SYNC:"SYNC",AHEAD_SYNC:"AHEAD_SYNC",AHEAD_NOT_SYNC:"AHEAD_NOT_SYNC",PULLING:"PULLING",MERGING:"MERGING",ERROR:"ERROR"},JWT_ABOUT_TO_EXPIRE:"JWT_ABOUT_TO_EXPIRE",JWT_EXPIRED:"JWT_EXPIRED",PROJECT_DELETED:"PROJECT_DELETED",PROJECT_CREATED:"PROJECT_CREATED",BRANCH_DELETED:"BRANCH_DELETED",BRANCH_CREATED:"BRANCH_CREATED",BRANCH_HASH_UPDATED:"BRANCH_HASH_UPDATED",TAG_DELETED:"TAG_DELETED",TAG_CREATED:"TAG_CREATED",COMMIT:"COMMIT",BRANCH_UPDATED:"BRANCH_UPDATED",NOTIFICATION:"NOTIFICATION",BRANCH_ROOM_SOCKETS:"BRANCH_ROOM_SOCKETS",PLUGIN_NOTIFICATION:"PLUGIN_NOTIFICATION",ADD_ON_NOTIFICATION:"ADD_ON_NOTIFICATION",CLIENT_STATE_NOTIFICATION:"CLIENT_STATE_NOTIFICATION"}}),define("common/storage/storageclasses/watchers",["common/storage/constants","q"],function(t,e){"use strict";function n(t,e,n){this.watchers={database:0,projects:{}},this.webSocket=t,this.logger=this.logger||e.fork("storage"),this.gmeConfig=n,this.logger.debug("StorageWatcher ctor"),this.connected=!1}return n.prototype.watchDatabase=function(n,i){var o=e.defer();return this.logger.debug("watchDatabase - handler added"),this.webSocket.addEventListener(t.PROJECT_DELETED,n),this.webSocket.addEventListener(t.PROJECT_CREATED,n),this.watchers.database+=1,this.logger.debug("Nbr of database watchers:",this.watchers.database),1===this.watchers.database?(this.logger.debug("First watcher will enter database room."),this.webSocket.watchDatabase({join:!0},function(t){t?o.reject(t):o.resolve()})):o.resolve(),o.promise.nodeify(i)},n.prototype.unwatchDatabase=function(n,i){var o=e.defer();return this.logger.debug("unwatchDatabase - handler will be removed"),this.logger.debug("Nbr of database watchers (before removal):",this.watchers.database),this.webSocket.removeEventListener(t.PROJECT_DELETED,n),this.webSocket.removeEventListener(t.PROJECT_CREATED,n),this.watchers.database-=1,0===this.watchers.database?(this.logger.debug("No more watchers will exit database room."),this.connected?this.webSocket.watchDatabase({join:!1},function(t){t?o.reject(t):o.resolve()}):o.resolve()):this.watchers.database<0?(this.logger.error("Number of database watchers became negative!"),o.reject(new Error("Number of database watchers became negative!"))):o.resolve(),o.promise.nodeify(i)},n.prototype.watchProject=function(n,i,o){var r=e.defer();return this.logger.debug("watchProject - handler added for project",n),this.webSocket.addEventListener(t.BRANCH_DELETED+n,i),this.webSocket.addEventListener(t.BRANCH_CREATED+n,i),this.webSocket.addEventListener(t.BRANCH_HASH_UPDATED+n,i),this.watchers.projects[n]=this.watchers.projects.hasOwnProperty(n)?this.watchers.projects[n]+1:1,this.logger.debug("Nbr of watchers for project:",n,this.watchers.projects[n]),1===this.watchers.projects[n]?(this.logger.debug("First watcher will enter project room:",n),this.webSocket.watchProject({projectId:n,join:!0},function(t){t?r.reject(t):r.resolve()})):r.resolve(),r.promise.nodeify(o)},n.prototype.unwatchProject=function(n,i,o){var r=e.defer();return this.logger.debug("unwatchProject - handler will be removed",n),this.logger.debug("Nbr of database watchers (before removal):",n,this.watchers.projects[n]),this.webSocket.removeEventListener(t.BRANCH_DELETED+n,i),this.webSocket.removeEventListener(t.BRANCH_CREATED+n,i),this.webSocket.removeEventListener(t.BRANCH_HASH_UPDATED+n,i),this.watchers.projects[n]=this.watchers.projects.hasOwnProperty(n)?this.watchers.projects[n]-1:-1,0===this.watchers.projects[n]?(this.logger.debug("No more watchers will exit project room:",n),delete this.watchers.projects[n],this.connected?this.webSocket.watchProject({projectId:n,join:!1},function(t){t?r.reject(t):r.resolve()}):r.resolve()):this.watchers.projects[n]<0?(this.logger.error("Number of project watchers became negative!:",n),r.reject(new Error("Number of project watchers became negative!"))):r.resolve(),r.promise.nodeify(o)},n.prototype._rejoinWatcherRooms=function(t){var n,i=[];this.logger.debug("rejoinWatcherRooms"),this.watchers.database>0&&(this.logger.debug("Rejoining database room."),i.push(e.ninvoke(this.webSocket,"watchDatabase",{join:!0})));for(n in this.watchers.projects)this.watchers.projects.hasOwnProperty(n)&&this.watchers.projects[n]>0&&(this.logger.debug("Rejoining project room",n,this.watchers.projects[n]),i.push(e.ninvoke(this.webSocket,"watchProject",{projectId:n,join:!0})));return e.all(i).nodeify(t)},n}),define("common/storage/storageclasses/simpleapi",["common/storage/storageclasses/watchers"],function(t){"use strict";function e(e,n,i){this.logger=this.logger||n.fork("storage"),t.call(this,e,n,i),this.webSocket=e,this.gmeConfig=i,this.logger.debug("StorageSimpleAPI ctor")}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.getProjects=function(t,e){this.logger.debug("invoking getProjects",{metadata:t}),this.webSocket.getProjects(t,e)},e.prototype.getBranches=function(t,e){var n={projectId:t};this.logger.debug("invoking getBranches",{metadata:n}),this.webSocket.getBranches(n,e)},e.prototype.getCommits=function(t,e,n,i){var o={projectId:t,before:e,number:n};this.logger.debug("invoking getCommits",{metadata:o}),this.webSocket.getCommits(o,i)},e.prototype.getHistory=function(t,e,n,i){var o={projectId:t,start:e,number:n};this.logger.debug("invoking getHistory",{metadata:o}),this.webSocket.getHistory(o,i)},e.prototype.squashCommits=function(t,e,n,i,o){var r={projectId:t,fromCommit:e,toCommitOrBranch:n,message:i};this.logger.debug("invoking squashCommits",{metadata:r}),this.webSocket.squashCommits(r,o)},e.prototype.getTags=function(t,e){var n={projectId:t};this.logger.debug("invoking getTags",{metadata:n}),this.webSocket.getTags(n,e)},e.prototype.getBranchHash=function(t,e,n){var i={projectId:t,branchName:e};this.logger.debug("invoking getBranchHash",{metadata:i}),this.webSocket.getBranchHash(i,n)},e.prototype.getLatestCommitData=function(t,e,n){var i={projectId:t,branchName:e};this.logger.debug("invoking getLatestCommitData",{metadata:i}),this.webSocket.getLatestCommitData(i,n)},e.prototype.getCommonAncestorCommit=function(t,e,n,i){var o={commitA:e,commitB:n,projectId:t};this.logger.debug("invoking getCommonAncestorCommit",{metadata:o}),this.webSocket.getCommonAncestorCommit(o,i)},e.prototype.createProject=function(t,e,n){var i=this,o={projectName:t,ownerId:e};void 0===n&&"function"==typeof e&&(n=e,o.ownerId=void 0),this.logger.debug("invoking createProject",{metadata:o}),this.webSocket.createProject(o,function(e,o){return e?(i.logger.error("cannot create project ",t,e),void n(e)):(i.logger.debug("Project created, projectId",o),void n(e,o))})},e.prototype.deleteProject=function(t,e){var n={projectId:t};this.logger.debug("invoking deleteProject",{metadata:n}),this.webSocket.deleteProject(n,e)},e.prototype.transferProject=function(t,e,n){var i={projectId:t,newOwnerId:e};this.logger.debug("invoking transferProject",{metadata:i}),this.webSocket.transferProject(i,n)},e.prototype.duplicateProject=function(t,e,n,i){var o={projectId:t,projectName:e,ownerId:n};void 0===i&&"function"==typeof n&&(i=n,o.ownerId=void 0),this.logger.debug("invoking duplicateProject",{metadata:o}),this.webSocket.duplicateProject(o,i)},e.prototype.setBranchHash=function(t,e,n,i,o){var r={projectId:t,branchName:e,newHash:n,oldHash:i};this.logger.debug("invoking setBranchHash",{metadata:r}),this.webSocket.setBranchHash(r,o)},e.prototype.createBranch=function(t,e,n,i){var o={projectId:t,branchName:e,newHash:n,oldHash:""};this.logger.debug("invoking createBranch",{metadata:o}),this.webSocket.setBranchHash(o,i)},e.prototype.deleteBranch=function(t,e,n,i){var o={projectId:t,branchName:e,newHash:"",oldHash:n};this.logger.debug("invoking deleteBranch",{metadata:o}),this.webSocket.setBranchHash(o,i)},e.prototype.createTag=function(t,e,n,i){var o={projectId:t,tagName:e,commitHash:n};this.logger.debug("invoking createTag",{metadata:o}),this.webSocket.createTag(o,i)},e.prototype.deleteTag=function(t,e,n){var i={projectId:t,tagName:e};this.logger.debug("invoking deleteTag",{metadata:i}),this.webSocket.deleteTag(i,n)},e.prototype.simpleRequest=function(t,e){this.logger.debug("invoking simpleRequest",{metadata:t}),this.webSocket.simpleRequest(t,e)},e.prototype.simpleQuery=function(t,e,n){this.logger.debug("invoking simpleQuery; workerId, parameters",t,{metadata:e}),this.webSocket.simpleQuery(t,e,n)},e.prototype.sendNotification=function(t,e){this.logger.debug("invoking sendNotification; ",{metadata:t}),this.webSocket.sendNotification(t,e)},e}),define("common/storage/storageclasses/objectloaders",["common/storage/storageclasses/simpleapi"],function(t){"use strict";function e(e,n,i){this.logger=this.logger||n.fork("storage"),t.call(this,e,n,i),this.webSocket=e,this.gmeConfig=i,this.loadBucket=[],this.loadBucketSize=0,this.loadBucketTimer=null,this.logger.debug("StorageObjectLoaders ctor")}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.loadObject=function(t,e,n){function i(){var e=o.loadBucket;o.loadBucket=[],o.loadBucketTimer=null,o.loadBucketSize=0,o.loadObjects(t,e)}var o=this;this.logger.debug("loadObject",t,e),o.loadBucket.push({projectId:t,hash:e,cb:n}),o.loadBucketSize+=1,1===o.loadBucketSize&&(o.logger.debug("loadBucket was empty starting timer [ms]",o.gmeConfig.storage.loadBucketTimer),o.loadBucketTimer=setTimeout(function(){o.logger.debug("loadBucketTimer triggered, bucketSize:",o.loadBucketSize),i()},o.gmeConfig.storage.loadBucketTimer)),o.loadBucketSize===o.gmeConfig.storage.loadBucketSize&&(o.logger.debug("loadBuckSize reached will loadObjects, bucketSize:",o.loadBucketSize),clearTimeout(o.loadBucketTimer),i())},e.prototype.loadObjects=function(t,e){var n,i,o=this,r={};for(i=0;i<e.length;i++)r[e[i].hash]=!0;r=Object.keys(r),n={hashes:r,projectId:t},this.webSocket.loadObjects(n,function(t,n){for(o.logger.debug("loadObjects returned",{metadata:n}),i=0;i<e.length;i++)t?e[i].cb(t):"string"==typeof n[e[i].hash]?(o.logger.error(n[e[i].hash]),e[i].cb(new Error(n[e[i].hash]))):e[i].cb(t,n[e[i].hash])})},e.prototype.loadPaths=function(t,e,n,i){var o={projectId:t,pathsInfo:e,excludes:n};this.webSocket.loadPaths(o,i)},e}),define("common/util/assert",[],function(){"use strict";var t=function(t,e){if(!t){var n=new Error(e||"ASSERT failed");throw"undefined"==typeof TESTING&&(console.log("Throwing",n.stack),console.log()),n}};return t}),define("common/util/canon",[],function(){var t,e,n,i,o={},r=[].slice,s={}.hasOwnProperty;return o.stringify=function(){var n;return n=function(o){var s,a;switch(Object.prototype.toString.call(o)){case"[object Array]":return["Array"].concat(r.call(e(o,n)));case"[object Date]":return["Date"].concat(isFinite(+o)?o.getUTCFullYear()+"-"+i(o.getUTCMonth()+1)+"-"+i(o.getUTCDate())+"T"+i(o.getUTCHours())+":"+i(o.getUTCMinutes())+":"+i(o.getUTCSeconds())+"."+i(o.getUTCMilliseconds(),3)+"Z":null);case"[object Function]":throw new TypeError("functions cannot be serialized");case"[object Number]":return isFinite(o)?o:["Number",""+o];case"[object Object]":return s=function(t){return[t,n(o[t])]},(a=["Object"]).concat.apply(a,e(t(o).sort(),s));case"[object RegExp]":return["RegExp",""+o];case"[object Undefined]":return["Undefined"];default:return o}},function(t){return JSON.stringify(n(t))}}(),o.parse=function(){var t;return t=function(n){var i,o,s,a,l,c,d;if("[object Array]"!==Object.prototype.toString.call(n))return n;switch(l=n[0],o=2<=n.length?r.call(n,1):[],i=o[0],l){case"Array":return e(o,t);case"Date":return new Date(i);case"Number":return+i;case"Object":for(a={},s=c=0,d=o.length;d>c;s=c+=2)a[o[s]]=t(o[s+1]);return a;case"RegExp":return function(t,e,n){n.prototype=t.prototype;var i=new n,o=t.apply(i,e);return Object(o)===o?o:i}(RegExp,/^[\/](.+)[\/]([gimy]*)$/.exec(i).slice(1),function(){});case"Undefined":return void 0;default:throw new Error("invalid input")}},function(e){return t(JSON.parse(e))}}(),n=Array.prototype.map,e=function(t,e){var i,o,r,s;if(n&&t.map===n)return t.map(e);for(s=[],o=0,r=t.length;r>o;o++)i=t[o],s.push(e(i));return s},t=Object.keys||function(t){var e,n;n=[];for(e in t)s.call(t,e)&&n.push(e);return n},i=function(t,e){return null==e&&(e=2),(""+(1e3+t)).substr(4-e)},o}),define("common/util/random",["chance"],function(t){"use strict";function e(){var t,e="";if(c.length>0)for(t=0;t<c.length;t+=1)e+="(?!(^"+c[t]+"$))";return e+="^(-)?["+l+"]+$",new RegExp(e)}function n(t){return t.charAt(p(t.length))}function i(){var t=function(){return n(a)+n(a)+n(a)+n(a)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function o(t,e){var i,o,s=e||1,a=0;do{for(a>=d&&(a=0,s+=1),i="",o=0;s>o;o+=1)i+=n(l);a+=1}while(t.hasOwnProperty(i)===!0||r(i)===!1);return i}function r(t){return"string"!=typeof t?!1:g.test(t)}function s(t){var e,n="NaN",i=!1;if(r(t))for(n=0,e=0;e<t.length;e+=1)"-"===t.charAt(e)?i=!0:(n*=l.length,n+=l.indexOf(t.charAt(e)));return n}var a="0123456789abcdef",l="0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM",c=["atr","reg","ovr"],d=2,h=new t,p=function(t){return h.natural({max:t-1})},g=e(),u={generateGuid:i,generateRelid:o,isValidRelid:r,relidToInteger:s};return u}),define("common/core/constants",[],function(){"use strict";return{ATTRIBUTES_PROPERTY:"atr",REGISTRY_PROPERTY:"reg",OVERLAYS_PROPERTY:"ovr",COLLECTION_NAME_SUFFIX:"-inv",ALL_SETS_PROPERTY:"_sets",SET_MODIFIED_REGISTRY:"_sets_",MEMBER_RELATION:"member",BASE_POINTER:"base",PATH_SEP:"/",MUTABLE_PROPERTY:"_mutable",MINIMAL_RELID_LENGTH_PROPERTY:"_minlenrelid",DOES_NOT_HAVE_RELID_CHILDREN:{_sets:!0,_meta:!0},INHERITED_CHILD_HAS_OWN_RELATION_PROPERTY:"_hasownrelation",NULLPTR_NAME:"_null_pointer",NULLPTR_RELID:"_nullptr",META_SET_NAME:"MetaAspectSet",NULL_GUID:"00000000-0000-0000-0000-000000000000",OWN_GUID:"_relguid",CONSTRAINTS_RELID:"_constraints",C_DEF_PRIORITY:1,CONSTRAINT_REGISTRY_PREFIX:"_ch#_",TO_DELETE_STRING:"*to*delete*",SET_ITEMS:"items",SET_ITEMS_MAX:"max",SET_ITEMS_MIN:"min",META_ASPECTS:"aspects",META_CHILDREN:"children",META_NODE:"_meta",META_POINTER_PREFIX:"_p_",META_ASPECT_PREFIX:"_a_",ATTRIBUTE_TYPES:{STRING:"string",INTEGER:"integer",FLOAT:"float",BOOLEAN:"boolean",ASSET:"asset"},MIXINS_SET:"_mixins",MIXIN_ERROR_TYPE:{MISSING:"missing",ATTRIBUTE_COLLISION:"attribute collision",SET_COLLISION:"set collision",POINTER_COLLISION:"pointer collision",CONTAINMENT_COLLISION:"containment collision",ASPECT_COLLISION:"aspect collision",CONSTRAINT_COLLISION:"constraint collision"},EXPORT_TYPE_PROJECT:"project",EXPORT_TYPE_LIBRARY:"library",NAMESPACE_SEPARATOR:".",MAX_AGE:3,MAX_TICKS:2e3,MAX_MUTATE:3e4,MAXIMUM_STARTING_RELID_LENGTH:5}}),define("common/util/jsonPatcher",["common/util/canon","common/util/random","common/core/constants"],function(t,e,n){"use strict";function i(t){return t.replace(/\//g,"%2f")}function o(t){return t.replace(/%2f/g,"/")}function r(t,e){return 0===t.indexOf(e)}function s(t){return 0===t.indexOf("/ovr")}function a(t){return e.isValidRelid(t.substring(1))}function l(t){if("string"!=typeof t)return!1;var n,i=t.split("/"),o=!1;for(n=1;n<i.length;n+=1){if(e.isValidRelid(i[n])===!1)return!1;o=!0}return o}function c(e,n,o,s,a,c){var d,h,p,g=[],u=!1,f=!1;"/ovr/"===o?u=!0:r(o,"/ovr/")&&(f=!0);for(p in n)if(-1===s.indexOf(p)&&n.hasOwnProperty(p)&&!e.hasOwnProperty(p)){if(d={op:"add",path:o+i(p),value:n[p]},f||u)if(d.partialUpdates=[],d.updates=[],f)l(n[p])?(d.partialUpdates.push(n[p]),l(c)&&d.updates.push(c)):"/_nullptr"===n[p]&&d.updates.push("");else for(h in n[p])l(n[p][h])?(d.partialUpdates.push(n[p][h]),l(p)&&d.updates.push(p)):"/_nullptr"===n[p][h]&&d.updates.push("");g.push(d)}if(!a)for(p in n)-1===s.indexOf(p)&&n.hasOwnProperty(p)&&e.hasOwnProperty(p)&&t.stringify(e[p])!==t.stringify(n[p])&&(d={op:"replace",path:o+i(p),value:n[p]},f&&(d.partialUpdates=[],d.updates=[],l(n[p])?(d.partialUpdates.push(n[p]),l(c)&&d.updates.push(c)):"/_nullptr"===n[p]&&d.updates.push(""),l(e[p])?d.partialUpdates.push(e[p]):"/_nullptr"===e[p]&&d.updates.push("")),g.push(d));for(p in e)if(-1===s.indexOf(p)&&e.hasOwnProperty(p)&&!n.hasOwnProperty(p)){if(d={op:"remove",path:o+i(p)},f||u)if(d.partialUpdates=[],d.updates=[],f)l(e[p])?(d.partialUpdates.push(e[p]),l(c)&&d.updates.push(c)):"/_nullptr"===e[p]&&d.updates.push("");else for(h in e[p])l(e[p][h])?(d.partialUpdates.push(e[p][h]),l(p)&&d.updates.push(p)):"/_nullptr"===e[p][h]&&d.updates.push("");g.push(d)}return g}function d(t,e){var n,o,r,s,a;if(n=c(t,e,"/",["_id","ovr","atr","reg","_sets"],!1),t.atr&&e.atr?n=n.concat(c(t.atr,e.atr,"/atr/",[],!1)):t.atr?n.push({op:"remove",path:"/atr"}):e.atr&&n.push({op:"add",path:"/atr",value:e.atr}),t.reg&&e.reg?n=n.concat(c(t.reg,e.reg,"/reg/",[],!1)):t.reg?n.push({op:"remove",path:"/reg"}):e.reg&&n.push({op:"add",path:"/reg",value:e.reg}),t._sets&&e._sets){n=n.concat(c(t._sets,e._sets,"/_sets/",[],!0));for(a in e._sets)t._sets[a]&&(n=n.concat(c(t._sets[a],e._sets[a],"/_sets/"+i(a)+"/",[],!1)))}else t._sets?n.push({op:"remove",path:"/_sets"}):e._sets&&n.push({op:"add",path:"/_sets",value:e._sets});if(t.ovr&&e.ovr){n=n.concat(c(t.ovr,e.ovr,"/ovr/",[],!0));for(a in e.ovr)t.ovr[a]&&(n=n.concat(c(t.ovr[a],e.ovr[a],"/ovr/"+i(a)+"/",[],!1,a)))}else if(t.ovr||e.ovr){for(o={path:"/ovr",partialUpdates:[],updates:[]},t.ovr?o.op="remove":(o.op="add",o.value=e.ovr),r=c(t.ovr||{},e.ovr||{},"/ovr/",[],!0),s=0;s<r.length;s+=1)o.partialUpdates=o.partialUpdates.concat(r[s].partialUpdates),o.updates=o.updates.concat(r[s].updates);n.push(o)}return n}function h(t,e){var n,i,r,s,a,l=JSON.parse(JSON.stringify(t)),c=!1,d={status:"success",faults:[],patch:e,result:l};for(n=0;n<e.length;n+=1){for(r=(e[n].path+"").split("/").slice(1),a=l,i=0;i<r.length;i+=1)r[i]=o(r[i]);switch(s=r.pop(),c=!1,e[n].op){case"remove":if("string"==typeof e[n].path){for(i=0;i<r.length;i+=1){if(!a[r[i]]){c=!0;break}a=a[r[i]]}c||void 0===a[s]?(d.status="fail",d.faults.push(e[n])):delete a[s]}else d.status="fail",d.faults.push(e[n]);break;case"add":if("string"==typeof e[n].path&&void 0!==e[n].value){for(i=0;i<r.length;i+=1)a[r[i]]||(a[r[i]]={}),a=a[r[i]];a[s]=e[n].value}else d.status="fail",d.faults.push(e[n]);break;case"replace":if("string"==typeof e[n].path&&void 0!==e[n].value){for(i=0;i<r.length;i+=1){if(!a[r[i]]){c=!0;break}a=a[r[i]]}c||void 0===a[s]?(d.status="fail",d.faults.push(e[n])):a[s]=e[n].value}else d.status="fail",d.faults.push(e[n]);break;default:d.status="fail",d.faults.push(e[n])}}return d}function p(t,e){var n,i=e.split("/");n=e;do{if(t.load[n]||t.unload[n])return!0;i.pop(),n=i.join("/")}while(i.length>1);return!1}function g(t,e){var n,i;for(n=Object.keys(t.update),i=0;n>i;i+=1)r(n[i],e)&&delete t.update[e];for(n=Object.keys(t.partialUpdate),i=0;n>i;i+=1)r(n[i],e)&&delete t.partialUpdate[e]}function u(t,e,n,i){var o,r,l,c,d=t[n]&&t[n].patch,h=!1;if(d){for(o=0;o<d.length;o+=1)if(c=d[o].path,s(c)===!0){for(r=0;r<d[o].partialUpdates.length;r+=1)l=i+d[o].partialUpdates[r],p(e,l)===!1&&(e.partialUpdate[l]=!0);for(r=0;r<d[o].updates.length;r+=1)l=i+d[o].updates[r],p(e,l)===!1&&(e.update[l]=!0)}else if(a(c)===!0)switch(d[o].op){case"add":e.load[i+c]=!0,g(e,i+c);break;case"remove":e.unload[i+c]=!0,g(e,i+c);break;case"replace":u(t,e,d[o].value,i+c);break;default:throw new Error("Unexpected patch operation "+d[o])}else c!==m&&"/__v"!==c&&(h=!0);h&&(e.update[i]=!0)}}function f(t,e){var n;return t[e]&&t[e].patch?(n={load:{},unload:{},update:{},partialUpdate:{}},u(t,n,e,"")):n=null,n}var m=n.PATH_SEP+n.MINIMAL_RELID_LENGTH_PROPERTY;return{create:d,apply:h,getChangedNodes:f}}),define("common/regexp",[],function(){"use strict";var t=new RegExp("^#[0-9a-zA-Z_]*$"),e=new RegExp("^#[0-9a-zA-Z_]{40}$"),n=new RegExp("^[0-9a-zA-Z_]*$"),i=new RegExp("^[0-9a-zA-Z_]*$"),o=new RegExp("^\\*[0-9a-zA-Z_]*$"),r=new RegExp("^(?!system\\.)(?!_)[0-9a-zA-Z_+]*$"),s=new RegExp("^[^($|_).][^.]*$"),a=new RegExp("^[0-9a-zA-Z_]+$"),l=new RegExp("[!\"#$%&'()*+,./:;<=>?@[\\]^`{|}~ ]+","g"),c=new RegExp("<[a-z][\\s\\S]*>","i"),d=new RegExp("[a-z0-9]{8}(-[a-z0-9]{4}){3}-[a-z0-9]{12}","i"),h=new RegExp("^[0-9a-f]{40}$");return{HASH:t,DB_HASH:e,BRANCH:n,TAG:i,RAW_BRANCH:o,PROJECT:r,DOCUMENT_KEY:s,GUID:d,INVALID_CSS_CHARS:l,HTML_ELEMENT:c,PROJECT_NAME:a,BLOB_HASH:h}}),define("common/util/sha1",[],function(){return function(t){function e(t,e){return t<<e|t>>>32-e}function n(e,n){return t.charCodeAt(64*m+4*d+e)<<n}t+="";for(var i,o,r,s,a,l,c,d,h=Math,p=[1518500249,1859775393,2400959708,3395469782,1732584193,4023233417,2562383102,271733878,3285377520,4294967295],g=h.ceil(t.length/4)+2,u=h.ceil(g/16),f=[],m=0,_=[];u>m;m++)for(f[m]=[],d=0;16>d;d++)f[m][d]=n(0,24)|n(1,16)|n(2,8)|n(3,0);for(l=8*t.length-8,m=u-1,f[m][14]=l/(p[9]+1),f[m][14]=h.floor(f[m][14]),f[m][15]=l&p[9],m=0;u>m;m++){for(c=0;16>c;c++)_[c]=f[m][c];for(c=16;80>c;c++)_[c]=e(_[c-3]^_[c-8]^_[c-14]^_[c-16],1);for(i=p[4],o=p[5],r=p[6],s=p[7],a=p[8],c=0;80>c;c++){var b=h.floor(c/20),y=e(i,5)+(1>b?o&r^~o&s:2==b?o&r^o&s^r&s:o^r^s)+a+p[b]+_[c]&p[9];a=s,s=r,r=e(o,30),o=i,i=y}p[4]+=i,p[5]+=o,p[6]+=r,p[7]+=s,p[8]+=a}for(l="",z=4;z<9;z++)for(m=7;m>=0;m--)l+=((p[z]&p[9])>>>4*m&15).toString(16);return l}}),define("common/util/key",["common/util/sha1","common/util/assert","common/util/canon"],function(t,e,n){"use strict";function i(){var t,e,n="";for(t=0;40>t;t++)e=Math.floor(16*Math.random()),e=e>9?e+87:e+48,n+=String.fromCharCode(e);return n}var o=null;return function(r,s){switch(o=s.storage.keyType,e("string"==typeof o),o){case"rand160Bits":return i();default:return t(n.stringify(r))}}}),define("common/storage/util",["common/storage/constants","common/util/jsonPatcher","q","common/regexp","common/util/key"],function(t,e,n,i,o){"use strict";function r(t,e){var i=n.defer();return e.branchName?n.ninvoke(t,"getBranchHash",e.branchName).then(function(i){return e.commitHash=i,n.ninvoke(t,"loadObject",i)}).then(function(t){e.rootHash=t.root,i.resolve(t.root)})["catch"](i.reject):e.commitHash?n.ninvoke(t,"loadObject",e.commitHash).then(function(t){e.rootHash=t.root,i.resolve(t.root)})["catch"](i.reject):e.tagName?n.ninvoke(t,"getAllTags").then(function(i){if(i[e.tagName])return e.commitHash=i[e.tagName],n.ninvoke(t,"loadObject",i[e.tagName]);throw new Error("Unknown tag name ["+e.tagName+"]")}).then(function(t){e.rootHash=t.root,i.resolve(t.root)})["catch"](i.reject):e.rootHash?i.resolve(e.rootHash):i.reject(new Error("No valid input was given to search for rootHash")),i.promise}function s(t,e){var i,o=n.defer(),r=[],s=[];for(i=0;i<e.length;i+=1)r.push(n.ninvoke(t,"loadObject",e[i]));return n.allSettled(r).then(function(t){var e,n=null;for(e=0;e<t.length;e+=1)"fulfilled"===t[e].state?s.push(t[e].value):n=n||t[e].reason||new Error("unable to load");n?o.reject(n):o.resolve(s)}),o.promise}function a(t,e){var o,r,s=n.defer(),a={},l={},c=[e],d=null,h=!1;return r=setInterval(function(){if(!h){if(o=c.shift(),void 0===o)return clearInterval(r),void(d?s.reject(d):s.resolve({objects:Object.keys(a),assets:Object.keys(l)}));a[o]||(h=!0,t.loadObject(o,function(t,e){var n;if(d=d||t,!t&&e&&(a[o]=!0,e)){for(n in e)"string"==typeof e[n]&&i.HASH.test(e[n])&&c.push(e[n]);if(e.atr)for(n in e.atr)"string"==typeof e.atr[n]&&i.BLOB_HASH.test(e.atr[n])&&(l[e.atr[n]]=!0)}h=!1}))}},1),s.promise}return{CONSTANTS:t,getProjectFullNameFromProjectId:function(e){return e?e.replace(t.PROJECT_ID_SEP,t.PROJECT_DISPLAYED_NAME_SEP):void 0},getProjectDisplayedNameFromProjectId:function(e){return e?e.replace(t.PROJECT_ID_SEP," "+t.PROJECT_DISPLAYED_NAME_SEP+" "):void 0},getProjectIdFromProjectFullName:function(e){return e?e.replace(t.PROJECT_DISPLAYED_NAME_SEP,t.PROJECT_ID_SEP):void 0},getProjectIdFromOwnerIdAndProjectName:function(e,n){return e+t.PROJECT_ID_SEP+n},getProjectNameFromProjectId:function(e){return e?e.substring(e.indexOf(t.PROJECT_ID_SEP)+1):void 0},getOwnerFromProjectId:function(e){return e?e.substring(0,e.indexOf(t.PROJECT_ID_SEP)):void 0},getHashTaggedHash:function(t){return"string"==typeof t?"#"===t[0]?t:"#"+t:t},getPatchObject:function(n,i){var o={type:"patch",base:n[t.MONGO_ID],patch:e.create(n,i)};return o[t.MONGO_ID]=i[t.MONGO_ID],o},coreObjectHasOldAndNewData:function(t){return!!(t.oldHash&&t.newHash&&t.oldData&&t.newData)},getChangedNodes:e.getChangedNodes,applyPatch:e.apply,checkHashConsistency:function(e,n,i){
var r;return"rand160Bits"===e.storage.keyType?r=!0:e.storage.disableHashChecks===!0?r=!0:(n[t.MONGO_ID]="",r=i==="#"+o(n,e)),r},getProjectJson:function(t,e,i){var o,l=n.defer();return r(t,e||{}).then(function(e){return a(t,e)}).then(function(n){return o={rootHash:e.rootHash,projectId:t.projectId,branchName:e.branchName,commitHash:e.commitHash,hashes:n,objects:null},s(t,n.objects)}).then(function(t){o.objects=t,l.resolve(o)})["catch"](l.reject),l.promise.nodeify(i)},insertProjectJson:function(t,e,i,o){var r,s=n.defer(),a={},l=e.rootHash,c="Importing contents of ["+e.projectId+"@"+l+"]",d=e.objects;for(r=0;r<d.length;r+=1)a[d[r]._id]=d[r];return i=i||{},i.branch=i.branch||null,i.parentCommit=i.parentCommit||[],t.makeCommit(i.branch,i.parentCommit,l,a,i.commitMessage||c).then(function(t){s.resolve(t)})["catch"](s.reject),s.promise.nodeify(o)}}}),define("common/storage/project/cache",["common/util/assert","common/storage/constants","common/storage/util"],function(t,e,n){"use strict";function i(i,o,r,s){function a(n,i){return t(i[e.MONGO_ID]===n),g.debug("cacheInsert",n),p[n]?!1:(p[n]=i,++u>=s.storage.cache&&(h=p,p={},u=0),!0)}function l(t){var e,n=p[t];if("undefined"==typeof n&&(n=h[t],"undefined"==typeof n))for(e in c.queuedPersists)if(c.queuedPersists.hasOwnProperty(e)&&c.queuedPersists[e][t]){n=c.queuedPersists[e][t];break}return n}var c=this,d={},h={},p={},g=r.fork("ProjectCache"),u=0;g.debug("ctor",o),this.queuedPersists={},this.loadObject=function(n,r){var s;t("string"==typeof n&&"function"==typeof r),g.debug("loadObject",{metadata:n});var l=p[n];if("undefined"==typeof l)if(l=h[n],"undefined"==typeof l){for(s in c.queuedPersists)if(c.queuedPersists.hasOwnProperty(s)&&c.queuedPersists[s][n]){l=c.queuedPersists[s][n];break}if("undefined"==typeof l)return l=d[n],void("undefined"==typeof l?(l=[r],d[n]=l,g.debug("object set to be loaded from storage"),i.loadObject(o,n,function(e,i){if(t("object"==typeof i||"undefined"==typeof i),0!==l.length){t(d[n]===l),delete d[n],!e&&i&&a(n,i);for(var o;o=l.pop();)o(e,i)}})):(g.debug("object was already queued to be loaded"),l.push(r)));g.debug("object was erased from cache and backup but present in queuedPersists"),a(n,l)}else g.debug("object was in backup"),a(n,l);else g.debug("object was in cache");t("object"==typeof l&&null!==l&&l[e.MONGO_ID]===n),r(null,l)},this.loadPaths=function(t,e,n){g.debug("loadPaths",{metadata:{rootKey:t,paths:e}});var r,s,c,d,h={},p=[],u=l(t),f=e.length,m=[];if(!t)return g.debug("rootKey empty:",t),void n(null);if(u)for(p.push(t),h[t]=u;f--;)for(s=e[f].split("/"),s.shift(),c=u,r=0;r<s.length&&(d=c[s[r]],d);r+=1){if(c=l(d),"undefined"==typeof c){m.push({parentHash:d,path:"/"+s.slice(r+1).join("/")});break}p.push(d),h[d]=c}else m=e.map(function(e){return{parentHash:t,path:e}});return 0===m.length?(g.debug("All given paths already loaded"),void n(null)):(g.debug("loadPaths will request from server, pathsInfo:",m),void i.loadPaths(o,m,p,function(t,e){var i,o;if(!t&&e){for(i=Object.keys(e),o=0;o<i.length;o+=1)void 0!==e[i[o]]&&a(i[o],e[i[o]]);for(i=Object.keys(h),o=0;o<i.length;o+=1)a(i[o],h[i[o]]);n(null)}else g.error("loadingPaths failed",t||new Error("no object arrived from server")),n(t)}))},this.insertObject=function(n,i){t("object"==typeof n&&null!==n);var o=n[e.MONGO_ID];if(g.debug("insertObject",{metadata:o}),t("string"==typeof o),a(o,n)===!1)g.debug("object inserted was already in cache");else{var r=h[o];if("undefined"!=typeof r)g.debug("object inserted was already in back-up");else if(r=d[o],"undefined"!=typeof r){delete d[o];for(var s;s=r.pop();)s(null,n)}}i&&(i[o]=n)},this.insertPatchObject=function(i){t("object"==typeof i&&null!==i);var o,r,s=i[e.MONGO_ID];i.base&&"object"==typeof i.patch&&s?(o=l(i.base),o?(r=n.applyPatch(o,i.patch),"success"===r.status?(r.result[e.MONGO_ID]=s,this.insertObject(r.result)):g.error("patch application failed",r)):g.debug("the base ["+i.base+"] is not available from the cache so the patch object is ignored")):g.error("invalid patch object format",i)}}return i}),define("common/storage/project/interface",["common/storage/project/cache","common/storage/constants","common/storage/util"],function(t,e,n){"use strict";function i(i,o,r,s){this.projectId=i,this.projectName=n.getProjectNameFromProjectId(i),this.CONSTANTS=e,this.ID_NAME=e.MONGO_ID,this.logger=r.fork("Project:"+this.projectId),this.logger.debug("ctor",i),this.projectCache=new t(o,this.projectId,this.logger,s),this.insertObject=this.projectCache.insertObject,this.insertPatchObject=this.projectCache.insertPatchObject,this.loadObject=this.projectCache.loadObject,this.loadPaths=this.projectCache.loadPaths,this.makeCommit=function(t,e,n,i,o,r){throw new Error("makeCommit must be overridden in derived class")},this.setBranchHash=function(t,e,n,i){throw new Error("setBranchHash must be overridden in derived class")},this.getBranchHash=function(t,e){throw new Error("getBranchHash must be overridden in derived class")},this.createBranch=function(t,e,n){throw new Error("createBranch must be overridden in derived class")},this.deleteBranch=function(t,e,n){throw new Error("deleteBranch must be overridden in derived class")},this.getBranches=function(t){throw new Error("getBranches must be overridden in derived class")},this.getHistory=function(t,e,n){throw new Error("getHistory must be overridden in derived class")},this.getCommits=function(t,e,n){throw new Error("getCommits must be overridden in derived class")},this.createTag=function(t,e,n){throw new Error("createTag must be overridden in derived class")},this.deleteTag=function(t,e){throw new Error("deleteTag must be overridden in derived class")},this.getTags=function(t){throw new Error("getTags must be overridden in derived class")},this.getCommonAncestorCommit=function(t,e,n){throw new Error("getCommonAncestorCommit must be overridden in derived class")}}return i}),define("common/storage/project/branch",["common/storage/constants"],function(t){"use strict";function e(e,n){var i=this,o=n.fork("Branch:"+e),r="",s="",a=[],l=[],c=t.BRANCH_STATUS.SYNC;o.debug("ctor"),this.name=e,this.isOpen=!0,this.inSync=!0,this.branchStatusHandlers=[],this.hashUpdateHandlers=[],this.callbackQueue=[],this.errorList=[],this._remoteUpdateHandler=null,this.cleanUp=function(){var e,n;for(i.isOpen=!1,i.branchStatusHandlers=[],i.hashUpdateHandlers=[],i._remoteUpdateHandler=null,e=0;e<i.callbackQueue.length;e+=1)n={status:t.CANCELED,hash:a[e].commitObject[t.MONGO_ID]},i.callbackQueue[e](null,n);i.callbackQueue=[],a=[],l=[]},this.getLocalHash=function(){return s},this.getOriginHash=function(){return r},this.updateHashes=function(t,e){o.debug("updatingHashes"),null!==t&&(o.debug("localHash: old, new",s,t),s=t),null!==e&&(o.debug("originHash: old, new",r,e),r=e)},this.queueCommit=function(t,e){a.push(t),i.callbackQueue.push(e),o.debug("Adding new commit to queue",a.length)},this.getFirstCommit=function(t){var e;return t?(e=a.shift(),i.callbackQueue.shift(),o.debug("Removed commit from queue",a.length)):e=a[0],e},this.getMergedCommit=function(e){for(var n,i=l.length;i;)if(i-=1,l[i].commitObject[t.MONGO_ID]===e){n=l[i];break}return n||o.error("mergeCommit not available in updateQueue",e,JSON.stringify(l,null,2)),l=[],n},this.getCommitQueue=function(){return a},this.getCommitsForNewFork=function(e){var n,i,r,l=!1,c=[];for(o.debug("getCommitsForNewFork",e),0===a.length?(r=s,o.debug("No commits queued will fork from",r),e=e||r,l=e===r):e=e||a[a.length-1].commitObject[t.MONGO_ID],o.debug("Will fork up to commitHash",e),n=0;n<a.length;n+=1)if(i=a[n],r=i.commitObject[t.MONGO_ID],0!==n&&c.push(i),i.commitObject[t.MONGO_ID]===e){l=!0;break}return l===!1?(o.error("Could not find the specified commitHash",e),!1):{commitHash:r,queue:c}},this.queueUpdate=function(t){l.push(t),o.debug("Adding new update to queue",l.length)},this.getUpdateQueue=function(){return l},this.getFirstUpdate=function(t){var e;return t?(e=l.shift(),o.debug("Removed update from queue",l.length)):e=l[0],e},this.addBranchStatusHandler=function(t){i.branchStatusHandlers.push(t)},this.removeBranchStatusHandler=function(t){var e;for(e=0;e<i.branchStatusHandlers.length;e+=1)if(i.branchStatusHandlers[e]===t)return i.branchStatusHandlers.splice(e,1),!0;return!1},this.dispatchBranchStatus=function(e,n){var r;for(o.debug("dispatchBranchStatus old, new",c,e),c===t.BRANCH_STATUS.ERROR?(o.error("In error state, action from user required!"),e=c):c=e,n&&this.errorList.push(n instanceof Error?n:new Error(n)),r=0;r<i.branchStatusHandlers.length;r+=1)i.branchStatusHandlers[r](e,a,l)},this.addHashUpdateHandler=function(t){i.hashUpdateHandlers.push(t)},this.removeHashUpdateHandler=function(t){var e;for(e=0;e<i.hashUpdateHandlers.length;e+=1)if(i.hashUpdateHandlers[e]===t)return i.hashUpdateHandlers.splice(e,1),!0;return!1},this.dispatchHashUpdate=function(t,e){var n,o=null,r=i.hashUpdateHandlers.length,s=!0,c=function(t,n){o=o||t,s=s&&n===!0,r-=1,0===r&&e(o,s)};for(n=0;n<i.hashUpdateHandlers.length;n+=1)i.hashUpdateHandlers[n](t,a,l,c)}}return e}),define("common/storage/project/project",["common/storage/project/interface","common/storage/project/branch","q"],function(t,e,n){"use strict";function i(e,i,o,r){var s=this;this.branches={},t.call(this,e,i,o,r),this.makeCommit=function(t,e,o,r,a,l){return n.ninvoke(i,"makeCommit",s.projectId,t,e,o,r,a).nodeify(l)},this.setBranchHash=function(t,e,o,r){return n.ninvoke(i,"setBranchHash",s.projectId,t,e,o).nodeify(r)},this.getBranchHash=function(t,e){return n.ninvoke(i,"getBranchHash",s.projectId,t).nodeify(e)},this.createBranch=function(t,e,o){return n.ninvoke(i,"createBranch",s.projectId,t,e).nodeify(o)},this.deleteBranch=function(t,e,o){return n.ninvoke(i,"deleteBranch",s.projectId,t,e).nodeify(o)},this.getBranches=function(t){return n.ninvoke(i,"getBranches",s.projectId).nodeify(t)},this.createTag=function(t,e,o){return n.ninvoke(i,"createTag",s.projectId,t,e).nodeify(o)},this.deleteTag=function(t,e){return n.ninvoke(i,"deleteTag",s.projectId,t).nodeify(e)},this.getTags=function(t){return n.ninvoke(i,"getTags",s.projectId).nodeify(t)},this.getCommits=function(t,e,o){return n.ninvoke(i,"getCommits",s.projectId,t,e).nodeify(o)},this.getHistory=function(t,e,o){return n.ninvoke(i,"getHistory",s.projectId,t,e).nodeify(o)},this.getCommonAncestorCommit=function(t,e,o){return n.ninvoke(i,"getCommonAncestorCommit",s.projectId,t,e).nodeify(o)},this.squashCommits=function(t,e,o,r){return n.ninvoke(i,"squashCommits",s.projectId,t,e,o).nodeify(r)}}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i}),define("common/storage/storageclasses/editorstorage",["common/storage/storageclasses/objectloaders","common/storage/constants","common/storage/project/project","common/storage/project/branch","common/util/assert","common/util/key","common/storage/util","q"],function(t,e,n,i,o,r,s,a){"use strict";function l(l,c,d){var h=this,p=c.fork("storage"),g={};h.logger=p,h.userId=null,h.serverVersion=null,t.call(this,l,c,d),this.open=function(t){l.connect(function(n,i){n?(p.error(n),t(e.CONNECTION_ERROR)):i===e.CONNECTED?(h.connected=!0,h.userId=l.userId,h.serverVersion=l.serverVersion,t(i)):i===e.RECONNECTED?(h.connected=!0,h._rejoinWatcherRooms().then(function(){return h._rejoinBranchRooms()}).then(function(){t(i)})["catch"](function(n){p.error("failing during reconnect",n),t(e.CONNECTION_ERROR)})):i===e.DISCONNECTED?(h.connected=!1,t(i)):i===e.INCOMPATIBLE_CONNECTION?t(i):i===e.JWT_ABOUT_TO_EXPIRE?t(i):i===e.JWT_EXPIRED?t(i):(p.error("unexpected connection state"),t(e.CONNECTION_ERROR))})},this.close=function(t){function e(e){e&&(p.error(e.message),n=e),p.debug("inside afterProjectClosed projectCnt",o),0===o&&(p.debug("Removing connect and disconnect events"),l.socket.removeAllListeners("connect"),l.socket.removeAllListeners("disconnect"),p.debug("Disconnecting web-socket"),l.disconnect(),h.connected=!1,l.clearAllEvents(),t(n))}var n=null,i=Object.keys(g),o=i.length;if(p.debug("Closing storage, openProjects",i),o>0)for(;o;)o-=1,this.closeProject(i[o],e);else p.debug("No projects were open, will disconnect directly"),e(null)},this.openProject=function(t,e){var i={projectId:t};return g[t]?void e(new Error("project is already open "+t)):void l.openProject(i,function(i,o,r){if(i)return void e(i);var s=new n(t,h,p,d);g[t]=s,e(null,s,o,r)})},this.closeProject=function(t,e){function n(n){n&&(p.error(n.message),s=n),p.debug("inside closeAndDelete branchCnt",i),0===i&&l.closeProject({projectId:t},function(n){p.debug("project closed on server."),delete g[t],e(n||s)})}var i,o,r=g[t],s=null;if(p.debug("closeProject",t),r)if(o=Object.keys(r.branches),i=o.length,i>0)for(p.warn("Branches still open for project, will be closed.",t,o);i;)i-=1,this.closeBranch(t,o[i],n);else n(null);else p.warn("Project is not open ",t),e(null)},this.openBranch=function(t,n,o,r,s){var a,c=g[t],d={projectId:t,branchName:n};return c?c.branches[n]?void s(new Error("Branch is already open "+n+", project: "+t)):(p.debug("openBranch, calling webSocket openBranch",t,n),void l.openBranch(d,function(d,g){var u;return d?void s(d):(a=new i(n,c.logger),c.branches[n]=a,a.latestCommitData=g,u=g.commitObject[e.MONGO_ID],a.updateHashes(u,u),a.addHashUpdateHandler(o),a.addBranchStatusHandler(r),a._remoteUpdateHandler=function(i,o,r){var s,l=o.commitObject[e.MONGO_ID];for(p.debug("_remoteUpdateHandler invoked for project, branch",t,n),s=0;s<o.coreObjects.length;s+=1)o.coreObjects[s]&&"patch"===o.coreObjects[s].type?c.insertPatchObject(o.coreObjects[s]):c.insertObject(o.coreObjects[s]);a.queueUpdate(o),a.updateHashes(null,l),0===a.getCommitQueue().length?1===a.getUpdateQueue().length&&h._pullNextQueuedCommit(t,n,r):p.debug("commitQueue is not empty, only updating originHash.")},void a._remoteUpdateHandler(null,g,function(e){l.addEventListener(l.getBranchUpdateEventName(t,n),a._remoteUpdateHandler),s(e,g)}))})):void s(new Error("Cannot open branch, "+n+", project "+t+" is not opened."))},this.closeBranch=function(t,e,n){var i,o=g[t];return p.debug("closeBranch",t,e),o?(i=o.branches[e])?(i.dispatchBranchStatus(null),l.removeEventListener(l.getBranchUpdateEventName(t,e),i._remoteUpdateHandler),i.cleanUp(),void l.closeBranch({projectId:t,branchName:e},function(t){delete o.branches[e],n(t)})):(p.warn("closeBranch: project does not have given branch.",t,e),void n(null)):(p.warn("closeBranch: project is not open",t,e),void n(null))},this.forkBranch=function(t,e,n,i,o){var r,s,a=g[t];return this.logger.debug("forkBranch",t,e,n,i),a?(r=a.branches[e])?(s=r.getCommitsForNewFork(i,n),h.logger.debug("forkBranch - forkData",s),s===!1?void o(new Error("Could not find specified commitHash: "+i)):void h.persistCommits(s.queue,function(e){return e?void o(e):void h.createBranch(t,n,s.commitHash,function(t){return t?(p.error("forkBranch - failed creating new branch",t),void o(t)):void o(null,s.commitHash)})})):void o(new Error("Cannot fork branch, branch is not open "+e+", project: "+t)):void o(new Error("Cannot fork branch, "+e+", project "+t+" is not opened."))},this.persistCommits=function(t,n){function i(r){var s=t[r];r<t.length?(s=t[r],p.debug("persistCommits - commitNext, currentCommitData",s),delete s.branchName,o=s.commitObject[e.MONGO_ID],l.makeCommit(s,function(t,e){return t?(p.error("persistCommits - failed committing",t),void n(t)):(p.debug("persistCommits - commit successful, hash",e),void i(r+=1))})):n(null,o)}var o;i(0)},this.makeCommit=function(t,n,i,o,r,a,c){var d,u,f,m,_=g[t],b={},y={rootHash:o,projectId:t,commitObject:null,coreObjects:{},changedNodes:null},v=Object.keys(r);for(m=0;m<v.length;m+=1)s.coreObjectHasOldAndNewData(r[v[m]])?(b[v[m]]=r[v[m]].newData,v[m]===o,y.coreObjects[v[m]]=s.getPatchObject(r[v[m]].oldData,r[v[m]].newData)):r[v[m]].newData&&r[v[m]].newHash?(y.coreObjects[v[m]]=r[v[m]].newData,b[v[m]]=r[v[m]].newData):(y.coreObjects[v[m]]=r[v[m]],b[v[m]]=r[v[m]]);return y.changedNodes=s.getChangedNodes(y.coreObjects,o),y.commitObject=h._getCommitObject(t,i,y.rootHash,a),_?(_.insertObject(y.commitObject),u=y.commitObject[e.MONGO_ID],f=function(){delete _.projectCache.queuedPersists[u],h.logger.debug("Removed now persisted core-objects from cache: ",Object.keys(_.projectCache.queuedPersists).length),c.apply(null,arguments)},_.projectCache.queuedPersists[u]=b,p.debug("Queued non-persisted core-objects in cache: ",Object.keys(_.projectCache.queuedPersists).length)):f=c,"string"==typeof n&&(y.branchName=n,d=_?_.branches[n]:null),p.debug("makeCommit",y),d?(p.debug("makeCommit, branch is open will commit using commitQueue. branchName:",n),h._commitToBranch(t,n,y,i[0],f)):l.makeCommit(y,f),y.commitObject},this.setBranchHash=function(e,n,i,o,r){var s,a=g[e];p.debug("setBranchHash",e,n,i,o),a&&a.branches[n]?(s=a.branches[n],p.debug("setBranchHash, branch is open, will notify other local users about change"),a.loadObject(i,function(t,i){var s;return t?(p.error("setBranchHash, failed to load in commitObject"),void r(t)):(p.debug("setBranchHash, loaded commitObject"),s={projectId:e,branchName:n,coreObjects:{},changedNodes:null,commitObject:i,oldHash:o},void h._commitToBranch(e,n,s,o,r))})):t.prototype.setBranchHash.call(h,e,n,i,o,r)},this._commitToBranch=function(t,n,i,o,r){var s,a=g[t],l=i.commitObject._id,c=a.branches[n],d={commitData:i,local:!0};p.debug("_commitToBranch, [oldCommitHash, localHash]",o,c.getLocalHash()),o===c.getLocalHash()?(c.updateHashes(l,null),c.queueCommit(i,r),c.inSync===!1?c.dispatchBranchStatus(e.BRANCH_STATUS.AHEAD_NOT_SYNC):c.dispatchBranchStatus(e.BRANCH_STATUS.AHEAD_SYNC),s=1===c.getCommitQueue().length,c.dispatchHashUpdate(d,function(i,o){p.debug("_commitToBranch, dispatchHashUpdate done. [err, proceed]",i,o),i?(c.dispatchBranchStatus(e.BRANCH_STATUS.ERROR,i),r(new Error("Commit failed being loaded in users: "+i))):o===!0?s?(p.debug("_commitToBranch, commit was first in queue - will start pushing commit"),h._pushNextQueuedCommit(t,n)):p.debug("_commitToBranch, commit was NOT first in queue"):r(new Error("Commit halted when loaded in users: "+i))})):(p.warn("_commitToBranch, incoming commit parent was not the same as the localHash for the branch, commit will be canceled!"),r(null,{status:e.CANCELED,hash:l}))},this._pushNextQueuedCommit=function(t,n){var i,o=g[t],r=o.branches[n];p.debug("_pushNextQueuedCommit, length=",r.getCommitQueue().length),i=r.getFirstCommit(),p.debug("_pushNextQueuedCommit, makeCommit [from# -> to#]",i.commitObject.parents[0],i.commitObject._id),l.makeCommit(i,function(i,o){var s;i&&p.error("makeCommit failed",i),r.isOpen?(r.callbackQueue[0](i,o),!i&&o?o.status===e.SYNCED?(r.inSync=!0,r.updateHashes(null,o.hash),r.getFirstCommit(!0),0===r.getCommitQueue().length?r.dispatchBranchStatus(e.BRANCH_STATUS.SYNC):(r.dispatchBranchStatus(e.BRANCH_STATUS.AHEAD_SYNC),h._pushNextQueuedCommit(t,n))):o.status===e.MERGED?(r.inSync=!0,r.updateHashes(null,o.mergeHash),1===r.getCommitQueue().length?(s=r.getMergedCommit(o.mergeHash),r.dispatchBranchStatus(e.BRANCH_STATUS.MERGING),r.dispatchHashUpdate({commitData:s,local:!1},function(t,n){if(r.getFirstCommit(!0),t)p.error("Loading of merged commit failed with error",t,{metadata:s}),r.dispatchBranchStatus(e.BRANCH_STATUS.ERROR,t);else{if(n===!0)return p.debug("Merged commit was successfully loaded, updating localHash."),r.updateHashes(o.mergeHash,null),void r.dispatchBranchStatus(e.BRANCH_STATUS.SYNC);p.warn("Loading of update commit was aborted",{metadata:o.mergeHash})}})):(r.getFirstCommit(!0),r.dispatchBranchStatus(e.BRANCH_STATUS.MERGING),h._pushNextQueuedCommit(t,n))):o.status===e.FORKED?(r.inSync=!1,r.dispatchBranchStatus(e.BRANCH_STATUS.AHEAD_NOT_SYNC)):(i=new Error("Unsupported commit status "+o.status),p.error(i),r.dispatchBranchStatus(e.BRANCH_STATUS.ERROR,i)):r.dispatchBranchStatus(e.BRANCH_STATUS.ERROR,i)):p.error("_pushNextQueuedCommit returned from server but the branch was closed, the branch has probably been closed while waiting for the response.",t,n)})},this._pullNextQueuedCommit=function(t,n,i){o(g.hasOwnProperty(t),"Project not opened: "+t);var r,s,a=g[t],l=a.branches[n];if(!l){if(r=new Error("Branch, "+n+", not in project "+t+"."),i)return void i(r);throw r}return p.debug("About to update, updateQueue",{metadata:l.getUpdateQueue()}),0===l.getUpdateQueue().length?(p.debug("No queued updates, returns"),l.dispatchBranchStatus(e.BRANCH_STATUS.SYNC),void(i&&i(null))):(s=l.getFirstUpdate(),void(l.isOpen?(l.dispatchBranchStatus(e.BRANCH_STATUS.PULLING),l.dispatchHashUpdate({commitData:s,local:!1},function(o,r){var a=s.commitObject[e.MONGO_ID];if(o)p.error("Loading of update commit failed with error",o,{metadata:s}),l.dispatchBranchStatus(e.BRANCH_STATUS.ERROR,o);else{if(r===!0)return p.debug("New commit was successfully loaded, updating localHash."),l.updateHashes(a,null),l.getFirstUpdate(!0),void(0===l.getCommitQueue().length&&h._pullNextQueuedCommit(t,n,i));p.warn("Loading of update commit was aborted",{metadata:s})}i&&i(new Error("Loading the first commit was aborted"))})):p.error("_pullNextQueuedCommit returned from server but the branch was closed.",t,n)))},this._getCommitObject=function(t,n,i,o){o=o||"n/a";var s={root:i,parents:n,updater:[h.userId],time:(new Date).getTime(),message:o,type:e.COMMIT_TYPE,__v:e.VERSION},a="#"+r(s,d);return s[e.MONGO_ID]=a,s},this._rejoinBranchRooms=function(t){function n(t,n){var i=g[t],o=a.defer();return p.debug("_rejoinBranchRooms, rejoined branch room",t,n),i?i.getBranchHash(n).then(function(r){var s,a=i.branches[n];if(p.debug("_rejoinBranchRooms received branchHash",t,n,r),!a)throw new Error("_rejoinBranchRooms branch was closed "+t+":"+n);a.getCommitQueue().length>0?(s=a.getFirstCommit().commitObject._id,p.debug("_rejoinBranchRooms, commits were queued length=, firstQueuedCommitHash",a.getCommitQueue().length,s),i.getCommonAncestorCommit(r,s).then(function(i){function l(){d={status:e.SYNCED,hash:r},a.callbackQueue[0](null,d),a.inSync=!0,a.updateHashes(null,r),a.getFirstCommit(!0),0===a.getCommitQueue().length?a.dispatchBranchStatus(e.BRANCH_STATUS.SYNC):(a.dispatchBranchStatus(e.BRANCH_STATUS.AHEAD_SYNC),h._pushNextQueuedCommit(t,n))}function c(){d={status:e.FORKED,hash:r},a.callbackQueue[0](null,d),a.inSync=!1,a.dispatchBranchStatus(e.BRANCH_STATUS.AHEAD_NOT_SYNC)}var d;if(p.debug("_rejoinBranchRooms getCommonAncestorCommit",t,n,i),a.isOpen===!1)throw new Error("_rejoinBranchRooms branch was closed "+t+":"+n);i===s?l():(i===r,c()),o.resolve()})["catch"](function(e){try{e.message.indexOf("Commit object does not exist ["+s)>-1?(p.debug("First queued commit never made it to the server - push!"),h._pushNextQueuedCommit(t,n),o.resolve()):o.reject(e)}catch(e){o.reject(e)}})):(p.debug("_rejoinBranchRooms, no commits were queued during disconnect."),o.resolve())})["catch"](function(t){o.reject(t)}):o.reject(new Error("_rejoinBranchRooms project was closed "+t+":"+n)),o.promise}var i,o,r,s=[],c=[];p.debug("_rejoinBranchRooms");for(i in g)if(g.hasOwnProperty(i)){o=g[i],p.debug("_rejoinBranchRooms found project",i);for(r in o.branches)o.branches.hasOwnProperty(r)&&(p.debug("_rejoinBranchRooms joining branch",i,r),s.push({projectId:i,branchName:r}),c.push(a.ninvoke(l,"watchBranch",{projectId:i,branchName:r,join:!0})))}return a.all(c).then(function(){return a.all(s.map(function(t){return n(t.projectId,t.branchName)}))}).nodeify(t)}}return l.prototype=Object.create(t.prototype),l.prototype.constructor=l,l}),define("common/util/url",[],function(){"use strict";function t(t){var e,n,i,o;for(t=decodeURIComponent(t),e={},n=t.split(/[;] */),i=0;i<n.length;i++)o=n[i].split("="),e[o[0]]=o[1];return e}function e(t){return{$ref:t}}return{parseCookie:t,urlToRefObject:e}}),define("common/storage/socketio/browserclient",["common/util/url"],function(t){"use strict";function e(e,n){var i=e.fork("socketio-browserclient");this.connect=function(t){var e,o=window.location.protocol+"//"+window.location.host;window.__karma__&&(o=window.location.protocol+"//localhost:"+n.server.port),e=o+"/socket.io/socket.io.js",i.debug("Will require socketIO from",e),require([e],function(e){var r,s=e||window.io;i.debug('Connecting to "'+o+'" with options',n.socketIO.clientOptions),r=s.connect(o,n.socketIO.clientOptions),t(null,r)})},this.getToken=function(){var e=t.parseCookie(document.cookie);return e[n.authentication.jwt.cookieId]?e[n.authentication.jwt.cookieId]:void 0}}return e}),define("common/EventDispatcher",[],function(){"use strict";var t=function(){this._eventList={}};return t.prototype={_eventList:null,_getEvent:function(t,e){if(!this._eventList[t]){if(!e)return null;this._eventList[t]=[]}return this._eventList[t]},addEventListener:function(t,e){var n=this._getEvent(t,!0);n.push(e)},removeEventListener:function(t,e){var n=this._getEvent(t);if(n){var i=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},o=i(n,e);o>-1&&n.splice(o,1)}},removeAllEventListeners:function(t){var e=this._getEvent(t);e&&e.splice(0,e.length)},dispatchEvent:function(t,e){var n=this._getEventHandler(t);n&&n(this,e)},clearAllEvents:function(){this._eventList={}},_getEventHandler:function(t){var e=this._getEvent(t,!1);if(!e||0===e.length)return null;var n=function(t,n){for(var i=0;i<e.length;i++)e[i](t,n)};return n}},t}),define("common/storage/socketio/websocket",["common/EventDispatcher","common/storage/constants"],function(t,e){"use strict";function n(n,i,o){function r(t){return function(){"string"==typeof arguments[0]?t(new Error(arguments[0]),arguments[1]):t.apply(null,arguments)}}var s,a=this,l=i.fork("WebSocket"),c=!1;a.socket=null,a.userId=null,a.serverVersion=null,l.debug("ctor"),t.call(this),this.connect=function(t){l.debug("Connecting via ioClient."),s=!1,n.connect(function(i,r){return i?void t(i):(a.socket=r,a.socket.on("connect",function(){var i,r=[];if(c){for(l.debug("Socket got reconnected."),i=0;i<a.socket.sendBuffer.length;i+=1)"makeCommit"===a.socket.sendBuffer[i].data[0]?l.debug("Removed makeCommit from sendBuffer..."):r.push(a.socket.sendBuffer[i]);a.socket.receiveBuffer.length>0&&l.debug("receiveBuffer not empty after reconnect"),a.socket.sendBuffer=r,a.socket.emit("getConnectionInfo",{webgmeToken:n.getToken()},function(n,i){n?t(new Error("Could not get info on reconnect")):a.serverVersion===i.serverVersion?t(null,e.RECONNECTED):t(null,e.INCOMPATIBLE_CONNECTION)})}else l.debug("Socket got connected for the first time."),c=!0,a.socket.emit("getConnectionInfo",{webgmeToken:n.getToken()},function(n,i){n?t(new Error("Could not get info on connect")):(a.userId=i.userId||o.authentication.guestAccount,a.serverVersion=i.serverVersion,t(null,e.CONNECTED))})}),a.socket.on("disconnect",function(){l.debug("Socket got disconnected!"),t(null,e.DISCONNECTED),a.socket.io.skipReconnect===!0&&s===!1&&a.connect(t)}),a.socket.on(e.JWT_ABOUT_TO_EXPIRE,function(n){n.etype=e.JWT_ABOUT_TO_EXPIRE,l.debug("JWT_ABOUT_TO_EXPIRE event",{metadata:n}),t(null,e.JWT_ABOUT_TO_EXPIRE)}),a.socket.on(e.JWT_EXPIRED,function(n){n.etype=e.JWT_EXPIRED,l.debug("JWT_EXPIRED event",{metadata:n}),t(null,e.JWT_EXPIRED)}),a.socket.on(e.PROJECT_DELETED,function(t){t.etype=e.PROJECT_DELETED,l.debug("PROJECT_DELETED event",{metadata:t}),a.dispatchEvent(e.PROJECT_DELETED,t)}),a.socket.on(e.PROJECT_CREATED,function(t){t.etype=e.PROJECT_CREATED,l.debug("PROJECT_CREATED event",{metadata:t}),a.dispatchEvent(e.PROJECT_CREATED,t)}),a.socket.on(e.BRANCH_CREATED,function(t){t.etype=e.BRANCH_CREATED,l.debug("BRANCH_CREATED event",{metadata:t}),a.dispatchEvent(e.BRANCH_CREATED+t.projectId,t)}),a.socket.on(e.BRANCH_DELETED,function(t){t.etype=e.BRANCH_DELETED,l.debug("BRANCH_DELETED event",{metadata:t}),a.dispatchEvent(e.BRANCH_DELETED+t.projectId,t)}),a.socket.on(e.BRANCH_HASH_UPDATED,function(t){t.etype=e.BRANCH_HASH_UPDATED,l.debug("BRANCH_HASH_UPDATED event",{metadata:t}),a.dispatchEvent(e.BRANCH_HASH_UPDATED+t.projectId,t)}),a.socket.on(e.TAG_CREATED,function(t){t.etype=e.TAG_CREATED,l.debug("TAG_CREATED event",{metadata:t}),a.dispatchEvent(e.TAG_CREATED+t.projectId,t)}),a.socket.on(e.TAG_DELETED,function(t){t.etype=e.TAG_DELETED,l.debug("TAG_DELETED event",{metadata:t}),a.dispatchEvent(e.TAG_DELETED+t.projectId,t)}),a.socket.on(e.BRANCH_UPDATED,function(t){l.debug("BRANCH_UPDATED event",{metadata:t}),a.dispatchEvent(a.getBranchUpdateEventName(t.projectId,t.branchName),t)}),void a.socket.on(e.NOTIFICATION,function(t){l.debug("NOTIFICATION event",{metadata:t}),a.dispatchEvent(e.NOTIFICATION,t)}))})},this.disconnect=function(){s=!0,a.socket.disconnect(),c=!1},this.watchDatabase=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("watchDatabase",t,r(e))},this.watchProject=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("watchProject",t,r(e))},this.watchBranch=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("watchBranch",t,r(e))},this.openProject=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("openProject",t,r(e))},this.closeProject=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("closeProject",t,r(e))},this.openBranch=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("openBranch",t,r(e))},this.closeBranch=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("closeBranch",t,r(e))},this.makeCommit=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("makeCommit",t,r(e))},this.loadObjects=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("loadObjects",t,r(e))},this.loadPaths=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("loadPaths",t,r(e))},this.setBranchHash=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("setBranchHash",t,r(e))},this.getBranchHash=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("getBranchHash",t,r(e))},this.squashCommits=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("squashCommits",t,r(e))},this.getProjects=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("getProjects",t,r(e))},this.deleteProject=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("deleteProject",t,r(e))},this.createProject=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("createProject",t,r(e))},this.transferProject=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("transferProject",t,r(e))},this.duplicateProject=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("duplicateProject",t,r(e))},this.getBranches=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("getBranches",t,r(e))},this.createTag=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("createTag",t,r(e))},this.deleteTag=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("deleteTag",t,r(e))},this.getTags=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("getTags",t,r(e))},this.getCommits=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("getCommits",t,r(e))},this.getHistory=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("getHistory",t,r(e))},this.getLatestCommitData=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("getLatestCommitData",t,r(e))},this.getCommonAncestorCommit=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("getCommonAncestorCommit",t,r(e))},this.simpleRequest=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("simpleRequest",t,r(e))},this.simpleQuery=function(t,e,i){e.webgmeToken=n.getToken(),a.socket.emit("simpleQuery",t,e,r(i))},this.sendNotification=function(t,e){t.webgmeToken=n.getToken(),a.socket.emit("notification",t,r(e))},this.getBranchUpdateEventName=function(t,n){return e.BRANCH_UPDATED+t+e.ROOM_DIVIDER+n}}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n}),define("common/storage/browserstorage",["common/storage/storageclasses/editorstorage","common/storage/socketio/browserclient","common/storage/socketio/websocket"],function(t,e,n){"use strict";function i(i,o){var r=new e(i,o),s=new n(r,i,o),a=new t(s,i,o);return a}function o(t,e,n){return t.debug("getStorage"),r?(t.debug("Storage existed..."),n===!0&&(t.debug("Force new set to true, will create new one."),r=i(t,e))):(t.debug("No storage existed, will create new one.."),r=i(t,e)),r}var r;return{getStorage:o}}),define("common/core/CoreInternalError",[],function(){
"use strict";function t(){var t=Error.apply(this,arguments);return t.name=this.name="CoreInternalError",this.message=t.message,this.stack=t.stack,t}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}),define("common/core/CoreAssert",["common/core/CoreInternalError"],function(t){"use strict";var e=function(e,n){if(!e){var i=new t(n||"ASSERT failed");throw"undefined"==typeof TESTING&&(console.log("Throwing",i.stack),console.log()),i}};return e}),function(){"use strict";function t(t){m=t}function e(t){if(!t)throw new Error("tasync internal error")}function n(t,e){if(0>t)return e;var n=new v;return setTimeout(function(){n.resolve(e)},t),n}function i(t){e("string"==typeof t);var n=t.indexOf("tasync_trace_start");n>=0?n=t.lastIndexOf("\n",n)+1:("\n"!==t.charAt(t.length-1),n=void 0);var i=t.indexOf("tasync_trace_end");return i>=0?(i=t.indexOf("\n",i)+1,i>=0&&(i=t.indexOf("\n",i)+1)):i=0,t.substring(i,n)}function o(t,e){if(t instanceof Error||(t=new Error(t)),m){t.trace=i(t.stack);do t.trace+="*** callback ***\n",t.trace+=i(e.trace.stack),e=e.caller;while(e!==D)}return t}function r(t){v.call(this),this.handler=t}function s(t,e){if("function"!=typeof t||"function"!=typeof e)throw new Error("function arguments are expected");try{var n=t();if(n instanceof v){var i=new r(e);return n.register(i),i}return n}catch(o){return e(o)}}function a(t){if("function"!=typeof t)throw new Error("function argument is expected");return void 0===t.tasync_wraped&&(t.tasync_wraped=function(){var n=arguments,i=new v;if(n[n.length++]=function(t,e){t?i.reject(t instanceof Error?t:new Error(t)):i.resolve(e)},t.apply(this,n),i.state===_)return i;if(i.state===y)return i.value;throw e(i.state===b),i.value},t.tasync_wraped.tasync_unwraped=t),t.tasync_wraped}function l(t){this.callback=t}function c(t){if("function"!=typeof t)throw new Error("function argument is expected");return void 0===t.tasync_unwraped&&(t.tasync_unwraped=function(){var n=arguments,i=n[--n.length];e("function"==typeof i);var o;try{o=t.apply(this,n)}catch(r){return void i(r)}if(o instanceof v){e(o.state===_);var s=new l(i);o.register(s)}else i(null,o)},t.tasync_unwraped.tasync_wraped=t),t.tasync_unwraped}function d(t,e,n){v.call(this),this.func=t,this.that=e,this.args=n,this.caller=I,this.position=++I.subframes,this.path=this.getPath()}function h(t){this.running=0,this.limit=t,this.queue=[]}function p(t,n){for(var i=0,o=t.length;o>i;){var r=Math.floor((i+o)/2);e(r>=i&&o>r),n.compare(t[r])<0?i=r+1:o=r}t.splice(i,0,n)}function g(t,e){if("function"!=typeof t)throw new Error("function argument is expected");if("number"!=typeof e)throw new Error("number argument is expected");var n=new h(e);return function(){return n.execute(t,this,arguments)}}function u(t){v.call(this),this.first=t,this.missing=t instanceof v&&t.state===_?1:0}function f(t,e){return t instanceof v&&t.state===b?t:e instanceof v?e.state===y?t:e.state===b?e:(t instanceof u||(t=new u(t)),t.missing+=1,e.register(t),t):t}var m=!0,_=0,b=1,y=2,v=function(){this.state=_,this.value=[]};v.prototype.register=function(t){e(this.state===_),e("object"==typeof t&&null!==t),this.value.push(t)},v.prototype.resolve=function(t){e(this.state===_&&!(t instanceof v));var n=this.value;this.state=y,this.value=t;var i;for(i=0;i<n.length;++i)n[i].onResolved(t)},v.prototype.reject=function(t){e(this.state===_&&t instanceof Error);var n=this.value;this.state=b,this.value=t;var i;for(i=0;i<n.length;++i)n[i].onRejected(t)};var C=function(t,e){v.call(this),this.array=t,this.index=e};C.prototype=Object.create(v.prototype),C.prototype.onResolved=function(t){e(this.state===_);var n=this.array;for(n[this.index]=t;++this.index<n.length;)if(t=n[this.index],t instanceof v){if(t.state!==y)return t.state===_?void t.register(this):(e(t.state===b),void this.reject(t.value));n[this.index]=t.value}this.array=null,this.resolve(n)},C.prototype.onRejected=function(t){this.array=null,this.reject(t)};var E=function(t){if(!(t instanceof Array))throw new Error("array argument is expected");var n;for(n=0;n<t.length;++n){var i=t[n];if(i instanceof v){if(i.state!==y){if(i.state===_){var o=new C(t,n);return i.register(o),o}return e(i.state===b),i}t[n]=i.value}}return t},D={subframes:0},I=D,P=function(t,e,n,i){v.call(this),this.caller=I,this.position=++I.subframes,this.subframes=0,m&&(this.trace=new Error),this.func=t,this.that=e,this.args=n,this.index=i};P.prototype=Object.create(v.prototype),P.prototype.getPath=function(){for(var t=this.caller,e=[this.position];t!==D;)e.push(t.position),t=t.caller;return e},P.prototype.onRejected=function(t){this.args=null,this.reject(t)},P.prototype.onResolved=function(t){e(this.state===_);var n=this.args;for(n[this.index]=t;--this.index>=0;)if(t=n[this.index],t instanceof v){if(t.state!==y)return t.state===_?void t.register(this):(e(t.state===b),void this.reject(t.value));n[this.index]=t.value}e(I===D),I=this,this.args=null;try{t=this.func.apply(this.that,n)}catch(i){return I=D,void this.reject(o(i,this))}I=D,t instanceof v?(e(t.state===_),this.onResolved=this.resolve,t.register(this)):this.resolve(t)};var T=function(t,n,i){if("function"!=typeof t)throw new Error("function argument is expected");if(!(n instanceof Array))throw new Error("array argument is expected");for(var o=n.length;--o>=0;){var r=n[o];if(r instanceof v){if(r.state===_){var s=new P(t,i,n,o);return r.register(s),s}if(r.state!==y)return e(r.state===b),r;n[o]=r.value}}return t.apply(i,n)},A=function(t,e){v.call(this),this.caller=I,this.position=++I.subframes,this.subframes=0,m&&(this.trace=new Error),this.args=t,this.index=e};A.prototype=Object.create(v.prototype),A.prototype.getPath=P.prototype.getPath,A.prototype.onRejected=P.prototype.onRejected;var x=Function.call;A.prototype.onResolved=function(t){e(this.state===_);var n=this.args;for(n[this.index]=t;--this.index>=0;)if(t=n[this.index],t instanceof v){if(t.state!==y)return t.state===_?void t.register(this):(e(t.state===b),void this.reject(t.value));n[this.index]=t.value}e(I===D),I=this,this.args=null;try{var i=n[0];n[0]=null,t=x.apply(i,n)}catch(r){return I=D,void this.reject(o(r,this))}I=D,t instanceof v?(e(t.state===_),this.onResolved=this.resolve,t.register(this)):this.resolve(t)};var w=function(){for(var t=arguments.length;--t>=0;){var n=arguments[t];if(n instanceof v){if(n.state===_){var i=new A(arguments,t);return n.register(i),i}if(n.state!==y)return e(n.state===b),n;arguments[t]=n.value}}var o=arguments[0];return x.apply(o,arguments)};r.prototype=Object.create(v.prototype),r.prototype.onRejected=function(t){try{var e=this.handler(t);e instanceof v?(this.onRejected=v.prorotype.reject,e.register(this)):this.resolve(e)}catch(n){this.reject(n)}},r.prototype.onResolved=v.prototype.resolve,l.prototype.onRejected=function(t){this.callback(t)},l.prototype.onResolved=function(t){this.callback(null,t)},d.prototype=Object.create(v.prototype),d.prototype.execute=function(){var t;try{e(I===D),I=this,t=this.func.apply(this.that,this.args),I=D}catch(n){return I=D,void this.reject(n)}t instanceof v?(e(t.state===_),t.register(this)):this.resolve(t)},d.prototype.getPath=P.prototype.getPath,d.prototype.onResolved=v.prototype.resolve,d.prototype.onRejected=v.prototype.reject,d.prototype.compare=function(t){var e=this.path;t=t.path;var n,i=e.length<t.length?e.length:t.length;for(n=0;i>n;++n)if(e[n]!==t[n])return e[n]-t[n];return e.length-t.length},h.prototype.execute=function(t,n,i){if(this.running<this.limit){var o=t.apply(n,i);return o instanceof v&&(e(o.state===_),++this.running,o.register(this)),o}var r=new d(t,n,i);return p(this.queue,r),r},h.prototype.onResolved=function(){if(this.queue.length>0){var t=this.queue.pop();t.register(this),t.execute()}else--this.running},h.prototype.onRejected=h.prototype.onResolved,u.prototype=Object.create(v.prototype),u.prototype.onResolved=function(){0===--this.missing&&(e(this.state!==y),this.state===_&&(this.first instanceof v?(e(this.first.state===y),this.resolve(this.first.value)):this.resolve(this.first)))},u.prototype.onRejected=function(t){this.state===_&&this.reject(t)};var N={setTrace:t,delay:n,lift:E,apply:T,call:w,trycatch:s,wrap:a,unwrap:c,throttle:g,join:f};"function"==typeof define&&define.amd?define("common/core/tasync",[],function(){return N}):module.exports=N}(),define("common/core/corerel",["common/core/CoreAssert","common/core/tasync","common/util/random","common/core/constants"],function(t,e,n,i){"use strict";function o(t,e){var n=this;t=t||1e4,this._backup={},this._cache={},this._size=0,this.getItem=function(t){return n._cache[t]?n._cache[t]:n._backup[t]?n._backup[t]:null},this.setItem=function(i,o){n._cache[i]?e.warn("trying to add inverse relation object multiple times [#"+i+"]"):(n._size===t&&(n._size=0,n._backup=n._cache,n._cache={}),n._size+=1,n._cache[i]=o)}}function r(r,s){function a(t,e){if(!e)throw new Error(t)}function l(t){return t=r.normalize(t),"object"==typeof t.data&&null!==t.data}function c(t){a("coretree",r.isValidNode(t)),a("isobject",l(t))}function d(e,n,o){t(u.isValidNode(e)&&"string"==typeof n&&"string"==typeof o);var s,a;do{if(a=(r.getProperty(e,i.OVERLAYS_PROPERTY)||{})[n],a&&(s=a[o],void 0!==s))break;n="/"+r.getRelid(e)+n,e=r.getParent(e)}while(e);return{target:s,node:e}}function h(t){var e,n=u.getHash(t);if(n&&t.inverseOverlays){u._inverseCache.setItem(n,t.inverseOverlays),delete t.inverseOverlaysMutable;for(e in t.children)h(t.children[e])}}t("object"==typeof s),t("object"==typeof s.globConf),t("object"==typeof r);var p,g=r.logger,u=this;for(p in r)this[p]=r[p];this._inverseCache=new o(s.globConf.core.inverseRelationsCacheSize,g.fork("inverseCache")),g.debug("initialized CoreRel"),this.isValidNode=function(t){try{return c(t),!0}catch(e){return g.error(e.message,{metadata:{stack:e.stack,node:t}}),!1}},this.persist=function(t){var e=r.persist(t);return h(u.getRoot(t)),e},this.getInverseOverlayOfNode=function(t){var e,n,o,r,s,a={};if(t.inverseOverlays)return t.inverseOverlays;if(e=u.getHash(t),e&&(a=u._inverseCache.getItem(e)))return t.inverseOverlays=a,delete t.inverseOverlaysMutable,t.inverseOverlays;n=u.getProperty(t,i.OVERLAYS_PROPERTY),n=n||{},a={};for(o in n)for(r in n[o])s=n[o][r],a[s]=a[s]||{},a[s][r]=a[s][r]||[],a[s][r].push(o);return e?(u._inverseCache.setItem(e,a),delete t.inverseOverlaysMutable):t.inverseOverlaysMutable=!0,t.inverseOverlays=a,t.inverseOverlays},this.isPointerName=function(e){return t("string"==typeof e),e===i.MUTABLE_PROPERTY?!1:!0},this.getAttributeNames=function(e){t(u.isValidNode(e));var n,o,s,a,l=[];for(n=r.getProperty(e,i.ATTRIBUTES_PROPERTY)||{},o=Object.keys(n),s=o.length;--s>=0;)a=o[s],""===a.charAt(0)?g.error("empty named attribute found in node ["+r.getPath(e)+"]"):"_"===a.charAt(0)||l.push(a);return l},this.getRegistryNames=function(e){t(u.isValidNode(e));var n,o,s,a,l=[];for(n=r.getProperty(e,i.REGISTRY_PROPERTY)||{},o=Object.keys(n),s=o.length;--s>=0;)a=o[s],""===o[s].charAt(0)?g.error("empty named attribute found in node ["+r.getPath(e)+"]"):"_"===o[s].charAt(0)||l.push(a);return l},this.getAttribute=function(t,e){return(r.getProperty(t,i.ATTRIBUTES_PROPERTY)||{})[e]},this.delAttribute=function(t,e){t=r.getChild(t,i.ATTRIBUTES_PROPERTY),r.deleteProperty(t,e)},this.setAttribute=function(t,e,n){t=r.getChild(t,i.ATTRIBUTES_PROPERTY),r.setProperty(t,e,n)},this.getRegistry=function(t,e){return(r.getProperty(t,i.REGISTRY_PROPERTY)||{})[e]},this.delRegistry=function(t,e){t=r.getChild(t,i.REGISTRY_PROPERTY),r.deleteProperty(t,e)},this.setRegistry=function(t,e,n){t=r.getChild(t,i.REGISTRY_PROPERTY),r.setProperty(t,e,n)},this.overlayRemove=function(e,n,o,s){t(u.isValidNode(e)),t(r.isValidPath(n)&&r.isValidPath(s)&&u.isPointerName(o)),t(""===r.getCommonPathPrefixData(n,s).common);var a,l,c=u.getChild(e,i.OVERLAYS_PROPERTY);a=r.getChild(c,n),t(a&&r.getProperty(a,o)===s),r.deleteProperty(a,o),0===r.getKeys(a).length&&r.deleteProperty(c,n),e.inverseOverlays&&(e.inverseOverlaysMutable!==!0&&(e.inverseOverlays=JSON.parse(JSON.stringify(e.inverseOverlays)),e.inverseOverlaysMutable=!0),l=e.inverseOverlays[s][o].indexOf(n),-1!==l&&(e.inverseOverlays[s][o].splice(l,1),0===e.inverseOverlays[s][o].length&&(delete e.inverseOverlays[s][o],0===Object.keys(e.inverseOverlays[s]).length&&delete e.inverseOverlays[s])))},this.overlayQuery=function(e,n){t(u.isValidNode(e)&&r.isValidPath(n));var o,s,a,l=u.getProperty(e,i.OVERLAYS_PROPERTY)||{},c=u.getInverseOverlayOfNode(e),d=[],h=n+i.PATH_SEP;for(s in l)if(s===n||s.substr(0,h.length)===h)for(a in l[s])u.isPointerName(a)&&d.push({s:s,n:a,t:l[s][a],p:!0});for(s in c)if(s===n||s.substr(0,h.length)===h)for(a in c[s])for(o=0;o<c[s][a].length;o+=1)d.push({s:c[s][a][o],n:a,t:s,p:!1});return d},this.overlayInsert=function(e,n,o,s){t(u.isValidNode(e)),t(r.isValidPath(n)&&r.isValidPath(s)&&u.isPointerName(o)),t(""===r.getCommonPathPrefixData(n,s).common);var a=u.getChild(e,i.OVERLAYS_PROPERTY),l=u.getChild(a,n);t(void 0===u.getProperty(l,o)),u.setProperty(l,o,s),e.inverseOverlays&&(e.inverseOverlaysMutable!==!0&&(e.inverseOverlays=JSON.parse(JSON.stringify(e.inverseOverlays)),e.inverseOverlaysMutable=!0),e.inverseOverlays[s]=e.inverseOverlays[s]||{},e.inverseOverlays[s][o]=e.inverseOverlays[s][o]||[],e.inverseOverlays[s][o].push(n))},this.createNode=function(e,n,i){e=e||{};var o=e.relid,s=e.parent;t(!s||u.isValidNode(s));var a;if(s){if(o){if(n&&n[o]||u.getChildrenRelids(s).indexOf(o)>-1)throw new Error('Given relid already used in parent "'+o+'".');a=r.getChild(s,o),s.childrenRelids=null}else a=u.createChild(s,n,i);r.setHashed(a,!0)}else a=r.createRoot();return a.inverseOverlays={},a.inverseOverlayMutable=!0,a},this.deleteNode=function(e){t(u.isValidNode(e));var n=r.getParent(e);t(null!==n),u.deleteChild(n,r.getRelid(e))},this.deleteChild=function(t,e){var n="/"+e;for(r.deleteProperty(t,e),t.childrenRelids&&(t.childrenRelids=null);t;){for(var o=u.overlayQuery(t,n),s=0;s<o.length;++s){var a=o[s];u.overlayRemove(t,a.s,a.n,a.t)}n=i.PATH_SEP+r.getRelid(t)+n,t=r.getParent(t)}},this.createChild=function(t,e,n){var i=r.createChild(t,e,n);return t.childrenRelids=null,i},this.copyNode=function(e,n,i,o){t(u.isValidNode(e)),t(!n||u.isValidNode(n));var s,a,l,c,d,h,p,g,f,m,_,b,y,v;if(e=r.normalize(e),n){if(a=r.getAncestor(e,n),a===e)return null;for(s=u.createChild(n,i,o),r.setHashed(s,!0),r.setData(s,r.copyData(e)),l=r.getPath(s,a),d=r.getParent(e),h="/"+r.getRelid(e),p=1;d;){for(g=u.overlayQuery(d,h),f=r.getAncestor(d,a),p=d===a?0:f===d?1:-1,b=0>p?r.getPath(d,a):r.getPath(a,d),m=0;m<g.length;++m)if(_=g[m],_.p){if(t(_.s.substr(0,h.length)===h),t(_.s===h||"/"===_.s.charAt(h.length)),0>p)y=l+_.s.substr(h.length),v=r.joinPaths(b,_.t),c=a;else if(0===p){var C=r.getCommonPathPrefixData(l,_.t);for(c=s;C.firstLength-->0;)c=r.getParent(c);y=r.joinPaths(C.first,_.s.substr(h.length)),v=C.second}else t(_.s.substr(0,h.length)===h),y=b+l+_.s.substr(h.length),v=_.t,c=d;u.overlayInsert(c,y,_.n,v)}h="/"+r.getRelid(d)+h,d=r.getParent(d)}}else s=r.createRoot(),r.setData(s,r.copyData(e));return e.inverseOverlaysMutable?s.inverseOverlays=JSON.parse(JSON.stringify(e.inverseOverlays)):s.inverseOverlays=e.inverseOverlays,s.inverseOverlaysMutable=e.inverseOverlaysMutable,s},this.copyNodes=function(t,e,n,i){var o,s,a,l,c,d,h=[],p=[],g=[];for(o=0;o<t.length;o++)h.push(r.getPath(t[o]));for(o=0;o<t.length;o++){for(l=u.getPointerNames(t[o]),c={},s=0;s<l.length;s++)a=h.indexOf(u.getPointerPath(t[o],l[s])),-1!==a&&(c[l[s]]=a);g.push(c)}for(o=0;o<t.length;o++)d=u.copyNode(t[o],e,n,i),p.push(d),n&&(n[u.getRelid(d)]=!0);for(o=0;o<g.length;o++)for(l=Object.keys(g[o]),s=0;s<l.length;s++)u.setPointer(p[o],l[s],p[g[o][l[s]]]);return p},this.moveNode=function(e,n,i,o){t(u.isValidNode(e)&&u.isValidNode(n));var s,a,l,c,d,h,p,g,f,m,_,b,y,v;if(e=r.normalize(e),s=r.getAncestor(e,n),s===e)return null;a=r.getParent(e),l="/"+r.getRelid(e),c=1;var C=e;for(i?e=i[r.getRelid(C)]?r.createChild(n,i,o):r.getChild(n,r.getRelid(C)):(e=r.getChild(n,r.getRelid(C)),r.isEmpty(e)||(e=r.createChild(n))),n.childrenRelids=null,r.setHashed(e,!0),r.setData(e,r.copyData(C)),d=r.getPath(e,s);a;){for(h=u.overlayQuery(a,l),p=r.getAncestor(a,s),c=a===s?0:p===a?1:-1,g=0>c?r.getPath(a,s):r.getPath(s,a),f=0;f<h.length;++f){if(y=h[f],u.overlayRemove(a,y.s,y.n,y.t),y.p||(v=y.s,y.s=y.t,y.t=v),t(y.s.substr(0,l.length)===l),t(y.s===l||"/"===y.s.charAt(l.length)),0>c)m=d+y.s.substr(l.length),_=r.joinPaths(g,y.t),b=s;else if(0===c){var E=r.getCommonPathPrefixData(d,y.t);for(b=e;E.firstLength-->0;)b=r.getParent(b);m=r.joinPaths(E.first,y.s.substr(l.length)),_=E.second}else t(y.s.substr(0,l.length)===l),m=g+d+y.s.substr(l.length),_=y.t,b=a;y.p||(v=y.s,y.s=y.t,y.t=v,v=m,m=_,_=v),u.overlayInsert(b,m,y.n,_)}l="/"+r.getRelid(a)+l,a=r.getParent(a)}return u.deleteNode(C),e},this.getChildrenRelids=function(e){return t(u.isValidNode(e)),e.childrenRelids||(e.childrenRelids=r.getKeys(e,u.isValidRelid)),e.childrenRelids},this.getChildrenPaths=function(t){var e,n=r.getPath(t),i=u.getChildrenRelids(t),o=[];for(e=0;e<i.length;e+=1)o.push(n+"/"+i[e]);return o},this.loadChildren=function(t){var n,i=u.getChildrenRelids(t),o=[];for(n=0;n<i.length;n+=1)o.push(r.loadChild(t,i[n]));return e.lift(o)},this.getPointerNames=function(t){return u.getPointerNamesFrom(t,"")},this.getPointerNamesFrom=function(e,n){t(u.isValidNode(e));var o=[];do{var s=(r.getProperty(e,i.OVERLAYS_PROPERTY)||{})[n];if(s)for(var a in s)t(-1===o.indexOf(a)),u.isPointerName(a)&&o.push(a);n="/"+r.getRelid(e)+n,e=r.getParent(e)}while(e);return o},this.getPointerPath=function(t,e){return u.getPointerPathFrom(t,"",e)},this.getPointerPathFrom=function(t,e,n){var i,o=d(t,e,n);return void 0!==o.target&&(i=r.joinPaths(r.getPath(o.node),o.target)),i},this.loadPointer=function(t,e){var n=d(t,"",e);return void 0!==n.target?r.loadByPath(n.node,n.target):null},this.getCollectionNames=function(e){t(u.isValidNode(e));var n,o,r=[],s="";do{if(o=u.getInverseOverlayOfNode(e),o[s])for(n in o[s])-1===r.indexOf(n)&&r.push(n);s=i.PATH_SEP+u.getRelid(e)+s,e=u.getParent(e)}while(e);return r},this.loadCollection=function(n,o){t(u.isValidNode(n)&&u.isPointerName(o));var r,s,a=[],l="";do{if(s=u.getInverseOverlayOfNode(n),s[l]&&s[l][o])for(r=0;r<s[l][o].length;r+=1)a.push(u.loadByPath(n,s[l][o][r]));l=i.PATH_SEP+u.getRelid(n)+l,n=u.getParent(n)}while(n);return e.lift(a)},this.getCollectionPaths=function(e,n){t(u.isValidNode(e)&&u.isPointerName(n));var o,r,s=[],a="",l="";do{if(o=u.getInverseOverlayOfNode(e),o[a]&&o[a][n])for(l=u.getPath(e),r=0;r<o[a][n].length;r+=1)s.push(l+o[a][n][r]);a=i.PATH_SEP+u.getRelid(e)+a,e=u.getParent(e)}while(e);return s},this.deletePointer=function(e,n){t(u.isValidNode(e)&&"string"==typeof n);var o,r="";do o=u.getProperty(e,i.OVERLAYS_PROPERTY),o&&o[r]&&"string"==typeof o[r][n]&&u.overlayRemove(e,r,n,o[r][n]),r=i.PATH_SEP+u.getRelid(e)+r,e=u.getParent(e);while(e);return!1},this.setPointer=function(e,n,i){t(u.isValidNode(e)&&"string"==typeof n&&(!i||u.isValidNode(i)));var o,s,a;u.deletePointer(e,n),i&&(o=r.getAncestor(e,i),a=r.getPath(e,o),s=r.getPath(i,o),u.overlayInsert(o,a,n,s))},this.getChildrenHashes=function(t){var e,n=u.getChildrenRelids(t),i={};for(e=0;e<n.length;e++)i[n[e]]=r.getChildHash(t,n[e]);return i},this.isValidRelid=n.isValidRelid,this.isContainerPath=function(t,e){var n,i=(t||"").split("/"),o=(e||"").split("/");for(n=0;n<o.length;n+=1)if(o[n]!==i[n])return!1;return!0}}return r}),define("common/core/setcore",["common/core/CoreAssert","common/core/constants"],function(t,e){"use strict";function n(n,i){function o(t){n.setRegistry(t,e.SET_MODIFIED_REGISTRY,(n.getRegistry(t,e.SET_MODIFIED_REGISTRY)||0)+1)}function r(t,i){return n.getChild(n.getChild(t,e.ALL_SETS_PROPERTY),i)}function s(i,o){t("string"==typeof o);var r=n.getProperty(i,e.ALL_SETS_PROPERTY);return r&&r[o]}function a(t,i,o){var r,a,l;if(r=s(t,i))for(a=T.getRawKeys(r,T.isValidRelid),l=0;l<a.length;l+=1)if(n.getPointerPathFrom(t,"/"+e.ALL_SETS_PROPERTY+"/"+i+"/"+a[l],e.MEMBER_RELATION)===o)return a[l];return null}function l(t,e,n){var i=null;do{if(i=a(t,e,n))return i;t=T.getBase(t)}while(t);return i}function c(t,e,i){var o=l(t,e,i);return"string"==typeof o&&n.getChild(r(t,e),o)}function d(t,e,i){var o=a(t,e,i);return"string"==typeof o&&n.getChild(r(t,e),o)}function h(t){var n,i,o,r=[];if(n=T.getProperty(t,e.ALL_SETS_PROPERTY),n&&n[e.OVERLAYS_PROPERTY]&&n[e.OVERLAYS_PROPERTY][""])for(i=Object.keys(n[e.OVERLAYS_PROPERTY][""]),o=0;o<i.length;o+=1)i[o]!==e.MUTABLE_PROPERTY&&-1===r.indexOf(i[o])&&r.push(i[o]);return r}function p(t){var e,n,i=[];do{for(e=h(t),n=0;n<e.length;n+=1)-1===i.indexOf(e[n])&&i.push(e[n]);t=T.getBase(t)}while(t);return i}function g(n,i){t("string"==typeof i);var o=T.getProperty(n,e.ALL_SETS_PROPERTY);return o&&o[e.OVERLAYS_PROPERTY]&&o[e.OVERLAYS_PROPERTY][""]&&o[e.OVERLAYS_PROPERTY][""][i]?!0:!1}function u(t,e){do{if(g(t,e))return!0;t=T.getBase(t)}while(t);return!1}function f(t,e){var n,i,o,r=[];do{if(n=s(t,e))for(i=T.getRawKeys(n,T.isValidRelid),o=0;o<i.length;o+=1)-1===r.indexOf(i[o])&&r.push(i[o]);t=T.getBase(t)}while(t);return r}function m(t){var e=T.getPath(t);return e.substring(0,e.indexOf("/_"))}function _(t,i,o){var r,s,a="/"+e.ALL_SETS_PROPERTY+"/"+i+"/"+o;do{if(s=n.getPointerPathFrom(t,a,e.MEMBER_RELATION),void 0!==s&&(r=s,r!==m(t)))break;t=T.getBase(t)}while(t);return r}function b(t,e,n,i){var o,r,a=s(t,n);return a&&("string"==typeof i?(r=l(t,n,i),o=r&&a[r]&&a[r][e]):o=a[e]),o}function y(t,e,i,o){var r=b(t,e,i,o);return r?n.getRawKeys(r):[]}function v(t,e,n,i){var o,r,s=[];do{for(o=y(t,e,n,i),r=0;r<o.length;r+=1)-1===s.indexOf(o[r])&&s.push(o[r]);t=T.getBase(t)}while(t);return s}function C(t,e,n,i,o){var r=b(t,e,i,o);return r?r[n]:void 0}function E(t,e,n,i,o){var r;do{if(r=C(t,e,n,i,o),void 0!==r)return r;t=T.getBase(t)}while(t);return void 0}function D(t,i){var o=n.getChild(t,e.ALL_SETS_PROPERTY);void 0===n.getOwnPointerPath(o,i)&&T.createSet(t,i)}t("object"==typeof i),t("object"==typeof i.globConf),t("undefined"!=typeof i.logger);var I,P=i.logger,T=this;for(I in n)this[I]=n[I];P.debug("initialized SetCore"),this.getCollectionNames=function(t){var i,o=n.getCollectionNames(t);for(i=0;i<o.length;i++)if(o[i]===e.MEMBER_RELATION){o.splice(i,1);break}return o},this.getSetNames=function(t){return p(t)},this.getOwnSetNames=function(t){return h(t)},this.createSet=function(t,i){var s=r(t,i);n.setPointer(n.getChild(t,e.ALL_SETS_PROPERTY),i,null),n.setRegistry(s,"_","_"),o(t)},this.deleteSet=function(t,i){var o=n.getChild(t,e.ALL_SETS_PROPERTY),r=n.getChild(o,i);n.deletePointer(o,i),n.deleteNode(r,!0)},this.isMemberOf=function(t){for(var n=T.getCollectionPaths(t,e.MEMBER_RELATION),i={},o=0;o<n.length;o++){var r=n[o].split("/");if(-1===r.indexOf(e.META_NODE)){var s=r.indexOf(e.ALL_SETS_PROPERTY);if(s>0&&r.length>s+1){var a=r.slice(0,s).join("/");void 0===i[a]&&(i[a]=[]),i[a].push(r[s+1])}}}return i},this.isFullyOverriddenMember=function(t,e,i){var o,r,s=p(t);return-1===s.indexOf(e)?!1:null===n.getBase(t)?!1:(o=l(t,e,i),r=l(n.getBase(t),e,i),o&&r&&o!==r?!0:!1)},this.getMemberPaths=function(t,e){var n,i,o=f(t,e),r=[];for(n=0;n<o.length;n+=1)i=_(t,e,o[n]),void 0!==i&&-1===r.indexOf(i)&&r.push(i);return r},this.getOwnMemberPaths=function(t,e){var n,i=s(t,e),o=i?T.getRawKeys(i,T.isValidRelid):[],r=T.getMemberPaths(t,e),a=[];for(n=0;n<r.length;n+=1)-1!==o.indexOf(l(t,e,r[n]))&&a.push(r[n]);return a},this.delMember=function(t,e,i){var o;o=d(t,e,i),o&&n.deleteNode(o,!0)},this.addMember=function(t,i,s){var a,c=r(t,i),d=l(t,i,T.getPath(s));null===d?(D(t,i),a=n.createChild(c,e.MAXIMUM_STARTING_RELID_LENGTH+1)):T.isFullyOverriddenMember(t,i,T.getPath(s))||(a=n.copyNode(n.getChild(c,d),c,e.MAXIMUM_STARTING_RELID_LENGTH+1),n.deleteNode(n.getChild(c,d),!0)),a?(n.setPointer(a,e.MEMBER_RELATION,s),n.setRegistry(a,"_","_"),o(t)):P.warn("member already in set")},this.getMemberAttributeNames=function(n,i,o){return t("string"==typeof o),v(n,e.ATTRIBUTES_PROPERTY,i,o)},this.getMemberOwnAttributeNames=function(n,i,o){return t("string"==typeof o),y(n,e.ATTRIBUTES_PROPERTY,i,o)},this.getMemberAttribute=function(n,i,o,r){return t("string"==typeof o),E(n,e.ATTRIBUTES_PROPERTY,r,i,o)},this.getMemberOwnAttribute=function(n,i,o,r){return t("string"==typeof o),C(n,e.ATTRIBUTES_PROPERTY,r,i,o)},this.setMemberAttribute=function(e,i,r,s,a){t(void 0!==a);var l=c(e,i,r);l&&(n.setAttribute(l,s,a),o(e))},this.delMemberAttribute=function(t,e,i,o){var r=d(t,e,i);r&&n.delAttribute(r,o)},this.getMemberRegistryNames=function(n,i,o){return t("string"==typeof o),v(n,e.REGISTRY_PROPERTY,i,o)},this.getMemberOwnRegistryNames=function(n,i,o){return t("string"==typeof o),y(n,e.REGISTRY_PROPERTY,i,o)},this.getMemberRegistry=function(n,i,o,r){return t("string"==typeof o),E(n,e.REGISTRY_PROPERTY,r,i,o)},this.getMemberOwnRegistry=function(n,i,o,r){return t("string"==typeof o),C(n,e.REGISTRY_PROPERTY,r,i,o)},this.setMemberRegistry=function(e,i,r,s,a){t(void 0!==a);var l=c(e,i,r);l&&(n.setRegistry(l,s,a),o(e))},this.delMemberRegistry=function(t,e,i,o){var r=d(t,e,i);r&&n.delRegistry(r,o)},this.getSetAttributeNames=function(t,n){return v(t,e.ATTRIBUTES_PROPERTY,n)},this.getOwnSetAttributeNames=function(t,n){return y(t,e.ATTRIBUTES_PROPERTY,n)},this.getSetAttribute=function(t,n,i){return E(t,e.ATTRIBUTES_PROPERTY,i,n)},this.getOwnSetAttribute=function(t,n,i){return C(t,e.ATTRIBUTES_PROPERTY,i,n)},this.setSetAttribute=function(t,e,n,i){u(t,e)&&(T.setAttribute(r(t,e),n,i),o(t))},this.delSetAttribute=function(t,e,n){var i=s(t,e);i&&T.delAttribute(r(t,e),n)},this.getSetRegistryNames=function(t,n){return v(t,e.REGISTRY_PROPERTY,n)},this.getOwnSetRegistryNames=function(t,n){return y(t,e.REGISTRY_PROPERTY,n)},this.getSetRegistry=function(t,n,i){return E(t,e.REGISTRY_PROPERTY,i,n)},this.getOwnSetRegistry=function(t,n,i){return C(t,e.REGISTRY_PROPERTY,i,n)},this.setSetRegistry=function(t,e,n,i){u(t,e)&&(T.setRegistry(r(t,e),n,i),o(t))},this.delSetRegistry=function(t,e,n){var i=s(t,e);i&&T.delRegistry(r(t,e),n)}}return n}),define("common/core/guidcore",["common/core/CoreAssert","common/core/tasync","common/regexp","common/util/random","common/core/constants"],function(t,e,n,i,o){"use strict";function r(i,r){function l(t){return t.replace(/-/g,"")}function c(t){return t.substr(0,8)+"-"+t.substr(8,4)+"-"+t.substr(12,4)+"-"+t.substr(16,4)+"-"+t.substr(20)}function d(t){if(null===t||void 0===t)return[0,0,0,0,0,0,0,0];for(var e=new Array(8),n=0;n<t.length/4;n+=1)e[n]=parseInt(t.substr(4*n,4),16);return e}function h(t){var e=m.getRelid(t);if(e=s(e),"NaN"===e)return null;for(e=e.toString(16);e.length<32;)e+="0";return e}function p(e,n){var i=d(e),o=d(n);t(i.length===o.length);for(var r=[],s=0;s<i.length;s++)r.push(i[s]^o[s]);for(s=0;s<r.length;s++){r[s]=Number(r[s]).toString(16);for(var a=4-r[s].length;a>0;)r[s]="0"+r[s],a--}return r.join("")}function g(t,e){m.setAttribute(t,o.OWN_GUID,p(l(e),p(h(t),l(m.getGuid(m.getParent(t))))))}t("object"==typeof r),t("object"==typeof r.globConf),t("undefined"!=typeof r.logger);var u,f=r.logger,m=this;for(u in i)this[u]=i[u];f.debug("initialized GuidCore"),this.createNode=function(e){e=e||{};var o,r=e.guid||a();return t(n.GUID.test(r)),o=i.createNode(e),g(o,r),o},this.moveNode=function(t,e){var n=m.getGuid(t);return t=i.moveNode(t,e),g(t,n),t},this.getGuid=function(t){return t?m.getDeducedGuid(t,m.getGuid(m.getParent(t))):o.NULL_GUID},this.setGuid=function(i,o){return t(n.GUID.test(o)),e.call(function(t){var e,n=[];for(e=0;e<t.length;e+=1)n.push(m.getGuid(t[e]));for(g(i,o),e=0;e<t.length;e+=1)g(t[e],n[e])},m.loadChildren(i))},this.getDataGuid=function(t){return c(m.getAttribute(t,o.OWN_GUID))},this.getDeducedGuid=function(t,e){return t&&n.GUID.test(e)?c(p(h(t),p(m.getAttribute(t,o.OWN_GUID),l(e)))):o.NULL_GUID}}var s=i.relidToInteger,a=i.generateGuid;return r}),define("common/core/nullpointercore",["common/core/CoreAssert","common/core/constants"],function(t,e){"use strict";function n(n,i){t("object"==typeof i),t("object"==typeof i.globConf),t("undefined"!=typeof i.logger);var o,r=i.logger,s=this;for(o in n)this[o]=n[o];return r.debug("initialized NullPointerCore"),this.setPointer=function(t,i,o){if(null===o){var r=n.getChild(t,e.NULLPTR_RELID);n.setAttribute(r,"name",e.NULLPTR_NAME),n.setPointer(t,i,r)}else n.setPointer(t,i,o)},this.getPointerPath=function(t,i){var o=n.getPointerPath(t,i);return o&&-1!==o.indexOf(e.NULLPTR_RELID)?null:o},this.loadPointer=function(t,e){var i=s.getPointerPath(t,e);return null===i?null:n.loadPointer(t,e)},s}return n}),define("common/core/coreunwrap",["common/core/CoreAssert","common/core/tasync"],function(t,e){"use strict";var n=function(n,i){function o(t){if(null===t||n.isValidNode(t))return t;throw new Error("Invalid result node")}function r(e){t(e instanceof Array);var i;for(i=0;i<e.length;++i)if(!n.isValidNode(e[i]))throw new Error("Invalid result node array");return e}t("object"==typeof i),t("object"==typeof i.globConf),t("undefined"!=typeof i.logger);var s=i.logger.fork("coreunwrap"),a={};for(var l in n)a[l]=n[l];return s.debug("initialized"),a.loadRoot=e.unwrap(n.loadRoot),a.loadChild=e.unwrap(function(t,i){return e.call(o,n.loadChild(t,i))}),a.loadByPath=e.unwrap(function(t,i){return e.call(o,n.loadByPath(t,i))}),a.loadChildren=e.unwrap(function(t){return e.call(r,n.loadChildren(t))}),a.loadOwnChildren=e.unwrap(function(t){return e.call(r,n.loadOwnChildren(t))}),a.loadPointer=e.unwrap(n.loadPointer),a.loadCollection=e.unwrap(n.loadCollection),a.loadSubTree=e.unwrap(n.loadSubTree),a.loadOwnSubTree=e.unwrap(n.loadOwnSubTree),a.loadTree=e.unwrap(n.loadTree),a.traverse=e.unwrap(n.traverse),a.setGuid=e.unwrap(n.setGuid),"function"==typeof n.generateTreeDiff&&(a.generateTreeDiff=e.unwrap(n.generateTreeDiff)),"function"==typeof n.generateLightTreeDiff&&(a.generateLightTreeDiff=e.unwrap(n.generateLightTreeDiff)),"function"==typeof n.applyTreeDiff&&(a.applyTreeDiff=e.unwrap(n.applyTreeDiff)),a.addLibrary=e.unwrap(n.addLibrary),a.updateLibrary=e.unwrap(n.updateLibrary),a.loadInstances=e.unwrap(function(t){return e.call(r,n.loadInstances(t))}),a};return n}),define("common/core/coretype",["common/core/CoreAssert","common/core/tasync","common/core/constants"],function(t,e,n){"use strict";var i=function(i,o){function r(t,e){if(!e)throw new Error(t)}function s(t){return void 0===i.getPointerPath(t,n.BASE_POINTER)}function a(e){return t(void 0===e.base||null===e.base),e.base=null,e}function l(t,n){var o=null,r=O.getBase(t),s=null;return r&&O.getChildrenRelids(r,!0)[n]?(-1!==i.getChildrenRelids(t).indexOf(n)&&(o=i.loadChild(t,n)),s=O.loadChild(r,n),e.call(function(t,e,n,r){return e?(o=e,o.base=t,o):(o=i.getChild(n,r),O.setHashed(o,!0,!0),o.base=t,o)},s,o,t,n)):O.getChildrenRelids(t,!0)[n]!==!0?null:e.call(c,i.loadChild(t,n))}function c(o){var r=i.getPath(o);if(t(null===o||void 0===o.base||"object"==typeof o.base),void 0===o.base){if(O.isEmpty(o))return o.base=null,o;if(s(o))return i.deleteNode(o),N.warn("node ["+r+"] removed due to missing base"),null;var a=i.getPointerPath(o,n.BASE_POINTER);return t(void 0!==a),null===a?(o.base=null,o):O.isContainerPath(a,r)?(N.error("node ["+r+"] contains its own base!"),i.deleteNode(o),null):e.call(d,o,O.loadByPath(O.getRoot(o),a))}return o}function d(e,n){return null!==typeof e.base&&"object"==typeof e.base&&i.getPath(e.base)===i.getPath(n)?e:(t(void 0===e.base||null===e.base),null===n?(N.warn("node ["+i.getPath(e)+"] removed due to missing base in inheritance chain"),i.deleteNode(e),null):(e.base=n,e))}function h(t,n,i){if(null===t||i===n.length)return t;var o=O.loadChild(t,n[i]);return e.call(h,o,n,i+1)}function p(t){var e=O.getParent(t),n=O.getBase(t),i=e?O.getBase(e):null,o=n?O.getParent(n):null;return o&&i&&O.getPath(o)===O.getPath(i)?!0:!1}function g(t){for(;p(t);)t=O.getParent(t);return t}function u(t){for(var e,o,r,s,a=[],l=t,c=t;l;){if(c=O.getBase(l),e=O.getBase(g(l)),s="",c&&e)for(;c&&c!==O.getParent(e);){if(o=i.getInverseOverlayOfNode(c),o[s])for(r in o[s])-1===a.indexOf(r)&&a.push(r);s=n.PATH_SEP+O.getRelid(c)+s,c=O.getParent(c)}l=O.getBase(l)}return a}function f(t,e){
for(var o,r,s,a,l,c=[],d=t,h=t;d;){if(h=O.getBase(d),o=O.getBase(g(d)),l="",h&&o)for(r=t;h&&h!==O.getParent(o);){if(a=i.getInverseOverlayOfNode(h),a[l]&&a[l][e])for(s=0;s<a[l][e].length;s+=1)c.push(O.joinPaths(O.getPath(r),a[l][e][s]));l=n.PATH_SEP+O.getRelid(h)+l,h=O.getParent(h),r=O.getParent(r)}d=O.getBase(d)}return c}function m(t){var e,n=O.getPointerNames(t),i=O.getOwnPointerNames(t),o=[];for(e=0;e<n.length;e++)-1===i.indexOf(n[e])&&o.push(n[e]);return o}function _(t){r("core",i.isValidNode(t)),r("base","object"==typeof t.base)}function b(t,e){for(var n;void 0===n&&null!==t;)n=i.getProperty(t,e),t=O.getBase(t);return n}function y(t,e,n){var o=i.getPointerPathFrom(t,e,n);return void 0===o?null!==t.base&&void 0!==t.base?y(t.base,e,n):void 0:o}function v(t){var e;return t.base?(e=O.getParent(t.base),e?O.getPath(e):void 0):void 0}function C(t){var e=O.getParent(t);return e&&e.base?O.getPath(e.base):void 0}function E(t,e,i){var o=O.getChild(t,n.OVERLAYS_PROPERTY),r=O.getChild(o,e);return b(r,i)}function D(t,e){for(;e;){if(e===t)return!0;e=O.getBase(e)}return!1}function I(t,e){for(;e;){if(e===t)return!0;e=O.getParent(e)}return!1}function P(t,e,n,i){var o=O.getPath(e);if(i){if(n.containment[o])return!1;n.containment[o]=!0,e=O.getParent(e)}else{if(n.inheritance[o])return!1;n.inheritance[o]=!0,e=O.getBase(e)}for(;e;){if(t===e||P(t,e,n,!i))return!0;e=i?O.getParent(e):O.getBase(e)}return!1}function T(t,e){var n,i=[];for(n=t;n;)i.push(n),n=O.getBase(n);for(n=e;n;){if(i.indexOf(n)>-1)return n;n=O.getBase(n)}return null}function A(t,e,n){var i=T(t,e),o=!1;return i&&(o=O.getChildrenRelids(i,!0).hasOwnProperty(n)),o}function x(t,e){var o;if(e>n.MAXIMUM_STARTING_RELID_LENGTH+1)return void N.debug("Minimum relid length surpassed threshold, not propagating at all",e);for(e>n.MAXIMUM_STARTING_RELID_LENGTH&&(e=n.MAXIMUM_STARTING_RELID_LENGTH,N.debug("Minimum relid length reached threshold, only propagating threshold",e)),t=t.base;t;){if(o=i.getProperty(t,n.MINIMAL_RELID_LENGTH_PROPERTY)||0,o>=e)return;i.setProperty(t,n.MINIMAL_RELID_LENGTH_PROPERTY,e),t=t.base}}t("object"==typeof o),t("object"==typeof o.globConf),t("undefined"!=typeof o.logger);var w,N=o.logger,O=this;for(w in i)this[w]=i[w];N.debug("initialized CoreType"),this.isValidNode=function(t){try{return _(t),!0}catch(e){return N.error(e.message,{stack:e.stack,node:t}),!1}},this.loadRoot=function(t){return e.call(a,i.loadRoot(t))},this.loadChild=function(t,n){return e.call(function(t){return t&&O.isInheritanceContainmentCollision(t,O.getParent(t))?(N.error("node["+O.getPath(t)+"] was deleted due to inheritance-containment collision"),O.deleteNode(t),null):t},l(t,n))},this.loadByPath=function(e,n){return t(O.isValidNode(e)),t(""===n||"/"===n.charAt(0)),n=n.split("/"),h(e,n,1)},this.loadPointer=function(t,n){var i=O.getPointerPath(t,n),o=O.getRoot(t);return void 0===i?void 0:null===i?null:e.call(function(){return O.loadByPath(o,i)},O.loadPaths(O.getHash(o),[i]))},this.getChild=function(e,n){t(O.isValidNode(e)&&(void 0===e.base||"object"==typeof e.base));var o=i.getChild(e,n);return null!==e.base&&void 0!==e.base?(null===o.base||void 0===o.base)&&(o.base=O.getChild(e.base,n)):o.base=null,o},this.getChildrenRelids=function(e,n){function o(){for(var t=e,n=0,i=e.allChildrenRelids.bases.length;t;){if(n===i||t.childrenRelids!==e.allChildrenRelids.bases[n])return!1;t=t.base,n+=1}return!0}t(O.isValidNode(e));var r,s,a=e;if(!e.allChildrenRelids||o()===!1)for(e.allChildrenRelids={cached:{},bases:[]};a;){for(r=i.getChildrenRelids(a),e.allChildrenRelids.bases.push(r),s=0;s<r.length;s+=1)e.allChildrenRelids.cached[r[s]]=!0;a=a.base}return n?e.allChildrenRelids.cached:Object.keys(e.allChildrenRelids.cached)},this.loadChildren=function(n){t(O.isValidNode(n));for(var i=O.getChildrenRelids(n),o=[],r=0;r<i.length;r++)o[r]=O.loadChild(n,i[r]);return e.call(function(t){for(var e=[],n=0;n<t.length;n++)null!==t[n]&&e.push(t[n]);return e},e.lift(o))},this.setPointer=function(t,e,o){i.setPointer(t,e,o),p(t)&&(O.setProperty(t,n.INHERITED_CHILD_HAS_OWN_RELATION_PROPERTY,!0),O.processRelidReservation(O.getParent(t),O.getRelid(t))),p(o)&&(O.setProperty(o,n.INHERITED_CHILD_HAS_OWN_RELATION_PROPERTY,!0),O.processRelidReservation(O.getParent(o),O.getRelid(o)))},this.getCollectionNames=function(e){t(O.isValidNode(e));var n,o=i.getCollectionNames(e),r=u(e);for(n=0;n<o.length;n++)r.indexOf(o[n])<0&&r.push(o[n]);return r},this.getCollectionPaths=function(e,n){t(O.isValidNode(e)&&n);var o=i.getCollectionPaths(e,n),r=f(e,n);return r=r.concat(o)},this.loadCollection=function(t,n){var i,o=O.getRoot(t),r=O.getCollectionPaths(t,n),s=[],a=O.getHash(o);return e.call(function(){for(i=0;i<r.length;i+=1)s[i]=O.loadByPath(o,r[i]);return e.lift(s)},O.loadPaths(a,r))},this.createChild=function(t,e){var n=i.createChild(t,O.getChildrenRelids(t,!0),e);return this.processRelidReservation(t,this.getRelid(n)),O.getChild(t,this.getRelid(n))},this.createNode=function(e,o){e=e||{};var r,s,a=e.base||null,l=e.parent;return t(!l||O.isValidNode(l)),t(!a||O.isValidNode(a)),t(!a||O.getPath(a)!==O.getPath(l)),l&&(s=O.getChildrenRelids(l,!0),o=o||i.getProperty(l,n.MINIMAL_RELID_LENGTH_PROPERTY)),r=i.createNode(e,s,o),r.base=a,i.setPointer(r,n.BASE_POINTER,a),l&&(this.processRelidReservation(l,this.getRelid(r)),p(l)&&O.processRelidReservation(O.getParent(l),O.getRelid(l))),r},this.isValidNewParent=function(e,n){t(O.isValidNode(e)&&O.isValidNode(n));var i={containment:{},inheritance:{}},o=!0;return D(n,e)?o=!1:P(e,n,i,!0)?o=!1:P(e,n,i,!1)&&(o=!1),o},this.moveNode=function(e,o,r){t(O.isValidNewParent(e,o),"New parent would create loop in containment/inheritance tree.");var s,a=i.getProperty(o,n.MINIMAL_RELID_LENGTH_PROPERTY),l=O.getChildrenRelids(o,!0),c=this.getRelid(e),d=e.base;return"number"==typeof a&&c.length<a?l[c]=!0:"number"==typeof r&&c.length<r&&(l[c]=!0),s=i.moveNode(e,o,l,r||a),s.base=d,this.processRelidReservation(o,this.getRelid(s)),p(o)&&O.processRelidReservation(O.getParent(o),O.getRelid(o)),s},this.copyNode=function(e,o,r){t(!e.base||O.getPath(e.base)!==O.getPath(o));var s;return r=r||i.getProperty(o,n.MINIMAL_RELID_LENGTH_PROPERTY),s=i.copyNode(e,o,O.getChildrenRelids(o,!0),r),s.base=e.base,"string"==typeof O.getPointerPath(e,n.BASE_POINTER)&&i.setPointer(s,n.BASE_POINTER,e.base),i.deleteProperty(s,n.MINIMAL_RELID_LENGTH_PROPERTY),this.processRelidReservation(o,this.getRelid(s)),p(o)&&O.processRelidReservation(O.getParent(o),O.getRelid(o)),s},this.copyNodes=function(t,e,o){var r,s,a,l,c,d,h,g=[],u="",f=[];for(s=0;s<t.length;s++)f.push(O.getPath(t[s]));for(s=0;s<t.length;s++){for(d=m(t[s]),h={},a=0;a<d.length;a++)l=f.indexOf(O.getPointerPath(t[s],d[a])),-1!==l&&(h[d[a]]=l);g.push(h)}for(o=o||i.getProperty(e,n.MINIMAL_RELID_LENGTH_PROPERTY),r=i.copyNodes(t,e,O.getChildrenRelids(e,!0),o),s=0;s<t.length;s++)for(d=Object.keys(g[s]),a=0;a<d.length;a++)O.setPointer(r[s],d[a],r[g[s][d[a]]]);for(s=0;s<t.length;s++)c=t[s].base,r[s].base=c,i.setPointer(r[s],n.BASE_POINTER,c),i.deleteProperty(r[s],n.MINIMAL_RELID_LENGTH_PROPERTY);for(s=0;s<r.length;s+=1)a=this.getRelid(r[s]),a.length>u&&(u=a);return this.processRelidReservation(e,u),p(e)&&O.processRelidReservation(O.getParent(e),O.getRelid(e)),r},this.deleteNode=function(t,e){if(t&&(null!==t.base||e===!0)){var n=O.getParent(t),o=n?O.getBase(t):null,r=O.getBase(t),s=r?O.getParent(t):null;n&&o&&r&&s?O.getPath(o)!==O.getPath(s)&&i.deleteNode(t):i.deleteNode(t)}},this.getAttributeNames=function(e){t(O.isValidNode(e));var n={};do{for(var o=i.getAttributeNames(e),r=0;r<o.length;++r)o[r]in n||(n[o[r]]=!0);e=e.base}while(e);return Object.keys(n)},this.getRegistryNames=function(e){t(O.isValidNode(e));var n={};do{for(var o=i.getRegistryNames(e),r=0;r<o.length;++r)o[r]in n||(n[o[r]]=!0);e=e.base}while(e);return Object.keys(n)},this.getAttribute=function(e,n){t(O.isValidNode(e));var o;do o=i.getAttribute(e,n),e=e.base;while(void 0===o&&null!==e);return o},this.getRegistry=function(e,n){t(O.isValidNode(e));var o;do o=i.getRegistry(e,n),e=e.base;while(void 0===o&&null!==e);return o},this.getPointerNames=function(e){return t(O.isValidNode(e)),O.getPointerNamesFrom(e,"")},this.getPointerNamesFrom=function(e,n){t(O.isValidNode(e));var o={};do{for(var r=i.getPointerNamesFrom(e,n),s=0;s<r.length;++s)r[s]in o||(o[r[s]]=!0);e=e.base}while(e);return Object.keys(o)},this.getPointerPathFrom=function(e,n,o){t(O.isValidNode(e)&&"string"==typeof o);var r=i.getPointerPathFrom(e,n,o);if(void 0!==r)return r;var s,a,l=!1;for(a=e.base?y(e.base,n,o):void 0;e;){if(s=E(e,n,o),void 0!==s){if(-1===s.indexOf("_nullptr"))break;l=!0,s=void 0}n="/"+O.getRelid(e)+n,e=v(e)===C(e)?O.getParent(e):null}return void 0!==s&&(t(e),s=i.joinPaths(i.getPath(e),s)),"string"==typeof s?s:"string"==typeof a?a:l===!0?null:void 0},this.getPointerPath=function(t,e){return O.getPointerPathFrom(t,"",e)},this.getChildrenPaths=function(t){for(var e=O.getPath(t),n=O.getChildrenRelids(t),i=0;i<n.length;++i)n[i]=e+"/"+n[i];return n},this.setAttribute=function(t,e,n){i.setAttribute(t,e,n),p(t)&&O.processRelidReservation(O.getParent(t),O.getRelid(t))},this.setRegistry=function(t,e,n){i.setRegistry(t,e,n),p(t)&&O.processRelidReservation(O.getParent(t),O.getRelid(t))},this.isInheritanceContainmentCollision=function(t,e){for(var n=[];t;)n.push(O.getPath(t)),t=O.getBase(t);for(;e;){if(-1!==n.indexOf(O.getPath(e)))return!0;e=O.getParent(e)}return!1},this.getBase=function(e){return t(O.isValidNode(e)),e.base},this.isValidNewBase=function(e,n){t(O.isValidNode(e)&&(void 0===n||null===n||O.isValidNode(n)));var i={containment:{},inheritance:{}},o=!0;return n?I(n,e)?o=!1:P(e,n,i,!0)?o=!1:P(e,n,i,!1)&&(o=!1):o=!0,o},this.setBase=function(e,o){if(t(O.isValidNewBase(e,o),"New base would create loop in containment/inheritance tree."),o){var r,s,a,l=O.getParent(e),c=O.getOwnChildrenRelids(e),d=i.getProperty(e,n.MINIMAL_RELID_LENGTH_PROPERTY)||0,h=O.getChildrenRelids(o,!0);if(l)if(r=O.getBase(l),s=O.getParent(o),O.getPath(r)!==O.getPath(s))for(i.setPointer(e,n.BASE_POINTER,o),a=0;a<c.length;a+=1)h[c[a]]&&A(e,o,c[a])||i.deleteChild(e,c[a]);else i.deletePointer(e,n.BASE_POINTER);else i.setPointer(e,n.BASE_POINTER,o);for(e.base=o,a=0;a<c.length;a+=1)c[a].length<=n.MAXIMUM_STARTING_RELID_LENGTH&&(d=c[a].length+1>d?c[a].length+1:d);d>=2&&x(e,d)}else i.setPointer(e,n.BASE_POINTER,null),e.base=null},this.getBaseRoot=function(e){for(t(O.isValidNode(e));null!==e.base;)e=e.base;return e},this.getTypeRoot=function(t){if(t.base){for(;null!==t.base;)t=O.getBase(t);return t}return null},this.getOwnChildrenRelids=function(t){return i.getChildrenRelids(t)},this.loadOwnChildren=function(n){t(O.isValidNode(n));for(var i=O.getOwnChildrenRelids(n),o=[],r=0;r<i.length;r++)o[r]=O.loadChild(n,i[r]);return e.call(function(t){for(var e=[],n=0;n<t.length;n++)null!==t[n]&&e.push(t[n]);return e},e.lift(o))},this.getOwnAttributeNames=function(t){return i.getAttributeNames(t)},this.getOwnRegistryNames=function(t){return i.getRegistryNames(t)},this.getOwnAttribute=function(t,e){return i.getAttribute(t,e)},this.getOwnRegistry=function(t,e){return i.getRegistry(t,e)},this.getOwnPointerNames=function(e){return t(O.isValidNode(e)),i.getPointerNames(e)},this.getOwnPointerNamesFrom=function(t,e){return i.getPointerNamesFrom(t,e)},this.getOwnPointerPath=function(t,e){return i.getPointerPath(t,e)},this.getOwnPointerPathFrom=function(t,e,n){return i.getPointerPathFrom(t,e,n)},this.getOwnChildrenPaths=function(t){return i.getChildrenPaths(t)},this.processRelidReservation=function(t,e){!n.DOES_NOT_HAVE_RELID_CHILDREN[O.getRelid(t)]&&i.isValidRelid(e)&&x(t,e.length+1)},this.getInstancePaths=function(t){for(var e,o,r=[],s="";t;){for(e=i.getCollectionPaths(t,n.BASE_POINTER),o=0;o<e.length;o+=1)r.push(e[o]+s);s=n.PATH_SEP+i.getRelid(t)+s,t=i.getParent(t)}return r},this.loadInstances=function(n){t(O.isValidNode(n));var i,o=O.getInstancePaths(n),r=[],s=O.getRoot(n);for(i=0;i<o.length;i+=1)r[i]=O.loadByPath(s,o[i]);return e.lift(r)}};return i}),define("common/core/constraintcore",["common/util/assert","common/core/constants"],function(t,e){"use strict";function n(n,i){function o(t,e){for(var i,o=n.getChildrenRelids(t),r=0;r<o.length;r++)if(e===n.getAttribute(n.getChild(t,o[r]),"name")){i=o[r];break}return i}function r(t){return e.CONSTRAINT_REGISTRY_PREFIX+t}function s(n,i){t(c.isValidNode(n));for(var o=c.getChild(n,e.CONSTRAINTS_RELID),r=i?c.getOwnChildrenRelids(o):c.getChildrenRelids(o),s=[],a=0;a<r.length;a+=1)s.push(c.getAttribute(c.getChild(o,r[a]),"name"));return s}t("object"==typeof i),t("object"==typeof i.globConf),t("undefined"!=typeof i.logger);var a,l=i.logger,c=this;for(a in n)this[a]=n[a];l.debug("initialized ConstraintCore"),this.getConstraint=function(i,r){t(n.isValidNode(i));var s=n.getChild(i,e.CONSTRAINTS_RELID),a=o(s,r);if(a){var l=n.getChild(s,a);return{script:n.getAttribute(l,"script"),priority:n.getAttribute(l,"priority"),info:n.getAttribute(l,"info")}}return null},this.setConstraint=function(i,s,a){t(n.isValidNode(i)),t("object"==typeof a&&"string"==typeof s);var l,c=n.getChild(i,e.CONSTRAINTS_RELID),d=o(c,s);l=d?n.getChild(c,d):n.createChild(c,e.MAXIMUM_STARTING_RELID_LENGTH+1),a.priority=a.priority||e.C_DEF_PRIORITY,a.script=a.script||'console.log("empty constraint");',a.info=a.info||"",n.setAttribute(l,"name",s),n.setAttribute(l,"script",a.script),n.setAttribute(l,"priority",a.priority),n.setAttribute(l,"info",a.info),n.setRegistry(i,r(s),(n.getRegistry(i,r(s))||0)+1)},this.delConstraint=function(i,s){t(n.isValidNode(i));var a=n.getChild(i,e.CONSTRAINTS_RELID),l=o(a,s);if(l){var c=n.getChild(a,l);n.deleteNode(c,!0)}n.delRegistry(i,r(s))},this.getConstraintNames=function(t){return s(t,!1)},this.getOwnConstraintNames=function(t){return s(t,!0)}}return n}),define("common/core/convertData",["common/core/constants","common/storage/constants"],function(t,e){"use strict";function n(e){return e.length>t.COLLECTION_NAME_SUFFIX.length&&t.COLLECTION_NAME_SUFFIX===e.slice(-t.COLLECTION_NAME_SUFFIX.length)?!0:!1}function i(t){var e,i;for(e in t){for(i in t[e])n(i)&&delete t[e][i];0===Object.keys(t[e]).length&&delete t[e]}}function o(e){return i(e[t.OVERLAYS_PROPERTY]||{}),e.__v="1.0.0",e}function r(e){var n,o,r;n=e[t.ALL_SETS_PROPERTY]||{},i(n[t.OVERLAYS_PROPERTY]||{}),o=e[t.META_NODE]||{},i(o[t.OVERLAYS_PROPERTY]||{});for(r in o)n=o[r],n=n[t.ALL_SETS_PROPERTY]||{},i(n[t.OVERLAYS_PROPERTY]||{});return e.__v="1.1.0",e}function s(t){var e=t.__v||"0.0.0",n=e.split(".")[0];if(n>c)throw new Error('Trying to load data of incompatible version. Current version "'+l+'", data version "'+e+'".');return e!==l&&a[e]&&"function"==typeof a[e][l]?a[e][l](JSON.parse(JSON.stringify(t))):t}var a,l=e.VERSION,c=l.split(".")[0];return a={"0.0.0":{"1.0.0":o,"1.1.0":function(t){return r(o(t))}},"1.0.0":{"1.1.0":r}},s}),define("common/core/coretree",["common/core/CoreAssert","common/util/key","common/core/tasync","common/util/random","common/regexp","common/core/constants","common/core/convertData"],function(t,e,n,i,o,r,s){"use strict";function a(a,c){function d(e){t(null!==e&&"object"==typeof e&&e instanceof Array==!1)}function h(e){d(e.children),t(e.age>=r.MAX_AGE-1);var n=e.children;e.children=null,e.age=r.MAX_AGE;for(var i in n)h(n[i])}function p(e){d(e);var n,i,o=Object.keys(e);for(i=0;i<o.length;i+=1)n=e[o[i]],t(n.age<r.MAX_AGE),++n.age>=r.MAX_AGE?(delete e[o[i]],h(n)):p(n.children)}function g(){var e,n;if(++S>=r.MAX_TICKS)for(S=0,n=O.length;--n>=0;)e=O[n],t(e.age<r.MAX_AGE),++e.age>=r.MAX_AGE?(O.splice(n,1),h(e)):p(e.children)}function u(e,n){return d(e),t("string"==typeof n),e.hasOwnProperty(n)?(e[n].age=0,e[n]):null}function f(e,n){return t("string"==typeof n),"object"==typeof e&&null!==e?(e=e[n],void 0===e?b():e):null}function m(t){return"object"==typeof t&&null!==t&&t[r.MUTABLE_PROPERTY]===!0}function _(t){return"string"==typeof t?!1:"object"==typeof t&&0===Object.keys(t).length?!0:!1}function b(){return{}}function y(t,e){return t===e||"string"==typeof t&&t===f(e,N)||_(t)&&_(e)}function v(t){var e,n;for(e in t.children){n=t.children[e];var i=f(t.data,n.relid);o.DB_HASH.test(i)&&i===f(n.data,N)||(n.data=i,v(n))}}function C(e){return t("string"==typeof e),"_"!==e.charAt(0)}function E(n,i,o){t(m(n));var s,l,c,d,h,p,g,u=b();for(delete n[r.MUTABLE_PROPERTY],l=Object.keys(n),d=0;d<l.length;d++)c=l[d],h=n[c],m(h)?(p=E(h,i,o+"/"+c),JSON.stringify(p)===JSON.stringify(b())?delete n[c]:(u=p,"string"==typeof h[N]&&(n[c]=h[N]))):u=void 0;return u!==b()&&(g=n[N],t(""===g||void 0===g),""===g&&(s=JSON.parse(JSON.stringify(n)),g="#"+e(s,x),n[N]=g,s[N]=g,u=s,a.insertObject(s,R),R[g]={newHash:g,newData:s,oldHash:i.initial[o]&&i.initial[o].hash,oldData:i.initial[o]&&i.initial[o].data},i.initial[o]={hash:g,data:s})),u}function D(t){var e={parent:null,relid:null,age:0,children:{},data:null,initial:{"":{hash:t[a.ID_NAME],data:t}},rootid:++l};return e.data=s(t),O.push(e),g(),e}function I(e,n){var i=M.getRoot(e),r=M.getPath(e);return e=M.normalize(e),o.DB_HASH.test(e.data)&&(t(e.data===n[N]),i.initial[r]={hash:e.data,data:n},e.data=s(n),v(e)),e}function P(t,e,i){if(null===t||i===e.length)return t;var o=M.loadChild(t,e[i]);return n.call(P,o,e,i+1)}function T(t,e){if(!e)throw new Error(t)}function A(t){T("object","object"==typeof t&&null!==t),T("object 2",t.hasOwnProperty("parent")&&t.hasOwnProperty("relid")),T("parent","object"==typeof t.parent),T("relid","string"==typeof t.relid||null===t.relid),T("parent 2",null===t.parent==(null===t.relid)),T("age",t.age>=0&&t.age<=r.MAX_AGE),T("children 2",t.age===r.MAX_AGE==(null===t.children)),T("data","object"==typeof t.data||"string"==typeof t.data||"number"==typeof t.data),null!==t.parent&&(T("age 2",t.age>=t.parent.age),T("mutable",!m(t.data)||m(t.parent.data)))}t("object"==typeof c),t("object"==typeof c.globConf),t("undefined"!=typeof c.logger);var x=c.globConf,w=c.logger.fork("core"),N=a.ID_NAME,O=[],S=0,R={},M=this;a.loadObject=n.wrap(a.loadObject),this.loadPaths=n.wrap(a.loadPaths),this.logger=w,this.getParent=function(e){return t("object"==typeof e.parent),e.parent},this.getRelid=function(e){return t(null===e.relid||"string"==typeof e.relid),e.relid},this.getLevel=function(t){for(var e=0;null!==t.parent;)++e,t=t.parent;return e},this.getRoot=function(t){for(;null!==t.parent;)t=t.parent;return t},this.getPath=function(t,e){if(null===t)return null;for(var n="";null!==t.relid&&t!==e;)n="/"+t.relid+n,t=t.parent;return n},this.isValidPath=function(t){return"string"==typeof t&&(""===t||"/"===t.charAt(0))},this.splitPath=function(e){return t(M.isValidPath(e)),e=e.split("/"),e.splice(0,1),e},this.buildPath=function(e){return t(e instanceof Array),0===e.length?"":"/"+e.join("/")},this.joinPaths=function(e,n){return t(M.isValidPath(e)&&M.isValidPath(n)),e+n},this.getCommonPathPrefixData=function(e,n){t("string"==typeof e&&"string"==typeof n),e=M.splitPath(e),n=M.splitPath(n);for(var i=[],o=0;e[o]===n[o]&&o<e.length;++o)i.push(e[o]);return{common:M.buildPath(i),first:M.buildPath(e.slice(o)),firstLength:e.length-o,second:M.buildPath(n.slice(o)),secondLength:n.length-o}},this.normalize=function(e){t(M.isValidNode(e));var n;if(null===e.children){if(t(e.age===r.MAX_AGE),null!==e.parent){n=M.normalize(e.parent);var i=u(n.children,e.relid);if(null!==i)return i;t(null===e.parent.children||null===u(e.parent.children,e.relid)),t(null===u(n.children,e.relid)),e.parent=n,n.children[e.relid]=e,i=f(n.data,e.relid),o.DB_HASH.test(i)&&i===f(e.data,N)||(e.data=i)}else O.push(e);e.age=0,e.children={}}else if(0!==e.age){n=e;do n.age=0,n=n.parent;while(null!==n&&0!==n.age)}return e},this.getAncestor=function(e,n){t(M.getRoot(e)===M.getRoot(n)),e=M.normalize(e),n=M.normalize(n);var i=[];do i.push(e),e=e.parent;while(null!==e);var o=[];do o.push(n),n=n.parent;while(null!==n);for(var r=i.length-1,s=o.length-1;0!==r&&0!==s&&i[r-1]===o[s-1];)--r,--s;return t(i[r]===o[s]),i[r]},this.isAncestor=function(e,n){t(M.getRoot(e)===M.getRoot(n)),e=M.normalize(e),n=M.normalize(n);do{if(e===n)return!0;e=e.parent}while(null!==e);return!1},this.createRoot=function(){var t={parent:null,relid:null,age:0,children:{},data:{_mutable:!0},initial:{"":null},rootid:++l};return t.data[N]="",O.push(t),g(),t},this.getChild=function(e,n){t("string"==typeof n&&n!==N),e=M.normalize(e);var i=u(e.children,n);return null!==i?i:(i={parent:e,relid:n,age:0,children:{},data:f(e.data,n)},e.children[n]=i,g(),i)},this.createChild=function(t,e,n){if(t=M.normalize(t),"object"!=typeof t.data||null===t.data)throw new Error("invalid node data");return M.getChild(t,i.generateRelid(e||t.data,n))},this.isMutable=function(t){return t=M.normalize(t),m(t.data)},this.isEmpty=function(t){return t=M.normalize(t),"object"!=typeof t.data||null===t.data?!1:t.data===b()?!0:_(t.data)},this.mutate=function(e){t(M.isValidNode(e)),e=M.normalize(e);var n=e.data;if("object"!=typeof n||null===n)return!1;if(n[r.MUTABLE_PROPERTY]===!0)return!0;if(null!==e.parent&&!M.mutate(e.parent))return!1;var i=b();for(var o in n)i[o]=n[o];return i[r.MUTABLE_PROPERTY]=!0,"string"==typeof n[N]&&(i[N]=""),null!==e.parent&&(t(void 0===e.parent.data[e.relid]||y(f(e.parent.data,e.relid),e.data)),e.parent.data[e.relid]=i),e.data=i,!0},this.getData=function(e){return e=M.normalize(e),t(!m(e.data)),e.data},this.setData=function(e,n){if(t(null!==n&&"undefined"!=typeof n),e=M.normalize(e),null!==e.parent){if(!M.mutate(e.parent))throw new Error("incorrect node data");e.parent.data[e.relid]=n}e.data=n,v(e)},this.deleteData=function(t){if(t=M.normalize(t),null!==t.parent){if(!M.mutate(t.parent))throw new Error("incorrect node data");delete t.parent.data[t.relid]}var e=t.data;return t.data=b(),v(t),e},this.copyData=function(t){return t=M.normalize(t),"object"!=typeof t.data||null===t.data?t.data:JSON.parse(JSON.stringify(t.data))},this.getProperty=function(e,n){t("string"==typeof n&&n!==N);var i;return e=M.normalize(e),"object"==typeof e.data&&null!==e.data&&(i=e.data[n]),i},this.setProperty=function(e,n,i){if(t("string"==typeof n&&n!==N),t(!m(i)&&void 0!==i),e=M.normalize(e),!M.mutate(e))throw new Error("incorrect node data");e.data[n]=i;var o=u(e.children,n);null!==o&&(o.data=i,v(o))},this.deleteProperty=function(e,n){if(t("string"==typeof n&&n!==N),e=M.normalize(e),!M.mutate(e))throw new Error("incorrect node data");delete e.data[n];var i=u(e.children,n);null!==i&&(i.data=b(),v(i))},this.getKeys=function(t,e){var n;return t=M.normalize(t),"object"!=typeof t.data||null===t.data?null:n=this.getRawKeys(t.data,e)},this.getRawKeys=function(t,e){e=e||C;for(var n=Object.keys(t),i=n.length;--i>=0&&!e(n[i]);)n.pop();for(;--i>=0;)e(n[i])||(n[i]=n.pop());return n},this.getHash=function(e){if(null===e)return null;var n;return e=M.normalize(e),"object"==typeof e.data&&null!==e.data&&(n=e.data[N]),t("string"==typeof n||void 0===n),n},this.isHashed=function(t){return t=M.normalize(t),"object"==typeof t.data&&null!==t.data&&"string"==typeof t.data[N]},this.setHashed=function(e,n,i){if(t("boolean"==typeof n),e=M.normalize(e),!i&&!M.mutate(e))throw new Error("incorrect node data");n?e.data[N]="":delete e.data[N],t(void 0===e.children[N])},this.persist=function(t){var e,n=!1;return t=M.normalize(t),t=M.getRoot(t),m(t.data)?(n=E(t.data,t,""),n!==b()?(e={},e.objects=R,R={},e.rootHash=t.data[N]):e={rootHash:t.data[N],objects:{}},e):{rootHash:t.data[N],objects:{}}},this.loadRoot=function(e){return t(o.DB_HASH.test(e)),n.call(D,a.loadObject(e))},this.loadChild=function(e,i){return t(M.isValidNode(e)),e=M.getChild(e,i),"object"==typeof e.data?null!==e.data?e:null:o.DB_HASH.test(e.data)?n.call(I,e,a.loadObject(e.data)):null},this.getChildHash=function(e,n){return t(M.isValidNode(e)),e=M.getChild(e,n),"object"==typeof e.data?null!==e.data?M.getHash(e):null:o.DB_HASH.test(e.data)?e.data:null},this.loadByPath=function(e,n){return t(M.isValidNode(e)),t(""===n||"/"===n.charAt(0)),n=n.split("/"),P(e,n,1)},this.isValidNode=function(t){try{return A(t),!0}catch(e){return w.error(e.message,{stack:e.stack,node:t}),!1}},this.removeChildFromCache=function(t,e){return delete t.children[e],t}}var l=0;return a}),define("common/core/metacore",["common/core/CoreAssert","common/core/tasync","common/util/canon","common/core/constants"],function(t,e,n,i){"use strict";var o=function(e,n){function o(t,e){return f.getPath(t)===f.getPath(e)?!0:!1}function r(t){return f.getChild(t,i.META_NODE)}function s(t){return f.getChild(r(t),i.META_CHILDREN)}function a(t,e){var n=r(t),o=f.getPointerNames(n)||[];return-1!==o.indexOf(e)?f.getChild(n,i.META_POINTER_PREFIX+e):null}function l(t,e){return f.setPointer(r(t),e,null),f.getChild(r(t),i.META_POINTER_PREFIX+e)}function c(t){return f.getChild(r(t),i.META_ASPECTS)}function d(t,e){var n=c(t),o=f.getPointerNames(n)||[];return-1!==o.indexOf(e)?f.getChild(n,i.META_ASPECT_PREFIX+e):null}function h(t,e){var n=f.getChild(r(t),i.META_ASPECTS);return f.setPointer(n,e,null),f.getChild(n,i.META_ASPECT_PREFIX+e)}function p(t){var e=f.isMemberOf(t);return e&&e[""]&&-1!==e[""].indexOf(i.META_SET_NAME)?!0:!1}t("object"==typeof n),t("object"==typeof n.globConf),t("undefined"!=typeof n.logger);var g,u=n.logger,f=this;for(g in e)this[g]=e[g];u.debug("initialized MetaCore"),this.isTypeOf=function(t,e){for(;t;){if(o(t,e))return!0;t=f.getBase(t)}return!1},this.isValidChildOf=function(t,e){for(var n=f.getMemberPaths(s(e),i.SET_ITEMS)||[];t;){if(-1!==n.indexOf(f.getPath(t)))return!0;t=f.getBase(t)}return!1},this.getValidPointerNames=function(t){var e,n,o,s=r(t),a=f.getPointerNames(s)||[],l=[];for(e=0;e<a.length;e++)n=f.getChild(s,i.META_POINTER_PREFIX+a[e]),o=f.getAttribute(n,i.SET_ITEMS_MAX),1===o&&l.push(a[e]);return l},this.getOwnValidPointerNames=function(t){var e,n,o,s=r(t),a=f.getOwnPointerNames(s)||[],l=[];for(e=0;e<a.length;e++)n=f.getChild(s,i.META_POINTER_PREFIX+a[e]),o=f.getOwnAttribute(n,i.SET_ITEMS_MAX),1===o&&l.push(a[e]);return l},this.getValidSetNames=function(t){var e,n,o,s=r(t),a=f.getPointerNames(s)||[],l=[];for(e=0;e<a.length;e++)n=f.getChild(s,i.META_POINTER_PREFIX+a[e]),o=f.getAttribute(n,i.SET_ITEMS_MAX),(void 0===o||-1===o||o>1)&&l.push(a[e]);return l},this.getOwnValidSetNames=function(t){var e,n,o,s=r(t),a=f.getOwnPointerNames(s)||[],l=[];for(e=0;e<a.length;e++)n=f.getChild(s,i.META_POINTER_PREFIX+a[e]),o=f.getOwnAttribute(n,i.SET_ITEMS_MAX),(void 0===o||-1===o||o>1)&&l.push(a[e]);return l},this.isValidTargetOf=function(t,e,n){var o=a(e,n);if(o)for(var r=f.getMemberPaths(o,i.SET_ITEMS)||[];t;){if(-1!==r.indexOf(f.getPath(t)))return!0;t=f.getBase(t)}return!1},this.getValidAttributeNames=function(t){return f.getAttributeNames(r(t))||[]},this.getOwnValidAttributeNames=function(t){return f.getOwnAttributeNames(r(t))||[]},this.isValidAttributeValueOf=function(t,e,n){var o;if(-1===f.getValidAttributeNames(t).indexOf(e))return!1;var s=f.getAttribute(r(t),e);if(s["enum"]&&s["enum"]instanceof Array)return-1!==s["enum"].indexOf(n);switch(s.type){case i.ATTRIBUTE_TYPES.BOOLEAN:if(n===!0||n===!1)return!0;break;case i.ATTRIBUTE_TYPES.STRING:if("string"==typeof n)return s.regexp?new RegExp(s.regexp).test(n):!0;break;case i.ATTRIBUTE_TYPES.ASSET:if("string"==typeof n)return!0;break;case i.ATTRIBUTE_TYPES.INTEGER:if(o=parseInt(n),!isNaN(o)&&parseFloat(n)===o)return("number"!=typeof s.min||o>=s.min)&&("number"!=typeof s.max||o<=s.max)?!0:!1;break;case i.ATTRIBUTE_TYPES.FLOAT:if(o=parseFloat(n),!isNaN(o))return("number"!=typeof s.min||o>=s.min)&&("number"!=typeof s.max||o<=s.max)?!0:!1}return!1},this.getValidAspectNames=function(t){return f.getPointerNames(c(t))||[]},this.getOwnValidAspectNames=function(t){return f.getOwnPointerNames(c(t))||[]},this.getAspectMeta=function(t,e){return f.getMemberPaths(d(t,e),i.SET_ITEMS)},this.getJsonMeta=function(t){var e,n,o,l,c,h={children:{},attributes:{},pointers:{},aspects:{},constraints:{}};for(e=s(t),h.children.minItems=[],h.children.maxItems=[],h.children.items=f.getMemberPaths(e,i.SET_ITEMS),l=0;l<h.children.items.length;l++)h.children.minItems.push(f.getMemberAttribute(e,i.SET_ITEMS,h.children.items[l],i.SET_ITEMS_MIN)||-1),h.children.maxItems.push(f.getMemberAttribute(e,i.SET_ITEMS,h.children.items[l],i.SET_ITEMS_MAX)||-1);for(h.children.min=f.getAttribute(e,i.SET_ITEMS_MIN),h.children.max=f.getAttribute(e,i.SET_ITEMS_MAX),n=f.getValidAttributeNames(t),l=0;l<n.length;l++)h.attributes[n[l]]=f.getAttribute(r(t),n[l]);for(n=f.getPointerNames(r(t)),l=0;l<n.length;l++){for(e=a(t,n[l]),o={},o.items=f.getMemberPaths(e,i.SET_ITEMS),o.min=f.getAttribute(e,i.SET_ITEMS_MIN),o.max=f.getAttribute(e,i.SET_ITEMS_MAX),o.minItems=[],o.maxItems=[],c=0;c<o.items.length;c++)o.minItems.push(f.getMemberAttribute(e,i.SET_ITEMS,o.items[c],i.SET_ITEMS_MIN)||-1),o.maxItems.push(f.getMemberAttribute(e,i.SET_ITEMS,o.items[c],i.SET_ITEMS_MAX)||-1);h.pointers[n[l]]=o}for(n=f.getValidAspectNames(t),l=0;l<n.length;l++)e=d(t,n[l]),h.aspects[n[l]]=f.getMemberPaths(e,i.SET_ITEMS)||[];for(n=f.getConstraintNames(t),l=0;l<n.length;l++)h.constraints[n[l]]=f.getConstraint(t,n[l]);return h},this.getOwnJsonMeta=function(t){var e,n,o,s,a,l={children:{},attributes:{},pointers:{},aspects:{},constraints:{}},c=r(t),d=f.getChild(c,i.META_CHILDREN),h=f.getChild(c,i.META_ASPECTS);if(l.children.minItems=[],l.children.maxItems=[],l.children.items=f.getOwnMemberPaths(d,i.SET_ITEMS),l.children.items.length>0){for(s=0;s<l.children.items.length;s++)l.children.minItems.push(f.getMemberAttribute(d,i.SET_ITEMS,l.children.items[s],i.SET_ITEMS_MIN)||-1),l.children.maxItems.push(f.getMemberAttribute(d,i.SET_ITEMS,l.children.items[s],i.SET_ITEMS_MAX)||-1);n=f.getOwnAttributeNames(d),-1!==n.indexOf("min")&&(l.children.min=f.getAttribute(d,i.SET_ITEMS_MIN)),-1!==n.indexOf("max")&&(l.children.max=f.getAttribute(d,i.SET_ITEMS_MAX))}else delete l.children;if(n=f.getOwnAttributeNames(c)||[],n.length>0)for(s=0;s<n.length;s++)l.attributes[n[s]]=f.getOwnAttribute(c,n[s]);else delete l.attributes;if(n=f.getOwnPointerNames(c),n.length>0)for(s=0;s<n.length;s++){for(e=f.getChild(c,i.META_POINTER_PREFIX+n[s]),o={},o.items=f.getOwnMemberPaths(e,i.SET_ITEMS),o.min=f.getOwnAttribute(e,i.SET_ITEMS_MIN),o.max=f.getOwnAttribute(e,i.SET_ITEMS_MAX),o.minItems=[],o.maxItems=[],a=0;a<o.items.length;a++)o.minItems.push(f.getMemberAttribute(e,i.SET_ITEMS,o.items[a],i.SET_ITEMS_MIN)||-1),o.maxItems.push(f.getMemberAttribute(e,i.SET_ITEMS,o.items[a],i.SET_ITEMS_MAX)||-1);l.pointers[n[s]]=o}else delete l.pointers;if(n=f.getOwnPointerNames(h)||[],n.length>0)for(s=0;s<n.length;s++)e=f.getChild(h,i.META_ASPECT_PREFIX+n[s]),l.aspects[n[s]]=f.getOwnMemberPaths(e,i.SET_ITEMS)||[];else delete l.aspects;if(n=f.getOwnConstraintNames(t),n.length>0)for(s=0;s<n.length;s++)l.constraints[n[s]]=f.getConstraint(t,n[s]);else delete l.constraints;return l},this.clearMetaRules=function(t){f.deleteNode(r(t),!0)},this.setAttributeMeta=function(e,n,i){t("object"==typeof i&&"string"==typeof n&&n);var o;i.hasOwnProperty("default")&&(o=i["default"],i=JSON.parse(JSON.stringify(i)),delete i["default"]),f.setAttribute(r(e),n,i),"undefined"!=typeof o&&f.setAttribute(e,n,o)},this.delAttributeMeta=function(t,e){f.delAttribute(r(t),e)},this.getAttributeMeta=function(t,e){return f.getAttribute(r(t),e)},this.getValidChildrenPaths=function(t){return f.getMemberPaths(s(t),i.SET_ITEMS)},this.getOwnValidChildrenPaths=function(t){return f.getOwnMemberPaths(s(t),i.SET_ITEMS)},this.getChildrenMeta=function(t){var e,n=s(t),o={min:f.getAttribute(n,i.SET_ITEMS_MIN),max:f.getAttribute(n,i.SET_ITEMS_MAX)},r=f.getMemberPaths(n,i.SET_ITEMS);for(e=0;e<r.length;e+=1)o[r[e]]={min:f.getMemberAttribute(n,i.SET_ITEMS,r[e],i.SET_ITEMS_MIN),max:f.getMemberAttribute(n,i.SET_ITEMS,r[e],i.SET_ITEMS_MAX)};return r.length>0?o:null},this.setChildMeta=function(t,e,n,o){f.addMember(s(t),i.SET_ITEMS,e),n=n||-1,o=o||-1,f.setMemberAttribute(s(t),i.SET_ITEMS,f.getPath(e),i.SET_ITEMS_MIN,n),f.setMemberAttribute(s(t),i.SET_ITEMS,f.getPath(e),i.SET_ITEMS_MAX,o)},this.delChildMeta=function(t,e){f.delMember(s(t),i.SET_ITEMS,e)},this.setChildrenMetaLimits=function(t,e,n){e&&f.setAttribute(s(t),i.SET_ITEMS_MIN,e),n&&f.setAttribute(s(t),i.SET_ITEMS_MAX,n);
},this.setPointerMetaTarget=function(t,e,n,o,r){f.addMember(l(t,e),i.SET_ITEMS,n),o=o||-1,f.setMemberAttribute(l(t,e),i.SET_ITEMS,f.getPath(n),i.SET_ITEMS_MIN,o),r=r||-1,f.setMemberAttribute(l(t,e),i.SET_ITEMS,f.getPath(n),i.SET_ITEMS_MAX,r)},this.delPointerMetaTarget=function(t,e,n){var o=a(t,e);o&&f.delMember(o,i.SET_ITEMS,n)},this.setPointerMetaLimits=function(t,e,n,o){n&&f.setAttribute(l(t,e),i.SET_ITEMS_MIN,n),o&&f.setAttribute(l(t,e),i.SET_ITEMS_MAX,o)},this.delPointerMeta=function(t,e){f.deleteNode(l(t,e),!0),f.deletePointer(r(t),e)},this.getPointerMeta=function(t,e){var n,o,r,s={},l=a(t,e);if(null===l)return null;for(s.min=f.getAttribute(l,i.SET_ITEMS_MIN),void 0===s.min&&(s.min=-1),s.max=f.getAttribute(l,i.SET_ITEMS_MAX),void 0===s.max&&(s.max=-1),n=f.getMemberPaths(l,i.SET_ITEMS),r=0;r<n.length;r++)o={min:f.getMemberAttribute(l,i.SET_ITEMS,n[r],i.SET_ITEMS_MIN),max:f.getMemberAttribute(l,i.SET_ITEMS,n[r],i.SET_ITEMS_MAX)},void 0===o.min&&(o.min=-1),void 0===o.max&&(o.max=-1),s[n[r]]=o;return s},this.getValidTargetPaths=function(t,e){var n=a(t,e);return null===n?[]:f.getMemberPaths(n,i.SET_ITEMS)},this.getOwnValidTargetPaths=function(t,e){var n=a(t,e);return null===n?[]:f.getOwnMemberPaths(n,i.SET_ITEMS)},this.setAspectMetaTarget=function(t,e,n){f.addMember(h(t,e),i.SET_ITEMS,n)},this.delAspectMetaTarget=function(t,e,n){var o=d(t,e);o&&f.delMember(o,i.SET_ITEMS,n)},this.delAspectMeta=function(t,e){f.deleteNode(h(t,e),!0),f.deletePointer(c(t),e)},this.getBaseType=function(t){for(;t;){if(p(t))return t;t=f.getBase(t)}return null},this.isInstanceOf=function(t,e){for(t=f.getBase(t);t;){if(f.getAttribute(t,"name")===e)return!0;t=f.getBase(t)}return!1}};return o}),define("common/core/coretreeloader",["common/core/CoreAssert","common/core/tasync"],function(t,e){"use strict";var n=function(n,i){function o(t,n){var i=function(t){for(var i=0;i<t.length;i++)t[i]=l.loadSubTree(t[i],n);return e.lift(t)},o=n===!0?l.loadOwnChildren:l.loadChildren;return e.call(function(n){return n.length<1?[t]:e.call(function(e){var n,i=[];for(n=0;n<e.length;n++)i=i.concat(e[n]);return i.unshift(t),i},i(n))},o(t))}function r(n,i,o,r){t(l.isValidNode(n)&&"function"==typeof o&&"function"==typeof r);var s,a,c=[],d=0,h=null,p=l.getRoot(n),g=e.unwrap(l.loadByPath),u=function(t){var e,i=l.getChildrenPaths(t);if(l.getPath(t)!==l.getPath(n))for(e=0;e<i.length;e+=1)a.call(c,i[e])},f=function(t,e){h=h||t,!t&&e&&u(e),o(e,m)},m=function(t){h=h||t,d-=1,h&&i.stopOnError&&(c=[])};i=i||{},i.maxParallelLoad=i.maxParallelLoad||100,i.excludeRoot=i.excludeRoot===!0||!1,i.stopOnError=i.stopOnError===!1?!1:!0,a="DFS"===i.order?c.unshift:c.push,(i.maxParallelLoad<1||"DFS"===i.order)&&(i.maxParallelLoad=1),c=l.getChildrenPaths(n),i.excludeRoot===!1&&c.unshift(l.getPath(n)),s=setInterval(function(){0===c.length&&0===d?(clearInterval(s),r(h)):c.length>0&&d<i.maxParallelLoad&&(!h||i.stopOnError===!1)&&(d+=1,g(p,c.shift(),f))},0)}t("object"==typeof i),t("object"==typeof i.globConf),t("undefined"!=typeof i.logger);var s,a=i.logger,l=this;for(s in n)this[s]=n[s];a.debug("initialized CoreTreeLoader"),this.loadTree=function(t){return e.call(l.loadSubTree,l.loadRoot(t))},this.loadSubTree=function(t){return o(t,!1)},this.loadOwnSubTree=function(t){return o(t,!0)},this.traverse=e.wrap(r)};return n}),define("common/core/corediff",["common/util/canon","common/core/tasync","common/core/CoreAssert","common/regexp","common/util/random","common/core/constants"],function(t,e,n,i,o,r){"use strict";function s(s,a){function l(t){if(!t)return t;var e,n=Object.keys(t);for(JSON.stringify(t.set)===JSON.stringify({})&&delete t.set,e=0;e<n.length;e++)Array.isArray(t[n[e]])||(void 0===t[n[e]]?delete t[n[e]]:"set"===n[e]||"object"==typeof t[n[e]]&&(l(t[n[e]]),t[n[e]]&&0===Object.keys(t[n[e]]).length&&delete t[n[e]]));n=Object.keys(t),1===n.length&&delete t.guid}function c(e,n){var i,o=Mt.getOwnAttributeNames(e),s=Mt.getOwnAttributeNames(n),a={};for(i=0;i<o.length;i++)-1===s.indexOf(o[i])&&(a[o[i]]=r.TO_DELETE_STRING);for(i=0;i<s.length;i++)void 0===Mt.getAttribute(e,s[i])?a[s[i]]=Mt.getAttribute(n,s[i]):t.stringify(Mt.getAttribute(e,s[i]))!==t.stringify(Mt.getAttribute(n,s[i]))&&(a[s[i]]=Mt.getAttribute(n,s[i]));return a}function d(e,n){var i,o=Mt.getOwnRegistryNames(e),s=Mt.getOwnRegistryNames(n),a={};for(i=0;i<o.length;i++)-1===s.indexOf(o[i])&&(a[o[i]]=r.TO_DELETE_STRING);for(i=0;i<s.length;i++)void 0===Mt.getRegistry(e,s[i])?a[s[i]]=Mt.getRegistry(n,s[i]):t.stringify(Mt.getRegistry(e,s[i]))!==t.stringify(Mt.getRegistry(n,s[i]))&&(a[s[i]]=Mt.getRegistry(n,s[i]));return a}function h(t,e){var n,i=Mt.getChildrenRelids(t,!0),o=Mt.getChildrenRelids(e,!0),r=Mt.getChildrenHashes(e),s=Mt.getChildrenHashes(t),a={added:[],removed:[]};for(n in i)o.hasOwnProperty(n)===!1&&a.removed.push({relid:n,hash:s[n]});for(n in o)i.hasOwnProperty(n)===!1&&a.added.push({relid:n,hash:r[n]});return a}function p(e,n){var i=function(t){var e,n={},i=Mt.getPointerNames(t);for(e=0;e<i.length;e++)n[i[e]]=Mt.getPointerPath(t,i[e]);return n},o=i(e),r=i(n);return t.stringify(o)!==t.stringify(r)?{source:o,target:r}:{}}function g(e,n){var i=function(t){var e,n,i,o,r,s,a={};for(e=Mt.getSetNames(t),o=0;o<e.length;o++)for(a[e[o]]={},n=Mt.getMemberPaths(t,e[o]),r=0;r<n.length;r++){for(a[e[o]][n[r]]={attr:{},reg:{}},i=Mt.getMemberOwnAttributeNames(t,e[o],n[r]),s=0;s<i.length;s++)a[e[o]][n[r]].attr[i[s]]=Mt.getMemberAttribute(t,e[o],n[r],i[s]);for(i=Mt.getMemberRegistryNames(t,e[o],n[r]),s=0;s<i.length;s++)a[e[o]][n[r]].reg[i[s]]=Mt.getMemberRegistry(t,e[o],n[r],i[s])}return a},o=i(e),r=i(n);return t.stringify(o)!==t.stringify(r)?{source:o,target:r}:{}}function u(e,n){var i=function(t){var e,n,i,o,s=Mt.getProperty(t,r.OVERLAYS_PROPERTY)||{},a={},l=Mt.getPath(t);for(e=Object.keys(s),i=0;i<e.length;i++)if(-1===e[i].indexOf("_"))for(a[e[i]]={},n=Object.keys(s[e[i]]),o=0;o<n.length;o++)"/_nullptr"===s[e[i]][n[o]]?a[e[i]][n[o]]=null:"-inv"!==n[o].slice(-4)&&-1===n[o].indexOf("_")&&-1===s[e[i]][n[o]].indexOf("_")&&(a[e[i]][n[o]]=Mt.joinPaths(l,s[e[i]][n[o]]));return a},o=i(e),s=i(n);return t.stringify(o)!==t.stringify(s)?{source:o,target:s}:{}}function f(e,n){var i=function(t){var e,n,i,o;if(t.children){for(o=t.children,e=0;e<o.items.length;e+=1)o[o.items[e]]={min:o.minItems[e],max:o.maxItems[e]};delete o.items,delete o.minItems,delete o.maxItems}if(t.pointers)for(i=Object.keys(t.pointers),n=0;n<i.length;n+=1){for(o=t.pointers[i[n]],e=0;e<o.items.length;e+=1)o[o.items[e]]={min:o.minItems[e],max:o.maxItems[e]};delete o.items,delete o.minItems,delete o.maxItems}return t},o=i(Mt.getOwnJsonMeta(e)),r=i(Mt.getOwnJsonMeta(n));return t.stringify(o)!==t.stringify(r)?{source:o,target:r}:{}}function m(t){var e,n=Object.keys(t);for(e=0;e<n.length;e++)Gt[n[e]]?(t[Gt[n[e]]]=t[n[e]],delete t[n[e]]):"object"==typeof t[n[e]]&&m(t[n[e]])}function _(t){var e,n=Object.keys(t);for(e=0;e<n.length;e++)Gt[t[n[e]]]&&(t[n[e]]=Gt[t[n[e]]])}function b(){y(kt),v(kt),C(kt),l(kt)}function y(t){var e,n,i,o=k(t);for(t.meta&&(n=t.meta.source||{},i=t.meta.target||{},m(n),t.meta=N(n,i)),e=0;e<o.length;e++)y(t[o[e]])}function v(t){var e,n,i,o=k(t);for(t.pointer&&(n=t.pointer.source||{},i=t.pointer.target||{},_(n),t.pointer=N(n,i)),e=0;e<o.length;e++)v(t[o[e]])}function C(t){var e,n,i,o=k(t);for(t.set&&(n=t.set.source||{},i=t.set.target||{},m(n),t.set=N(n,i)),e=0;e<o.length;e++)C(t[o[e]])}function E(t){return Object.keys(t.children||{}).length>0||Object.keys(t.attr||{}).length>0||Object.keys(t.reg||{}).length>0||Object.keys(t.pointer||{}).length>0||Object.keys(t.set||{}).length>0||t.meta?!1:!0}function D(t,e){var n,i=e.split("/");for(i.shift(),n=0;n<i.length;n++)t[i[n]]=t[i[n]]||{},t=t[i[n]];return t}function I(e,n){var i,o,r,s,a,l=function(e){var i=JSON.parse(JSON.stringify(n.source[e]||{})),o=JSON.parse(JSON.stringify(n.target[e]||{}));return o.base?!1:(delete i.base,t.stringify(i)===t.stringify(o))};for(o=Object.keys(n.source||{}),i=0;i<o.length;i++)if(a=D(e,o[i]),a.removed!==!0&&!l(o[i]))for(a.pointer=a.pointer||{source:{},target:{}},a.pointer.source=a.pointer.source||{},a.pointer.target=a.pointer.target||{},r=Object.keys(n.source[o[i]]),s=0;s<r.length;s++)a.pointer.source[r[s]]=n.source[o[i]][r[s]];for(o=Object.keys(n.target||{}),i=0;i<o.length;i++)if(a=D(e,o[i]),a.removed!==!0&&!l(o[i]))for(a.pointer=a.pointer||{source:{},target:{}},r=Object.keys(n.target[o[i]]),s=0;s<r.length;s++)a.pointer.target[r[s]]=n.target[o[i]][r[s]]}function P(t,i){var o=Mt.nodeDiff(t,i)||{},r=u(t,i),s=function(t,e){for(var n=0;n<t.length;n++)if(Mt.getRelid(t[n])===e)return t[n];return null};return e.call(function(a,c){function d(t,e){var n=Mt.getRelid(t),i=Mt.getRelid(e);return i>n?-1:n>i?1:0}n(a.length>=0&&c.length>=0),a.sort(d),c.sort(d);var h,p,g,u,f,m,_=function(t,e){return o[e]=t,null};for(u=o.children?o.children.removed||[]:[],h=0;h<u.length;h++)o.childrenListChanged=!0,p=s(a,u[h].relid),p&&(f=Mt.getGuid(p),o[u[h].relid]={guid:f,removed:!0,hash:Mt.getHash(p)},Lt[f]=Lt[f]||{},Lt[f].from=p,Lt[f].fromExpanded=!1);for(u=o.children?o.children.added||[]:[],h=0;h<u.length;h++)o.childrenListChanged=!0,p=s(c,u[h].relid),p&&(f=Mt.getGuid(p),m=Mt.getBase(p),o[u[h].relid]={guid:f,removed:!1,hash:Mt.getHash(p),pointer:{source:{},target:{base:null===m?null:Mt.getPath(m)}}},Lt[f]=Lt[f]||{},Lt[f].to=p,Lt[f].toExpanded=!1);for(h=0;h<c.length;h++)p=s(a,Mt.getRelid(c[h])),p&&Mt.getHash(c[h])!==Mt.getHash(p)&&(g=e.call(_,P(p,c[h]),Mt.getRelid(p),g));return e.call(function(){return delete o.children,I(o,r),l(o),Object.keys(o).length>0?(o.guid=Mt.getGuid(i),o.hash=Mt.getHash(i),o.oGuids=T(i),e.call(function(t){return t},A(i,t,"",o))):o},g)},Mt.loadChildren(t),Mt.loadChildren(i))}function T(t){for(var e={},n=function(t){for(;t;)e[Mt.getGuid(t)]=!0,t=Mt.getParent(t)};t;)n(t),t=Mt.getBase(t);return e}function A(t,n,i,o){var r,s,a=k(o),l=function(t,e){return o[e]=t,null};for(r=0;r<a.length;r++)s=e.call(l,A(t,n,i+"/"+a[r],o[a[r]]),a[r]);return e.call(function(){return e.call(function(t,e){return t||(t=e),o.guid=Mt.getGuid(t),o.hash=Mt.getHash(t),o.oGuids=T(t),o},Mt.loadByPath(t,i),Mt.loadByPath(n,i))},s)}function x(t,n){var i={guid:Mt.getGuid(t),hash:Mt.getHash(t),removed:n===!0};return e.call(function(t){for(var e,o=0;o<t.length;o++)e=Mt.getGuid(t[o]),i[Mt.getRelid(t[o])]={guid:e,hash:Mt.getHash(t[o]),removed:n===!0},n?(Lt[e]=Lt[e]||{},Lt[e].from=t[o],Lt[e].fromExpanded=!1):(Lt[e]=Lt[e]||{},Lt[e].to=t[o],Lt[e].toExpanded=!1);return i},Mt.loadChildren(t))}function w(t,e){var n,i=t.split("/"),o=i.pop(),r=kt;for(i.shift(),n=0;n<i.length;n++)r=r[i[n]];r[o]=O(r[o],e)}function N(t,e){var n,i,o={},s=Object.keys(t),a=Object.keys(e);for(i=0;i<s.length;i++)-1===a.indexOf(s[i])&&(o[s[i]]=r.TO_DELETE_STRING);for(i=0;i<a.length;i++)-1===s.indexOf(a[i])?o[a[i]]=e[a[i]]:typeof e[a[i]]==typeof t[a[i]]&&"object"==typeof e[a[i]]&&null!==e[a[i]]&&null!==t[a[i]]?(n=N(t[a[i]],e[a[i]]),Object.keys(n).length>0&&(o[a[i]]=n)):t[a[i]]!==e[a[i]]&&(o[a[i]]=e[a[i]]);return o}function O(t,e){var n,i={},o=Object.keys(t),r=Object.keys(e);for(n=0;n<o.length;n++)i[o[n]]=t[o[n]];for(n=0;n<r.length;n++)-1===o.indexOf(r[n])?i[r[n]]=e[r[n]]:typeof e[r[n]]!=typeof t[r[n]]||"object"!=typeof e[r[n]]||e instanceof Array?i[r[n]]=e[r[n]]:i[r[n]]=O(t[r[n]],e[r[n]]);return i}function S(t,e){var n,i,o;if(""===e)t=null;else{for(o=e.split("/"),o.shift(),n=o.pop(),i=0;i<o.length;i++)t=t[o[i]];delete t[n]}}function R(t){var e=function(n){if(n){var i,o=k(n);if("string"==typeof n.movedFrom&&S(t,n.movedFrom),(n.removed!==!1||"string"==typeof n.movedFrom)&&delete n.hash,n.removed===!0)for(i=0;i<o.length;i++)delete n[o[i]];else for(i=0;i<o.length;i++)e(n[o[i]])}};e(t)}function M(){var t,n,i,o=Object.keys(Lt),r=function(t,e){return t.guid=Mt.getGuid(e.from),t.movedFrom=Mt.getPath(e.from),t.ooGuids=T(e.from),Gt[Mt.getPath(e.from)]=Mt.getPath(e.to),rt(kt,Mt.getPath(e.to),t),null},s=function(t,e){return t.hash=Mt.getHash(e.from),t.removed=!0,w(Mt.getPath(e.from),t),null},a=function(t,e){return t.hash||(t.hash=Mt.getHash(e.to)),t.removed=!1,w(Mt.getPath(e.to),t),null};if(Bt!==!0||o.length<1)return R(kt),b(),JSON.parse(JSON.stringify(kt));for(Bt=!1,i=0;i<o.length;i++)n=Lt[o[i]],n.from&&n.to?(Bt=!0,delete Lt[o[i]],t=e.call(r,P(n.from,n.to),n)):n.from&&n.fromExpanded===!1?(n.fromExpanded=!0,Bt=!0,t=e.call(s,x(n.from,!0),n)):n.to&&n.toExpanded===!1&&(n.toExpanded=!0,Bt=!0,t=e.call(a,x(n.to,!1),n));return e.call(M,t)}function L(t){var e,n=Object.keys(t||{}),i={hash:!0,attr:!0,reg:!0,pointer:!0,set:!0,meta:!0,movedFrom:!0,removed:!0};for(e=0;e<n.length;e+=1)if(i[n[e]])return!0;return!1}function k(t){var e,n=Object.keys(t||{}),i=[],o={guid:!0,hash:!0,attr:!0,reg:!0,pointer:!0,set:!0,meta:!0,removed:!0,movedFrom:!0,childrenListChanged:!0,oGuids:!0,ooGuids:!0,min:!0,max:!0};for(e=0;e<n.length;e++)o[n[e]]||i.push(n[e]);return i}function B(t,e,n,i){var o,r=k(t);for(o=0;o<r.length;o++)B(t[r[o]],e+"/"+r[o],n,i);"string"==typeof t.movedFrom&&(n[e]=t.movedFrom,i[t.movedFrom]=e)}function j(t){return t=t.split("/"),t.splice(-1,1),t.join("/")}function G(t,e,n,i){var r,s,a,l,c,d,h,p,g,u=k(n),f={};if(n.guid!==i.guid&&"string"==typeof n.guid&&"string"==typeof i.guid){if(n.movedFrom&&i.movedFrom)s=Nt,c=i,h=St.getExtensionSourceFromDestination,p=St.getExtensionDestinationFromSource;else if(n.movedFrom&&i.removed===!1)s=wt,c=n,h=St.getBaseSourceFromDestination,p=St.getBaseDestinationFromSource;else{if(!i.movedFrom||n.removed!==!1)throw new Error("there is a guid mismatch among the two diffs: "+n.guid+" vs "+i.guid);s=Nt,c=i,h=St.getExtensionSourceFromDestination,p=St.getExtensionDestinationFromSource}for(d=k(D(wt,j(t))).concat(k(D(Nt,j(t)))),f={},r=0;r<d.length;r+=1)f[d[r]]={};a=o.generateRelid(f),l=j(t)+"/"+a,g=D(s,j(t)),g[a]=c,delete g[e],h[l]=h[t],delete h[t],p[h[l]]=l}for(r=0;r<u.length;r+=1)i[u[r]]&&G(t+"/"+u[r],u[r],n[u[r]],i[u[r]])}function F(t,e){var n="",i=t.split("/"),o=e.split("/"),r=0;if(i.shift(),o.shift(),i.length>0&&o.length>0)for(;r<i.length&&i[r]===o[r];)n+="/"+i[r],r+=1;return n}function W(t,n,i){var o=F(n,i);return e.call(function(t){var e=n.substr(o.length),r=i.substr(o.length);s.overlayInsert(t,e,"base",r)},Mt.loadByPath(t,o))}function $(t){var e,n,i=k(t),o=[];for(e=0;e<i.length;e+=1)t[i[e]].movedFrom?(n=t[i[e]].movedFrom,n=n.split("/"),n=n[n.length-1],n!==i[e]?o.push(i[e]):o.unshift(i[e])):o.unshift(i[e]);return o}function z(t,n){var i,o,r,s,a=$(n),l=function(t,e,i,o,r,s){var a;return r===!0&&(t=Mt.moveNode(t,o),a=Mt.getRelid(t),i!==a&&(n[a]=JSON.parse(JSON.stringify(n[i])),delete n[i])),z(t,e,s)};for(i=0;i<a.length;i++)s=!1,n[a[i]].movedFrom?(s=!0,r=Mt.loadByPath(Mt.getRoot(t),n[a[i]].movedFrom),o=e.call(l,r,n[a[i]],a[i],t,s,o)):n[a[i]].removed===!1?n[a[i]].hash&&(Mt.setProperty(t,a[i],n[a[i]].hash),t.childrenRelids=null):(r=Mt.loadChild(t,a[i]),o=e.call(l,r,n[a[i]],a[i],t,s,o));return e.call(function(){return null},o)}function V(t,n,i,o){var r,s=$(i),a=[],l=!1;for(r=0;r<s.length;r+=1)(i[s[r]].removed===!1||o)&&i[s[r]].pointer&&i[s[r]].pointer.base?(l=!0,a[r]=e.join(W(t,n+"/"+s[r],i[s[r]].pointer.base),V(t,n+"/"+s[r],i[s[r]],o||l))):a[r]=e.call(V,t,n+"/"+s[r],i[s[r]],o);return e.lift(a)}function H(t,n,i){var o;return o=Mt.loadByPath(t,n),e.call(function(o){var r,s,a=k(i);if(null===o)return void Rt.warn("Missing node ["+n+"] during patch application. Could be a conflicting conflict resolution.");if(i.removed===!0)return void Mt.deleteNode(o);for(U(o,i.attr||{}),Y(o,i.reg||{}),r=J(o,i),r=e.call(K,o,i.set||{},r),i.meta&&(delete i.meta.empty,r=e.call(it,o,i.meta,r)),s=0;s<a.length;s++)r=e.call(function(){return null},H(t,n+"/"+a[s],i[a[s]]),r);return Mt.getGuid(o)!==i.guid&&i.guid&&(r=e.call(function(){return null},Mt.setGuid(o,i.guid),r)),r},o)}function U(t,e){var n,i;for(i=Object.keys(e),n=0;n<i.length;n++)e[i[n]]===r.TO_DELETE_STRING?Mt.delAttribute(t,i[n]):Mt.setAttribute(t,i[n],e[i[n]])}function Y(t,e){var n,i;for(i=Object.keys(e),n=0;n<i.length;n++)e[i[n]]===r.TO_DELETE_STRING?Mt.delRegistry(t,i[n]):Mt.setRegistry(t,i[n],e[i[n]])}function X(t,n,i){var o;return o=null===i?null:Mt.loadByPath(Mt.getRoot(t),i),e.call(function(e){Mt.setPointer(t,n,e)},o)}function J(t,n){var i,o,s=n.pointer||{},a=Object.keys(s);for(o=0;o<a.length;o++)s[a[o]]===r.TO_DELETE_STRING?Mt.deletePointer(t,a[o]):(n.removed!==!1||"base"!==a[o])&&(i=X(t,a[o],s[a[o]]));return e.call(function(){return null},i)}function q(t,n,i,o){var r=function(e){var o,r=Mt.getMemberOwnAttributeNames(t,n,i);for(o=0;o<r.length;o++)Mt.delMemberAttribute(t,n,i,r[o]);for(r=Object.keys(e),o=0;o<r.length;o++)Mt.setMemberAttribute(t,n,i,r[o],e[r[o]])},s=function(e){var o,r=Mt.getMemberOwnRegistryNames(t,n,i);for(o=0;o<r.length;o++)Mt.delMemberRegistry(t,n,i,r[o]);for(r=Object.keys(e),o=0;o<r.length;o++)Mt.setMemberRegistry(t,n,i,r[o],e[r[o]])};return e.call(function(e){Mt.addMember(t,n,e),r(o.attr||{}),s(o.reg||{})},Mt.loadByPath(Mt.getRoot(t),i))}function K(t,n){var i,o,s,a,l=Object.keys(n);for(s=0;s<l.length;s++)if(n[l[s]]===r.TO_DELETE_STRING)Mt.deleteSet(t,l[s]);else for(Mt.createSet(t,l[s]),o=Object.keys(n[l[s]]),a=0;a<o.length;a++)n[l[s]][o[a]]===r.TO_DELETE_STRING?Mt.delMember(t,l[s],o[a]):i=q(t,l[s],o[a],n[l[s]][o[a]]);return e.call(function(){return null},i)}function Z(t,e){var n,i,o;if(e===r.TO_DELETE_STRING)for(i=Mt.getValidAttributeNames(t),n=0;n<i.length;n++)Mt.delAttributeMeta(t,i[n]);else for(i=Object.keys(e),n=0;n<i.length;n++)e[i[n]]===r.TO_DELETE_STRING?Mt.delAttributeMeta(t,i[n]):(o=at(Mt.getAttributeMeta(t,i[n])||{},e[i[n]]),Mt.setAttributeMeta(t,i[n],o))}function Q(t,e){var n,i;if(e===r.TO_DELETE_STRING)for(n=Mt.getConstraintNames(t),i=0;i<n.length;i++)Mt.delConstraint(t,n[i]);else for(n=Object.keys(e),i=0;i<n.length;i++)e[n[i]]===r.TO_DELETE_STRING?Mt.delConstraint(t,n[i]):Mt.setConstraint(t,n[i],at(Mt.getConstraint(t,n[i])||{},e[n[i]]))}function tt(t,n){var i,o,s,a=function(e,n){Mt.setChildMeta(t,e,n.min,n.max)};if(n===r.TO_DELETE_STRING)for(i=Mt.getValidChildrenPaths(t),o=0;o<i.length;o++)Mt.delChildMeta(t,i[o]);else for(Mt.setChildrenMetaLimits(t,n.min,n.max),delete n.max,delete n.min,i=Object.keys(n),o=0;o<i.length;o++)n[i[o]]===r.TO_DELETE_STRING?Mt.delChildMeta(t,i[o]):s=e.call(a,Mt.loadByPath(Mt.getRoot(t),i[o]),n[i[o]],s);e.call(function(){return null},s)}function et(t,n){var i,o,s,a,l,c=function(e,n,i){Mt.setPointerMetaTarget(t,e,n,i.min,i.max)};if(n!==r.TO_DELETE_STRING){for(i=Object.keys(n),s=0;s<i.length;s++)if(n[i[s]]===r.TO_DELETE_STRING)Mt.delPointerMeta(t,i[s]);else for(Mt.setPointerMetaLimits(t,i[s],n[i[s]].min,n[i[s]].max),delete n[i[s]].max,delete n[i[s]].min,o=Object.keys(n[i[s]]),a=0;a<o.length;a++)n[i[s]][o[a]]===r.TO_DELETE_STRING?Mt.delPointerMetaTarget(t,i[s],o[a]):l=e.call(c,i[s],Mt.loadByPath(Mt.getRoot(t),o[a]),n[i[s]][o[a]],l);e.call(function(){return null},l)}else{for(i=Mt.getValidPointerNames(t),s=0;s<i.length;s++)Mt.delPointerMeta(t,i[s]);for(i=Mt.getValidSetNames(t),s=0;s<i.length;s++)Mt.delPointerMeta(t,i[s])}}function nt(t,n){var i,o,s,a,l,c=function(e,n){Mt.setAspectMetaTarget(t,e,n)};if(n!==r.TO_DELETE_STRING){for(i=Object.keys(n),s=0;s<i.length;s++)if(n[i[s]]===r.TO_DELETE_STRING)Mt.delAspectMeta(t,i[s]);else for(o=n[i[s]],a=0;a<o.length;a++)n[i[s]][o[a]]===r.TO_DELETE_STRING?Mt.delAspectMetaTarget(t,i[s],o[a]):l=e.call(c,i[s],Mt.loadByPath(Mt.getRoot(t),o[a]),l);e.call(function(){return null},l)}else for(i=Mt.getValidAspectNames(t),s=0;s<i.length;s++)Mt.delAspectMeta(t,i[s])}function it(t,n){var i;Z(t,n.attributes||r.TO_DELETE_STRING),Q(t,n.constraints||r.TO_DELETE_STRING),i=tt(t,n.children||r.TO_DELETE_STRING),i=e.call(et,t,n.pointers||r.TO_DELETE_STRING,i),i=e.call(nt,t,n.aspects||r.TO_DELETE_STRING,i),e.call(function(){return null},i)}function ot(t,e){var n,o,r;if(i.GUID.test(e)!==!0)return null;if(t.guid===e)return t;for(n=k(t),o=0;o<n.length;o++)if(r=ot(t[n[o]],e))return r;return null}function rt(t,e,i){n("string"==typeof e);var o,r,s,a;if(""===e)return void(Tt=JSON.parse(JSON.stringify(i)));for(a=e.match(/\/\/.*\/\//)||[],a=a[0]||"there is no nodepath in the path",e=e.replace(a,"/*nodepath*/"),a=a.replace(/\/\//g,"/"),a=a.slice(0,-1),e=e.split("/"),e.shift(),-1!==e.indexOf("*nodepath*")&&(e[e.indexOf("*nodepath*")]=a),s=e.pop(),r=t,o=0;o<e.length;o++)r[e[o]]=r[e[o]]||{},r=r[e[o]];r[s]=JSON.parse(JSON.stringify(i))}function st(t){var e,n=JSON.parse(JSON.stringify(t)),i=k(n);for(e=0;e<i.length;e++)delete n[i[e]];return n}function at(t,e){var n,i=Object.keys(t),o=Object.keys(e),r=JSON.parse(JSON.stringify(t));for(n=0;n<o.length;n++)-1===i.indexOf(o[n])?r[o[n]]=JSON.parse(JSON.stringify(e[o[n]])):"object"==typeof t[o[n]]&&"object"==typeof e[o[n]]?r[o[n]]=at(t[o[n]],e[o[n]]):r[o[n]]=JSON.parse(JSON.stringify(e[o[n]]));return r}function lt(t,e,n){var o,r,s;if(i.GUID.test(e)!==!0)return null;if(t.guid===e)return n;for(o=k(t),r=0;r<o.length;r++)if(s=lt(t[o[r]],e,n+"/"+o[r]))return s;return null}function ct(t){return St.getExtensionSourceFromDestination[t]&&(t=St.getExtensionSourceFromDestination[t]),St.getBaseDestinationFromSource[t]&&(t=St.getBaseDestinationFromSource[t]),t}function dt(t){var e,n=k(t);if(t.removed!==!0)for(t.movedFrom&&(void 0!==Ot[t.guid]?delete Ot[t.guid]:Ot[t.guid]=!1),e=0;e<n.length;e++)dt(t[n[e]]);else Ot[t.guid]===!1?delete Ot[t.guid]:Ot[t.guid]=!0}function ht(t,e){var n=function(t,e,i){var o,r;for(i===!0&&(e.guid&&(t.guid=e.guid),e.oGuids&&(t.oGuids=e.oGuids),e.ooGuids&&(t.ooGuids=e.ooGuids),"boolean"!=typeof e.removed||e.removed||(t.removed=e.removed),e.hash&&(t.hash=e.hash),e.childrenListChanged&&(t.childrenListChanged=!0)),r=k(e),o=0;o<r.length;o+=1)void 0===t[r[o]]?"string"!=typeof e[r[o]].movedFrom&&(t[r[o]]={},n(t[r[o]],e[r[o]],!0)):n(t[r[o]],e[r[o]],!1)};n(t,e,0===Object.keys(t).length)}function pt(t){var e,n,i=[];for(e=Object.keys(t.oGuids||{}),n=0;n<e.length;n++)Ot[e[n]]&&i.push(e[n]);for(e=Object.keys(t.ooGuids||{}),n=0;n<e.length;n++)Ot[e[n]]&&i.push(e[n]);return i}function gt(t){var e=[],n=function(i){var o,r;for((i.oGuids&&i.oGuids[t]||i.ooGuids&&i.ooGuids[t])&&e.push(i.guid),o=k(i),r=0;r<o.length;r++)n(i[o[r]])};return n(wt),e}function ut(t,e,i,o){var s,a,l,c,d=function(t,e){var n,i;for(n=Object.keys(e),i=0;i<n.length;i++)s[t+"/"+n[i]]=s[t+"/"+n[i]]||{value:e[n[i]],conflictingPaths:{}},s[t+"/"+n[i]].conflictingPaths[o]=!0,a.conflictingPaths[t+"/"+n[i]]=!0};if(e===!0?(s=At,a=xt[o]):(s=xt,a=At[o]),n(a),t.movedFrom&&(s[i]=s[i]||{value:i,conflictingPaths:{}},s[i].conflictingPaths[o]=!0,a.conflictingPaths[i]=!0),d(i+"/attr",t.attr||{}),d(i+"/reg",t.reg||{}),d(i+"/pointer",t.pointer||{}),t.set)if(t.set===r.TO_DELETE_STRING)s[i+"/set"]=s[i+"/set"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},s[i+"/set"].conflictingPaths[o]=!0,a.conflictingPaths[i+"/set"]=!0;else for(l=Object.keys(t.set),c=0;c<l.length;c++)t.set[l[c]]===r.TO_DELETE_STRING?(s[i+"/set/"+l[c]]=s[i+"/set/"+l[c]]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},s[i+"/set/"+l[c]].conflictingPaths[o]=!0,a.conflictingPaths[i+"/set/"+l[c]]=!0):ft(t.set[l[c]],e,i+"/set/"+l[c],o);if(t.meta&&bt(t.meta,e,i+"/meta",o),e)for(l=k(t),c=0;c<l.length;c++)ut(t[l[c]],!0,i+"/"+l[c],o)}function ft(t,e,n,i){var o,s,a,l,c,d=k(t);for(e===!0?(l=At,c=xt[i]):(l=xt,c=At[i]),o=0;o<d.length;o++)if(t[d[o]]===r.TO_DELETE_STRING)l[n+"/"+d[o]+"/"]=l[n+"/"+d[o]+"/"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},l[n+"/"+d[o]+"/"].conflictingPaths[i]=!0,c.conflictingPaths[n+"/"+d[o]+"/"]=!0;else{for(s=Object.keys(t[d[o]].attr||{}),a=0;a<s.length;a++)l[n+"/"+d[o]+"//attr/"+s[a]]=l[n+"/"+d[o]+"//attr/"+s[a]]||{value:t[d[o]].attr[s[a]],conflictingPaths:{}},l[n+"/"+d[o]+"//attr/"+s[a]].conflictingPaths[i]=!0,c.conflictingPaths[n+"/"+d[o]+"//attr/"+s[a]]=!0;for(s=Object.keys(t[d[o]].reg||{}),a=0;a<s.length;a++)l[n+"/"+d[o]+"//reg/"+s[a]]=l[n+"/"+d[o]+"//reg/"+s[a]]||{value:t[d[o]].reg[s[a]],conflictingPaths:{}},l[n+"/"+d[o]+"//reg/"+s[a]].conflictingPaths[i]=!0,c.conflictingPaths[n+"/"+d[o]+"//reg/"+s[a]]=!0}}function mt(e,n,i){var o,s,a;for(o=Object.keys(i),s=0;s<o.length;s++)a=i[o[s]],"string"==typeof a&&a!==r.TO_DELETE_STRING&&(a=ct(a)),void 0!==n[o[s]]&&t.stringify(n[o[s]])!==t.stringify(a)?(At[e+"/"+o[s]]={value:n[o[s]],conflictingPaths:{}},xt[e+"/"+o[s]]={value:i[o[s]],conflictingPaths:{}},At[e+"/"+o[s]].conflictingPaths[e+"/"+o[s]]=!0,xt[e+"/"+o[s]].conflictingPaths[e+"/"+o[s]]=!0):n[o[s]]=i[o[s]]}function _t(t,e,n){var i,o,s,a,l=Object.keys(n);for(o=0;o<l.length;o++)if(e[l[o]])if(e[l[o]]===r.TO_DELETE_STRING)n[l[o]]!==r.TO_DELETE_STRING&&(At[t+"/"+l[o]]={value:r.TO_DELETE_STRING,conflictingPaths:{}},ft(n[l[o]],!1,t+"/"+l[o],t+"/"+l[o]));else if(n[l[o]]===r.TO_DELETE_STRING)xt[t+"/"+l[o]]={value:r.TO_DELETE_STRING,conflictingPaths:{}},ft(e[l[o]],!0,t+"/"+l[o],t+"/"+l[o]);else for(i=k(n[l[o]]),s=0;s<i.length;s++)a=ct(i[s]),e[l[o]][a]?e[l[o]][a]===r.TO_DELETE_STRING?n[l[o]][i[s]]!==r.TO_DELETE_STRING&&(At[t+"/"+l[o]+"/"+a+"//"]={value:r.TO_DELETE_STRING,conflictingPaths:{}},ut(n[l[o]][i[s]],!1,t+"/"+l[o]+"/"+a+"//",t+"/"+l[o]+"/"+a+"//")):n[l[o]][i[s]]===r.TO_DELETE_STRING?(xt[t+"/"+l[o]+"/"+a+"//"]={value:r.TO_DELETE_STRING,conflictingPaths:{}},ut(e[l[o]][a],!0,t+"/"+l[o]+"/"+a+"//",t+"/"+l[o]+"/"+a+"//")):(n[l[o]][i[s]].attr&&(e[l[o]][a].attr?mt(t+"/"+l[o]+"/"+a+"//attr",e[l[o]][a].attr,n[l[o]][i[s]].attr):e[l[o]][a].attr=n[l[o]][i[s]].attr),n[l[o]][i[s]].reg&&(e[l[o]][a].reg?mt(t+"/"+l[o]+"/"+a+"//reg",e[l[o]][a].reg,n[l[o]][i[s]].reg):e[l[o]][a].reg=n[l[o]][i[s]].reg)):e[l[o]][a]=n[l[o]][i[s]];else e[l[o]]=n[l[o]]}function bt(t,e,n,i){var o,s,a,l,c,d,h,p;if(e?(o=At,s=xt[i]):(o=xt,s=At[i]),t===r.TO_DELETE_STRING)return o[n]=o[n]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n].conflictingPaths[i]=!0,void(s.conflictingPaths[n]=!0);if(t.children)if(t.children===r.TO_DELETE_STRING)o[n+"/children"]=o[n+"/children"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n+"/children"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/children"]=!0;else for(t.children.max&&(o[n+"/children/max"]=o[n+"/children/max"]||{value:t.children.max,conflictingPaths:{}},o[n+"/children/max"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/children/max"]=!0),t.children.min&&(o[n+"/children/min"]=o[n+"/children/min"]||{value:t.children.min,conflictingPaths:{}},o[n+"/children/min"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/children/min"]=!0),a=k(t.children),l=0;l<a.length;l++)o[n+"/children/"+a[l]]=o[n+"/children/"+a[l]]||{value:t.children[a[l]],conflictingPaths:{}},o[n+"/children/"+a[l]].conflictingPaths[i]=!0,s.conflictingPaths[n+"/children/"+a[l]]=!0;if(t.attributes)if(t.attributes===r.TO_DELETE_STRING)o[n+"/attributes"]=o[n+"/attributes"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n+"/attributes"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/attributes"]=!0;else for(d=Object.keys(t.attributes),l=0;l<d.length;l++)p=n+"/attributes/"+d[l],o[p]=o[p]||{value:t.attributes[d[l]],conflictingPaths:{}},o[p].conflictingPaths[i]=!0,s.conflictingPaths[p]=!0;if(t.pointers)if(t.pointers===r.TO_DELETE_STRING)o[n+"/pointers"]=o[n+"/pointers"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n+"/pointers"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers"]=!0;else for(d=Object.keys(t.pointers),l=0;l<d.length;l++)if(t.pointers[d[l]]===r.TO_DELETE_STRING)o[n+"/pointers/"+d[l]]=o[n+"/pointers/"+d[l]]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n+"/pointers/"+d[l]].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers/"+d[l]]=!0;else for(t.pointers[d[l]].max&&(o[n+"/pointers/"+d[l]+"/max"]=o[n+"/pointers/"+d[l]+"/max"]||{value:t.pointers[d[l]].max,conflictingPaths:{}},o[n+"/pointers/"+d[l]+"/max"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers/"+d[l]+"/max"]=!0),t.pointers[d[l]].min&&(o[n+"/pointers/"+d[l]+"/min"]=o[n+"/pointers/"+d[l]+"/min"]||{value:t.pointers[d[l]].min,conflictingPaths:{}},o[n+"/pointers/"+d[l]+"/min"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers/"+d[l]+"/min"]=!0),a=k(t.pointers[d[l]]),c=0;c<a.length;c++)h=ct(a[c]),o[n+"/pointers/"+d[l]+"/"+h+"//"]=o[n+"/pointers/"+d[l]+"/"+h+"//"]||{value:t.pointers[d[l]][a[c]],conflictingPaths:{}},o[n+"/pointers/"+d[l]+"/"+h+"//"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers/"+d[l]+"/"+h+"//"]=!0}function yt(e,n,i){var o,s,a,l,c,d,h=function(e,n,i){var o,s,a,l,c;if(n===r.TO_DELETE_STRING||i===r.TO_DELETE_STRING)t.stringify(n)!==t.stringify(i)&&(At[e]=At[e]||{value:n,conflictingPaths:{}},At[e].conflictingPaths[e]=!0,xt[e]=xt[e]||{value:i,conflictingPaths:{}},xt[e].conflictingPaths[e]=!0);else for(i.max&&(n.max&&n.max!==i.max?(l=e+"/max",At[l]=At[l]||{value:n.max,conflictingPaths:{}},At[l].conflictingPaths[l]=!0,xt[l]=xt[l]||{value:i.max,conflictingPaths:{}},xt[l].conflictingPaths[l]=!0):n.max=i.max),i.min&&(n.min&&n.min!==i.min?(l=e+"/min",At[l]=At[l]||{value:n.min,conflictingPaths:{}},At[l].conflictingPaths[l]=!0,xt[l]=xt[l]||{value:i.min,conflictingPaths:{}},xt[l].conflictingPaths[l]=!0):n.min=i.min),o=k(n),s=k(i),a=0;a<s.length;a++)l=ct(s[a]),-1!==o.indexOf(l)&&t.stringify(n[l])!==t.stringify(i[s[a]])?(c=l,l=e+"/"+l+"//",At[l]=At[l]||{value:n[c],conflictingPaths:{}},At[l].conflictingPaths[l]=!0,xt[l]=xt[l]||{value:i[s[a]],conflictingPaths:{}},xt[l].conflictingPaths[l]=!0):n[l]=i[s[a]]};if(t.stringify(n)!==t.stringify(i))if(n===r.TO_DELETE_STRING)At[e]=At[e]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},bt(i,!1,e,e);else if(i===r.TO_DELETE_STRING)xt[e]=xt[e]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},bt(n,!0,e,e);else{if(i.children&&(n.children?h(e+"/children",n.children,i.children):n.children=i.children),i.pointers)if(n.pointers)if(n.pointers===r.TO_DELETE_STRING||i.pointers===r.TO_DELETE_STRING)t.stringify(n.pointers)!==t.stringify(i.pointers)&&(a=e+"/pointers",At[a]=At[a]||{value:n.pointers,conflictingPaths:{}},At[a].conflictingPaths[a]=!0,xt[a]=xt[a]||{value:i.pointers,conflictingPaths:{}},xt[a].conflictingPaths[a]=!0);else for(o=Object.keys(i.pointers),s=0;s<o.length;s++)n.pointers[o[s]]?h(e+"/pointers/"+o[s],n.pointers[o[s]],i.pointers[o[s]]):n.pointers[o[s]]=i.pointers[o[s]];else n.pointers=i.pointers;if(i.attributes)if(n.attributes)if(i.attributes===r.TO_DELETE_STRING||n.attributes===r.TO_DELETE_STRING)t.stringify(n.attributes)!==t.stringify(i.attributes)&&(a=e+"/attributes",At[a]=At[a]||{value:n.attributes,conflictingPaths:{}},At[a].conflictingPaths[a]=!0,xt[a]=xt[a]||{value:i.attributes,conflictingPaths:{}},xt[a].conflictingPaths[a]=!0);else for(o=Object.keys(i.attributes),s=0;s<o.length;s++)n.attributes[o[s]]?i.attributes[o[s]]===r.TO_DELETE_STRING||n.attributes[o[s]]===r.TO_DELETE_STRING?t.stringify(n.attributes[o[s]])!==t.stringify(i.attributes[o[s]])&&(a=e+"/attributes/"+[o[s]],At[a]=At[a]||{value:n.attributes[o[s]],conflictingPaths:{}},At[a].conflictingPaths[a]=!0,xt[a]=xt[a]||{value:i.attributes[o[s]],conflictingPaths:{}},xt[a].conflictingPaths[a]=!0):mt(e+"/attributes/"+o[s],n.attributes[o[s]],i.attributes[o[s]]):n.attributes[o[s]]=i.attributes[o[s]];else n.attributes=i.attributes;if(i.aspects)if(n.aspects)if(i.aspects===r.TO_DELETE_STRING||n.aspects===r.TO_DELETE_STRING)t.stringify(n.aspects)!==t.stringify(i.aspects)&&(a=e+"/aspects",At[a]=At[a]||{value:n.aspects,conflictingPaths:{}},At[a].conflictingPaths[a]=!0,xt[a]=xt[a]||{value:i.aspects,conflictingPaths:{}},xt[a].conflictingPaths[a]=!0);else for(o=Object.keys(i.aspects),s=0;s<o.length;s++)if(n.aspects[o[s]])if(i.aspects[o[s]]===r.TO_DELETE_STRING||n.aspects[o[s]]===r.TO_DELETE_STRING)t.stringify(n.aspects[o[s]])!==t.stringify(i.aspects[o[s]])&&(a=e+"/aspects/"+o[s],At[a]=At[a]||{value:n.aspects[o[s]],conflictingPaths:{}},At[a].conflictingPaths[a]=!0,xt[a]=xt[a]||{value:i.aspects[o[s]],conflictingPaths:{}},xt[a].conflictingPaths[a]=!0);else for(c=Object.keys(i.aspects[o[s]]),l=0;l<c.length;l++)a=ct(c[l]),n.aspects[o[s]][a]?t.stringify(n.aspects[o[s]][a])!==t.stringify(i.aspects[o[s]][c[l]])&&(d=a,a=e+"/aspects/"+o[s]+"/"+a+"//",At[a]=At[a]||{value:n.aspects[o[s]][d],conflictingPaths:{}},At[a].conflictingPaths[a]=!0,xt[a]=xt[a]||{value:i.aspects[o[s]][c[l]],conflictingPaths:{}},xt[a].conflictingPaths[a]=!0):n.aspects[o[s]][a]=i.aspects[o[s]][c[l]];else n.aspects[o[s]]=i.aspects[o[s]];else n.aspects=i.aspects;
}}function vt(t,e){var i,o,r=t.guid,s=pt(t),a=ot(wt,r),l=lt(wt,r,""),c=a,d=k(t);if(t.removed===!0)if(a&&a.removed!==!0&&L(a))for(o=l+"/removed",xt[o]=xt[o]||{value:!0,conflictingPaths:{}},s=gt(r),n(s.length>0),i=0;i<s.length;i++)a=ot(wt,s[i]),l=lt(wt,s[i],""),ut(a,!0,l,o);else rt(wt,e,t);else if(s.length>0)for(i=0;i<s.length;i++)a=ot(wt,s[i]),l=lt(wt,s[i],""),L(t)?(At[l+"/removed"]=At[l+"/removed"]||{value:!0,conflictingPaths:{}},ut(t,!1,e,l+"/removed")):(xt[l+"/removed"]=xt[l+"/removed"]||{value:!0,conflictingPaths:{}},ut(c,!0,e,l+"/removed"));else a?(t.movedFrom&&(a.movedFrom&&e!==l?(At[l]=At[l]||{value:"move",conflictingPaths:{}},xt[e]=xt[e]||{value:"move",conflictingPaths:{}},At[l].conflictingPaths[e]=!0,xt[e].conflictingPaths[l]=!0,e=l):e!==l&&(a.movedFrom=t.movedFrom,rt(wt,e,a),S(wt,l),a=ot(wt,r),l=lt(wt,r,""),n(e===l))),n(l===e||a.movedFrom===e),e=l,t.attr&&(a.attr?mt(e+"/attr",a.attr,t.attr):rt(wt,e+"/attr",t.attr)),t.reg&&(a.reg?mt(e+"/reg",a.reg,t.reg):rt(wt,e+"/reg",t.reg)),t.pointer&&(a.pointer?mt(e+"/pointer",a.pointer,t.pointer):rt(wt,e+"/pointer",t.pointer)),t.set&&(a.set?_t(e+"/set",a.set,t.set):rt(wt,e+"/set",t.set)),t.meta&&(a.meta?yt(e+"/meta",a.meta,t.meta):rt(wt,e+"/meta",t.meta))):rt(wt,e,st(t));for(i=0;i<d.length;i++)vt(t[d[i]],e+"/"+d[i])}function Ct(){var t,e,i,o,r=[];for(t=Object.keys(At),e=0;e<t.length;e++)for(o=Object.keys(At[t[e]].conflictingPaths||{}),n(o.length>0),i=0;i<o.length;i++)r.push({selected:"mine",mine:{path:t[e],info:t[e].replace(/\//g," / "),value:At[t[e]].value},theirs:{path:o[i],info:o[i].replace(/\//g," / "),value:xt[o[i]].value}});return r}function Et(t){var e,n,i,o,r=k(t);for(e=Object.keys(t.pointer||{}),n=0;n<e.length;n++)t.pointer[e[n]]=ct(t.pointer[e[n]]);for(e=Object.keys(t.set||{}),n=0;n<e.length;n++)for(i=Object.keys(t.set[e[n]]||{}),o=0;o<i.length;o++)i[o]!==ct(i[o])&&(t.set[e[n]][ct(i[o])]=t.set[e[n]][i[o]],delete t.set[e[n]][i[o]]);for(n=0;n<r.length;n++)Et(t[r[n]])}function Dt(t){return n("string"==typeof t),t.split("/").length}function It(t){var e,n,i={},o=[],r=function(t){var e,n=Object.keys(i),o=-1,r=null;for(e=0;e<n.length;e++)1===t.indexOf(n[e])&&Dt(n[e])>o&&(r=n[e],o=Dt(n[e]));return r};for(e=0;e<t.items.length;e++)"theirs"===t.items[e].selected&&"move"===t.items[e].theirs.value?(i[t.items[e].mine.path]=t.items[e].theirs.path,rt(t.merge,t.items[e].theirs.path,D(t.merge,t.items[e].mine.path)),S(t.merge,t.items[e].mine.path)):o.push(t.items[e]);for(t.items=o,e=0;e<t.items.length;e++)"theirs"===t.items[e].selected&&(n=r(t.items[e].theirs.path),n&&(t.items[e].theirs.path=t.items[e].theirs.path.replace(n,i[n])),n=r(t.items[e].mine.path),n&&(t.items[e].mine.path=t.items[e].mine.path.replace(n,i[n])))}n("object"==typeof a),n("object"==typeof a.globConf),n("undefined"!=typeof a.logger);var Pt,Tt,At,xt,wt,Nt,Ot,St,Rt=a.logger,Mt=this,Lt={},kt={},Bt=!0,jt=0,Gt={},Ft=[];for(Pt in s)this[Pt]=s[Pt];Rt.debug("initialized DiffCore"),this.nodeDiff=function(t,e){var n={children:h(t,e),attr:c(t,e),reg:d(t,e),pointer:p(t,e),set:g(t,e),meta:f(t,e)};return l(n),E(n)?null:n},this.generateTreeDiff=function(t,n){return Lt={},kt={},Gt={},Bt=!0,jt=0,e.call(function(t){return kt=t,M()},P(t,n))},this.generateLightTreeDiff=function(t,e){return P(t,e)},this.applyTreeDiff=function(t,n){var i=z(t,n);return i=e.call(V,t,"",n,i),e.call(function(){return H(t,"",n)},i)},this.tryToConcatChanges=function(t,e){var n={};return Ft=[],At={},xt={},wt=t,Nt=e,Ot={},St={getBaseSourceFromDestination:{},getBaseDestinationFromSource:{},getExtensionSourceFromDestination:{},getExtensionDestinationFromSource:{}},ht(t,e),B(t,"",St.getBaseSourceFromDestination,St.getBaseDestinationFromSource),B(e,"",St.getExtensionSourceFromDestination,St.getExtensionDestinationFromSource),dt(t),dt(e),G("",null,wt,Nt),vt(Nt,""),n.items=Ct(),n.mine=At,n.theirs=xt,n.merge=wt,Et(n.merge),n},this.applyResolution=function(t){var e;for(It(t),e=0;e<t.items.length;e++)"mine"!==t.items[e].selected&&(S(t.merge,t.items[e].mine.path),rt(t.merge,t.items[e].theirs.path,t.items[e].theirs.value));return t.merge}}return s}),define("common/core/metacachecore",["common/core/CoreAssert","common/core/tasync","common/core/constants"],function(t,e,n){"use strict";var i=function(i,o){function r(t){var o,r=i.getMemberPaths(t,n.META_SET_NAME),s=[];return e.call(function(){for(o=0;o<r.length;o+=1)s.push(i.loadByPath(t,r[o]));return e.lift(s)},l.loadPaths(l.getHash(t),JSON.parse(JSON.stringify(r))))}t("object"==typeof o),t("object"==typeof o.globConf),t("undefined"!=typeof o.logger);var s,a=o.logger,l=this;for(s in i)this[s]=i[s];a.debug("initialized MetaCacheCore"),this.loadRoot=function(t){return e.call(function(t){return e.call(function(e){var n=0;for(t.metaNodes={},n=0;n<e.length;n+=1)e[n]&&(t.metaNodes[i.getPath(e[n])]=e[n]);return t},r(t))},i.loadRoot(t))},this.loadByPath=function(t,n){return e.call(function(){return i.loadByPath(t,n)},l.loadPaths(l.getHash(t),[n]))},this.createNode=function(t){var e=i.createNode(t);return t&&t.parent||(e.metaNodes={}),e},this.addMember=function(t,e,o){var r=l.getRoot(t);i.addMember(t,e,o),e===n.META_SET_NAME&&l.getPath(t)===l.getPath(r)&&(r.metaNodes[l.getPath(o)]=o)},this.delMember=function(t,e,o){var r=l.getRoot(t);i.delMember(t,e,o),e===n.META_SET_NAME&&l.getPath(t)===l.getPath(r)&&delete r.metaNodes[o]},this.deleteNode=function(t,e){var n=l.getRoot(t);n.metaNodes[l.getPath(t)]&&delete n.metaNodes[l.getPath(t)],i.deleteNode(t,e)},this.moveNode=function(t,e){var n=l.getRoot(t),o=l.getPath(t),r=i.moveNode(t,e);return n.metaNodes[o]&&(delete n.metaNodes[o],n.metaNodes[l.getPath(r)]=r),r},this.isMetaNode=function(t){var e=l.getRoot(t);return e.metaNodes&&e.metaNodes[l.getPath(t)]?!0:!1},this.getAllMetaNodes=function(t){var e=l.getRoot(t);return e.metaNodes?e.metaNodes:{}},this.getFCO=function(t){var e,n=l.getRoot(t);for(e in n.metaNodes)return l.getBaseRoot(n.metaNodes[e]);return null}};return i}),define("common/core/mixincore",["common/core/CoreAssert","common/core/tasync","common/util/canon","common/core/constants"],function(t,e,n,i){"use strict";var o=function(e,n){function o(t){return-1!==y.getPath(t).indexOf("_")?!1:!0}function r(t){var e,n,i,o=y.getMixinPaths(t),r={},s=[];if(0===o.length)return s;for(e=y.getAllMetaNodes(t),i=0;i<o.length;i+=1)e[o[i]]&&(n=y.getGuid(e[o[i]]),r[n]=o[i],s.push(n));for(s.sort(),i=0;i<s.length;i+=1)s[i]=e[r[s[i]]];return s}function s(t,e){var n,i=y.getAllMetaNodes(t),o={};for(n=0;n<e.length;n+=1)i[e[n]]&&(o[e[n]]=i[e[n]]);return o}function a(t,e){var n;for(n=0;n<e.length;n+=1)-1===t.indexOf(e[n])&&t.push(e[n])}function l(t,e){var n,i={};for(n in t)i[n]=t[n];for(n in e)t[n]||(i[n]=e[n]);return i}function c(t,e,n){var i,o,s=y.getBase(t),l=y.getPath(t),d=r(t);if(n[l])return[];for(i=s?c(s,e,n):[],a(i,e(t)),n[l]=!0,o=0;o<d.length;o+=1)a(i,c(d[o],e,n));return i}function d(t,e,n,i){var o,s=y.getBase(t),a=y.getPath(t),l=r(t),c=null;if(i[a])return null;if(i[a]=!0,-1!==n(t).indexOf(e))return t;if(s&&(c=d(s,e,n,i)))return c;for(o=0;o<l.length;o+=1)if(c=d(l[o],e,n,i))return c;return null}function h(t,e,n,i){var o,s=y.getBase(t),a=y.getPath(t),l=r(t),c=[];if(i[a])return[];for(i[a]=!0,-1!==n(t).indexOf(e)&&c.push(t),s&&(c=c.concat(h(s,e,n,i))),o=0;o<l.length;o+=1)c=c.concat(h(l[o],e,n,i));return c}function p(t,e,n,i){var o=d(t,e,n,{});return o?i(o,e):void 0}function g(t){return e.getOwnValidPointerNames(t).concat(e.getOwnValidSetNames(t))}function u(t){return["containment"]}function f(t,n,i){var o,s,a,l=y.getPath(t);if(i[l])return!1;if(i[l]=!0,e.isTypeOf(t,n))return!0;if(o=y.getBase(t),o&&f(o,n,i))return!0;for(s=r(t),a=0;a<s.length;a+=1)if(f(s[a],n,i))return!0;return!1}function m(t){var e,n=[],i=[],o=[];for(e in t)"min"!==e&&"max"!==e&&(n.push(e),i.push(t[e].min||-1),o.push(t[e].max||-1),delete t[e]);t.items=n,t.minItems=i,t.maxItems=o}t("object"==typeof n),t("object"==typeof n.globConf),t("undefined"!=typeof n.logger);var _,b=n.logger,y=this;for(_ in e)this[_]=e[_];b.debug("initialized MixinCore"),this.isTypeOf=function(t,e){return o(t)?f(t,e,{}):!1},this.isValidChildOf=function(t,n){if(!o(t))return!0;var i,r,s;if(e.isValidChildOf(t,n))return!0;for(i=y.getValidChildrenPaths(n),r=y.getAllMetaNodes(t),s=0;s<i.length;s+=1)if(r[i[s]]&&y.isTypeOf(t,r[i[s]]))return!0;return!1},this.isValidTargetOf=function(t,n,i){if(!o(n)||null===t)return!0;var r,s,a;if(e.isValidTargetOf(t,n,i))return!0;for(r=y.getValidTargetPaths(n,i),s=y.getAllMetaNodes(t),a=0;a<r.length;a+=1)if(s[r[a]]&&y.isTypeOf(t,s[r[a]]))return!0;return!1},this.isValidAttributeValueOf=function(t,n,i){if(!o(t))return!0;var r=d(t,n,e.getOwnValidAttributeNames,{});return r?e.isValidAttributeValueOf(r,n,i):!1},this.getValidPointerNames=function(t){return c(t,e.getOwnValidPointerNames,{})},this.getValidSetNames=function(t){return c(t,e.getOwnValidSetNames,{})},this.getValidAttributeNames=function(t){return o(t)?c(t,e.getOwnValidAttributeNames,{}):[]},this.getValidAspectNames=function(t){return c(t,e.getOwnValidAspectNames,{})},this.getConstraintNames=function(t){return c(t,e.getConstraintNames,{})},this.getJsonMeta=function(t){var e,n,i={children:{},attributes:{},pointers:{},aspects:{},constraints:{}},o={items:[],minItems:[],maxItems:[]};for(i.children=y.getChildrenMeta(t),i.children?m(i.children):i.children=o,e=y.getValidAttributeNames(t),n=0;n<e.length;n+=1)i.attributes[e[n]]=y.getAttributeMeta(t,e[n]);for(e=y.getValidPointerNames(t),n=0;n<e.length;n+=1)i.pointers[e[n]]=y.getPointerMeta(t,e[n]),m(i.pointers[e[n]]);for(e=y.getValidSetNames(t),n=0;n<e.length;n+=1)i.pointers[e[n]]=y.getPointerMeta(t,e[n]),m(i.pointers[e[n]]);for(e=y.getValidAspectNames(t),n=0;n<e.length;n+=1)i.aspects[e[n]]=y.getAspectMeta(t,e[n]);for(e=y.getConstraintNames(t),n=0;n<e.length;n+=1)i.constraints[e[n]]=y.getConstraint(t,e[n]);return i},this.getOwnJsonMeta=function(t){var n=e.getOwnJsonMeta(t),i=this.getMixinPaths(t);return i.length>0&&(n.mixins=i),n},this.getValidChildrenPaths=function(t){return c(t,e.getValidChildrenPaths,{})},this.getChildrenMeta=function(t){var n,i=h(t,"containment",u,{}),o={};for(n=0;n<i.length;n+=1)o=l(o,e.getChildrenMeta(i[n]));return 0===Object.keys(o).length?null:o},this.getPointerMeta=function(t,n){var i,o=h(t,n,g,{}),r={};if(0===o.length)return void 0;for(i=0;i<o.length;i+=1)r=l(r,e.getPointerMeta(o[i],n));return r},this.getValidTargetPaths=function(t,n){var i=function(t){return e.getValidTargetPaths(t,n)};return c(t,i,{})},this.getAttributeMeta=function(t,n){return p(t,n,e.getOwnValidAttributeNames,e.getAttributeMeta)},this.getAspectMeta=function(t,n){return p(t,n,e.getOwnValidAspectNames,e.getAspectMeta)},this.getSetNames=function(t){var n=e.getSetNames(t),o=n.indexOf(i.MIXINS_SET);return-1!==o&&n.splice(o,1),n},this.getMixinErrors=function(t){var e,n,o,s,l,c,d,h,p,g,u,f=[],m=y.getMixinPaths(t),_=y.getAllMetaNodes(t),v=r(t),C=y.getAttribute(t,"name"),E=y.getBase(t);for(b.debug("getMixinErrors("+C+")"),p=0;p<m.length;p+=1)_[m[p]]||(b.error("mixin node is missing from Meta ["+m[p]+"]"),f.push({severity:"error",nodeName:C,type:i.MIXIN_ERROR_TYPE.MISSING,targetInfo:m[p],message:"["+C+"]: mixin node '"+m[p]+"' is missing from the Meta",hint:"Remove mixin or add to the Meta"}));for(o={},l=[],E&&(l=y.getValidAttributeNames(E)),a(l,y.getOwnValidAttributeNames(t)),p=0;p<v.length;p+=1)for(d=y.getAttribute(v[p],"name"),h=y.getPath(v[p]),c=y.getValidAttributeNames(v[p]),g=0;g<c.length;g+=1)-1===l.indexOf(c[g])&&(o[c[g]]?(b.warn("colliding attribute ("+c[g]+") definition ["+o[c[g]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.ATTRIBUTE_COLLISION,nodeName:C,ruleName:c[g],collisionPaths:[o[c[g]].path,h],collisionNodes:[v[o[c[g]].index],v[p]],message:"["+C+"]: inherits attribute definition '"+c[g]+"' from ["+o[c[g]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[g]]={name:d,path:h,index:p});for(o={},l=[],E&&(l=y.getValidChildrenPaths(E)),a(l,y.getOwnValidChildrenPaths(t)),p=0;p<v.length;p+=1)for(d=y.getAttribute(v[p],"name"),c=y.getValidChildrenPaths(v[p]),h=y.getPath(v[p]),g=0;g<c.length;g+=1)-1===l.indexOf(c[g])&&(o[c[g]]?(e=_[c[g]],n=e?"["+y.getAttribute(e,"name")+"]":"'"+c[g]+"'",b.warn("colliding child ("+c[g]+") definition ["+o[c[g]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.CONTAINMENT_COLLISION,nodeName:C,targetInfo:c[g],targetNode:e,collisionPaths:[o[c[g]].path,h],collisionNodes:[v[o[c[g]].index],v[p]],message:"["+C+"]: inherits child definition for "+n+" from ["+o[c[g]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[g]]={name:d,path:h,index:p});for(s=this.getValidPointerNames(t),p=0;p<s.length;p+=1)for(o={},l=[],E&&(l=y.getValidTargetPaths(E,s[p])),a(l,y.getOwnValidTargetPaths(t,s[p])),g=0;g<v.length;g+=1)for(c=y.getValidTargetPaths(v[g],s[p]),d=y.getAttribute(v[g],"name"),h=y.getPath(v[g]),u=0;u<c.length;u+=1)-1===l.indexOf(c[u])&&"min"!==c[u]&&"max"!==c[u]&&(o[c[u]]?(e=_[c[u]],n=e?"["+y.getAttribute(e,"name")+"]":"'"+c[u]+"'",b.warn("colliding pointer ("+s[p]+") target ("+c[u]+") definition ["+o[c[u]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.POINTER_COLLISION,nodeName:C,ruleName:s[p],targetInfo:c[u],targetNode:e,collisionPaths:[o[c[u]].path,h],collisionNodes:[v[o[c[u]].index],v[g]],message:"["+C+"]: inherits pointer ("+s[p]+") target definition of "+n+" from ["+o[c[u]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[u]]={name:d,path:h,index:p});for(s=this.getValidSetNames(t),p=0;p<s.length;p+=1)for(o={},l=[],E&&(l=y.getValidTargetPaths(E,s[p])),a(l,y.getOwnValidTargetPaths(t,s[p])),g=0;g<v.length;g+=1)for(c=y.getValidTargetPaths(v[g],s[p]),d=y.getAttribute(v[g],"name"),h=y.getPath(v[g]),u=0;u<c.length;u+=1)-1===l.indexOf(c[u])&&"min"!==c[u]&&"max"!==c[u]&&(o[c[u]]?(e=_[c[u]],n=e?"["+y.getAttribute(e,"name")+"]":"'"+c[u]+"'",b.warn("colliding set ("+s[p]+") member ("+c[u]+") definition ["+o[c[u]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.SET_COLLISION,nodeName:C,ruleName:s[p],targetInfo:c[u],targetNode:e,collisionPaths:[o[c[u]].path,h],collisionNodes:[v[o[c[u]].index],v[g]],message:"["+C+"]: inherits set ("+s[p]+") member definition of "+n+" from ["+o[c[u]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[u]]={name:d,path:h,index:p});for(o={},l=[],E&&(l=y.getValidAspectNames(E)),a(l,y.getOwnValidAspectNames(t)),p=0;p<v.length;p+=1)for(c=y.getValidAspectNames(v[p]),d=y.getAttribute(v[p],"name"),h=y.getPath(v[p]),g=0;g<c.length;g+=1)-1===l.indexOf(c[g])&&(o[c[g]]?(b.warn("colliding aspect ("+c[g]+") definition ["+o[c[g]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.ASPECT_COLLISION,nodeName:C,ruleName:c[g],collisionPaths:[o[c[g]].path,h],collisionNodes:[v[o[c[g]].index],v[p]],message:"["+C+"]: inherits aspect definition '"+c[g]+"' from ["+o[c[g]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[g]]={name:d,path:h,index:p});for(o={},l=[],E&&(l=y.getConstraintNames(E)),a(l,y.getOwnConstraintNames(t)),p=0;p<v.length;p+=1)for(c=y.getConstraintNames(v[p]),d=y.getAttribute(v[p],"name"),g=0;g<c.length;g+=1)-1===l.indexOf(c[g])&&(o[c[g]]?(b.warn("colliding constraint ("+c[g]+") definition ["+o[c[g]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.CONSTRAINT_COLLISION,nodeName:C,ruleName:c[g],collisionPaths:[o[c[g]].path,h],collisionNodes:[v[o[c[g]].index],v[p]],message:"["+C+"]: inherits constraint definition '"+c[g]+"' from ["+o[c[g]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[g]]={name:d,path:h,index:p});return b.debug("getMixinErrors("+C+") finished"),f},this.getMixinPaths=function(t){return e.getOwnMemberPaths(t,i.MIXINS_SET)},this.getMixinNodes=function(t){var e=y.getMixinPaths(t);return s(t,e)},this.delMixin=function(t,n){e.getAllMetaNodes(t);e.delMember(t,i.MIXINS_SET,n)},this.addMixin=function(t,n){var o=e.getAllMetaNodes(t);o[n]&&e.addMember(t,i.MIXINS_SET,o[n])},this.clearMixins=function(t){y.deleteSet(t,i.MIXINS_SET)},this.getBaseTypes=function(t){var n=e.getBaseType(t),i=[];return n&&(i=r(n),i.unshift(n)),i},this.canSetAsMixin=function(t,n){var i={isOk:!0,reason:""},o=y.getAllMetaNodes(t)[n];return y.getPath(t)===n?(i.isOk=!1,i.reason="Node cannot be mixin of itself!"):o?e.isTypeOf(t,o)&&(i.isOk=!1,i.reason="Base of node cannot be its mixin as well!"):(i.isOk=!1,i.reason="Mixin must be on the Meta!"),i}};return o}),define("common/core/metaquerycore",["common/core/CoreAssert"],function(t){"use strict";var e=function(e,n){function i(t){var e;for(e=t.length;e--;)(s.isConnection(t[e])||s.isAbstract(t[e]))&&t.splice(e,1)}t("object"==typeof n),t("object"==typeof n.globConf),t("undefined"!=typeof n.logger);var o,r=n.logger,s=this;for(o in e)this[o]=e[o];r.debug("initialized MetaQueryCore"),this.isAbstract=function(t){return s.getRegistry(t,"isAbstract")===!0},this.isConnection=function(t){var n=e.getValidPointerNames(t);return-1!==n.indexOf("dst")&&-1!==n.indexOf("src")},this.getValidChildrenMetaNodes=function(t){var n,o,r,a,l=[],c=t.node,d=s.getAllMetaNodes(c),h=Object.keys(d||{}),p={},g=t.children||[];for(r=e.getChildrenMeta(c)||{},n=0;n<h.length;n+=1)s.isValidChildOf(d[h[n]],c)&&l.push(d[h[n]]);if(0===l.length)return l;if(t.sensitive===!0&&i(l),0===l.length)return l;if(t.multiplicity===!0){if(r.max&&r.max>-1&&e.getChildrenRelids(c).length>=r.max)return l=[];if(0===g.length)return l;for(delete r.max,delete r.min,h=Object.keys(r),n=0;n<h.length;n+=1)d[h[n]]?p[h[n]]=0:delete r[h[n]];for(h=Object.keys(r),n=0;n<g.length;n+=1)for(o=0;o<h.length;o+=1)e.isTypeOf(g[n],d[h[o]])&&(p[h[o]]+=1);for(n=l.length,h=Object.keys(p);n--;)for(o=0;o<h.length;o+=1)if(r[h[o]].max&&r[h[o]].max>-1&&r[h[o]].max<=p[h[o]]&&e.isTypeOf(l[n],d[h[o]])){l.splice(n,1);break}}if(0===l.length)return l;if(t.aspect)for(h=e.getAspectMeta(c,t.aspect)||[],n=l.length;n--;){for(a=!1,o=0;o<h.length;o+=1)if(e.isTypeOf(l[n],d[h[o]])){a=!0;break}a||l.splice(n,1)}return l},this.getValidSetElementsMetaNodes=function(t){var n,o,r=[],a=t.node,l=t.name,c=s.getAllMetaNodes(a),d=Object.keys(c||{}),h={},p=t.members||[],g=s.getPointerMeta(a,l)||{};for(n=0;n<d.length;n+=1)c[d[n]]&&s.isValidTargetOf(c[d[n]],a,l)&&r.push(c[d[n]]);if(0===r.length)return r;if(t.sensitive===!0&&i(r),0===r.length)return r;if(t.multiplicity===!0){if(g.max&&g.max>-1&&e.getMemberPaths(a).length>=g.max)return r=[];if(0===p.length)return r;for(delete g.max,delete g.min,d=Object.keys(g),n=0;n<d.length;n+=1)c[d[n]]?h[d[n]]=0:delete g[d[n]];for(d=Object.keys(g),n=0;n<p.length;n+=1)for(o=0;o<d.length;o+=1)e.isTypeOf(p[n],c[d[o]])&&(h[d[o]]+=1);for(n=r.length,d=Object.keys(h);n--;)for(o=0;o<d.length;o+=1)if(g[d[o]].max&&g[d[o]].max>-1&&g[d[o]].max<=h[d[o]]&&e.isTypeOf(r[n],c[d[o]])){r.splice(n,1);break}}return r}};return e}),define("common/core/CoreIllegalOperationError",[],function(){"use strict";function t(){var t=Error.apply(this,arguments);return t.name=this.name="CoreIllegalOperationError",this.message=t.message,this.stack=t.stack,t}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}),define("common/core/librarycore",["common/core/CoreAssert","common/core/tasync","common/core/constants","common/util/random","common/core/CoreIllegalOperationError"],function(t,e,n,i,o){"use strict";var r=function(r,s){function a(t){for(var e=[];t;)N.isLibraryRoot(t)&&e.push(t),t=N.getParent(t);return e}function l(e){t(N.isValidNode(e));var i="";for(e=N.getParent(e);e;)N.isLibraryRoot(e)&&null!==N.getParent(e)&&(i=N.getAttribute(e,"name")+n.NAMESPACE_SEPARATOR+i),e=N.getParent(e);return i}function c(t){var e,n,i,o,r=N.getAllMetaNodes(t),s={};for(e in r)for(n=a(r[e]),i=0;i<n.length;i+=1)o=l(n[i])+N.getAttribute(n[i],"name"),s[o]||(s[o]=n[i]);return s}function d(t,e){return N.getRoot(t).libraryRoots[e]}function h(t){for(;t;){if(N.isLibraryRoot(t)&&!N.isLibraryElement(t))return t;t=N.getParent(t)}return null}function p(t){var n="object"==typeof t,i="",o="",r=function(e){return n?N.getPath(e,t):N.getPath(e)},s=function(t){return N.getFullyQualifiedName(t).substr(o.length)},a=function(t){return n?N.getLibraryGuid(t,i):N.getGuid(t)},l=function(){return n?N.loadSubTree(t):N.loadTree(t)};return n&&(i=N.getAttribute(t,"name"),o=i+"."),e.call(function(t){var e,n,i={};for(n=1;n<t.length;n+=1)e={path:r(t[n]),hash:N.getHash(t[n]),fcn:s(t[n])},i[a(t[n])]=e;return i},l())}function g(t,e){var n,i=N.overlayQuery(t,e);for(n=0;n<i.length;n+=1)(i[n].s===e||i.t===e)&&N.overlayRemove(t,i[n].s,i[n].n,i[n].t)}function u(t,e,n){var i,o=N.overlayQuery(t,e);for(i=0;i<o.length;i+=1)o[i].s===e?(N.overlayRemove(t,o[i].s,o[i].n,o[i].t),N.overlayInsert(t,n,o[i].n,o[i].t)):o[i].t===e&&(N.overlayRemove(t,o[i].s,o[i].n,o[i].t),N.overlayInsert(t,o[i].s,o[i].n,n))}function f(t,e){return t===e?!0:0===t.indexOf(e+n.PATH_SEP)?!0:!1}function m(t,e){var n;for(n in e.selection)if(f(t,n))return!0;return!1}function _(t,e){var n,i,o=a(t),r={};for(n=0;n<o.length;n+=1)i=N.getFullyQualifiedName(o[n]),r[i]={info:N.getLibraryInfo(o[n],i),guid:N.getLibraryGuid(t,i)},r[i].info&&r[i].info.hash&&(r[i].hash=r[i].info.hash);e.bases[N.getGuid(t)]={originGuid:o.length>0?N.getLibraryGuid(t):N.getGuid(t),name:N.getAttribute(t,"name"),fullName:N.getFullyQualifiedName(t),namsespaces:r}}function b(t,e,i){var o,r,s,a,l=N.getPath(t),c=N.getProperty(t,n.OVERLAYS_PROPERTY);for(o in c)if(s=l+o,m(s,i))for(r in c[o])N.isPointerName(r)&&(a=l+c[o][r],r===n.BASE_POINTER?e[a]?(_(e[a],i),i.relations.preserved[s]=i.relations.preserved[s]||{},i.relations.preserved[s][n.BASE_POINTER]=N.getGuid(e[a])):m(a,i)?(i.relations.preserved[s]=i.relations.preserved[s]||{},i.relations.preserved[s][n.BASE_POINTER]=a):(i.relations.lost[s]=i.relations.lost[s]||{},i.relations.lost[s][n.BASE_POINTER]=a):m(a,i)?(i.relations.preserved[s]=i.relations.preserved[s]||{},i.relations.preserved[s][r]=a):(i.relations.lost[s]=i.relations.lost[s]||{},i.relations.lost[s][r]=a))}function y(t){var e,n,i=[],o=[],r={};for(e=0;e<t.length;e+=1)i.push(N.getPath(t[e]));for(e=0;e<i.length;e+=1)for(n=0;n<i.length;n+=1)e!==n&&f(i[n],i[e])&&(r[i[n]]=!0);for(e=0;e<i.length;e+=1)r[i[e]]!==!0&&o.push(t[e]);return o}function v(t,e){var n;for(n in e.hashes)if(f(t,n))return n;return""}function C(t){var e,n,i,o;for(e in t.relations.preserved){n=t.relations.preserved[e];for(i in n)t.bases[n[i]]||(o=v(n[i],t),o?n[i]=n[i].replace(o,t.hashes[o]):(w.error("during closure generation unknown based target ["+n[i]+"] remained."),delete n[i]));o=v(e,t),o?(t.relations.preserved[e.replace(o,t.hashes[o])]=t.relations.preserved[e],delete t.relations.preserved[e]):(w.error("during closure generation unknown based source ["+e+"] remained."),delete t.relations.preserved[e])}}function E(t,e,n){var i,o=Object.keys(n),r=[];for(i=0;i<o.length;i+=1)(N.isLibraryElement(n[o[i]])&&e.bases[t].originGuid===N.getLibraryGuid(n[o[i]])||e.bases[t].originGuid===N.getGuid(n[o[i]]))&&r.push(n[o[i]]);return r}function D(t,e){var n,i,r,s,a=Object.keys(t);for(e.destinationBases={},i=0;i<a.length;i+=1)e.destinationBases[N.getGuid(t[a[i]])]=a[i];for(a=Object.keys(e.bases||{}),i=0;i<a.length;i+=1)if(!e.destinationBases[a[i]]){if(n=E(a[i],e,t),0===n.length)throw new o("Cannot find necessary base ["+e.bases[a[i]].fullName+" : "+a[i]+"]");if(1!==n.length){for(s="Ambiguous occurrences of base ["+e.bases[a[i]].fullName+" : "+a[i]+"] ( ",r=0;r<n.length;r+=1)s+="["+N.getFullyQualifiedName(n[r])+" : "+N.getPath(n[r])+"] ";throw s+=")",new o(s)}e.destinationBases[a[i]]=N.getPath(n[0])}return null}function I(t,e,i){var o,r=e.split(n.PATH_SEP),s=i.split(n.PATH_SEP),a="";for(r.shift(),s.shift(),o=0;o<r.length&&o<s.length&&r[o]===s[o];o+=1)a+=n.PATH_SEP+r[o];for(;N.getPath(t)!==a&&null!==t;)t=N.getParent(t);return t}function P(t,e,n,i){var o,r,s=I(t,e,n);s?(o=e.substr(N.getPath(s).length),r=n.substr(N.getPath(s).length),N.overlayInsert(s,o,i,r)):w.error("unable to add relation: "+i+"("+e+"->"+n+")")}function T(t,e){var i=t.substr(0,41),o="";return e.relids[i]&&(o=e.parent+n.PATH_SEP+e.relids[i],o+=t.substr(41)),o}function A(t){var e,n,i;for(e in t.relations.preserved){i=t.relations.preserved[e];for(n in i)t.destinationBases[i[n]]?i[n]=t.destinationBases[i[n]]:i[n]=T(i[n],t)}for(e in t.relations.preserved)t.relations.preserved[T(e,t)]=t.relations.preserved[e],delete t.relations.preserved[e]}t("object"==typeof s),t("object"==typeof s.globConf),t("undefined"!=typeof s.logger);var x,w=s.logger,N=this;for(x in r)this[x]=r[x];w.debug("initialized LibraryCore"),this.loadRoot=function(t){return e.call(function(t){return t.libraryRoots=c(t),t},r.loadRoot(t))},this.createNode=function(t){var e;if(t&&t.parent&&(N.isLibraryRoot(t.parent)||N.isLibraryElement(t.parent)))throw new o("Not allowed to create new node inside library.");if(t&&t.base&&N.isLibraryRoot(t.base))throw new o("Not allowed to instantiate library root.");return e=r.createNode(t),null===e.parent&&(e.libraryRoots={}),e},this.deleteNode=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to remove library node by simply deleting them.");return r.deleteNode(t,e)},this.copyNode=function(t,e){if(N.isLibraryRoot(e)||N.isLibraryElement(e))throw new o("Not allowed to add nodes inside a library.");if(N.isLibraryRoot(t))throw new o("Not allowed to copy library root.");return r.copyNode(t,e)},this.copyNodes=function(t,e){var n;if(N.isLibraryRoot(e)||N.isLibraryElement(e))throw new o("Not allowed to add nodes inside a library.");for(n=0;n<t.length;n+=1)if(N.isLibraryRoot(t[n]))throw new o("Not allowed to copy library root.");return r.copyNodes(t,e)},this.moveNode=function(t,e){if(N.isLibraryRoot(e)||N.isLibraryElement(e))throw new o("Not allowed to add nodes inside a library.");if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to move library elements.");return r.moveNode(t,e)},this.setAttribute=function(t,e,n){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");return r.setAttribute(t,e,n)},this.delAttribute=function(t,e){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");return r.delAttribute(t,e)},this.setRegistry=function(t,e,n){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");return r.setRegistry(t,e,n)},this.delRegistry=function(t,e){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");return r.delRegistry(t,e)},this.setPointer=function(t,e,n){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");return r.setPointer(t,e,n)},this.deletePointer=function(t,e){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");return r.deletePointer(t,e)},this.setBase=function(t,e){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");if(e&&N.isLibraryRoot(e))throw new o("Not allowed to instantiate library root.");return r.setBase(t,e)},this.addMember=function(t,e,n){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");return r.addMember(t,e,n)},this.delMember=function(t,e,n){if(N.isLibraryElement(t)||N.isLibraryRoot(t))throw new o("Not allowed to modify library elements.");return r.delMember(t,e,n)},this.setMemberAttribute=function(t,e,n,i,s){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setMemberAttribute(t,e,n,i,s)},this.delMemberAttribute=function(t,e,n,i){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delMemberAttribute(t,e,n,i)},this.setMemberRegistry=function(t,e,n,i,s){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setMemberRegistry(t,e,n,i,s)},this.delMemberRegistry=function(t,e,n,i){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delMemberRegistry(t,e,n,i)},this.createSet=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.createSet(t,e)},this.deleteSet=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.deleteSet(t,e)},this.setSetAttribute=function(t,e,n,i){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setSetAttribute(t,e,n,i)},this.delSetAttribute=function(t,e,n){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delSetAttribute(t,e,n)},this.setSetRegistry=function(t,e,n,i){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setSetRegistry(t,e,n,i)},this.delSetRegistry=function(t,e,n){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delSetRegistry(t,e,n)},this.setGuid=function(t,e){return N.isLibraryRoot(t)||N.isLibraryElement(t)?void 0:r.setGuid(t,e)},this.setConstraint=function(t,e,n){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setConstraint(t,e,n)},this.delConstraint=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delConstraint(t,e)},this.clearMetaRules=function(t){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.clearMetaRules(t)},this.setAttributeMeta=function(t,e,n){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setAttributeMeta(t,e,n)},this.delAttributeMeta=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delAttributeMeta(t,e)},this.setChildMeta=function(t,e,n,i){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");if(N.isLibraryRoot(e))throw new o("Not allowed to use library root as valid child.");return r.setChildMeta(t,e,n,i)},this.delChildMeta=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delChildMeta(t,e)},this.setChildrenMetaLimits=function(t,e,n){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setChildrenMetaLimits(t,e,n)},this.setPointerMetaTarget=function(t,e,n,i,s){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setPointerMetaTarget(t,e,n,i,s)},this.delPointerMetaTarget=function(t,e,n){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delPointerMetaTarget(t,e,n)},this.setPointerMetaLimits=function(t,e,n,i){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setPointerMetaLimits(t,e,n,i)},this.delPointerMeta=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delPointerMeta(t,e)},this.setAspectMetaTarget=function(t,e,n){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.setAspectMetaTarget(t,e,n)},this.delAspectMetaTarget=function(t,e,n){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delAspectMetaTarget(t,e,n)},this.delAspectMeta=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delAspectMeta(t,e)},this.delMixin=function(t,e){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.delMixin(t,e)},this.addMixin=function(t,e){var n,i=N.getRoot(t);if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");
for(n in i.libraryRoots)if(N.getPath(i.libraryRoots[n])===e)throw new o("Not allowed to use library root as mixin.");return r.addMixin(t,e)},this.clearMixins=function(t){if(N.isLibraryRoot(t)||N.isLibraryElement(t))throw new o("Not allowed to modify library elements.");return r.clearMixins(t)},this.getLibraryRoot=function(t,e){var n=N.getRoot(t);return n.libraryRoots[e]||null},this.isLibraryElement=function(t){for(var e=N.getParent(t);e;){if(N.isLibraryRoot(e))return!0;e=N.getParent(e)}return!1},this.isLibraryRoot=function(t){return r.getAttribute(t,"_libraryInfo")?!0:!1},this.getNamespace=function(t){var e=l(t);return e&&(e=e.substring(0,e.length-1)),e},this.getFullyQualifiedName=function(e){return t(N.isValidNode(e)),l(e)+N.getAttribute(e,"name")},this.getLibraryGuid=function(e,n){t(N.isValidNode(e));var i;if(!N.isLibraryElement(e)&&!N.isLibraryRoot(e))throw new o("Node is not a library member");if(i=n?d(e,n):h(e),!i)throw new o("Unknown library was given");if(0!==N.getFullyQualifiedName(e).indexOf(N.getFullyQualifiedName(i)))throw new o("Node is not a member of the library");return N.isLibraryRoot(e)&&N.getPath(e)===N.getPath(i)?r.getDataGuid(e):r.getDeducedGuid(e,N.getLibraryGuid(N.getParent(e),n))},this.addLibrary=function(t,o,s,a){var l=N.getRoot(t),c=i.generateRelid(l.data);return r.setProperty(l,c,s),l.childrenRelids=null,e.call(function(t){return e.call(function(e){var i=N.getMemberPaths(t,n.META_SET_NAME),c=a;if(e.shift(),r.setAttribute(t,"name",o),c.hash=s,r.setAttribute(t,"_libraryInfo",c),e.length>0){r.setBase(N.getBaseRoot(e[0]),N.getFCO(l));var d;for(d=0;d<e.length;d+=1)-1!==i.indexOf(N.getPath(e[d]))&&r.addMember(l,n.META_SET_NAME,e[d])}l.libraryRoots[o]=t},N.loadSubTree(t))},N.loadChild(l,c))},this.updateLibrary=function(t,i,o,s){var a,l={added:{},updated:{},moved:{},removed:{}},c=N.getRoot(t),h=d(c,i),f=N.getFCO(c);return h?(a=N.getRelid(h),e.call(function(t,d){var h,p,m=[],_=[],b=[];for(p in d)t[p]?t[p].path!==d[p].path&&b.push({from:"/"+a+t[p].path,to:"/"+a+d[p].path}):m.push("/"+a+d[p].path);for(p in t)d[p]||_.push("/"+a+t[p].path);for(h=0;h<_.length;h+=1)g(c,_[h]);for(h=0;h<b.length;h+=1)u(c,b[h].from,b[h].to);return r.setProperty(c,a,o),c=N.removeChildFromCache(c,a),e.call(function(t){return e.call(function(e){var a,d,h=N.getMemberPaths(t,n.META_SET_NAME),p=s;if(e.shift(),r.setAttribute(t,"name",i),p.hash=o,r.setAttribute(t,"_libraryInfo",p),e.length>0)for(d=N.getBaseRoot(e[0]),r.deletePointer(d,"base"),r.setBase(d,f),a=0;a<e.length;a+=1)-1!==m.indexOf(N.getPath(e[a]))&&-1!==h.indexOf(N.getPath(e[a]))&&r.addMember(c,n.META_SET_NAME,e[a]);return c.libraryRoots[i]=t,l},N.loadSubTree(t))},N.loadChild(c,a))},p(h),p(o))):l},this.removeLibrary=function(e,n){t(N.isValidNode(e));var i=N.getRoot(e),o=i.libraryRoots[n];o&&!N.isLibraryElement(o)&&(r.deleteNode(i.libraryRoots[n],!0),delete i.libraryRoots[n])},this.renameLibrary=function(e,i,o){t(N.isValidNode(e));var s=N.getRoot(e);t("string"==typeof i&&"string"==typeof o&&-1===i.indexOf(n.NAMESPACE_SEPARATOR)&&-1===o.indexOf(n.NAMESPACE_SEPARATOR)&&s.libraryRoots[i]),i!==o&&(t(!s.libraryRoots[o],"Library already exists ["+o+"]"),r.setAttribute(s.libraryRoots[i],"name",o),s.libraryRoots[o]=s.libraryRoots[i],delete s.libraryRoots[i])},this.getLibraryNames=function(e){return t(N.isValidNode(e)),Object.keys(N.getRoot(e).libraryRoots)},this.getLibraryMetaNodes=function(t,e,n){var i,o=N.getAllMetaNodes(t),r={};for(i in o)n?N.getNamespace(o[i])===e&&(r[i]=o[i]):0===N.getNamespace(o[i]).indexOf(e)&&(r[i]=o[i]);return r},this.getLibraryInfo=function(t,e){var n=d(t,e);return N.getAttribute(n,"_libraryInfo")},this.getClosureInformation=function(e){t(e.length>0);var i,r,s,a,l,c={hashes:{},selection:{},bases:{},relations:{preserved:{},lost:{}}};for(e=y(e),i=this.getAllMetaNodes(e[0]),l=0;l<e.length;l+=1){if(this.isLibraryElement(e[l])||this.isLibraryRoot(e[l]))throw new o("Cannot select node["+this.getPath(e[l])+"] because it is library content!");if(null===this.getParent(e[l]))throw new o("Cannot select the project root!");c.selection[this.getPath(e[l])]=this.getGuid(e[l]),c.hashes[this.getPath(e[l])]=this.getHash(e[l])}for(l=0;l<e.length;l+=1)for(s=this.getParent(e[l]);this.getPath(s);)b(s,i,c),s=this.getParent(s);for(b(this.getRoot(e[0]),i,c),a=Object.keys(c.selection),l=0;l<a.length;l+=1)c.selection[c.selection[a[l]]]=c.hashes[a[l]],delete c.selection[a[l]];C(c),delete c.hashes,w.debug("Closure creation finished!",c);for(r in c.relations.lost)if(c.relations.lost[r][n.BASE_POINTER])throw new o("Closure cannot be created due to ["+r+"] misses its base ["+c.relations.lost[r][n.BASE_POINTER]+"].");return c},this.importClosure=function(t,e){var o,s,a,l,c=this.getAllMetaNodes(t),d="",h=this.getChildrenRelids(t,!0);if(o=D(c,e))return o;e.relids={},e.parent=this.getPath(t);for(s in e.selection)l=i.generateRelid(h,r.getProperty(t,n.MINIMAL_RELID_LENGTH_PROPERTY)),h[l]=!0,r.setProperty(t,l,e.selection[s]),e.relids[e.selection[s]]=l,l.length>d.length&&(d=l);t.childrenRelids=null,r.processRelidReservation(t,d),A(e);for(s in e.relations.preserved)for(a in e.relations.preserved[s])P(t,s,e.relations.preserved[s][a],a);return w.debug("Closure import finished!",e),e}};return r}),define("common/core/CoreIllegalArgumentError",[],function(){"use strict";function t(){var t=Error.apply(this,arguments);return t.name=this.name="CoreIllegalArgumentError",this.message=t.message,this.stack=t.stack,t}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}),define("common/core/core",["common/core/corerel","common/core/setcore","common/core/guidcore","common/core/nullpointercore","common/core/coreunwrap","common/core/coretype","common/core/constraintcore","common/core/coretree","common/core/metacore","common/core/coretreeloader","common/core/corediff","common/core/metacachecore","common/core/mixincore","common/core/metaquerycore","common/regexp","common/core/librarycore","common/core/CoreIllegalArgumentError","common/core/CoreIllegalOperationError","common/core/constants"],function(t,e,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m,_,b){"use strict";function y(t,e,n,i){var o;if(typeof t!==n){if(o=new m("Parameter '"+e+"' is not of type "+n+"."),i)return o;throw o}}function v(t,e,n){var i;if(void 0===t){if(i=new m("Parameter '"+e+"' cannot be undefined."),n)return i;throw i}}function C(t,e,n,i){var o;if(t instanceof n==!1){if(o=new m("Parameter '"+e+"' is not of type "+n+"."),i)return o;throw o}}function E(t,e,n){var i;if(N(t)===!1){if(i=new m("Parameter '"+e+"' is not a valid path."),n)return i;throw i}}function D(t,e,n){var i;if(w(t)===!1){if(i=new m("Parameter '"+e+"' is not a valid node."),n)return i;throw i}}function I(t,e,n){var i;if(u.DB_HASH.test(t)===!1){if(i=new m("Parameter '"+e+"' is not a valid hash."),n)return i;throw i}}function P(t,e,n){var i;if(u.GUID.test(t)===!1){if(i=new m("Parameter '"+e+"' is not a valid GUID."),n)return i;throw i}}function T(t,e,n){var i;if(null!==t&&void 0!==t&&!("number"==typeof t&&Number.isSafeInteger(t)&&t>=-1)&&(i=new m("Parameter "+e+" is not a safe integer from [-1,∞)."))){if(n)return i;throw i}}function A(t,e,n){var i,o=[b.BASE_POINTER,b.OVERLAYS_PROPERTY,b.MEMBER_RELATION];if("string"!=typeof t?i=new m("Parameter "+e+" is not of type string."):(0===t.indexOf("_")||-1!==o.indexOf(t))&&(i=new m("Parameter "+e+" cannot start with '_', or be equal with any of the reserved "+o+" words.")),i){if(n)return i;throw i}}function x(u,b){var x,O=[];O.push(t),O.push(i),O.push(r),O.push(i),O.push(e),O.push(n),O.push(s),O.push(l),O.push(h),O.push(p),O.push(g),O.push(d),O.push(c),O.push(f),O.push(o),x=O.reduce(function(t,e){return new e(t,b)},new a(u,b)),w=x.isValidNode,N=x.isValidPath,this.getParent=function(t){return D(t,"node"),x.getParent(t)},this.getRelid=function(t){return D(t,"node"),x.getRelid(t)},this.getRoot=function(t){return D(t,"node"),x.getRoot(t)},this.getPath=function(t){return D(t,"node"),x.getPath(t)},this.getChild=function(t,e){return D(t,"node"),y(e,"relativeId","string"),x.getChild(t,e)},this.isEmpty=function(t){return D(t,"node"),x.isEmpty(t)},this.getHash=function(t){return D(t,"node"),x.getHash(t)},this.persist=function(t){return D(t,"node"),x.persist(t)},this.loadRoot=function(t,e){var n=null;y(e,"callback","function"),n=I(t,"hash",!0),n?e(n):x.loadRoot(t,e)},this.loadChild=function(t,e,n){var i=null;y(n,"callback","function"),i=D(t,"node",!0),i=i||y(e,"relativeId","string",!0),i?n(i):x.loadChild(t,e,n)},this.loadByPath=function(t,e,n){var i=null;y(n,"callback","function"),i=D(t,"node",!0),i=i||E(e,"relativePath",!0),i?n(i):x.loadByPath(t,e,n)},this.loadChildren=function(t,e){var n=null;y(e,"callback","function"),n=D(t,"node",!0),n?e(n):x.loadChildren(t,e)},this.loadOwnChildren=function(t,e){var n=null;y(e,"callback","function"),n=D(t,"node",!0),n?e(n):x.loadOwnChildren(t,e)},this.loadPointer=function(t,e,n){var i=null;y(n,"callback","function"),i=D(t,"node",!0),i=i||y(e,"pointerName","string",!0),i?n(i):x.loadPointer(t,e,n)},this.loadCollection=function(t,e,n){var i=null;y(n,"callback","function"),i=D(t,"node",!0),i=i||y(e,"pointerName","string",!0),i?n(i):x.loadCollection(t,e,n)},this.loadSubTree=function(t,e){var n=null;y(e,"callback","function"),n=D(t,"node",!0),n?e(n):x.loadSubTree(t,e)},this.loadOwnSubTree=function(t,e){var n=null;y(e,"callback","function"),n=D(t,"node",!0),n?e(n):x.loadOwnSubTree(t,e)},this.loadTree=function(t,e){var n=null;y(e,"callback","function"),n=I(t,"hash",!0),n?e(n):x.loadTree(t,e)},this.getChildrenRelids=function(t){return D(t,"node"),x.getChildrenRelids(t)},this.getOwnChildrenRelids=function(t){return D(t,"node"),x.getOwnChildrenRelids(t)},this.getChildrenPaths=function(t){return D(t,"node"),x.getChildrenPaths(t)},this.getOwnChildrenPaths=function(t){return D(t,"node"),x.getOwnChildrenPaths(t)},this.createNode=function(t){return t&&(y(t,"parameters","object"),t.hasOwnProperty("parent")&&null!==t.parent&&void 0!==t.parent&&D(t.parent,"parameters.parent"),t.hasOwnProperty("base")&&null!==t.base&&void 0!==t.base&&D(t.base,"parameters.base"),t.hasOwnProperty("guid")&&void 0!==t.guid&&P(t.guid,"parameters.guid")),x.createNode(t)},this.deleteNode=function(t){if(D(t,"node"),null===x.getParent(t))throw new _("Not allowed to delete node without a parent.");return x.deleteNode(t,!1)},this.copyNode=function(t,e){return D(t,"node"),D(e,"parent"),x.copyNode(t,e)},this.copyNodes=function(t,e){var n;for(C(t,"nodes",Array),n=0;n<t.length;n+=1)D(t[n],"nodes["+n+"]");return D(e,"parent"),x.copyNodes(t,e)},this.isValidNewParent=function(t,e){return D(t,"node"),D(e,"parent"),x.isValidNewParent(t,e)},this.moveNode=function(t,e){return D(t,"node"),D(e,"parent"),x.moveNode(t,e)},this.getAttributeNames=function(t){return D(t,"node"),x.getAttributeNames(t)},this.getAttribute=function(t,e){return D(t,"node"),y(e,"name","string"),x.getAttribute(t,e)},this.setAttribute=function(t,e,n){return D(t,"node"),y(e,"name","string"),v(n,"value"),x.setAttribute(t,e,n)},this.delAttribute=function(t,e){return D(t,"node"),y(e,"name","string"),x.delAttribute(t,e)},this.getRegistryNames=function(t){return D(t,"node"),x.getRegistryNames(t)},this.getRegistry=function(t,e){return D(t,"node"),y(e,"name","string"),x.getRegistry(t,e)},this.setRegistry=function(t,e,n){return D(t,"node"),y(e,"name","string"),v(n,"value"),x.setRegistry(t,e,n)},this.delRegistry=function(t,e){return D(t,"node"),y(e,"name","string"),x.delRegistry(t,e)},this.getPointerNames=function(t){return D(t,"node"),x.getPointerNames(t)},this.getPointerPath=function(t,e){return D(t,"node"),y(e,"name","string"),x.getPointerPath(t,e)},this.deletePointer=this.delPointer=function(t,e){return D(t,"node"),y(e,"name","string"),x.deletePointer(t,e)},this.setPointer=function(t,e,n){return D(t,"node"),y(e,"name","string"),null!==n&&D(n,"target"),x.setPointer(t,e,n)},this.getCollectionNames=function(t){return D(t,"node"),x.getCollectionNames(t)},this.getCollectionPaths=function(t,e){return D(t,"node"),y(e,"name","string"),x.getCollectionPaths(t,e)},this.getChildrenHashes=function(t){return D(t,"node"),x.getChildrenHashes(t)},this.getBase=function(t){return D(t,"node"),x.getBase(t)},this.getBaseRoot=function(t){return D(t,"node"),x.getBaseRoot(t)},this.getOwnAttributeNames=function(t){return D(t,"node"),x.getOwnAttributeNames(t)},this.getOwnRegistryNames=function(t){return D(t,"node"),x.getOwnRegistryNames(t)},this.getOwnAttribute=function(t,e){return D(t,"node"),y(e,"name","string"),x.getOwnAttribute(t,e)},this.getOwnRegistry=function(t,e){return D(t,"node"),y(e,"name","string"),x.getOwnRegistry(t,e)},this.getOwnPointerNames=function(t){return D(t,"node"),x.getOwnPointerNames(t)},this.getOwnPointerPath=function(t,e){return D(t,"node"),y(e,"name","string"),x.getOwnPointerPath(t,e)},this.isValidNewBase=function(t,e){return D(t,"node"),null!==e&&D(e,"base"),x.isValidNewBase(t,e)},this.setBase=function(t,e){return D(t,"node"),null!==e&&D(e,"base"),x.setBase(t,e)},this.getTypeRoot=function(t){return D(t,"node"),x.getTypeRoot(t)},this.getSetNames=function(t){return D(t,"node"),x.getSetNames(t)},this.getOwnSetNames=function(t){return D(t,"node"),x.getOwnSetNames(t)},this.createSet=function(t,e){return D(t,"node"),A(e,"name"),x.createSet(t,e)},this.deleteSet=this.delSet=function(t,e){return D(t,"node"),A(e,"name"),x.deleteSet(t,e)},this.getSetAttributeNames=function(t,e){D(t,"node"),y(e,"name","string");var n=x.getSetNames(t);if(-1===n.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.getSetAttributeNames(t,e)},this.getOwnSetAttributeNames=function(t,e){D(t,"node"),y(e,"name","string");var n=x.getSetNames(t);if(-1===n.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.getOwnSetAttributeNames(t,e)},this.getSetAttribute=function(t,e,n){D(t,"node"),y(e,"setName","string"),y(n,"attrName","string");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.getSetAttribute(t,e,n)},this.getOwnSetAttribute=function(t,e,n){D(t,"node"),y(e,"setName","string"),y(n,"attrName","string");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.getOwnSetAttribute(t,e,n)},this.setSetAttribute=function(t,e,n,i){D(t,"node"),y(e,"setName","string"),y(n,"attrName","string"),v(i,"value");var o=x.getSetNames(t);if(-1===o.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.setSetAttribute(t,e,n,i)},this.delSetAttribute=function(t,e,n){D(t,"node"),y(e,"setName","string"),y(n,"attrName","string");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.delSetAttribute(t,e,n)},this.getSetRegistryNames=function(t,e){D(t,"node"),y(e,"name","string");var n=x.getSetNames(t);if(-1===n.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.getSetRegistryNames(t,e)},this.getOwnSetRegistryNames=function(t,e){D(t,"node"),y(e,"name","string");var n=x.getSetNames(t);if(-1===n.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.getOwnSetRegistryNames(t,e)},this.getSetRegistry=function(t,e,n){D(t,"node"),y(e,"setName","string"),y(n,"regName","string");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.getSetRegistry(t,e,n)},this.getOwnSetRegistry=function(t,e,n){D(t,"node"),y(e,"setName","string"),y(n,"regName","string");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.getOwnSetRegistry(t,e,n)},this.setSetRegistry=function(t,e,n,i){D(t,"node"),y(e,"setName","string"),y(n,"regName","string"),v(i,"value");var o=x.getSetNames(t);if(-1===o.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.setSetRegistry(t,e,n,i)},this.delSetRegistry=function(t,e,n){D(t,"node"),y(e,"setName","string"),y(n,"regName","string");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access attributes of unknown set.");return x.delSetRegistry(t,e,n)},this.getMemberPaths=function(t,e){D(t,"node"),y(e,"name","string");var n=x.getSetNames(t).concat(x.getValidSetNames(t));if(-1===n.indexOf(e))throw new _("Cannot access member information of unknown set.");return x.getMemberPaths(t,e)},this.getOwnMemberPaths=function(t,e){D(t,"node"),y(e,"name","string");var n=x.getSetNames(t).concat(x.getValidSetNames(t));if(-1===n.indexOf(e))throw new _("Cannot access member information of unknown set.");return x.getOwnMemberPaths(t,e)},this.delMember=function(t,e,n){D(t,"node"),y(e,"name","string"),E(n,"path");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access member information of unknown set.");return x.delMember(t,e,n)},this.addMember=function(t,e,n){return D(t,"node"),y(e,"name","string"),D(n,"member"),x.addMember(t,e,n)},this.getMemberAttributeNames=function(t,e,n){D(t,"node"),y(e,"name","string"),E(n,"path");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access member information of unknown set.");var o=x.getMemberPaths(t,e);if(-1===o.indexOf(n))throw new _("Cannot access attributes of an unknown member.");return x.getMemberAttributeNames(t,e,n)},this.getMemberOwnAttributeNames=function(t,e,n){D(t,"node"),y(e,"name","string"),E(n,"path");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access member information of unknown set.");var o=x.getMemberPaths(t,e);if(-1===o.indexOf(n))throw new _("Cannot access attributes of an unknown member.");return x.getMemberOwnAttributeNames(t,e,n)},this.getMemberAttribute=function(t,e,n,i){D(t,"node"),y(e,"setName","string"),E(n,"path"),y(i,"attrName","string");var o=x.getSetNames(t);if(-1===o.indexOf(e))throw new _("Cannot access member information of unknown set.");var r=x.getMemberPaths(t,e);if(-1===r.indexOf(n))throw new _("Cannot access attributes of an unknown member.");return x.getMemberAttribute(t,e,n,i)},this.getMemberOwnAttribute=function(t,e,n,i){D(t,"node"),y(e,"setName","string"),E(n,"path"),y(i,"attrName","string");var o=x.getSetNames(t);if(-1===o.indexOf(e))throw new _("Cannot access member information of unknown set.");var r=x.getMemberPaths(t,e);if(-1===r.indexOf(n))throw new _("Cannot access attributes of an unknown member.");return x.getMemberOwnAttribute(t,e,n,i)},this.setMemberAttribute=function(t,e,n,i,o){D(t,"node"),y(e,"setName","string"),E(n,"path"),y(i,"attrName","string"),v(o,"value");var r=x.getSetNames(t);if(-1===r.indexOf(e))throw new _("Cannot access member information of unknown set.");var s=x.getMemberPaths(t,e);if(-1===s.indexOf(n))throw new _("Cannot access attributes of an unknown member.");return x.setMemberAttribute(t,e,n,i,o)},this.delMemberAttribute=function(t,e,n,i){D(t,"node"),y(e,"setName","string"),E(n,"path"),y(i,"attrName","string");var o=x.getSetNames(t);if(-1===o.indexOf(e))throw new _("Cannot access member information of unknown set.");var r=x.getMemberPaths(t,e);if(-1===r.indexOf(n))throw new _("Cannot access attributes of an unknown member.");return x.delMemberAttribute(t,e,n,i)},this.getMemberRegistryNames=function(t,e,n){D(t,"node"),y(e,"name","string"),E(n,"path");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access member information of unknown set.");var o=x.getMemberPaths(t,e);if(-1===o.indexOf(n))throw new _("Cannot access registry of an unknown member.");return x.getMemberRegistryNames(t,e,n)},this.getMemberOwnRegistryNames=function(t,e,n){D(t,"node"),y(e,"name","string"),E(n,"path");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access member information of unknown set.");var o=x.getMemberPaths(t,e);if(-1===o.indexOf(n))throw new _("Cannot access registry of an unknown member.");return x.getMemberOwnRegistryNames(t,e,n)},this.getMemberRegistry=function(t,e,n,i){D(t,"node"),y(e,"setName","string"),E(n,"path"),y(i,"regName","string");var o=x.getSetNames(t);if(-1===o.indexOf(e))throw new _("Cannot access member information of unknown set.");var r=x.getMemberPaths(t,e);if(-1===r.indexOf(n))throw new _("Cannot access registry of an unknown member.");return x.getMemberRegistry(t,e,n,i)},this.getMemberOwnRegistry=function(t,e,n,i){D(t,"node"),y(e,"setName","string"),E(n,"path"),y(i,"regName","string");var o=x.getSetNames(t);if(-1===o.indexOf(e))throw new _("Cannot access member information of unknown set.");var r=x.getMemberPaths(t,e);if(-1===r.indexOf(n))throw new _("Cannot access registry of an unknown member.");return x.getMemberOwnRegistry(t,e,n,i)},this.setMemberRegistry=function(t,e,n,i,o){D(t,"node"),y(e,"setName","string"),E(n,"path"),y(i,"regName","string"),v(o,"value");var r=x.getSetNames(t);if(-1===r.indexOf(e))throw new _("Cannot access member information of unknown set.");var s=x.getMemberPaths(t,e);if(-1===s.indexOf(n))throw new _("Cannot access registry of an unknown member.");return x.setMemberRegistry(t,e,n,i,o)},this.delMemberRegistry=function(t,e,n,i){D(t,"node"),y(e,"setName","string"),E(n,"path"),y(i,"regName","string");var o=x.getSetNames(t);if(-1===o.indexOf(e))throw new _("Cannot access member information of unknown set.");var r=x.getMemberPaths(t,e);if(-1===r.indexOf(n))throw new _("Cannot access registry of an unknown member.");return x.delMemberRegistry(t,e,n,i)},this.isMemberOf=function(t){return D(t,"node"),x.isMemberOf(t)},this.getGuid=function(t){return D(t,"node"),x.getGuid(t)},this.setGuid=function(t,e,n){var i=null;y(n,"callback","function"),i=D(t,"node",!0),i=i||P(e,"guid",!0),i?n(i):x.setGuid(t,e,n)},this.getConstraint=function(t,e){return D(t,"node"),y(e,"name","string"),x.getConstraint(t,e)},this.setConstraint=function(t,e,n){return D(t,"node"),y(e,"name","string"),y(n,"constraint","object"),x.setConstraint(t,e,n)},this.delConstraint=function(t,e){return D(t,"node"),y(e,"name","string"),x.delConstraint(t,e)},this.getConstraintNames=function(t){return D(t,"node"),x.getConstraintNames(t)},this.getOwnConstraintNames=function(t){return D(t,"node"),x.getOwnConstraintNames(t)},this.isTypeOf=function(t,e){return D(t,"node"),D(e,"type"),x.isTypeOf(t,e)},this.isValidChildOf=function(t,e){return D(t,"node"),D(e,"parent"),x.isValidChildOf(t,e)},this.getValidPointerNames=function(t){return D(t,"node"),x.getValidPointerNames(t)},this.getValidSetNames=function(t){return D(t,"node"),x.getValidSetNames(t)},this.isValidTargetOf=function(t,e,n){return D(t,"node"),D(e,"source"),y(n,"name","string"),x.isValidTargetOf(t,e,n)},this.getValidAttributeNames=function(t){return D(t,"node"),x.getValidAttributeNames(t)},this.getOwnValidAttributeNames=function(t){return D(t,"node"),x.getOwnValidAttributeNames(t)},this.isValidAttributeValueOf=function(t,e,n){return D(t,"node"),y(e,"name","string"),v(n,"value"),x.isValidAttributeValueOf(t,e,n)},this.getValidAspectNames=function(t){return D(t,"node"),x.getValidAspectNames(t)},this.getOwnValidAspectNames=function(t){return D(t,"node"),x.getOwnValidAspectNames(t)},this.getAspectMeta=function(t,e){return D(t,"node"),y(e,"name","string"),x.getAspectMeta(t,e)},this.getJsonMeta=function(t){return D(t,"node"),x.getJsonMeta(t)},this.getOwnJsonMeta=function(t){return D(t,"node"),x.getOwnJsonMeta(t)},this.clearMetaRules=function(t){return D(t,"node"),x.clearMetaRules(t)},this.setAttributeMeta=function(t,e,n){return D(t,"node"),y(e,"name","string"),y(n,"rule","object"),y(n.type,"rule.type","string"),x.setAttributeMeta(t,e,n)},this.delAttributeMeta=function(t,e){return D(t,"node"),y(e,"name","string"),x.delAttributeMeta(t,e)},this.getAttributeMeta=function(t,e){return D(t,"node"),y(e,"name","string"),x.getAttributeMeta(t,e)},this.getValidChildrenPaths=function(t){return D(t,"node"),x.getValidChildrenPaths(t)},this.getChildrenMeta=function(t){return D(t,"node"),x.getChildrenMeta(t)},this.setChildMeta=function(t,e,n,i){return D(t,"node"),D(e,"child"),T(n,"min"),T(i,"max"),x.setChildMeta(t,e,n,i)},this.delChildMeta=function(t,e){return D(t,"node"),E(e,"path"),x.delChildMeta(t,e)},this.setChildrenMetaLimits=function(t,e,n){return D(t,"node"),T(e,"min"),T(n,"max"),x.setChildrenMetaLimits(t,e,n)},this.setPointerMetaTarget=function(t,e,n,i,o){return D(t,"node"),A(e,"name"),D(n,"target"),T(i,"min"),T(o,"max"),x.setPointerMetaTarget(t,e,n,i,o)},this.delPointerMetaTarget=function(t,e,n){D(t,"node"),y(e,"name","string"),E(n,"path");var i=x.getValidPointerNames(t).concat(x.getValidSetNames(t));if(-1===i.indexOf(e))throw new _("Cannot access definition of unknown pointer.");return x.delPointerMetaTarget(t,e,n)},this.setPointerMetaLimits=function(t,e,n,i){return D(t,"node"),A(e,"name"),T(n,"min"),T(i,"max"),x.setPointerMetaLimits(t,e,n,i)},this.delPointerMeta=function(t,e){return D(t,"node"),y(e,"name","string"),x.delPointerMeta(t,e)},this.getPointerMeta=function(t,e){return D(t,"node"),y(e,"name","string"),x.getPointerMeta(t,e)},this.setAspectMetaTarget=function(t,e,n){return D(t,"node"),A(e,"name"),D(n,"target"),x.setAspectMetaTarget(t,e,n)},this.delAspectMetaTarget=function(t,e,n){D(t,"node"),y(e,"name","string"),E(n,"path");var i=x.getValidAspectNames(t);if(-1===i.indexOf(e))throw new _("Cannot change definition of unknown aspect.");return x.delAspectMetaTarget(t,e,n)},this.delAspectMeta=function(t,e){return D(t,"node"),y(e,"name","string"),x.delAspectMeta(t,e)},this.getBaseType=this.getMetaType=function(t){return D(t,"node"),x.getBaseType(t)},this.isInstanceOf=function(t,e){return D(t,"node"),y(e,"name","string"),x.isInstanceOf(t,e)},this.generateTreeDiff=function(t,e,n){var i;y(n,"callback","function"),i=D(t,"sourceRoot",!0),i=i||D(e,"targetRoot",!0),i?n(i):x.generateTreeDiff(t,e,n)},this.applyTreeDiff=function(t,e,n){var i;y(n,"callback","function"),i=D(t,"node",!0),i=i||y(e,"patch","object",!0),i?n(i):x.applyTreeDiff(t,e,n)},this.tryToConcatChanges=function(t,e){return y(t,"mine","object"),y(e,"theirs","object"),x.tryToConcatChanges(t,e)},this.applyResolution=function(t){return y(t,"conflict","object"),x.applyResolution(t)},this.isAbstract=function(t){return D(t,"node"),x.isAbstract(t)},this.isConnection=function(t){return D(t,"node"),x.isConnection(t)},this.getValidChildrenMetaNodes=function(t){if(y(t,"parameters","object"),D(t.node,"parameters.node"),t.hasOwnProperty("children")&&void 0!==t.children){C(t.children,"parameters.children",Array);for(var e=0;e<t.children.length;e+=1)D(t.children[e],"parameters.children[i]")}return t.hasOwnProperty("sensitive")&&void 0!==t.sensitive&&y(t.sensitive,"parameters.sensitive","boolean"),t.hasOwnProperty("multiplicity")&&y(t.multiplicity,"parameters.multiplicity","boolean"),t.hasOwnProperty("aspect")&&void 0!==t.aspect&&null!==t.aspect&&y(t.aspect,"parameters.aspect","string"),x.getValidChildrenMetaNodes(t)},this.getValidSetElementsMetaNodes=function(t){if(y(t,"parameters","object"),D(t.node,"parameters.node"),t.hasOwnProperty("members")){C(t.members,"parameters.members",Array);for(var e=0;e<t.members.length;e+=1)D(t.members[e],"parameters.members[i]")}return t.hasOwnProperty("sensitive")&&y(t.sensitive,"parameters.sensitive","boolean"),t.hasOwnProperty("multiplicity")&&y(t.multiplicity,"parameters.multiplicity","boolean"),x.getValidSetElementsMetaNodes(t)},this.getAllMetaNodes=function(t){return D(t,"node"),x.getAllMetaNodes(t)},this.isMetaNode=function(t){return D(t,"node"),x.isMetaNode(t)},this.isFullyOverriddenMember=function(t,e,n){D(t,"node"),y(e,"name","string"),E(n,"path");var i=x.getSetNames(t);if(-1===i.indexOf(e))throw new _("Cannot access member information of unknown set.");return x.isFullyOverriddenMember(t,e,n)},this.getMixinErrors=function(t){return D(t,"node"),x.getMixinErrors(t)},this.getMixinPaths=function(t){return D(t,"node"),x.getMixinPaths(t)},this.getMixinNodes=function(t){return D(t,"node"),x.getMixinNodes(t)},this.delMixin=function(t,e){return D(t,"node"),E(e,"path"),x.delMixin(t,e)},this.addMixin=function(t,e){return D(t,"node"),E(e,"path"),x.addMixin(t,e)},this.clearMixins=function(t){return D(t,"node"),x.clearMixins(t)},this.getBaseTypes=function(t){return D(t,"node"),x.getBaseTypes(t)},this.canSetAsMixin=function(t,e){return D(t,"node"),E(e,"path"),x.canSetAsMixin(t,e)},this.addLibrary=function(t,e,n,i,o){y(o,"callback","function");var r=D(t,"node",!0);r=r||y(e,"name","string"),r=r||I(n,"libraryRootHash",!0),i&&(r=r||y(i,"libraryInfo","object",!0),i.hasOwnProperty("projectId")&&void 0!==i.projectId&&(r=r||y(i.projectId,"libraryInfo.projectId","string",!0)),i.hasOwnProperty("branchName")&&void 0!==i.branchName&&(r=r||y(i.branchName,"libraryInfo.branchName","string",!0)),i.hasOwnProperty("commitHash")&&void 0!==i.commitHash&&(r=r||I(i.commitHash,"libraryInfo.commitHash",!0))),r?o(r):x.addLibrary(t,e,n,i,o)},this.updateLibrary=function(t,e,n,i,o,r){y(r,"callback","function");var s=D(t,"node",!0);s=s||y(e,"name","string"),s=s||I(n,"libraryRootHash",!0),i&&(s=s||y(i,"libraryInfo","object",!0),i.hasOwnProperty("projectId")&&void 0!==i.projectId&&(s=s||y(i.projectId,"libraryInfo.projectId","string",!0)),i.hasOwnProperty("branchName")&&void 0!==i.branchName&&(s=s||y(i.branchName,"libraryInfo.branchName","string",!0)),i.hasOwnProperty("commitHash")&&void 0!==i.commitHash&&(s=s||I(i.commitHash,"libraryInfo.commitHash",!0))),s?r(s):x.updateLibrary(t,e,n,i,r)},this.getLibraryNames=function(t){return D(t,"node"),x.getLibraryNames(t)},this.getFCO=function(t){return D(t,"node"),x.getFCO(t)},this.isLibraryRoot=function(t){return D(t,"node"),x.isLibraryRoot(t)},this.isLibraryElement=function(t){return D(t,"node"),x.isLibraryElement(t)},this.getNamespace=function(t){return D(t,"node"),x.getNamespace(t)},this.getFullyQualifiedName=function(t){return D(t,"node"),x.getFullyQualifiedName(t)},this.removeLibrary=function(t,e){D(t,"node"),y(e,"name","string");var n=x.getLibraryNames(t);if(-1===n.indexOf(e))throw new _("Cannot remove unknown library");return x.removeLibrary(t,e)},this.getLibraryGuid=function(t,e){return D(t,"node"),void 0!==e&&null!==e&&y(e,"name","string"),x.getLibraryGuid(t,e)},this.renameLibrary=function(t,e,n){return D(t,"node"),y(e,"oldName","string"),y(n,"newName","string"),x.renameLibrary(t,e,n)},this.getLibraryInfo=function(t,e){return D(t,"node"),y(e,"name","string"),x.getLibraryInfo(t,e)},this.getLibraryRoot=function(t,e){return D(t,"node"),y(e,"name","string"),x.getLibraryRoot(t,e)},this.getLibraryMetaNodes=function(t,e,n){return D(t,"node"),y(e,"name","string"),null!==n&&void 0!==n&&y(n,"onlyOwn","boolean"),x.getLibraryMetaNodes(t,e,n)},this.traverse=function(t,e,n,i){y(i,"callback","function");var o=D(t,"root",!0);e&&(o=o||y(e,"options","object"),e.hasOwnProperty("excludeRoot")&&(o=o||y(e.excludeRoot,"options.excludeRoot","boolean",!0)),e.hasOwnProperty("order")&&(o=o||y(e.order,"options.order","string",!0),"BFS"!==e.order&&"DFS"!==e.order&&(o=o||new m("Parameter options.order must be either 'BFS' or 'DFS'."))),e.hasOwnProperty("stopOnError")&&(o=o||y(e.stopOnError,"options.stopOnError","boolean",!0))),o=o||y(n,"visitFn","function"),o?i(o):x.traverse(t,e,n,i)},this.getClosureInformation=function(t){C(t,"nodes",Array);for(var e=0;e<t.length;e+=1)D(t[e],"nodes[i]");return x.getClosureInformation(t)},this.importClosure=function(t,e){return D(t,"node"),y(e,"closureInformation","object"),x.importClosure(t,e)},this.getInstancePaths=function(t){return D(t,"node"),x.getInstancePaths(t)},this.loadInstances=function(t,e){y(e,"callback","function");var n=D(t,"node",!0);n?e(n):x.loadInstances(t,e)}}var w,N;return x}),define("common/core/coreQ",["common/core/core","q"],function(t,e){"use strict";function n(n,i){var o=this;t.call(o,n,i);var r=this.loadChild;this.loadChild=function(t,n,i){var o=e.defer();return r(t,n,function(t,e){t?o.reject(t instanceof Error?t:new Error(t)):o.resolve(e)}),o.promise.nodeify(i)};var s=this.loadRoot;this.loadRoot=function(t,n){var i=e.defer();return s(t,function(t,e){t?i.reject(t instanceof Error?t:new Error(t)):i.resolve(e)}),i.promise.nodeify(n)};var a=this.loadByPath;this.loadByPath=function(t,n,i){var o=e.defer();return a(t,n,function(t,e){t?o.reject(t instanceof Error?t:new Error(t)):o.resolve(e)}),o.promise.nodeify(i)};
var l=this.loadChildren;this.loadChildren=function(t,n){var i=e.defer();return l(t,function(t,e){t?i.reject(t instanceof Error?t:new Error(t)):i.resolve(e)}),i.promise.nodeify(n)};var c=this.loadOwnChildren;this.loadOwnChildren=function(t,n){var i=e.defer();return c(t,function(t,e){t?i.reject(t instanceof Error?t:new Error(t)):i.resolve(e)}),i.promise.nodeify(n)};var d=this.loadPointer;this.loadPointer=function(t,n,i){var o=e.defer();return d(t,n,function(t,e){t?o.reject(t instanceof Error?t:new Error(t)):o.resolve(e)}),o.promise.nodeify(i)};var h=this.loadCollection;this.loadCollection=function(t,n,i){var o=e.defer();return h(t,n,function(t,e){t?o.reject(t instanceof Error?t:new Error(t)):o.resolve(e)}),o.promise.nodeify(i)};var p=this.loadSubTree;this.loadSubTree=function(t,n){var i=e.defer();return p(t,function(t,e){t?i.reject(t instanceof Error?t:new Error(t)):i.resolve(e)}),i.promise.nodeify(n)};var g=this.loadOwnSubTree;this.loadOwnSubTree=function(t,n){var i=e.defer();return g(t,function(t,e){t?i.reject(t instanceof Error?t:new Error(t)):i.resolve(e)}),i.promise.nodeify(n)};var u=this.loadTree;this.loadTree=function(t,n){var i=e.defer();return u(t,function(t,e){t?i.reject(t instanceof Error?t:new Error(t)):i.resolve(e)}),i.promise.nodeify(n)};var f=this.applyTreeDiff;this.applyTreeDiff=function(t,n,i){var o=e.defer();return f(t,n,function(t,e){t?o.reject(t instanceof Error?t:new Error(t)):o.resolve(e)}),o.promise.nodeify(i)};var m=this.generateTreeDiff;this.generateTreeDiff=function(t,n,i){var o=e.defer();return m(t,n,function(t,e){t?o.reject(t instanceof Error?t:new Error(t)):o.resolve(e)}),o.promise.nodeify(i)};var _=this.setGuid;this.setGuid=function(t,n,i){var o=e.defer();return _(t,n,o.resolve),o.promise.nodeify(i)};var b=this.addLibrary;this.addLibrary=function(t,n,i,o,r){var s=e.defer();return b(t,n,i,o,s.resolve),s.promise.nodeify(r)};var y=this.updateLibrary;this.updateLibrary=function(t,n,i,o,r,s){var a=e.defer();return y(t,n,i,o,r,function(t,e){t?a.reject(t):a.resolve(e)}),a.promise.nodeify(s)};var v=this.traverse;this.traverse=function(t,n,i,o){var r=e.defer();return v(t,n,i,function(t,e){t?r.reject(t):r.resolve(e)}),r.promise.nodeify(o)};var C=this.loadInstances;this.loadInstances=function(t,n){var i=e.defer();return C(t,function(t,e){t?i.reject(t instanceof Error?t:new Error(t)):i.resolve(e)}),i.promise.nodeify(n)}}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n}),define("js/client/constants",["common/storage/constants","common/core/constants"],function(t,e){"use strict";return{STORAGE:t,CORE:e,BRANCH_STATUS:t.BRANCH_STATUS,UNCAUGHT_EXCEPTION:"UNCAUGHT_EXCEPTION",NETWORK_STATUS_CHANGED:"NETWORK_STATUS_CHANGED",BRANCH_STATUS_CHANGED:"BRANCH_STATUS_CHANGED",BRANCH_CHANGED:"BRANCH_CHANGED",PROJECT_CLOSED:"PROJECT_CLOSED",PROJECT_OPENED:"PROJECT_OPENED",NEW_COMMIT_STATE:"NEW_COMMIT_STATE",UNDO_AVAILABLE:"UNDO_AVAILABLE",REDO_AVAILABLE:"REDO_AVAILABLE",NOTIFICATION:"NOTIFICATION",CONNECTED_USERS_CHANGED:"CONNECTED_USERS_CHANGED",META_RULES_RESULT:"META_RULES_RESULT",CONSTRAINT_RESULT:"CONSTRAINT_RESULT"}}),define("common/util/guid",[],function(){"use strict";var t=function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()};return t}),define("common/core/users/metarules",["q","common/core/constants"],function(t,e){"use strict";function n(t,e,n){return t.loadByPath(e,n).then(function(t){if(null===t)throw new Error('Given nodePath does not exist "'+n+'"!');return t})}function i(e,i,o){var r,s=[],a=e.getRoot(i);for(r=0;r<o.length;r+=1)s.push(n(e,a,o[r]));return t.all(s)}function o(t){var e,n={pointers:{},sets:{}},i=Object.keys(t.pointers);for(e=0;e<i.length;e+=1)1===t.pointers[i[e]].max?n.pointers[i[e]]=t.pointers[i[e]]:n.sets[i[e]]=t.pointers[i[e]];return n}function r(t,e,n){var i,o=t.getAllMetaNodes(e),r=[];for(i=0;i<n.length;i+=1)t.isTypeOf(e,o[n[i]])&&r.push(i);return r}function s(t,e,n,i){var o,s,a,l=[],c={hasViolation:!1,message:""};for(l=n.items.map(function(){return 0}),o=0;o<e.length;o+=1)if(a=r(t,e[o],n.items),0===a.length)c.hasViolation=!0,c.message+=i+" "+t.getGuid(e[o])+" is not an allowed "+i+" type\n";else for(s=0;s<a.length;s+=1)l[a[s]]+=1;for(o=0;o<n.items.length;o+=1)n.minItems[o]>-1&&n.minItems[o]>l[o]?(c.hasViolation=!0,c.message+="node has fewer "+i+"(s) than needed ( "+l[o]+" < "+n.minItems[o]+" )\n"):n.maxItems[o]>-1&&n.maxItems[o]<l[o]&&(c.hasViolation=!0,c.message+="node has more "+i+"(s) than needed ( "+l[o]+" < "+n.maxItems[o]+" )\n");return c}function a(e,n,r,a){var l={hasViolation:!1,message:""},c=o(e).pointers,d=[],h=n.getPointerNames(r);return d=h.map(function(e){var o,a=c[e],l=[];return a?(o=n.getPointerPath(r,e),null!==o&&l.push(o),i(n,r,l).then(function(t){return s(n,t,a,e+" target")})):"base"===e?{hasViolation:!1}:t({hasViolation:!0,message:'Invalid pointer "'+e+'"\n'})}),t.all(d).then(function(t){return t.forEach(function(t){t.hasViolation&&(l.hasViolation=!0,l.message+=t.message)}),l}).nodeify(a)}function l(e,n,r,a){var l={hasViolation:!1,message:""},c=o(e).sets,d=[],h=n.getSetNames(r);return d=h.map(function(e){var o,a=c[e];if(a)return o=n.getMemberPaths(r,e),i(n,r,o).then(function(t){return s(n,t,a,e+" set member")});if(n.getValidAspectNames(r).indexOf(e)>-1)return t({hasViolation:!1});var l,d=n.getRegistry(r,"CrossCuts")||[];for(l=0;l<d.length;l+=1)if(d[l].SetID===e){l=-1;break}return t(-1===l?{hasViolation:!1}:{hasViolation:!0,message:'Invalid set "'+e+'"\n'})}),t.all(d).then(function(t){return t.forEach(function(t){t.hasViolation&&(l.hasViolation=!0,l.message+=t.message)}),l}).nodeify(a)}function c(t,e,n,o){return i(e,n,e.getChildrenPaths(n)).then(function(n){return s(e,n,t.children,"child")}).nodeify(o)}function d(e,n,i){var o,r={hasViolation:!1,message:""},s=n.getAttributeNames(i),a=n.getValidAttributeNames(i);for(o=0;o<s.length;o++)if(-1!==a.indexOf(s[o]))try{n.isValidAttributeValueOf(i,s[o],n.getAttribute(i,s[o]))||(r.hasViolation=!0,r.message+='attribute "'+s[o]+'" has invalid value ('+n.getAttribute(i,s[o])+")\n")}catch(l){if(!(l.message.indexOf("Invalid regular expression")>-1))throw l;r.message='Invalid regular expression defined in the meta model for attribute "'+s[o]+'"!',r.hasViolation=!0}else r.hasViolation=!0,r.message+='node has an attribute that is not part of any meta node "'+s[o]+'"\n';return t(r)}function h(e,n,i){var o,r={hasViolation:!1,message:""};return""===e.getPath(n)||e.isLibraryRoot(n)?t(r):(o=e.getJsonMeta(n),t.all([a(o,e,n),l(o,e,n),c(o,e,n),d(o,e,n)]).then(function(t){var e;for(e=0;e<t.length;e+=1)t[e].hasViolation===!0&&(r.hasViolation=!0,r.message+=t[e].message);return r}).nodeify(i))}function p(t,n){function i(e,n){var i,o;for(i=0;i<n.length;i+=1)if(o=_[n[i]],o&&t.isTypeOf(e,o))return!0;return!1}function o(t,e,n,i){return{severity:"error",message:t+" defines "+i+" ["+n+'] starting with an underscore ("_").',description:"Such relations/properties in the models are considered private and can collied with reserved properties.",hint:"Remove/rename it.",path:e,relatedPaths:[]}}function r(t,e,n,i){return{severity:"error",message:t+" defines "+i+" ["+n+"] which is a reserved name.",description:"Such relations/properties in the models can lead to collisions resulting in unexpected behavior.",hint:"Remove/rename it.",path:e,relatedPaths:[]}}var s,a,l,c,d,h,p,g,u,f,m,_=t.getAllMetaNodes(n),b={},y=[];for(c in _){if(d=_[c],h=t.getFullyQualifiedName(d),m=t.getOwnJsonMeta(d),p=t.getValidSetNames(d),g=t.getValidPointerNames(d),u=t.getValidAspectNames(d),f=t.getValidChildrenPaths(d),m.attributes=m.attributes||{},m.children=m.children||{},m.pointers=m.pointers||{},m.aspects=m.aspects||{},m.constraints=m.constraints||{},"string"==typeof b[h]?y.push({severity:"error",message:"Duplicate name among meta-nodes ["+h+"]",description:"Non-unique meta names makes it hard to reason about the meta-model",hint:"Rename one of the objects",path:c,relatedPaths:[b[h]]}):b[h]=c,y=y.concat(t.getMixinErrors(d).map(function(t){return{severity:t.severity,message:t.message,description:"Mixin violations makes it hard to see which definition is used.",hint:t.hint,path:c,relatedPaths:t.collisionPaths||[]}})),m.children.items)for(a=0;a<m.children.items.length;a+=1)_[m.children.items[a]]||y.push({severity:"error",message:h+" defines containment of a node that is not part of the meta.",description:"All defined meta-relations should be between meta-nodes.",hint:"Locate the related node, add it to the meta and remove the containment definition.",path:c,relatedPaths:[m.children.items[a]]});for(l in m.pointers){for(s=1===m.pointers[l].max,a=0;a<m.pointers[l].items.length;a+=1)_[m.pointers[l].items[a]]||y.push({severity:"error",message:h+" defines a "+(s?"pointer":"set")+" ["+l+"] where the "+(s?"target":"member")+" is not part of the meta.",description:"All defined meta-relations should be between meta-nodes.",hint:"Locate the related node, add it to the meta and remove the "+(s?"pointer":"set")+" definition.",path:c,relatedPaths:[m.pointers[l].items[a]]});s?(p.indexOf(l)>-1&&y.push({severity:"error",message:h+" defines a pointer ["+l+"] colliding with a set definition.",description:"Pointer and set definitions share the same namespace.",hint:"Remove/rename one of them.",path:c,relatedPaths:m.pointers[l].items}),(l===e.BASE_POINTER||l===e.MEMBER_RELATION)&&y.push(r(h,c,l,"a pointer"))):(g.indexOf(l)>-1&&y.push({severity:"error",message:h+" defines a set ["+l+"] colliding with a pointer definition.",description:"Pointer and set definitions share the same namespace.",hint:"Remove/rename one of them.",path:c,relatedPaths:m.pointers[l].items}),u.indexOf(l)>-1&&y.push({severity:"error",message:h+" defines a set ["+l+"] colliding with an aspect definition.",description:"Sets and aspects share the same name-space.",hint:"Remove/rename one of them.",path:c,relatedPaths:m.pointers[l].items}),l===e.OVERLAYS_PROPERTY&&y.push(r(h,c,l,"a set"))),"_"===l[0]&&y.push(o(h,c,l,s?"a pointer":"a set"))}for(l in m.aspects){for(a=0;a<m.aspects[l].length;a+=1)_[m.aspects[l][a]]?i(_[m.aspects[l][a]],f)===!1&&y.push({severity:"error",message:h+" defines an aspect ["+l+"] where a member does not have a containment definition.",description:"All defined meta-relations should be between meta-nodes.",hint:"Remove the item from the aspect or add a containment definition.",path:c,relatedPaths:[m.aspects[l][a]]}):y.push({severity:"error",message:h+" defines an aspect ["+l+"] where a member is not part of the meta.",description:"All defined meta-relations should be between meta-nodes.",hint:"Remove the item from the aspect.",path:c,relatedPaths:[m.aspects[l][a]]});p.indexOf(l)>-1&&y.push({severity:"error",message:h+" defines an aspect ["+l+"] colliding with a set definition.",description:"Sets and aspects share the same name-space.",hint:"Remove the aspect and create a new one.",path:c,relatedPaths:[]}),l===e.OVERLAYS_PROPERTY&&y.push(r(h,c,l,"an aspect")),"_"===l[0]&&y.push(o(h,c,l,"an aspect"))}for(l in m.attributes){if(m.attributes[l].hasOwnProperty("regexp"))try{new RegExp(m.attributes[l].regexp)}catch(v){y.push({severity:"error",message:h+" defines an invalid regular expression for the attribute ["+l+'], "'+m.attributes[l].regexp+'".',description:"Invalid properties can lead to unexpected results in the models.",hint:"Edit the regular expression for the attribute.",path:c,relatedPaths:[]})}(m.attributes[l].type===e.ATTRIBUTE_TYPES.INTEGER||m.attributes[l].type===e.ATTRIBUTE_TYPES.FLOAT)&&(m.attributes[l].hasOwnProperty("min")&&"number"!=typeof m.attributes[l].min&&y.push({severity:"error",message:h+" defines an invalid min value for the attribute ["+l+']. The type is not a number but "'+typeof m.attributes[l].min+'".',description:"Invalid properties can lead to unexpected results in the models.",hint:"Edit the min value for the attribute.",path:c,relatedPaths:[]}),m.attributes[l].hasOwnProperty("max")&&"number"!=typeof m.attributes[l].max&&y.push({severity:"error",message:h+" defines an invalid max value for the attribute ["+l+']. The type is not a number but "'+typeof m.attributes[l].max+'".',description:"Invalid properties can lead to unexpected results in the models.",hint:"Edit the max value for the attribute.",path:c,relatedPaths:[]})),"_"===l[0]&&y.push(o(h,c,l,"an attribute"))}}return y}return{checkNode:h,checkMetaConsistency:p}}),define("js/RegistryKeys",[],function(){"use strict";return{COLOR:"color",TEXT_COLOR:"textColor",BORDER_COLOR:"borderColor",POSITION:"position",ROTATION:"rotation",DECORATOR:"decorator",IS_PORT:"isPort",IS_ABSTRACT:"isAbstract",REPLACEABLE:"replaceable",LINE_STYLE:"lineStyle",LINE_TYPE:"lineType",LINE_WIDTH:"lineWidth",LINE_START_ARROW:"lineStartArrow",LINE_END_ARROW:"lineEndArrow",LINE_CUSTOM_POINTS:"lineCustomPoints",LINE_LABEL_PLACEMENT:"lineLabel",VALID_PLUGINS:"validPlugins",USED_ADDONS:"usedAddOns",VALID_VISUALIZERS:"validVisualizers",VALID_DECORATORS:"validDecorators",PROJECT_REGISTRY:"ProjectRegistry",DISPLAY_FORMAT:"DisplayFormat",SVG_ICON:"SVGIcon",PORT_SVG_ICON:"PortSVGIcon",TREE_ITEM_COLLAPSED_ICON:"TreeItemCollapsedIcon",TREE_ITEM_EXPANDED_ICON:"TreeItemExpandedIcon",META_SHEETS:"MetaSheets",CROSSCUTS:"CrossCuts",DIAGRAM_DESIGNER_WIDGET_DECORATOR_DISABLED_CONNECTION_AREAS:"diagramDesignerWidgetDecoratorDisabledConnectionAreas_"}}),define("js/client/gmeNodeGetter",["js/RegistryKeys"],function(t){"use strict";function e(t,e,n){var i=n?n:"";console.warn('"gmeNode.'+t+'" is deprecated and will eventually be removed, use "gmeNode.'+e+'" instead.'+i)}function n(t,e){return t[e]&&t[e].node}function i(t,e,n,i){this._id=t,this._logger=e,this._state=n,this._storeNode=i}function o(t,e,n,o){return n.nodes[t]?new i(t,e,n,o):null}return i.prototype.getParentId=function(){return this._storeNode(this._state.core.getParent(this._state.nodes[this._id].node))},i.prototype.getId=function(){return this._id},i.prototype.getRelid=function(){return this._state.core.getRelid(this._state.nodes[this._id].node)},i.prototype.getGuid=function(){return this._state.core.getGuid(this._state.nodes[this._id].node)},i.prototype.getChildrenIds=function(){return this._state.core.getChildrenPaths(this._state.nodes[this._id].node)},i.prototype.getChildrenRelids=function(){return this._state.core.getChildrenRelids(this._state.nodes[this._id].node)},i.prototype.getBaseId=function(){return this._storeNode(this._state.core.getBase(this._state.nodes[this._id].node))},i.prototype.isValidNewBase=function(t){var e;return"string"==typeof t?(e=n(this._state.nodes,t),e?this._state.core.isValidNewBase(this._state.nodes[this._id].node,e):!1):void 0===t||null===t?!0:!1},i.prototype.isValidNewParent=function(t){var e;return"string"==typeof t?(e=n(this._state.nodes,t),e?this._state.core.isValidNewParent(this._state.nodes[this._id].node,e):!1):!1},i.prototype.getInheritorIds=function(){return this._state.core.getInstancePaths(this._state.nodes[this._id].node)},i.prototype.getAttribute=function(t){return this._state.core.getAttribute(this._state.nodes[this._id].node,t)},i.prototype.getOwnAttribute=function(t){return this._state.core.getOwnAttribute(this._state.nodes[this._id].node,t)},i.prototype.getEditableAttribute=function(t){var e=this._state.core.getAttribute(this._state.nodes[this._id].node,t);return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},i.prototype.getOwnEditableAttribute=function(t){var e=this._state.core.getOwnAttribute(this._state.nodes[this._id].node,t);return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},i.prototype.getRegistry=function(t){return this._state.core.getRegistry(this._state.nodes[this._id].node,t)},i.prototype.getOwnRegistry=function(t){return this._state.core.getOwnRegistry(this._state.nodes[this._id].node,t)},i.prototype.getEditableRegistry=function(t){var e=this._state.core.getRegistry(this._state.nodes[this._id].node,t);return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},i.prototype.getOwnEditableRegistry=function(t){var e=this._state.core.getOwnRegistry(this._state.nodes[this._id].node,t);return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},i.prototype.getPointer=function(t){return{to:this._state.core.getPointerPath(this._state.nodes[this._id].node,t),from:[]}},i.prototype.getPointerId=function(t){return this.getPointer(t).to},i.prototype.getOwnPointer=function(t){return{to:this._state.core.getOwnPointerPath(this._state.nodes[this._id].node,t),from:[]}},i.prototype.getOwnPointerId=function(t){return this.getOwnPointer(t).to},i.prototype.getPointerNames=function(){return this._state.core.getPointerNames(this._state.nodes[this._id].node)},i.prototype.getOwnPointerNames=function(){return this._state.core.getOwnPointerNames(this._state.nodes[this._id].node)},i.prototype.getAttributeNames=function(){return this._state.core.getAttributeNames(this._state.nodes[this._id].node)},i.prototype.getOwnAttributeNames=function(){return this._state.core.getOwnAttributeNames(this._state.nodes[this._id].node)},i.prototype.getAttributeMeta=function(t){return this._state.core.getAttributeMeta(this._state.nodes[this._id].node,t)},i.prototype.getRegistryNames=function(){return this._state.core.getRegistryNames(this._state.nodes[this._id].node)},i.prototype.getOwnRegistryNames=function(){return this._state.core.getOwnRegistryNames(this._state.nodes[this._id].node)},i.prototype.getMemberIds=function(t){return this._state.core.getMemberPaths(this._state.nodes[this._id].node,t)},i.prototype.getSetNames=function(){return this._state.core.getSetNames(this._state.nodes[this._id].node)},i.prototype.getMemberAttributeNames=function(t,e){return this._state.core.getMemberAttributeNames(this._state.nodes[this._id].node,t,e)},i.prototype.getMemberAttribute=function(t,e,n){return this._state.core.getMemberAttribute(this._state.nodes[this._id].node,t,e,n)},i.prototype.getEditableMemberAttribute=function(t,e,n){var i=this._state.core.getMemberAttribute(this._state.nodes[this._id].node,t,e,n);return null!==i&&void 0!==i?JSON.parse(JSON.stringify(i)):null},i.prototype.getMemberRegistryNames=function(t,e){return this._state.core.getMemberRegistryNames(this._state.nodes[this._id].node,t,e)},i.prototype.getMemberRegistry=function(t,e,n){return this._state.core.getMemberRegistry(this._state.nodes[this._id].node,t,e,n)},i.prototype.getEditableMemberRegistry=function(t,e,n){var i=this._state.core.getMemberRegistry(this._state.nodes[this._id].node,t,e,n);return null!==i&&void 0!==i?JSON.parse(JSON.stringify(i)):null},i.prototype.getSetRegistry=function(t,e){return this._state.core.getSetRegistry(this._state.nodes[this._id].node,t,e)},i.prototype.getSetRegistryNames=function(t){return this._state.core.getSetRegistryNames(this._state.nodes[this._id].node,t)},i.prototype.getSetAttribute=function(t,e){return this._state.core.getSetAttribute(this._state.nodes[this._id].node,t,e)},i.prototype.getSetAttributeNames=function(t){return this._state.core.getSetAttributeNames(this._state.nodes[this._id].node,t)},i.prototype.getValidChildrenTypes=function(){return e("getValidChildrenTypes()","getValidChildrenIds()"),this.getValidChildrenIds()},i.prototype.getValidAttributeNames=function(){return this._state.core.getValidAttributeNames(this._state.nodes[this._id].node)},i.prototype.getOwnValidAttributeNames=function(){return this._state.core.getOwnValidAttributeNames(this._state.nodes[this._id].node)},i.prototype.isValidAttributeValueOf=function(t,e){return this._state.core.isValidAttributeValueOf(this._state.nodes[this._id].node,t,e)},i.prototype.getValidPointerNames=function(){return this._state.core.getValidPointerNames(this._state.nodes[this._id].node)},i.prototype.getValidSetNames=function(){return this._state.core.getValidSetNames(this._state.nodes[this._id].node)},i.prototype.getConstraintNames=function(){return this._state.core.getConstraintNames(this._state.nodes[this._id].node)},i.prototype.getOwnConstraintNames=function(){return this._state.core.getOwnConstraintNames(this._state.nodes[this._id].node)},i.prototype.getConstraint=function(t){return this._state.core.getConstraint(this._state.nodes[this._id].node,t)},i.prototype.toString=function(){return this._state.core.getAttribute(this._state.nodes[this._id].node,"name")+" ("+this._id+")"},i.prototype.getCollectionPaths=function(t){return this._state.core.getCollectionPaths(this._state.nodes[this._id].node,t)},i.prototype.getInstancePaths=function(){return this._state.core.getInstancePaths(this._state.nodes[this._id].node)},i.prototype.getJsonMeta=function(){return this._state.core.getJsonMeta(this._state.nodes[this._id].node)},i.prototype.isConnection=function(){return this._state.core.isConnection(this._state.nodes[this._id].node)},i.prototype.isAbstract=function(){return this._state.core.isAbstract(this._state.nodes[this._id].node)},i.prototype.isLibraryRoot=function(){return this._state.core.isLibraryRoot(this._state.nodes[this._id].node)},i.prototype.isLibraryElement=function(){return this._state.core.isLibraryElement(this._state.nodes[this._id].node)},i.prototype.getFullyQualifiedName=function(){return this._state.core.getFullyQualifiedName(this._state.nodes[this._id].node)},i.prototype.getNamespace=function(){return this._state.core.getNamespace(this._state.nodes[this._id].node)},i.prototype.getLibraryGuid=function(){return this._state.core.getLibraryGuid(this._state.nodes[this._id].node)},i.prototype.getCrosscutsInfo=function(){return this._state.core.getRegistry(this._state.nodes[this._id].node,t.CROSSCUTS)||[]},i.prototype.getValidChildrenTypesDetailed=function(t,e){var n,i,o,r={node:this._state.nodes[this._id].node,children:[],sensitive:!e,multiplicity:!1,aspect:t},s={},a=this.getChildrenIds();for(o=0;o<a.length;o++)this._state.nodes[a[o]]&&r.children.push(this._state.nodes[a[o]].node);for(n=this._state.core.getValidChildrenMetaNodes(r),r.multiplicity=!0,i=this._state.core.getValidChildrenMetaNodes(r),o=0;o<n.length;o+=1)s[this._state.core.getPath(n[o])]=!1;for(o=0;o<i.length;o+=1)s[this._state.core.getPath(i[o])]=!0;return s},i.prototype.getValidSetMemberTypesDetailed=function(t){var e,n,i,o={node:this._state.nodes[this._id].node,members:[],sensitive:!0,multiplicity:!1,name:t},r={},s=this.getMemberIds(t);for(i=0;i<s.length;i++)this._state.nodes[s[i]]&&o.members.push(this._state.nodes[s[i]].node);for(e=this._state.core.getValidSetElementsMetaNodes(o),o.multiplicity=!0,n=this._state.core.getValidSetElementsMetaNodes(o),i=0;i<e.length;i+=1)r[this._state.core.getPath(e[i])]=!1;for(i=0;i<n.length;i+=1)r[this._state.core.getPath(n[i])]=!0;return r},i.prototype.getMetaTypeId=i.prototype.getBaseTypeId=function(){var t=this._state.core.getMetaType(this._state.nodes[this._id].node);return t?this._storeNode(t):null},i.prototype.isMetaNode=function(){return this._state.core.isMetaNode(this._state.nodes[this._id].node)},i.prototype.isTypeOf=function(t){var e=n(this._state.nodes,t);return e?this._state.core.isTypeOf(this._state.nodes[this._id].node,e):!1},i.prototype.isValidChildOf=function(t){var e=n(this._state.nodes,t);return e?this._state.core.isValidChildOf(this._state.nodes[this._id].node,e):!1},i.prototype.getValidChildrenIds=function(){return this._state.core.getValidChildrenPaths(this._state.nodes[this._id].node)},i.prototype.isValidTargetOf=function(t,e){var i=n(this._state.nodes,t);return i?this._state.core.isValidTargetOf(this._state.nodes[this._id].node,i,e):!1},i.prototype.getValidAspectNames=function(){return this._state.core.getValidAspectNames(this._state.nodes[this._id].node)},i.prototype.getOwnValidAspectNames=function(){return this._state.core.getOwnValidAspectNames(this._state.nodes[this._id].node)},i.prototype.getAspectMeta=function(t){return this._state.core.getAspectMeta(this._state.nodes[this._id].node,t)},i.prototype.getMixinPaths=function(){return this._state.core.getMixinPaths(this._state.nodes[this._id].node)},i.prototype.canSetAsMixin=function(t){return this._state.core.canSetAsMixin(this._state.nodes[this._id].node,t)},i.prototype.isReadOnly=function(){return this._state.readOnlyProject||this._state.viewer||this.isLibraryRoot()||this.isLibraryElement()},o}),define("js/client/gmeNodeSetter",[],function(){"use strict";function t(t,e,n,i,o){function r(t,e,n,i){var o=n?"gmeNode.":"gmeClient.",r=i?i:"";console.warn('"gmeClient.'+t+'" is deprecated and will eventually be removed, use "'+o+e+'" instead.'+r)}function s(t){return e.core&&e.nodes[t]&&"object"==typeof e.nodes[t].node?e.nodes[t].node:void 0}function a(t,n){var i;if(n=n||{},n.attributes)for(i in n.attributes)n.attributes.hasOwnProperty(i)&&e.core.setAttribute(t,i,n.attributes[i]);if(n.registry)for(i in n.registry)n.registry.hasOwnProperty(i)&&e.core.setRegistry(t,i,n.registry[i])}function l(t,n){var o,r,s,a,l,c,d,h,p,g={},u=function(){var n,i=!0;for(n=0;n<t.length;n+=1)i=i&&e.nodes[t[n]]&&"object"==typeof e.nodes[t[n]].node;return i};if(n&&u()){for(l={},c={},r=e.core.createNode({parent:e.core.getRoot(n),base:e.core.getTypeRoot(e.nodes[t[0]].node)}),s=e.core.createNode({parent:r}),o=0;o<t.length;o+=1)l[t[o]]={},l[t[o]].origparent=e.core.getParent(e.nodes[t[o]].node),l[t[o]].tempnode=e.core.moveNode(e.nodes[t[o]].node,s),c[e.core.getRelid(l[t[o]].tempnode)]=t[o],delete e.nodes[t[o]];for(a=e.core.copyNode(s,r),o=0;o<t.length;o+=1)l[t[o]].node=e.core.moveNode(l[t[o]].tempnode,l[t[o]].origparent),i(l[t[o]].node);for(d=e.core.getChildrenRelids(a),o=0;o<d.length;o+=1)c[d[o]]?(h=e.core.getChild(a,d[o]),p=e.core.moveNode(h,n),i(p),g[c[e.core.getRelid(h)]]=p):e.logger.error(new Error("Unexpected error when copying nodes!"));e.core.deleteNode(r)}return g}function c(t,i,r,a){var l,c=s(t);if(c){if(l=e.core.setAttribute(c,i,r),l instanceof Error)return void o(l);n(a||"setAttribute("+t+","+i+","+JSON.stringify(r)+")")}}function d(t,i,r){var a,l=s(t);if(l){if(a=e.core.delAttribute(l,i),a instanceof Error)return void o(a);n(r||"delAttribute("+t+","+i+")")}}function h(t,i,r,a){var l,c=s(t);if(c){if(l=e.core.setRegistry(c,i,r),l instanceof Error)return void o(l);n(a||"setRegistry("+t+","+i+","+JSON.stringify(r)+")")}}function p(t,i,r){var a,l=s(t);if(l){if(a=e.core.delRegistry(l,i),a instanceof Error)return void o(a);n(r||"delRegistry("+t+","+i+")")}}function g(t,r,l,c){var d,h,p=s(t),g=s(r);return p&&g?(d=e.core.copyNode(p,g),d instanceof Error?void o(d):(a(d,l),h=i(d),n(c||"copyNode("+t+", "+r+", "+JSON.stringify(l)+")"),h)):void 0}function u(t,i){var r,c,d=[],h=s(t.parentId);if(h){for(r in t)t.hasOwnProperty(r)&&"parentId"!==r&&d.push(r);if(i=i||"copyMoreNodes("+JSON.stringify(d)+","+t.parentId+")",d.length<1);else if(1===d.length)g(d[0],t.parentId,t[d[0]],i);else{if(c=l(d,h),c instanceof Error)return void o(c);for(r in c)c.hasOwnProperty(r)&&t[r]&&a(c[r],t[r]);n(i)}}else e.logger.error("wrong parameters for copy operation - denied -")}function f(t,o){var r,s,l=[],c={};for(r in t)t.hasOwnProperty(r)&&"parentId"!==r&&l.push(r);if(l.length>0&&"string"==typeof t.parentId&&e.nodes[t.parentId]&&"object"==typeof e.nodes[t.parentId].node)for(r=0;r<l.length;r+=1)e.nodes[l[r]]&&"object"==typeof e.nodes[l[r]].node&&(s=e.core.moveNode(e.nodes[l[r]].node,e.nodes[t.parentId].node),c[l[r]]=e.core.getPath(s),a(s,t[l[r]]),delete e.nodes[l[r]],i(s,!0));return n(o||"moveMoreNodes("+JSON.stringify(c)+")"),c}function m(t,o){var r,s,l,c,d,h,p={},g=[],u=[],f=e.nodes[t.parentId].node,m=[],_=[];for(g=Object.keys(t),g.splice(g.indexOf("parentId"),1),l=0;l<g.length;l++){for(r=e.nodes[g[l]].node,u.push(r),h={},s=e.core.getPointerNames(r),d=s.indexOf("base"),-1!==d&&s.splice(d,1),c=0;c<s.length;c++)d=g.indexOf(e.core.getPointerPath(r,s[c])),-1!==d&&(h[s[c]]=d);_.push(h)}for(l=0;l<u.length;l++)m.push(e.core.createNode({parent:f,base:u[l]}));for(l=0;l<g.length;l++){for(a(m[l],t[g[l]]),s=Object.keys(_[l]),c=0;c<s.length;c++)e.core.setPointer(m[l],s[c],m[_[l][s[c]]]);p[g[l]]=i(m[l])}return o=o||"createChildren("+JSON.stringify(p)+")",n(o),p}function _(t,i){var o=s(t);o&&(e.core.deleteNode(o),n(i||"deleteNode("+t+")"))}function b(t,i){var o,r,a=!1;for(o=0;o<t.length;o++)r=s(t[o]),r&&(e.core.deleteNode(r),a=!0);a&&n(i||"deleteNodes("+t+")")}function y(t,r,l){var c,d,h=s(t.parentId),p=s(t.baseId);if(h){if(c=e.core.createNode({parent:h,base:p,guid:t.guid,relid:t.relid}),c instanceof Error)return void o(c);r=r||{},r.registry=r.registry||{},r.registry.position=r.registry.position||{},r.registry.position.x=r.registry.position.x||100,r.registry.position.y=r.registry.position.y||100,a(c,r),i(c),d=e.core.getPath(c),n(l||"createNode("+t.parentId+","+t.baseId+","+d+")")}return d}function v(t,i,o,r){var a,l=s(t);l&&(null===o?e.core.setPointer(l,i,o):(a=s(o),e.core.setPointer(l,i,a)),n(r||"setPointer("+t+","+i+","+o+")"))}function C(t,i,o){var r=s(t);r&&(e.core.delPointer(r,i),n(o||"delPointer("+t+","+i+")"))}function E(t,i,o,r){var a=s(t),l=s(i);a&&l&&(e.core.addMember(a,o,l),n(r||"addMember("+t+","+i+","+o+")"))}function D(t,i,o,r){var a=s(t);a&&(e.core.delMember(a,o,i),n(r||"removeMember("+t+","+i+","+o+")"))}function I(t,i,o,r,a,l){var c=s(t);c&&(e.core.setMemberAttribute(c,o,i,r,a),n(l||"setMemberAttribute("+t+","+i+","+o+","+r+","+a+")"))}function P(t,i,o,r,a){var l=s(t);l&&(e.core.delMemberAttribute(l,o,i,r),n(a||"delMemberAttribute("+t+","+i+","+o+","+r+")"))}function T(t,i,o,r,a,l){var c=s(t);c&&(e.core.setMemberRegistry(c,o,i,r,a),n(l||"setMemberRegistry("+t+","+i+","+o+","+r+","+JSON.stringify(a)+")"))}function A(t,i,o,r,a){var l=s(t);l&&(e.core.delMemberRegistry(l,o,i,r),n(a||"delMemberRegistry("+t+","+i+","+o+","+r+")"))}function x(t,i,o,r,a){var l=s(t);l&&(e.core.setSetAttribute(l,i,o,r),n(a||"setSetAttribute("+t+","+i+","+o+","+JSON.stringify(r)+")"))}function w(t,i,o,r){var a=s(t);a&&(e.core.delSetAttribute(a,i,o),n(r||"delSetAttribute("+t+","+i+","+o+")"))}function N(t,i,o,r,a){var l=s(t);l&&(e.core.setSetRegistry(l,i,o,r),n(a||"setSetRegistry("+t+","+i+","+o+","+JSON.stringify(r)+")"))}function O(t,i,o,r){var a=s(t);a&&(e.core.delSetRegistry(a,i,o),n(r||"delSetRegistry("+t+","+i+","+o+")"))}function S(t,i,o){var r=s(t);r&&(e.core.createSet(r,i),n(o||"createSet("+t+","+i+")"))}function R(t,i,r){var a,l=s(t);if(l){if(a=e.core.delSet(l,i),a instanceof Error)return void o(a);n(r||"delSet("+t+","+i+")")}}function M(t,i,r){var a,l=s(t),c=s(i);if(l&&c){if(a=e.core.setBase(l,c),a instanceof Error)return void o(a);n(r||"setBase("+t+","+i+")")}}function L(t,o,r){var a,l=s(t),c=s(o);return l&&c&&(a=i(e.core.moveNode(l,c)),n(r||"moveNode("+t+","+o+")")),a}function k(t,i){var r,a=s(t);if(a){if(r=e.core.setBase(a,null),r instanceof Error)return void o(r);n(i||"delBase("+t+")")}}function B(t){var n=s(t),i={children:{},attributes:{},pointers:{},aspects:{}};return n?i=e.core.getJsonMeta(n):null}function j(t,i,r){var a,l,c,d,h=s(t);if(h){if(e.core.clearMetaRules(h),i.children&&i.children.items&&i.children.items.length>0){if(d=e.core.setChildrenMetaLimits(h,i.children.min,i.children.max),d instanceof Error)return void o(d);for(c=0;c<i.children.items.length;c+=1)if(a=s(i.children.items[c]),a&&(d=e.core.setChildMeta(h,a,i.children.minItems[c],i.children.maxItems[c]),d instanceof Error))return void o(d)}if(i.attributes)for(c in i.attributes)if(d=e.core.setAttributeMeta(h,c,i.attributes[c]),d instanceof Error)return void o(d);if(i.pointers)for(l in i.pointers)if(i.pointers[l].items&&i.pointers[l].items.length>0){if(d=e.core.setPointerMetaLimits(h,l,i.pointers[l].min,i.pointers[l].max),d instanceof Error)return void o(d);for(c=0;c<i.pointers[l].items.length;c+=1)if(a=s(i.pointers[l].items[c]),a&&(d=e.core.setPointerMetaTarget(h,l,a,i.pointers[l].minItems[c],i.pointers[l].maxItems[c]),d instanceof Error))return void o(d)}if(i.aspects)for(l in i.aspects)for(c=0;c<i.aspects[l].length;c+=1)if(a=s(i.aspects[l][c]),a&&(d=e.core.setAspectMetaTarget(h,l,a),d instanceof Error))return void o(d);if(i.constraints)for(l in i.constraints)if("object"==typeof i.constraints[l]&&(d=e.core.setConstraint(h,l,i.constraints[l]),d instanceof Error))return void o(d);n(r||"setMeta("+t+")")}}function G(t,i,r){var a,l=s(t);if(l){
if(a=e.core.addMixin(l,i),a instanceof Error)return void o(a);n(r||"addMixin("+t+","+i+")")}}function F(t,i,r){var a,l=s(t);if(l){if(a=e.core.delMixin(l,i),a instanceof Error)return void o(a);n(r,"delMixin("+t+","+i+")")}}function W(t,e,n,i){if("items"!==e){var o=B(t);o.children[e]=n,j(t,o,i)}}function $(t,i,r,a,l){var c,d=s(t),h=s(i);if(h&&d){if(c=e.core.setChildMeta(d,h,r,a),c instanceof Error)return void o(c);n(l||"setChildMeta("+t+", "+i+","+r||"-1,"+a||"-1)")}}function z(t,i,r){var a,l,c,d=s(t);if(i&&i.items&&d){for(c=0;c<i.items.length;c+=1)if(a=s(i.items[c].id),a&&(l=e.core.setChildMeta(d,a,i.items[c].min,i.items[c].max),l instanceof Error))return void o(l);if(l=e.core.setChildrenMetaLimits(d,i.min,i.max),l instanceof Error)return void o(l);n(r||"Meta.setChildrenMeta("+t+")")}}function V(t,i,r){var a,l=s(t);if(l){if(a=e.core.delChildMeta(l,i),a instanceof Error)return void o(a);n(r||"delChildMeta("+t+", "+i+")")}}function H(t,i,r,a){var l,c=s(t);if(c){if(l=e.core.setAttributeMeta(c,i,r),l instanceof Error)return void o(l);n(a||"setAttributeMeta("+t+", "+i+")")}}function U(t,i,r){var a,l=s(t);if(l){if(a=e.core.delAttributeMeta(l,i),a instanceof Error)return void o(a);n(r||"delAttributeMeta("+t+", "+i+")")}}function Y(t,i,r,a,l,c){var d,h=s(t),p=s(r);if(h&&p){if(d=e.core.setPointerMetaTarget(h,i,p,a,l),d instanceof Error)return void o(d);n(c||"setPointerMetaTarget("+t+", "+i+", "+r+","+a||"-1,"+l||"-1)")}}function X(t,i,r,a){var l,c=s(t);if(c){if(l=e.core.delPointerMetaTarget(c,i,r),l instanceof Error)return void o(l);n(a||"delPointerMetaTarget("+t+", "+i+", "+r+")")}}function J(t,i,r){var a,l=s(t);if(l){if(a=e.core.delPointerMeta(l,i),a instanceof Error)return void o(a);n(r||"delPointerMeta("+t+", "+i+")")}}function q(t,i,r,a){var l,c,d,h=s(t);if(r&&r.items&&h){for(d=0;d<r.items.length;d+=1)if(l=s(r.items[d].id),l&&(c=e.core.setPointerMetaTarget(h,i,l,r.items[d].min,r.items[d].max),c instanceof Error))return void o(c);if(c=e.core.setPointerMetaLimits(h,i,r.min,r.max),c instanceof Error)return void o(c);n(a||"setPointerMeta("+t+", "+i+")")}}function K(t,i,r,a){var l,c=s(t),d=s(r);if(c&&d){if(l=e.core.setAspectMetaTarget(c,i,d),l instanceof Error)return void o(l);n(a||"setAspectMetaTarget("+t+", "+i+","+r+")")}}function Z(t,i,r,a){var l,c=s(t);if(c){if(l=e.core.delAspectMetaTarget(c,i,r),l instanceof Error)return void o(l);n(a||"delAspectMeta("+t+", "+i+")")}}function Q(t,i,r,a){var l,c,d,h=s(t);if(h){if(d=e.core.delAspectMeta(h,i),d instanceof Error)return void o(d);for(l=0;l<r.length;l+=1)if(c=s(r[l]),c&&(d=e.core.setAspectMetaTarget(h,i,c),d instanceof Error))return void o(d);n(a||"setAspectMetaTargets("+t+", "+i+","+JSON.stringify(r)+")")}}function tt(t,i,r){var a,l=s(t);if(l){if(a=e.core.delAspectMeta(l,i),a instanceof Error)return void o(a);n(r||"delAspectMeta("+t+", "+i+")")}}function et(t,n){var i=s(t),o=s(n);return i&&o?e.core.isTypeOf(i,o):!1}function nt(t,n,i){var o=s(t),r=s(i);return o&&r?e.core.isValidTargetOf(r,o,n):!1}function it(t,e,n){for(var i=[],o=0;o<n.length;o++)nt(t,e,n[o])&&i.push(n[o]);return i}function ot(t,n){var i,o,r=s(t),a=[];if(r){i=e.core.getPointerMeta(r,n);for(o in i)"min"!==o&&"max"!==o&&a.push(o)}return a}function rt(t,n){var i,o=s(t);return o?(i=e.core.getOwnJsonMeta(o),i.pointers=i.pointers||{},i.pointers[n]=i.pointers[n]||{},i.pointers[n].items||[]):[]}function st(t,n,i){var o,r,a,l=s(t),c=[];if(l&&(o=e.core.getPointerMeta(l,n),r=i?e.core.getOwnJsonMeta(l):e.core.getJsonMeta(l),r=r&&r.pointers&&r.pointers[n]?r.pointers[n].items||[]:[],o&&r.length>0)){delete o.min,delete o.max;for(a in o)-1!==r.indexOf(a)&&c.push({id:a,min:-1===o[a].min?void 0:o[a].min,max:-1===o[a].max?void 0:o[a].max});return c}return null}function at(t,e){return st(t,e,!1)}function lt(t,e){return st(t,e,!0)}function ct(t,n){var i=s(n),o=s(t);return i&&o?e.core.isValidChildOf(i,o):!1}function dt(t){var n=s(t);return n?e.core.getValidChildrenPaths(n):[]}function ht(t){var n=s(t);return n?e.core.getValidAttributeNames(n):[]}function pt(t){var n=s(t);return n?e.core.getOwnValidAttributeNames(n):[]}function gt(t,n){var i,o,r,a=s(t);if(a&&(i=e.core.getPointerMeta(a,n))){r={min:i.min,max:i.max,items:[]};for(o in i)"min"!==o&&"max"!==o&&r.items.push({id:o,min:-1===i[o].min?void 0:i[o].min,max:-1===i[o].max?void 0:i[o].max});return r}return null}function ut(t,n){var i=s(t);return i?e.core.getAttributeMeta(i,n):void 0}function ft(t){var n=s(t);return n?e.core.getValidAspectNames(n):[]}function mt(t){var n=s(t);return n?e.core.getOwnValidAspectNames(n):[]}function _t(t,n){var i,o=s(t);return o&&(i=e.core.getAspectMeta(o,n))?{items:i}:null}function bt(t){var n,i,o=s(t);if(o){if(n=e.core.getOwnJsonMeta(o),n.children&&n.children.items&&n.children.items.length>0)return!0;for(i in n.pointers||{})return!0;for(i in n.attributes||{})return!0;for(i in n.aspects||{})return!0;if(n.mixins&&n.mixins.length>0)return!0}return!1}function yt(t){var n,i,o=s(t),r={items:[]};if(o){if(n=e.core.getChildrenMeta(o)){r={min:n.min,max:n.max,items:[]};for(i in n)"min"!==i&&"max"!==i&&r.items.push({id:i,min:-1===n[i].min?void 0:n[i].min,max:-1===n[i].max?void 0:n[i].max})}return r}return null}function vt(t){var e=yt(t);return e?e.attrName:null}function Ct(t){var e=yt(t);return e?e.items:null}function Et(t){var n,i=s(t);return i&&(n=e.core.getOwnJsonMeta(i),n&&n.children&&n.children.items)?n.children.items:[]}function Dt(t,e){var n=_t(t,e);return null!==n?(n.children=1,n):null}return{setAttribute:c,setAttributes:function(){r("setAttributes","setAttribute"),c.apply(null,arguments)},delAttribute:d,delAttributes:function(){r("delAttributes","delAttribute"),d.apply(null,arguments)},setRegistry:h,delRegistry:p,copyNode:g,copyMoreNodes:u,moveNode:L,moveMoreNodes:f,deleteNode:_,deleteNodes:b,delMoreNodes:function(){r("delMoreNodes","deleteNodes"),b.apply(null,arguments)},createNode:y,createChild:function(t,e){return y(t,{registry:{position:t.position}},e)},createChildren:m,setPointer:v,makePointer:function(){r("makePointer","setPointer"),v.apply(null,arguments)},delPointer:C,deletePointer:C,addMember:E,removeMember:D,setMemberAttribute:I,delMemberAttribute:P,setMemberRegistry:T,delMemberRegistry:A,setSetAttribute:x,delSetAttribute:w,setSetRegistry:N,delSetRegistry:O,createSet:S,delSet:R,deleteSet:R,setBase:M,delBase:k,setMeta:j,setChildrenMeta:z,setChildrenMetaAttribute:W,setChildMeta:$,updateValidChildrenItem:function(t,e,n){r("updateValidChildrenItem(path, newTypeObj, msg)","setChildMeta(path, childPath, min, max, msg)"),e=e||{},$(t,e.id,e.min,e.max,n)},delChildMeta:V,removeValidChildrenItem:function(){r("removeValidChildrenItem","delChildMeta"),V.apply(null,arguments)},setAttributeMeta:H,setAttributeSchema:function(){r("setAttributeSchema","setAttributeMeta"),H.apply(null,arguments)},delAttributeMeta:U,removeAttributeSchema:function(){r("removeAttributeSchema","delAttributeMeta"),U.apply(null,arguments)},setPointerMeta:q,setPointerMetaTarget:Y,updateValidTargetItem:function(t,e,n,i){r("updateValidTargetItem(path, name, targetObj, msg)","setPointerMetaTarget(path, name, targetPath, childPath, min, max, msg)"),n=n||{},Y(t,e,n.id,n.min,n.max,i)},delPointerMetaTarget:X,removeValidTargetItem:function(){r("removeValidTargetItem","delPointerMetaTarget"),X.apply(null,arguments)},delPointerMeta:J,deleteMetaPointer:function(){r("deleteMetaPointer","delPointerMeta"),J.apply(null,arguments)},setAspectMetaTarget:K,setAspectMetaTargets:Q,setMetaAspect:function(){r("setMetaAspect","setAspectMetaTargets"),Q.apply(null,arguments)},delAspectMetaTarget:Z,delAspectMeta:tt,deleteMetaAspect:function(){r("deleteMetaAspect","delAspectMeta"),tt.apply(null,arguments)},addMixin:G,delMixin:F,getMeta:function(){return r("getMeta(path)","getJsonMeta()",!0),B.apply(null,arguments)},isTypeOf:function(){return et.apply(null,arguments)},isValidTarget:function(){return r("isValidTarget(path, name, targetPath)","isValidTargetOf(sourcePath, name)",!0),nt.apply(null,arguments)},filterValidTarget:function(){return it.apply(null,arguments)},getValidTargetTypes:function(){return ot.apply(null,arguments)},getOwnValidTargetTypes:function(){return rt.apply(null,arguments)},getValidTargetItems:function(){return at.apply(null,arguments)},getOwnValidTargetItems:function(){return lt.apply(null,arguments)},getPointerMeta:function(){return gt.apply(null,arguments)},isValidChild:function(){return r("isValidChild(path, childPath)","isValidChildOf(parentPath)",!0),ct.apply(null,arguments)},getValidChildrenTypes:function(){return r("getValidChildrenTypes(path)","getValidChildrenIds()",!0),dt.apply(null,arguments)},getValidAttributeNames:function(){return r("getValidAttributeNames(path)","getValidAttributeNames()",!0),ht.apply(null,arguments)},getOwnValidAttributeNames:function(){return r("getOwnValidAttributeNames(path)","getOwnValidAttributeNames()",!0),pt.apply(null,arguments)},getAttributeSchema:function(){return r("getAttributeSchema(path, name)","getAttributeMeta(name)",!0),ut.apply(null,arguments)},getMetaAspectNames:function(){return r("getMetaAspectNames(path)","getValidAspectNames()",!0),ft.apply(null,arguments)},getOwnMetaAspectNames:function(){return r("getOwnMetaAspectNames(path)","getOwnValidAspectNames()",!0),mt.apply(null,arguments)},getMetaAspect:function(){return r("getMetaAspect(path, name)","getAspectMeta(name)",!0," Returned value is of different structure! {items: meta} vs meta"),_t.apply(null,arguments)},hasOwnMetaRules:function(){return bt.apply(null,arguments)},getChildrenMeta:function(){return yt.apply(null,arguments)},getChildrenMetaAttribute:function(){return vt.apply(null,arguments)},getValidChildrenItems:function(){return Ct.apply(null,arguments)},getOwnValidChildrenTypes:function(){return Et.apply(null,arguments)},getAspectTerritoryPattern:function(){return Dt.apply(null,arguments)}}}return t}),define("common/Constants",["common/core/constants"],function(t){"use strict";return{TERRITORY_EVENT_LOAD:"load",TERRITORY_EVENT_UPDATE:"update",TERRITORY_EVENT_UNLOAD:"unload",TERRITORY_EVENT_COMPLETE:"complete",TERRITORY_EVENT_INCOMPLETE:"incomplete",GME_ID:"GME_ID",PROJECT_ROOT_ID:"",PROJECT_FCO_ID:"FCO_ID",PROJECT_FCO_GUID:"cd891e7b-e2ea-e929-f6cd-9faf4f1fc045",PROJECT_FCO_RELID:"1",PROJECT_ROOT_NAME:"ROOT",POINTER_SOURCE:"src",POINTER_TARGET:"dst",POINTER_BASE:"base",POINTER_CONSTRAINED_BY:"constrainedby",RELATION_CONTAINMENT:"containment",CORE:t}}),define("js/Constants",["underscore","common/Constants","js/client/constants"],function(t,e,n){"use strict";var i={};return _.extend(i,e,{ALL_OVER_THE_SCREEN_DRAGGABLE_PARENT_ID:"body",META_INFO:"metaInfo",DRAG_SOURCE:"dragSource",LINE_STYLE:{WIDTH:"width",COLOR:"color",PATTERN:"pattern",PATTERNS:{SOLID:"",DASH:"-",LONGDASH:"- ",DOT:".",DASH_DOT:"-.",DASH_DOT_DOT:"-.."},TYPE:"type",TYPES:{NONE:"",BEZIER:"bezier"},START_ARROW:"start-arrow",END_ARROW:"end-arrow",CUSTOM_POINTS:"custom-points",LABEL_PLACEMENT:"label-placement",LABEL_PLACEMENTS:{SRC:"src",MIDDLE:"mid",DST:"dst"},LINE_ARROWS:{NONE:"none",DIAMOND:"diamond",BLOCK:"block",CLASSIC:"classic",OPEN:"open",OVAL:"oval",DIAMOND2:"diamond2",INHERITANCE:"inheritance"}},DISPLAY_FORMAT_ATTRIBUTE_MARKER:"$",ASSETS_DECORATOR_SVG_FOLDER:"assets/DecoratorSVG/",STATE_ACTIVE_OBJECT:"activeObject",STATE_ACTIVE_SELECTION:"activeSelection",STATE_ACTIVE_ASPECT:"activeAspect",STATE_ACTIVE_VISUALIZER:"activeVisualizer",STATE_ACTIVE_PROJECT_NAME:"activeProjectName",STATE_ACTIVE_COMMIT:"activeCommit",STATE_ACTIVE_BRANCH_NAME:"activeBranchName",STATE_ACTIVE_CROSSCUT:"activeCrosscut",STATE_ACTIVE_TAB:"activeTab",STATE_LAYOUT:"layout",ASPECT_ALL:"All",PROPERTY_GROUP_META:"META",PROPERTY_GROUP_PREFERENCES:"Preferences",PROPERTY_GROUP_ATTRIBUTES:"Attributes",PROPERTY_GROUP_POINTERS:"Pointers",DEFAULT_VISUALIZER:"ModelEditor",VISUALIZER_PANEL_IDENTIFIER:"VISUALIZER_PANEL_IDENTIFIER"}),i.CLIENT=n,i}),define("js/client/libraries",["js/Constants"],function(t){"use strict";function e(e,n,i,o){function r(){return n.core&&n.nodes[t.PROJECT_ROOT_ID]&&"object"==typeof n.nodes[t.PROJECT_ROOT_ID].node?n.core.getLibraryNames(n.nodes[t.PROJECT_ROOT_ID].node):[]}function s(e){return n.core&&n.nodes[t.PROJECT_ROOT_ID]&&"object"==typeof n.nodes[t.PROJECT_ROOT_ID].node?n.core.getLibraryInfo(n.nodes[t.PROJECT_ROOT_ID].node,e)||null:null}function a(t,o,r){var s={command:"addLibrary",projectId:n.project.projectId,libraryName:t,branchName:n.branchName};"string"==typeof o?s.blobHash=o:s.libraryInfo=o,i.simpleRequest(s,function(t,n){t&&e.error(t),r(t,n)})}function l(t,o,r){var s={command:"updateLibrary",projectId:n.project.projectId,libraryName:t,branchName:n.branchName};"string"==typeof o?s.blobHash=o:o&&(s.libraryInfo=o),i.simpleRequest(s,function(t,n){t&&e.error(t),r(t,n)})}function c(e){n.core.removeLibrary(n.nodes[t.PROJECT_ROOT_ID].node,e),o("removeLibrary("+e+")")}function d(e,i){n.core.renameLibrary(n.nodes[t.PROJECT_ROOT_ID].node,e,i),o("renameLibrary("+e+","+i+")")}function h(t,i){var o,r;return n.nodes[t]?(r=s(n.core.getFullyQualifiedName(n.nodes[t].node)))?r.projectId?(o=window.location.origin+"/?project="+encodeURIComponent(r.projectId),r.branchName&&i?o+="&branch="+encodeURIComponent(r.branchName):r.commitHash&&(o+="&commit="+encodeURIComponent(r.commitHash)),window.open(o,"_blank"),void window.focus()):void e.warn("the library has only partial info"):void e.warn("the library has no valid info"):void e.warn("only cached libraries can be followed!")}return{getLibraryNames:r,addLibrary:a,updateLibrary:l,removeLibrary:c,renameLibrary:d,getLibraryInfo:s,openLibraryOriginInNewWindow:h}}return e}),define("blob/BlobConfig",[],function(){"use strict";var t={hashMethod:"sha1",hashRegex:new RegExp("^[0-9a-f]{40}$")};return t}),define("blob/BlobMetadata",["blob/BlobConfig"],function(t){"use strict";var e=function(n){var i;if(!n)throw new Error("metadata parameter is not defined");if(this.name=n.name,this.size=n.size||0,this.mime=n.mime||"",this.isPublic=n.isPublic||!1,this.tags=n.tags||[],this.content=n.content,this.contentType=n.contentType||e.CONTENT_TYPES.OBJECT,this.contentType===e.CONTENT_TYPES.COMPLEX)for(i in this.content)if(this.content.hasOwnProperty(i)&&t.hashRegex.test(this.content[i].content)===!1)throw new Error("BlobMetadata is malformed: hash '"+this.content[i].content+"'is invalid")};return e.CONTENT_TYPES={OBJECT:"object",COMPLEX:"complex",SOFT_LINK:"softLink"},e.prototype.serialize=function(){var t={name:this.name,size:this.size,mime:this.mime,isPublic:this.isPublic,tags:this.tags,content:this.content,contentType:this.contentType};if(t.tags.sort(),this.contentType===e.CONTENT_TYPES.COMPLEX){t.content={};var n=Object.keys(this.content);n.sort();for(var i=0;i<n.length;i+=1)t.content[n[i]]=this.content[n[i]]}return t},e}),define("blob/Artifact",["blob/BlobMetadata","blob/BlobConfig","common/core/tasync","q"],function(t,e,n,i){"use strict";var o=function(t,e,i){this.name=t,this.blobClient=e,this.blobClientPutFile=n.unwrap(n.throttle(n.wrap(e.putFile),5)),this.blobClientGetMetadata=n.unwrap(n.throttle(n.wrap(e.getMetadata),5)),this.descriptor=i||{name:t+".zip",size:0,mime:"application/zip",content:{},contentType:"complex"}};return o.prototype.addFile=function(t,e,n){var o=this,r=t.substring(t.lastIndexOf("/")+1),s=i.defer();return o.blobClientPutFile.call(o.blobClient,r,e,function(e,n){return e?void s.reject(e):void o.addObjectHash(t,n,function(t,e){return t?void s.reject(t):void s.resolve(e)})}),s.promise.nodeify(n)},o.prototype.addFileAsSoftLink=function(t,e,n){var o=i.defer(),r=this,s=t.substring(t.lastIndexOf("/")+1);return r.blobClientPutFile.call(r.blobClient,s,e,function(n,i){if(n)return void o.reject(n);var s;void 0!==e.size&&(s=e.size),void 0!==e.length&&(s=e.length),r.addMetadataHash(t,i,s).then(o.resolve)["catch"](o.reject)}),o.promise.nodeify(n)},o.prototype.addObjectHash=function(n,o,r){var s=this,a=i.defer();return e.hashRegex.test(o)===!1?a.reject("Blob hash is invalid"):s.blobClientGetMetadata.call(s.blobClient,o,function(e,i){return e?void a.reject(e):void(s.descriptor.content.hasOwnProperty(n)?a.reject(new Error("Another content with the same name was already added. "+JSON.stringify(s.descriptor.content[n]))):(s.descriptor.size+=i.size,s.descriptor.content[n]={content:i.content,contentType:t.CONTENT_TYPES.OBJECT},a.resolve(o)))}),a.promise.nodeify(r)},o.prototype.addMetadataHash=function(n,o,r,s){var a=this,l=i.defer(),c=function(e){a.descriptor.content.hasOwnProperty(n)?l.reject(new Error("Another content with the same name was already added. "+JSON.stringify(a.descriptor.content[n]))):(a.descriptor.size+=e,a.descriptor.content[n]={content:o,contentType:t.CONTENT_TYPES.SOFT_LINK},l.resolve(o))};return"function"==typeof r&&(s=r,r=void 0),e.hashRegex.test(o)===!1?l.reject(new Error("Blob hash is invalid")):void 0===r?a.blobClientGetMetadata.call(a.blobClient,o,function(t,e){return t?void l.reject(t):void c(e.size)}):c(r),l.promise.nodeify(s)},o.prototype.addFiles=function(t,e){var n=this,o=Object.keys(t);return i.all(o.map(function(e){return n.addFile(e,t[e])})).nodeify(e)},o.prototype.addFilesAsSoftLinks=function(t,e){var n=this,o=Object.keys(t);return i.all(o.map(function(e){return n.addFileAsSoftLink(e,t[e])})).nodeify(e)},o.prototype.addObjectHashes=function(t,e){var n=this,o=Object.keys(t);return i.all(o.map(function(e){return n.addObjectHash(e,t[e])})).nodeify(e)},o.prototype.addMetadataHashes=function(t,e){var n=this,o=Object.keys(t);return i.all(o.map(function(e){return n.addMetadataHash(e,t[e])})).nodeify(e)},o.prototype.save=function(t){var e=i.defer();return this.blobClient.putMetadata(this.descriptor,function(t,n){t?e.reject(t):e.resolve(n)}),e.promise.nodeify(t)},o}),define("common/util/uint",[],function(){"use strict";function t(t){var e,n="";for(e=0;e<t.byteLength;e++)n+=String.fromCharCode(t[e]);return decodeURIComponent(escape(n))}return{uint8ArrayToString:t}}),define("blob/BlobClient",["blob/Artifact","blob/BlobMetadata","superagent","q","common/util/uint"],function(t,e,n,i,o){"use strict";var r=function(t){var e=this;if(this.artifacts=[],t&&t.logger)this.logger=t.logger;else{var n=function(){console.log.apply(console,arguments)};this.logger={debug:n,log:n,info:n,warn:n,error:n},console.warn("Since v1.3.0 BlobClient requires a logger, falling back on console.log.")}t&&t.uploadProgressHandler?this.uploadProgressHandler=t.uploadProgressHandler:this.uploadProgressHandler=function(t,n){e.logger.debug("File upload of",t,n.percent,"%")},this.logger.debug("ctor",{metadata:t}),t?(this.server=t.server||this.server,this.serverPort=t.serverPort||this.serverPort,this.httpsecure=void 0!==t.httpsecure?t.httpsecure:this.httpsecure,this.webgmeToken=t.webgmeToken,this.keepaliveAgentOptions=t.keepaliveAgentOptions||{}):this.keepaliveAgentOptions={},this.origin="",void 0!==this.httpsecure&&this.server&&this.serverPort&&(this.origin=(this.httpsecure?"https://":"http://")+this.server+":"+this.serverPort),this.relativeUrl="/rest/blob/",this.blobUrl=this.origin+this.relativeUrl,this.isNodeOrNodeWebKit="undefined"!=typeof process,this.isNodeOrNodeWebKit&&(this.logger.debug("Running under node or node-web-kit"),this.httpsecure?this.Agent=require("agentkeepalive").HttpsAgent:this.Agent=require("agentkeepalive"),this.keepaliveAgentOptions.hasOwnProperty("ca")===!1&&(this.keepaliveAgentOptions.ca=require("https").globalAgent.options.ca),this.keepaliveAgent=new this.Agent(this.keepaliveAgentOptions)),this.logger.debug("origin",this.origin),this.logger.debug("blobUrl",this.blobUrl)};return r.prototype.getMetadataURL=function(t){return this.origin+this.getRelativeMetadataURL(t)},r.prototype.getRelativeMetadataURL=function(t){var e=this.relativeUrl+"metadata";return t?e+"/"+t:e},r.prototype._getURL=function(t,e,n){var i="";return n&&(i=n),this.relativeUrl+t+"/"+e+"/"+encodeURIComponent(i)},r.prototype.getViewURL=function(t,e){return this.origin+this.getRelativeViewURL(t,e)},r.prototype.getRelativeViewURL=function(t,e){return this._getURL("view",t,e)},r.prototype.getDownloadURL=function(t,e){return this.origin+this.getRelativeDownloadURL(t,e)},r.prototype.getRelativeDownloadURL=function(t,e){return this._getURL("download",t,e)},r.prototype.getCreateURL=function(t,e){return this.origin+this.getRelativeCreateURL(t,e)},r.prototype.getRelativeCreateURL=function(t,e){return e?this.relativeUrl+"createMetadata/":this.relativeUrl+"createFile/"+encodeURIComponent(t)},r.prototype.putFile=function(t,e,o){function r(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0;i<t.length;++i)n[i]=t[i];return e}var s,a,l=i.defer(),c=this;return this.logger.debug("putFile",t),"undefined"!=typeof window&&"undefined"!=typeof Buffer&&e instanceof Buffer&&(e=r(e)),"undefined"==typeof window&&"undefined"!=typeof Buffer&&e instanceof Buffer&&0===e.length&&(e=""),s=e.hasOwnProperty("length")?e.length:e.byteLength,a=n.post(this.getCreateURL(t)),"undefined"==typeof window&&a.agent(this.keepaliveAgent),this.webgmeToken&&a.set("Authorization","Bearer "+this.webgmeToken),"string"==typeof e||e instanceof String||"undefined"!=typeof window||a.set("Content-Length",s),a.set("Content-Type","application/octet-stream").send(e).on("progress",function(e){c.uploadProgressHandler(t,e)}).end(function(t,e){if(t||e.status>399)return void l.reject(t||new Error(e.status));var n=e.body,i=Object.keys(n)[0];c.logger.debug("putFile - result",i),l.resolve(i)}),l.promise.nodeify(o)},r.prototype.putMetadata=function(t,o){var r,s,a,l=new e(t),c=i.defer(),d=this;return this.logger.debug("putMetadata",{metadata:t}),"undefined"!=typeof Blob?(r=new Blob([JSON.stringify(l.serialize(),null,4)],{type:"text/plain"}),s=r.size):(r=new Buffer(JSON.stringify(l.serialize(),null,4),"utf8"),s=r.length),a=n.post(this.getCreateURL(t.name,!0)),this.webgmeToken&&a.set("Authorization","Bearer "+this.webgmeToken),"undefined"==typeof window&&(a.agent(this.keepaliveAgent),a.set("Content-Length",s)),a.set("Content-Type","application/octet-stream").send(r).end(function(t,e){if(t||e.status>399)return void c.reject(t||new Error(e.status));var n=JSON.parse(e.text),i=Object.keys(n)[0];d.logger.debug("putMetadata - result",i),c.resolve(i)}),c.promise.nodeify(o)},r.prototype.putFiles=function(t,e){var n,o,r=this,s=i.defer(),a=Object.keys(t),l=a.length,c={};0===l&&s.resolve(c),o=function(t,e){r.putFile(t,e,function(e,i){l-=1,c[t]=i,e&&(n=e,r.logger.error("putFile failed with error",{metadata:e})),0===l&&(n?s.reject(n):s.resolve(c))})};for(var d=0;d<a.length;d+=1)o(a[d],t[a[d]]);return s.promise.nodeify(e)},r.prototype.getSubObject=function(t,e,n){return this.getObject(t,n,e)},r.prototype.getObject=function(t,e,r){var s=i.defer(),a=this;this.logger.debug("getObject",t,r),n.parse["application/zip"]=function(t,e){return e?void 0:t};var l=n.get(this.getViewURL(t,r));if(this.webgmeToken&&l.set("Authorization","Bearer "+this.webgmeToken),"undefined"==typeof window&&l.agent(this.keepaliveAgent),l.pipe){var c=require("stream").Writable,d=function(t){c.call(this,t);var e=this;e.buffers=[]};require("util").inherits(d,c),d.prototype._write=function(t,e,n){this.buffers.push(t),n()};var h=new d;h.on("finish",function(){l.req.res.statusCode>399?s.reject(new Error(l.req.res.statusCode)):s.resolve(Buffer.concat(h.buffers))}),h.on("error",function(t){s.reject(t)}),l.pipe(h)}else l.removeAllListeners("end"),l.on("request",function(){"undefined"!=typeof this.xhr&&(this.xhr.responseType="arraybuffer")}),l.on("end",function(){if(l.xhr.status>399)s.reject(new Error(l.xhr.status));else{var t=l.xhr.getResponseHeader("content-type"),e=l.xhr.response;"application/json"===t&&(e=JSON.parse(o.uint8ArrayToString(new Uint8Array(e)))),a.logger.debug("getObject - result",{metadata:e}),s.resolve(e)}}),l.end(function(t,e){t?s.reject(t):(a.logger.debug("getObject - result",{metadata:e}),s.resolve(e))});return s.promise.nodeify(e)},r.prototype.getObjectAsString=function(t,e){var n=this;return n.getObject(t).then(function(t){if("string"==typeof t)return t;if("undefined"!=typeof Buffer&&t instanceof Buffer)return o.uint8ArrayToString(new Uint8Array(t));if(t instanceof ArrayBuffer)return o.uint8ArrayToString(new Uint8Array(t));if(null!==t&&"object"==typeof t)return JSON.stringify(t);throw new Error("Unknown content encountered: "+t)}).nodeify(e)},r.prototype.getObjectAsJSON=function(t,e){var n=this;return n.getObject(t).then(function(t){if("string"==typeof t)return JSON.parse(t);if("undefined"!=typeof Buffer&&t instanceof Buffer)return JSON.parse(o.uint8ArrayToString(new Uint8Array(t)));if(t instanceof ArrayBuffer)return JSON.parse(o.uint8ArrayToString(new Uint8Array(t)));if(null!==t&&"object"==typeof t)return t;throw new Error("Unknown content encountered: "+t)}).nodeify(e)},r.prototype.getMetadata=function(t,e){var o=n.get(this.getMetadataURL(t)),r=i.defer(),s=this;return this.logger.debug("getMetadata",t),this.webgmeToken&&o.set("Authorization","Bearer "+this.webgmeToken),"undefined"==typeof window&&o.agent(this.keepaliveAgent),o.end(function(t,e){t||e.status>399?r.reject(t||new Error(e.status)):(s.logger.debug("getMetadata",e.text),r.resolve(JSON.parse(e.text)))}),r.promise.nodeify(e)},r.prototype.createArtifact=function(e){var n=new t(e,this);return this.artifacts.push(n),n},r.prototype.getArtifact=function(n,o){var r=this,s=i.defer();return this.logger.debug("getArtifact",n),this.getMetadata(n,function(n,i){if(n)return void s.reject(n);if(r.logger.debug("getArtifact - return",{metadata:i}),i.contentType===e.CONTENT_TYPES.COMPLEX){var o=new t(i.name,r,i);r.artifacts.push(o),s.resolve(o)}else s.reject(new Error("not supported contentType "+JSON.stringify(i,null,4)))}),s.promise.nodeify(o)},r.prototype.saveAllArtifacts=function(t){for(var e=[],n=0;n<this.artifacts.length;n+=1)e.push(this.artifacts[n].save());return i.all(e).nodeify(t)},r.prototype.getHumanSize=function(t,e){var n=e?1e3:1024,i=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;if(n>t)return t+" B";do t/=n,o+=1;while(t>=n);return t.toFixed(1)+" "+i[o]},r}),define("js/Utils/SaveToDisk",["blob/BlobClient"],function(t){"use strict";function e(t,e){if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var n=window.open(t,"_self");n.document.close(),n.document.execCommand("SaveAs",!0,e||t),n.close()}}else{var i=document.createElement("a");document.createEvent("Event");i.href=t,i.target="_self",e&&(i.download=e),i.click()}}function n(t,e){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function i(e,n,i,o){var r=new t({logger:i}),s=r.createArtifact("uploaded");s.addFile(e,JSON.stringify(n,null,4),function(t,e){o(t,r.getDownloadURL(e))})}function o(t,n,o,r){i(t,n,o,function(n,i){return n?r(n):(e(i,t),void r(null,i))})}return{saveToBlobStorage:i,saveUrlToDisk:e,saveJsonToDisk:o,downloadTextAsFile:n}}),define("js/client/stateloghelpers",["js/Utils/SaveToDisk"],function(t){"use strict";function e(t,e){var n,i,o,r;if("project"===t)return e?e.name:null;if("core"===t)return e?"instantiated":"notInstantiated";if("metaNodes"===t)return Object.keys(e);if("nodes"===t)return Object.keys(e);if("loadNodes"===t)return Object.keys(e);if("users"===t)return Object.keys(e);if("rootObject"!==t){if("undoRedoChain"===t&&e){for(r={previous:null,next:null},e.previous&&(i={},r.previous=i),n=e;n.previous;)i.previous={commitHash:n.commitHash,previous:null},i=i.previous,n=n.previous;for(e.next&&(o={},r.next=o),n=e;n.next;)o.next={commitHash:n.commitHash,next:null},o=o.next,n=n.next;return r}return e}}function n(t,n,i,o){return o=o||0,i===!0?JSON.stringify(n,e,o):JSON.stringify({connection:t.getNetworkStatus(),projectId:t.getActiveProjectId(),branchName:t.getActiveBranchName(),branchStatus:t.getBranchStatus(),commitHash:t.getActiveCommitHash(),rootHash:t.getActiveRootHash(),projectReadOnly:t.isProjectReadOnly(),commitReadOnly:t.isCommitReadOnly()},null,o)}function i(e,i){var o={timestamp:(new Date).toISOString(),webgme:{NpmVersion:"n/a",version:"n/a",GitHubVersion:"n/a"},gmeConfig:e.gmeConfig,uiState:null,branchErrors:[],browserInfo:{appCodeName:window.navigator.appCodeName,appName:window.navigator.appName,appVersion:window.navigator.appVersion,onLine:window.navigator.onLine,cookieEnabled:window.navigator.cookieEnabled,platform:window.navigator.platform,product:window.navigator.product,userAgent:window.navigator.userAgent},clientState:JSON.parse(n(e,i,!0))};"undefined"!=typeof WebGMEGlobal&&(o.webgme.NpmVersion=WebGMEGlobal.NpmVersion,o.webgme.GitHubVersion=WebGMEGlobal.GitHubVersion,o.webgme.version=WebGMEGlobal.version),"function"==typeof e.uiStateGetter?o.uiState=e.uiStateGetter():o.uiState="Client did not have an attached uiStateGetter.",i.project&&i.branchName&&i.project.branches[i.branchName]&&i.project.branches[i.branchName].errorList.forEach(function(t){o.branchErrors.push({message:t.message,stack:t.stack})}),t.downloadTextAsFile("webgme-client-dump.json",JSON.stringify(o,null,2))}function o(e,n){var i={webgmeVersion:e.getConnectedStorageVersion(),projectId:e.getActiveProjectId(),branchName:e.getActiveBranchName(),branchStatus:e.getBranchStatus(),commitQueue:n};t.downloadTextAsFile("commit-queue-dump.json",JSON.stringify(i,null,2))}return{downloadStateDump:i,getStateLogString:n,downloadCommitQueue:o}}),define("plugin/PluginNodeDescription",[],function(){"use strict";var t=function(t){var e,n;if(this.name="",this.id="",t)for(e=Object.keys(t),n=0;n<e.length;n+=1)this[e[n]]=t[e[n]]};return t.prototype.serialize=function(){var t,e=Object.keys(this),n={};for(t=0;t<e.length;t+=1)n[e[t]]=this[e[t]];return n},t}),define("plugin/PluginMessage",["plugin/PluginNodeDescription"],function(t){"use strict";var e=function(e){e?(this.commitHash=e.commitHash,e.activeNode instanceof t?this.activeNode=e.activeNode:this.activeNode=new t(e.activeNode),this.message=e.message,e.severity?this.severity=e.severity:this.severity="info"):(this.commitHash="",this.activeNode=new t,this.message="",this.severity="info")};return e.prototype.serialize=function(){var t={commitHash:this.commitHash,activeNode:this.activeNode.serialize(),message:this.message,severity:this.severity};return t},e}),define("plugin/PluginResult",["plugin/PluginMessage"],function(t){"use strict";var e=function(e){var n,i;if(e)for(this.success=e.success,this.pluginName=e.pluginName,this.pluginId=e.pluginId,this.startTime=e.startTime,this.finishTime=e.finishTime,this.messages=[],this.artifacts=e.artifacts,this.error=e.error,this.commits=e.commits,this.projectId=e.projectId,i=0;i<e.messages.length;i+=1)n=e.messages[i]instanceof t?e.messages[i]:new t(e.messages[i]),this.messages.push(n);else this.success=!1,this.messages=[],this.artifacts=[],this.pluginName="PluginName N/A",this.startTime=null,this.finishTime=null,this.error=null,this.projectId=null,this.pluginId=null,this.commits=[]};return e.prototype.getSuccess=function(){return this.success},e.prototype.setSuccess=function(t){this.success=t},e.prototype.getMessages=function(){return this.messages},e.prototype.addMessage=function(t){this.messages.push(t)},e.prototype.getArtifacts=function(){return this.artifacts},e.prototype.addArtifact=function(t){this.artifacts.push(t)},e.prototype.addCommit=function(t){this.commits.push(t)},e.prototype.getPluginName=function(){return this.pluginName},e.prototype.setPluginName=function(t){this.pluginName=t},e.prototype.setPluginId=function(t){this.pluginId=t},e.prototype.setProjectId=function(t){this.projectId=t},e.prototype.getStartTime=function(){return this.startTime},e.prototype.setStartTime=function(t){this.startTime=t},e.prototype.getFinishTime=function(){return this.finishTime},e.prototype.setFinishTime=function(t){this.finishTime=t},e.prototype.getError=function(){return this.error},e.prototype.setError=function(t){t instanceof Error?this.error=t.message:this.error=t},e.prototype.serialize=function(){var t,e={success:this.success,projectId:this.projectId,messages:[],commits:this.commits,
artifacts:this.artifacts,pluginName:this.pluginName,pluginId:this.pluginId,startTime:this.startTime,finishTime:this.finishTime,error:this.error};for(t=0;t<this.messages.length;t+=1)e.messages.push(this.messages[t].serialize());return e},e}),define("plugin/util",["q"],function(t){"use strict";function e(e,n,i,o,r,s){var a={commitHash:i,rootHash:null,rootNode:null,activeNode:null,activeSelection:null,META:{}};return t.ninvoke(e,"loadObject",i).then(function(t){return a.rootHash=t.root,o.debug("commitObject loaded"),n.loadRoot(a.rootHash)}).then(function(t){return a.rootNode=t,o.debug("rootNode loaded"),n.loadByPath(a.rootNode,r.activeNode||"")}).then(function(e){return a.activeNode=e,o.debug("activeNode loaded"),r.activeSelection=r.activeSelection||[],t.all(r.activeSelection.map(function(t){return n.loadByPath(a.rootNode,t)}))}).then(function(t){function e(t,e){return 0===t.indexOf(e)}var i,s,l,c,d=n.getAllMetaNodes(a.rootNode),h=n.getLibraryNames(a.rootNode);if(a.activeSelection=t,o.debug("activeSelection loaded"),r.namespace){if(-1===h.indexOf(r.namespace))throw new Error('Given namespace does not exist among the available: "'+h+'".');for(c in d)s=n.getNamespace(d[c]),i=n.getAttribute(d[c],"name"),e(s,r.namespace)&&(s=s.substring(r.namespace.length+1),s?a.META[s+"."+i]=d[c]:a.META[i]=d[c])}else for(c in d)l=n.getFullyQualifiedName(d[c]),a.META[l]&&o.error("Meta-nodes share the same full name. Will still proceed..",l),a.META[l]=d[c];return a}).nodeify(s)}return{loadNodesAtCommitHash:e}}),define("plugin/managerbase",["common/core/coreQ","plugin/PluginResult","plugin/PluginMessage","plugin/util","common/storage/project/interface","common/storage/util","q"],function(t,e,n,i,o,r,s){"use strict";function a(a,l,c,d){function h(t,e){var n=s.defer(),i=!1,o="plugin/"+t+"/"+t+"/"+t;return g.serverSide&&!d.plugin.allowServerExecution?(n.reject(new Error("Plugin execution on server side is disabled from gmeConfig.")),i=!0):g.browserSide&&!d.plugin.allowBrowserExecution?(n.reject(new Error("Plugin execution in browser is disabled from gmeConfig.")),i=!0):g.logger.debug("Running as CLI - does not respect gmeConfig.plugin.allowServerExecution.."),i===!1&&requirejs([o],function(t){g.logger.debug("requirejs plugin from path: "+o),n.resolve(t)},function(t){n.reject(t)}),n.promise.nodeify(e)}function p(t,e){return e?t.getBranchHash(e):s(null)}var g=this;this.logger=c.fork("PluginManagerBase"),this.notificationHandlers=[],this.projectAccess={read:!0,write:!0,"delete":!0},this.blobClient=a,this.executePlugin=function(t,e,n,i){var o;g.initializePlugin(t).then(function(t){return o=t,g.configurePlugin(o,e,n)}).then(function(){g.runPluginMain(o,i)})["catch"](function(e){var n=g.getPluginErrorResult(t,t,"Exception was raised, err: "+e.stack,o&&o.projectId);g.logger.error(e.stack),i(e.message,n)})},this.initializePlugin=function(t,e){return h(t).then(function(e){var n,i=g.logger.fork("plugin:"+t);return n=new e,n.initialize(i,g.blobClient,d),n}).nodeify(e)},this.configurePlugin=function(t,e,n,i){var r,a=s.defer(),c=this,d=t.getDefaultConfig(),h={},p={},g=[];if(n.project=n.project||l,n.project instanceof o==!1)a.reject(new Error("project is not an instance of ProjectInterface, pass it via context or set it in the constructor of PluginManagerBase."));else if(t.pluginMetadata.writeAccessRequired===!0&&c.projectAccess.write===!1)a.reject(new Error("Plugin requires write access to the project for execution!"));else{t.pluginMetadata.configStructure.forEach(function(t){t.writeAccessRequired===!0&&c.projectAccess.write===!1&&(h[t.name]=!0),t.readOnly===!0&&(p[t.name]=!0)}),e=e||{};for(r in e)(p[r]||h[r])&&e.hasOwnProperty(r)&&e[r]!==d[r]&&g.push(r),d[r]=e[r];g.length>0?a.reject(new Error('User not allowed to modify configuration parameter(s): "'+g+'".')):(t.setCurrentConfig(d),c.loadContext(n).then(function(e){t.configure(e),a.resolve()})["catch"](a.reject))}return a.promise.nodeify(i)},this.runPluginMain=function(t,e){var n=(new Date).toISOString(),i=0,o=!1;return g.logger.debug("plugin configured, invoking main"),t.isConfigured===!1?void e("Plugin is not configured.",g.getPluginErrorResult(t.getId(),t.getName(),"Plugin is not configured.",l&&l.projectId)):(t.notificationHandlers=g.notificationHandlers,void t.main(function(r,s){var a;if(s&&g.logger.debug("plugin main callback called",{result:s.serialize()}),i+=1,s.setFinishTime((new Date).toISOString()),s.setStartTime(n),s.setPluginName(t.getName()),s.setPluginId(t.getId()),i>1){if(a=(new Error).stack,g.logger.error("The main callback is being called more than once!",{metadata:a}),s.setError("The main callback is being called more than once!"),o===!0)return void t.createMessage(null,a);o=!0,s.setSuccess(!1),t.createMessage(null,"The main callback is being called more than once."),t.createMessage(null,a),e("The main callback is being called more than once!",s)}else s.setError(r),t.notificationHandlers=[],e(r,s)}))},this.getPluginErrorResult=function(t,i,o,r){var s=new e,a=new n;return a.severity="error",a.message=o,s.setSuccess(!1),s.setPluginName(i),s.setPluginId(t),s.setProjectId(r||"N/A"),s.addMessage(a),s.setStartTime((new Date).toISOString()),s.setFinishTime((new Date).toISOString()),s.setError(a.message),s},this.loadContext=function(e){var n=s.defer(),o={branchName:e.branchName,commitHash:e.commitHash||e.commit,rootNode:null,activeNode:null,activeSelection:null,META:{},namespace:e.namespace||"",project:e.project,projectId:e.project.projectId,projectName:r.getProjectNameFromProjectId(e.project.projectId),core:new t(e.project,{globConf:d,logger:g.logger.fork("core")})};return g.logger.debug("loading context"),p(o.project,o.branchName).then(function(t){if(o.commitHash=e.commitHash||t,!o.commitHash)throw new Error("Neither commitHash nor branchHash from branch was obtained, branchName: ["+e.branchName+"]");return i.loadNodesAtCommitHash(o.project,o.core,o.commitHash,g.logger,e)}).then(function(t){o.rootNode=t.rootNode,o.activeNode=t.activeNode,o.activeSelection=t.activeSelection,o.META=t.META,n.resolve(o)})["catch"](function(t){n.reject(t)}),n.promise}}return a}),define("js/client/pluginmanager",["plugin/managerbase","blob/BlobClient","common/storage/project/project","js/RegistryKeys"],function(t,e,n,i){"use strict";function o(o,s,a,l,c){var d=this,h=l.fork("PluginManager");this.getCurrentPluginContext=function(t,e){var n,s,a={managerConfig:{project:o.getProjectObject(),branchName:o.getActiveBranchName(),commitHash:o.getActiveCommitHash(),activeNode:r,activeSelection:[],namespace:""},pluginConfig:null};if("undefined"!=typeof WebGMEGlobal&&(e="string"==typeof e?e:WebGMEGlobal.State.getActiveObject(),a.managerConfig.activeSelection=WebGMEGlobal.State.getActiveSelection(),a.managerConfig.activeNode=e),e&&t){n=o.getNode(e);do{if(s=n.getOwnRegistry(i.VALID_PLUGINS),s&&s.indexOf(t)>-1){a.managerConfig.namespace=n.getNamespace();break}n=n.getBaseId()?o.getNode(n.getBaseId()):null}while(n)}return a},this.runBrowserPlugin=function(n,i,r){var s=new e({logger:h.fork("BlobClient")}),a=new t(s,null,l,c);a.browserSide=!0,a.notificationHandlers=[function(t,e){d.dispatchPluginNotification(t),e(null)}],a.projectAccess=o.getProjectAccess(),a.executePlugin(n,i.pluginConfig,i.managerConfig,r)},this.runServerPlugin=function(t,e,i){e.managerConfig.project instanceof n&&(e.managerConfig.project=e.managerConfig.project.projectId),s.simpleRequest({command:"executePlugin",name:t,context:e},i)},this.filterPlugins=function(t,e){var n,i,o,s=[];if(h.debug("filterPluginsBasedOnNode allPlugins, given nodePath",t,e),e||(h.debug("filterPluginsBasedOnNode nodePath not given - will fall back on root-node."),e=r),o=a.nodes[e],o||(h.warn("filterPluginsBasedOnNode node not loaded - will fall back on root-node.",e),e=r,o=a.nodes[e]),!o)return h.warn("filterPluginsBasedOnNode root node not loaded - will return full list."),t;for(n=(a.core.getRegistry(o.node,"validPlugins")||"").split(" "),i=0;i<n.length;i+=1)t.indexOf(n[i])>-1?s.push(n[i]):""===n[i]||h.warn('Registered plugin for node at path "'+e+'" is not amongst available plugins',t);return s},this.dispatchPluginNotification=function(t){var e={severity:t.notification.severity||"info",message:"[Plugin] "+t.pluginName+" - "+t.notification.message};"number"==typeof t.notification.progress&&(e.message+=" ["+t.notification.progress+"%]"),h.debug("plugin notification",t),o.dispatchEvent(o.CONSTANTS.NOTIFICATION,e),o.dispatchEvent(o.CONSTANTS.PLUGIN_NOTIFICATION,t)}}var r="";return o}),define("js/client",["js/logger","common/storage/browserstorage","common/EventDispatcher","common/core/coreQ","js/client/constants","common/util/assert","common/core/tasync","common/util/guid","common/util/url","common/core/users/metarules","js/client/gmeNodeGetter","js/client/gmeNodeSetter","js/client/libraries","blob/BlobClient","js/client/stateloghelpers","js/client/pluginmanager","superagent"],function(t,e,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m){"use strict";function _(l){function _(t){return t?JSON.parse(JSON.stringify(t)):null}function b(t){var e,n;for(e=0;e<t.length;e+=1)for(n=t[e].split(o.CORE.PATH_SEP);n.length>1;)Q.loading.changedNodes.update[n.join(o.CORE.PATH_SEP)]=!0,n.pop()}function y(t,e){if(!t)return!0;if(t.partialUpdate[Q.core.getPath(e)]===!0)return!0;for(;e;){if(t.update[Q.core.getPath(e)]===!0)return!0;e=Q.core.getBase(e)}return!1}function v(t){var e,n,i,o,r,s=[],a=[];if(Q.loading.changedNodes){e=Q.core.getAllMetaNodes(t[tt].node);for(i in Q.loading.changedNodes.update)e.hasOwnProperty(i)&&a.push(i);if(a.length>0)for(n in e)if(e.hasOwnProperty(n))for(r=0;r<a.length;r+=1)Q.core.isTypeOf(e[n],e[a[r]])===!0&&(Q.loading.changedNodes.update[n]=!0);Q.loading.changedNodes.update[tt]=!0,b(Object.keys(Q.loading.changedNodes.load)),b(Object.keys(Q.loading.changedNodes.unload))}for(o in Q.nodes)Q.nodes.hasOwnProperty(o)&&t.hasOwnProperty(o)&&y(Q.loading.changedNodes,t[o].node)&&s.push(o);return s}function C(t,e){var n;if(e.items&&e.items.length>0){for(n=0;n<e.items.length;n+=1)if(q.isTypeOf(t,e.items[n]))return!0;return!1}return!0}function E(t,e,n){var i,o,r;if(Q.nodes[t]){if(n[t]=!0,e.children&&e.children>0)for(i=Q.core.getChildrenPaths(Q.nodes[t].node),o=_(e),o.children-=1,r=0;r<i.length;r+=1)C(i[r],e)&&E(i[r],o,n)}else Q.loadError++}function D(t,e){var n,i={},o=Q.loadError,r={},s=[];for(n in Q.users[t].PATTERNS)Q.users[t].PATTERNS.hasOwnProperty(n)&&Q.nodes[n]&&E(n,Q.users[t].PATTERNS[n],i);if(o===Q.loadError){for(n in Q.users[t].PATHS)i[n]||(s.push({etype:"unload",eid:n}),r[n]=!0);for(n in i)Q.users[t].PATHS[n]||(s.push({etype:"load",eid:n}),r[n]=!0);for(n=0;n<e.length;n++)i[e[n]]&&!r[e[n]]&&s.push({etype:"update",eid:e[n]});Q.users[t].PATHS=i,s.length>0&&Q.loadError>o?s.unshift({etype:"incomplete",eid:null}):s.unshift({etype:"complete",eid:null}),Q.users[t].FN(s)}}function I(t,e,n,i,o){var r,s=t.getPath(n),a=t.getChildrenPaths(n),l=t.getChildrenRelids(n),c=a.length,d=null,h=function(t){d=d||t,c-=1,0===c&&o(d)},p=function(n,r){n||null===r?(d=d||n,c-=1,0===c&&o(d)):I(t,e,r,i-1,h)};if(e[s]||(e[s]={node:n}),i>0)if(c>0)for(r=0;r<a.length;r++)e[a[r]]?I(t,e,e[a[r]].node,i-1,h):t.loadChild(n,l[r],p);else o(d);else o(d)}function P(t,e,n,i,o){var r=null,s=function(){if(n.children&&n.children>0){var e=n.children;I(t,i,r,e,o)}else o(null)};i[e]?(r=i[e].node,s()):(i[tt]||K.error("pattern cannot be loaded if there is no root!!!"),r=i[tt].node,t.loadByPath(r,e,function(e,n){var a;e||!n||t.isEmpty(n)?o(e):(a=t.getPath(n),i[a]||(i[a]={node:n}),r=n,s())}))}function T(){var t;for(t in Q.users)Q.users.hasOwnProperty(t)&&Q.users[t].UI.reLaunch&&Q.users[t].UI.reLaunch()}function A(t,e,n){K.debug("updateTerritory related loads finished",{metadata:{userId:t,patterns:e,error:n}}),Q.users[t]&&(Q.users[t].PATTERNS=_(e),n||D(t,[]))}function x(){return Q.inLoading&&0===Q.ongoingTerritoryUpdateCounter&&0===Q.ongoingLoadPatternsCounter?!0:!1}function w(){var t,e;K.debug("switching project state [C#"+Q.commitHash+"]->[C#"+Q.loading.commitHash+"] : [R#"+Q.rootHash+"]->[R#"+Q.loading.rootHash+"]"),t=v(Q.loadNodes),Q.nodes=Q.loadNodes,Q.loadNodes={},q.getAllMetaNodes(),Q.inLoading=!1,Q.rootHash=Q.loading.rootHash,Q.loading.rootHash=null,Q.commitHash=Q.loading.commitHash,Q.loading.commitHash=null;for(e in Q.users)Q.users.hasOwnProperty(e)&&D(e,t);Q.loadingStatus?Q.loading.next(Q.loadingStatus):Q.loading.next(null)}function N(t){Q.loadingStatus=Q.loadingStatus||t,Q.ongoingLoadPatternsCounter-=1,x()&&w()}function O(t,e,n,i){var o,r,s,a,l=[];return 0!==Q.ongoingLoadPatternsCounter?void i(new Error("at the start of loading counter should bee zero!!! ["+Q.ongoingLoadPatternsCounter+"]")):(Q.loadingStatus=null,Q.loadNodes={},Q.loading.rootHash=t,Q.loading.commitHash=e,Q.loading.next=i,Q.loading.changedNodes=n,void Q.core.loadRoot(Q.loading.rootHash,function(t,e){if(t)return void Q.loading.next(t);for(Q.inLoading=!0,Q.loadNodes[Q.core.getPath(e)]={node:e},s=Object.keys(Q.users),o=0;o<s.length;o+=1)for(Q.ongoingLoadPatternsCounter+=Object.keys(Q.users[s[o]].PATTERNS||{}).length,a=Object.keys(Q.users[s[o]].PATTERNS||{}),r=0;r<a.length;r+=1)l.push({id:a[r],pattern:_(Q.users[s[o]].PATTERNS[a[r]])});for(s=Object.keys(Q.pendingTerritoryUpdatePatterns),o=0;o<s.length;o+=1)for(Q.ongoingLoadPatternsCounter+=Object.keys(Q.pendingTerritoryUpdatePatterns[s[o]]||{}).length,a=Object.keys(Q.pendingTerritoryUpdatePatterns[s[o]]||{}),r=0;r<a.length;r+=1)l.push({id:a[r],pattern:_(Q.pendingTerritoryUpdatePatterns[s[o]][a[r]])});if(0===Q.ongoingLoadPatternsCounter)return void(x()&&(w(),T()));for(o=0;o<l.length;o+=1)J(Q.core,l[o].id,l[o].pattern,Q.loadNodes,N)}))}function S(){var t,e,n,i=Object.keys(Q.users);for(t=0;t<i.length;t++)if(Q.users[i[t]]){n=[{eid:null,etype:"complete"}];for(e in Q.users[i[t]].PATHS)n.push({etype:"unload",eid:e});Q.users[i[t]].PATTERNS={},Q.users[i[t]].PATHS={},Q.users[i[t]].SENDEVENTS=!0,Q.users[i[t]].FN(n)}}function R(t,e){var n=l.debug?2:0;"console"===t?console.log("state at "+e,u.getStateLogString(q,Q,l.debug,n)):K[t]("state at "+e,u.getStateLogString(q,Q,l.debug,n))}function M(t){t=t||function(t){Q.renewingToken=!1,t?K.error("Failed to renew token cookie",t):K.debug("Token cookie renewed")},Q.renewingToken===!1?(Q.renewingToken=!0,new m.Request("GET","api/user/token").end(t)):K.debug("Awaiting token renewal..")}function L(t,e){var n,i,o,s;if(K.debug("saveRoot msg",t),o=e?function(t,n){t?K.error("saveRoot failure",t):K.debug("saveRoot",n),e(t,n)}:function(t,e){t?K.error("saveRoot failure",t):K.debug("saveRoot",e)},Q.viewer||Q.readOnlyProject||!Q.nodes[tt])Q.msg="",o(null);else if(Q.msg?Q.msg+="\n"+t:Q.msg+=t,Q.inTransaction)K.debug("is in transaction - will NOT persist.");else{if(r(Q.project&&Q.core&&Q.branchName),K.debug("is NOT in transaction - will persist."),n=Q.core.persist(Q.nodes[tt].node),K.debug("persisted",n),i=Object.keys(n.objects).length,0===i)return K.warn("No changes after persist will return from saveRoot."),void o(null);i>200&&K.warn("Lots of persisted objects",i),s=Z.makeCommit(Q.project.projectId,Q.branchName,[Q.commitHash],n.rootHash,n.objects,Q.msg,o),Q.msg=""}}function k(t){var e;return t?(e=Q.core.getPath(t),Q.nodes[e]||(Q.nodes[e]={node:t}),e):null}function B(t){K.error("Faulty core usage raised an error",t),q.dispatchEvent(o.NOTIFICATION,{type:"CORE",severity:"error",message:t.message})}function j(t,e){Q.project=null,Z.closeProject(t,function(n){return n?void e(n):(Q.core=null,Q.branchName=null,Q.patterns={},Q.nodes={},Q.loadNodes={},Q.loadError=0,Q.rootHash=null,Q.inTransaction=!1,Q.msg="",S(),q.dispatchEvent(o.PROJECT_CLOSED,t),void e(null))})}function G(t,e){var n,i,r=t[o.STORAGE.MONGO_ID];if(e)return K.debug("foreign modification clearing undo-redo chain"),void(Q.undoRedoChain={commitHash:r,rootHash:t.root,previous:null,next:null});for(i=Q.undoRedoChain;i;){if(i.commitHash===r)return;i=i.previous}for(i=Q.undoRedoChain;i;){if(i.commitHash===r)return;i=i.next}n={commitHash:r,rootHash:t.root,previous:Q.undoRedoChain,next:null},Q.undoRedoChain.next=n,Q.undoRedoChain=n}function F(){var t=!1;return Q.undoRedoChain&&Q.undoRedoChain.previous&&Q.undoRedoChain.previous.commitHash&&(t=!0),t}function W(){var t=!1;return Q.undoRedoChain&&Q.undoRedoChain.next&&(t=!0),t}function $(){return function(t,e,n){K.debug("branchStatus changed",t,e,n),R("debug","branchStatus"),Q.branchStatus=t,q.dispatchEvent(o.BRANCH_STATUS_CHANGED,{status:t,commitQueue:e,updateQueue:n})}}function z(){return function(t,e,n,i){var r=t.commitData,s=t.local!==!0,a=r.commitObject[o.STORAGE.MONGO_ID];return K.debug("hashUpdateHandler invoked. project, branch, commitHash",r.projectId,r.branchName,a),Q.inTransaction?(K.warn("Is in transaction, will not load in changes"),void i(null,!1)):(G(r.commitObject,s),q.dispatchEvent(o.UNDO_AVAILABLE,F()),q.dispatchEvent(o.REDO_AVAILABLE,W()),q.dispatchEvent(o.NEW_COMMIT_STATE,{data:t,uiState:"function"==typeof q.uiStateGetter?q.uiStateGetter():null}),K.debug("loading commitHash, local?",a,t.local),void O(r.commitObject.root,a,r.changedNodes,function(t,e){t?(K.error("hashUpdateHandler invoked loading and it returned error",r.commitObject.root,t),R("error","hashUpdateHandler"),i(t,!1)):e===!0?(R("warn","hashUpdateHandler"),i(null,!1)):(K.debug("loading complete for incoming rootHash",r.commitObject.root),R("debug","hashUpdateHandler"),i(null,!0))}))}}var V,H,U,Y,X,J,q=this,K=t.create("gme:client",l.client.log),Z=e.getStorage(K,l,!0),Q={connection:null,renewingToken:!1,exception:null,project:null,projectAccess:null,core:null,branchName:null,branchStatus:null,readOnlyProject:!1,viewer:!1,users:{},nodes:{},loadNodes:{},rootHash:null,rootObject:null,commitHash:null,undoRedoChain:null,inTransaction:!1,msg:"",gHash:0,loadError:null,ongoingTerritoryUpdateCounter:0,ongoingLoadPatternsCounter:0,pendingTerritoryUpdatePatterns:{},loadingStatus:null,inLoading:!1,loading:{rootHash:null,commitHash:null,changedNodes:null,next:null}},tt="";V=new g({logger:K.fork("BlobClient")}),n.call(this),this.CONSTANTS=o,J=s.throttle(P,1),U=new f(q,Z,Q,K,l),this.getCurrentPluginContext=U.getCurrentPluginContext,this.runBrowserPlugin=U.runBrowserPlugin,this.runServerPlugin=U.runServerPlugin,this.filterPlugins=U.filterPlugins,this.dispatchPluginNotification=U.dispatchPluginNotification,Y=h(K,Q,L,k,B);for(H in Y)Y.hasOwnProperty(H)&&(q[H]=Y[H]);X=p(K,Q,Z,L);for(H in X)X.hasOwnProperty(H)&&(q[H]=X[H]);this.connectToDatabase=function(t){return q.isConnected()?(K.warn("connectToDatabase - already connected"),void t(null)):void Z.open(function(e){Q.connection=e,e===o.STORAGE.CONNECTED?(q.dispatchEvent(o.NETWORK_STATUS_CHANGED,e),Z.webSocket.addEventListener(o.STORAGE.NOTIFICATION,function(t,e){K.info("recieved notification",e),e.type===o.STORAGE.BRANCH_ROOM_SOCKETS?(q.dispatchConnectedUsersChanged(e),q.emitStateNotification()):e.type===o.STORAGE.PLUGIN_NOTIFICATION?q.dispatchPluginNotification(e):e.type===o.STORAGE.ADD_ON_NOTIFICATION?q.dispatchAddOnNotification(e):e.type===o.STORAGE.CLIENT_STATE_NOTIFICATION?q.dispatchConnectedUsersChanged(e):K.error("Unknown notification type",e.type,e)}),T(),t(null)):e===o.STORAGE.DISCONNECTED?Q.connection!==o.STORAGE.INCOMPATIBLE_CONNECTION&&q.dispatchEvent(o.NETWORK_STATUS_CHANGED,e):e===o.STORAGE.RECONNECTED?q.dispatchEvent(o.NETWORK_STATUS_CHANGED,e):e===o.STORAGE.INCOMPATIBLE_CONNECTION?q.disconnectFromDatabase(function(t){t&&K.error(t),q.dispatchEvent(o.NETWORK_STATUS_CHANGED,e)}):e===o.STORAGE.JWT_ABOUT_TO_EXPIRE?(K.warn("Token about is about to expire"),M()):e===o.STORAGE.JWT_EXPIRED?q.disconnectFromDatabase(function(t){t&&K.error(t),q.dispatchEvent(o.NETWORK_STATUS_CHANGED,o.STORAGE.JWT_EXPIRED)}):(K.error(new Error("Connection failed error "+e)),q.disconnectFromDatabase(function(n){n&&K.error(n),q.dispatchEvent(o.NETWORK_STATUS_CHANGED,o.STORAGE.CONNECTION_ERROR),t(new Error("Connection failed! "+e))}))})},this.disconnectFromDatabase=function(t){function e(e){Z.close(function(n){Q.connection!==o.STORAGE.INCOMPATIBLE_CONNECTION&&Q.connection!==o.STORAGE.CONNECTION_ERROR&&(Q.connection=o.STORAGE.DISCONNECTED),t(e||n)})}Q.project?j(Q.project.projectId,e):e(null)},this.selectProject=function(t,e,n){function r(r,s,c,d){if(r)return void n(new Error(r));if(Q.project=s,Q.readOnlyProject=d.write===!1,Q.core=new i(s,{globConf:l,logger:K.fork("core")}),Q.projectAccess=d,R("info","projectOpened"),K.debug("projectOpened, branches: ",c),q.dispatchEvent(o.PROJECT_OPENED,t),c.hasOwnProperty(a)===!1){if(e)return K.error('Given branch does not exist "'+e+'"'),void j(t,function(t){t&&K.error("closeProject after missing branch failed with err",t),n(new Error('Given branch does not exist "'+e+'"'))});K.warn('Project "'+t+'" did not have branch',a),a=Object.keys(c)[0]||null,K.debug('Picked "'+a+'".')}a?q.selectBranch(a,null,function(t){return t?void n(t):(R("info","selectBranch"),T(),void n(null))}):(K.warn("No branches available in project, will attempt to select latest commit."),q.getCommits(t,(new Date).getTime(),1,function(e,i){return e||0===i.length?(K.error(e),void j(t,function(t){t&&K.error("closeProject after missing any commits failed with err",t),n(new Error("Project does not have any commits."))})):void q.selectCommit(i[0]._id,function(e){return e?(K.error(e),void j(t,function(t){t&&K.error("closeProject after missing any commits failed with err",t),n(new Error("Failed selecting commit when opening project."))})):(T(),void n(null))})}))}void 0===n&&"function"==typeof e&&(n=e,e=void 0),q.isConnected()===!1&&n(new Error("There is no open database connection!"));var s,a=e||"master";if(K.debug("selectProject",t,a),Q.project){if(s=Q.project.projectId,K.debug("A project was open, closing it",s),s===t)return K.warn("projectId is already opened",t),void n(null);j(s,function(e){return e?(K.error("problems closing previous project",e),void n(e)):void Z.openProject(t,r)})}else Z.openProject(t,r)},this.selectBranch=function(t,e,n){function i(e){return e?(K.error("Problems closing existing branch",e),void n(e)):(Q.branchName=t,K.debug("openBranch, calling storage openBranch",Q.project.projectId,t),void Z.openBranch(Q.project.projectId,t,z(),$(),function(e){return e?(K.error("storage.openBranch returned with error",e),q.dispatchEvent(o.BRANCH_CHANGED,null),void n(e)):(Q.viewer=!1,Q.branchName=t,q.dispatchEvent(o.BRANCH_CHANGED,t),R("info","openBranch"),void n(null))}))}var r=Q.branchName;return K.debug("selectBranch",t),q.isConnected()===!1?void n(new Error("There is no open database connection!")):Q.project?(e&&K.warn("passing branchStatusHandler is deprecated, use addHashUpdateHandler or addBranchStatusHandler on the branch object instead (getProjectObject().branches[branchName])."),void(null!==r?(K.debug("Branch was open, closing it first",r),Z.closeBranch(Q.project.projectId,r,i)):i(null))):void n(new Error("selectBranch invoked without an opened project"))},this.selectCommit=function(t,e){function n(n){return n?(K.error("Problems closing existing branch",n),void e(n)):(Q.viewer=!0,void Q.project.loadObject(t,function(n,i){!n&&i?(R("info","selectCommit loaded commit"),q.dispatchEvent(o.BRANCH_CHANGED,null),O(i.root,t,null,function(t,n){t?(K.error("loading returned error",i.root,t),R("error","selectCommit loading"),e(t)):n===!0?(R("warn","selectCommit loading"),e(new Error("Loading selected commit was aborted"))):(K.debug("loading complete for selectCommit rootHash",i.root),R("info","selectCommit loading"),q.dispatchEvent(o.BRANCH_CHANGED,null),e(null))})):(K.error("Cannot view given "+t+" commit as it's root cannot be loaded! ["+JSON.stringify(n)+"]"),e(n||new Error("commit object cannot be found!")))}))}if(K.debug("selectCommit",t),q.isConnected()===!1)return void e(new Error("There is no open database connection!"));if(!Q.project)return void e(new Error("selectCommit invoked without open project"));var i;null!==Q.branchName?(K.debug("Branch was open, closing it first",Q.branchName),i=Q.branchName,Q.branchName=null,Z.closeBranch(Q.project.projectId,i,n)):n(null)},this.forkCurrentBranch=function(t,e,n){var i,o=this,r=o.getActiveBranchName(),s=o.getActiveProjectId();return K.debug("forkCurrentBranch",t,e),Q.project?null===r?void n("Cannot fork without an open branch!"):(i=t||r+"_"+(new Date).getTime(),void Z.forkBranch(s,r,i,e,function(e,o){return e?(K.error("Could not fork branch:",t,e),void n(e)):void n(null,i,o)})):void n("Cannot fork without an open project!")},this.isConnected=function(){return Q.connection===o.STORAGE.CONNECTED||Q.connection===o.STORAGE.RECONNECTED},this.getNetworkStatus=function(){return Q.connection},this.getConnectedStorageVersion=function(){return Z.serverVersion},this.getBranchStatus=function(){return Q.branchStatus},this.getActiveProjectId=function(){return Q.project&&Q.project.projectId},this.getActiveProjectName=function(){return Q.project&&Q.project.projectName},this.getActiveBranchName=function(){return Q.branchName},this.getActiveCommitHash=function(){return Q.commitHash},this.getActiveRootHash=function(){return Q.rootHash},this.isProjectReadOnly=function(){return Q.readOnlyProject},this.isCommitReadOnly=function(){return Q.viewer},this.isReadOnly=function(){return Q.viewer||Q.readOnlyProject},this.getProjectObject=function(){return Q.project},this.getCommitQueue=function(){return Q.project&&Q.branchName&&Q.project.branches.hasOwnProperty(Q.branchName)?Q.project.branches[Q.branchName].getCommitQueue():[]},this.downloadCommitQueue=function(){var t=q.getCommitQueue();return t.length>0?(u.downloadCommitQueue(q,t),!0):!1},this.getProjectAccess=function(){return Q.projectAccess},this.downloadError=function(){u.downloadStateDump(q,Q)},this.undo=function(t,e){return F()===!1?void e(new Error("unable to make undo")):(Q.undoRedoChain=Q.undoRedoChain.previous,R("info","undo [before setBranchHash]"),void Z.setBranchHash(Q.project.projectId,t,Q.undoRedoChain.commitHash,Q.commitHash,function(t){return t?void e(t):(R("info","undo [after setBranchHash]"),void e(null))}))},this.redo=function(t,e){return W()===!1?void e(new Error("unable to make redo")):(Q.undoRedoChain=Q.undoRedoChain.next,R("info","redo [before setBranchHash]"),void Z.setBranchHash(Q.project.projectId,t,Q.undoRedoChain.commitHash,Q.commitHash,function(t){return t?void e(t):(R("info","redo [after setBranchHash]"),void e(null))}))},this.applyCommitQueue=function(t,e,n){function i(){Z.createBranch(s,e.newBranchName,l,n)}var r=q.getActiveBranchName(),s=t[0].projectId,a=t[0].commitObject.parents,l=t[t.length-1].commitObject._id;e=e||{},e.newBranchName=e.newBranchName||q.getActiveBranchName()+"_"+Date.now(),Z.persistCommits(t,function(t){return t?void n(t):void(e.fastForward&&a.indexOf(q.getActiveCommitHash())>-1?Z.setBranchHash(s,r,l,q.getActiveCommitHash(),function(t,e){t?n(t):e.status!==o.STORAGE.SYNCED?i():n()}):i())})},this.getProjects=function(t,e){var n;q.isConnected()?(t.asObject&&(n=!0,delete t.asObject),Z.getProjects(t,function(t,i){var o,r={};if(t)return void e(t);if(n===!0){for(o=0;o<i.length;o+=1)r[i[o]._id]=i[o];e(null,r)}else e(null,i)})):e(new Error("There is no open database connection!"))},this.getProjectsAndBranches=function(t,e){q.getProjects({rights:!0,branches:!0,asObject:t},e)},this.getBranches=function(t,e){q.isConnected()?Z.getBranches(t,e):e(new Error("There is no open database connection!"))},this.getTags=function(t,e){q.isConnected()?Z.getTags(t,e):e(new Error("There is no open database connection!"))},this.getCommits=function(t,e,n,i){q.isConnected()?Z.getCommits(t,e,n,i):i(new Error("There is no open database connection!"))},this.getHistory=function(t,e,n,i){q.isConnected()?Z.getHistory(t,e,n,i):i(new Error("There is no open database connection!"))},this.getLatestCommitData=function(t,e,n){q.isConnected()?Z.getLatestCommitData(t,e,n):n(new Error("There is no open database connection!"))},this.createProject=function(t,e,n){q.isConnected()?Z.createProject(t,e,n):n(new Error("There is no open database connection!"))},this.deleteProject=function(t,e){q.isConnected()?Z.deleteProject(t,e):e(new Error("There is no open database connection!"))},this.transferProject=function(t,e,n){q.isConnected()?Z.transferProject(t,e,n):n(new Error("There is no open database connection!"))},this.duplicateProject=function(t,e,n,i){q.isConnected()?Z.duplicateProject(t,e,n,i):i(new Error("There is no open database connection!"))},this.createBranch=function(t,e,n,i){q.isConnected()?Z.createBranch(t,e,n,i):i(new Error("There is no open database connection!"))},this.deleteBranch=function(t,e,n,i){q.isConnected()?Z.deleteBranch(t,e,n,i):i(new Error("There is no open database connection!"))},this.createTag=function(t,e,n,i){q.isConnected()?Z.createTag(t,e,n,i):i(new Error("There is no open database connection!"))},this.deleteTag=function(t,e,n){q.isConnected()?Z.deleteTag(t,e,n):n(new Error("There is no open database connection!"))},this.squashCommits=function(t,e,n,i,o){Z.squashCommits(t,e,n,i,o)},this.watchDatabase=function(t,e){e=e||function(t){t&&K.error("Problems watching database room")},Z.watchDatabase(t,e)},this.unwatchDatabase=function(t,e){e=e||function(t){t&&K.error("Problems unwatching database room")},Z.unwatchDatabase(t,e)},this.watchProject=function(t,e,n){n=n||function(e){e&&K.error("Problems watching project room",t)},Z.watchProject(t,e,n)},this.unwatchProject=function(t,e,n){n=n||function(e){e&&K.error("Problems unwatching project room",t)},Z.unwatchProject(t,e,n)},this.getNode=function(t){return d(t,K,Q,k)},this.getAllMetaNodes=function(t){var e=t?{}:[];if(Q&&Q.core&&Q.nodes&&Q.nodes[tt]){var n,i,o=Q.core.getAllMetaNodes(Q.nodes[tt].node),r=Object.keys(o||{});for(i=0;i<r.length;i+=1)n=q.getNode(k(o[r[i]]),K,Q,k),t?e[r[i]]=n:e.push(n)}return e},this.checkMetaConsistency=function(){var t;return t=Q&&Q.core&&Q.nodes&&Q.nodes[tt]?c.checkMetaConsistency(Q.core,Q.nodes[tt].node):[]},this.startTransaction=function(t){Q.inTransaction&&K.error("Already in transaction, will proceed though.."),Q.core?(Q.inTransaction=!0,t=t||"[",L(t)):K.error("Can not start transaction with no core available.")},this.completeTransaction=function(t,e){Q.inTransaction=!1,Q.core&&(t=t||"]",L(t,e))},this.addUI=function(t,e,n){return r(e),r("function"==typeof e),n=n||a(),Q.users[n]={type:"notused",UI:t,PATTERNS:{},PATHS:{},SENDEVENTS:!0,FN:e},n},this.removeUI=function(t){K.debug("removeUI",t),delete Q.users[t]},this._removeAllUIs=function(){K.debug("_removeAllUIs called"),Q.users={}},this.updateTerritory=function(t,e){var n,i=0,o=a(),r=null,s=Object.keys(e||{}),l=function(n){r=r||n,0===--i&&(delete Q.pendingTerritoryUpdatePatterns[o],A(t,e,r),Q.ongoingTerritoryUpdateCounter-=1,Q.ongoingTerritoryUpdateCounter<0&&(K.error("patternLoaded callback have been called multiple times!!"),Q.ongoingTerritoryUpdateCounter=0),x()&&w())};if(K.debug("updatingTerritory",{metadata:{userId:t,patterns:e}}),!Q.nodes[tt])return void(Q.users[t]&&(K.debug("early updateTerritory for user["+t+"]. No loaded project state yet."),Q.users[t].PATTERNS=_(e)));if(0===s.length)return void A(t,e,null);for(Q.ongoingTerritoryUpdateCounter+=1,i=s.length,n=0;n<s.length;n+=1)Q.inLoading?(Q.ongoingLoadPatternsCounter+=1,J(Q.core,s[n],e[s[n]],Q.loadNodes,N)):Q.pendingTerritoryUpdatePatterns[o]=e,J(Q.core,s[n],e[s[n]],Q.nodes,l)},this.importProjectFromFile=function(t,e,n,i,o,r){var s={command:"importProjectFromFile",projectName:t,blobHash:n,branchName:e,ownerId:i,url:o};K.debug("creating project from package",s),Z.simpleRequest(s,function(t,e){t&&K.error(t),r(t,e)})},this.updateProjectFromFile=function(t,e,n,i){var o={command:"updateProjectFromFile",blobHash:n,projectId:t,branchName:e};K.debug("updating project from package",o),Z.simpleRequest(o,function(t,e){t&&K.error(t),i(t,e)})},this.checkMetaRules=function(t,e,n){var i={command:"checkConstraints",checkType:"META",includeChildren:e,nodePaths:t,commitHash:Q.commitHash,projectId:Q.project.projectId};Z.simpleRequest(i,function(t,e){t&&K.error(t),q.dispatchEvent(o.META_RULES_RESULT,e),n&&n(t,e)})},this.checkCustomConstraints=function(t,e,n){var i={command:"checkConstraints",checkType:"CUSTOM",includeChildren:e,nodePaths:t,
commitHash:Q.commitHash,projectId:Q.project.projectId};Z.simpleRequest(i,function(t,e){t&&K.error(t),q.dispatchEvent(o.CONSTRAINT_RESULT,e),n&&n(t,e)})},this.seedProject=function(t,e){K.debug("seeding project",t),t.command="seedProject",Z.simpleRequest(t,function(t,n){t&&K.error(t),e(t,n)})},this.dispatchAddOnNotification=function(t){var e={severity:t.notification.severity||"info",message:"[AddOn] "+t.addOnName+" - "+t.notification.message};K.debug("addOn notification",t),q.dispatchEvent(q.CONSTANTS.NOTIFICATION,e),q.dispatchEvent(q.CONSTANTS.ADD_ON_NOTIFICATION,t)},this.setConstraint=function(t,e,n){Q.core&&Q.nodes[t]&&"object"==typeof Q.nodes[t].node&&(Q.core.setConstraint(Q.nodes[t].node,e,n),L("setConstraint("+t+","+e+")"))},this.delConstraint=function(t,e){Q.core&&Q.nodes[t]&&"object"==typeof Q.nodes[t].node&&(Q.core.delConstraint(Q.nodes[t].node,e),L("delConstraint("+t+"name)"))},this.autoMerge=function(t,e,n,i){var o={command:"autoMerge",projectId:t,mine:e,theirs:n};Z.simpleRequest(o,function(t,e){t?(K.error("autoMerge failed with error",t),i(t)):i(null,e)})},this.resolve=function(t,e){var n={command:"resolve",partial:t};Z.simpleRequest(n,function(t,n){t?(K.error("resolve failed with error",t),e(t)):e(null,n)})},this.exportProjectToFile=function(t,e,n,i,o){var r={};r.command="exportProjectToFile",r.projectId=t,r.branchName=e,r.commitHash=n,r.withAssets=i,K.debug("exportProjectToFile, command",r),r.projectId&&(r.branchName||n)?Z.simpleRequest(r,function(t,e){t&&!e?(K.error("exportProjectToFile failed with error",t),o(t)):o(t,e)}):o(new Error("invalid parameters!"))},this.exportSelectionToFile=function(t,e,n,i,o){var r={};r.command="exportSelectionToFile",r.projectId=t,r.commitHash=e,r.withAssets=i,r.paths=n,K.debug("exportSelectionToFile, command",r),r.projectId&&e&&n&&n.length>0?Z.simpleRequest(r,function(t,e){t&&!e?(K.error("exportSelectionToFile failed with error",t),o(t)):o(t,e)}):o(new Error("invalid parameters!"))},this.importSelectionFromFile=function(t,e,n,i,o){var r={command:"importSelectionFromFile",projectId:t,blobHash:i,parentPath:n,branchName:e};K.debug("import selection from package",r),Z.simpleRequest(r,function(t,e){t&&K.error(t),o(t,e)})},this.emitStateNotification=function(){var t={type:o.STORAGE.CLIENT_STATE_NOTIFICATION,state:null,projectId:q.getActiveProjectId(),branchName:q.getActiveBranchName()};t.projectId&&t.branchName&&("function"==typeof q.uiStateGetter&&(t.state=q.uiStateGetter()),K.info("Sending state notification..."),Z.sendNotification(t,function(e){e&&K.error("Sending state notification failed",t,e),K.info("Sending state notification succeeded")}))},this.dispatchConnectedUsersChanged=function(t){q.dispatchEvent(o.CONNECTED_USERS_CHANGED,t)},this.registerUIStateGetter=function(t){q.uiStateGetter=t},this.notifyUser=function(t){t.severity=t.severity||"info",t.message?(K.debug("generic notification",t),q.dispatchEvent(q.CONSTANTS.NOTIFICATION,t)):K.debug("cannot set empty notification")},this.gmeConfig=l,this.getUserId=function(){throw new Error("Deprecated! Username is not stored in a cookie anymore. If available, use WebGMEGlobal.userInfo, if not the user info is available at GET /api/user")},window.addEventListener("error",function(t){var e;return Q.exception={},t.error?(Q.exception.message=t.error.message,Q.exception.stack=t.error.stack,e=t.error.name):Q.exception="No error on event - check browser","CoreIllegalOperationError"===e?(q.dispatchEvent(q.CONSTANTS.NOTIFICATION,{severity:"error",message:t.error.message}),!0):void q.dispatchEvent(o.NETWORK_STATUS_CHANGED,o.UNCAUGHT_EXCEPTION)})}return _.prototype=Object.create(n.prototype),_.prototype.constructor=_,_}),define("js/Panels/MetaEditor/MetaEditorConstants",["js/Constants"],function(t){"use strict";return{META_ASPECT_SET_NAME:"MetaAspectSet",RESERVED_POINTER_NAMES:[t.POINTER_BASE],META_ASPECT_CONTAINER_ID:t.PROJECT_ROOT_ID,META_ASPECT_SHEET_NAME_PREFIX:"MetaAspectSet_",META_DOC_REGISTRY_PREFIX:"meta_doc_",CREATE_META_DOC:"CREATE_META_DOC"}}),define("js/NodePropertyNames",[],function(){"use strict";var t={name:"name"};return{Attributes:t}}),define("js/Utils/GMEConcepts.FCO",["js/Constants","js/NodePropertyNames","js/RegistryKeys"],function(t,e,n){"use strict";var i={},o={};return o[e.Attributes.name]="FCO",i[n.DECORATOR]="",i[n.IS_PORT]=!1,i[n.IS_ABSTRACT]=!1,i[n.SVG_ICON]="",i[n.PORT_SVG_ICON]="",i[n.DISPLAY_FORMAT]=t.DISPLAY_FORMAT_ATTRIBUTE_MARKER+e.Attributes.name,i[n.VALID_VISUALIZERS]="ModelEditor SetEditor Crosscut GraphViz",{FCO_ATTRIBUTES:o,FCO_REGISTRY:i}}),define("js/util",["urlparse","jquery"],function(t){"use strict";var e=$("<span></span>");return Array.prototype.pushUnique=function(t){return-1===this.indexOf(t)&&this.push(t),this},{overlap:function(t,e){var n=!1;return t.x<e.x2&&t.x2>e.x&&t.y<e.y2&&t.y2>e.y&&(n=!0),n},flattenObject:function(t){var e,n={};return e=function(t,i){var o;for(o in t)t.hasOwnProperty(o)&&(_.isObject(t[o])&&!_.isArray(t[o])?e(t[o],""===i?o+".":i+o+"."):n[i+o]=t[o])},e(t,""),n},formattedDate:function(t,e){var n,i="",o=new Date;return e=e||"UTC",_.isDate(t)&&("UTC"===e?i=t.toUTCString():"elapsed"===e&&(n=(o-t)/1e3,i=45>n?"just now":90>n?"a minute ago":2700>n?Math.round(n/60)+" minutes ago":5400>n?"an hour ago":79200>n?Math.round(n/3600)+" hours ago":129600>n?"a day ago":216e4>n?Math.round(n/86400)+" days ago":3888e3>n?"a month ago":29808e3>n?Math.round(n/2592e3)+" months ago":47260800>n?"a year ago":Math.round(n/31536e3)+" years ago")),i},getURLParameterByName:function(e){var n=t(location,!0).param();return void 0!==n[e]?n[e]:""},getURLParameterByNameFromString:function(e,n){var i=t(e,!0).param();return void 0!==i[n]?i[n]:""},getObjectFromUrlQuery:function(t){var e={};return t.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(t,n,i,o){e[n]=o}),e},toSafeString:function(t){return e.text(t).html()},caseInsensitiveSort:function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:1},escapeHTML:function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML}}}),define("js/Utils/GMEConcepts",["jquery","common/util/guid","js/Constants","js/NodePropertyNames","js/RegistryKeys","./GMEConcepts.FCO","js/Panels/MetaEditor/MetaEditorConstants","js/util"],function(t,e,n,i,o,r,s,a){"use strict";function l(t){z||(z=t)}function c(t){var e,i=!1,o=z.getNode(t);return o&&(e=o.getPointerNames(),-1!==e.indexOf(n.POINTER_SOURCE)&&-1!==e.indexOf(n.POINTER_TARGET)&&o.getPointer(n.POINTER_SOURCE).to&&o.getPointer(n.POINTER_TARGET).to&&(i=!0)),i}function d(t){var e,i=!1,o=z.getNode(t);return o&&(e=o.getPointerNames(),-1!==e.indexOf(n.POINTER_SOURCE)&&-1!==e.indexOf(n.POINTER_TARGET)&&(i=!0)),i}function h(t,e,i){for(var o=[],r=p(t,i),s=z.getNode(e),a=r.length;a--&&s;)s.isValidTargetOf(r[a],n.POINTER_TARGET)&&o.push(r[a]);return o}function p(t,e){var i,o,r,s=[],a=z.getNode(t);for(i=C(e)||[],o=i.length;o--&&a;)r=i[o],a&&d(r)&&a.isValidTargetOf(r,n.POINTER_SOURCE)&&s.push(r);return s}function g(t,e,i){var o=!1,r=z.getNode(t),s=z.getNode(e);return r&&s&&i&&r.isValidTargetOf(i,n.POINTER_SOURCE)&&s.isValidTargetOf(i,n.POINTER_TARGET)&&(o=!0),o}function u(t,e){return y(t,[e])}function f(t,e){var i=z.getNode(n.PROJECT_ROOT_ID),r=i.getRegistry(o.PROJECT_REGISTRY),s=r?r[t]:null;return e===s}function m(t){return f(n.PROJECT_FCO_ID,t)}function b(t){for(var e=[],n=z.getNode(t);null!==n;)e.push(n.getId()),n=z.getNode(n.getParentId());return e}function y(t,e){var n,i,r,s,a,l,c,d,h,p,g,u,f,m=!1,_=b(t);if("string"==typeof t&&e&&e.length>0){for(m=!0,i=e.length;i--&&m===!0;)for(a=_.length;a--&&m===!0;)z.isTypeOf(e[i],_[a])&&(m=!1);if(m===!0){for(i=e.length;i--;)g=z.getNode(e[i]),g&&g.getRegistry(o.IS_ABSTRACT)===!0&&e.splice(i,1);0===e.length&&(m=!1)}for(r=z.getNode(t),m===!0&&(s=r.getChildrenIds(),c=z.getChildrenMeta(t),void 0!==c.max&&c.max>-1&&s.length+e.length>c.max&&(m=!1)),u=r.getValidChildrenIds(),a=u.length,f={};a--;)f[u[a]]=0;if(m===!0)for(a=e.length;a--;){if(d=e[a],h=z.getNode(d),!h||!h.isValidChildOf(t)){m=!1;break}for(p=u.length;p--;)z.isTypeOf(d,u[p])&&(f[u[p]]+=1)}if(m===!0)for(r=z.getNode(t),s=r.getChildrenIds(),n=z.getValidChildrenItems(t),i=n.length;i--;)if(z.isTypeOf(d,n[i].id)){for(l=0,a=0;a<s.length;a+=1)z.isTypeOf(s[a],n[i].id)&&(l+=1);if(void 0!==n[i].max&&n[i].max>-1&&l+f[n[i].id]>n[i].max){m=!1;break}}}return m}function v(t){var e=!1;return t===n.PROJECT_ROOT_ID||m(t)||(e=!0),e}function C(t){for(var e,n,i=z.getAllMetaNodes()||[],o=z.getNode(t),r=o?o.getValidChildrenIds():[],s=i.length;s--;)n=i[s],e=n.getId(),-1===r.indexOf(e)&&n.isValidChildOf(t)&&r.push(e);return r}function E(t,e,n){var i,o,r,s,a=z.getNode(t),l=z.getPointerMeta(t,e),c=a.getMemberIds(e)||[],d=!0;if(!l)return!1;if(void 0!==l.max&&l.max>-1&&c.length+n.length>l.max&&(d=!1),d===!0)for(i=0;i<n.length;i+=1)if(o=z.getNode(n[i]),!o||!o.isValidTargetOf(t,e)){d=!1;break}if(d===!0){for(s={},i=0;i<l.items.length;i+=1)void 0!==l.items[i].max&&l.items[i].max>-1&&(s[l.items[i].id]=l.items[i].max);for(r in s)if(s.hasOwnProperty(r)){for(i=0;i<c.length;i+=1)z.isTypeOf(c[i],r)&&(s[r]-=1);for(i=0;i<n.length;i+=1)z.isTypeOf(n[i],r)&&(s[r]-=1);if(s[r]<0){d=!1;break}}}return d}function D(t){var e=!1,n=z.getNode(t);return n&&(e=n.getRegistry(o.IS_ABSTRACT)),e===!0}function I(t){var e=!1,n=z.getNode(t);return n&&(e=n.getRegistry(o.IS_PORT)),e===!0}function P(t,e){var n,i,o,r,s=C(t),a=z.getNode(e),l=[];for(n=s.length;n--&&a;)if(u(t,s[n])&&(i=z.getNode(s[n])))for(o=_.difference(i.getPointerNames().slice(0),V),r=o.length;r--;)a.isValidTargetOf(s[n],o[r])&&l.push({baseId:s[n],pointer:o[r]});return l}function T(t,e,i){var o,r,s,a=!0,l=z.getNode(t);if(i&&l){if(i!==n.ASPECT_ALL)if(s=l.getAspectMeta(t,i))if(s.length>0){for(o=e.length;o--&&a;)for(r=s.length,a=!1;r--;)if(z.isTypeOf(e[o],s[r])){a=!0;break}}else a=!1;else a=!1}else a=!1;return a&&(a=y(t,e)),a}function A(t,e,i){var o,r,s,a,l=[],c=z.getNode(e);if(i&&c)if(i!==n.ASPECT_ALL){if(a=c.getAspectMeta(i),a&&a.length>0)for(l=p(t,e),o=l.length;o--;){for(r=a.length,s=!1;r--;)if(z.isTypeOf(l[o],a[r])){s=!0;break}s||l.splice(o,1)}}else l=p(t,e);return l}function x(t,e,i,o){var r,s,a,l,c=[],d=z.getNode(i);if(o&&d)if(o!==n.ASPECT_ALL){if(l=d.getAspectMeta(o),l&&l.length>0)for(c=h(t,e,i),s=c.length;s--;){for(a=l.length,r=!1;a--;)if(z.isTypeOf(c[s],l[a])){r=!0;break}r||c.splice(s,1)}}else c=h(t,e,i);return c}function w(t,e,n){var i,o=!1,r=z.getAspectTerritoryPattern(e,n),s=r.items;if(s)for(i=s.length;i--;)if(z.isTypeOf(t,s[i])){o=!0;break}return o}function N(t,e){var n,i,o,r=!0;for(n=e.length;n--;)if(o=e[n],i=z.getNode(o),!i||!i.isValidChildOf(t)){r=!1;break}return r}function O(t,e){for(var i,o,r=[],s=[n.POINTER_BASE],a=[],l=z.getNode(t),c=e?_.difference(l.getSetNames(),a):_.difference(l.getPointerNames(),s),d=c.length;d--;)if(i=z.getValidTargetItems(t,c[d]),i&&i.length>0)for(o=i.length;o--;)-1===r.indexOf(i[o].id)&&r.push(i[o].id);return r}function S(t,e){for(var i=[],o=[n.POINTER_BASE],r=z.getNode(t),s=z.getNode(e),l=_.difference(r.getPointerNames(),o),c=l.length;c--&&s;)s.isValidTargetOf(t,l[c])&&i.push(l[c]);return i.sort(a.caseInsensitiveSort),i}function R(t,e){for(var n=[],i=[],o=z.getNode(t),r=_.difference(o.getValidSetNames(),i),s=r.length;s--;)E(t,r[s],[e])&&n.push(r[s]);return n.sort(a.caseInsensitiveSort),n}function M(t){var e=z.getNode(t),n=[];return e&&(n=e.getRegistry(o.CROSSCUTS)||[]),n}function L(t){var e=z.getNode(t),n=_.union(e.getSetNames()||[],e.getValidSetNames()||[]),i=e.getValidAspectNames()||[],o=M(t),r=[];return _.each(o,function(t){r.push(t.SetID)}),n=_.difference(n,r,i)}function k(){var t,e=z.getNode(n.PROJECT_ROOT_ID);return e&&-1!==e.getRegistryNames().indexOf(o.PROJECT_REGISTRY)&&(t=e.getRegistry(o.PROJECT_REGISTRY)[n.PROJECT_FCO_ID]),t}function B(t,e){var n,i;for(i=0;i<e.length;i+=1)if(n=z.getNode(e[i]),!n||!n.isValidNewParent(t))return!1;return!0}function j(t){var e,n,i="string"==typeof t?z.getNode(t):t,o=!0;return i&&i.getBaseId()&&i.getMetaTypeId()!==i.getId()?(e=z.getNode(i.getParentId()),n=z.getNode(e.getBaseId()),n&&n.getChildrenRelids().indexOf(i.getRelid())>-1&&(o=!1)):o=!1,o}function G(t){var e="string"==typeof t?z.getNode(t):t;return j(e)&&!!e.getRegistry(o.REPLACEABLE)}function F(t){var e="string"==typeof t?z.getNode(t):t,i=e.getPointerId(n.POINTER_CONSTRAINED_BY);return"string"==typeof i?i:e.getMetaTypeId(e)}function W(t,e){for(var n="string"==typeof t?z.getNode(t):t,i=n.getId(),o="string"==typeof e?e:e.getId();n;){if(i===o)return!0;if(i=n.getBaseId(),!i)return!1;n=z.getNode(i)}}function $(t,e){var n="string"==typeof t?z.getNode(t):t,i="string"==typeof e?e:e.getId(),o=!0;return o=G(n),o&&(o=W(e,F(n))),o&&(o=n.isValidNewBase(i)),o}var z,V=[n.POINTER_BASE,n.POINTER_SOURCE,n.POINTER_TARGET];return{initialize:l,isConnection:c,isConnectionType:d,canCreateChild:u,isValidConnection:g,isProjectFCO:m,canCreateChildren:y,canDeleteNode:v,getMETAAspectMergedValidChildrenTypes:C,canAddToSet:E,isAbstract:D,isPort:I,getValidPointerTypes:P,canCreateChildrenInAspect:T,getValidConnectionTypesFromSourceInAspect:A,getValidConnectionTypesInAspect:x,isValidTypeInAspect:w,isValidChildrenTypeInCrossCut:N,getValidPointerTargetTypesFromSource:O,getValidPointerTypesFromSourceToTarget:S,getValidSetTypesFromContainerToMember:R,getCrosscuts:M,getSets:L,getFCOId:k,canMoveNodeHere:B,canBeReplaceable:j,isReplaceable:G,getConstrainedById:F,isValidReplaceableTarget:$}}),define("js/Utils/DisplayFormat",["js/Constants","js/NodePropertyNames","js/RegistryKeys"],function(t,e,n){"use strict";function i(t){var e,n,i,s,a="",l=new RegExp((o+"\\w+").replace("$","\\$"),"g"),c={};if(t){e=t.getRegistry(r);do n=l.exec(e),n&&(c[n[0]]=void 0);while(n);a=e;for(i in c)c.hasOwnProperty(i)&&(s=new RegExp(i.replace("$","\\$"),"g"),"name"===i.replace(o,"")?c[i]=t.getFullyQualifiedName():c[i]=t.getAttribute(i.replace(o,"")),void 0!==c[i]&&null!==c[i]&&(a=a.replace(s,c[i])))}return a}var o=t.DISPLAY_FORMAT_ATTRIBUTE_MARKER,r=n.DISPLAY_FORMAT;return{resolve:i}}),define("js/Utils/GMEVisualConcepts",["jquery","js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Panels/MetaEditor/MetaEditorConstants","js/Utils/DisplayFormat"],function(t,e,n,i,o,r){"use strict";var s,a={};a[e.LINE_STYLE.WIDTH]=1,a[e.LINE_STYLE.COLOR]="#000000",a[e.LINE_STYLE.PATTERN]=e.LINE_STYLE.PATTERNS.SOLID,a[e.LINE_STYLE.TYPE]=e.LINE_STYLE.TYPES.NONE,a[e.LINE_STYLE.START_ARROW]=e.LINE_STYLE.LINE_ARROWS.NONE,a[e.LINE_STYLE.END_ARROW]=e.LINE_STYLE.LINE_ARROWS.NONE,a[e.LINE_STYLE.CUSTOM_POINTS]=[];var l=function(t){s||(s=t)},c=function(t){var n,o,l=s.getNode(t),c={};if(n=function(t,e,n){var i,o;if(t&&(o=t.getRegistry(e)))switch(n){case"int":try{i=parseInt(o,10)}catch(r){i=void 0}break;case"array":try{i=_.isArray(o)?o.slice(0):JSON.parse(o),_.isArray(i)||(i=void 0)}catch(r){i=void 0}break;default:i=o}return i},l){switch(_.extend(c,a),o=n(l,i.LINE_LABEL_PLACEMENT)){case"src":c.srcText=r.resolve(l);break;case"dst":c.dstText=r.resolve(l);break;default:c.name=r.resolve(l)}o=n(l,i.LINE_WIDTH,"int"),o&&(c[e.LINE_STYLE.WIDTH]=o),o=n(l,i.COLOR),o&&""!==o&&(c[e.LINE_STYLE.COLOR]=o),o=n(l,i.LINE_STYLE),void 0!==o&&null!==o&&(c[e.LINE_STYLE.PATTERN]=o),o=n(l,i.LINE_TYPE),void 0!==o&&null!==o&&(c[e.LINE_STYLE.TYPE]=o),o=n(l,i.LINE_START_ARROW),o&&(c[e.LINE_STYLE.START_ARROW]=o),o=n(l,i.LINE_END_ARROW),o&&(c[e.LINE_STYLE.END_ARROW]=o)}return c};return{initialize:l,getConnectionVisualProperties:c}}),define("js/Utils/StateManager",["jquery","backbone","js/Constants","js/logger","common/util/assert"],function(t,e,n,i,o){"use strict";var r,s,a=Backbone.Model.extend({registerActiveObject:function(t,e){t="root"===t?"":t,s.debug("registerActiveObject, objId: ",t),e=e||{},this.set(n.STATE_ACTIVE_OBJECT,t,e)},getActiveObject:function(){return this.get(n.STATE_ACTIVE_OBJECT)},registerActiveSelection:function(t,e){o(_.isArray(t)),e=e||{},this.set(n.STATE_ACTIVE_SELECTION,t,e)},getActiveSelection:function(){return this.get(n.STATE_ACTIVE_SELECTION)},registerActiveAspect:function(t,e){e=e||{silent:!0},this.set(n.STATE_ACTIVE_ASPECT,t,e)},getActiveAspect:function(){return this.get(n.STATE_ACTIVE_ASPECT)},registerActiveVisualizer:function(t,e){e=e||{},this.set(n.STATE_ACTIVE_VISUALIZER,t,e)},getActiveVisualizer:function(){return this.get(n.STATE_ACTIVE_VISUALIZER)},registerActiveProjectName:function(t,e){e=e||{},this.set(n.STATE_ACTIVE_PROJECT_NAME,t,e)},getActiveProjectName:function(){return this.get(n.STATE_ACTIVE_PROJECT_NAME)},registerActiveBranchName:function(t,e){var i={};i[n.STATE_ACTIVE_BRANCH_NAME]=t,i[n.STATE_ACTIVE_COMMIT]=null,e=e||{},this.set(i,e)},getActiveBranch:function(){return this.get(n.STATE_ACTIVE_BRANCH_NAME)},registerActiveCommit:function(t,e){var i={};i[n.STATE_ACTIVE_BRANCH_NAME]=null,i[n.STATE_ACTIVE_COMMIT]=t,e=e||{},this.set(i,e)},getActiveCommit:function(){return this.get(n.STATE_ACTIVE_COMMIT)},registerActiveTab:function(t,e){e=e||{},this.set(n.STATE_ACTIVE_TAB,parseInt(t,10),e)},getActiveTab:function(){return this.get(n.STATE_ACTIVE_TAB)},registerSuppressVisualizerFromNode:function(t){s.error("registerSuppressVisualizerFromNode is no longer valid pass extra argument to registerActiveObject(objectId, {suppressVisualizerFromNode: true} to suppress.")},getSuppressVisualizerFromNode:function(){s.error("getSuppressVisualizerFromNode is no longer valid pass extra argument to registerActiveObject(objectId, {suppressVisualizerFromNode: true} to suppress.")},registerLayout:function(t,e){e=e||{},this.set(n.STATE_LAYOUT,t)},getLayout:function(){return this.get(n.STATE_LAYOUT)}}),l=function(){return r||(s=i.create("gme:Utils:StateManager",WebGMEGlobal.gmeConfig.client.log),r=new a,r.registerActiveAspect(n.ASPECT_ALL,{suppressHistoryUpdate:!0}),r.on("change",function(t,e){s.debug("",t,e)})),r};return{initialize:l}}),define("js/Utils/WebGMEUrlManager",["js/util","js/Constants"],function(t,e){"use strict";function n(t){var n="project="+encodeURIComponent(t.projectId);return t.branchName?n+="&branch="+t.branchName:t.commitId&&(n+="&commit="+t.commitId),t.nodeId?n+="&node="+t.nodeId:t.nodeId===e.PROJECT_ROOT_ID&&(n+="&node=root"),t.visualizer&&(n+="&visualizer="+t.visualizer),"number"==typeof t.tab&&(n+="&tab="+t.tab),t.layout&&(n+="&layout="+t.layout),t.selection&&(n+="&selection="+t.selection.join(",")),n}function i(){var t={},e="";return WebGMEGlobal.State.getActiveProjectName()&&(t.projectId=WebGMEGlobal.State.getActiveProjectName(),WebGMEGlobal.State.getActiveBranch()?t.branchName=WebGMEGlobal.State.getActiveBranch():WebGMEGlobal.State.getActiveCommit()&&(t.commitId=WebGMEGlobal.State.getActiveCommit()),"string"==typeof WebGMEGlobal.State.getActiveObject()&&(t.nodeId=WebGMEGlobal.State.getActiveObject()),WebGMEGlobal.State.getActiveVisualizer()&&(t.visualizer=WebGMEGlobal.State.getActiveVisualizer()),"number"==typeof WebGMEGlobal.State.getActiveTab()&&(t.tab=WebGMEGlobal.State.getActiveTab()),null!==WebGMEGlobal.State.getLayout()&&void 0!==WebGMEGlobal.State.getLayout()&&(t.layout=WebGMEGlobal.State.getLayout()),WebGMEGlobal.State.getActiveSelection()&&(t.selection=WebGMEGlobal.State.getActiveSelection()),e=n(t)),e}function o(){return{layoutToLoad:t.getURLParameterByName("layout")||WebGMEGlobal.gmeConfig.visualization.layout["default"],commitToLoad:t.getURLParameterByName("commit").toLowerCase(),projectToLoad:t.getURLParameterByName("project"),objectToLoad:t.getURLParameterByName("node")||e.PROJECT_ROOT_ID,createNewProject:"true"===t.getURLParameterByName("create"),branchToLoad:t.getURLParameterByName("branch"),tabToSelect:t.getURLParameterByName("tab")||0,visualizerToLoad:t.getURLParameterByName("visualizer")||"ModelEditor",activeSelectionToLoad:t.getURLParameterByName("selection")?t.getURLParameterByName("selection").split(","):[]}}return{parseInitialThingsToDoFromUrl:o,serializeStateToUrl:i,getSearchQuery:n}}),define("css",[],function(){if("undefined"==typeof window)return{load:function(t,e,n){n()}};var t=document.getElementsByTagName("head")[0],e=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,n=!1,i=!0;e[1]||e[7]?n=parseInt(e[1])<6||parseInt(e[7])<=9:e[2]||e[8]?i=!1:e[4]&&(n=parseInt(e[4])<18);var o={};o.pluginBuilder="./css-builder";var r,s,a,l=function(){r=document.createElement("style"),t.appendChild(r),s=r.styleSheet||r.sheet},c=0,d=[],h=function(t){s.addImport(t),r.onload=function(){p()},c++,31==c&&(l(),c=0)},p=function(){a();var t=d.shift();return t?(a=t[1],void h(t[0])):void(a=null)},g=function(t,e){if(s&&s.addImport||l(),s&&s.addImport)a?d.push([t,e]):(h(t),a=e);else{r.textContent='@import "'+t+'";';var n=setInterval(function(){try{r.sheet.cssRules,clearInterval(n),e()}catch(t){}},10)}},u=function(e,n){var o=document.createElement("link");if(o.type="text/css",o.rel="stylesheet",i)o.onload=function(){o.onload=function(){},setTimeout(n,7)};else var r=setInterval(function(){for(var t=0;t<document.styleSheets.length;t++){var e=document.styleSheets[t];if(e.href==o.href)return clearInterval(r),n()}},10);o.href=e,t.appendChild(o)};return o.normalize=function(t,e){return".css"==t.substr(t.length-4,4)&&(t=t.substr(0,t.length-4)),e(t)},o.load=function(t,e,i,o){(n?g:u)(e.toUrl(t+".css"),i)},o}),define("css!js/Loader/styles/LoaderCircles",[],function(){}),define("js/Loader/LoaderCircles",["css!js/Loader/styles/LoaderCircles.css"],function(){"use strict";var t,e=36,n=5,i=14,o=30,r=200,s=20;return t=function(t){if(this._el=t.containerElement,0===this._el.length)throw new Error("LoaderCircles's container control with id:\""+t.containerElement+'" could not be found');this._loaderBackgroundCssProps={},this._loaderContentCssProps={}},t.prototype._initialize=function(){this._createElements()},t.prototype._removeElements=function(){this._loaderContainer&&this._loaderContainer.remove(),this._loaderContainer=null,this._loaderBackground&&this._loaderBackground.remove(),this._loaderBackground=null},t.prototype._createElements=function(){this._loaderContainer||(this._loaderContainer=$("<div/>",{"class":"loader-container"}).css(this._loaderContentCssProps),this._loaderBackground=$("<div/>",{"class":"loader-bg"}).css(this._loaderBackgroundCssProps),this._circleOuter=$("<div/>",{"class":"circle-o"}),this._circleInner=$("<div/>",{"class":"circle-i"}),this._size&&(this._circleOuter.css({width:this._size,height:this._size,"border-radius":this._size}),this._circleInner.css({width:this._size-s,height:this._size-s,"border-radius":this._size-s,top:0-e/3-this._size/2-(this._size-s)/2-2*n}),this._loaderContainer.css({width:this._size+e,height:this._size+e,"margin-top":(this._size+e)/-2,"margin-left":(this._size+e)/-2})),this._loaderContainer.append(this._circleOuter).append(this._circleInner),this._size&&this._size<o&&this._circleInner.remove(),this._el.append(this._loaderBackground).append(this._loaderContainer),this._el.width())},t.prototype.destroy=function(){this._removeElements()},t.prototype.stop=function(){this._removeElements()},t.prototype.start=function(){this._createElements()},t.prototype.foreGroundColor=function(t){this._loaderContentCssProps["background-color"]=t},t.prototype.setSize=function(t){var e=parseInt(t,10);i>e?this._size=i:e>r?this._size=r:this._size=e},t}),define("js/LayoutManager/LayoutManager",["js/logger","js/Loader/LoaderCircles"],function(t,e){"use strict";var n;return n=function(){this._currentLayout=void 0,this._currentLayoutName=void 0,this._logger=t.create("gme:LayoutManager:LayoutManager",WebGMEGlobal.gmeConfig.client.log),this._logger.debug("LayoutManager created."),this._startProgressBar(),this._panels={}},n.prototype.loadLayout=function(t,e){var n=this,i=["layout",t,t,t].join("/");this._logger.debug("LayoutManager loadLayout..."),this._currentLayout&&(this._logger.debug("Destroying layout: "+this._currentLayoutName),this._currentLayout.destroy(),this._currentLayout=void 0,this._currentLayoutName=void 0,$("body").empty()),this._startProgressBar(),this._logger.debug('Downloading layout "'+t+'"...'),require([i],function(i){i?(n._logger.debug('Layout "'+t+'" has been downloaded...'),n._currentLayoutName=t,n._currentLayout=new i,n._currentLayout.init(),e&&e.call(n)):n._logger.error('Layout "'+t+'" has been downloaded...BUT UNDEFINED!!!')},function(t){n._logger.error('Failed to load layout because of "'+t.requireType+'" with module "'+t.requireModules[0]+'"...')})},n.prototype.loadPanel=function(t,e){var n,i,o=this,r=t.panel,s=t.container,a=["panel",r].join("/");this._logger.debug('LayoutManager loadPanel with name: "'+name+'", container: "'+s+'"'),i=function(){e&&e.call(o)},this._panels[r]?this._logger.error("A Panel with the same name already exist!!!"):require([a],function(e){e?(o._logger.debug('Panel "'+r+'" has been downloaded...'),o._panels[r]=new e(o,t.params),n=o._currentLayout.addToContainer(o._panels[r],s),o._panels[r].afterAppend(),o._panels[r].setContainerUpdateFn(o._currentLayout,n)):o._logger.error('Panel "'+r+'" has been downloaded...BUT UNDEFINED!!!'),i(o._panels[r])},function(t){o._logger.error('Failed to load Panel "'+a+'" because of "'+t.requireType+'" with module "'+t.requireModules[0]+'"...'),i()})},n.prototype.addPanel=function(t,e,n){this._panels[t]=e,this._currentLayout.addToContainer(e,n),e.afterAppend()},n.prototype.removePanel=function(t){this._panels[t]&&(this._currentLayout.remove(this._panels[t]),delete this._panels[t])},n.prototype._startProgressBar=function(){var t;t=new e({containerElement:$("body")}),t.start()},n.prototype.setPanelReadOnly=function(t){var e;for(e in this._panels)this._panels.hasOwnProperty(e)&&this._panels[e].setReadOnly(t)},n}),define("js/Decorators/DecoratorManager",["js/logger"],function(t){"use strict";var e,n="decorators/",i="___N/A___";return e=function(){this._logger=t.create("gme:Decorators:DecoratorManager",WebGMEGlobal.gmeConfig.client.log),this._decorators={},this._widgetDecoratorCache={},this._logger.debug("Created")},e.prototype.downloadAll=function(t,e){function n(){s-=1,0===s&&(Object.keys(o._decorators).length===r?e():e("Failed to download all requested decorators "+t.toString()+" only got "+Object.keys(o._decorators).toString()))}var i,o=this,r=t.length,s=r;for(i=0;r>i;i+=1)o._downloadOne(t[i],n)},e.prototype.download=function(t,e,n){var i,o=t.slice(0),r=this;i=function(){var t,s,a,l=o.length;l>0?(r._logger.debug('Remaining decorators for widget "'+e+'": '+l+', "'+o+'"'),s=o.splice(0,1)[0],r._downloadOne(s,function(){if(r._decorators[s]&&(t=r._decorators[s].getDecoratorForWidget(e),t&&_.isArray(t)))for(a=t.len;a--;)-1===o.indexOf(t[a])&&o.push(t[a]);i(o)})):(r._logger.debug('No more decorators to download for widget "'+e+'"'),n.call(r))},this._logger.debug('Downloading decorators "'+t+'" for widget "'+e+'"'),i()},e.prototype.getDecoratorForWidget=function(t,e){var n;return this._widgetDecoratorCache[e]&&this._widgetDecoratorCache[e][t]?n=this._widgetDecoratorCache[e][t]:(this._lookupDecoratorForWidget(t,e),n=this._widgetDecoratorCache[e][t]),n===i&&(n=void 0),n},e.prototype._lookupDecoratorForWidget=function(t,e){var n,o,r,s=this;return this._logger.debug('_lookupDecoratorForWidget decorator: "'+t+'" for widget "'+e+'"'),this._widgetDecoratorCache[e]=this._widgetDecoratorCache[e]||{},r=function(t){var n,i,o=t.length;for(s._logger.debug("processDecoratorChain: "+t);o--;)if(i=t[o],s._decorators[i])if(n=s._decorators[i].getDecoratorForWidget(e),_.isArray(n))s._logger.debug("recursive processDecoratorChain at: "+i+" for: "+n),n=r(n);else if(n){s._logger.debug("processDecoratorChain return at: "+i);break}return n},this._decorators[t]&&(o=this._decorators[t].getDecoratorForWidget(e),_.isArray(o)?(this._logger.debug('fallback decorator list for decorator "'+t+'" for widget "'+e+'" is: '+o),n=r(o)):(this._logger.debug('found decorator: "'+t+'" for widget "'+e+'"'),n=o)),n?this._widgetDecoratorCache[e][t]=n:(this._logger.debug('There is no decorator with name "'+t+'" that supports widget "'+e+'"'),this._widgetDecoratorCache[e][t]=i),n},e.prototype._getDecoratorFullPath=function(t){return n+t+"/"+t},e.prototype._downloadOne=function(t,e){var n=this,i=this._getDecoratorFullPath(t);this._logger.debug('Initiating decorator download for "'+t+'"'),this._decorators[t]?(this._logger.debug('Decorator "'+t+'" has already been downloaded...'),e()):require([i],function(i){n._logger.debug('Decorator "'+t+'" has been successfully downloaded');try{n._decorators[t]=new i}catch(o){delete n._decorators[t],n._logger.error('Error while trying to instantiate decorator "'+t+'"...')}e.call(n)},function(i){n._logger.error('Failed to download decorator "'+t+'" because of "'+i.requireType+'" with module "'+i.requireModules[0]+'"...'),e.call(n)})},e}),define("js/KeyboardManager/KeyboardManager",["js/logger"],function(t){"use strict";function e(){h=h||t.create("gme:KeyboardManager:KeyboardManager",WebGMEGlobal.gmeConfig.client.log),WebGMEGlobal.SUPPORTS_TOUCH!==!0&&(d||i(),d.val(f).select().focus())}function n(n){h=h||t.create("gme:KeyboardManager:KeyboardManager",WebGMEGlobal.gmeConfig.client.log),y!==n&&(y=n,y&&(_.isFunction(y.onKeyDown)||h.warn('Listener is missing "onKeyDown"...'),_.isFunction(y.onKeyUp)||h.warn('Listener is missing "onKeyUp"...'))),e()}function i(){d||(d=$("<textarea/>",{"class":u}),d.css({position:"absolute",top:"-10000px",left:"-10000px"}),$("body").append(d))}function o(e){h=h||t.create("gme:KeyboardManager:KeyboardManager",WebGMEGlobal.gmeConfig.client.log),WebGMEGlobal.SUPPORTS_TOUCH!==!0&&b!==e&&(b=e,b===!0?(i(),d.on("keydown.KeyboardManager keyup.KeyboardManager",s),$("body").on("mousedown.KeyboardManager",r),d.on("copy.KeyboardManager",a),d.on("paste.KeyboardManager",l)):(d.off("keydown.KeyboardManager"),d.off("keyup.KeyboardManager"),$("body").off("mousedown.KeyboardManager"),d.off("copy.KeyboardManager"),d.off("paste.KeyboardManager")))}function r(t){var n=t&&t.target&&t.target.tagName,i=document.activeElement&&document.activeElement.nodeName,o=["INPUT","TEXTAREA","SELECT"];-1===o.indexOf(n)&&-1===o.indexOf(i)&&e()}function s(t){var n,i={type:t.type,character:void 0,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,combo:"",oEvent:void 0};(!/textarea|select/i.test(t.target.nodeName)&&"text"!==t.target.type||t.target===d[0])&&y&&(i.character=p[t.which]||String.fromCharCode(t.which).toLowerCase(),t.altKey&&(i.combo+="alt+"),t.ctrlKey&&(i.combo+="ctrl+"),t.metaKey&&(i.combo+="meta+"),t.shiftKey&&(i.combo+="shift+"),i.combo+=i.character,h.debug(JSON.stringify(i)),-1===g.indexOf(i.combo)&&("keydown"===t.type?n=y.onKeyDown&&y.onKeyDown(i):"keyup"===t.type&&(n=y.onKeyUp&&y.onKeyUp(i))),void 0!==n&&(t.result=n)===!1&&(t.preventDefault(),t.stopPropagation()),e())}function a(t){var e,n=c(t);n?(y&&_.isFunction(y.onCopy)&&(e=y.onCopy(),"string"!=typeof e&&(e=JSON.stringify(e)),n.setData("text",e)),t.preventDefault(),t.stopPropagation()):alert(m)}function l(t){var e,n=c(t);n?(y&&_.isFunction(y.onPaste)&&(e=n.getData("text"),y.onPaste(e)),t.preventDefault(),t.stopPropagation()):alert(m)}function c(t){return t.originalEvent.clipboardData||window.clipboardData}var d,h,p={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},g=["ctrl+c","ctrl+x","ctrl+v"],u="webgme-clipboard-helper",f="webgme-clipboard",m="Your browser seems to be out of date :(.Please update your browser to the latest and greatest version!",b=!1,y=null;return{captureFocus:e,setListener:n,setEnabled:o}}),define("js/PanelManager/PanelManager",["js/logger","js/Constants"],function(t,e){"use strict";var n;return n=function(){this._logger=t.create("gme:PanelManager:PanelManager",WebGMEGlobal.gmeConfig.client.log),this._activePanel=void 0;
},n.prototype.setActivePanel=function(t){this._activePanel===t?this._activePanel.setActive(!0):(this._activePanel&&this._activePanel.setActive(!1),this._activePanel=void 0,t&&_.isFunction(t.setActive)&&(this._activePanel=t,this._activePanel.setActive(!0)),WebGMEGlobal.State.registerActiveVisualizer(this._activePanel[e.VISUALIZER_PANEL_IDENTIFIER])),WebGMEGlobal.KeyboardManager.captureFocus()},n.prototype.getActivePanel=function(){return this._activePanel},n}),define("js/WebGME.History",["jquery","js/logger"],function(t,e){"use strict";function n(){}function i(t){t=t||window.history.state,s=!0,WebGMEGlobal.State.clear({silent:!0}),r.debug("loading state:"+JSON.stringify(t)),WebGMEGlobal.State.set(t,{suppressVisualizerFromNode:!0,suppressHistoryUpdate:!0}),s=!1}function o(){a||(r=e.create("gme:WebGME.History",WebGMEGlobal.gmeConfig.client.log),a=!0,WebGMEGlobal.State.on("change",function(){n(WebGMEGlobal.State.toJSON())}))}var r,s=!1,a=!1;return WebGMEGlobal.history!==!0&&(Object.defineProperty(WebGMEGlobal,"history",{value:!0,writable:!1,enumerable:!0,configurable:!1}),$(window).on("popstate",function(t){i(t.originalEvent.state)})),{initialize:o}}),define("js/Utils/PreferencesHelper",["underscore","common/util/assert"],function(t,e){"use strict";var n,i;n=function(t){this._registryList=t?JSON.parse(JSON.stringify(t)):[]},n.prototype.getRegistry=function(t,e,n){var o,r,s,a,l,c,d=this._registryList.length;for(o=0;d>o&&(s=this._registryList[o],a=i.getNode(s.containerID),!a||(l=a.getSetNames(),!s.setID||-1===l.indexOf(s.setID)||(c=a.getMemberIds(s.setID),-1===c.indexOf(t)||(r=a.getMemberRegistry(s.setID,t,e),void 0===r||null===r))));o+=1);return void 0!==r&&null!==r||n!==!0||(a=i.getNode(t),a&&(r=a.getRegistry(e))),r},n.prototype.setRegistry=function(t,e,n){var o;0===this._registryList.length?i.setRegistry(t,e,n):(o=this._registryList[0],i.setMemberRegistry(o.containerID,t,o.setID,e,n))},n.prototype.delRegistry=function(t,e){var n;0===this._registryList.length?i.delRegistry(t,e):(n=this._registryList[0],i.delMemberRegistry(n.containerID,t,n.setID,e))};var o=function(t){i||(i=t)},r=function(t){return t&&(e(t),e(_.isArray(t)),e(t.length>0)),new n(t)};return{initialize:o,getPreferences:r}}),define("js/Controls/PropertyGrid/Widgets/WidgetBase",["jquery"],function(){"use strict";var t,e=$("<div/>",{"class":"widget"});return t=function(t){this.el=e.clone(),this.propertyValue=t.value,this.originalValue=t.value,this.propertyName=t.name,this.propertyID=t.id,this.propertyText=t.text,this.valueItems=t.valueItems,this.valueType=t.valueType||typeof t.value,this._isReadOnly=!1,this._alwaysReadOnly=t.alwaysReadOnly,this.__onChange=void 0,this.__onFinishChange=void 0},t.prototype.onChange=function(t){return this.__onChange=t,this},t.prototype.onFinishChange=function(t){return this.__onFinishChange=t,this},t.prototype.setValue=function(t){var e=this.propertyValue;return this._isReadOnly!==!0&&t!==e&&(this.propertyValue=t,this.__onChange&&this.__onChange.call(this,{id:this.propertyID,oldValue:e,newValue:t}),this.updateDisplay()),this},t.prototype.fireFinishChange=function(){this.originalValue!==this.propertyValue&&(this.__onFinishChange&&this.__onFinishChange.call(this,{id:this.propertyID,oldValue:this.originalValue,newValue:this.propertyValue}),this.originalValue=this.propertyValue)},t.prototype.getValue=function(){return this.propertyValue},t.prototype.updateDisplay=function(){return this},t.prototype.remove=function(){this.destroy(),this.__onChange=void 0,this.__onFinishChange=void 0,this.el.remove()},t.prototype.setReadOnly=function(t){this._alwaysReadOnly?this._isReadOnly=!0:this._isReadOnly=t},t.prototype.destroy=function(){},t}),define("css!js/Controls/PropertyGrid/Widgets/styles/AssetWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/AssetWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","blob/BlobClient","js/logger","css!./styles/AssetWidget.css"],function(t,e,n){"use strict";var i,o=$('<a class="btn btn-mini btn-dialog-open"><i class="glyphicon glyphicon-file"/></a>'),r=$('<input type="file" />'),s=$('<div class="asset-widget" />'),a=$('<div class="upload-progress-bar" />'),l=$('<a class="blob-download-link" href="" target="_self"/>');return i=function(e){t.call(this,e),this._logger=n.create("gme:js:Controls:PropertyGrid:Widgets:AssetWidget",WebGMEGlobal.gmeConfig.client.log),this.__el=s.clone(),this.el.append(this.__el),this.__progressBar=a.clone(),this.__el.append(this.__progressBar),this.__progressBar.hide(),this.__assetLink=l.clone(),this.__el.append(this.__assetLink),this.__fileDropTarget=this.__el,this.__btnAttach=o.clone(),this.__el.append(this.__btnAttach),this.__fileUploadInput=r.clone(),this.__files=[],this.__timeoutId=null,this._attachFileDropHandlers(),this.updateDisplay()},i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._attachFileDropHandlers=function(){var t=this;this.__btnAttach.on("click",function(e){e.stopPropagation(),e.preventDefault(),t.__fileUploadInput.click()}),this.__fileUploadInput.on("change",function(e){e.stopPropagation(),e.preventDefault(),t._fileSelectHandler(e.originalEvent)}),this.__fileDropTarget.on("dragover",function(t){t.stopPropagation(),t.preventDefault()}),this.__fileDropTarget.on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),t.__fileDropTarget.addClass("hover")}),this.__fileDropTarget.on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),t.__fileDropTarget.removeClass("hover")}),this.__fileDropTarget.on("drop",function(e){e.stopPropagation(),e.preventDefault(),t.__fileDropTarget.removeClass("hover"),t._fileSelectHandler(e.originalEvent)})},i.prototype._detachFileDropHandlers=function(){this.__fileUploadInput.off("change"),this.__fileDropTarget.off("dragover"),this.__fileDropTarget.off("dragenter"),this.__fileDropTarget.off("dragleave"),this.__fileDropTarget.off("drop"),this.__btnAttach.off("click")},i.prototype.updateDisplay=function(){var n=new e({logger:this._logger.fork("BlobClient")}),i=this.propertyValue?n.getDownloadURL(this.propertyValue):"",o=this.propertyValue,r=this;return this.__assetLink.text(o),this.__assetLink.attr("title",o),this.__assetLink.attr("href",i),this.propertyValue&&n.getMetadata(this.propertyValue,function(t,e){o=t?"ERROR...":e.name+" ("+n.getHumanSize(e.size)+")",r.__assetLink.text(o),r.__assetLink.attr("title",o)}),t.prototype.updateDisplay.call(this)},i.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this.__btnAttach&&(this._isReadOnly===!0?this.__btnAttach.disable(!0):this.__btnAttach.disable(!1)),this._detachFileDropHandlers(),this._isReadOnly!==!0&&this._attachFileDropHandlers()},i.prototype._fileSelectHandler=function(t){function n(t,e){var n=p.__progressBar.text();p.__timeoutId||(""===n||n===t?"number"==typeof e.percent&&100!==e.percent?(p.__progressBar.width(e.percent+"%"),p.__progressBar.text(t)):p.__progressBar.text(""):100===e.percent&&(p.__progressBar.width(e.percent+"%"),p.__progressBar.text(t),p.__timeoutId=setTimeout(function(){p.__progressBar&&(p.__progressBar.text(""),p.__progressBar.width(0)),p.__timeoutId=null},500)))}function i(t,e){p.__assetLink.show(),p.__progressBar.width(0),p.__progressBar.text(""),p.__progressBar.hide(),p.__timeoutId=null,t?p._logger.error(t):(p.setValue(e),p.fireFinishChange(),p._attachFileDropHandlers(!1))}var o,r,s,a,l,c,d,h,p=this;if(o=new e({logger:this._logger.fork("BlobClient"),uploadProgressHandler:n}),t.stopPropagation(),t.preventDefault(),a=t.target.files||t.dataTransfer.files,a&&a.length>0)for(this.__files=a,this._detachFileDropHandlers(!0),this.__assetLink.hide(),this.__progressBar.show(),l=p.propertyName,c=o.createArtifact(l),d=a.length,h=function(t,e){d-=1,0===d&&(a.length>1?c.save(function(t,e){i(t,e)}):i(t,e))},r=0;r<a.length;r+=1)s=a[r],c.addFileAsSoftLink(s.name,s,h)},i.prototype.getTargetAsJson=function(t){var e,n,i=this,o=null;this.__files&&this.__files.length>0?(e=this.__files[0],n=new FileReader,n.onload=function(e){if(e.target&&e.target.result)try{o=JSON.parse(e.target.result)}catch(n){i._logger.error("failed to read asset on the client side",n),o=null}t(o)},n.readAsText(e)):t(null)},i.prototype.destroy=function(){this._detachFileDropHandlers(),clearTimeout(this.__timeoutId),t.prototype.destroy.call(this)},i}),define("text",["module"],function(t){"use strict";var e,n,i,o,r,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),h=c&&location.hostname,p=c&&(location.port||void 0),g={},u=t.config&&t.config()||{};return e={version:"2.0.12",strip:function(t){if(t){t=t.replace(a,"");var e=t.match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:u.createXhr||function(){var t,e,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;3>e;e+=1){n=s[e];try{t=new ActiveXObject(n)}catch(i){}if(t){s=[n];break}}return t},parseName:function(t){var e,n,i,o=!1,r=t.indexOf("."),s=0===t.indexOf("./")||0===t.indexOf("../");return-1!==r&&(!s||r>1)?(e=t.substring(0,r),n=t.substring(r+1,t.length)):e=t,i=n||e,r=i.indexOf("!"),-1!==r&&(o="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:e=i),{moduleName:e,ext:n,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,n,i,o){var r,s,a,l=e.xdRegExp.exec(t);return l?(r=l[2],s=l[3],s=s.split(":"),a=s[1],s=s[0],!(r&&r!==n||s&&s.toLowerCase()!==i.toLowerCase()||(a||s)&&a!==o)):!0},finishLoad:function(t,n,i,o){i=n?e.strip(i):i,u.isBuild&&(g[t]=i),o(i)},load:function(t,n,i,o){if(o&&o.isBuild&&!o.inlineText)return void i();u.isBuild=o&&o.isBuild;var r=e.parseName(t),s=r.moduleName+(r.ext?"."+r.ext:""),a=n.toUrl(s),l=u.useXhr||e.useXhr;return 0===a.indexOf("empty:")?void i():void(!c||l(a,d,h,p)?e.get(a,function(n){e.finishLoad(t,r.strip,n,i)},function(t){i.error&&i.error(t)}):n([s],function(t){e.finishLoad(r.moduleName+"."+r.ext,r.strip,t,i)}))},write:function(t,n,i,o){if(g.hasOwnProperty(n)){var r=e.jsEscape(g[n]);i.asModule(t+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(t,n,i,o,r){var s=e.parseName(n),a=s.ext?"."+s.ext:"",l=s.moduleName+a,c=i.toUrl(s.moduleName+a)+".js";e.load(l,i,function(n){var i=function(t){return o(c,t)};i.asModule=function(t,e){return o.asModule(t,c,e)},e.write(t,l,i,r)},r)}},"node"===u.env||!u.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),e.get=function(t,e,i){try{var o=n.readFileSync(t,"utf8");0===o.indexOf("\ufeff")&&(o=o.substring(1)),e(o)}catch(r){i&&i(r)}}):"xhr"===u.env||!u.env&&e.createXhr()?e.get=function(t,n,i,o){var r,s=e.createXhr();if(s.open("GET",t,!0),o)for(r in o)o.hasOwnProperty(r)&&s.setRequestHeader(r.toLowerCase(),o[r]);u.onXhr&&u.onXhr(s,t),s.onreadystatechange=function(e){var o,r;4===s.readyState&&(o=s.status||0,o>399&&600>o?(r=new Error(t+" HTTP status: "+o),r.xhr=s,i&&i(r)):n(s.responseText),u.onXhrComplete&&u.onXhrComplete(s,t))},s.send(null)}:"rhino"===u.env||!u.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var n,i,o="utf-8",r=new java.io.File(t),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),o)),l="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=a.readLine());)n.append(s),n.append(i);l=String(n.toString())}finally{a.close()}e(l)}:("xpconnect"===u.env||!u.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,o=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in i,e.get=function(t,e){var n,s,a,l={};r&&(t=t.replace(/\//g,"\\")),a=new FileUtils.File(t);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),n.init(a,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),s.init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),l),s.close(),n.close(),e(l.value)}catch(c){throw new Error((a&&a.path||"")+": "+c)}}),e}),define("text!js/Dialogs/CreateProject/templates/CreateProjectDialog.html",[],function(){return'<div class="create-new-project-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <i class="header-icon gme-icon"></i><span>Create new project</span>\n            </div>\n            <div class="pre-body">\n                <div class="tabContainer">\n                    <ul class="nav nav-tabs">\n                        <li class="tab snap-shot"><a href="#" data-toggle="tab">Seed</a></li>\n                        <li class="tab duplicate"><a href="#" data-toggle="tab">Duplicate</a></li>\n                        <li class="tab blob"><a href="#" data-toggle="tab">Import</a></li>\n                    </ul>\n                </div>\n            </div>\n            <div class="modal-body">\n                <form class="form-horizontal snap-shot activated" role="form">\n                    <h5>Choose an existing seed\n                        <i class="glyphicon glyphicon-info-sign toggle-info-btn snap-shot-info"/>\n                    </h5>\n                    <span class="type-description snap-shot-info hidden">Creates a new project from an existing snapshot.\n                        It can either be a template file-seed available on the server or a branch from one of the existing projects.\n                        The new project will have a single commit and a branch (master) pointing to the commit.\n                     </span>\n                    <span class="selection">\n                        <select class="form-control selector snap-shot pull-left">\n                            <optgroup class="file" label="Template File"/>\n                            <optgroup class="db" label="Existing Projects with a single branch"/>\n                        </select>\n                    </span>\n                </form>\n                <form class="form-horizontal duplicate" role="form">\n                    <h5>Duplicate project\n                        <i class="glyphicon glyphicon-info-sign toggle-info-btn duplicate-info"/>\n                    </h5>\n                    <span class="type-description duplicate-info hidden">This will make a full copy of an existing project\n                        with its entire history. This includes all commits, branches and data-objects.\n                     </span>\n                    <span class="selection">\n                        <select class="form-control selector duplicate-project pull-left">\n                            <optgroup class="project-id" label="Available Projects"/>\n                        </select>\n                    </span>\n                </form>\n                <form class="form-horizontal blob">\n                    <h5>Import from file\n                        <i class="glyphicon glyphicon-info-sign toggle-info-btn blob-info"/>\n                    </h5>\n                    <span class="type-description blob-info hidden"> Creates a new project from the uploaded snapshot.\n                       The new project will have a single commit and a branch (master) pointing to the commit.\n                     </span>\n                    <span class="selection selection-blob">\n\n                    </span>\n                </form>\n                <!--<div class="alert alert-error"-->\n                     <!--style="margin-top:5px; text-align: center;font-weight: bold; overflow: hidden; text-overflow: ellipsis">-->\n                <!--</div>-->\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-primary btn-create btn-create-snap-shot activated">Create</button>\n                <button class="btn btn-primary btn-create btn-duplicate">Create</button>\n                <button class="btn btn-primary btn-create btn-create-blob">Create</button>\n                <button class="btn btn-default" data-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/CreateProject/styles/CreateProjectDialog",[],function(){}),define("js/Dialogs/CreateProject/CreateProjectDialog",["js/Loader/LoaderCircles","common/storage/util","common/core/constants","js/Controls/PropertyGrid/Widgets/AssetWidget","blob/BlobClient","text!./templates/CreateProjectDialog.html","css!./styles/CreateProjectDialog.css"],function(t,e,n,i,o,r){"use strict";var s;return s=function(t,e,n,r){this._client=t,this._logger=r.fork("CreateProjectDialog"),this.blobClient=new o({logger:this._logger.fork("BlobClient")}),this.newProjectId=e,this.seedProjectName=WebGMEGlobal.gmeConfig.seedProjects.defaultProject,this.seedProjectType="file",this.seedProjectBranch="master",this.seedCommitHash=null,this.assetWidget=new i({propertyName:"ImportFile",propertyValue:""}),this.assetWidget.el.addClass("form-control selector pull-left"),this.initialTab=n||"seed",this._blobIsPackage=!1,this._logger.debug("Create form seed ctor")},s.prototype.show=function(t){var e=this;this._fnCallback=t,this._initDialog(),this._dialog.on("hide.bs.modal",function(){e._dialog.find("li.tab").off("click"),e._dialog.find(".toggle-info-btn").off("click"),e._btnCreateSnapShot.off("click"),e._btnCreateBlob.off("click"),e._btnDuplicate.off("click"),e._dialog.remove(),e._dialog.empty(),e._dialog=void 0}),this._dialog.modal("show")},s.prototype._initDialog=function(){function n(t){if(i._formSnapShot.removeClass("activated"),i._formDuplicate.removeClass("activated"),i._formBlob.removeClass("activated"),i._btnCreateSnapShot.removeClass("activated"),i._btnDuplicate.removeClass("activated"),i._btnCreateBlob.removeClass("activated"),t.hasClass("snap-shot"))i._formSnapShot.addClass("activated"),i._btnCreateSnapShot.addClass("activated");else if(t.hasClass("duplicate"))i._formDuplicate.addClass("activated"),i._btnDuplicate.addClass("activated");else{if(!t.hasClass("blob"))return;i._formBlob.addClass("activated"),i._btnCreateBlob.addClass("activated")}}var i=this;this._dialog=$(r),this._dialog.find(".selection-blob").append(this.assetWidget.el),this._formSnapShot=this._dialog.find("form.snap-shot"),this._formDuplicate=this._dialog.find("form.duplicate"),this._formBlob=this._dialog.find("form.blob"),this._btnCreateSnapShot=this._dialog.find(".btn-create-snap-shot"),this._btnDuplicate=this._dialog.find(".btn-duplicate"),this._btnCreateBlob=this._dialog.find(".btn-create-blob"),this._selectSnapShot=this._formSnapShot.find("select.snap-shot"),this._optGroupFile=this._selectSnapShot.find("optgroup.file"),this._optGroupDb=this._selectSnapShot.find("optgroup.db"),this._selectSnapShot.children().remove(),this._optGroupFile.children().remove(),this._selectSnapShot.append(this._optGroupFile),this._optGroupDb.children().remove(),this._selectSnapShot.append(this._optGroupDb),this._selectDuplicate=this._formDuplicate.find("select.duplicate-project"),this._optGroupDuplicate=this._selectDuplicate.find("optgroup.project-id"),this._optGroupDuplicate.children().remove(),this._selectDuplicate.append(this._optGroupDuplicate),this._loader=new t({containerElement:this._dialog}),this._btnCancel=this._dialog.find(".btn-cancel"),WebGMEGlobal.gmeConfig.seedProjects.allowDuplication===!1&&this._dialog.find("li.duplicate").addClass("disabled-from-config"),n("import"===i.initialTab?this._dialog.find("li.blob").addClass("active"):this._dialog.find("li.snap-shot").addClass("active")),this._dialog.find("li.tab").on("click",function(){n($(this))}),this._dialog.find(".toggle-info-btn").on("click",function(t){var e,n=$(this);if(t.preventDefault(),t.stopPropagation(),n.hasClass("snap-shot-info"))e=i._dialog.find("span.snap-shot-info");else if(n.hasClass("duplicate-info"))e=i._dialog.find("span.duplicate-info");else{if(!n.hasClass("blob-info"))return;e=i._dialog.find("span.blob-info")}e.hasClass("hidden")?e.removeClass("hidden"):e.addClass("hidden")}),this._btnCreateSnapShot.on("click",function(t){t.preventDefault(),t.stopPropagation(),i._dialog.modal("hide"),i._fnCallback&&(i._logger.debug(i._selectSnapShot.val()),i.seedProjectType=i._selectSnapShot.val().slice(0,i._selectSnapShot.val().indexOf(":")),i.seedProjectName=i._selectSnapShot.val().slice(i._selectSnapShot.val().indexOf(":")+1),"db"===i.seedProjectType&&(i.seedProjectName=i._selectSnapShot.val().slice(i._selectSnapShot.val().indexOf(":")+1,i._selectSnapShot.val().indexOf("#")),i.seedCommitHash=i._selectSnapShot.val().slice(i._selectSnapShot.val().indexOf("#"))),i._fnCallback(i.seedProjectType,i.seedProjectName,i.seedProjectBranch,i.seedCommitHash))}),this._btnCreateBlob.on("click",function(t){t.preventDefault(),t.stopPropagation(),i._dialog.modal("hide"),i._fnCallback&&i.assetWidget.propertyValue&&i._fnCallback(i._blobIsPackage?"package":"blob",i.assetWidget.propertyValue,null,null)}),this._btnCreateBlob.disable(!0),this.assetWidget.onFinishChange(function(t){return i._btnCreateBlob.disable(!0),t.newValue?void i.blobClient.getMetadata(t.newValue).then(function(t){if(t.name.toLowerCase().lastIndexOf(".webgmex")!==t.name.length-".webgmex".length)throw new Error("Not .webgmex extension");i._blobIsPackage=!0,i._btnCreateBlob.disable(!1)})["catch"](function(t){i._logger.error("Error in uploaded file",t)}):void i._logger.error(new Error("New data does not have a value, "+t))}),this._btnDuplicate.on("click",function(t){t.preventDefault(),t.stopPropagation(),i._logger.debug("Duplicating with value",i._selectDuplicate.val()),i._dialog.modal("hide"),i._fnCallback&&i._fnCallback("duplicate",i._selectDuplicate.val(),null,null)}),i._loader.start(),i._client.getProjects({branches:!0},function(t,n){var o,r,s,a,l,c,d=WebGMEGlobal.allSeeds||[];for(l=0;l<d.length;l+=1)i._optGroupFile.append($("<option>",{text:d[l],value:"file:"+d[l]})),i.seedProjectName===d[l]&&(c="file:"+d[l]);if(t)return i.logger.error(t),void i._loader.stop();for(l=0;l<n.length;l+=1)if(o=n[l]._id,r=e.getProjectDisplayedNameFromProjectId(o),i._optGroupDuplicate.append($("<option>",{text:r,value:o})),1===Object.keys(n[l].branches).length)s=Object.keys(n[l].branches)[0],i._optGroupDb.append($("<option>",{text:r+" ("+s+" "+n[l].branches[s].slice(0,8)+")",value:"db:"+o+n[l].branches[s]})),c||i.seedProjectName!==o||(c="db:"+o+n[l].branches[s]);else{a=$("<optgroup>",{label:r}),i._selectSnapShot.append(a);for(s in n[l].branches)n[l].branches.hasOwnProperty(s)&&a.append($("<option>",{text:r+" ("+s+" "+n[l].branches[s].slice(0,8)+")",value:"db:"+o+n[l].branches[s]}));s=n[l].branches.hasOwnProperty("master")?"master":Object.keys(n[l].branches)[0],c||i.seedProjectName!==o||(c="db:"+o+s)}c&&i._selectSnapShot.val(c),i._loader.stop()})},s.prototype._displayMessage=function(t,e){this._importErrorLabel.removeClass("alert-success").removeClass("alert-danger"),e===!0?this._importErrorLabel.addClass("alert-danger"):this._importErrorLabel.addClass("alert-success"),this._importErrorLabel.html(t),this._importErrorLabel.hide(),this._importErrorLabel.fadeIn()},s}),define("text!js/Dialogs/Confirm/templates/ConfirmDialog.html",[],function(){return'<div class="confirm-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <i class="header-icon"></i><span class="title-text">Confirm delete</span>\n            </div>\n            <div class="modal-body">\n                <div class="question-text">Are you sure you want to delete?</div>\n                <div class="delete-item"></div>\n                <form class="form-horizontal" role="form">\n                    <div class="input-group">\n                        <span class="input-group-addon">Input</span>\n                        <input type="text" class="form-control">\n                    </div>\n                </form>\n            </div>\n            <div class="modal-footer">\n                <form>\n                    <label class="do-not-ask-again pull-left">\n                        <input type="checkbox"> Don\'t ask me again\n                    </label>\n                </form>\n                <button class="btn btn-ok">OK</button>\n                <button class="btn btn-default btn-cancel">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/Confirm/styles/ConfirmDialog",[],function(){}),define("js/Dialogs/Confirm/ConfirmDialog",["text!./templates/ConfirmDialog.html","css!./styles/ConfirmDialog.css"],function(t){"use strict";function e(){this._dialog=null,this._okBtn=null,this._cancelBtn=null,this._dontAsk=null}return e.prototype.show=function(e,n){var i,o,r=this;this._dialog=$(t),this._contentDiv=this._dialog.find(".modal-content"),this._dontAsk=this._contentDiv.find(".do-not-ask-again"),this._icon=this._contentDiv.find(".header-icon"),this._okBtn=this._contentDiv.find(".btn-ok"),this._cancelBtn=this._contentDiv.find(".btn-cancel"),this._inputForm=this._contentDiv.find(".form-horizontal"),e.input?(this._inputForm.find(".input-group-addon").text(e.input.label),this._formControl=this._inputForm.find(".form-control"),e.input.placeHolder&&r._formControl.attr("placeholder",e.input.placeHolder),e.input.required&&r._okBtn.disable(!0),i="function"==typeof e.input.checkFn?e.input.checkFn:function(){return!0},r._formControl.on("keyup",function(){var t=$(this);i(t.val())?(t.parent().removeClass("has-error"),r._okBtn.disable(!1)):(t.parent().addClass("has-error"),r._okBtn.disable(!0)),o=t.val()}),r._formControl.on("keydown",function(t){var e=13===t.which;e&&(t.preventDefault(),t.stopPropagation(),i(o)&&(r._dialog.modal("hide"),n(r._dontAsk.find("input").is(":checked"),o)))})):this._inputForm.hide(),e.severity?(this._contentDiv.addClass(e.severity),"info"===e.severity?this._okBtn.addClass("btn-primary"):this._okBtn.addClass("btn-"+e.severity)):this._okBtn.addClass("btn-danger"),e.enableDontAskAgain!==!0&&this._dontAsk.addClass("do-not-show"),e.iconClass?this._icon.addClass(e.iconClass):this._icon.addClass("glyphicon glyphicon-trash"),e.title&&this._contentDiv.find(".title-text").text(e.title),e.question&&this._contentDiv.find(".question-text").text(e.question),e.deleteItem&&this._contentDiv.find(".delete-item").text(e.deleteItem),this._okBtn.on("click",function(t){t.preventDefault(),t.stopPropagation(),r._dialog.modal("hide"),n(r._dontAsk.find("input").is(":checked"),o)}),this._cancelBtn.on("click",function(t){t.preventDefault(),t.stopPropagation(),r._dialog.modal("hide")}),this._dialog.on("hide.bs.modal",function(){r._dialog.remove(),r._dialog.empty(),r._dialog=void 0,"function"==typeof e.onHideFn&&e.onHideFn()}),this._dialog.modal("show")},e}),define("text!js/Dialogs/Projects/templates/ProjectsDialog.html",[],function(){return'<div class="projects-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <i class="header-icon gme-icon"></i><span>Projects</span>\n            </div>\n            <div class="pre-body">\n                <div class="tabContainer"></div>\n            </div>\n            <div class="modal-body">\n                <table class="table table-projects">\n                    <thead>\n                        <tr class="with-children">\n                            <th class="title-owner">Owner\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\n                            </th>\n                            <th class="title-name">Name\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\n                            </th>\n                            <th class="title-modified">Last Modified\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\n                            </th>\n                            <th class="title-viewed extra-info info-hidden">Last Viewed\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\n                            </th>\n                            <th class="title-created extra-info info-hidden">Created\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\n                            </th>\n                            <th class="title-icons">\n                                <i class="btn btn-micro btn-default btn-info-toggle glyphicon glyphicon-plus" title="Show/Hide Info"/>\n                            </th>\n                        </tr>\n                        <tr class="with-no-children">\n                            <th>No projects in this group...</th>\n                        </tr>\n                    </thead>\n                    <tbody class="project-list">\n                    </tbody>\n                </table>\n            </div>\n            <div class="modal-footer">\n                <div class="panel-buttons">\n                    <button class="btn btn-default pull-left btn-refresh" title="Reload project list..."\n                            style="position: relative;"><i class="glyphicon glyphicon-refresh"></i></button>\n                    <button class="btn btn-default pull-left btn-create-new">Create new...</button>\n                    <button class="btn btn-default" data-dismiss="modal">Close</button>\n                </div>\n                <div class="panel-create-new control-group">\n                    <div class="input-group">\n                        <div class="input-group-btn">\n                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                                <span class="selected-owner-id" title="Owner of New Project">Username</span>\n                                <span class="caret"></span>\n                            </button>\n                            <ul class="dropdown-menu ownerId-list">\n                            </ul>\n                        </div><!-- /btn-group -->\n                        <input type="text" class="input-xlarge txt-project-name form-control"\n                               placeholder="Project name..." />\n                    </div><!-- /input-group -->\n\n                    <button class="btn btn-primary btn-save corner-button" disabled>Create</button>\n                    <button class="btn btn-default btn-cancel corner-button">Cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>';
}),define("css!js/Dialogs/Projects/styles/ProjectsDialog",[],function(){}),define("js/Dialogs/Projects/ProjectsDialog",["js/logger","js/Constants","js/Loader/LoaderCircles","js/Utils/GMEConcepts","js/Dialogs/CreateProject/CreateProjectDialog","js/Dialogs/Confirm/ConfirmDialog","common/storage/util","js/util","common/regexp","text!./templates/ProjectsDialog.html","css!./styles/ProjectsDialog.css"],function(t,e,n,i,o,r,s,a,l,c){"use strict";var d,h="DATA_PROJECT",p="READ_ONLY_FILTER",g=$('<tr class="project-row"></tr>');return d=function(e,n,i){this._logger=t.create("gme:Dialogs:Projects:ProjectsDialog",WebGMEGlobal.gmeConfig.client.log),this._client=e,this._projectIds=[],this._projectList={},this._filter=void 0,this._userId=null,this._ownerId=null,this._creatingNew=n,this._createType=i||"seed",this._logger.debug("Created"),this._dontAskOnDelete=!1,this._openingProject=!1},d.prototype.show=function(){var t=this;this._initDialog(),this._dialog.modal("show"),this._dialog.on("hidden.bs.modal",function(){t._tableBody.off("dblclick"),t._tableBody.off("click"),t._tableHead.off("click"),t._btnCreateNew.off("click"),t._btnNewProjectCancel.off("click"),t._ownerIdList.off("click"),t._txtNewProjectName.off("keyup"),t._txtNewProjectName.off("keydown"),t._btnNewProjectCreate.off("click"),t._btnRefresh.off("click"),t._dialog.remove(),t._dialog.empty(),t._dialog=void 0,t._client.unwatchDatabase(t._projectEventHandling,function(e){e&&t._logger.error("error during unsubscribe",e)})}),this._refreshProjectList(),this._projectEventHandling=function(n,i){(i.etype===e.CLIENT.STORAGE.PROJECT_CREATED||i.etype===e.CLIENT.STORAGE.PROJECT_DELETED)&&(t._logger.debug("projectList changed event",i),t._refreshProjectList.call(t))},t._client.watchDatabase(t._projectEventHandling,function(e){e&&t._logger.error("unable to follow project events",e)})},d.prototype._initDialog=function(){function t(t){u._logger.debug("openProject requested, already opening?",u._openingProject),u._projectList[t].rights.read===!0&&u._openingProject===!1&&(u._openingProject=!0,u._client.selectProject(t,null,function(t){u._openingProject=!1,t&&u._logger.error(t),u._dialog.modal("hide")}))}function e(){var t,e=u._txtNewProjectName.val();""!==e&&-1===u._projectIds.indexOf(e)&&(u._dialog.modal("hide"),t=new o(u._client,e,u._createType,u._logger.fork("CreateProjectDialog")),t.show(function(t,n,i,o,r){t&&n?u._createProject(e,t,n,i,o,r):u._logger.debug("Closed create dialog with arguments",t,n)}))}function i(t){var e,n=WebGMEGlobal.gmeConfig.authentication.enable?s.getProjectDisplayedNameFromProjectId(t):s.getProjectNameFromProjectId(t),i=function(){},o=function(){document.location.href=window.location.href.split("?")[0]},a=function(){u._client.deleteProject(t,function(e){return e?void u._logger.error(e):void(u._activeProject===t?o():i())})};if(u._projectList[t].rights["delete"]===!0){if(u._dontAskOnDelete===!0)return void a();e=new r,e.show({deleteItem:n,enableDontAskAgain:!0,onHideFn:function(){u._modalContent.removeClass("in-background")}},function(t){t&&(u._dontAskOnDelete=!0),a()}),u._modalContent.addClass("in-background")}}function a(t,e){return l.PROJECT_NAME.test(t)&&-1===u._projectIds.indexOf(e)}var d,g,u=this;this._dialog=$(c),this._userId=WebGMEGlobal.userInfo._id,this._modalContent=this._dialog.find(".modal-content").first(),this._el=this._dialog.find(".modal-body").first(),this._table=this._el.find("table").first(),this._tableHead=this._table.find("thead").first(),this._tableBody=this._table.find("tbody").first(),this._modalFooter=this._dialog.find(".modal-footer"),this._panelButtons=this._modalFooter.find(".panel-buttons"),this._panelCreateNew=this._modalFooter.find(".panel-create-new").hide(),this._btnCreateNew=this._panelButtons.find(".btn-create-new"),this._btnRefresh=this._panelButtons.find(".btn-refresh"),this._btnNewProjectCancel=this._panelCreateNew.find(".btn-cancel"),this._btnNewProjectCreate=this._panelCreateNew.find(".btn-save"),this._txtNewProjectName=this._panelCreateNew.find(".txt-project-name"),this._ownerIdList=this._panelCreateNew.find("ul.ownerId-list"),this._selectedOwner=this._panelCreateNew.find(".selected-owner-id"),this._ownerId=this._userId,this._selectedOwner.text(this._ownerId),this._ownerIdList.append($('<li><a class="ownerId-selection">'+u._userId+"</a></li>")),WebGMEGlobal.userInfo.adminOrgs.length>0&&(this._ownerIdList.append($('<li role="separator" class="divider"></li>')),WebGMEGlobal.userInfo.adminOrgs.forEach(function(t){u._ownerIdList.append($('<li><a class="ownerId-selection">'+t._id+"</a></li>"))})),WebGMEGlobal.gmeConfig.authentication.enable===!0&&this._ownerId===WebGMEGlobal.gmeConfig.authentication.guestAccount&&(d=[{title:"DEMO",active:!0,data:p}],u._filter=p),this._loader=new n({containerElement:this._btnRefresh}),this._loader.setSize(14),this._dialog.find(".tabContainer").first().groupedAlphabetTabs({onClick:function(t){u._filter=t,u._updateFilter()},noMatchText:"Nothing matched your filter, please click another letter.",extraTabs:d}),this._tableBody.on("dblclick","tr",function(e){g=$(this).data(h)._id,e.stopPropagation(),e.preventDefault(),t(g)}),this._tableBody.on("click","span.open-link",function(e){g=$(this).data("projectId"),e.stopPropagation(),e.preventDefault(),t(g)}),this._tableHead.on("click","i.btn-info-toggle",function(t){var e=$(this),n=!u._table.hasClass("info-displayed");n?(u._table.find(".extra-info").removeClass("info-hidden"),u._table.addClass("info-displayed"),e.removeClass("glyphicon-plus"),e.addClass("glyphicon-minus")):(u._table.find(".extra-info").addClass("info-hidden"),u._table.removeClass("info-displayed"),e.removeClass("glyphicon-minus"),e.addClass("glyphicon-plus")),t.stopPropagation(),t.preventDefault()}),this._tableHead.on("click","th",function(t){var e,n,i=$(this),o=i.hasClass("reverse-order");if(t.stopPropagation(),t.preventDefault(),i.hasClass("title-owner"))n="owner";else if(i.hasClass("title-name"))n="name";else if(i.hasClass("title-modified"))n="modified";else if(i.hasClass("title-viewed"))n="viewed";else{if(!i.hasClass("title-created"))return;n="created"}u._tableHead.find("th").removeClass("reverse-order in-order"),o?i.addClass("in-order"):i.addClass("reverse-order"),e=u._tableBody.children("tr"),e.sort(function(t,e){var i=$(t).data(h),r=$(e).data(h),s=0;return i[n]>r[n]?s=1:i[n]<r[n]&&(s=-1),("modified"===n||"viewed"===n||"created"===n)&&(s=-1*s),0===s&&(s=i._id.toUpperCase()>r._id.toUpperCase()?1:-1),o?-1*s:s}),e.detach().appendTo(u._tableBody)}),this._tableBody.on("click","i.delete-project",function(t){g=$(this).data("projectId"),t.stopPropagation(),t.preventDefault(),i(g)}),WebGMEGlobal.userInfo.canCreate!==!0?this._btnCreateNew.hide():this._btnCreateNew.on("click",function(t){u._txtNewProjectName.val(""),u._panelButtons.hide(),u._panelCreateNew.show(),u._txtNewProjectName.focus(),u._creatingNew=!0,t.stopPropagation(),t.preventDefault()}),this._btnNewProjectCancel.on("click",function(t){u._panelButtons.show(),u._panelCreateNew.hide(),u._btnNewProjectCreate.show(),u._creatingNew=!1,u._updateFilter(),t.stopPropagation(),t.preventDefault()}),this._ownerIdList.on("click","a.ownerId-selection",function(){var t=$(this).text(),e=u._txtNewProjectName.val(),n=s.getProjectIdFromOwnerIdAndProjectName(t,e);u._ownerId=t,u._selectedOwner.text(t),a(e,n)===!1?(u._panelCreateNew.addClass("has-error"),u._btnNewProjectCreate.disable(!0)):(u._panelCreateNew.removeClass("has-error"),u._btnNewProjectCreate.disable(!1))}),this._txtNewProjectName.on("keyup",function(){var t=u._txtNewProjectName.val(),e=s.getProjectIdFromOwnerIdAndProjectName(u._ownerId,t);1===t.length?u._updateFilter([t.toUpperCase()[0],t.toUpperCase()[0]]):0===t.length&&u._updateFilter(),a(t,e)===!1?(u._panelCreateNew.addClass("has-error"),u._btnNewProjectCreate.disable(!0)):(u._panelCreateNew.removeClass("has-error"),u._btnNewProjectCreate.disable(!1))}),this._btnNewProjectCreate.on("click",function(t){e(),t.stopPropagation(),t.preventDefault()}),this._txtNewProjectName.on("keydown",function(t){var n=13===t.which,i=u._txtNewProjectName.val(),o=s.getProjectIdFromOwnerIdAndProjectName(u._ownerId,i);n&&a(i,o)&&(e(u._client),t.stopPropagation(),t.preventDefault())}),this._btnRefresh.on("click",function(t){u._refreshProjectList.call(u),t.stopPropagation(),t.preventDefault()})},d.prototype._refreshProjectList=function(){var t=this,e={rights:!0,info:!0};this._loader.start(),this._btnRefresh.disable(!0),this._btnRefresh.find("i").css("opacity","0"),this._client.getProjects(e,function(e,n){function i(t){var e=0;return t.rights.write===!0?e=2:t.rights.read===!0&&(e=1),e}var o,r;for(t._activeProject=t._client.getActiveProjectId(),t._projectList={},t._projectIds=[],o=0;o<n.length;o+=1)t._projectIds.push(n[o]._id),t._projectList[n[o]._id]=n[o];t._projectIds.sort(function(e,n){var o,r=i(t._projectList[e]),s=i(t._projectList[n]);return r>s?o=-1:s>r?o=1:r===s&&(o=e.toLowerCase()<n.toLowerCase()?-1:1),o}),t._updateProjectNameList(),t._loader.stop(),t._btnRefresh.find("i").css("opacity","1"),t._btnRefresh.disable(!1),t._creatingNew&&(r=t._txtNewProjectName.val(),r&&r.length>0&&t._updateFilter([r.toUpperCase()[0],r.toUpperCase()[0]]),t._panelButtons.hide(),t._panelCreateNew.show(),setTimeout(function(){t._txtNewProjectName.focus()},500))})},d.prototype._updateProjectNameList=function(){function t(t,e,n,i){var o=s.getProjectDisplayedNameFromProjectId(m._projectIds[t]);return o+" was "+e+" by "+(n||"N/A")+" at "+a.formattedDate(i)}var e,n,i,o,r,l,c,d,p,u,f,m=this,_=this._projectIds.length;if(this._tableBody.empty(),this._tableHead.find("th").removeClass("reverse-order in-order"),_>0)for(e=0;_>e;e+=1)o=!1,u=this._projectList[this._projectIds[e]],d=s.getProjectNameFromProjectId(this._projectIds[e]),p=s.getOwnerFromProjectId(this._projectIds[e]),f=g.clone(),l=u.info.viewedAt?new Date(u.info.viewedAt):new Date(1447879297957),r=u.info.modifiedAt?new Date(u.info.modifiedAt):new Date(1447879297957),c=u.info.createdAt?new Date(u.info.createdAt):new Date(1431343297957),f.data(h,{_id:this._projectIds[e],modified:r.getTime(),viewed:l.getTime(),created:c.getTime(),name:d.toUpperCase(),owner:p.toUpperCase()}),$("<td/>").addClass("owner").text(p).appendTo(f),n=$("<span/>").addClass("open-link").attr("title","Open").text(d).data("projectId",this._projectIds[e]),$("<td/>").addClass("name").append(n).append('<span class="name-read-only">[Read-Only]</span>').appendTo(f),n=$("<span/>").attr("title",t(e,"modified",u.info.modifier,r)).text(a.formattedDate(r,"elapsed")),$("<td/>").addClass("modified").append(n).appendTo(f),n=$("<span/>").attr("title",t(e,"viewed",u.info.viewer,l)).text(a.formattedDate(l,"elapsed")),$("<td/>").addClass("viewed extra-info info-hidden").append(n).appendTo(f),n=$("<span/>").attr("title",t(e,"created",u.info.creator,c)).text(a.formattedDate(c,"elapsed")),$("<td/>").addClass("created extra-info info-hidden").append(n).appendTo(f),i=$("<td/>").addClass("icons").appendTo(f),this._projectIds[e]===this._activeProject&&f.addClass("active"),u.rights.write!==!0&&f.addClass("read-only"),u.rights["delete"]===!0?i.append($('<i class="glyphicon glyphicon-trash delete-project extra-info info-hidden"/>').data("projectId",this._projectIds[e])):i.append('<i class="glyphicon glyphicon-lock locked extra-info info-hidden"/>'),this._tableBody.append(f);else this._table.addClass("no-children");this._table.hasClass("info-displayed")&&this._table.find(".extra-info").removeClass("info-hidden"),m._updateFilter()},d.prototype._updateFilter=function(t){var e=this,n=0;t=t||e._filter,e._tableBody.children("tr").each(function(){var e,i=$(this);t&&t===p?i.hasClass("read-only")?(i.removeClass("filtered-out"),n+=1):i.addClass("filtered-out"):t?(e=i.data(h).name.toUpperCase()[0],e>=t[0]&&e<=t[1]?(i.removeClass("filtered-out"),n+=1):i.addClass("filtered-out")):(i.removeClass("filtered-out"),n+=1)}),0===n?e._table.addClass("no-children"):e._table.removeClass("no-children")},d.prototype._createProject=function(t,e,i,o,r){function s(t){a._client.selectProject(t,null,function(t){t?a._logger.error("Cannot select project",t):a._logger.debug("Selected project"),c.stop()})}var a=this,l={type:e,projectName:t,seedName:i,seedBranch:o,seedCommit:r,ownerId:a._ownerId},c=new n({containerElement:$("body")});c.start(),"duplicate"===e?(a._logger.debug("Duplicating project: ",i,t,a._ownerId),a._client.duplicateProject(i,t,a._ownerId,function(t,e){t?(a._logger.error("Failed to duplicate project",t),c.stop()):(a._logger.debug("Duplicated project"),s(e))})):"package"===e?(a._logger.debug("Importing package: "),a._client.importProjectFromFile(t,"master",i,a._ownerId,"",function(t,e){t?(a._logger.error("Failed to import project package",t),c.stop()):(a._logger.debug("Project package imported"),s(e))})):(a._logger.debug("Creating new project from seed: ",l),a._client.seedProject(l,function(t,e){t?(a._logger.error("Cannot create seed project",t),c.stop()):(a._logger.debug("Created new project from seed"),s(e.projectId))}))},d}),define("js/Controls/PropertyGrid/Widgets/StringWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(t){"use strict";var e,n=$("<input/>",{type:"text"});return e=function(e){var i=this;t.call(this,e),this.__input=n.clone(),this.__input.val(this.propertyValue),e.regex&&(e.regexMessage=e.regexMessage||"Value has to match regex: "+e.regex,this.__input.attr("pattern",e.regex),this.__input.attr("title",e.regexMessage)),this.__input.on("keyup change",function(t){t.stopPropagation(),t.preventDefault(),i.setValue(i.__input.val())}),this.__input.on("blur",function(){i.fireFinishChange()}),this.__input.on("keydown",function(t){13===t.keyCode&&this.blur()}),this.updateDisplay(),this.el.append(this.__input)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.updateDisplay=function(){return document.activeElement!==this.__input[0]&&this.__input.val(this.getValue()),t.prototype.updateDisplay.call(this)},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._isReadOnly===!0?this.__input.attr("disabled","disabled"):this.__input.removeAttr("disabled")},e}),define("js/Controls/PropertyGrid/Widgets/NumberWidgetBase",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(t){"use strict";var e;return e=function(e){t.call(this,e),this.__min=e.minValue,this.__max=e.maxValue,this.__step=e.stepValue,void 0===this.__step||null===this.__step?0===this.originalValue?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.originalValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=this._numDecimals(this.__impliedStep)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.setValue=function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!==0&&(e=Math.round(e/this.__step)*this.__step),t.prototype.setValue.call(this,e),this.updateDisplay(),this},e.prototype._numDecimals=function(t){return t=t.toString(),t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0},e.prototype.min=function(t){return this.__min=t,this},e.prototype.max=function(t){return this.__max=t,this},e.prototype.step=function(t){return this.__step=t,this},e}),define("js/Controls/PropertyGrid/Widgets/NumberBoxWidget",["js/Controls/PropertyGrid/Widgets/NumberWidgetBase"],function(t){"use strict";var e,n=$("<input/>",{type:"text"});return e=function(e){var i=this;this.__truncationSuspended=!1,t.call(this,e),this.__input=n.clone(),this.__input.val(this.propertyValue),this.__input.on("change",function(){i._onChange()}),this.__input.on("blur",function(){i._onBlur()}),this.__input.on("keydown",function(t){13===t.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1)}),this.updateDisplay(),this.el.append(this.__input)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.updateDisplay=function(){var e=this.__truncationSuspended?this.getValue():this._roundToDecimal(this.getValue(),this.__precision);return this.__input.val(e),t.prototype.updateDisplay.call(this)},e.prototype._roundToDecimal=function(t,e){var n=Math.pow(10,e);return""===t?t:Math.round(t*n)/n},e.prototype._onChange=function(){var t=parseFloat(this.__input.val());_.isNaN(t)?this.__input.val(this.originalValue):this.setValue(t)},e.prototype._onBlur=function(){this._onChange(),this.fireFinishChange()},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._isReadOnly===!0?this.__input.attr("disabled","disabled"):this.__input.removeAttr("disabled")},e}),define("js/Controls/PropertyGrid/Widgets/BooleanWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(t){"use strict";var e,n=$("<input/>",{type:"checkbox"});return e=function(e){var i=this;t.call(this,e),this.__checkbox=n.clone(),this.__checkbox.prop("checked",this.propertyValue),this.__checkbox.on("change",function(){i.setValue($(this).is(":checked")),i.fireFinishChange()}),this.updateDisplay(),this.el.append(this.__checkbox)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.updateDisplay=function(){return this.getValue()===!0?this.__checkbox.attr("checked",!0):this.__checkbox.attr("checked",!1),t.prototype.updateDisplay.call(this)},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._isReadOnly===!0?this.__checkbox.attr("disabled","disabled"):this.__checkbox.removeAttr("disabled")},e}),define("js/Controls/PropertyGrid/Widgets/LabelWidget",["clipboard","js/Controls/PropertyGrid/Widgets/WidgetBase"],function(t,e){"use strict";var n,i=$("<span/>",{"class":"user-select-on"});return n=function(n){e.call(this,n),this.__label=i.clone(),this.__clipboard=n.clipboard,this.__clipboard===!0&&(new t(this.__label[0]),this.__label.attr("title","Copy to clipboard"),this.__label.css("cursor","copy")),this.updateDisplay(),this.el.append(this.__label)},n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.updateDisplay=function(){return this.__label.text(this.propertyValue),this.__clipboard?this.__label.attr("data-clipboard-text",this.propertyValue):this.__label.attr("title",this.propertyValue),e.prototype.updateDisplay.call(this)},n}),define("css!js/Controls/styles/iCheckBox",[],function(){}),define("js/Controls/iCheckBox",["jquery","css!./styles/iCheckBox.css"],function(){"use strict";var t,e="ON",n="OFF",i="checked",o="disabled",r=$('<div class="iCheckBox checked"><div class="sw"></div><div class="txt"></div></div>');return t=function(t){var i=this;this._checkedText=t&&t.checkedText||e,this._checkedText=this._checkedText.toUpperCase(),this._uncheckedText=t&&t.uncheckedText||n,this._uncheckedText=this._uncheckedText.toUpperCase(),this.el=r.clone(),t.icon&&this.el.find(".sw").append('<i class="'+t.icon+'"></i>'),t.title&&this.el.attr("title",t.title),this._txt=this.el.find(".txt").first(),this._txt.text(this._checkedText),t&&t.hasOwnProperty("checked")&&this.setChecked(t.checked),t&&t.data&&this.el.data(t.data),this.el.on("click",null,function(t){i.toggleChecked(),t.stopPropagation()}),this._checkChangedFn=t&&t.checkChangedFn},t.prototype.toggleChecked=function(){this.setChecked(!this.isChecked())},t.prototype.isChecked=function(){return this.el.hasClass(i)},t.prototype.setChecked=function(t){var e=this.el,n=this.isChecked(),r=this.el.data();"false"===t&&(t=!1),e.hasClass(o)||n!==t&&(this.el.toggleClass(i),this._txt.text(t?this._checkedText:this._uncheckedText),this._checkChangedFn&&this._checkChangedFn.call(this,r,t))},t.prototype.setEnabled=function(t){t?this.el.removeClass(o):this.el.addClass(o)},t}),define("js/Controls/PropertyGrid/Widgets/iCheckBoxWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","js/Controls/iCheckBox"],function(t,e){"use strict";var n;return n=function(n){var i=this;t.call(this,n),this.__checkbox=new e({checkedText:"TRUE",uncheckedText:"FALSE",title:n.title,checkChangedFn:function(t,e){i.setValue(e),i.fireFinishChange()}}),this.updateDisplay(),this.el.append(this.__checkbox.el)},n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.updateDisplay=function(){return this.__checkbox.setChecked(this.getValue()),t.prototype.updateDisplay.call(this)},n.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this.__checkbox.setEnabled(!this._isReadOnly)},n}),define("js/Controls/PropertyGrid/Widgets/OptionWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(t){"use strict";var e,n=$('<option value="empty"/>'),i=$("<option/>");return e=function(e){var o,r,s=this;for(t.call(this,e),this.__select=$("<select/>"),null===e.value&&(r=n.clone(),r.text(""),this.__select.append(r)),o=0;o<this.valueItems.length;o+=1)r=i.clone(),r.text(this.valueItems[o]),this.__select.append(r);-1===this.valueItems.indexOf(e.value)&&this.el.prop("title",'"'+e.value+'" <'+typeof e.value+"> not part of enum"),this.__select.on("change",function(t){var e=s.__select.val();t.stopPropagation(),t.preventDefault(),"float"===s.valueType?e=parseFloat(e):"integer"===s.valueType&&(e=parseInt(e,10)),NaN!==e&&(s.__select.find('option[value="empty"]').remove(),s.setValue(e),s.fireFinishChange())}),this.updateDisplay(),this.el.append(this.__select)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.updateDisplay=function(){return this.__select.val(this.getValue()),t.prototype.updateDisplay.call(this)},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._isReadOnly===!0?this.__select.attr("disabled","disabled"):this.__select.removeAttr("disabled")},e}),define("css!js/Controls/styles/ColorPicker",[],function(){}),define("js/Controls/ColorPicker",["jquery-spectrum","css!./styles/ColorPicker.css"],function(){"use strict";var t;return t=function(t){var e=this,n=t.color||"#dd3333";this.el=t.el,this.el.spectrum({color:n,showPalette:!0,showSelectionPalette:!1,showInput:!0,showInitial:!0,preferredFormat:"hex",allowEmpty:!0,palette:[["rgb(255, 255, 255)","rgb(242, 242, 242);","rgb(230, 230, 230);","rgb(204, 204, 204);","rgb(179, 179, 179);","rgb(153, 153, 153);","rgb(128, 128, 128);","rgb(102, 102, 102);","rgb(77, 77, 77);","rgb(51, 51, 51);","rgb(26, 26, 26);","rgb(0, 0, 0);"],["rgb(255, 204, 204);","rgb(255, 230, 204);","rgb(255, 255, 204);","rgb(230, 255, 204);","rgb(204, 255, 204);","rgb(204, 255, 230);","rgb(204, 255, 255);","rgb(204, 229, 255);","rgb(204, 204, 255);","rgb(229, 204, 255);","rgb(255, 204, 255);","rgb(255, 204, 230);"],["rgb(255, 153, 153);","rgb(255, 204, 153);","rgb(255, 255, 153);","rgb(204, 255, 153);","rgb(153, 255, 153);","rgb(153, 255, 204);","rgb(153, 255, 255);","rgb(153, 204, 255);","rgb(153, 153, 255);","rgb(204, 153, 255);","rgb(255, 153, 255);","rgb(255, 153, 204);"],["rgb(255, 102, 102);","rgb(255, 179, 102);","rgb(255, 255, 102);","rgb(179, 255, 102);","rgb(102, 255, 102);","rgb(102, 255, 179);","rgb(102, 255, 255);","rgb(102, 178, 255);","rgb(102, 102, 255);","rgb(178, 102, 255);","rgb(255, 102, 255);","rgb(255, 102, 179);"],["rgb(255, 51, 51);","rgb(255, 153, 51);","rgb(255, 255, 51);","rgb(153, 255, 51);","rgb(51, 255, 51);","rgb(51, 255, 153);","rgb(51, 255, 255);","rgb(51, 153, 255);","rgb(51, 51, 255);","rgb(153, 51, 255);","rgb(255, 51, 255);","rgb(255, 51, 153);"],["rgb(255, 0, 0);","rgb(255, 128, 0);","rgb(255, 255, 0);","rgb(128, 255, 0);","rgb(0, 255, 0);","rgb(0, 255, 128);","rgb(0, 255, 255);","rgb(0, 127, 255);","rgb(0, 0, 255);","rgb(127, 0, 255);","rgb(255, 0, 255);","rgb(255, 0, 128);"],["rgb(204, 0, 0);","rgb(204, 102, 0);","rgb(204, 204, 0);","rgb(102, 204, 0);","rgb(0, 204, 0);","rgb(0, 204, 102);","rgb(0, 204, 204);","rgb(0, 102, 204);","rgb(0, 0, 204);","rgb(102, 0, 204);","rgb(204, 0, 204);","rgb(204, 0, 102);"],["rgb(153, 0, 0);","rgb(153, 76, 0);","rgb(153, 153, 0);","rgb(77, 153, 0);","rgb(0, 153, 0);","rgb(0, 153, 77);","rgb(0, 153, 153);","rgb(0, 76, 153);","rgb(0, 0, 153);","rgb(76, 0, 153);","rgb(153, 0, 153);","rgb(153, 0, 77);"],["rgb(102, 0, 0);","rgb(102, 51, 0);","rgb(102, 102, 0);","rgb(51, 102, 0);","rgb(0, 102, 0);","rgb(0, 102, 51);","rgb(0, 102, 102);","rgb(0, 51, 102);","rgb(0, 0, 102);","rgb(51, 0, 102);","rgb(102, 0, 102);","rgb(102, 0, 51);"]],show:function(){var t=$(".sp-container"),n=t.find(".sp-clear");n.off("click.spectrum"),n.on("click.ColorPicker",function(t){t.stopPropagation(),t.preventDefault(),e.el.spectrum("hide"),e.onColorChanged()})},hide:function(){e._destroy()},change:function(t){e._destroy(),t?e.onColorChanged(t.toHexString()):e.onColorChanged()}}),this.el.spectrum("show")},t.prototype.setColor=function(t){this.el.spectrum("set",t)},t.prototype.onColorChanged=function(t){console.log("ColorPicker.onColorChanged not overridden: "+t)},t.prototype._destroy=function(){this.el.spectrum("destroy")},t}),define("js/Controls/PropertyGrid/Widgets/ColorPickerWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","js/Controls/ColorPicker"],function(t,e){"use strict";var n,i=$("<div/>",{id:"cpw","class":"color-picker"});return n=function(n){var o,r,s=this;this._enabled=!0,t.call(this,n),this.__colorDiv=i.clone(),this.__colorDiv.on("click",function(t){t.preventDefault(),t.stopPropagation(),s._enabled&&(o=s.getValue(),r=new e({el:s.__colorDiv,color:o}),r.onColorChanged=function(t){s.setValue(t),s.fireFinishChange()})}),this.updateDisplay(),this.el.append(this.__colorDiv)},n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.updateDisplay=function(){return this.__colorDiv.css("background-color",this.getValue()),t.prototype.updateDisplay.call(this)},n.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._enabled=!this._isReadOnly},n}),define("js/Utils/ColorUtil",[],function(){"use strict";function t(t){var e,n,i,o,r,s=/^#[0-9A-F]{6}$/,a=/^#[0-9A-F]{3}$/,l=/rgb\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\s*\)$/,c=/rgba\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d+(.\d*))\s*\)$/;return"string"==typeof t&&(t=t.toUpperCase(),n=t.match(s),n?e=t:(n=t.match(a),n?e="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:(n=t.match(l)||t.match(c),n&&(i=parseInt(n[1],10).toString(16),1===i.length&&(i="0"+i),o=parseInt(n[2],10).toString(16),1===o.length&&(o="0"+o),r=parseInt(n[3],10).toString(16),1===r.length&&(r="0"+r),e=("#"+i+o+r).toUpperCase())))),e}return{getHexColor:t,isColor:function(e){return void 0!==t(e)}}}),define("js/Controls/PropertyGrid/Widgets/DialogWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(t){"use strict";var e,n=$("<span/>",{}),i=$('<a class="btn btn-mini btn-dialog-open">...</a>');return e=function(e){var o=this;t.call(this,e),this.__label=n.clone(),this.el.append(this.__label),e.dialog&&(this.__btnDialogOpen=i.clone(),this.el.append(this.__btnDialogOpen),this.__btnDialogOpen.on("click",function(t){var n=e.dialog,i=new n;t.stopPropagation(),t.preventDefault(),i.show(function(t){o.setValue(t),o.fireFinishChange()},o.getValue())})),this.updateDisplay()},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.updateDisplay=function(){return this.__label.text(this.propertyValue),this.__label.attr("title",this.propertyValue),t.prototype.updateDisplay.call(this)},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this.__btnDialogOpen&&(this._isReadOnly===!0?this.__btnDialogOpen.disable(!0):this.__btnDialogOpen.disable(!1))},e}),define("js/Controls/PropertyGrid/Widgets/FloatWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(t){"use strict";var e,n=$("<input/>",{type:"text"});return e=function(e){var i=this;t.call(this,e),this._helpMessage="Enter float ",this._input=n.clone(),this._input.val(e.value),this.min=null,"number"==typeof e.minValue?(this.min=e.minValue,this._helpMessage+="["+this.min):this._helpMessage+="(-inf",this.max=null,"number"==typeof e.maxValue?(this.max=e.maxValue,this._helpMessage+=", "+this.max+"]"):this._helpMessage+=", inf)",this._input.prop("title",this._helpMessage),this._input.on("change",function(){i._onChange()}),this._input.on("blur",function(){i._onBlur()}),this._input.on("keydown",function(t){13===t.keyCode&&this.blur()}),this.el.append(this._input)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.setValue=function(e){return t.prototype.setValue.call(this,e),this.updateDisplay(),this},e.prototype._onChange=function(){var t=parseFloat(this._input.val());isNaN(t)?this._input.val(this.getValue()):null!==this.min&&t<this.min?this._input.val(this.getValue()):null!==this.max&&t>this.max?this._input.val(this.getValue()):(this._input.val(t),this.setValue(t))},e.prototype._onBlur=function(){this._onChange(),this.fireFinishChange()},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._isReadOnly===!0?this._input.attr("disabled","disabled"):this._input.removeAttr("disabled")},e.prototype.destroy=function(){this._input.off("change"),this._input.off("blur"),this._input.off("keydown"),t.prototype.destroy.call(this)},e}),define("js/Controls/PropertyGrid/Widgets/IntegerWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(t){"use strict";var e,n=$("<input/>",{type:"number",step:"1"});return e=function(e){var i,o=this;t.call(this,e),this._input=n.clone(),this._input.val(e.value),"number"==typeof e.minValue&&(i={},i.min=e.minValue),"number"==typeof e.maxValue&&(i=i||{},i.max=e.maxValue),i&&this._input.attr(i),this._input.on("change",function(){o._onChange()}),this._input.on("blur",function(){o._onBlur()}),this._input.on("keydown",function(t){13===t.keyCode&&this.blur()}),this.el.append(this._input)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.setValue=function(e){return t.prototype.setValue.call(this,e),this.updateDisplay(),this},e.prototype._onChange=function(){var t=this._input.val();t=parseFloat(t),isNaN(t)?this._input.val(this.getValue()):this.setValue(Math.round(t))},e.prototype._onBlur=function(){this._onChange(),this.fireFinishChange()},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._isReadOnly===!0?this._input.attr("disabled","disabled"):this._input.removeAttr("disabled")},e.prototype.destroy=function(){this._input.off("change"),this._input.off("blur"),this._input.off("keydown"),t.prototype.destroy.call(this)},e}),define("js/DragDrop/DragEffects",[],function(){"use strict";return{DRAG_COPY:"DRAG_COPY",DRAG_MOVE:"DRAG_MOVE",DRAG_CREATE_INSTANCE:"DRAG_CREATE_INSTANCE",DRAG_CREATE_POINTER:"DRAG_CREATE_POINTER",DRAG_SET_REPLACEABLE:"DRAG_SET_REPLACEABLE",DRAG_ADD_MEMBER:"DRAG_ADD_MEMBER"}}),define("js/DragDrop/DragConstants",[],function(){"use strict";return{DRAG_ITEMS:"DRAG_ITEMS",DRAG_EFFECTS:"DRAG_EFFECTS",DRAG_INFO:"DRAG_INFO",DRAG_PARAMS:"DRAG_PARAMS"}}),define("js/DragDrop/DropTarget",["./DragEffects","./DragConstants"],function(t,e){"use strict";function n(t,n){var i;i=function(i,o,r){var s,a=r.helper;a&&(s=a.data(e.DRAG_INFO)),n&&_.isFunction(n[i])&&n[i].call(t,o,s)},t.droppable({tolerance:"pointer",over:function(t,e){i("over",t,e)},out:function(t,e){i("out",t,e)},drop:function(t,e){i("drop",t,e)},activate:function(t,e){i("activate",t,e)},deactivate:function(t,e){i("deactivate",t,e)}})}function i(t){r(t)&&t.droppable("destroy")}function o(t,e){var n=e?"enable":"disable";r(t)&&t.droppable(n)}function r(t){return t.hasClass("ui-droppable")}return{makeDroppable:n,destroyDroppable:i,enableDroppable:o}}),define("css!js/Controls/PropertyGrid/Widgets/styles/PointerWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/PointerWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","js/Utils/DisplayFormat","js/Constants","js/DragDrop/DropTarget","js/DragDrop/DragConstants","css!./styles/PointerWidget.css"],function(t,e,n,i,o){"use strict";var r;return r=function(e){var n,i,o=this;this._gmeNodeId=null,this.USE_ACTUAL_POINTER_NAME=!1,t.call(this,e),i=WebGMEGlobal.State.getActiveSelection(),n=WebGMEGlobal.State.getActiveObject(),i&&i.length>0?1===i.length&&(this._gmeNodeId=i[0]):n&&(this._gmeNodeId=n),this._client=e.client,this._div=$("<div/>",{"class":"ptr-widget"}),this.el.append(this._div),
this.__label=$("<span/>",{"class":"user-select-on"}),this._div.append(this.__label),this.__iconAssignNullPointer=$("<i/>",{"class":"glyphicon glyphicon-minus-sign"}),this.__iconAssignNullPointer.attr("title","Assign null-pointer"),this.__iconAssignNullPointer.on("click",function(t){t.stopPropagation(),t.preventDefault(),o.setValue(null),o.fireFinishChange()}),this.__label.on("click",function(t){t.stopPropagation(),t.preventDefault(),o._followPointer()}),this.__nodeDropTarget=this._div,this._makeDroppable(),this.updateDisplay()},_.extend(r.prototype,t.prototype),r.prototype._makeDroppable=function(){var t=this;"base"!==this.propertyName&&this._gmeNodeId&&(t._div.addClass("drop-area"),t._div.append(this.__iconAssignNullPointer),i.makeDroppable(t.__nodeDropTarget,{over:function(e,n){t._isValidPointerDrop(n)?t._div.addClass("accept-drop"):t._div.addClass("reject-drop")},out:function(){t._div.removeClass("accept-drop reject-drop")},drop:function(e,n){t._isValidPointerDrop(n)&&(t.setValue(n[o.DRAG_ITEMS][0]),t.fireFinishChange()),t._div.removeClass("accept-drop reject-drop")}}))},r.prototype._destroyDroppable=function(){"base"!==this.propertyName&&this._gmeNodeId&&(this._div.removeClass("drop-area"),i.destroyDroppable(this.__nodeDropTarget),this.__iconAssignNullPointer.detach())},r.prototype._isValidPointerDrop=function(t){var e,n=this,i=!1;return 1===t[o.DRAG_ITEMS].length&&this._gmeNodeId&&(e=n._client.getNode(t[o.DRAG_ITEMS][0]),i=e&&e.isValidTargetOf(this._gmeNodeId,this.propertyName)),i},r.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._destroyDroppable(),this._isReadOnly!==!0&&this._makeDroppable()},r.prototype.updateDisplay=function(){var e,n=this.propertyValue,i=this;return this._updatePointerName(),n&&"_nullptr"!==n&&(this._removeTerritory(),this._territoryId=this._client.addUI(this,function(){i._updatePointerName()}),e={},e[n]={children:0},this._client.updateTerritory(this._territoryId,e)),t.prototype.updateDisplay.call(this)},r.prototype.destroy=function(){this._removeTerritory()},r.prototype._removeTerritory=function(){this._territoryId&&this._client.removeUI(this._territoryId)},r.prototype._updatePointerName=function(){var t,n,i=this.propertyValue;"_nullptr"===i?(t="NULL",i="Null-pointer",this.__label.removeClass("btn btn-micro btn-follow-pointer")):i?(n=this._client.getNode(i),n&&(t=e.resolve(n),(""===t||this.USE_ACTUAL_POINTER_NAME===!0)&&(t=n.getFullyQualifiedName()),i="Follow Pointer: ["+i+"]"),this.__label.addClass("btn btn-micro btn-follow-pointer")):this.__label.removeClass("btn btn-micro btn-follow-pointer"),this.__label.text(t),this.__label.attr("title",i)},r.prototype._followPointer=function(){var t,e=this.propertyValue,n=this._client;e&&"_nullptr"!==e&&(t=n.getNode(e),t&&(WebGMEGlobal.State.registerActiveObject(e),WebGMEGlobal.State.registerActiveSelection([])))},r.prototype.destroy=function(){this._removeTerritory(),this.__iconAssignNullPointer&&this.__iconAssignNullPointer.off("click"),this.__label.off("click"),t.prototype.destroy.call(this)},r}),define("js/Controls/PropertyGrid/Widgets/MetaTypeWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","./PointerWidget"],function(t,e){"use strict";var n;return n=function(e){var n,i,o=this;this._gmeNodeId=null,this.USE_ACTUAL_POINTER_NAME=!0,t.call(this,e),i=WebGMEGlobal.State.getActiveSelection(),n=WebGMEGlobal.State.getActiveObject(),i&&i.length>0?1===i.length&&(this._gmeNodeId=i[0]):n&&(this._gmeNodeId=n),this._client=e.client,this._div=$("<div/>",{"class":"ptr-widget"}),this.el.append(this._div),this.__label=$("<span/>",{"class":"user-select-on"}),this._div.append(this.__label),this.__label.on("click",function(t){t.stopPropagation(),t.preventDefault(),o._followPointer()}),this.updateDisplay()},_.extend(n.prototype,e.prototype),n.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e)},n}),define("css!js/Controls/PropertyGrid/Widgets/styles/MultiSelectWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/MultiSelectWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","bootstrap-multiselect","css!./styles/MultiSelectWidget.css"],function(t){"use strict";function e(e){var i,o,r,s,a=this;for(t.call(this,e),this.el.addClass("multiselect-widget"),this._select=n.clone(),this._wasChanged=!1,i=e.value.split(" "),s=0;s<i.length;s+=1)o=i[s],o&&-1===e.valueItems.indexOf(o)&&(r||(r=$("<optgroup/>",{label:"Unavailable"}),a._select.append(r)),r.append($("<option/>",{text:o,value:o,selected:"selected"})));for(r?(r=$("<optgroup/>",{label:"Available"}),a._select.append(r)):r=a._select,s=0;s<e.valueItems.length;s+=1)o=e.valueItems[s],-1===i.indexOf(o)?r.append($("<option/>",{text:o,value:o})):r.append($("<option/>",{text:o,value:o,selected:"selected"}));this.el.append(this._select),this._select.multiselect({onDropdownHide:function(){a._onBlur()},onChange:function(){a._onChange()},buttonClass:"btn btn-link",disableIfEmpty:!0,disabledText:"None available ..."}),this._dropDownMenu=this.el.find(".multiselect-container.dropdown-menu"),this._dropDownMenu.on("mouseleave",function(){a._onBlur()})}var n=$("<select/>",{multiple:"multiple"});return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype._onChange=function(){this._wasChanged=!0},e.prototype._onBlur=function(){var t;this._wasChanged===!0&&(this._wasChanged=!1,t=this._select.val()?this._select.val().join(" "):"",this.setValue(t),this.fireFinishChange())},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),this._isReadOnly===!0?this._select.multiselect("disable"):this._select.multiselect("enable")},e.prototype.destroy=function(){this._dropDownMenu.off("mouseleave"),t.prototype.destroy.call(this)},e}),define("css!js/Controls/PropertyGrid/Widgets/styles/SvgSelectWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/SvgSelectWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","css!./styles/SvgSelectWidget.css"],function(t){"use strict";var e;return e=function(e){var n,i,o,r=this;t.call(this,e),r._items=e.items,r._dropDownItems=[],r._value=e.value,r._dropDown=$('<div class="btn-group"></div>'),r._dropDownButton=$('<button type="button" class="multiselect dropdown-toggle btn btn-link" data-toggle="dropdown" aria-expanded="true"></button>'),r._dropDownList=$('<ul class="svgselect-container dropdown-menu"></ul>'),r._dropDown.append(r._dropDownButton),r._dropDown.append(r._dropDownList),r._dropDownButton.html("<span>"+r._items[r._value]+"</span>"),o=function(t){r.setValue($(t.currentTarget).attr("data-value")),r.fireFinishChange()};for(n in r._items)i=$('<li data-value="'+n+'"><a href="#">'+r._items[n]+"</a></li>"),i.on("click",o),r._dropDownItems.push(i),r._dropDownList.append(i);this.updateDisplay(),this.el.addClass("svgselect-widget"),this.el.append(r._dropDown)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.updateDisplay=function(){return t.prototype.updateDisplay.call(this)},e.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),$(this._dropDownButton).disable(e)},e.prototype.destroy=function(){var e;for(e=0;e<this._dropDownItems.length;e+=1)this._dropDownItems[e].off("click");t.prototype.destroy.call(this)},e}),define("js/Controls/PropertyGrid/PropertyGridWidgets",[],function(){"use strict";return{DIALOG_WIDGET:"DIALOG_WIDGET",ASSET_WIDGET:"ASSET_WIDGET",POINTER_WIDGET:"POINTER_WIDGET",META_TYPE_WIDGET:"META_TYPE_WIDGET",MULTI_SELECT_WIDGET:"MULTI_SELECT_WIDGET",COLOR_PICKER:"COLOR_PICKER",SVG_SELECT:"SVG_SELECT"}}),define("js/Controls/PropertyGrid/PropertyGridWidgetManager",["js/Controls/PropertyGrid/Widgets/StringWidget","js/Controls/PropertyGrid/Widgets/NumberBoxWidget","js/Controls/PropertyGrid/Widgets/BooleanWidget","js/Controls/PropertyGrid/Widgets/LabelWidget","js/Controls/PropertyGrid/Widgets/iCheckBoxWidget","js/Controls/PropertyGrid/Widgets/OptionWidget","js/Controls/PropertyGrid/Widgets/ColorPickerWidget","js/Utils/ColorUtil","js/Controls/PropertyGrid/Widgets/DialogWidget","js/Controls/PropertyGrid/Widgets/AssetWidget","js/Controls/PropertyGrid/Widgets/FloatWidget","js/Controls/PropertyGrid/Widgets/IntegerWidget","js/Controls/PropertyGrid/Widgets/PointerWidget","js/Controls/PropertyGrid/Widgets/MetaTypeWidget","js/Controls/PropertyGrid/Widgets/MultiSelectWidget","js/Controls/PropertyGrid/Widgets/SvgSelectWidget","./PropertyGridWidgets"],function(t,e,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m){"use strict";var b;return b=function(){this._registeredWidgets={}},b.prototype.getWidgetForProperty=function(o){var b,y=o.valueType||typeof o.value,v=o.readOnly===!0,C=_.isArray(o.valueItems),E=a.isColor(o.value),D=o.widget;if(v&&"boolean"!==y)b=new i(o);else if(D)switch(D){case m.DIALOG_WIDGET:b=new l(o);break;case m.META_TYPE_WIDGET:b=new g(o);break;case m.POINTER_WIDGET:b=new p(o);break;case m.MULTI_SELECT_WIDGET:b=new u(o);break;case m.COLOR_PICKER:b=new s(o);break;case m.SVG_SELECT:b=new f(o);break;default:b=new D(o)}else b=C?new r(o):E?new s(o):"asset"===y?new c(o):"float"===y?new d(o):"integer"===y?new h(o):this._registeredWidgets[y]?new this._registeredWidgets[y](o):"number"===y?new e(o):"boolean"===y?new n(o):new t(o);return b.setReadOnly(v),b},b.prototype.registerWidgetForType=function(t,e){if("string"==typeof e)switch(e){case"iCheckBox":this.registerWidgetForType(t,o)}else this._registeredWidgets[t]=e},b}),define("text!js/Dialogs/PluginConfig/templates/PluginConfigDialog.html",[],function(){return'<div class="plugin-config-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3 class="modal-title"></h3>\n            </div>\n            <div class="modal-body">\n            </div>\n            <div class="modal-footer">\n                <form>\n                    <label class="save-configuration pull-left">\n                        <input type="checkbox"> Save these settings in the current user\n                    </label>\n                </form>\n                <a href="#" class="btn btn-save btn-primary">Save &amp; Run...</a>\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/PluginConfig/styles/PluginConfigDialog",[],function(){}),define("js/Dialogs/PluginConfig/PluginConfigDialog",["js/Controls/PropertyGrid/PropertyGridWidgetManager","text!./templates/PluginConfigDialog.html","css!./styles/PluginConfigDialog.css"],function(t,e){"use strict";var n,i="plugin",o="attribute",r=$('<div><fieldset><form class="form-horizontal" role="form"></form><fieldset></div>'),s=$('<div class="form-group"><div class="row"><label class="col-sm-4 control-label">NAME</label><div class="col-sm-8 controls"></div></div><div class="row description"><div class="col-sm-4"></div></div></div>'),a=$('<div class="desc muted col-sm-8"></div>');return n=function(e){this._propertyGridWidgetManager=new t,this._propertyGridWidgetManager.registerWidgetForType("boolean","iCheckBox"),this._pluginWidgets={},this._globalWidgets={},this._globalConfig=null,this._pluginConfig=null,this._client=e.client},n.prototype.show=function(t,e,n,i){var o=this;this._globalOptions=t,this._pluginMetadata=e,this._prevConfg=n||{},this._initDialog(),this._dialog.on("hidden.bs.modal",function(){var t=o._saveConfigurationCb.find("input").is(":checked");o._dialog.remove(),o._dialog.empty(),o._dialog=void 0,i&&(o._globalConfig&&o._pluginConfig?i(o._globalConfig,o._pluginConfig,t):i(!1))}),this._dialog.on("shown",function(){o._dialog.find("input").first().focus()}),this._dialog.modal("show")},n.prototype._closeAndSave=function(){var t=this._dialog.find("input:invalid"),e=this;0===t.length?(e._pluginConfig={},e._globalConfig={},Object.keys(e._pluginWidgets).forEach(function(t){e._pluginConfig[t]=e._pluginWidgets[t].getValue()}),Object.keys(e._globalWidgets).forEach(function(t){e._globalConfig[t]=e._globalWidgets[t].getValue()}),this._dialog.modal("hide")):$(t[0]).focus()},n.prototype._initDialog=function(){var t,n=this;this._dialog=$(e),this._btnSave=this._dialog.find(".btn-save"),this._divContainer=this._dialog.find(".modal-body"),this._saveConfigurationCb=this._dialog.find(".save-configuration"),this._modalHeader=this._dialog.find(".modal-header"),this._pluginMetadata.icon?(this._pluginMetadata.icon.src?(t=$("<img>",{"class":this._pluginMetadata.icon["class"],src:["/plugin",this._pluginMetadata.id,this._pluginMetadata.id,this._pluginMetadata.icon.src].join("/")}),this._modalHeader.prepend()):t=$("<i/>",{"class":this._pluginMetadata.icon["class"]||"glyphicon glyphicon-cog"}),t.addClass("plugin-icon pull-left")):t=$('<i class="plugin-icon pull-left glyphicon glyphicon-cog"/>'),this._modalHeader.prepend(t),this._title=this._modalHeader.find(".modal-title"),this._title.text(this._pluginMetadata.id+" v"+this._pluginMetadata.version),this._generateConfigSection(!0),this._divContainer.append($('<hr class="global-and-plugin-divider">')),this._generateConfigSection(),this._btnSave.on("click",function(t){n._closeAndSave(),t.stopPropagation(),t.preventDefault()}),this._dialog.on("keydown.PluginConfigDialog",function(t){13===t.keyCode&&(t.ctrlKey||t.metaKey)&&(t.stopPropagation(),t.preventDefault(),n._closeAndSave())})},n.prototype._generateConfigSection=function(t){var e,n,l,c,d,h,p=t?this._globalOptions.length:this._pluginMetadata.configStructure.length,g=r.clone();for(t?g.data(i,"Global Options"):g.data(i,this._pluginMetadata.id),this._divContainer.append(g),h=g.find(".form-horizontal"),e=0;p>e;e+=1)l=t?this._globalOptions[e]:this._pluginMetadata.configStructure[e],d=void 0,l=JSON.parse(JSON.stringify(l)),!t&&this._prevConfg.hasOwnProperty(l.name)&&(l.value=this._prevConfg[l.name]),this._client.getProjectAccess().write===!1&&l.writeAccessRequired===!0&&(l.readOnly=!0),c=this._propertyGridWidgetManager.getWidgetForProperty(l),t?this._globalWidgets[l.name]=c:this._pluginWidgets[l.name]=c,n=s.clone(),n.data(o,l.name),n.find("label.control-label").text(l.displayName),l.description&&""!==l.description&&(d=d||a.clone(),d.text(l.description)),void 0!==l.minValue&&null!==l.minValue&&""!==l.minValue&&(d=d||a.clone(),d.append(" The minimum value is: "+l.minValue+".")),void 0!==l.maxValue&&null!==l.maxValue&&""!==l.maxValue&&(d=d||a.clone(),d.append(" The maximum value is: "+l.maxValue+".")),t&&"runOnServer"===l.name&&l.readOnly===!0?(d.css({color:"grey","padding-top":"7px","padding-left":"0px","font-style":"italic"}),n.find(".controls").append(d)):(n.find(".controls").append(c.el),d&&n.find(".description").append(d)),h.append(n)},n.prototype._readConfig=function(){var t,e,n={};for(t in this._widgets)if(this._widgets.hasOwnProperty(t))for(e in this._widgets[t])this._widgets[t].hasOwnProperty(e)&&(n[t]=n[t]||{},n[t][e]=this._widgets[t][e].getValue());return n},n}),define("common/util/util",[],function(){"use strict";function t(t){return"object"==typeof t&&null!==t&&t instanceof Array==!1}function e(n,i){var o,r=Object.keys(i);for(o=0;o<r.length;o+=1)t(i[r[o]])&&t(n[r[o]])?e(n[r[o]],i[r[o]]):n[r[o]]=i[r[o]]}function n(t){var e,n,i,o=[];for(e=0;e<t.length;e+=1){for(i=-1,n=0;-1===i&&n<o.length;)o[n].length>t[e].length&&(i=n),n+=1;-1===i?o.push(t[e]):o.splice(i,0,t[e])}return o}function i(t,e,n){for(var i=t.length>n?n:t.length;i--;)if(t[i]===e)return i;return-1}function o(t,e,n,i){for(var o=t.length>n?n:t.length;o--;)if(t[o][i]===e[i])return o;return-1}function r(t,e){for(var n,o=t.length,r=e.length;r--;)n=e[r],-1===i(t,n,o)&&t.push(n)}function s(t,e,n){for(var i,r=t.length,s=e.length;s--;)i=e[s],-1===o(t,i,r,n)&&t.push(i)}return{isTrueObject:t,updateFieldsRec:e,orderStringArrayByElementLength:n,extendArrayUnique:r,extendObjectArrayUnique:s}}),define("js/Utils/ComponentSettings",["common/util/util","superagent"],function(t,e){"use strict";function n(e,n,i){return n&&"object"==typeof n&&t.updateFieldsRec(e,n),i&&"object"==typeof i&&t.updateFieldsRec(e,i),e}function i(t,e){var i,o;if("undefined"==typeof WebGMEGlobal)throw new Error("WebGMEGlobal must be defined for this function, use resolveSettings");return i=WebGMEGlobal.componentSettings&&WebGMEGlobal.componentSettings[e],o=WebGMEGlobal.userInfo&&WebGMEGlobal.userInfo.settings&&WebGMEGlobal.userInfo.settings[e],n(t,i,o)}function o(t,n,i){e.patch("api/user/settings/"+t).send(n).end(function(t,e){return t||200!==e.status?void i(t||new Error("Did not return status 200: "+e.status)):void i(null,e.body)})}function r(t,n,i){e.put("api/user/settings/"+t).send(n).end(function(t,e){return t||200!==e.status?void i(t||new Error("Did not return status 200: "+e.status)):void i(null,e.body)})}return{resolveSettings:n,resolveWithWebGMEGlobal:i,updateComponentSettings:o,overwriteComponentSettings:r}}),define("js/Utils/InterpreterManager",["plugin/PluginResult","plugin/PluginMessage","js/Dialogs/PluginConfig/PluginConfigDialog","js/logger","js/Utils/ComponentSettings"],function(t,e,n,i,o){"use strict";var r=function(t,e){this._client=t,this.gmeConfig=e,this._savedConfigs={},this.logger=i.create("gme:InterpreterManager",e.client.log),this.logger.debug("InterpreterManager ctor")};return r.prototype.GLOBAL_OPTIONS="Global Options",r.prototype.getPluginErrorResult=function(n,i,o,r,s){var a=new t,l=new e;return l.severity="error",l.message=o,a.setSuccess(!1),a.setPluginId(n),a.setPluginName(i),a.setProjectId(s||this._client.getActiveProjectId()||"N/A"),a.addMessage(l),a.setStartTime(r),a.setFinishTime((new Date).toISOString()),a.setError(l.message),a},r.prototype.loadConfigDialog=function(t,e){t.configWidget?requirejs([t.configWidget],function(t){e(null,t)},function(t){e(t)}):e(null,n)},r.prototype.configureAndRun=function(e,n){var i,o=this,r=o._client.getCurrentPluginContext(e.id),s=this.getGlobalOptions(e,{namespace:r.managerConfig.namespace});return s instanceof t?void n(s):void o.loadConfigDialog(e,function(a,l){return a||!l?void n(o.getPluginErrorResult(e.id,e.name,a?a.message:"Could not load configuration dialog.",(new Date).toISOString(),r.managerConfig.project.projectId)):(i=new l({client:o._client,logger:o.logger}),void i.show(s,e,o.getStoredConfiguration(e),function(i,s,a){function l(i,s){i?(o.logger.error(i),n(s?new t(s):o.getPluginErrorResult(e.id,e.name,i.message,c,r.managerConfig.project.projectId))):n(new t(s))}var c=(new Date).toISOString();if(i===!1)return void n(!1);o._savedConfigs[e.id]=s,a===!0&&o.saveSettingsInUser(e,s),r.pluginConfig=s,r.managerConfig.namespace=i.namespace;var d=!i.runOnServer&&!e.writeAccessRequired,h=o._client.getBranchStatus()&&o._client.getBranchStatus()!==o._client.CONSTANTS.BRANCH_STATUS.SYNC;return!d&&h?void n(o.getPluginErrorResult(e.id,e.name,"Not allowed to invoke server plugin while local branch is AHEAD or PULLING changes from server.",c)):void(i.runOnServer===!0?o._client.runServerPlugin(e.id,r,l):o._client.runBrowserPlugin(e.id,r,l))}))})},r.prototype.getGlobalOptions=function(t,e){var n,i={name:"runOnServer",displayName:"Execute on Server",description:"",value:e.hasOwnProperty("runOnServer")?e.runOnServer:!1,valueType:"boolean",readOnly:!1},o={name:"namespace",displayName:"Used Namespace",description:"The namespace the plugin should run under.",value:e.hasOwnProperty("namespace")?e.namespace:"",valueType:"string",valueItems:[],readOnly:!1},r=[],s=this.gmeConfig.plugin.allowServerExecution===!0,a=!t.disableServerSideExecution,l=this.gmeConfig.plugin.allowBrowserExecution===!0,c=!t.disableBrowserSideExecution;return s===!1&&l===!1?n="Plugin execution is disabled!":a===!1&&c===!1?n="This plugin cannot run on the server nor in the browser!?":l?s?c?a||(i.readOnly=!0,i.description="This plugin can not run on the server."):(i.readOnly=!0,i.value=!0,i.description="This plugin can not run in the browser."):c?(i.readOnly=!0,i.description="Server execution is disabled."):n="This plugin can only run on the server which is disabled!":c?(i.readOnly=!0,i.value=!0,i.description="Browser execution is disabled."):n="This plugin can only run on the server which is disabled!",n?this.getPluginErrorResult(t.id,t.name,n,(new Date).toISOString()):(r.push(i),o.valueItems=this._client.getLibraryNames(),o.valueItems.length>0&&(o.valueItems.unshift(""),r.push(o)),r)},r.prototype.getStoredConfiguration=function(t){var e,n=this.getPluginComponentId(t);return this._savedConfigs.hasOwnProperty(t.id)?e=this._savedConfigs[t.id]:"undefined"!=typeof WebGMEGlobal&&(e={},o.resolveWithWebGMEGlobal(e,n)),e},r.prototype.saveSettingsInUser=function(t,e,n){var i=this,r=this.getPluginComponentId(t.id);this.logger.debug("Saving plugin config in user",r,e),o.overwriteComponentSettings(r,e,function(t,e){n?t?n(t):n(null,e):t?i.logger.error(new Error("Failed storing settings for user"),t):i.logger.debug("Stored new settings for plugin at",r,e)})},r.prototype.getPluginComponentId=function(t){var e="Plugin_"+t.id+"__"+t.version.split(".").join("_");return this.logger.debug('Resolved componentId for plugin "'+e+'"'),e},r}),define("js/WebGME",["js/logger","js/client","js/Constants","js/Panels/MetaEditor/MetaEditorConstants","js/Utils/GMEConcepts","js/Utils/GMEVisualConcepts","js/Utils/StateManager","js/Utils/WebGMEUrlManager","js/LayoutManager/LayoutManager","js/Decorators/DecoratorManager","js/KeyboardManager/KeyboardManager","js/PanelManager/PanelManager","./WebGME.History","js/Utils/PreferencesHelper","js/Dialogs/Projects/ProjectsDialog","js/Utils/InterpreterManager","js/Utils/ComponentSettings","common/storage/util","q","jquery"],function(t,e,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m,b,y){"use strict";function v(i){function v(t){var e=t.splice(0,1)[0];w.loadPanel(e,function(){t.length>0?v(t):(_.isFunction(i)&&i(N),N.connectToDatabase(function(t){return t?void R.error("Failed to connect to database",t):void(M.createNewProject?T():M.projectToLoad?D():I(!1))}))})}function D(){y.nfcall(N.selectProject,M.projectToLoad,void 0).then(function(){return M.branchToLoad?y.nfcall(N.getBranches,M.projectToLoad):{}}).then(function(t){return M.commitToLoad?y.nfcall(N.selectCommit,M.commitToLoad):M.branchToLoad&&t[M.branchToLoad]?y.nfcall(N.selectBranch,M.branchToLoad,null):void 0}).then(function(){P(M.objectToLoad,M.activeSelectionToLoad,M.visualizerToLoad,M.tabToSelect)})["catch"](function(t){R.error("error during startup",t),I(!1)})}function I(t){L=!1,R.info("init-phase false"),R.info("about to open projectOpenDialog, connect:",t),t?N.connectToDatabase(function(t){return t?void R.error("Failed to connect to database",t):void(k.disableProjectsDialog===!1?(O=new u(N),O.show()):A())}):k.disableProjectsDialog===!1?(O=new u(N),O.show()):A()}function P(t,e,i,o){function r(t){var r,a,l,d={},h={};if(R.debug("events from selectObject",t),"complete"!==t[0].etype)return void R.warn("partial events only");for(R.debug('active "'+c+'" node loaded'),r=0;r<t.length;r+=1)if(t[r].eid===c&&(a=N.getNode(c))){d[n.STATE_ACTIVE_OBJECT]=c,e=e||[],e.length>0&&(d[n.STATE_ACTIVE_SELECTION]=e),i&&(d[n.STATE_ACTIVE_VISUALIZER]=i,h.suppressVisualizerFromNode=!0,o=parseInt(o,10),o>=0&&(d[n.STATE_ACTIVE_TAB]=o,"ModelEditor"===i&&(l=a.getValidAspectNames(),l.sort(function(t,e){var n=t.toLowerCase(),i=e.toLowerCase();return i>n?-1:1}),l.unshift("All"),d[n.STATE_ACTIVE_ASPECT]=l[o]||"All"))),WebGMEGlobal.State.set(d,h);break}N.removeUI(s)}var s,a={},l={},c="root"===t?n.PROJECT_ROOT_ID:t;l[c]={children:0},R.debug("selectObject",t),R.debug("activeSelectionToLoad",e),e&&e.length>0?l[c]={children:1}:l[c]={children:0},s=N.addUI(a,r),N.updateTerritory(s,l)}function T(){y.nfcall(N.getProjects,{}).then(function(t){var e,n=y.defer(),i=!1,o=WebGMEGlobal.userInfo._id,r=o+N.CONSTANTS.STORAGE.PROJECT_ID_SEP+M.projectToLoad;for(e=0;e<t.length;e+=1)if(t[e]._id===r){i=!0;break}return i?(y.nfcall(N.selectProject,r,void 0).then(function(){return y.nfcall(N.getBranches,r)}).then(n.resolve)["catch"](n.reject),n.promise):(y.nfcall(N.seedProject,{type:"file",projectName:M.projectToLoad,seedName:WebGMEGlobal.gmeConfig.seedProjects.defaultProject}).then(function(){return y.nfcall(N.selectProject,r,void 0)}).then(function(){return y.nfcall(N.getBranches,r)}).then(n.resolve)["catch"](n.reject),n.promise)}).then(function(t){return M.commitToLoad?y.nfcall(N.selectCommit,M.commitToLoad):M.branchToLoad&&t[M.branchToLoad]?y.nfcall(N.selectBranch,M.branchToLoad,null):void 0}).then(function(){P(M.objectToLoad,M.activeSelectionToLoad,M.visualizerToLoad,M.tabToSelect)})["catch"](function(t){R.error("error during startup",t),I(!1)})}function A(){$('<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog" style="margin-top: 200px;"><div class="modal-content" style="background: none; border: none;"><h1 style="text-align: center;">No project opened ...</h1></div></div></div>').modal("show")}function x(t){function e(e){var i,o;for(i=0;i<e.length;i+=1)if(e[i].eid===t&&(o=N.getNode(t))){WebGMEGlobal.State.registerActiveObject(t);break}N.removeUI(n)}var n,i={};i[t]={children:0},n=N.addUI(null,e),N.updateTerritory(n,i)}var w,N,O,S=WebGMEGlobal.gmeConfig,R=t.create("gme:WebGME",WebGMEGlobal.gmeConfig.client.log),M=a.parseInitialThingsToDoFromUrl(),L=!0,k=E;m.resolveWithWebGMEGlobal(k,C),(M.projectToLoad||M.createNewProject)===!1&&(M.projectToLoad=k.initialContext.project,M.branchToLoad=M.branchToLoad||k.initialContext.branch,M.objectToLoad=M.objectToLoad||k.initialContext.node||M.objectToLoad),w=new l,w.loadLayout(M.layoutToLoad,function(){var t,i,a=[],l=w._currentLayout.panels,u=l?l.length:0;N=new e(S),WebGMEGlobal.Client=N,WebGMEGlobal.InterpreterManager=new f(N,S),Object.defineProperty(WebGMEGlobal,"State",{value:s.initialize(),writable:!1,enumerable:!0,configurable:!1}),N.registerUIStateGetter(function(){return WebGMEGlobal.State.toJSON()}),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_OBJECT,function(){N.emitStateNotification()}),WebGMEGlobal.State.registerLayout(M.layoutToLoad,{suppressHistoryUpdate:!0}),document.title=k.pageTitle,R.info("init-phase true"),p.initialize(),o.initialize(N),r.initialize(N),g.initialize(N),N.addEventListener(N.CONSTANTS.BRANCH_CHANGED,function(t,e){w.setPanelReadOnly(N.isCommitReadOnly()||N.isProjectReadOnly()),e?WebGMEGlobal.State.registerActiveBranchName(e):N.getActiveCommitHash()?WebGMEGlobal.State.registerActiveCommit(N.getActiveCommitHash()):WebGMEGlobal.State.registerActiveBranchName(null)}),N.addEventListener(N.CONSTANTS.PROJECT_OPENED,function(t,e){var i,o;document.title=WebGMEGlobal.gmeConfig.authentication.enable?b.getProjectDisplayedNameFromProjectId(e):b.getProjectNameFromProjectId(e),w.setPanelReadOnly(N.isProjectReadOnly()),WebGMEGlobal.State.registerActiveProjectName(e),L===!1&&(i=N.getActiveProjectName(),o=k.byProjectId.nodeAtOpen.hasOwnProperty(e)?k.byProjectId.nodeAtOpen[e]:k.byProjectName.nodeAtOpen.hasOwnProperty(i)?k.byProjectName.nodeAtOpen[i]:k.nodeAtOpen,x(o?o:n.PROJECT_ROOT_ID))}),N.addEventListener(N.CONSTANTS.PROJECT_CLOSED,function(){document.title=k.pageTitle,L=!1,WebGMEGlobal.State.clear()}),N.decoratorManager=new c,t=S.visualization.decoratorsToPreload||WebGMEGlobal.allDecorators||[],N.decoratorManager.downloadAll(t,function(t){for(t&&R.error(t),i=0;u>i;i+=1)a.push({panel:l[i].panel,container:l[i].container,control:l[i].control,params:{client:N}});v(a),WebGMEGlobal.KeyboardManager=d,WebGMEGlobal.KeyboardManager.setEnabled(!0),WebGMEGlobal.PanelManager=new h(N)})})}var C="GenericUIWebGMEStart",E={pageTitle:"WebGME",disableProjectsDialog:!1,initialContext:{project:null,branch:null,node:null},nodeAtOpen:"",byProjectName:{nodeAtOpen:{}},byProjectId:{nodeAtOpen:{}}};return{start:v}}),define("text!js/Layouts/DefaultLayout/templates/DefaultLayout.html",[],function(){return'<div class="ui-layout-center"></div>\n<div class="ui-layout-east side-panel no-print"></div>\n<div class="ui-layout-west side-panel no-print"></div>\n<div class="ui-layout-north no-print"></div>\n<div class="ui-layout-south no-print"></div>\n'}),define("text!js/Layouts/DefaultLayout/DefaultLayoutConfig.json",[],function(){return'{\n  "panels": [\n    {\n      "id": "Header",\n      "panel": "Header/HeaderPanel",\n      "container": "header",\n      "DEBUG_ONLY": false\n    },\n    {\n      "id": "Footer",\n      "panel": "FooterControls/FooterControlsPanel",\n      "container": "footer",\n      "DEBUG_ONLY": false\n    },\n    {\n      "id": "ObjectBrowserPanel",\n      "panel": "ObjectBrowser/ObjectBrowserPanel",\n      "container": "east",\n      "DEBUG_ONLY": false\n    },\n    {\n      "id": "VisualizerPanel",\n      "panel": "Visualizer/VisualizerPanel",\n      "container": "west",\n      "DEBUG_ONLY": false\n    },\n    {\n      "id": "PartBrowserPanel",\n      "panel": "PartBrowser/PartBrowserPanel",\n      "container": "west",\n      "DEBUG_ONLY": false\n    },\n    {\n      "id": "PropertyEditorPanel",\n      "panel": "PropertyEditor/PropertyEditorPanel",\n      "container": "east",\n      "DEBUG_ONLY": false\n    }\n  ]\n}\n'}),define("js/Layouts/DefaultLayout/DefaultLayout",["jquery-layout","js/logger","js/Utils/ComponentSettings","text!./templates/DefaultLayout.html","text!./DefaultLayoutConfig.json"],function(t,e,n,i,o){"use strict";var r,s=10,a=10,l=3,c=6,d=WebGMEGlobal.SUPPORTS_TOUCH?s:l,h=WebGMEGlobal.SUPPORTS_TOUCH?a:c,p=210;return r=function(t){this._logger=t&&t.logger||e.create("gme:Layouts:DefaultLayout",WebGMEGlobal.gmeConfig.client.log),this._config=r.getDefaultConfig(),n.resolveWithWebGMEGlobal(this._config,r.getComponentId()),this._logger.debug("Resolved component-settings",this._config),this.panels=t&&t.panels||this._config.panels,this._template=t&&t.template||i},r.getComponentId=function(){return"GenericUIDefaultLayout"},r.getDefaultConfig=function(){return JSON.parse(o)},r.prototype.init=function(){var t=this;this._body=$("body"),this._body.html(this._template),this._westPanel=this._body.find("div.ui-layout-west"),this._centerPanel=this._body.find("div.ui-layout-center"),this._eastPanel=this._body.find("div.ui-layout-east"),this._headerPanel=this._body.find("div.ui-layout-north"),this._footerPanel=this._body.find("div.ui-layout-south"),this._eastPanels=[],this._westPanels=[],this._centerPanels=[],this._body.layout({defaults:{},north:{closable:!1,resizable:!1,slidable:!1,spacing_open:0,size:64},south:{closable:!1,resizable:!1,slidable:!1,spacing_open:0,size:27},east:{size:p,minSize:p,resizable:!0,slidable:!1,spacing_open:d,spacing_closed:h,onresize:function(){t._onEastResize()}},west:{size:p,minSize:p,showOverflowOnHover:!0,resizable:!0,slidable:!1,spacing_open:d,spacing_closed:h,onresize:function(){t._onWestResize()}},center:{onresize:function(){t._onCenterResize()}}})},r.prototype.addToContainer=function(t,e){if("header"===e)this._headerPanel.append(t.$pEl);else if("footer"===e)this._footerPanel.append(t.$pEl);else{if("west"===e)return this._westPanel.append(t.$pEl),this._westPanels.push(t),this._onWestResize(),this._onWestResize;if("east"===e)return this._eastPanel.append(t.$pEl),this._eastPanels.push(t),this._onEastResize(),this._onEastResize;if("center"===e)return this._centerPanel.append(t.$pEl),this._centerPanels.push(t),this._onCenterResize(),this._onCenterResize}},r.prototype.remove=function(t){var e;e=this._eastPanels.indexOf(t),-1===e?(e=this._westPanels.indexOf(t),-1===e?(e=this._centerPanels.indexOf(t),-1===e?this._logger.warn("Panel to be removed not found"):(this._centerPanels.splice(e,1),this._onCenterResize())):this._westPanels.splice(e,1)):(this._eastPanels.splice(e,1),this._onEastResize())},r.prototype.destroy=function(){this._body.empty()},r.prototype._onCenterResize=function(){var t,e=this._centerPanels.length,n=this._centerPanel.width(),i=this._centerPanel.height(),o=Math.floor(i/e);for(t=0;e>t;t+=1)this._centerPanels[t].setSize(n,o)},r.prototype._onEastResize=function(){var t,e=this._eastPanels.length,n=this._eastPanel.width(),i=this._eastPanel.height(),o=Math.floor(i/e);for(t=0;e>t;t+=1)this._eastPanels[t].setSize(n,o)},r.prototype._onWestResize=function(){
var t,e=this._westPanels.length,n=this._westPanel.width(),i=this._westPanel.height();2===e&&(t=this._westPanels[0].$pEl.outerHeight(!0),this._westPanels[1].setSize(n,i-t))},r}),define("js/PanelBase/PanelBase",["jquery","js/logger"],function(t,e){"use strict";var n;return n=function(t){var i="gme:PanelBase:PanelBase";t&&t[n.OPTIONS.LOGGER_INSTANCE_NAME]&&(i="gme:"+t[n.OPTIONS.LOGGER_INSTANCE_NAME]),this.logger=e.create(i,WebGMEGlobal.gmeConfig.client.log),this.$pEl=this.$el=$("<div/>"),this._isReadOnly=!1},n.OPTIONS={LOGGER_INSTANCE_NAME:"LOGGER_INSTANCE_NAME"},n.READ_ONLY_CLASS="read-only",n.prototype.setReadOnly=function(t){this._isReadOnly!==t&&(this._isReadOnly=t,this.logger.debug('ReadOnly mode changed to "'+t+'"'),this.onReadOnlyChanged(this._isReadOnly))},n.prototype.isReadOnly=function(){return this._isReadOnly},n.prototype.onReadOnlyChanged=function(t){t===!0?this.$el.addClass(n.READ_ONLY_CLASS):this.$el.removeClass(n.READ_ONLY_CLASS)},n.prototype._getSize=function(){this.size={width:this.$el.outerWidth(!0),height:this.$el.outerHeight(!0)}},n.prototype.clear=function(){},n.prototype.destroy=function(){this.clear(),this.$el.remove()},n.prototype.setSize=function(t,e){this.size={width:t,height:e},this.onResize(this.size.width,this.size.height)},n.prototype.onResize=function(t,e){this.logger.debug("onResize --> width: "+t+", height: "+e)},n.prototype.afterAppend=function(){this.offset=this.$el.offset(),this._getSize()},n.prototype.setContainerUpdateFn=function(t,e){e?this.updateContainerSize=function(){e.call(t)}:this.updateContainerSize=function(){this.logger.warn("updateContainerSize not implemented for container in current-layout")}},n}),define("css!js/Widgets/ProjectTitle/styles/ProjectTitleWidget",[],function(){}),define("js/Widgets/ProjectTitle/ProjectTitleWidget",["js/logger","js/client/constants","css!./styles/ProjectTitleWidget.css"],function(t,e){"use strict";var n,i='<div class="project-title navbar-text"><span class="title">WebGME</span><span class="readOnlyInfo">[READ ONLY]</span></div>';return n=function(e,n){this._logger=t.create("gme:Widgets:ProjectTitle:ProjectTitleWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=e,this._initializeUI(),this._logger.debug("Created")},n.prototype._initializeUI=function(){var t=this;this._el.html(i),this._projectTitle=this._el.find(".title"),this._client.addEventListener(e.PROJECT_OPENED,function(){t._refresh()}),this._client.addEventListener(e.PROJECT_CLOSED,function(){t._refresh()}),this._client.addEventListener(e.BRANCH_CHANGED,function(){t._refresh()})},n.prototype._refresh=function(){var t=this._client,e=t.getActiveProjectId(),n=t.getActiveBranchName(),i=t.isProjectReadOnly()||t.isCommitReadOnly(),o=e+" @ "+n,r=o+(i?" [READ-ONLY]":"");this._projectTitle.text(o),document.title="-= "+r+" =- WebGME"},n}),define("js/Widgets/UserProfile/UserProfileWidget",["js/logger"],function(t){"use strict";var e,n='<i class="glyphicon glyphicon-user icon-white" title="Logged in as"></i> <a href="/profile/" target="_top" class="navbar-link" title="View profile">__USERNAME__</a> <a href="/logout" target="_top" class="navbar-link"><i class="glyphicon glyphicon-eject icon-white" title="Log out"></i></a>',i='<i class="glyphicon glyphicon-user" title="Not logged in"></i>';return e=function(e,n){this._logger=t.create("gme:Widgets:UserProfile:UserProfileWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=e,this._initializeUI(),this._logger.debug("Created")},e.prototype._initializeUI=function(){var t=i;t=n.replace("__USERNAME__",WebGMEGlobal.userInfo._id),t='<p class="navbar-text">'+t+"</p>",this._el.html(t)},e}),define("js/UIEvents",[],function(){"use strict";return{LOCATE_NODE:"LOCATE_NODE"}}),define("css!js/Widgets/ConnectedUsers/styles/ConnectedUsersWidget",[],function(){}),define("js/Widgets/ConnectedUsers/ConnectedUsersWidget",["js/logger","js/UIEvents","css!./styles/ConnectedUsersWidget.css","jquery"],function(t,e){"use strict";function n(e,n){var i=this;this.logger=t.create("gme:Widgets:ConnectedUsers:ConnectedUsersWidget",WebGMEGlobal.gmeConfig.client.log),this.client=n,this.$el=$("<div/>",{"class":"connected-users-widget"}),e.append(this.$el),this.rooms={},this.userId=WebGMEGlobal.userInfo._id,this.client.addEventListener(this.client.CONSTANTS.CONNECTED_USERS_CHANGED,function(t,e){i._userChanged(e)}),this.client.addEventListener(this.client.CONSTANTS.PROJECT_OPENED,function(){i._reinitialize()}),this.client.addEventListener(this.client.CONSTANTS.BRANCH_CHANGED,function(){i._reinitialize()}),this.logger.debug("ctor"),this._reinitialize()}var i=["default","primary","success","danger","info","warning"];return n.prototype._reinitialize=function(){var t,e=this.client.getActiveProjectId(),n=this.client.getActiveBranchName(),i=this;e&&n?(t=this._getBranchRoomName({projectId:e,branchName:n}),Object.keys(this.rooms).forEach(function(e){e!==t&&(Object.keys(i.rooms[e].users).forEach(function(t){i.rooms[e].users[t].$el.off("click"),i.rooms[e].users[t].$el.remove()}),delete i.rooms[e])})):(this.$el.empty(),this.rooms={})},n.prototype._userChanged=function(t){t.type===this.client.CONSTANTS.STORAGE.BRANCH_ROOM_SOCKETS?t.join===!0?(this.logger.debug("user joined branch-room",t),this._userJoined(t)):(this.logger.debug("user left branch-room",t),this._userLeft(t)):t.type===this.client.CONSTANTS.STORAGE.CLIENT_STATE_NOTIFICATION?(this.logger.debug("user updated its state",t),this._userUpdated(t)):this.logger.error(new Error("Unexpected event type "+t.type))},n.prototype._userJoined=function(t){var n,o,r=this._getBranchRoomName(t),s=this;return this.rooms[r]=this.rooms[r]||{users:{},colors:i.slice()},this.rooms[r].users.hasOwnProperty(t.userId)===!0?void this.logger.debug("New user was already added",t.userId):t.userId===this.userId?void this.logger.debug("New user was you",t.userId):(n=Math.floor(Math.random()*this.rooms[r].colors.length),o={userId:t.userId,color:this.rooms[r].colors[n],$el:$("<button/>",{"class":"user-badge btn btn-xs",title:t.userId,text:t.userId[0].toUpperCase()}),state:{}},o.$el.addClass("btn-"+o.color),o.$el.on("click",function(){"string"==typeof o.state.activeObject&&s.client.dispatchEvent(e.LOCATE_NODE,{nodeId:o.state.activeObject})}),this.rooms[r].colors.splice(n,1),0===this.rooms[r].colors.length&&(this.rooms[r].colors=i.slice()),this.rooms[r].users[t.userId]=o,void this.$el.append(o.$el.hide().fadeIn(3e3)))},n.prototype._userLeft=function(t){var e=this._getBranchRoomName(t),n=this.rooms[e]&&this.rooms[e].users[t.userId];return n?(n.$el.remove(),delete this.rooms[e].users[t.userId],void this.rooms[e].colors.push(n.color)):void this.logger.debug("Leaving user was already removed",t.userId)},n.prototype._userUpdated=function(t){var e,n=this._getBranchRoomName(t);return t.userId===this.userId?void this.logger.debug("Updating user was you",t.userId):(this._userJoined(t),e=this.rooms[n].users[t.userId],void(t.state&&e.state.activeObject!==t.state.activeObject&&(e.state.activeObject=t.state.activeObject,e.$el.prop("title",e.userId+"@"+e.state.activeObject))))},n.prototype._getBranchRoomName=function(t){return t.hasOwnProperty("projectId")!==!1&&t.hasOwnProperty("branchName")!==!1?t.projectId+this.client.CONSTANTS.STORAGE.ROOM_DIVIDER+t.branchName:void this.logger.error(new Error('EventData did not contain branch room info "'+t.projectId+'", "'+t.branchName+'"'))},n}),define("js/Toolbar/ButtonBase",[],function(){"use strict";function t(t){var e,n="btn btn-mini";return e=$("<a/>",{"class":n,href:"#",title:t.title}),t.data&&e.data(t.data),t.icon&&("string"==typeof t.icon?e.append($('<i class="'+t.icon+'"></i>')):e.append(t.icon)),t.text&&(t.icon&&e.append(" "),e.append(t.text)),t.clickFn&&e.on("click",function(n){e.hasClass("disabled")||t.clickFn.call(this,$(this).data()),t.clickFnEventCancel!==!1&&(n.stopPropagation(),n.preventDefault())}),e.enabled=function(t){t===!0?e.disable(!1):e.disable(!0)},e}return{createButton:t}}),define("js/Toolbar/ToolbarItemBase",[],function(){"use strict";var t;return t=function(){this._toolbar=void 0},t.prototype.show=function(){this.el&&this.el.show()},t.prototype.hide=function(){this.el&&this.el.hide()},t.prototype.enabled=function(){},t.prototype.destroy=function(){this.el&&(this.el.remove(),this.el.empty(),this.el=void 0)},t}),define("js/Toolbar/ToolbarButton",["./ButtonBase","./ToolbarItemBase"],function(t,e){"use strict";var n;return n=function(e){this.el=$('<div class="toolbar-button"></div>'),this._btn=t.createButton(e),this.el.append(this._btn)},_.extend(n.prototype,e.prototype),n.prototype.enabled=function(t){this._btn.enabled(t)},n}),define("js/Toolbar/ToolbarSeparator",["./ToolbarItemBase"],function(t){"use strict";var e,n=$('<div class="separator"></div>');return e=function(){this.el=n.clone()},_.extend(e.prototype,t.prototype),e}),define("js/Toolbar/ToolbarRadioButtonGroup",["./ButtonBase","./ToolbarItemBase"],function(t,e){"use strict";var n,i=$("<div/>",{"class":"btn-group"});return n=function(t){var e;this.el=e=i.clone(),t&&e.on("click",".btn",function(n){$(this).hasClass("disabled")||(e.find(".btn.active").removeClass("active"),$(this).addClass("active"),t.call(this,$(this).data())),n.stopPropagation(),n.preventDefault()})},_.extend(n.prototype,e.prototype),n.prototype.addButton=function(e){var n;return e.clickFn&&delete e.clickFn,n=t.createButton(e),this.el.append(n),0===this.el.find(".btn.active").length&&n.addClass("active"),e&&e.selected&&e.selected===!0&&(this.el.find(".btn.active").removeClass("active"),n.addClass("active")),n},n.prototype.enabled=function(t){t===!0?this.el.find(".btn").disable(!1):this.el.find(".btn").disable(!0)},n}),define("js/Toolbar/ToolbarToggleButton",["./ButtonBase","./ToolbarItemBase"],function(t,e){"use strict";var n,i=$('<div class="toolbar-button"></div>');return n=function(e){var n,o,r=e.clickFn;n=function(t){o.toggleClass("active"),r&&r.call(this,t,o.hasClass("active"))},e.clickFn=n,o=this._btn=t.createButton(e),this.el=i.clone(),this.el.append(this._btn)},_.extend(n.prototype,e.prototype),n.prototype.setToggled=function(t){this._btn.removeClass("active"),t===!0&&this._btn.addClass("active")},n.prototype.enabled=function(t){this._btn.enabled(t)},n}),define("js/Toolbar/ToolbarTextBox",["./ToolbarItemBase"],function(t){"use strict";var e,n=$('<div class="toolbar-input"></div>'),i=$("<div/>",{"class":"input-prepend"}),o=$("<input/>",{"class":"input-medium input-mini",type:"text"}),r=$("<span/>",{"class":"add-on add-on-mini"});return e=function(t){var e,s,a=i.clone(),l=o.clone();this.el=n.clone(),this._textBox=l,t&&t.label&&(e=r.clone(),e.text(t.label+": ")),t&&t.prependContent&&(e=r.clone(),e.html(t.prependContent)),t&&t.collapse&&l.addClass("no-focus-collapse"),e&&a.append(e),t&&t.placeholder&&l.attr("placeholder",t.placeholder),a.append(l),t&&t.textChangedFn&&l.on("keyup",function(){var e=$(this).val();e!==s&&(t.textChangedFn.call(this,s,e),s=e)}),l.on("keypress",function(e){var n;return 13===e.keyCode?(t&&t.onEnterFn&&(n=$(this).val(),t.onEnterFn.call(this,n)),!1):void 0}),this.el.append(a)},_.extend(e.prototype,t.prototype),e.prototype.enabled=function(t){t===!0?this._textBox.removeAttr("disabled"):this._textBox.attr("disabled","disabled")},e.prototype.setText=function(t){this._textBox.val(t)},e.prototype.getText=function(){return this._textBox.val()},e}),define("js/Toolbar/ToolbarLabel",["./ToolbarItemBase"],function(t){"use strict";var e,n=$('<div class="toolbar-label"></div>');return e=function(){this.el=n.clone()},_.extend(e.prototype,t.prototype),e.prototype.text=function(t,e){this.el&&(this.el.text(t),e!==!0&&this._toolbar.refresh())},e}),define("js/Toolbar/ToolbarCheckBox",["js/Controls/iCheckBox","./ToolbarItemBase"],function(t,e){"use strict";var n;return n=function(e){t.apply(this,[e]),this.el.addClass("toolbar-checkbox")},_.extend(n.prototype,t.prototype),_.extend(n.prototype,e.prototype),n}),define("js/Toolbar/ToolbarDropDownButton",["./ButtonBase","js/Controls/iCheckBox","js/logger","./ToolbarItemBase"],function(t,e,n,i){"use strict";var o,r=$("<div/>",{"class":"btn-group"}),s=$('<span class="caret"></span>'),a=$('<ul class="dropdown-menu"></ul>'),l=$('<li class="divider"></li>'),c=$("<li/>",{"class":"chkbox"}),d=$('<a href="#"></a>'),h=$("<li></li>");return o=function(e){var i,o;this.el=r.clone(),this._logger=n.create("gme:ToolBar:ToolBarButtonDropDown:"+(new Date).toISOString(),WebGMEGlobal.gmeConfig.client.log),e.clickFn&&(i=e.clickFn,e.clickFnEventCancel=!1,e.clickFn=function(){i()}),this._dropDownTxt=e.text,this._dropDownLimit=e.limitTxtLength||0,delete e.text,this._dropDownBtn=t.createButton(e),this.dropDownText(this._dropDownTxt),o=s.clone(),this._ulMenu=a.clone(),e&&e.menuClass&&this._ulMenu.addClass(e.menuClass),this._dropDownBtn.append(" ").append(o),this._dropDownBtn.addClass("dropdown-toggle"),this._dropDownBtn.attr("data-toggle","dropdown"),this.el.append(this._dropDownBtn).append(this._ulMenu),this._logger.debug("ctor")},_.extend(o.prototype,i.prototype),o.prototype.clear=function(){this._ulMenu.empty()},o.prototype.enabled=function(t){return this.el?void(t===!0?this.el.find(".btn").disable(!1):this.el.find(".btn").disable(!0)):void this._logger.error("trying to enable",t)},o.prototype.addButton=function(e){var n,i,o=h.clone(),r=this._dropDownBtn;e.clickFn&&(i=e.clickFn,e.clickFn=function(t){r.dropdown("toggle"),i(t)}),n=t.createButton(e),n.removeClass("btn btn-mini"),n.addClass("dropdown-list-button"),e.disabled===!0&&n.disable(!0),o.append(n),this._ulMenu.append(o)},o.prototype.addDivider=function(){var t=l.clone();this._ulMenu.append(t)},o.prototype.addCheckBox=function(t){var n,i=c.clone(),o=d.clone();return t.text&&o.append(t.text),n=new e(t),n.el.addClass("pull-right"),o.append(n.el),i.append(o),i.on("click",function(t){n.toggleChecked(),t.stopPropagation(),t.preventDefault()}),this._ulMenu.append(i),i.setEnabled=function(t){t?i.disable(!1):i.disable(!0),n.setEnabled(t)},i.setChecked=function(t){n.setChecked(t)},i},o.prototype.destroy=function(){this.el.remove(),this.el.empty(),this.el=void 0,this._logger.debug("destroyed")},o.prototype.dropDownText=function(t){var e,n,i,o=this._dropDownBtn.html();return"string"!=typeof t?this._dropDownTxt:(this._dropDownTxt=t,i=t,this._dropDownLimit&&i.length>this._dropDownLimit&&(i=i.substr(0,this._dropDownLimit)+"..."),e=o.indexOf("<span"),n=i+" "+o.substr(e),this._dropDownBtn.html(n),void 0)},o}),define("js/Toolbar/ToolbarColorPicker",["js/Controls/ColorPicker","./ToolbarButton"],function(t,e){"use strict";var n;return n=function(n){var i=this;n=n||{},n.clickFn=function(){var e=new t({el:i.el});e.onColorChanged=function(t){n&&n.colorChangedFn&&n.colorChangedFn.call(i,t)}},e.apply(this,[n])},_.extend(n.prototype,e.prototype),n}),define("js/DragDrop/DragSource",["./DragEffects","./DragConstants"],function(t,e){"use strict";function n(t,n){t.draggable({zIndex:a,appendTo:l,cursorAt:n.cursorAt||c,helper:function(i){var o,r=s(t,n,i);return o=n&&_.isFunction(n.helper)?n.helper.call(t,i,r):t.clone(),o.css({"pointer-events":"none"}),o.data(e.DRAG_INFO,r),o},start:function(e,i){return n&&_.isFunction(n.start)?n.start.call(t,e,i):void 0},drag:function(e,i){return n&&_.isFunction(n.drag)?n.drag.call(t,e,i):void 0},stop:function(e){return n&&_.isFunction(n.stop)?n.stop.call(t,e):void 0}})}function i(t){r(t)&&t.draggable("destroy")}function o(t,e){var n=e?"enable":"disable";r(t)&&t.draggable(n)}function r(t){return t.hasClass("ui-draggable")}function s(t,n,i){var o={};return o[e.DRAG_ITEMS]=[],n&&_.isFunction(n.dragItems)&&(o[e.DRAG_ITEMS]=n.dragItems(t)||[]),o[e.DRAG_EFFECTS]=[],n&&_.isFunction(n.dragEffects)&&(o[e.DRAG_EFFECTS]=n.dragEffects(t,i)||[]),o[e.DRAG_PARAMS]=void 0,n&&_.isFunction(n.dragParams)&&(o[e.DRAG_PARAMS]=n.dragParams(t,i)),o}var a=1e5,l=$("body"),c={left:10,top:10};return{DRAG_EFFECTS:t,DEFAULT_CURSOR_AT:{left:c.left,top:c.top},makeDraggable:n,destroyDraggable:i,enableDraggable:o}}),define("js/Toolbar/ToolbarDragItem",["./ButtonBase","./ToolbarItemBase","js/DragDrop/DragSource"],function(t,e,n){"use strict";function i(e){this.el=$('<div class="toolbar-drag-item"></div>'),this._dragBtn=t.createButton(e),n.makeDraggable(this.el,e),this.el.append(this._dragBtn)}return _.extend(i.prototype,e.prototype),i.prototype.enabled=function(t){this._dragBtn.enabled(t),n.enableDraggable(this.el,t)},i.prototype.destroy=function(){n.destroyDraggable(this.el),e.prototype.destroy.call(this)},i}),define("css!js/Toolbar/styles/Toolbar",[],function(){}),define("js/Toolbar/Toolbar",["js/logger","./ToolbarButton","./ToolbarSeparator","./ToolbarRadioButtonGroup","./ToolbarToggleButton","./ToolbarTextBox","./ToolbarLabel","./ToolbarCheckBox","./ToolbarDropDownButton","./ToolbarColorPicker","./ToolbarDragItem","css!./styles/Toolbar.css"],function(t,e,n,i,o,r,s,a,l,c,d){"use strict";function h(t){return p||(p=new g(t)),$(window).on("resize",function(){p._updateLayout.call(p)}),p}var p,g,u="webgme-toolbar",f="webgme-toolbar-ext",m="shown",_="webgme-toolbar-ext-toggle",b=10;return g=function(e){var n=this;this._el=$("<div/>",{"class":u}),this._toolbarExt=$("<div/>",{"class":f}),this._toolbarExtToggleBtn=$('<div class="'+_+'"><i class="glyphicon glyphicon-chevron-down"/><i class="glyphicon glyphicon-chevron-down"/></div>'),this._toolbarExtToggleBtn.on("click",function(t){n._toolbarExt.toggleClass(m),t.stopPropagation(),t.preventDefault()}),this._logger=t.create("gme:Toolbar:Toolbar",WebGMEGlobal.gmeConfig.client.log),e.append(this._el).append(this._toolbarExt)},g.prototype.add=function(t){t.el?(this._el.append(t.el),t._toolbar=this):this._logger.error('The given toolbarItem does not have an "el" to append to the toolbar...')},g.prototype.addButton=function(t){var n=new e(t);return this.add(n),n},g.prototype.addSeparator=function(){var t=new n;return this.add(t),t},g.prototype.addRadioButtonGroup=function(t){var e=new i(t);return this.add(e),e},g.prototype.addToggleButton=function(t){var e=new o(t);return this.add(e),e},g.prototype.addTextBox=function(t){var e=new r(t);return this.add(e),e},g.prototype.addLabel=function(){var t=new s;return this.add(t),t},g.prototype.addCheckBox=function(t){var e=new a(t);return this.add(e),e},g.prototype.addDropDownButton=function(t){var e=new l(t);return this.add(e),e},g.prototype.addColorPicker=function(t){var e=new c(t);return this.add(e),e},g.prototype.addDragItem=function(t){var e=new d(t);return this.add(e),e},g.prototype.refresh=function(){this._updateLayout()},g.prototype._updateLayout=function(){var t,e,n,i=this._el.width(),o=!1;if(i>0){for(this._logger.debug("_updateLayout: "+i),this._toolbarExt.children().appendTo(this._el),this._toolbarExt.removeClass(m),this._toolbarExtToggleBtn.detach(),t=this._el.children(),e=t.length,n=0;e>n;n+=1){var r=$(t[n]);if(r.offset().left+r.width()>i-b){o=!0;break}}if(o)for(this._toolbarExtToggleBtn.insertBefore(this._toolbarExt);e>n;n+=1)$(t[n]).appendTo(this._toolbarExt)}},{createToolbar:h}}),define("js/Loader/ProgressNotification",["clipboard","jquery"],function(t){"use strict";function e(e){var n,i,o,r={showProgressbar:!0,delay:0,type:"info",offset:{x:20,y:37}},s=15,a=!1,l="";return"string"==typeof e?n=$.notify(e,r):null!==e&&void 0!==e&&(a=e.useClipboard||!1,l=e.clipboardHint||"Copy hash to clipboard",delete e.useClipboard,delete e.clipboardHint,a&&(e.icon=e.icon||"glyphicon glyphicon-copy btn btn-s"),n=$.notify(e,r),a&&(i=$(n.$ele).find(".glyphicon-copy").attr("title",l).css("cursor","copy").css("padding-top","0").css("padding-left","0").hide(),new t(i[0]),n.__oldUpdate=n.update,n.update=function(t,e){var n={};"object"==typeof t?n=t:"string"==typeof t&&void 0!==e&&(n[t]=e),n.hasOwnProperty("clipboardValue")&&($(this.$ele).find(".glyphicon-copy").attr("data-clipboard-text",n.clipboardValue),delete n.clipboardValue),this.__oldUpdate(n)})),n.update("progress",s),o=setInterval(function(){50>s?s+=5:70>s?s+=2:98>s?s+=1:(s=10,n.update("type","warning")),n.update("progress",s)},5e3),{note:n,intervalId:o,btnEl:i}}return{startProgressNotification:e,start:e}}),define("text!js/Dialogs/Commit/templates/CommitDialog.html",[],function(){return'<div class="commit-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Commit</h3>\n            </div>\n            <div class="modal-body">\n                <fieldset>\n                    <legend>Selected branch</legend>\n                    <div class="alert alert-error" style="text-align: center;font-weight: bold;">\n                        Oooops, you are not ready to commit since you are not on a branch right now. Select a branch\n                        first to be able to make your commit.\n                    </div>\n                </fieldset>\n                <fieldset class="fs-message">\n                    <legend>Commit message</legend>\n                    <div class="control-group control-group-message" style="margin-top: 0">\n                        <textarea class="input-block-level txt-message form-control" rows="3"></textarea>\n                    </div>\n                </fieldset>\n            </div>\n            <div class="modal-footer">\n                <button href="#" class="btn btn-primary btn-commit">Commit</button>\n                <button href="#" class="btn btn-default" data-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/Commit/styles/CommitDialog",[],function(){}),define("js/Dialogs/Commit/CommitDialog",["js/logger","text!./templates/CommitDialog.html","css!./styles/CommitDialog.css"],function(t,e){"use strict";var n;return n=function(e){this._logger=t.create("gme:Dialogs:Commit:CommitDialog",WebGMEGlobal.gmeConfig.client.log),this._client=e,this._logger.debug("Created")},n.prototype.show=function(){var t=this;this._initDialog(),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){t._txtMessage.focus()}),this._dialog.on("hidden.bs.modal",function(){t._dialog.remove(),t._dialog.empty(),t._dialog=void 0})},n.prototype._initDialog=function(){var t=this,n=this._client.getActiveBranchName();this._dialog=$(e),this._messagePanel=this._dialog.find(".fs-message"),this._btnCommit=this._dialog.find(".btn-commit"),this._branchAlertLabel=this._dialog.find(".alert"),this._txtMessage=this._dialog.find(".txt-message"),this._controlGroupMessage=this._dialog.find(".control-group-message"),void 0===n||null===n?(this._messagePanel.remove(),this._btnCommit.remove()):(this._branchAlertLabel.removeClass("alert-error").addClass("alert-info"),this._branchAlertLabel.text(n)),t._controlGroupMessage.addClass("has-error"),t._btnCommit.disable(!0),this._txtMessage.on("keyup",function(){var e=t._txtMessage.val();""===e?(t._controlGroupMessage.addClass("has-error"),t._btnCommit.disable(!0)):(t._controlGroupMessage.removeClass("has-error"),t._btnCommit.disable(!1))}),this._btnCommit.on("click",function(){var e=t._txtMessage.val();""!==e&&(t._btnCommit.off("click").hide(),t._logger.error("TODO: Make commit not supported/implemented."))})},n}),define("text!js/Dialogs/Merge/templates/MergeDialog.html",[],function(){return'<div class="merge-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Merge results</h3>\n            </div>\n            <div class="modal-body">\n\n                <!-- Merge was successful -->\n                <div class="alert alert-success merge-success" role="alert">Successful merge</div>\n\n                <!-- Error placeholder -->\n                <div class="alert alert-danger merge-failed" role="alert">Failed</div>\n\n                <!-- Diff placeholder -->\n                <div class="alert alert-warning no-diff" role="alert">Diff information is not available.</div>\n\n                <div class="diff-placeholder"></div>\n            </div>\n            <div class="modal-footer">\n                <button href="#" class="btn btn-danger btn-abort" data-dismiss="modal">Abort</button>\n                <button href="#" class="btn btn-primary btn-resolve" data-dismiss="modal">Resolve</button>\n                <button href="#" class="btn btn-primary btn-ok" data-dismiss="modal">Ok</button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("text!js/Dialogs/Merge/templates/DiffTemplate.html",[],function(){return'<div class="diff">\n\n    <div>\n        <p>\n            Information is shown below about the conflicts. They have to be resolved to finish the merge.\n            The highlighted values will be used for the conflict resolution.\n            Click on the row to change the alter the selected value.\n        </p>\n    </div>\n\n    <div class="commits">\n        <span>Base:   </span><span class="base"></span>\n        <br>\n        <span>Theirs: </span><span class="theirs"></span>\n        <br>\n        <span>Mine:   </span><span class="mine"></span>\n        <br>\n        <span>TargetBranch:   </span><span class="branch"></span>\n    </div>\n\n    <hr>\n\n    <div class="container-fluid conflicts">\n\n    </div>\n\n</div>'}),define("css!js/Dialogs/Merge/styles/MergeDialog",[],function(){}),define("js/Dialogs/Merge/MergeDialog",["js/logger","text!./templates/MergeDialog.html","text!./templates/DiffTemplate.html","css!./styles/MergeDialog.css"],function(t,e,n){"use strict";var i;return i=function(e){this._logger=t.create("gme:Dialogs:Merge:MergeDialog",WebGMEGlobal.gmeConfig.client.log),this._client=e,this._logger.debug("Created"),this.resolution=null},i.prototype.show=function(t,e){var n=this;this._initDialog(),t?(this._alertFailed.show(),this._alertFailed.text(t),e?(this._addDiff(e),this._btnResolve.show(),this._btnAbort.show()):(this._warningNoDiff.show(),this._btnOk.show())):(this._alertSuccess.show(),this._btnOk.show()),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){}),this._dialog.on("hidden.bs.modal",function(){n._dialog.remove(),n._dialog.empty(),n._dialog=void 0}),this._btnResolve.on("click",function(){n._client.resolve(n.resolution,function(t,e){var o=new i(n._client);t?n._logger.error("resolve finished",t,e):n._logger.debug("resolve finished",e),o.show(t,e)})})},i.prototype._initDialog=function(){this._dialog=$(e),this._alertSuccess=this._dialog.find(".merge-success"),this._alertFailed=this._dialog.find(".merge-failed"),this._warningNoDiff=this._dialog.find(".no-diff"),this._diffPlaceholder=this._dialog.find(".diff-placeholder"),this._btnResolve=this._dialog.find(".btn-resolve"),this._btnAbort=this._dialog.find(".btn-abort"),this._btnOk=this._dialog.find(".btn-ok"),this._alertSuccess.hide(),this._alertFailed.hide(),this._warningNoDiff.hide(),this._btnResolve.hide(),this._btnAbort.hide(),this._btnOk.hide()},i.prototype._addDiff=function(t){var e,i,o,r,s,a,l,c,d,h=this,p=$(n),g=$('<div class="row conflict-item"><div class="col-md-6 path"></div><div class="col-md-3 value-theirs"></div><div class="col-md-3 value-mine"></div></div>'),u=/((\/\d+)*)/,f=function(t){return t.slice(0,t.lastIndexOf("/"))};if(this.resolution=t,p.find(".base").text(t.baseCommitHash),p.find(".mine").text(t.myCommitHash),p.find(".theirs").text(t.theirCommitHash),p.find(".branch").text(t.targetBranchName),e=p.find(".conflicts"),t.hasOwnProperty("conflict")&&t.conflict.hasOwnProperty("items"))for(o=g.clone(),o.find(".path").text("Path to conflict"),o.find(".value-theirs").text("Theirs (current branch)"),o.find(".value-mine").text("Mine (merging in)"),e.append(o),t.conflict.items.sort(function(t,e){return t.theirs.path>e.theirs.path?1:t.theirs.path<e.theirs.path?-1:0}),d=0;d<t.conflict.items.length;d+=1)i=t.conflict.items[d],o=g.clone(),o.find(".path").text(i.theirs.path),l="?project="+encodeURIComponent(h._client.getActiveProjectId())+"&commit="+encodeURIComponent(t.theirCommitHash)+"&node="+encodeURIComponent(f(u.exec(i.theirs.path)[0]))+"&selection="+encodeURIComponent(u.exec(i.theirs.path)[0]),a=$('<div><a class="glyphicon glyphicon-link" href="'+l+'" target="_blank" tooltip="Open"></a><span><xmp style="word-wrap: break-word; white-space: normal">'+JSON.stringify(i.theirs.value)+"</xmp></span></div>"),o.find(".value-theirs").append(a),r=i.theirs.path===i.mine.path?JSON.stringify(i.mine.value):i.mine.path+": "+JSON.stringify(i.mine.value),c="?project="+encodeURIComponent(h._client.getActiveProjectId())+"&commit="+encodeURIComponent(t.myCommitHash)+"&node="+encodeURIComponent(f(u.exec(i.mine.path)[0]))+"&selection="+encodeURIComponent(u.exec(i.mine.path)[0]),s=$('<div><a class="glyphicon glyphicon-link" href="'+c+'"  target="_blank" tooltip="Open"></a><span><xmp style="word-wrap: break-word; white-space: normal">'+r+"</xmp></span></div>"),o.find(".value-mine").append(s),this._updateSelection(i,o),this._addClickHandler(i,o),e.append(o);this._diffPlaceholder.append(p)},i.prototype._addClickHandler=function(t,e){var n=this;e.on("click",function(i){"A"!==i.target.tagName&&("mine"===t.selected?t.selected="theirs":"theirs"===t.selected?t.selected="mine":t.selected="mine",n._updateSelection(t,e))})},i.prototype._updateSelection=function(t,e){"mine"===t.selected?(e.find(".value-mine").addClass("selected"),e.find(".value-theirs").removeClass("selected")):"theirs"===t.selected?(e.find(".value-mine").removeClass("selected"),e.find(".value-theirs").addClass("selected")):(e.find(".value-mine").removeClass("selected"),e.find(".value-theirs").removeClass("selected"))},i}),define("text!js/Dialogs/ProjectRepository/templates/ProjectRepositoryDialog.html",[],function(){return'<div class="repository-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-xlg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <span class="title-container">\n                    <span class="project-repository-title">Project Repository</span>\n                    <select class="form-control selector">\n                        <optgroup class="history-selector-group group-project" label="Project">\n                            <option value="$allBranchesAndTags">All branches & tags</option>\n                            <option value="$allBranches">All branches</option>\n                            <option value="$allTags">All tags</option>\n                            <option value="$commits">Recent commits</option>\n                        </optgroup>\n                        <optgroup class="history-selector-group group-branches" label="Branches">\n                        </optgroup>\n                        <optgroup class="history-selector-group group-tags" label="Tags">\n                        </optgroup>\n                    </select>\n                </span>\n            </div>\n            <div class="modal-body">\n            </div>\n            <div class="modal-footer">\n                <button href="#" class="btn btn-default" data-dismiss="modal">Close</button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("js/Widgets/ProjectRepository/ProjectRepositoryWidgetControl",["js/logger","js/Dialogs/Confirm/ConfirmDialog"],function(t,e){"use strict";var n;return n=function(n,i){var o=this;o._client=n,o._view=i,o._lastCommitID=null,o._view.onLoadCommit=function(t){o._client.selectCommit(t.id,function(t){t&&o._logger.error(t),o._refreshActualCommit()})},o._view.onDeleteBranchClick=function(t,e){var n=o._client.getActiveProjectId();o._client.deleteBranch(n,t,e,function(e){e&&o._logger.error(e),o._refreshBranchesAndTags(),o._refreshActualCommit(),o._view._start===t&&o._view.noMoreCommitsToDisplay()})},o._view.onDeleteTagClick=function(t){var e=o._client.getActiveProjectId();o._client.deleteTag(e,t,function(t){
t&&o._logger.error(t),o._refreshBranchesAndTags(),o._refreshActualCommit()})},o._view.onCreateBranchFromCommit=function(t){var e=o._client.getActiveProjectId();o._client.createBranch(e,t.name,t.commitId,function(t){t&&o._logger.error(t),o._refreshBranchesAndTags()})},o._view.onCreateTagFromCommit=function(t){var e=o._client.getActiveProjectId();o._client.createTag(e,t.name,t.commitId,function(t){t&&o._logger.error(t),o._refreshBranchesAndTags()})},o._view.onSquashFromCommit=function(t,n){var i=new e,r=!1;i.show({title:"Squash Commits",iconClass:"glyphicon glyphicon-compressed",question:"Would you like to squash all commits above "+t.commitId.substr(0,7)+" (not included) into a single commit?",input:{label:"Message",placeHolder:"Enter optional commit message...",required:!1},severity:"warning",onHideFn:function(){r||n()}},function(e,n){r=!0,o._client.squashCommits(o._client.getActiveProjectId(),t.commitId,t.branchName,n||null,function(e,n){e?o._logger.error(e):"SYNCED"===n.status?o._view._dialog.setSelectorValue(t.branchName):(o._client.notifyUser({severity:"info",message:"Squashing branch '"+t.branchName+"' forked ["+n.hash+"]"}),o._view._dialog.setSelectorValue())})})},o._view.onSelectBranch=function(t){o._client.selectBranch(t,null,function(e){e?o._logger.error(e):o._logger.debug("Branch selected in client",t)})},o._view.onLoadMoreCommits=function(t,e){o._loadMoreCommits(t,e)},o._logger=t.create("gme:Widgets:ProjectRepository:ProjectRepositoryWidgetControl_RepositoryLogControl",WebGMEGlobal.gmeConfig.client.log),o._logger.debug("Created")},n.prototype._loadMoreCommits=function(t,e){var n,i,o=this,r=null,s=o._view._el.scrollTop()||0;i=function(i,a){var l,c,d;if(o._logger.debug("commitsLoaded, err: '"+i+"', data: "+a===!0?a.length:"null"),i)_.isEmpty(i)?o._logger.error('the mysterious error returned by "getCommitsAsync"'):o._logger.error(i);else{if(r=a.concat([]),e&&(o._view.clear(),o._view._initializeUI(),o._lastCommitID=null),c=r.length,c>0){for(l=0;c>l;l+=1)n=r[l],o._lastCommitID!==n._id&&(d={id:n._id,message:n.message,parents:n.parents,timestamp:n.time,user:n.updater.join(",")},o._view.addCommit(d));o._lastCommitID=r[l-1]._id,o._view.render(),o._refreshActualCommit()}o._refreshBranchesAndTags(),o._view.hideProgressbar(),t>c&&o._view.noMoreCommitsToDisplay(),o._view._el.scrollTop(s)}},o._view.showProgressbar(),o._logger.debug("_loadMoreCommits",t,e),e?o._client.getHistory(o._client.getActiveProjectId(),e,t,i):o._client.getCommits(o._client.getActiveProjectId(),this._lastCommitID||(new Date).getTime()+1,t,i)},n.prototype._refreshActualCommit=function(){this._view.setActualCommitId(this._client.getActiveCommitHash())},n.prototype._refreshBranchesAndTags=function(){var t=this,e=t._client.getActiveProjectId();t._view.clearBranches(),t._view.clearTags(),t._client.getBranches(e,function(n,i){var o,r;if(t._logger.debug("getBranches: err, data: ",n,i),n)return void t._logger.error(n);for(r=Object.keys(i),o=0;o<r.length;o+=1)t._view.addBranch({name:r[o],commitId:i[r[o]]});t._client.getTags(e,function(e,n){var i,o;if(t._logger.debug("getTags: err, data: ",e,n),e)return void t._logger.error(e);for(o=Object.keys(n),i=0;i<o.length;i+=1)t._view.addTag({name:o[i],commitId:n[o[i]]});t._view.branchesAndTagsUpdated()})})},n}),define("css!js/Widgets/ProjectRepository/styles/ProjectRepositoryWidget",[],function(){}),define("js/Widgets/ProjectRepository/ProjectRepositoryWidget",["js/logger","js/util","js/Loader/LoaderCircles","js/Utils/ComponentSettings","./ProjectRepositoryWidgetControl","common/regexp","moment","blockies","raphaeljs","css!./styles/ProjectRepositoryWidget.css"],function(t,e,n,i,o,r,s,a){"use strict";var l,c="master",d="project-repository-widget",h="Show more...",p=100,g="commitData",u="commit",f="actual",m=15,_=25,b=1,y=1,v=8,C=8,E=5,D="#000000",I="grad1",P="create-branch-from-commit",T="branch-label",A="tag-label",x="common-label",w="btnLoadCommit",N="commitId",O="commit-message",S={};return l=function(e,n,r){var s="commit_count";this._el=e,this._historyType="commits",this._start=null,this._dialog=r.dialog,this._projectAccess=n.getProjectAccess(),this._client=n,this._config=l.getDefaultConfig(),i.resolveWithWebGMEGlobal(this._config,l.getComponentId()),this._commitBadges=Object.keys(this._config.commitBadges),this.clear(),this._initializeUI(),r&&(p=r[s]||p,this._start=r.start),new o(n,this),this._logger=t.create("gme:Widgets:ProjectRepository:ProjectRepositoryWidget",WebGMEGlobal.gmeConfig.client.log),this._logger.debug("Created")},l.prototype.clear=function(){var t,e;for(this._commits=this._commits||[],e=0;e<this._commits.length;e+=1)t=this._commits[e],t.ui&&(t.ui.graphEl.remove(),t.ui.commitBadges.forEach(function(t){"function"==typeof t.destroy&&t.destroy()}),t.ui.tableEl.find("*").off(),t.ui.tableEl.remove());this._commits=[],this._orderedCommitIds=[],this._actualCommitId=void 0,this._branches=[],this._branchNames=[],this._branchListUpdated=!1,this._tags=[],this._tagNames=[],this._tagListUpdated=!1,this._y=0,this._trackEnds=[],this._renderIndex=-1,this._width=b,this._height=y,this._nonExistingParentPaths=[],this._el.empty(),this._el.off("click"),this._el.off("keyup"),this._el.parent().css({width:"","margin-left":"","margin-top":"",top:""})},l.prototype.destroy=function(){this.clear(),this._el.removeClass(d)},l.prototype.addBranch=function(t){this._addBranch(t)},l.prototype.clearBranches=function(){this._clearBranches()},l.prototype.addTag=function(t){this._addTag(t)},l.prototype.clearTags=function(){this._clearTags()},l.prototype.addCommit=function(t){var e=this._orderedCommitIds.push(t.id)-1;this._commits.push({x:-1,y:-1,id:t.id,commitData:t,ui:void 0}),this._calculatePositionForCommit(e)},l.prototype.showProgressbar=function(){this._btnShowMore.hide(),this._loader.start()},l.prototype.hideProgressbar=function(){this._loader.stop(),this._btnShowMore.show()},l.prototype.render=function(){this._render()},l.prototype.noMoreCommitsToDisplay=function(){this._noMoreCommitsToDisplay()},l.prototype.loadMoreCommits=function(t){t?this.onLoadMoreCommits(this._commits.length+p,t):this.onLoadMoreCommits(p,t)},l.prototype.branchesAndTagsUpdated=function(){0===this._commits.length?this._table.addClass("no-commits-in-table"):this._table.removeClass("no-commits-in-table")},l.prototype.onLoadMoreCommits=function(t,e){this._logger.warn('onLoadMoreCommits not overridden in Controller num: "'+t+'", start: "'+e+'"')},l.prototype.onLoadCommit=function(t){this._logger.warn("onLoadCommit is not overridden in Controller...params: '"+JSON.stringify(t)+"'")},l.prototype.onDeleteBranchClick=function(t,e){this._logger.warn("onDeleteBranchClick is not overridden in Controller...branch, branchHash:",t,e)},l.prototype.onDeleteTagClick=function(t,e){this._logger.warn("onDeleteTagClick is not overridden in Controller...branch, branchHash:",t,e)},l.prototype.onCreateBranchFromCommit=function(t){this._logger.warn("onCreateBranchFromCommit is not overridden in Controller...params: '"+JSON.stringify(t)+"'")},l.prototype.onCreateTagFromCommit=function(t){this._logger.warn("onCreateTagFromCommit is not overridden in Controller...params: '"+JSON.stringify(t)+"'")},l.prototype.onSquashFromCommit=function(t){this._logger.warn("onSquashFromCommit is not overridden in Controller...params: '"+JSON.stringify(t)+"'")},l.prototype.onSelectBranch=function(t){this._logger.warn("onSelectBranch is not overridden in Controller...params: '"+JSON.stringify(t)+"'")},l.cMessageStyleStr="div."+O+" { max-width: __MW__px; }",l.prototype._initializeUI=function(){var t=this;this._el.empty(),this._el.addClass(d),this._cMessageStyle=$("<style/>",{type:"text/css"}),this._cMessageStyle.html(l.cMessageStyleStr.replace("__MW__","400")),this._el.append(this._cMessageStyle),this._table=$("<table/>",{"class":"table table-hover user-select-on commit-list"}),this._tHead=$("<thead/>"),this._tHead.append($('<tr><th>Graph</th><th>Actions</th><th>Commit</th><th>Message</th><th>User</th><th>Time</th><th class="commit-badge-header">Badges</th></tr>')),this._tBody=$("<tbody/>"),0===this._commitBadges.length&&this._tHead.find(".commit-badge-header").hide(),this._table.append(this._tHead).append(this._tBody),this._tableCellActionsIndex=1,this._tableCellCommitIDIndex=2,this._tableCellMessageIndex=3,this._tableCellUserIndex=4,this._tableCellTimeStampIndex=5,this._tableCellCommitBadgesIndex=6,this._el.append(this._table),this._showMoreContainer=$("<div/>",{"class":"show-more"}),this._el.append(this._showMoreContainer),this._loader=new n({containerElement:this._showMoreContainer}),this._loader.setSize(30),this._btnShowMore=$("<a/>",{"class":"",href:"#"}),this._btnShowMore.append(h),this._showMoreContainer.append(this._btnShowMore),this._commitsContainer=$("<div/>",{"class":"commits",tabindex:0}),this._el.append(this._commitsContainer),this._svgPaper=Raphael(this._commitsContainer[0]),this._svgPaper.canvas.style.pointerEvents="visiblePainted",this._svgPaper.setSize("100%","1px"),$(this._svgPaper.canvas).css({top:"0"}),this._generateSVGGradientDefinition(),this._el.on("click."+w,"."+w,function(){var e=$(this),n=e.data(N);t.onLoadCommit({id:n})}),this._el.on("click.iconRemove",".remove-branch-button",function(e){var n,i,o=$(this),r=o.data("branch")+"";for(i=0;i<t._branches.length;i+=1)t._branches[i].name===r&&(n=t._branches[i].commitId);t.onDeleteBranchClick(r,n),e.stopPropagation(),e.preventDefault()}),this._el.on("click.iconRemove",".remove-tag-button",function(e){var n=$(this),i=n.data("tag")+"";t.onDeleteTagClick(i),e.stopPropagation(),e.preventDefault()}),this._el.on("click.select-branch-in-text",".select-branch-in-text",function(e){var n=$(this).text();t.onSelectBranch(n),e.stopPropagation(),e.preventDefault()}),this._btnShowMore.on("click",null,function(e){t.loadMoreCommits(t._start),e.stopPropagation(),e.preventDefault()}),this._el.off("click.btnCreateBranchFromCommit",".btnCreateBranchFromCommit"),this._el.on("click.btnCreateBranchFromCommit",".btnCreateBranchFromCommit",function(){t._onCreateFromCommitButtonClick($(this))}),this._el.off("click.btnCreateTagFromCommit",".btnCreateTagFromCommit"),this._el.on("click.btnCreateTagFromCommit",".btnCreateTagFromCommit",function(){t._onCreateFromCommitButtonClick($(this))}),this._el.off("click.btnSquashFromCommit",".btnSquashFromCommit"),this._el.on("click.btnSquashFromCommit",".btnSquashFromCommit",function(){t._onCreateFromCommitButtonClick($(this))})},l.prototype._calculatePositionForCommit=function(t){var e,n,i,o=this._trackEnds.length,r=this._commits[t],s=!1,a=!1;for(n=0;o>n;n+=1)if(i=this._orderedCommitIds.indexOf(this._trackEnds[n]),e=this._commits[i],-1!==e[g].parents.indexOf(r.id)){s=!0;break}if(r.y=this._y,this._y+=_,s===!0)r.x=e.x,this._trackEnds[n]=r.id;else if(this._branches&&this._branches.length>0&&this._branches[0].name===c&&this._branches[0].commitId===r.id&&(a=!0),a===!0){for(this._trackEnds.splice(0,0,r.id),r.x=0,n=this._commits.length-1;n--;)this._commits[n].x+=m;this._renderIndex=-1}else this._trackEnds.push(r.id),r.x=(this._trackEnds.length-1)*m},l.prototype._render=function(){var t,e,n,i,o,r=this._commits.length,s=-1===this._renderIndex?0:this._renderIndex;for(-1===this._renderIndex&&(this._commitsContainer.find("."+u).remove(),this._svgPaper.clear(),this._tBody.empty()),e=s;r>e;e+=1)t=this._commits[e],t.ui&&(t.ui.graphEl.remove(),t.ui.commitBadges.forEach(function(t){"function"==typeof t.destroy&&t.destroy()}),t.ui.tableEl.find("*").off(),t.ui.tableEl.remove()),t.ui=this._createItem({x:t.x,y:t.y,id:t.id,parents:t[g].parents,branch:t[g].branch,user:t[g].user,timestamp:t[g].timestamp,message:t[g].message,singleBranch:"string"==typeof this._start});for(this._renderIndex=e,this._resizeDialog(this._width,this._height),e=this._nonExistingParentPaths.length;e--;)this._nonExistingParentPaths[e].remove();for(this._nonExistingParentPaths=[],e=0;r>e;e+=1)if(t=this._commits[e],t[g].parents&&t[g].parents.length>0){for(o=!1,i=0;i<t[g].parents.length;i+=1)n=this._orderedCommitIds.indexOf(t[g].parents[i]),n>=s&&this._drawLine(this._commits[n],t),o=-1!==n;o===!1&&this._drawLine(void 0,t)}this._addBranchHeaderLabels(),this._addTagHeaderLabels()},l.prototype._removeBranchHeaderLabels=function(){this._tBody.find("."+T).remove()},l.prototype._removeTagHeaderLabels=function(){this._tBody.find("."+A).remove()},l.prototype._addBranchHeaderLabels=function(){var t,e=this._branches.length;if(this._branchListUpdated===!0){for(this._removeBranchHeaderLabels();e--;)t=this._orderedCommitIds.indexOf(this._branches[e].commitId),-1!==t&&this._applyBranchHeaderLabel(this._commits[t],this._branches[e].name);this._branchListUpdated=!1}},l.prototype._addTagHeaderLabels=function(){var t,e=this._tags.length;if(this._tagListUpdated===!0){for(this._removeTagHeaderLabels();e--;)t=this._orderedCommitIds.indexOf(this._tags[e].commitId),-1!==t&&this._applyTagHeaderLabel(this._commits[t],this._tags[e].name);this._tagListUpdated=!1}},l.prototype._branchLabelDOMBase=$('<span class="label"><span class="label-name select-branch-in-text" title="Select branch"></span><i data-branch="" class="glyphicon glyphicon-remove icon-white remove-branch-button" title="Delete branch"></i></span>'),l.prototype._tagLabelDOMBase=$('<span class="label"><span class="label-name"><i data-tag="" class="glyphicon glyphicon-tag tag-label-icon"></i></span>'),l.prototype._applyBranchHeaderLabel=function(t,e){var n,i,o=this._branchLabelDOMBase.clone();o.find("span.label-name").text(e),o.find("i").attr("data-branch",e),o.addClass(T),o.addClass(x),o.addClass("label-success"),this._projectAccess.write===!1&&o.addClass("delete-prohibited"),n=this._tBody.children()[this._orderedCommitIds.indexOf(t.id)].cells[this._tableCellMessageIndex],i=$(n).find("div."+O)[0],i.insertBefore(o[0],i.childNodes[0])},l.prototype._applyTagHeaderLabel=function(t,e){var n,i,o=this._tagLabelDOMBase.clone();o.find("span.label-name").text(e),o.append($('<i data-tag="'+e+'" class="glyphicon glyphicon-remove icon-white remove-tag-button" title="Delete tag"/>')),o.addClass(A),o.addClass(x),o.addClass("label-primary"),this._projectAccess["delete"]===!1&&o.addClass("delete-prohibited"),n=this._tBody.children()[this._orderedCommitIds.indexOf(t.id)].cells[this._tableCellMessageIndex],i=$(n).find("div."+O)[0],i.insertBefore(o[0],i.childNodes[0])},l.prototype._addBranch=function(t){var e,n=t.name;e=this._branchNames.indexOf(n),-1!==e?this._branches[e]=t:n===c?(this._branches.splice(0,0,t),this._branchNames.splice(0,0,n)):(this._branches.push(t),this._branchNames.push(n)),this._branchListUpdated=!0,this._addBranchHeaderLabels()},l.prototype._addTag=function(t){var e,n=t.name;e=this._tagNames.indexOf(n),-1!==e?this._tags[e]=t:(this._tags.push(t),this._tagNames.push(n)),this._tagListUpdated=!0,this._addTagHeaderLabels()},l.prototype._clearBranches=function(){this._branches=[],this._branchNames=[],this._removeBranchHeaderLabels(),this._branchListUpdated=!0},l.prototype._clearTags=function(){this._tags=[],this._tagNames=[],this._removeTagHeaderLabels(),this._tagListUpdated=!0},l.prototype._trDOMBase=$('<tr><td></td><td class="actions"></td><td class="commit-hash"></td><td class="message-column"><div class="'+O+'"></div></td><td class="user-column"></td><td></td><td class="commit-badge-column"></td></tr>'),l.prototype._createBranchBtnDOMBase=$('<button class="btn btn-default btn-xs btnCreateBranchFromCommit" href="#" title="Create new branch from here"><i class="glyphicon glyphicon-edit create-branch-icon"></i></button>'),l.prototype._createTagBtnDOMBase=$('<button class="btn btn-default btn-xs btnCreateTagFromCommit" href="#" title="Create a tag here"><i class="glyphicon glyphicon-tags create-tag-icon"></i></button>'),l.prototype._squashBtnDOMBase=$('<button class="btn btn-default btn-xs btnSquashFromCommit" href="#" title="Squash branch from this commit"><i class="glyphicon glyphicon-compressed squash-branch-icon"></i></button>'),l.prototype._createItem=function(t){var e,n,i,o,r,l,c=0===this._tBody.children().length,d=t.user||"",h={graphEl:null,tableEl:null,commitBadges:[]};if(e=$("<div/>",{"class":u,"data-id":t.id,"data-b":t.branch}),e.css({left:t.x,top:t.y}),t.actual&&e.addClass("actual"),this._commitsContainer.append(e),this._width=Math.max(this._width,t.x+v),this._height=Math.max(this._height,t.y+C),n=this._trDOMBase.clone(),c===!0&&(this._graphPlaceHolder=$("<div/>"),$(n[0].cells[0]).append(this._graphPlaceHolder)),l=new Date(parseInt(t.timestamp,10)),$(n[0].cells[this._tableCellCommitIDIndex]).append(t.id.substr(0,7)),$(n[0].cells[this._tableCellCommitIDIndex]).attr("title","Select commit "+t.id),$(n[0].cells[this._tableCellCommitIDIndex]).addClass(w),$(n[0].cells[this._tableCellCommitIDIndex]).data(N,t.id),$(n[0].cells[this._tableCellMessageIndex]).find("div."+O).text(t.message),S.hasOwnProperty(d)===!1&&(S[d]=a({seed:d,size:6,scale:8}).toDataURL()),$(n[0].cells[this._tableCellUserIndex]).addClass(),$(n[0].cells[this._tableCellUserIndex]).append($('<span class="avatar-container">'+d+'<img class="avatar-image" src="'+S[d]+'"/></span>')),$(n[0].cells[this._tableCellTimeStampIndex]).append(s(l).fromNow()),$(n[0].cells[this._tableCellTimeStampIndex]).attr("title",s(l).local().format("dddd, MMMM Do YYYY, h:mm:ss a")),0===this._commitBadges.length)$(n[0].cells[this._tableCellCommitBadgesIndex]).hide();else for(o=$("<div>",{"class":"commit-badge-container"}),$(n[0].cells[this._tableCellCommitBadgesIndex]).append(o),r=0;r<this._commitBadges.length;r+=1)this._loadCommitBadge(this._commitBadges[r],o,t,h);return i=this._createBranchBtnDOMBase.clone(),i.data(N,t.id),this._projectAccess.write===!1&&i.disable(!0),n[0].cells[this._tableCellActionsIndex].appendChild(i[0]),i=this._createTagBtnDOMBase.clone(),i.data(N,t.id),this._projectAccess.write===!1&&i.disable(!0),n[0].cells[this._tableCellActionsIndex].appendChild(i[0]),t.singleBranch&&(i=this._squashBtnDOMBase.clone(),i.data(N,t.id),this._projectAccess.write===!1&&i.disable(!0),n[0].cells[this._tableCellActionsIndex].appendChild(i[0])),this._tBody.append(n),h.graphEl=e,h.tableEl=n,h},l.prototype.setActualCommitId=function(t){var e=this._actualCommitId;this._actualCommitId!==t&&(this._actualCommitId=t,this._updateActualCommitUI(e,this._actualCommitId))},l.prototype._updateActualCommitUI=function(t,e){var n=this._orderedCommitIds.indexOf(t);-1!==n&&this._commits[n].ui.graphEl.removeClass(f),n=this._orderedCommitIds.indexOf(e),-1!==n&&(this._commits[n].ui.graphEl.addClass(f),$(this._tBody.children()[n].cells[this._tableCellActionsIndex]).find("."+w).remove())},l.prototype._drawLine=function(t,e){var n,i,o,r=void 0===t,s=r?e.x+v/2:t.x+v/2,a=r?this._height:t.y+C/2,l=e.x+v/2,c=e.y+C/2,d=l-s;0===d?(c=e.y+C+2,r===!1?(a=t.y-2,n=["M",s,a,"L",l,c]):a!==e.y+C&&(n=["M",s,a-_,"L",l,c],o=["M",s-1,a,"M",s,a,"L",l,a-_])):s>l?(l=e.x+v+2,a=t.y-1,c+=1,n=["M",s,a,"L",s,c+E,"L",s-E,c,"L",l,c]):(s=t.x+v+2,c=e.y+C+3,a+=1,n=["M",s,a,"L",l-E,a,"L",l,a-E,"L",l,c]),r===!0?(n&&(i=this._svgPaper.path(n.join(",")),i.attr({stroke:D}),this._nonExistingParentPaths.push(i)),o&&(i=this._svgPaper.path(o.join(",")),i.node.setAttribute("stroke","url(#"+I+")"),this._nonExistingParentPaths.push(i))):(i=this._svgPaper.path(n.join(",")),i.attr({stroke:D}))},l.prototype._resizeDialog=function(t,e){var n,i=30,o=70,r=70,s=$(window).height(),a=$(window).width();this._svgPaper.setSize(t,e),this._generateSVGGradientDefinition(),this._graphPlaceHolder.css("width",t),a-=2*i,s=s-2*i-o-r,this._cMessageStyle.html(l.cMessageStyleStr.replace("__MW__",.66*a)),n=this._table.width(),this._showMoreContainer.css("width",n)},l.prototype._noMoreCommitsToDisplay=function(){this._btnShowMore.hide(),this._btnShowMore.off("click"),this._loader.destroy(),this._showMoreContainer.empty(),this._showMoreContainer.remove()},l.prototype._generateSVGGradientDefinition=function(){if(!this._svgPaper.canvas.getElementById(I)){var t,e,n,i=document.createElementNS("http://www.w3.org/2000/svg","defs");t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),t.setAttribute("x1","0%"),t.setAttribute("x2","0%"),t.setAttribute("y1","0%"),t.setAttribute("y2","100%"),t.setAttribute("id",I),e=document.createElementNS("http://www.w3.org/2000/svg","stop"),e.setAttribute("offset","0%"),e.setAttribute("style","stop-color: "+D),n=document.createElementNS("http://www.w3.org/2000/svg","stop"),n.setAttribute("offset","100%"),n.setAttribute("style","stop-color: #FFFFFF"),t.appendChild(e),t.appendChild(n),i.appendChild(t),this._svgPaper.canvas.appendChild(i)}},l.prototype._onCreateFromCommitButtonClick=function(t){var e,n,i,o=t.parent(),s=t.hasClass("btnCreateBranchFromCommit"),a=t.hasClass("btnSquashFromCommit"),l=$('<div class="input-group form-group"></div>'),c=$('<input class="form-control span2 input-mini" type="text">'),d=$('<button class="btn btn-default btn-xs" type="button" title="Create"><i class="glyphicon glyphicon-ok"></i></button>'),h=$('<button class="btn btn-default btn-xs" type="button" title="Cancel"><i class="glyphicon glyphicon-remove"></i></button>'),p=this;return a?(i=t.data(N),n=this._orderedCommitIds.indexOf(i),this._tBody.find("tr:lt("+n+")").addClass("in-selection"),void p.onSquashFromCommit({branchName:this._start,commitId:i},function(){p._tBody.find("tr").removeClass("in-selection")})):(e=this._tBody.find("."+P+" > .btn"),0!==e.length&&$(e[1]).trigger("click"),l.addClass(P),l.append(c).append(d).append(h),o.children().css("display","none"),o.append(l),h.on("click",function(t){o.find("."+P).remove(),o.children().css("display","inline-block"),t.stopPropagation()}),c.on("keyup",function(t){var e=c.val(),n=!1;switch(n=""===e?!0:s?-1!==p._branchNames.indexOf(e)||!r.BRANCH.test(e):-1!==p._tagNames.indexOf(e)||!r.TAG.test(e),n?(l.addClass("has-error"),d.disable(!0)):(l.removeClass("has-error"),d.disable(!1)),t.which){case 27:h.trigger("click"),t.preventDefault(),t.stopPropagation();break;case 13:d.trigger("click"),t.preventDefault(),t.stopPropagation()}}),c.focus().trigger("keyup"),void d.on("click",function(e){var n=c.val(),i=s?p._branchNames.indexOf(n)>-1:p._tagNames.indexOf(n)>-1;""!==n&&i===!1&&(o.find("."+P).remove(),o.children().css("display","inline-block"),s?p.onCreateBranchFromCommit({commitId:t.data(N),name:n}):p.onCreateTagFromCommit({commitId:t.data(N),name:n})),e.stopPropagation()}))},l.prototype._loadCommitBadge=function(t,e,n,i){var o=this,r=$("<i>",{"class":"fa fa-spinner fa-spin place-holder"});e.append(r),requirejs([this._config.commitBadges[t].path],function(t){$.contains(o._el[0],e[0])?(r.remove(),i.commitBadges.push(new t(e,o._client,n))):o._logger.error("ProjectRepositoryWidget or table row removed before CommitBadge loaded")},function(t){o._logger.error(t)})},l.getDefaultConfig=function(){return{commitBadges:{}}},l.getComponentId=function(){return"GenericUIProjectRepositoryWidget"},l}),define("css!js/Dialogs/ProjectRepository/styles/ProjectRepositoryDialog",[],function(){}),define("js/Dialogs/ProjectRepository/ProjectRepositoryDialog",["js/logger","text!./templates/ProjectRepositoryDialog.html","js/Widgets/ProjectRepository/ProjectRepositoryWidget","css!./styles/ProjectRepositoryDialog.css"],function(t,e,n){"use strict";var i;return i=function(e){this._logger=t.create("gme:Dialogs:ProjectRepository:ProjectRepositoryDialog",WebGMEGlobal.gmeConfig.client.log),this._client=e,this._widget=null,this._selector=null,this._groupBranches=null,this._branchNames=[],this._groupTags=null,this._tags=[],this._tagCommitHashes=[],this._selectedValue=null,this._logger.debug("Created")},i.prototype.show=function(t){var e=this;this._branchNames=t.branches,this._initDialog(t),this._dialog.on("hide.bs.modal",function(){e._dialog.remove(),e._dialog.empty(),e._dialog=void 0}),this._dialog.modal("show")},i.prototype._initDialog=function(t){var n,i=this,o=20,r=$(window).height();this._dialog=$(e),this._selector=this._dialog.find("select.selector"),this._groupBranches=this._selector.find("optgroup.group-branches"),this._groupTags=this._selector.find("optgroup.group-tags"),"string"==typeof t.start?(t.historyType="branch",this._selectedValue=t.start):"object"==typeof t.start&&t.start instanceof Array&&t.start.length>0?(t.historyType="branches",this._selectedValue="$allBranches"):(t.historyType="commits",t.start=null,this._selectedValue="$commits"),this._populateOptions(t),this._selector.on("change",function(){var t={start:null,type:null},e=i._selector.val();e&&(i._selectedValue=e,"$allBranchesAndTags"===e?t.start=i._branchNames.concat(i._tagCommitHashes):"$allBranches"===e?t.start=i._branchNames:"$allTags"===e?t.start=i._tagCommitHashes:"$commits"===e?t.start=null:t.start=e,i._initializeWidget(n,t))}),n=this._dialog.find(".modal-body"),this._initializeWidget(n,t),this._dialog.on("show.bs.modal",function(){var e,s=i._dialog.find(".modal-header").outerHeight(!0),a=i._dialog.find(".modal-footer").outerHeight(!0),l=parseInt(n.css("padding-top"),10)+parseInt(n.css("padding-bottom"),10);e=r-2*o,i._dialog.removeClass("fade"),n.css({"max-height":e-l-s-a,height:e-l-s-a}),i._widget.loadMoreCommits(t.start)}),this._dialog.on("hide",function(){i._widget.clear()})},i.prototype._populateOptions=function(){var t=this,e=!1;this._groupBranches.children().remove(),this._groupTags.children().remove(),this._branchNames.sort(),this._tags.sort(function(t,e){return t.name>e.name?1:t.name<e.name?-1:0}),this._tagCommitHashes=[],this._branchNames.forEach(function(n){t._groupBranches.append($("<option>",{text:n,value:n})),t._selectedValue===n&&(e=!0)}),this._tags.forEach(function(n){t._groupTags.append($("<option>",{text:n.name,value:n.commitId})),t._tagCommitHashes.push(n.commitId),t._selectedValue===n.commitId&&(e=!0)}),this._selectedValue&&this._selectedValue[0].indexOf("$")>-1?this._selector.val(this._selectedValue):e?this._selector.val(this._selectedValue):this._selector.val("")},i.prototype._initializeWidget=function(t,e){var i=this,o=!1;this._widget&&(o=!0,this._widget.clear()),this._widget=new n(t,i._client,{commit_count:100,historyType:e.historyType,start:e.start,dialog:i}),this._widget.branchesAndTagsUpdated=function(){i._logger.debug("branches, old, new",i._branchNames,i._widget._branchNames),i._logger.debug("tags, old, new",i._tags,i._widget._tags),i._branchNames=i._widget._branchNames.slice(),i._tags=i._widget._tags.slice(),i._populateOptions(),n.prototype.branchesAndTagsUpdated.call(i._widget)},o&&i._widget.loadMoreCommits(e.start)},i.prototype.setSelectorValue=function(t){this._selector.val(t||"$commits"),this._selector.trigger("change")},i}),define("text!js/Dialogs/Branches/templates/BranchesDialog.html",[],function(){return'<div class="branches-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Branches</h3>\n            </div>\n            <div class="pre-body">\n                <div class="tabContainer"></div>\n            </div>\n            <div class="modal-body">\n                <ul class="nav nav-pills nav-stacked">\n                </ul>\n            </div>\n            <div class="modal-footer">\n                <div class="panel-buttons">\n                    <button class="btn btn-default pull-left btn-refresh" title="Reload branch list..."\n                            style="position: relative;"><i class="glyphicon glyphicon-refresh"></i></button>\n                    <button class="btn btn-primary btn-open">Open</button>\n                    <button class="btn btn-danger btn-delete">Delete</button>\n                    <button class="btn btn-default" data-dismiss="modal">Close</button>\n                </div>\n                <div class="panel-create-new control-group">\n                    <div class="input-group">\n                        <div class="input-group-btn">\n                            <button type="button" class="btn btn-default dropdown-toggle disabled" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                                <span class="username">Username</span>\n                                <!--<span class="caret"></span>-->\n                            </button>\n                            <ul class="dropdown-menu">\n                                <!--<li><a href="#">Username</a></li>-->\n                                <!--<li><a href="#">Another action</a></li>-->\n                                <!--<li><a href="#">Something else here</a></li>-->\n                                <!--<li role="separator" class="divider"></li>-->\n                                <!--<li><a href="#">Separated link</a></li>-->\n                            </ul>\n                        </div><!-- /btn-group -->\n                        <input type="text" class="input-xlarge txt-branch-name form-control"\n                               placeholder="Branch name..." />\n                    </div><!-- /input-group -->\n\n                    <button class="btn btn-default btn-cancel">Cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/Branches/styles/BranchesDialog",[],function(){}),define("js/Dialogs/Branches/BranchesDialog",["angular","js/logger","js/Constants","js/Loader/LoaderCircles","js/Utils/GMEConcepts","common/storage/util","text!./templates/BranchesDialog.html","css!./styles/BranchesDialog.css"],function(t,e,n,i,o,r,s){"use strict";var a,l,c,d="BRANCH_ID",h=$('<li class="center pointer"><a class="btn-env"></a>');return angular.module("gme.ui.branchesDialog",["isis.ui.simpleDialog"]).run(function(t,e,n){l=t,c=n}),a=function(t){this._logger=e.create("gme:Dialogs:Branches:BranchesDialog",WebGMEGlobal.gmeConfig.client.log),this._client=t,this._projectId=t.getActiveProjectId(),this._selectedBranch=t.getActiveBranchName(),this._branchNames=[],this._branches={},this._filter=void 0,this._ownerId=null,this._logger.debug("Created")},a.prototype.show=function(){var t=this;t._initDialog(),t._dialog.modal("show"),t._dialog.on("hidden.bs.model",function(){t._dialog.remove(),t._dialog.empty(),t._dialog=void 0,t._client.unwatchProject(t._projectId,t._projectEventHandling)}),t._branchEventHandling=function(e,i){(i.etype===n.CLIENT.STORAGE.BRANCH_CREATED||i.etype===n.CLIENT.STORAGE.BRANCH_DELETED||i.etype===n.CLIENT.STORAGE.BRANCH_HASH_UPDATED)&&(t._logger.debug("branchlist changed event",i),t._refreshBranchList())},t._client.watchProject(t._projectId,t._branchEventHandling),this._refreshBranchList()},a.prototype._initDialog=function(){function t(t){n._client.selectBranch(t,null,function(e){e&&this._logger.error("unable to open branch",{metadata:{error:e}}),n._selectedBranch=t,n._dialog.modal("hide")})}function e(t){n._client.deleteBranch(n._projectId,t,n._branches[t],function(t){t&&n._logger.error("unable to remove branch",{metadata:{error:t}})})}var n=this,o=this._selectedBranch;this._dialog=$(s),this._dialog.find("h3").first().text("Branches of project ["+r.getProjectDisplayedNameFromProjectId(this._projectId)+"]"),this._el=this._dialog.find(".modal-body").first(),this._ul=this._el.find("ul").first(),this._panelButtons=this._dialog.find(".panel-buttons"),this._panelCreateNew=this._dialog.find(".panel-create-new").hide(),this._btnOpen=this._dialog.find(".btn-open"),this._btnDelete=this._dialog.find(".btn-delete"),this._btnRefresh=this._dialog.find(".btn-refresh"),this._ownerId=WebGMEGlobal.userInfo._id,this._loader=new i({containerElement:this._btnRefresh}),this._loader.setSize(14),this._dialog.find(".tabContainer").first().groupedAlphabetTabs({onClick:function(t){n._filter=t,n._refreshBranchList()},noMatchText:"Nothing matched your filter, please click another letter."}),this._ul.on("click","li:not(.disabled)",function(t){o=$(this).data(d),t.stopPropagation(),t.preventDefault(),n._ul.find(".active").removeClass("active"),$(this).addClass("active")}),this._ul.on("dblclick","li:not(.disabled)",function(e){o=$(this).data(d),
e.stopPropagation(),e.preventDefault(),t(o)}),this._btnOpen.on("click",function(e){e.stopPropagation(),e.preventDefault(),t(o)}),this._btnDelete.on("click",function(t){t.stopPropagation(),t.preventDefault(),e(o)}),this._btnRefresh.on("click",function(t){n._refreshBranchList(),t.stopPropagation(),t.preventDefault()})},a.prototype._refreshBranchList=function(){var t=this;t._client.getBranches(t._projectId,function(e,n){e&&(t._logger.error("cannot get branch list:",{metadata:{error:e}}),t._branchNames=[]),t._branches=n,t._branchNames=Object.keys(n),t._updateBranchList()})},a.prototype._updateBranchList=function(){var t,e,n,i=this._branchNames.length,o=0,r=$('<li class="center"><i>No projects in this group...</i></li>');if(this._ul.empty(),i>0)for(t=0;i>t;t+=1)n=!1,n=void 0===this._filter?!0:this._branchNames[t].toUpperCase()[0]>=this._filter[0]&&this._branchNames[t].toUpperCase()[0]<=this._filter[1],n&&(e=h.clone(),e.find("a").text(this._branchNames[t]),e.data(d,this._branchNames[t]),this._branchNames[t]===this._selectedBranch&&e.addClass("active"),this._ul.append(e),o+=1);0===o&&this._ul.append(r.clone())},a}),define("text!js/Dialogs/MultiTab/templates/MultiTabDialog.html",[],function(){return'<div class="multi-tab-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <i class="header-icon"></i><span class="header-title"></span>\n            </div>\n            <div class="pre-body">\n                <div class="tabContainer">\n                    <ul class="nav nav-tabs">\n                    </ul>\n                </div>\n            </div>\n            <div class="modal-body">\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("text!js/Dialogs/MultiTab/templates/ModalBodyForm.html",[],function(){return'<form class="form-horizontal" role="form">\n    <h5><span class="info-title">Some info title</span>\n        <i class="glyphicon glyphicon-info-sign toggle-info-btn"/>\n    </h5>\n        <span class="info-details hidden">Some detailed info text</span>\n        <div class="form-control-container">\n\n        </div>\n</form>'}),define("css!js/Dialogs/MultiTab/styles/MultiTabDialog",[],function(){}),define("js/Dialogs/MultiTab/MultiTabDialog",["js/Loader/LoaderCircles","text!./templates/MultiTabDialog.html","text!./templates/ModalBodyForm.html","css!./styles/MultiTabDialog.css"],function(t,e,n){"use strict";var i;return i=function(){},i.prototype.show=function(t,e){var n=this;this._initDialog(t),this._dialog.on("hide.bs.modal",function(){e(),n._onHide()}),this._dialog.modal("show")},i.prototype.showAlert=function(t,e){e=e||"danger",this._errorBadge.removeClass("alert-success alert-info alert-warning alert-danger"),this._errorBadge.addClass("alert-"+e),this._errorBadge.text(t),this._errorBadge.show()},i.prototype.hideAlert=function(){this._errorBadge.hide()},i.prototype._initDialog=function(n){var i;for(this._dialog=$(e),this._loader=new t({containerElement:this._dialog}),this._modalContent=this._dialog.find(".modal-content"),this._modalHeader=this._modalContent.find(".modal-header"),this._preBody=this._modalContent.find(".pre-body"),this._modalBody=this._modalContent.find(".modal-body"),this._modalFooter=this._modalContent.find(".modal-footer"),this._modalHeader.find(".header-icon").addClass(n.iconClass||"glyphicon glyphicon-comment"),this._modalHeader.find(".header-title").text(n.title||"Missing parameters.title"),n.extraClasses&&this._dialog.addClass(n.extraClasses),this._tabsUl=this._preBody.find("ul.nav-tabs"),this._currentTabIndex=n.activeTabIndex||0,this._tabEls=[],this._formEls=[],this._okBtnEls=[],i=0;i<n.tabs.length;i+=1)this._addTab(n.tabs[i],i),i===this._currentTabIndex?this._tabEls[i].addClass("active"):(this._formEls[i].hide(),this._okBtnEls[i].hide());1===n.tabs.length&&this._preBody.hide(),this._errorBadge=$('<div class="alert alert-danger error-badge" role="alert"></div>'),this._errorBadge.hide(),this._modalBody.append(this._errorBadge)},i.prototype._onHide=function(){this._loader.destroy(),this._dialog.find("li.tab").off("click"),this._dialog.find(".toggle-info-btn").off("click"),this._dialog.find(".ok-btn").off("click"),this._dialog.remove(),this._dialog.empty(),this._dialog=void 0},i.prototype._addTab=function(t,e){var i,o,r,s=this,a=$(n);i=$('<li class="tab"><a href="#" data-toggle="tab">'+t.title+"</a></li>"),i.on("click",function(){s._tabIndexChanged(e)}),this._tabsUl.append(i),this._tabEls.push(i),a=$(n),o=a.find(".info-title").text(t.infoTitle),o=a.find(".info-details"),o.text(t.infoDetails),a.find(".toggle-info-btn").on("click",function(){o.hasClass("hidden")?o.removeClass("hidden"):o.addClass("hidden")}),a.find(".form-control-container").append(t.formControl),this._formEls.push(a),this._modalBody.append(a),r=$('<button class="btn btn-primary ok-btn">OK</button>'),r.on("click",function(){s._errorBadge.hide(),s._modalContent.css("opacity",0),s._loader.start(),t.onOK(function(t){s._loader.stop(),s._modalContent.css("opacity",1),t?s.showAlert("string"==typeof t?t:t.message):s._dialog.modal("hide")})}),this._okBtnEls.push(r),this._modalFooter.prepend(r)},i.prototype._tabIndexChanged=function(t){this._currentTabIndex!==t&&(this._formEls[this._currentTabIndex].hide(),this._okBtnEls[this._currentTabIndex].hide(),this._tabEls[this._currentTabIndex].removeClass("active"),this._currentTabIndex=t,this._formEls[this._currentTabIndex].show(),this._okBtnEls[this._currentTabIndex].show(),this._tabEls[this._currentTabIndex].addClass("active"),this._errorBadge.hide())},i}),define("js/Dialogs/AddCommits/AddCommitsDialog",["js/logger","common/regexp","js/Controls/PropertyGrid/Widgets/AssetWidget","js/Dialogs/MultiTab/MultiTabDialog"],function(t,e,n,i){"use strict";function o(e,n,i){this._client=e,this._logger=t.create("gme:js:Dialogs:AddCommits:AddCommitsDialog",n.client.log),this._branches=i}return o.prototype.show=function(t){var e=this,n={title:"Add Commits",extraClasses:"add-commits-dialog",iconClass:"glyphicon glyphicon-fast-forward",activeTabIndex:0,tabs:[this._getFromProjectTab(),this._getApplyCommitQueueTab()]};this._dialog=new i,this._projectId=t.projectId,this._branchName=t.branchName,this._dialog.show(n,function(){e._assetWidgetCQ.destroy(),e._assetWidgetProject.destroy(),e._nameInputEl.off("keyup"),e._nameInputEl.off("keydown")})},o.prototype._getFromProjectTab=function(){function t(t){return e._assetWidgetProject.propertyValue?void e._client.updateProjectFromFile(e._projectId,e._branchName,e._assetWidgetProject.propertyValue,function(n,i){n?t("Failed to add commit from project: "+n):e._checkCommitStatus(i.status)?t():t("Project imported at commit "+i.hash.substring(0,7)+" but could not update branch.")}):void t("No file uploaded.")}var e=this;return this._assetWidgetProject=new n({propertyName:"AddProjectCommit",propertyValue:""}),{title:"Project",infoTitle:"From exported webgmex project",infoDetails:"The exported project does not have to relate to the current project at all. However it is typically recommended that they stem from the same source. Otherwise following the history may not make much sense.",formControl:e._assetWidgetProject.el,onOK:t}},o.prototype._getApplyCommitQueueTab=function(){function t(t){var e={fastForward:s,newBranchName:r._nameInputEl.val()};return a?l?void r._client.applyCommitQueue(o,e,function(e){e?(r._logger(e),t("Failed to apply commit queue"+e)):t()}):void t("The provided branch is not valid, enter another one."):void t("The uploaded data is invalid")}function i(t){return t.hasOwnProperty("webgmeVersion")&&t.hasOwnProperty("projectId")&&t.hasOwnProperty("branchName")&&t.hasOwnProperty("commitQueue")&&t.commitQueue.length>0&&t.commitQueue[0].hasOwnProperty("commitObject")&&"string"==typeof t.commitQueue[0].commitObject._id&&e.HASH.test(t.commitQueue[0].commitObject._id)}var o,r=this,s=!1,a=!1,l=!1,c=$('<div class="apply-commit-queue-controls">');return this._assetWidgetCQ=new n({propertyName:"ApplyCommitQueue",propertyValue:""}),this._nameInputEl=$('<input type="text" class="input form-control branch-name" placeholder="Enter a new branch name..."/>'),c.append(this._assetWidgetCQ.el),c.append(this._nameInputEl),this._nameInputEl.hide(),this._assetWidgetCQ.onFinishChange(function(){r._assetWidgetCQ.getTargetAsJson(function(t){s=!1,o=[],t?i(t)===!1?(r._dialog.showAlert("Uploaded file is not the right format.","danger"),r._isValidData=!1):t.projectId!==r._projectId?(r._dialog.showAlert('Exported data "'+t.projectId+'" is not from this project.',"danger"),r._isValidData=!1):-1===t.commitQueue[0].commitObject.parents.indexOf(r._branches[r._branchName])?(r._dialog.showAlert("Exported data is from the same project, but the first queued commit hash does not have the current one as a parent. A new branch with the changes will be created.","warning"),a=!0,o=t.commitQueue):(r._dialog.showAlert("Exported data fits the current branch and applied changes will be attempted to be fast forwarded. Please provide a branch name just in case it fails. ","success"),a=!0,s=!0,o=t.commitQueue):(a=!1,r._dialog.showAlert("Uploaded file must be a json file! Try again...","danger")),a===!0?(r._nameInputEl.show(),r._nameInputEl.focus()):r._nameInputEl.hide()})}),this._nameInputEl.on("keyup",function(){var t=$(this),n=t.val();l=""!==n&&r._branches.hasOwnProperty(n)===!1&&e.BRANCH.test(n),l?c.removeClass("has-error"):c.addClass("has-error")}),this._nameInputEl.on("keydown",function(t){var e=13===t.which;e&&(t.preventDefault(),t.stopPropagation())}),{title:"Commit Queue",infoTitle:"From downloaded commit queue",infoDetails:'If you got disconnected and or for some other reason was forced to download uncommitted local changes. This is where such changes can be persisted back to the database. N.B. this is not an export format or a way to "save" changes - but rather a fallback when connection or device-power was lost.',formControl:c,onOK:t}},o.prototype._checkCommitStatus=function(t){return t===this._client.CONSTANTS.STORAGE.SYNCED||t===this._client.CONSTANTS.STORAGE.MERGED},o}),define("js/Utils/Exporters",["js/Loader/ProgressNotification","clipboard","js/Utils/SaveToDisk"],function(t,e,n){"use strict";function i(e,i,o,r,s){var a=t.start("<strong>Exporting </strong> project ...");e.exportProjectToFile(o?o.projectId:e.getActiveProjectId(),o?o.branchName:e.getActiveBranchName(),o?o.commitHash:e.getActiveCommitHash(),r,function(t,e){clearInterval(a.intervalId),t?(i.error("unable to save project",t),a.note.update({message:"<strong>Failed to export: </strong>"+t.message,type:"danger",progress:100})):(n.saveUrlToDisk(e.downloadUrl),a.note.update({message:'<strong>Exported </strong> project <a href="'+e.downloadUrl+'" target="_blank">'+e.fileName+"</a>",progress:100,type:"success"})),"function"==typeof s&&s(t)})}function o(e,n,i,o,r){var s=t.start({message:"<strong>Exporting </strong> models ...",useClipboard:!0});o=o===!1?!1:!0,e.exportSelectionToFile(e.getActiveProjectId(),e.getActiveCommitHash(),i,o,function(t,e){clearInterval(s.intervalId),t?(n.error("unable to export models",t),s.note.update({message:"<strong>Failed to export: </strong>"+t.message,type:"danger",progress:100})):(s.note.update({message:'<strong>Exported </strong> models <a href="'+e.downloadUrl+'" target="_blank">'+e.fileName+"</a>",progress:100,type:"success",clipboardValue:e.hash}),s.btnEl.show()),"function"==typeof r&&r(t)})}return{exportProject:i,exportModels:o}}),define("js/Panels/Header/ProjectNavigatorController",["js/logger","js/Constants","angular","js/Loader/ProgressNotification","js/Dialogs/Projects/ProjectsDialog","js/Dialogs/Commit/CommitDialog","js/Dialogs/Merge/MergeDialog","js/Dialogs/ProjectRepository/ProjectRepositoryDialog","js/Dialogs/Branches/BranchesDialog","js/Dialogs/Confirm/ConfirmDialog","js/Dialogs/AddCommits/AddCommitsDialog","common/storage/util","js/Utils/Exporters","q","js/Utils/ComponentSettings"],function(t,e,n,i,o,r,s,a,l,c,d,h,p,g,u){"use strict";angular.module("gme.ui.ProjectNavigator",[]).run(function(){});var f;return f=function(e,n,i,o,r){var s=this;s.logger=t.create("gme:Panels:Header:ProjectNavigatorController",WebGMEGlobal.gmeConfig.client.log),s.$scope=e,s.$window=o,s.gmeClient=n,s.$timeout=i,s.$http=r,s.config=f.getDefaultConfig(),u.resolveWithWebGMEGlobal(s.config,f.getComponentId()),s.logger.debug("Resolved component-settings",s.config),s.projects={},s.config.disableProjectActions===!0?(s.navIdProject=0,s.navIdBranch=1):(s.navIdRoot=0,s.navIdProject=1,s.navIdBranch=2),s.root={id:"root",label:s.config.rootDisplayName,itemClass:s.config.rootMenuClass,menu:[]},s.requestedSelection=null,s.userId=null,s.initialize()},f.prototype.update=function(){this.logger.debug("update"),this.$timeout(function(){})},f.prototype.initialize=function(){var t,e,n=this;n.$scope.navigator={items:[],separator:!0},e=function(){var t=new o(n.gmeClient);t.show()},t=function(t){var e=new o(n.gmeClient,!0,t.newType);e.show()},n.userId=WebGMEGlobal.userInfo._id,n.config.disableProjectActions===!1&&(n.root.menu=[{id:"top",items:[{id:"manageProject",label:"Manage projects ...",iconClass:"glyphicon glyphicon-folder-open",action:e,actionData:{}},{id:"newProject",label:"New project ...",disabled:WebGMEGlobal.userInfo.canCreate!==!0,iconClass:"glyphicon glyphicon-plus",action:t,actionData:{newType:"seed"}},{id:"importProject",label:"Import project ...",disabled:WebGMEGlobal.userInfo.canCreate!==!0,iconClass:"glyphicon glyphicon-import",action:t,actionData:{newType:"import"}}]},{id:"projects",label:"Recent projects",totalItems:20,items:[],showAllItems:e}]),n.initWithClient(),n.$scope.navigator={items:n.config.disableProjectActions?[]:[n.root],separator:!0}},f.prototype.initWithClient=function(){var t=this;t.gmeClient.addEventListener(e.CLIENT.NETWORK_STATUS_CHANGED,function(n,i){var o;if(t.logger.debug("NETWORK_STATUS_CHANGED",i),i===e.CLIENT.STORAGE.CONNECTED)t.updateProjectList(function(n){return n?void t.logger.error("Failed to populate ProjectNavigator",n):void t.gmeClient.watchDatabase(function(n,i){t.logger.debug("watchDatabase event",i),i.etype===e.CLIENT.STORAGE.PROJECT_CREATED?t.gmeClient.getBranches(i.projectId,function(e,n){return e?void(e.message.indexOf("Not authorized to read project")>-1?t.logger.debug(e.message):(t.logger.error("Could not get branches for newly created project "+i.projectId),t.logger.error(e))):(t.logger.debug("Got branches before joining room:",Object.keys(n)),void t.addProject(i.projectId,null,{modifiedAt:(new Date).toISOString()},!0,function(e){return e?void t.logger.error(e):void t.gmeClient.getBranches(i.projectId,function(e,n){return e?void t.logger.error(e):(t.logger.debug("Got branches after joining room:",Object.keys(n)),void Object.keys(n).forEach(function(e){t.addBranch(i.projectId,e,{branchHash:n[e]})}))})}))}):i.etype===e.CLIENT.STORAGE.PROJECT_DELETED?t.removeProject(i.projectId):t.logger.error("Unexpected event type",i.etype)})});else if(i===e.CLIENT.STORAGE.RECONNECTED)t.updateProjectList();else if(i===e.CLIENT.STORAGE.DISCONNECTED){if(t.projects)for(o in t.projects)t.projects.hasOwnProperty(o)&&t.gmeClient.unwatchProject(o,t.projects[o]._watcher)}else i===e.CLIENT.UNCAUGHT_EXCEPTION||t.logger.error("Error network status, no actions done",i)}),t.gmeClient.addEventListener(e.CLIENT.PROJECT_OPENED,function(n,i){t.logger.debug(e.CLIENT.PROJECT_OPENED,i),t.selectProject({projectId:i})}),t.gmeClient.addEventListener(e.CLIENT.PROJECT_CLOSED,function(n,i){t.logger.debug(e.CLIENT.PROJECT_CLOSED,i),t.selectProject({})}),t.gmeClient.addEventListener(e.CLIENT.BRANCH_CHANGED,function(n,i){t.logger.debug(e.CLIENT.BRANCH_CHANGED,i),t.selectBranch({projectId:t.gmeClient.getActiveProjectId(),branchId:i})}),angular.element(t.$window).on("keydown",function(e){(e.metaKey||e.ctrlKey)&&90===e.keyCode&&(e.shiftKey?t.$timeout(function(){t.gmeClient.redo(t.gmeClient.getActiveBranchName(),function(){})}):t.$timeout(function(){t.gmeClient.undo(t.gmeClient.getActiveBranchName(),function(){})}))}),t.gmeClient.addEventListener(e.CLIENT.UNDO_AVAILABLE,function(n,i){t.logger.debug(e.CLIENT.UNDO_AVAILABLE,i),t.$timeout(function(){t.$scope.navigator&&t.$scope.navigator.items&&t.$scope.navigator.items[t.navIdBranch]&&(i?t.$scope.navigator.items[t.navIdBranch].undoLastCommitItem.disabled=!1:t.$scope.navigator.items[t.navIdBranch].undoLastCommitItem.disabled=!0)})}),t.gmeClient.addEventListener(e.CLIENT.REDO_AVAILABLE,function(n,i){t.logger.debug(e.CLIENT.REDO_AVAILABLE,i),t.$timeout(function(){t.$scope.navigator&&t.$scope.navigator.items&&t.$scope.navigator.items[t.navIdBranch]&&(i?t.$scope.navigator.items[t.navIdBranch].redoLastUndoItem.disabled=!1:t.$scope.navigator.items[t.navIdBranch].redoLastUndoItem.disabled=!0)})})},f.prototype.updateProjectList=function(t){var e=this,n={asObject:!0,rights:!0,branches:!0,info:!0};e.logger.debug("updateProjectList"),e.projects={},t=t||function(t){t&&e.logger.error(t)},e.gmeClient.getProjects(n,function(n,i){function o(t,n,i){var o=g.defer();return e.gmeClient.getCommits(t,i,1,function(r,s){r?(e.logger.error(r),o.resolve({projectId:t,branchId:n,branchHash:i,commitObject:null})):1!==s.length?(e.logger.error(new Error("Could not get commit object",t,n,i)),o.resolve({projectId:t,branchId:n,branchHash:i,commitObject:null})):o.resolve({projectId:t,branchId:n,branchHash:i,commitObject:s[0]})}),o.promise}var r,s,a=[];if(n)return void t(n);e.logger.debug("getProjects",i),e.projects={};for(r in i)if(i.hasOwnProperty(r)){e.addProject(r,i[r].rights,i[r].info,!0);for(s in i[r].branches)i[r].branches.hasOwnProperty(s)&&a.push(o(r,s,i[r].branches[s]))}g.all(a).then(function(n){n.forEach(function(t){e.addBranch(t.projectId,t.branchId,t,!0)}),e.requestedSelection?(e.selectBranch(e.requestedSelection),e.requestedSelection=null):e.update(),t(null)})["catch"](function(e){t(e)})})},f.prototype.addProject=function(t,n,i,o,r){var s,a,d,p,g,u,f,m=this;for(n=n||{"delete":!0,read:!0,write:!0},f=WebGMEGlobal.gmeConfig.authentication.enable?h.getProjectDisplayedNameFromProjectId(t):h.getProjectNameFromProjectId(t),u=function(){m.updateProjectList.call(m)},a=function(t){m.showHistory(t)},p=function(t){var e=new c;e.show({deleteItem:f},function(){m.gmeClient.deleteProject(t.projectId,function(e){e?m.logger.error("Failed deleting project",e):t.projectId===m.gmeClient.getActiveProjectId()?m.refreshPage():m.removeProject(t.projectId)})})},d=function(e){var n;m.gmeClient.getActiveProjectId()===e.projectId?(n=new l(m.gmeClient),n.show()):m.selectProject({projectId:t},function(t){var e=new l(m.gmeClient);t||e.show()})},g=function(t){m.selectProject(t)},m.projects[t]={id:t,label:f,iconClass:n.write?"":"glyphicon glyphicon-lock",iconPullRight:!n.write,projectIsReadOnly:!n.write,disabled:!n.read,itemClass:m.config.projectMenuClass,modifiedAt:i.modifiedAt,isSelected:!1,branches:{},action:g,actionData:{projectId:t},menu:[{id:"top",items:[{id:"showHistory",label:"Project history ...",iconClass:"glyphicon glyphicon-time",disabled:!n.read,action:a,actionData:{projectId:t}}]},{id:"branches",label:"Recent branches",totalItems:20,items:[],showAllItems:function(){d({projectId:t})}}],_watcher:function(n,i){var o,r;m.logger.debug("watchProject event",t,i),i.etype===e.CLIENT.STORAGE.BRANCH_CREATED?m.addBranch(t,i.branchName,{branchHash:i.newHash}):i.etype===e.CLIENT.STORAGE.BRANCH_DELETED?(m.removeBranch(t,i.branchName),o=m.$scope.navigator.items[m.navIdProject],r=m.$scope.navigator.items[m.navIdBranch],r&&r.id===i.branchName&&o.id===t&&m.gmeClient.selectCommit(m.gmeClient.getActiveCommitHash(),function(t){t&&m.logger.error("cannot select latest commit",{metadata:{error:t}}),m.logger.debug("active branch deleted, switched to last viewed commit",{metadata:{commitHash:m.gmeClient.getActiveCommitHash()}})})):i.etype===e.CLIENT.STORAGE.BRANCH_HASH_UPDATED?m.updateBranch(t,i.branchName,i.newHash):m.logger.error("Unexpected event type",i.etype)}},m.config.disableProjectActions===!1&&m.projects[t].menu[0].items.unshift({id:"deleteProject",label:"Delete project",iconClass:"glyphicon glyphicon-remove",disabled:!n["delete"],action:p,actionData:{projectId:t}}),m.gmeClient.watchProject(t,m.projects[t]._watcher,r),s=0;s<m.root.menu.length;s+=1)if("projects"===m.root.menu[s].id){m.root.menu[s].items=m.mapToArray(m.projects,[{key:"modifiedAt",reverse:!0},{key:"id"}]);break}o===!0||m.update()},f.prototype.addBranch=function(t,e,n,o){function r(t){p.exportProject(C.gmeClient,C.logger,{projectId:t.projectId,branchId:t.branchId,commitHash:t.projectId===C.gmeClient.getActiveProjectId()&&t.branchId===C.gmeClient.getActiveBranchName()?C.gmeClient.getActiveCommitHash():t.commitHash},!0)}function a(t){C.showHistory(t)}function l(t){var e=new c,n=h.getProjectDisplayedNameFromProjectId(t.projectId)+"  ::  "+t.branchId;e.show({deleteItem:n},function(){C.gmeClient.deleteBranch(t.projectId,t.branchId,t.branchInfo.branchHash,function(e){e?C.logger.error("Failed deleting branch of project.",t.projectId,t.branchId,e):C.removeBranch(t.projectId,t.branchId)})})}function g(t){var e=i.start("<strong>Merging </strong> branch "+t.branchId+" into "+C.$scope.navigator.items[C.navIdBranch].id+"...");t.projectId!==C.gmeClient.getActiveProjectId()?(C.logger.error(new Error("Cannot merge branch from a different project..")),clearInterval(e.intervalId),e.note.update({message:"<strong>Failed to merge: </strong> cannot merge branch from a different project.",type:"danger",progress:100})):C.gmeClient.autoMerge(t.projectId,t.branchId,C.$scope.navigator.items[C.navIdBranch].id,function(t,n){clearInterval(e.intervalId),e.note.update("progress",100),e.note.close();var i=new s(C.gmeClient);return t?(C.logger.error("merge of branch failed",t),void i.show(t)):void(n&&n.conflict&&n.conflict.items.length>0?(C.logger.error("merge ended in conflicts",n),i.show("merge ended in conflicts",n)):(C.logger.debug("successful merge"),i.show(null,n)))})}function u(t){C.selectBranch(t)}var f,m,_,b,y,v,C=this;if(C.projects.hasOwnProperty(t)===!1)return void C.logger.warn("project is not in the list yet: ",t);if(!C.projects[t].disabled){for(m={id:"deleteBranch",label:"Delete branch",iconClass:"glyphicon glyphicon-remove",disabled:C.projects[t].projectIsReadOnly,action:l,actionData:{projectId:t,branchId:e,branchInfo:n}},_={id:"mergeBranch",label:"Merge into current branch",iconClass:"fa fa-share-alt fa-rotate-90",disabled:C.projects[t].projectIsReadOnly,action:g,actionData:{projectId:t,branchId:e}},b={id:"addCommits",label:"Add external commits ...",iconClass:"glyphicon glyphicon-fast-forward",disabled:!0,action:function(t){C.gmeClient.getBranches(t.projectId,function(e,n){if(e)return void C.logger.error(new Error("Failed getting branches before adding commits"));var i=new d(C.gmeClient,WebGMEGlobal.gmeConfig,n);i.show(t)})},actionData:{projectId:t,branchName:e}},y={id:"undoLastCommit",label:"Undo last commit",iconClass:"fa fa-reply",disabled:!0,action:function(t){C.gmeClient.undo(t.branchId,function(){})},actionData:{projectId:t,branchId:e,branchInfo:n}},v={id:"redoLastUndo",label:"Redo last undo",iconClass:"fa fa-mail-forward",disabled:!0,action:function(t){C.gmeClient.redo(t.branchId,function(){})},actionData:{projectId:t,branchId:e,branchInfo:n}},C.projects[t].branches[e]={id:e,label:e,properties:{commitHash:n.branchHash,commitObject:n.commitObject||{time:Date.now()}},isSelected:!1,itemClass:C.config.branchMenuClass,action:u,actionData:{projectId:t,branchId:e},menu:[{items:[y,v,{id:"branchHistory",label:"Branch history ...",iconClass:"glyphicon glyphicon-time",action:a,actionData:{projectId:t,branchId:e,branchInfo:n}},{id:"createBranch",label:"Create branch ...",iconClass:"glyphicon glyphicon-plus",action:a,actionData:{projectId:t,branchId:e,branchInfo:n}},m,_,b,{id:"exportBranch",label:"Export branch",iconClass:"glyphicon glyphicon-export",action:r,actionData:{projectId:t,branchId:e,commitHash:n.branchHash}}]}]},C.projects[t].branches[e].deleteBranchItem=m,C.projects[t].branches[e].mergeBranchItem=_,C.projects[t].branches[e].undoLastCommitItem=y,C.projects[t].branches[e].redoLastUndoItem=v,C.projects[t].branches[e].applyCommitQueueItem=b,f=0;f<C.projects[t].menu.length;f+=1)if("branches"===C.projects[t].menu[f].id){C.projects[t].menu[f].items=C.mapToArray(C.projects[t].branches,[{key:"properties.commitObject.time",reverse:!0},{key:"id"}]);break}o===!0||C.update()}},f.prototype.removeProject=function(t){var e,n=this;if(n.projects.hasOwnProperty(t)){for(n.gmeClient.unwatchProject(t,n.projects[t]._watcher),delete n.projects[t],e=0;e<n.root.menu.length;e+=1)if("projects"===n.root.menu[e].id){n.root.menu[e].items=n.mapToArray(n.projects,[{key:"modifiedAt",reverse:!0},{key:"id"}]);break}t===n.gmeClient.getActiveProjectId()&&n.refreshPage(),n.update()}},f.prototype.removeBranch=function(t,e){var n,i=this;if(i.projects.hasOwnProperty(t)&&i.projects[t].branches.hasOwnProperty(e)){for(delete i.projects[t].branches[e],n=0;n<i.projects[t].menu.length;n+=1)if("branches"===i.projects[t].menu[n].id){i.projects[t].menu[n].items=i.mapToArray(i.projects[t].branches,[{key:"properties.commitObject.time",reverse:!0},{key:"id"}]);break}i.update()}},f.prototype.selectProject=function(t,e){this.selectBranch(t,e)},f.prototype.selectBranch=function(t,e){var n=this,i=t.projectId,o=t.branchId,r=n.$scope.navigator.items[n.navIdProject],s=n.$scope.navigator.items[n.navIdBranch];if(e=e||function(){},r&&r.id===i&&s&&(s.id===o||void 0===o||""===o))return void e(null);if(r&&(r.isSelected=!1),s&&(s.isSelected=!1,s.deleteBranchItem.disabled=!1,s.mergeBranchItem.disabled=!1,s.undoLastCommitItem.disabled=!0,s.redoLastUndoItem.disabled=!0,s.applyCommitQueueItem.disabled=!0,r&&r.projectIsReadOnly&&(s.deleteBranchItem.disabled=!0,s.mergeBranchItem.disabled=!0)),i||""===i){if(n.projects.hasOwnProperty(i)===!1)return n.logger.warn(i+" does not exist yet in the navigation bar, requesting selection to be loaded."),n.requestedSelection=t,void this.updateProjectList();if(n.projects[i].disabled)return r&&(r.isSelected=!0),void(s&&(s.isSelected=!0,s.deleteBranchItem.disabled=!0,s.mergeBranchItem.disabled=!0));if(n.$scope.navigator.items[n.navIdProject]=n.projects[i],n.projects[i].isSelected=!0,i!==n.gmeClient.getActiveProjectId())return void n.gmeClient.selectProject(i,null,function(t){return t?(n.logger.error(t),void e(t)):void(o&&o!==n.gmeClient.getActiveBranchName()?n.gmeClient.selectBranch(o,null,function(t){return t?(n.logger.error(t),void e(t)):void e(null)}):e(null))});if(o||""===o){if(n.projects[i].branches.hasOwnProperty(o)===!1)return n.logger.error(i+" - "+o+" branch does not exist in the navigation bar"),void(n.requestedSelection=t);if(n.$scope.navigator.items[n.navIdBranch]=n.projects[i].branches[o],n.projects[i].branches[o].isSelected=!0,n.projects[i].branches[o].deleteBranchItem.disabled=!0,n.projects[i].branches[o].mergeBranchItem.disabled=!0,n.projects[i].projectIsReadOnly===!1&&(n.projects[i].branches[o].applyCommitQueueItem.disabled=!1),o!==n.gmeClient.getActiveBranchName())return void n.gmeClient.selectBranch(o,null,function(t){return t?(n.logger.error(t),void e(t)):void e(null)})}else n.$scope.navigator.items.splice(n.navIdBranch,1)}else n.$scope.navigator.items.splice(n.navIdProject,2);e(null),n.update()},f.prototype.updateBranch=function(t,e,n){this.projects.hasOwnProperty(t)&&this.projects[t].branches.hasOwnProperty(e)?(this.projects[t].branches[e].properties={commitHash:n,commitObject:null},this.update()):this.logger.warn("project or branch is not in the list yet: ",t,e,n)},f.prototype.mapToArray=function(t,e){var n=Object.keys(t),i=n.map(function(e){return t[e]});return e=e||[],i.sort(function(t,n){var i,o,r,s,a,l,c=0;for(i=0;i<e.length;i+=1){for(r=e[i].key.split("."),o=e[i].reverse===!0?-1:1,l=r.shift(),s=t,a=n;l&&null!==s&&null!==a&&"object"==typeof s&&"object"==typeof a&&s.hasOwnProperty(l)&&a.hasOwnProperty(l);){if(0===r.length){s[l]>a[l]&&(c=1*o),s[l]<a[l]&&(c=-1*o);break}s=s[l],a=a[l],l=r.shift()}if(0!==c)break}return c}),i},f.prototype.showHistory=function(t){var e,n=this,i={start:null,branches:null};n.gmeClient.getActiveProjectId()===t.projectId?(e=new a(n.gmeClient),i.branches=Object.keys(n.projects[t.projectId].branches),i.start=t.branchId||i.branches,e.show(i)):n.selectProject({projectId:t.projectId},function(o){return o?void n.logger.error("Could not show history",o):(e=new a(n.gmeClient),i.branches=Object.keys(n.projects[t.projectId].branches),i.start=t.branchId||i.branches,void e.show(i))})},f.prototype.refreshPage=function(){document.location.href=window.location.href.split("?")[0]},f.getComponentId=function(){return"GenericUIProjectNavigatorController"},f.getDefaultConfig=function(){return{disableProjectActions:!1,rootMenuClass:"gme-root",rootDisplayName:"GME",projectMenuClass:"",branchMenuClass:""}},f}),define("text!js/Dialogs/PluginResults/templates/PluginResultsDialog.html",[],function(){return'<div class="plugin-results-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Plugin results...</h3>\n            </div>\n            <div class="modal-body">\n            </div>\n            <div class="modal-footer">\n                <a href="#" class="btn btn-primary btn-clear">Clear results</a>\n                <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/PluginResults/styles/PluginResultsDialog",[],function(){}),define("js/Dialogs/PluginResults/PluginResultsDialog",["js/util","blob/BlobClient","text!./templates/PluginResultsDialog.html","js/logger","common/storage/util","css!./styles/PluginResultsDialog.css"],function(t,e,n,i,o){"use strict";var r,s=$("<div/>",{"class":"plugin-result"}),a=$('<div class="alert"></div>'),l="alert-success",c="alert-danger",d="alert-warning",h=$('<i class="glyphicon glyphicon-ok"/>'),p=$('<i class="glyphicon glyphicon-warning-sign"/>'),g=$("<span/>",{"class":"title"}),u=$("<span/>",{"class":"time"}),f=$('<span class="btn btn-micro btn-details pull-right">Details</span>'),m=$("<div/>",{"class":"messages collapse"}),_=$('<div class="msg"><div class="msg-title"></div><div class="msg-body"></div></div>'),b=$('<span class="btn btn-micro btn-node pull-right">Show node</span>'),y=$('<div class="artifacts collapse"><div class="artifacts-title">Generated artifacts</div><div class="artifacts-body"><ul></ul></div></div>'),v=$('<div class="artifacts history collapse"><div class="artifacts-title history-title">Execution History</div><div class="history-body"><ul></ul></div></div>'),C=$('<li><span class="btn btn-micro btn-commit" title="Select commit"></span><span class="commit-msg"></span><span class="btn btn-micro btn-branch" title="Select branch"></span></li>'),E=$('<li><a href="#" target="_self">Loading...</a></li>'),D="Message #";return r=function(){this.logger=i.create("gme:Dialogs:PluginResults:PluginResultsDialog",WebGMEGlobal.gmeConfig.client.log)},r.prototype.show=function(t,e,i){var o=this;this._dialog=$(n),this._client=t,this._initDialog(e,i||null),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0}),this._dialog.modal("show")},r.prototype._initDialog=function(n,i){function r(t,e){var n,i,r,s,a,l=v.clone(),c=l.find("ul");for(a=0;a<t.length;a+=1)s=0===a?"started from":t[a].status===o.CONSTANTS.SYNCED?"updated":t[a].status===o.CONSTANTS.MERGED?"merged into":t[a].status?"forked and created":"made commit",n=C.clone(),i=n.find(".btn-commit"),i.text(t[a].commitHash.substring(0,7)),i.attr("project-id",e),i.attr("commit-hash",t[a].commitHash),
n.find(".commit-msg").text(s),r=n.find(".btn-branch").text(t[a].branchName),r.text(t[a].branchName),r.attr("project-id",e),r.attr("branch-name",t[a].branchName),c.append(n);return l}function I(t){var e=t.find(".messages"),n=t.find(".artifacts");e.toggleClass("in"),n.toggleClass("in")}var P,T,A,x,w,N,O,S,R,M,L,k,B,j,G,F,W,z,V,H,U,Y=this,X=this._dialog,J=this._client,q=X.find(".modal-body"),K="unread";for(U=function(t,e,n){n.getMetadata(t,function(i,o){if(i)return void Y.logger.error(i);var r=n.getHumanSize(o.size);G=E.clone(),F=G.find("a"),F.attr("href",n.getDownloadURL(t)),F.text(o.name+" ("+r+")"),e.append(G)})},W=0;W<n.length;W+=1){for(T=n[W],P=s.clone(),T.__unread===!0&&(P.addClass(K),delete T.__unread),z=T.getPluginName?T.getPluginName():"PluginName N/A",x=g.clone(),A=a.clone(),T.getSuccess()===!0?(A.append(h.clone()),J.getProjectObject()&&J.getProjectObject().projectId!==T.projectId?(A.addClass(d),x.text(z+" - was invoked on different project ("+o.getProjectDisplayedNameFromProjectId(T.projectId)+").")):(A.addClass(l),x.text(z))):(A.addClass(c),A.append(p.clone()),x.text(z+" - "+T.error)),A.append(x),V=T.getFinishTime?t.formattedDate(new Date(T.getFinishTime()),"elapsed"):"Time: N/A",w=u.clone(),w.text(V),A.append(w),O=f.clone(),A.append(O),N=m.clone(),M=T.getMessages(),L=0;L<M.length;L+=1)S=_.clone(),S.find(".msg-title").text(D+(L+1)),(M[L].activeNode.id||""===M[L].activeNode.id)&&(R=b.clone(),M[L].projectId=T.projectId,S.append(R),S.find(".btn-node").attr("node-result-details",JSON.stringify(M[L]))),S.find(".msg-body").html(M[L].message),N.append(S);if(k=void 0,H=new e({logger:this.logger.fork("BlobClient")}),B=T.getArtifacts(),B.length>0)for(k=y.clone(),j=k.find("ul"),L=0;L<B.length;L+=1)U(B[L],j,H);P.append(A),P.append(r(T.commits,T.projectId)),k&&P.append(k),P.append(N),T.__id===i&&I(P),q.append(P)}X.find(".btn-clear").on("click",function(){q.empty(),n.splice(0,n.length)}),X.on("click",".btn-details",function(t){I($(this).parent().parent()),t.stopPropagation(),t.preventDefault()}),X.on("click",".btn-commit",function(){var t=$(this),e=t.attr("project-id"),n=t.attr("commit-hash");J.getProjectObject()&&J.getProjectObject().projectId===e?J.selectCommit(n,function(t){t&&Y.logger.error(t)}):Y.logger.error("Project for result is not the same as open project",e)}),X.on("click",".btn-branch",function(){var t=$(this),e=t.attr("project-id"),n=t.attr("branch-name");J.getProjectObject()&&J.getProjectObject().projectId===e?J.selectBranch(n,null,function(t){t&&Y.logger.error(t)}):Y.logger.error("Project for result is not the same as open project",e)}),X.on("click",".btn-node",function(){var t=$(this),e=JSON.parse(t.attr("node-result-details")),n=e.activeNode.id,i=e.projectId,o={},r=J.addUI(this,function(t){var e=!1;t.forEach(function(t){"load"===t.etype&&t.eid===n&&(e=!0)}),e?(WebGMEGlobal.State.registerActiveObject(n),WebGMEGlobal.State.registerActiveSelection([]),X.modal("hide")):Y.logger.error("Could not load the linked node at path",n),J.removeUI(r)});J.getProjectObject()&&J.getProjectObject().projectId===i?(r=J.addUI(this,function(t){var e=!1;t.forEach(function(t){"load"===t.etype&&t.eid===n&&(e=!0)}),e?(WebGMEGlobal.State.registerActiveObject(n),WebGMEGlobal.State.registerActiveSelection([]),X.modal("hide")):Y.logger.error("Could not load the linked node at path",n),J.removeUI(r)}),o[n]={children:0},J.updateTerritory(r,o)):Y.logger.error("Project for result is not the same as open project",i)})},r}),define("js/Panels/Header/PluginToolbar",["js/Dialogs/PluginResults/PluginResultsDialog","common/util/guid"],function(t,e){"use strict";var n,i="glyphicon glyphicon-cog",o=$('<span class="label label-info"></span>');return n=function(t){this._client=t,this._results=[],this.$btnExecutePlugin=null,this._initialize()},n.prototype._initialize=function(){var n,r,s,a,l,c=this,d=WebGMEGlobal.Toolbar,h=this._client,p=0,g="label";a=function(t){c.$btnExecutePlugin.el.find("."+g).text(t)},n=function(){var t=WebGMEGlobal.gmeConfig.plugin.displayAll?WebGMEGlobal.allPlugins:h.filterPlugins(WebGMEGlobal.allPlugins,WebGMEGlobal.State.getActiveObject()),e=function(t){r(t)},n=h.getProjectAccess();c.$btnExecutePlugin.clear(),c._results.length>0&&(c.$btnExecutePlugin.addButton({title:"Show results...",text:"Show results...",clickFn:function(){var t;1===p&&c._results.length>0&&(t=c._results[0].__id),s(t)}}),t.length>0&&c.$btnExecutePlugin.addDivider()),t.forEach(function(t){var o=WebGMEGlobal.allPluginsMetadata[t],r={title:o.id+" v"+o.version+" - "+o.description,text:o.name,data:o,clickFn:e,disabled:o.writeAccessRequired===!0&&n.write===!1,icon:$('<i class="plugin-icon"/>')};o.icon.src?(r.icon=$("<img/>",{src:["/plugin",o.id,o.id,o.icon.src].join("/")}),r.icon.addClass(o.icon["class"])):o.icon["class"]?r.icon.addClass(o.icon["class"]):r.icon.addClass(i),r.icon.addClass("plugin-icon"),r.icon.css({width:"14px","margin-right":"4px"}),c.$btnExecutePlugin.addButton(r)})},r=function(t){WebGMEGlobal.InterpreterManager.configureAndRun(t,function(t){if(t!==!1){var n,o=WebGMEGlobal.allPluginsMetadata[t.pluginId],r=" "+o.id+" ";t.__unread=!0,t.__id=e(),c._results.splice(0,0,t),c.$btnExecutePlugin.el.find(".btn").disable(!1),p+=1,r+=t.success?"finished with success! (click for details)":"failed (click for details), error: "+t.error,n=$.notify({icon:o.icon["class"]?o.icon["class"]:i,message:r},{delay:1e4,type:t.success?"success":"danger",offset:{x:20,y:37},mouse_over:"pause",onClose:function(){n.$ele.off()}}),n.$ele.css("cursor","pointer"),n.$ele.on("click",function(){c._results.length>0&&s(t.__id),n.close()}),p>0&&a(p)}})},s=function(e){var n=new t;n.show(h,c._results,e),p=0,a("")},this.$btnExecutePlugin=d.addDropDownButton({title:"Execute plug-in",icon:"glyphicon glyphicon-play",menuClass:"no-min-width",clickFn:function(){n()}}),this.$btnExecutePlugin.el.find("a > i").css({"margin-top":"0px"}),l=o.clone(),l.insertAfter(this.$btnExecutePlugin.el.find("a > i")),l.css("margin-left","3px")},n.prototype.disableButtons=function(t){t=t&&0===this._results.length,this.$btnExecutePlugin.el.find(".btn").disable(t)},n}),define("text!js/Dialogs/ConstraintCheckResults/templates/ConstraintCheckResultsDialog.html",[],function(){return'<div class="constraint-check-results-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Constraint Validation Results</h3>\n            </div>\n            <div class="modal-body">\n            </div>\n            <div class="modal-footer">\n                <a href="#" class="btn btn-primary btn-clear">Clear results</a>\n                <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/ConstraintCheckResults/styles/ConstraintCheckResultsDialog",[],function(){}),define("js/Dialogs/ConstraintCheckResults/ConstraintCheckResultsDialog",["js/util","common/regexp","js/logger","text!./templates/ConstraintCheckResultsDialog.html","css!./styles/ConstraintCheckResultsDialog.css"],function(t,e,n,i){"use strict";var o=function(t){this._dialogTitle=t,this.logger=n.create("gme:Dialogs:ConstraintCheckResults:ConstraintCheckResultsDialog",WebGMEGlobal.gmeConfig.client.log),this.logger.debug("ctor")},r=$("<div/>",{"class":"constraint-check-result"}),s=$('<div class="alert"></div>'),a="alert-success",l="alert-danger",c=$('<i class="glyphicon glyphicon-ok"/>'),d=$('<i class="glyphicon glyphicon-warning-sign"/>'),h=$("<span/>",{"class":"title"}),p=$("<span/>",{"class":"time"}),g=$('<span class="btn btn-micro btn-details pull-right result-details"><i class="glyphicon glyphicon-plus"/></span>'),u=$("<div/>",{"class":"messages collapse"}),f=$("<div/>",{"class":"constraint-check-result"}),m=$('<span class="btn btn-micro btn-node pull-left"><i class="glyphicon glyphicon-link"/></span>'),_=$('<div class="msg"><div class="msg-title"></div><div class="msg-body"></div></div>');return o.prototype.show=function(t,e){var n=this;this._dialog=$(i),this._dialogTitle&&this._dialog.find("h3").first().text(this._dialogTitle),this._client=t,this._initDialog(e),this._dialog.on("hidden.bs.modal",function(){n._dialog.remove(),n._dialog.empty(),n._dialog=void 0}),this._dialog.modal("show")},o.prototype._initDialog=function(n){var i,o,b,y,v,C,E,D,I,P,T,A,x,w,N,O=this._dialog,S=this._client,R=this,M=O.find(".modal-body"),L="unread";for(x=0;x<n.length;x+=1){o=n[x],i=r.clone(),o.__unread===!0&&(i.addClass(L),delete o.__unread),b=s.clone(),o.hasViolation===!0?(b.addClass(l),b.append(d.clone())):(b.append(c.clone()),b.addClass(a));var k=o.info||"unspecified checking";y=h.clone(),y.text(k),b.append(y);var B=o.__time?t.formattedDate(new Date(o.__time),"elapsed"):"Time: N/A";for(v=p.clone(),v.text(B),b.append(v),D=g.clone(),D.addClass("main-details"),b.append(D),E=Object.keys(o),w=E.length;--w>=0;)e.GUID.test(E[w])&&o[E[w]].hasViolation===!0||E.splice(w,1);for(C=u.clone(),w=0;w<E.length;w++){for(I=f.clone(),I.attr("GMEpath",o[E[w]]._path),I.append(m.clone()),y=h.clone(),y.text(o[E[w]]._name),I.append(y),D=g.clone(),I.append(D),T=Object.keys(o[E[w]]),N=T.length;--N>=0;)o[E[w]][T[N]].hasViolation||T.splice(N,1);for(P=u.clone(),N=0;N<T.length;N++)A=_.clone(),A.find(".msg-title").text(T[N]),A.find(".msg-body").html(o[E[w]][T[N]].message),P.append(A);I.append(P),C.append(I)}b.append(C),0===w&&D.addClass("no-details-available"),i.append(b),M.append(i)}O.find(".btn-clear").on("click",function(){M.empty(),n.splice(0,n.length)}),O.on("click",".btn-details",function(t){$(this).siblings(".messages").toggleClass("in"),$(this).children(".glyphicon-plus").length>0?$(this).html('<i class="glyphicon glyphicon-minus"/>'):$(this).html('<i class="glyphicon glyphicon-plus"/>'),t.stopPropagation(),t.preventDefault()}),O.on("click",".btn-node",function(){var t=$(this).parent().attr("GMEpath"),e={},n=S.addUI(this,function(e){var i=!1;e.forEach(function(e){"load"===e.etype&&e.eid===t&&(i=!0)}),S.removeUI(n),i?(WebGMEGlobal.State.registerActiveObject(t),WebGMEGlobal.State.registerActiveSelection([]),O.modal("hide")):R.logger.error("Could not load the linked node at path",t)});e[t]={children:0},S.updateTerritory(n,e)})},o}),define("js/Panels/Header/ConstraintToolbar",["js/Dialogs/ConstraintCheckResults/ConstraintCheckResultsDialog"],function(t){"use strict";var e,n=$('<span class="label label-info"></span>');return e=function(t){this._client=t,this._initialize()},e.prototype._initialize=function(){function e(t,e){var n,i;for(n=0;n<e.length;n+=1)i=e[n],i.__time=(new Date).getTime(),i.__unread=!0,p.splice(0,0,i),d+=1,s(d)}var i,o,r,s,a,l=this,c=WebGMEGlobal.Toolbar,d=0,h="label",p=[];s=function(t){o.el.find("."+h).text(t)},i=function(){var t;o.clear(),l._client.getActiveProjectId()?(p.length>0&&(o.addButton({title:"Show results...",text:"Show results...",clickFn:function(){r()}}),o.addDivider()),o.addButton({title:"Check entire project",text:"Check constraints for entire project",clickFn:function(){l._client.checkCustomConstraints([""],!0)}}),t=WebGMEGlobal.State.getActiveObject(),t&&(o.addButton({title:"Check custom constraints node",text:"Check constraints for node ["+t+"]",clickFn:function(){l._client.checkCustomConstraints([t],!0)}}),o.addButton({title:"Check constraints model",text:"Check constraints for node ["+t+"] and its children...",clickFn:function(){l._client.checkCustomConstraints([t],!0)}}))):o.addButton({title:"No Project is opened",text:"No Project is opened...",clickFn:function(){}})},l._client.addEventListener(l._client.CONSTANTS.CONSTRAINT_RESULT,e),r=function(){var e=new t;e.show(l._client,p),d=0,s("")},o=c.addDropDownButton({title:"Custom Constraints",icon:"glyphicon glyphicon-fire",menuClass:"no-min-width",clickFn:function(){i()}}),o.el.find("a > i").css({"margin-top":"0px"}),a=n.clone(),a.insertAfter(o.el.find("a > i")),a.css("margin-left","3px")},e}),define("js/Panels/Header/MetaRulesToolbar",["js/Dialogs/ConstraintCheckResults/ConstraintCheckResultsDialog"],function(t){"use strict";var e,n=$('<span class="label label-info"></span>');return e=function(t){this._client=t,this._initialize()},e.prototype._initialize=function(){function e(t,e){var n,i;for(n=0;n<e.length;n+=1)i=e[n],i.__time=(new Date).getTime(),i.__unread=!0,p.splice(0,0,i),d+=1,s(d)}var i,o,r,s,a,l=this,c=WebGMEGlobal.Toolbar,d=0,h="label",p=[];s=function(t){o.el.find("."+h).text(t)},i=function(){var t;o.clear(),l._client.getActiveProjectId()?(p.length>0&&(o.addButton({title:"Show results...",text:"Show results...",clickFn:function(){r()}}),o.addDivider()),o.addButton({title:"Check meta rules for entire project",text:"Check meta rules for entire project",clickFn:function(){l._client.checkMetaRules([""],!0)}}),t=WebGMEGlobal.State.getActiveObject(),t&&(o.addButton({title:"Check meta rules model",text:"Check meta rules for model ["+t+"]",clickFn:function(){l._client.checkMetaRules([t],!0)}}),o.addButton({title:"Check meta rules model",text:"Check meta rules for node ["+t+"] and its children...",clickFn:function(){l._client.checkMetaRules([t],!0)}}))):o.addButton({title:"No Project is opened",text:"No Project is opened...",clickFn:function(){}})},l._client.addEventListener(l._client.CONSTANTS.META_RULES_RESULT,e),r=function(){var e=new t("Meta Rules Validation Results");e.show(l._client,p),d=0,s("")},o=c.addDropDownButton({title:"Meta Rules",icon:"glyphicon glyphicon-ok-sign",menuClass:"no-min-width",clickFn:function(){i()}}),o.el.find("a > i").css({"margin-top":"0px"}),a=n.clone(),a.insertAfter(o.el.find("a > i")),a.css("margin-left","3px")},e}),define("js/Panels/Header/DefaultToolbar",["js/util","js/Constants","js/Dialogs/Projects/ProjectsDialog","js/Dialogs/Commit/CommitDialog","js/Dialogs/ProjectRepository/ProjectRepositoryDialog","./PluginToolbar","./ConstraintToolbar","./MetaRulesToolbar"],function(t,e,n,i,o,r,s,a){"use strict";var l;return l=function(t,e){this._client=t,this._pluginToolBar=null,this._metaRulesToolBar=null,this._constraintToolBar=null,this._initialize()},l.prototype._initialize=function(){function t(){var t=WebGMEGlobal.State.getActiveObject(),e=WebGMEGlobal.allPlugins,i=[];"undefined"!=typeof t?(i=n._client.filterPlugins(e,t),0===i.length?n._pluginToolBar.disableButtons(!0):n._pluginToolBar.disableButtons(!1)):n._pluginToolBar.disableButtons(!0)}var n=this;this._pluginToolBar=new r(this._client),this._metaRulesToolBar=new a(this._client),this._client.gmeConfig.core.enableCustomConstraints===!0&&(this._constraintToolBar=new s(this._client)),n._pluginToolBar.disableButtons(!0),WebGMEGlobal.State.on("change:"+e.STATE_ACTIVE_OBJECT,t),this._client.addEventListener(this._client.CONSTANTS.PROJECT_OPENED,t),this._client.addEventListener(this._client.CONSTANTS.BRANCH_CHANGED,t),this._client.addEventListener(this._client.CONSTANTS.BRANCH_STATUS_CHANGED,t)},l.prototype._createDummyControls=function(){var t=WebGMEGlobal.Toolbar;t.addSeparator(),t.addButton({title:"Commit1...",icon:"glyphicon glyphicon-share",clickFn:function(){console.log("Commit1...")}});var e=t.addRadioButtonGroup(function(t){console.log(JSON.stringify(t))});e.addButton({title:"Radio button 1",icon:"glyphicon glyphicon-align-left",data:{type:"1"}}),e.addButton({title:"Radio button 2",icon:"glyphicon glyphicon-align-center",data:{type:"2"}}),e.addButton({title:"Radio button 3",icon:"glyphicon glyphicon-align-right",data:{type:"3"}}),t.addToggleButton({title:"Toggle button",icon:"glyphicon glyphicon-plane",clickFn:function(t,e){console.log("toggled: "+e)}}),t.addTextBox({prependContent:'<i class="glyphicon glyphicon-search"></i>&nbsp;',placeholder:"Find...",textChangedFn:function(t,e){console.log(e)},onEnterFn:function(t){console.log(t)}});var n=t.addLabel();n.text("Something:"),t.addCheckBox({title:"BLA",checkChangedFn:function(t,e){console.log("checked: "+e+", data: "+JSON.stringify(t))}});var i=t.addDropDownButton({text:"Create..."});i.addButton({title:"Create 1 item",icon:"glyphicon glyphicon-plus-sign",text:"1 item",data:{howmany:1},clickFn:function(t){console.log(JSON.stringify(t))}}),i.addDivider(),i.addButton({title:"Create 10 items",icon:"glyphicon glyphicon-plus-sign",text:"10 items",data:{howmany:10},clickFn:function(t){console.log(JSON.stringify(t))}}),i.addCheckBox({text:"check1",data:{idx:1},checkChangedFn:function(t,e){console.log("checked: "+e+" , "+JSON.stringify(t))}})},l}),define("js/Panels/Header/HeaderPanel",["js/PanelBase/PanelBase","js/Widgets/ProjectTitle/ProjectTitleWidget","js/Widgets/UserProfile/UserProfileWidget","js/Widgets/ConnectedUsers/ConnectedUsersWidget","js/Toolbar/Toolbar","./ProjectNavigatorController","./DefaultToolbar","js/Utils/WebGMEUrlManager","js/Utils/ComponentSettings"],function(t,e,n,i,o,r,s,a,l){"use strict";var c,d=t;return angular.module("gme.ui.headerPanel",["isis.ui.dropdownNavigator","gme.ui.ProjectNavigator"]).run(["$rootScope","$location",function(t,e){var n;WebGMEGlobal&&WebGMEGlobal.State?WebGMEGlobal.State.on("change",function(i,o){var r=a.serializeStateToUrl();o.suppressHistoryUpdate||n===r||(e.state(WebGMEGlobal.State.toJSON()),e.search(r),n=r,t.$$phase||t.$apply())}):console.error("WebGMEGlobal.State does not exist, cannot update url based on state changes.")}]),c=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="HeaderPanel",d.apply(this,[i]),this._client=n.client,this._config=c.getDefaultConfig(),l.resolveWithWebGMEGlobal(this._config,c.getComponentId()),this._initialize(),this.logger.debug("HeaderPanel ctor finished")},_.extend(c.prototype,d.prototype),c.prototype._initialize=function(){var t,e,a,l,c,d=$("<div/>",{"class":"navbar navbar-inverse navbar-fixed-top"}),h=$("<div/>",{"class":"navbar-inner"});d.append(h),this.$el.append(d),t=angular.module("gmeApp"),t.controller("ProjectNavigatorController",["$scope","gmeClient","$timeout","$window","$http",r]),e=$('<div style="display: inline;" data-ng-controller="ProjectNavigatorController"><dropdown-navigator style="display: inline-block;" navigator="navigator"></dropdown-navigator></div>',{"class":"inline"}),h.append(e),h.append($('<div class="spacer pull-right"></div>')),this._config.disableUserProfile===!1&&WebGMEGlobal.gmeConfig.authentication.enable===!0&&(a=$("<div/>",{"class":"inline pull-right",style:"padding: 6px 0px;"}),this.defaultUserProfileWidget=new n(a,this._client),h.append(a)),c=$("<div/>",{"class":"inline pull-right",style:"padding: 6px 0px;"}),this.connectedUsersWidget=new i(c,this._client),h.append(c),l=$("<div/>",{"class":"toolbar-container"}),this.$el.append(l),WebGMEGlobal.Toolbar=o.createToolbar(l),new s(this._client)},c.getDefaultConfig=function(){return{disableUserProfile:!1}},c.getComponentId=function(){return"GenericUIPanelHeader"},c}),define("js/Controls/DropDownMenu",["jquery"],function(){"use strict";var t,e="disabled";return t=function(t){this._initialize(t)},t.prototype.onItemClicked=function(){},t.prototype.onDropDownMenuOpen=function(){},t.prototype.appendTo=function(t){this._el.appendTo(t)},t.prototype.getEl=function(){return this._el},t.prototype.addItem=function(t){return this._addItem(t)},t.prototype.clear=function(t){this._clear(t)},t.prototype._DOMBase=$('<div class="btn-group"><button class="btn"></button><button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"></ul></div>'),t.prototype._initialize=function(t){var e=this;if(this._sorted=!1,this._el=this._DOMBase.clone(),this._btnSelected=this._el.find(".btn").first(),this._btnDropDownToggle=this._el.find(".dropdown-toggle").first(),this._ul=this._el.find("ul.dropdown-menu"),this.clear(),t){if(t.dropUp===!0&&this._el.addClass("dropup"),t.pullRight===!0&&this._el.addClass("pull-right"),t.size)switch(t.size){case"large":case"mini":case"micro":this._btnSelected.addClass("btn-"+t.size),this._btnDropDownToggle.addClass("btn-"+t.size)}t.sort===!0&&(this._sorted=!0),t.icon&&"string"==typeof t.icon&&""!==t.icon&&(this._icon=$('<i class="'+t.icon+'"></i>'))}this._ul.on("click","li",function(){e._onItemClick($(this))}),this._btnSelected.on("click","",function(t){e._btnDropDownToggle.trigger("click"),t.stopPropagation()}),this._btnDropDownToggle.on("click","",function(){e.onDropDownMenuOpen()})},t.prototype._addItem=function(t){var e;if(e=t.html?$(t.html):$('<li><a href="#">'+t.text+"</a></li>"),e.data("val",t.value),this._sorted===!1)this._ul.append(e);else{for(var n,i=this._ul.children(),o=i.length;o--;){var r=$(i[o]);if(t.text>=r.find("> a").text()){n=r;break}}n?e.insertAfter(n):this._ul.prepend(e)}return 0===this._ul.parent().length&&(this._el.append(this._btnDropDownToggle),this._el.append(this._ul)),e},t.prototype._clear=function(t){this._ul.empty(),t!==!0&&(this._ul.detach(),this._el.removeClass("open"),this._btnDropDownToggle.detach())},t.prototype._onItemClick=function(t){var e=t.data("val");this.onItemClicked(e)},t.prototype.setTitle=function(t){this._btnSelected.text(t),this._icon&&this._btnSelected.prepend(this._icon)},t.prototype.setEnabled=function(t){t?(this._btnSelected.removeClass(e),this._btnDropDownToggle.removeClass(e)):(this._btnSelected.addClass(e),this._btnDropDownToggle.addClass(e))},t.prototype.COLORS={BLUE:0,LIGHT_BLUE:1,GREEN:2,ORANGE:3,RED:4,BLACK:5,GRAY:6},t.prototype._colorClasses=["btn-primary","btn-info","btn-success","btn-warning","btn-danger","btn-inverse","btn-gray"],t.prototype.setColor=function(t){this.removeColor(),this._colorClasses.hasOwnProperty(t)&&(this._btnSelected.addClass(this._colorClasses[t]),this._btnDropDownToggle.addClass(this._colorClasses[t]))},t.prototype.removeColor=function(){for(var t=this._colorClasses.length;t--;)this._btnSelected.removeClass(this._colorClasses[t]),this._btnDropDownToggle.removeClass(this._colorClasses[t])},t}),define("css!js/Controls/styles/PopoverBox",[],function(){}),define("js/Controls/PopoverBox",["jquery","css!./styles/PopoverBox.css"],function(){"use strict";var t,e=2e3;return t=function(t){this._el=t,this._timeout=null},t.prototype.show=function(t,n,i){var o=this._el,r=i===!0||i>0;i===!0&&(i=e),clearTimeout(this._timeout),o.addClass("pobox"),o.popover({placement:"top",content:t,container:this._el}),o.popover("show"),o.find(".popover").addClass("pobox"),o.popover("show"),n&&o.find(".popover").addClass(n),r===!0&&(this._timeout=setTimeout(function(){o.popover("destroy")},i))},t.prototype.alertLevels={SUCCESS:"ddwa-success",WARNING:"ddwa-warning",ERROR:"ddwa-error",INFO:"ddwa-info",success:"ddwa-success",warning:"ddwa-warning",warn:"ddwa-warning",error:"ddwa-error",info:"ddwa-info"},t}),define("js/Widgets/NetworkStatus/NetworkStatusWidget",["js/logger","js/Controls/DropDownMenu","js/Controls/PopoverBox","js/Constants"],function(t,e,n,i){"use strict";var o,r="connect",s="refresh",a="logout",l="downloadError";return o=function(e,n){this._logger=t.create("gme:Widgets:NetworkStatus:NetworkStatusWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=e,this._urlAtDisconnect="",this._initializeUI(),this._logger.debug("Created")},o.prototype._initializeUI=function(){var t=this,n=this._client.getNetworkStatus();this._el.empty(),this._ddNetworkStatus=new e({dropUp:!0,pullRight:!0,size:"micro",sort:!0}),this._ddNetworkStatus.setTitle("NETWORKSTATUS"),this._el.append(this._ddNetworkStatus.getEl()),this._ddNetworkStatus.onItemClicked=function(e){e===r||(e===s?document.location.href=t._urlAtDisconnect:e===a?document.location.href="/logout":e===l&&t._client.downloadError())},this._client.addEventListener(i.CLIENT.NETWORK_STATUS_CHANGED,function(e,n){t._refreshNetworkStatus(n)}),this._refreshNetworkStatus(n)},o.prototype._refreshNetworkStatus=function(t){switch(this._logger.debug("_refreshNetworkStatus",t),t){case i.CLIENT.STORAGE.CONNECTED:this._modeConnected();break;case i.CLIENT.STORAGE.RECONNECTED:this._modeReconnected();break;case i.CLIENT.STORAGE.DISCONNECTED:this._urlAtDisconnect=window.location.href,this._modeDisconnected();break;case i.CLIENT.STORAGE.INCOMPATIBLE_CONNECTION:this._modeIncompatible();break;case i.CLIENT.STORAGE.JWT_EXPIRED:this._modeTokenExpired();break;case i.CLIENT.STORAGE.CONNECTION_ERROR:this._modeError();break;case i.CLIENT.UNCAUGHT_EXCEPTION:this._modeUncaughtException()}},o.prototype._modeConnected=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("CONNECTED"),this._ddNetworkStatus.setColor(e.prototype.COLORS.GREEN),this._disconnected===!0&&(this._popoverBox.show("Connected to the server",this._popoverBox.alertLevels.SUCCESS,!0),delete this._disconnected)},o.prototype._modeReconnected=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("RECONNECTED"),this._ddNetworkStatus.setColor(e.prototype.COLORS.GREEN),this._disconnected===!0&&(this._popoverBox.show("Connection to the server has been restored...",this._popoverBox.alertLevels.SUCCESS,!0),delete this._disconnected)},o.prototype._modeDisconnected=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("DISCONNECTED"),this._ddNetworkStatus.addItem({text:"Awaiting automatic reconnect...",value:r}),this._ddNetworkStatus.setColor(e.prototype.COLORS.ORANGE),this._disconnected=!0,this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("Connection to the server has been lost...",this._popoverBox.alertLevels.WARNING,!1)},o.prototype._modeIncompatible=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("INCOMPATIBLE_CONNECTION"),this._ddNetworkStatus.setColor(e.prototype.COLORS.RED),this._ddNetworkStatus.addItem({text:"Refresh...",value:s}),this._disconnected=!0,this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("New connection is not compatible with client - refresh required.",this._popoverBox.alertLevels.ERROR,!0)},o.prototype._modeTokenExpired=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("AUTH_TOKEN_EXPIRED"),this._ddNetworkStatus.setColor(e.prototype.COLORS.RED),this._ddNetworkStatus.addItem({text:"Logout...",value:a}),this._disconnected=!0,this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("Token has expired - a new login is required.",this._popoverBox.alertLevels.ERROR,!0)},o.prototype._modeError=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("CONNECTION_ERROR"),this._ddNetworkStatus.setColor(e.prototype.COLORS.RED),this._ddNetworkStatus.addItem({text:"Refresh...",value:s}),this._disconnected=!0,this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("Unexpected connection error - refresh required.",this._popoverBox.alertLevels.ERROR,!0)},o.prototype._modeUncaughtException=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("UNCAUGHT_EXCEPTION"),this._ddNetworkStatus.setColor(e.prototype.COLORS.RED),this._ddNetworkStatus.addItem({text:"Refresh...",value:s}),this._ddNetworkStatus.addItem({text:"Download error data",value:l}),this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("Uncaught exception - click here for actions",this._popoverBox.alertLevels.ERROR,!0)},o}),define("js/Widgets/BranchStatus/BranchStatusWidget",["js/logger","js/Controls/DropDownMenu","js/Controls/PopoverBox","js/Dialogs/Merge/MergeDialog","js/Constants"],function(t,e,n,i,o){"use strict";var r,s="fork",a="follow",l="merge",c="select",d="downloadError",h="downloadCommitQueue";return r=function(e,n){this._logger=t.create("gme:Widgets:BranchStatusWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=e,this._eventData=null,this._initializeUI(),this._logger.debug("Created")},r.prototype._initializeUI=function(){var t=this;this._el.empty(),this._ddBranchStatus=new e({dropUp:!0,pullRight:!0,size:"micro",sort:!0}),this._ddBranchStatus.setTitle("BRANCHSTATUS"),this._el.append(this._ddBranchStatus.getEl()),this._ddBranchStatus.onItemClicked=function(e){var n=t._client.getActiveBranchName(),o=t._client.getActiveProjectId();e===s?t._client.forkCurrentBranch(null,null,function(e,i){e?(t._logger.error("could not fork the branch",n),t._client.selectBranch(n,null,function(e){if(e)throw t._logger.error("could not re-select the branch",n),e})):t._client.selectBranch(i,null,function(e){if(e)throw t._logger.error("Could not select new branch",i),e})}):e===a?t._client.selectBranch(n,null,function(e){if(e)throw t._logger.error("could not re-select the branch",n),new Error(e)}):e===l?t._client.forkCurrentBranch(null,null,function(e,r,s){e?(t._logger.error("could not fork the branch",n),t._client.selectBranch(n,null,function(e){if(e)throw t._logger.error("could not re-select the branch",n),new Error(e)})):t._client.autoMerge(o,r,n,function(e,a){var l=new i(t.gmeClient);return e?(t._logger.error("Merging resulted in error",e),t._logger.info("Trying to select fork",r),void t._client.selectBranch(r,null,function(e){if(e)throw t._logger.error("Could not select new branch",r),new Error(e)})):void(a&&a.conflict&&a.conflict.items.length>0?(t._logger.error("merge had conflicts",a.conflict),t._client.selectBranch(r,null,function(e){if(e)throw t._logger.error("Could not select the new branch",r),new Error(e)})):(t._logger.debug("Merge was successful"),t._client.selectBranch(n,null,function(e){if(e)throw t._logger.error("could not select the branch after merge",n),new Error(e);l.show(null,a)}),t._client.deleteBranch(o,r,s,function(e){e&&t._logger.error("Could delete temporary branch after merge",r)})))})}):e===c?t._client.selectBranch(n,null,function(e){e?t._logger.error(e):t._logger.debug("branch selected: ",n)}):e===d?t._client.downloadError():e===h&&t._client.downloadCommitQueue()},this._client.addEventListener(o.CLIENT.BRANCH_STATUS_CHANGED,function(e,n){t._refreshBranchStatus(n)}),this._refreshBranchStatus({status:this._client.getBranchStatus()}),window.addEventListener("beforeunload",function(e){var n,i=t._client.getCommitQueue();return i.length>0?(n="There are "+i.length+" commit(s) in your commitQueue. You will loose this data unless you take an action in the branch status (footer) widget.",e.returnValue=n,n):void 0})},r.prototype._refreshBranchStatus=function(t){var e=t.status;switch(this._eventData=t,e){case o.CLIENT.BRANCH_STATUS.SYNC:this._branchInSync();break;case o.CLIENT.BRANCH_STATUS.AHEAD_NOT_SYNC:this._branchAheadNotSync(t);break;case o.CLIENT.BRANCH_STATUS.AHEAD_SYNC:this._branchAhead(t);break;case o.CLIENT.BRANCH_STATUS.MERGING:this._branchMerging(t);break;case o.CLIENT.BRANCH_STATUS.PULLING:this._branchPulling(t);break;case o.CLIENT.BRANCH_STATUS.ERROR:this._branchError(t);break;default:this._noBranch()}},r.prototype._branchInSync=function(){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("IN SYNC"),this._ddBranchStatus.setColor(e.prototype.COLORS.GREEN),this._outOfSync===!0&&(this._popoverBox.show("Back in sync...",this._popoverBox.alertLevels.SUCCESS,!0),delete this._outOfSync)},r.prototype._branchAheadNotSync=function(t){this._ddBranchStatus.clear(),this._outOfSync=!0,this._client.isConnected()&&(this._ddBranchStatus.addItem({text:"Create a branch with local changes.",value:s}),this._ddBranchStatus.addItem({text:"Drop local changes and follow branch.",value:a}),this._ddBranchStatus.addItem({text:"Attempt to merge in local changes.",value:l})),this._ddBranchStatus.addItem({text:"Download local changes.",value:h}),this._ddBranchStatus.setTitle("AHEAD["+t.commitQueue.length+"]"),this._ddBranchStatus.setColor(e.prototype.COLORS.ORANGE),this._popoverBox=this._popoverBox||new n(this._ddBranchStatus.getEl()),this._popoverBox.show("You are out of sync from the origin.",this._popoverBox.alertLevels.WARNING,!0)},r.prototype._branchAhead=function(t){this._ddBranchStatus.clear(),this._ddBranchStatus.addItem({text:"Download local changes.",value:h}),this._ddBranchStatus.setTitle("AHEAD["+t.commitQueue.length+"]"),this._ddBranchStatus.setColor(e.prototype.COLORS.LIGHT_BLUE)},
r.prototype._branchMerging=function(t){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("MERGING["+t.commitQueue.length+"]"),this._ddBranchStatus.setColor(e.prototype.COLORS.BLUE)},r.prototype._branchPulling=function(t){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("PULLING["+t.updateQueue.length+"]"),this._ddBranchStatus.setColor(e.prototype.COLORS.GRAY)},r.prototype._branchError=function(t){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("ERROR"),this._ddBranchStatus.setColor(e.prototype.COLORS.RED),this._popoverBox=this._popoverBox||new n(this._ddBranchStatus.getEl()),this._popoverBox.show("Critical error - detached from branch.",this._popoverBox.alertLevels.ERROR,!0),this._ddBranchStatus.addItem({text:"Reselect branch",value:c}),this._ddBranchStatus.addItem({text:"Download error data",value:d})},r.prototype._noBranch=function(){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("NO BRANCH"),this._ddBranchStatus.setColor(e.prototype.COLORS.GRAY),this._outOfSync=!1},r}),define("js/Widgets/KeyboardManager/KeyboardManagerWidget",["js/logger","js/Controls/iCheckBox"],function(t,e){"use strict";var n;return n=function(e){this._logger=t.create("gme:Widgets:KeyboardManager:KeyboardManagerWidget",WebGMEGlobal.gmeConfig.client.log),this._el=e,this._initializeUI(),this._logger.debug("Created")},n.prototype._initializeUI=function(){this.__checkbox=new e({checkedText:"ON",uncheckedText:"OFF",icon:"gme icon-gme_keyboard",checkChangedFn:function(t,e){WebGMEGlobal.KeyboardManager.setEnabled(e)}}),this._el.append(this.__checkbox.el)},n}),define("css!js/Widgets/Notification/styles/NotificationWidget",[],function(){}),define("js/Widgets/Notification/NotificationWidget",["js/logger","js/Controls/DropDownMenu","js/Controls/PopoverBox","js/Constants","css!./styles/NotificationWidget.css"],function(t,e,n,i){"use strict";var o,r="clearAll",s='<li><a class="notification-drop-down-menu-item notification-drop-down-menu-item-clear empty">Clear Notifications<i class="glyphicon glyphicon-trash clear-all-icon pull-right"/></a></li>';return o=function(e,n){this._logger=t.create("gme:Widgets:NotificationWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=e,this._el.addClass("notification-widget"),this._notifications=[],this._initializeUI(),this._logger.debug("Created")},o.prototype._initializeUI=function(){var t=this;this._el.empty(),this._ddNotification=new e({dropUp:!0,pullRight:!0,size:"micro"}),this._ddNotification.setTitle("NOTIFICATIONS [0]"),this._ddNotification.setColor(e.prototype.COLORS.BLUE),this._ddNotification.onItemClicked=function(e){e===r&&(t._notifications=[],t._ddNotification.clear(),t._ddNotification.setTitle("NOTIFICATIONS [0]"))},this._el.append(this._ddNotification.getEl()),this._popoverBox=this._popoverBox||new n(this._ddNotification.getEl()),this._client.addEventListener(i.CLIENT.NOTIFICATION,function(e,n){t._refreshNotifications(n)})},o.prototype._refreshNotifications=function(t){var e=this,n=e._popoverBox.alertLevels[t.severity]||e._popoverBox.alertLevels.INFO;0===e._notifications.length&&e._ddNotification.addItem({html:s,value:r}),e._notifications.push(t),e._ddNotification.setTitle("NOTIFICATIONS ["+e._notifications.length+"]"),this._ddNotification.addItem({html:'<li><a class="notification-drop-down-menu-item notification-drop-down-menu-item-'+t.severity.toLowerCase()+'">'+t.message+"</a></li>"}),this._ddNotification._el.hasClass("open")===!1&&("error"===t.severity.toLowerCase()?e._popoverBox.show(t.message,n,5e3):e._popoverBox.show("New message",n,500))},o}),define("js/Panels/FooterControls/FooterControlsPanel",["js/PanelBase/PanelBase","js/Widgets/NetworkStatus/NetworkStatusWidget","js/Widgets/BranchStatus/BranchStatusWidget","js/Widgets/KeyboardManager/KeyboardManagerWidget","js/Widgets/Notification/NotificationWidget","js/Utils/ComponentSettings"],function(t,e,n,i,o,r){"use strict";var s,a=t;return s=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="FooterControlsPanel",a.apply(this,[i]),this._client=n.client,this._config=s.getDefaultConfig(),r.resolveWithWebGMEGlobal(this._config,s.getComponentId()),this._widgets=[],this._initialize(),this.logger.debug("FooterControlsPanel ctor finished")},_.extend(s.prototype,a.prototype),s.prototype._initialize=function(){var t=$("<div/>",{"class":"navbar navbar-inverse navbar-fixed-bottom"}),e=$("<div/>",{"class":"navbar-inner"}),n=$('<div class="spacer pull-right"></div>');t.append(e),this.$el.append(t),this.createCredits(e),e.append(n.clone()),this.createWidgets(e)},s.prototype.createCredits=function(t){var e,n=$('<div class="pull-left inline"></div>');n.append($('<div class="navbar-text"><div class="webgme-copyright">&copy; 2017 <a href="http://www.isis.vanderbilt.edu/" title="Vanderbilt University" target="_blank">Vanderbilt University</a></div></div>')),t.append(n),n=$('<div class="pull-left inline"></div>'),e=WebGMEGlobal.NpmVersion?'version: <a href="https://github.com/webgme/webgme/releases/tag/v'+WebGMEGlobal.version+'">'+WebGMEGlobal.version+"</a>":"version: "+WebGMEGlobal.version+"</a>",n.append($('<div class="navbar-text"><div class="webgme-version">'+e+"</div></div>")),t.append(n)},s.prototype.createWidgets=function(t){var r,s,a,l,c,d,h=$('<div class="pull-right"></div>'),p=$('<div class="spacer pull-right"></div>'),g=Object.keys(this._config.extraWidgets);for(WebGMEGlobal.SUPPORTS_TOUCH!==!0&&(d=h.clone(),this._widgets.push(new i(d)),t.append(d).append(p.clone())),r=0;r<g.length;r+=1)a=h.clone(),t.append(a).append(p.clone()),this._loadExtraWidget(g[r],a,t);c=h.clone(),this._widgets.push(new e(c,this._client)),t.append(c).append(p.clone()),l=h.clone(),this._widgets.push(new o(l,this._client)),t.append(l).append(p.clone()),s=h.clone(),this._widgets.push(new n(s,this._client)),t.append(s).append(p.clone())},s.prototype.clear=function(){this._widgets.forEach(function(t){"function"==typeof t.destroy&&t.destroy()}),this._widgets=[]},s.prototype._loadExtraWidget=function(t,e,n){var i=this;requirejs([this._config.extraWidgets[t].path],function(t){$.contains(n[0],e[0])?i._widgets.push(new t(e,i._client)):i._logger.error("FooterPanel destroyed before widget loaded.")},function(t){i._logger.error(t)})},s.getDefaultConfig=function(){return{extraWidgets:{}}},s.getComponentId=function(){return"GenericUIFooterControlsPanel"},s}),define("css!js/PanelBase/styles/PanelBaseWithHeader",[],function(){}),define("js/PanelBase/PanelBaseWithHeader",["js/PanelBase/PanelBase","css!./styles/PanelBaseWithHeader.css"],function(t){"use strict";var e,n="panel-base-wh",i="panel-base-scroll";return e=function(n,i){n[e.OPTIONS.LOGGER_INSTANCE_NAME]=n[e.OPTIONS.LOGGER_INSTANCE_NAME]||"PanelBaseWithHeader",n[e.OPTIONS.HEADER_TITLE]=n[e.OPTIONS.HEADER_TITLE]===!0,n[e.OPTIONS.FLOATING_TITLE]=n[e.OPTIONS.FLOATING_TITLE]===!0,t.apply(this,[n,i]),this.initUI(n)},e.OPTIONS=_.extend(t.OPTIONS,{HEADER_TITLE:"HEADER_TITLE",FLOATING_TITLE:"FLOATING_TITLE",NO_SCROLLING:"NO_SCROLLING"}),_.extend(e.prototype,t.prototype),e.prototype.setSize=function(t,e){this._setSize(t,e),this.onResize(this.size.width,this.size.height)},e.prototype.onReadOnlyChanged=function(t){this._onReadOnlyChanged(t)},e.prototype.initUI=function(t){void 0===this.$_el&&(this.$_el=this.$el),this.$_el.empty(),this.$_el.addClass(n),t[e.OPTIONS.NO_SCROLLING]!==!0&&this.$_el.addClass(i),this.$panelHeader=$("<div/>",{"class":"panel-header"}),this.$el=this.$panelBody=$("<div/>",{"class":"panel-body drawing-canvas"}),this.$panelReadOnlyIndicator=$("<div/>",{"class":"ro-icon",title:"READ-ONLY mode ON"}),this.$panelReadOnlyIndicator.append($('<i class="glyphicon glyphicon-lock"></i>')),t[e.OPTIONS.HEADER_TITLE]===!0?(this.$_el.append(this.$panelHeader),this.$_el.append(this.$panelBody),this.$panelHeader.append(this.$panelReadOnlyIndicator),this.$panelHeaderTitle=$("<div/>",{"class":"panel-header-title"}),this.$panelHeader.append(this.$panelHeaderTitle)):t[e.OPTIONS.FLOATING_TITLE]===!0?(this.$_el.append(this.$panelBody),this.$_el.append(this.$panelHeader),this.$panelHeader.addClass("absolute-header"),this.$floatingTitle=$("<div/>",{"class":"floating-title"}),this.$panelHeaderTitle=$("<div/>",{"class":"panel-header-title"}),this.$floatingTitle.append(this.$panelReadOnlyIndicator),this.$floatingTitle.append(this.$panelHeaderTitle),this.$_el.append(this.$floatingTitle)):(this.$_el.append(this.$panelBody),this.$_el.append(this.$panelReadOnlyIndicator))},e.prototype.destroy=function(){this.clear(),this.$_el.remove()},e.prototype.setTitle=function(t){this.$panelHeaderTitle&&this.$panelHeaderTitle.text(t)},e.prototype._setSize=function(t,e){var n=this.$panelHeader.outerHeight(!0),i=parseInt(this.$panelHeader.css("padding-left"))+parseInt(this.$panelHeader.css("padding-right")),o=parseInt(this.$panelBody.css("padding-left"))+parseInt(this.$panelBody.css("padding-right")),r=parseInt(this.$panelBody.css("padding-top"))+parseInt(this.$panelBody.css("padding-bottom")),s=parseInt(this.$_el.css("border-left-width"))+parseInt(this.$_el.css("border-right-width")),a=parseInt(this.$_el.css("margin-top"))+parseInt(this.$_el.css("margin-bottom"));t-=s,e-=a,this.$_el.width(t).height(e),this.$panelHeader.width(t-i),this.$panelBody.width(t-o).height(e-n-r),this.offset=this.$el.offset(),this.size={width:t-o,height:e-n-r}},e.prototype._onReadOnlyChanged=function(e){e===!0?this.$_el.addClass(t.READ_ONLY_CLASS):this.$_el.removeClass(t.READ_ONLY_CLASS)},e}),define("js/Panels/ObjectBrowser/ObjectBrowserControlBase",["js/RegistryKeys","js/Constants"],function(t,e){"use strict";function n(t,n,i){var o=this;this._client=t,this._treeBrowser=n,this._treeBrowser.onMakeNodeSelected=this._makeNodeSelected,this._treeBrowser.getDragEffects=function(){var t,e,n=o._treeBrowser.getSelectedIDs(),i=!1,r=!1;for(e=0;e<n.length;e+=1)t=o._client.getNode(n[e]),t&&(t.isLibraryRoot()&&(i=!0),t.isLibraryElement()&&(r=!0));return i?[]:r?[o._treeBrowser.DRAG_EFFECTS.DRAG_COPY,o._treeBrowser.DRAG_EFFECTS.DRAG_CREATE_POINTER,o._treeBrowser.DRAG_EFFECTS.DRAG_CREATE_INSTANCE,o._treeBrowser.DRAG_EFFECTS.DRAG_SET_REPLACEABLE,o._treeBrowser.DRAG_EFFECTS.DRAG_ADD_MEMBER]:[o._treeBrowser.DRAG_EFFECTS.DRAG_COPY,o._treeBrowser.DRAG_EFFECTS.DRAG_MOVE,o._treeBrowser.DRAG_EFFECTS.DRAG_CREATE_POINTER,o._treeBrowser.DRAG_EFFECTS.DRAG_CREATE_INSTANCE,o._treeBrowser.DRAG_EFFECTS.DRAG_SET_REPLACEABLE,o._treeBrowser.DRAG_EFFECTS.DRAG_ADD_MEMBER]},this._treeBrowser.getDragItems=function(){return o._treeBrowser.getSelectedIDs()},this._treeBrowser.onExtendMenuItems=function(t,n){var i=o._client.getNode(t);(!i||i.isReadOnly()||t===e.PROJECT_ROOT_ID)&&(delete n["delete"],delete n.rename,delete n.separatorOperationsStart)},this._treeBrowser.onNodeTitleChanged=function(e,n,i){return t.setAttribute(e,"name",i),!1},this._treeBrowser.onNodeDelete=function(e){for(var n,o=e.length;o--;)n=t.getNode(e[o]),n&&null===n.getBaseId()&&(i.warn("Can not delete item with ID: "+e[o]+". Possibly it is the ROOT or FCO"),e.splice(o,1));t.deleteNodes(e)}}return n.prototype.getIcon=function(e,n){var i,o;return i="string"==typeof e?this._client.getNode(e):e,i&&(o=n?i.getRegistry(t.TREE_ITEM_EXPANDED_ICON)||i.getRegistry(t.TREE_ITEM_COLLAPSED_ICON):i.getRegistry(t.TREE_ITEM_COLLAPSED_ICON)||i.getRegistry(t.TREE_ITEM_EXPANDED_ICON)),o?"/assets/DecoratorSVG/"+o:null},n.prototype.getMetaInfo=function(t){var e=t.getMetaTypeId(),n={name:"",isMetaNode:t.isMetaNode()};return e&&this._client.getNode(e)&&(n.name=this._client.getNode(e).getFullyQualifiedName()),n},n.prototype._makeNodeSelected=function(t){WebGMEGlobal.State.registerActiveSelection([t])},n}),define("css!js/Dialogs/AddOrUpdateLibrary/styles/AddOrUpdateLibraryDialog",[],function(){}),define("js/Dialogs/AddOrUpdateLibrary/AddOrUpdateLibraryDialog",["js/Controls/PropertyGrid/Widgets/AssetWidget","js/util","js/Utils/WebGMEUrlManager","common/regexp","js/Dialogs/MultiTab/MultiTabDialog","css!./styles/AddOrUpdateLibraryDialog.css"],function(t,e,n,i,o){"use strict";function r(t,e){this._client=t,this._addLibrary=e}return r.prototype.show=function(t){var e,n=this,i=new o,r={title:this._addLibrary?"Add Library":"Update Library",extraClasses:"add-or-update-library-dialog",iconClass:"glyphicon glyphicon-folder-close",activeTabIndex:0,tabs:[]};this._addLibrary?this._libraryName=t:e=this._client.getNode(t),e&&(this._libraryName=e.getFullyQualifiedName(),this._storedLibraryInfo=this._client.getLibraryInfo(this._libraryName),this._libraryName&&this._storedLibraryInfo&&this._storedLibraryInfo.projectId&&this._storedLibraryInfo.branchName&&r.tabs.push(this._getRefreshTab())),r.tabs.push(this._getFileTab()),r.tabs.push(this._getUrlTab()),i.show(r,function(){n._urlInputControl.off("keyup"),n._urlInputControl.off("keydown"),n._assetWidget.destroy()})},r.prototype._getRefreshTab=function(){function t(t){e._client.updateLibrary(e._libraryName,null,function(n,i){n?t("Failed to refresh library: "+n):e._checkCommitStatus(i.status)?t():t("Project updated with library at commit "+i.hash.substring(0,7)+" but could not update branch.")})}var e=this,i="/?"+n.getSearchQuery({projectId:this._storedLibraryInfo.projectId,branchName:this._storedLibraryInfo.branchName});return{title:"Refresh",infoTitle:"Refresh from branch "+this._storedLibraryInfo.branchName+" in "+this._storedLibraryInfo.projectId,infoDetails:"The library info stored at the library root node indicates that this library originated from a project within this deployment. It also has a branch stored and it is therefore possible to attempt to update the attached library to the head of the branch linked. Use the link below to view the current state of the branch.",formControl:$('<a class="refresh-link" href="'+i+'" target="_blank">View branch of library</a>'),onOK:t}},r.prototype._getFileTab=function(){function e(t){function e(e,i){e?t("Error getting library from blob: "+e):n._checkCommitStatus(i.status)?t():t("Project updated with library at commit "+i.hash.substring(0,7)+" but could not update branch.")}return n._assetWidget.propertyValue?void(n._addLibrary?n._client.addLibrary(n._libraryName,n._assetWidget.propertyValue,e):n._client.updateLibrary(n._libraryName,n._assetWidget.propertyValue,e)):void t("No file uploaded.")}var n=this;return this._assetWidget=new t({propertyName:"AddOrUpdateLibraryDialog",propertyValue:""}),{title:"File",infoTitle:"From webgmex file",infoDetails:"Use an exported project package (webgmex-file) as the source of the library.",formControl:n._assetWidget.el,onOK:e}},r.prototype._getUrlTab=function(){function t(t){function e(e,i){e?t("Error getting library via url: "+e):n._checkCommitStatus(i.status)?t():t("Project updated with library at commit "+i.hash.substring(0,7)+" but could not update branch.")}return"string"!=typeof o.projectId?void t("Provided url is not valid, it must at least contain a project id."):void(n._addLibrary?n._client.addLibrary(n._libraryName,o,e):n._client.updateLibrary(n._libraryName,o,e))}var n=this,i=$('<div class="input-group"><span class="input-group-addon">URL</span><input type="text" class="form-control"></div>'),o={};return this._urlInputControl=i.find(".form-control"),this._urlInputControl.on("keyup",function(){o={projectId:e.getURLParameterByNameFromString(n._urlInputControl.val(),"project"),branchName:e.getURLParameterByNameFromString(n._urlInputControl.val(),"branch"),commitHash:e.getURLParameterByNameFromString(n._urlInputControl.val(),"commit")}}),this._urlInputControl.on("keydown",function(t){var e=13===t.which;e&&(t.preventDefault(),t.stopPropagation())}),{title:"URL",infoTitle:"From intra deployment URL",infoDetails:"Use the URL of the project as the source of the library. To obtain the url, open up the project you would like to use as library and copy the full url from the address field. N.B. if you later would like to be able to refresh the library, make sure that a branch i opened before copying.",formControl:i,onOK:t}},r.prototype._checkCommitStatus=function(t){return t===this._client.CONSTANTS.STORAGE.SYNCED||t===this._client.CONSTANTS.STORAGE.MERGED},r}),define("js/Utils/LibraryManager",["js/Dialogs/Confirm/ConfirmDialog","js/Dialogs/AddOrUpdateLibrary/AddOrUpdateLibraryDialog","common/regexp"],function(t,e,n){"use strict";var i=function(n){this._add=new e(n,!0),this._update=new e(n),this._remove=new t,this._getName=new t,this._doNotAskRemove=!1,this._client=n};return i.prototype.add=function(){var t=this,e=this._client.getLibraryNames();this._getName.show({title:"Add Library",iconClass:"glyphicon glyphicon-folder-close",question:"Give a unique name of the new library..",input:{label:"Name",placeHolder:"Enter name of new library...",required:!0,checkFn:function(t){return-1!==e.indexOf(t)?!1:n.DOCUMENT_KEY.test(t)}},severity:"info"},function(e,n){t._add.show(n)})},i.prototype.update=function(t){this._update.show(t)},i.prototype.remove=function(t){var e,n=this._client.getNode(t),i=this;if(n){if(e=n.getFullyQualifiedName(),this._doNotAskRemove)return void this._client.removeLibrary(e);this._remove.show({enableDontAskAgain:!0,deleteItem:n.getFullyQualifiedName()+" library"},function(t){i._doNotAskRemove=t,i._client.removeLibrary(e)})}},i.prototype.rename=function(t){var e,i,o=this,r=this._client.getNode(t);r&&(e=r.getFullyQualifiedName(),i=this._client.getLibraryNames(),i.splice(i.indexOf(e),1),this._getName.show({title:"Rename Library",iconClass:"glyphicon glyphicon-folder-close",question:'Would you like to rename "'+e+'"?',input:{label:"Name",placeHolder:"Enter new library name...",required:!0,checkFn:function(t){return-1!==i.indexOf(t)?!1:n.DOCUMENT_KEY.test(t)}},severity:"info"},function(t,n){o._client.renameLibrary(e,n)}))},i}),define("css!js/Controls/PropertyGrid/Widgets/styles/BlobHashWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/BlobHashWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","blob/BlobClient","js/logger","common/regexp","css!./styles/BlobHashWidget.css"],function(t,e,n,i){"use strict";var o,r=$('<a class="btn btn-mini btn-clear"><i class="glyphicon glyphicon-remove" /></a>'),s=$('<input type="text" placeholder="Paste an exported blob-hash here"/>'),a=$('<div class="blobhash-widget" />'),l=$('<a class="blob-download-link" href="" target="_self"/>');return o=function(i){t.call(this,i),this._logger=n.create("gme:js:Controls:PropertyGrid:Widgets:BlobHashWidget",WebGMEGlobal.gmeConfig.client.log),this.__el=a.clone(),this.el.append(this.__el),this.__assetLink=l.clone(),this.__el.append(this.__assetLink),this.__btnClear=r.clone(),this.__el.append(this.__btnClear),this.__input=s.clone(),this.__el.append(this.__input),this.__input.attr("title","Paste or type in a valid blobhash. Once the input is checked the field will bereplaced with the link of the pointed blob."),this.__targetHash=null,this.__bc=new e({logger:this._logger.fork("BlobClient")}),this.__urlDownload=null,this.__fileInfo=null,this.propertyValue=null,this.__gettingBlobInfo=!1,this._attachHandlers(),this.updateDisplay()},o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._attachHandlers=function(){var t=this,e=function(e){var n=null;e&&e.originalEvent&&e.originalEvent.clipboardData&&(n=e.originalEvent.clipboardData.getData("Text")),t.updateDisplay(n)};this.__btnClear.on("click",function(e){t.__fileInfo=null,t.propertyValue=null,t.__urlDownload=null,t.__input.val(""),t.updateDisplay()}),this.__input.on("change",e),this.__input.on("paste",e),this.__input.on("keyup",e)},o.prototype._detachHandlers=function(){this.__btnClear.off("click"),this.__input.off("change"),this.__input.off("paste"),this.__input.off("keyup")},o.prototype.updateDisplay=function(e){var n,o=this.__input.val()||e||"";return this.propertyValue&&this.propertyValue===o?(n=this.__fileInfo.name+" ("+this.__bc.getHumanSize(this.__fileInfo.size)+")",this.__input.hide(),this.__assetLink.show(),this.__assetLink.text(n),this.__assetLink.attr("title",n),this.__assetLink.attr("href",this.__urlDownload),this.__btnClear.disable(!1)):(this.__fileInfo=null,this.propertyValue=null,this.__urlDownload=null,this.__input.show(),this.__assetLink.hide(),0===o.length?this.__btnClear.disable(!0):i.BLOB_HASH.test(o)?(this.__btnClear.disable(!1),this._getMetadata(o)):this.__btnClear.disable(!1)),t.prototype.updateDisplay.call(this)},o.prototype._getMetadata=function(t){var e=this;e.__gettingBlobInfo===!1&&(e.__gettingBlobInfo=!0,e.__bc.getMetadata(t,function(n,i){e.__gettingBlobInfo=!1,n?e.__input.val(""):(e.__fileInfo=i,e.propertyValue=t,e.__urlDownload=e.__bc.getDownloadURL(t)),e.updateDisplay()}))},o.prototype.setReadOnly=function(e){t.prototype.setReadOnly.call(this,e),e?this._detachHandlers():this._attachHandlers(),this.updateDisplay()},o.prototype.destroy=function(){this._detachHandlers(),t.prototype.destroy.call(this)},o}),define("js/Dialogs/ImportModel/ImportModelDialog",["js/Controls/PropertyGrid/Widgets/AssetWidget","js/Controls/PropertyGrid/Widgets/BlobHashWidget","js/Dialogs/MultiTab/MultiTabDialog"],function(t,e,n){"use strict";function i(t,e){this._client=t,this._logger=e}return i.prototype.show=function(t){var e=this,i=new n,o={title:"Import Models",extraClasses:"import-model-dialog",iconClass:"glyphicon glyphicon-import",activeTabIndex:0,tabs:[e._getFileTab(),e._getBlobHashTab()]};this._parentId=t,i.show(o,function(){e._assetWidget.destroy(),e._blobHashWidget.destroy()})},i.prototype._getFileTab=function(){function e(t){return n._assetWidget.propertyValue?void n._client.importSelectionFromFile(n._client.getActiveProjectId(),n._client.getActiveBranchName(),n._parentId,n._assetWidget.propertyValue,function(e,i){e?t("Failed to import model"+e):n._checkCommitStatus(i.status)?t():t("Project updated model at commit "+i.hash.substring(0,7)+" but could not update branch.")}):void t("No file uploaded.")}var n=this;return this._assetWidget=new t({propertyName:"ImportModelDialog",propertyValue:""}),{title:"File",infoTitle:"From webgmexm file",infoDetails:"The exported model(s) must come from a project that shares the same meta as the current project. Specifically all the meta-types used in exported model(s) must have matching meta-nodes (w.r.t GUIDs) in this project. If you are uncertain, there is no harm in trying to import the model(s) - an error will just be returned.",formControl:n._assetWidget.el,onOK:e}},i.prototype._getBlobHashTab=function(){function t(t){return n._blobHashWidget.propertyValue?void n._client.importSelectionFromFile(n._client.getActiveProjectId(),n._client.getActiveBranchName(),n._parentId,n._blobHashWidget.propertyValue,function(e,i){e?t("Failed to import model"+e):n._checkCommitStatus(i.status)?t():t("Project updated model at commit "+i.hash.substring(0,7)+" but could not update branch.")}):void t("No file hash was given.")}var n=this;return this._blobHashWidget=new e({propertyName:"ImportModelDialog",propertyValue:""}),{title:"Hash",infoTitle:"From BlobHash that represents an export",infoDetails:"The exported model(s) represented by the hash must come from a project that shares the same meta as the current project. Specifically all the meta-types used in exported model(s) must have matching meta-nodes (w.r.t GUIDs) in this project. If you are uncertain, there is no harm in trying to import the model(s) - an error will just be returned.",formControl:n._blobHashWidget.el,onOK:t}},i.prototype._checkCommitStatus=function(t){return t===this._client.CONSTANTS.STORAGE.SYNCED||t===this._client.CONSTANTS.STORAGE.MERGED},i}),define("js/Panels/ObjectBrowser/TreeBrowserControl",["js/logger","js/NodePropertyNames","js/Constants","js/RegistryKeys","./ObjectBrowserControlBase","js/Utils/LibraryManager","js/Dialogs/ImportModel/ImportModelDialog","js/Utils/Exporters"],function(t,e,n,i,o,r,s,a){"use strict";function l(e,i,l){function I(){var t=e.getActiveProjectId(),n=e.getActiveProjectName();l.byProjectId.treeRoot.hasOwnProperty(t)?B._treeRootId=l.byProjectId.treeRoot[t]:l.byProjectName.treeRoot.hasOwnProperty(n)?B._treeRootId=l.byProjectName.treeRoot[n]:B._treeRootId=l.treeRoot}function P(){var t=i.createNode(null,{id:B._treeRootId,name:"Initializing tree...",hasChildren:!0,"class":c});L[B._treeRootId]={treeNode:t,children:[],state:S},M={},M[B._treeRootId]={children:1},e.updateTerritory(A,M)}var T,A,x,w,N,O,S=0,R=1,M={},L={},k=!1,B=this;T=t.create("gme:Panels:ObjectBrowser:TreeBrowserControl",WebGMEGlobal.gmeConfig.client.log),this._logger=T,o.call(this,e,i,T),this._treeRootId=D,this._libraryManager=new r(this._client),w=function(){var t=e.getNode(n.PROJECT_ROOT_ID);T.debug("entered initialize"),I(),t?(T.debug("rootNode avaliable now"),A=e.addUI(B,function(t){B._eventCallback(t),k===!1&&(e.getNode(B._treeRootId)?(T.debug('loaded territory from "'+B._treeRootId+'" at initialize'),k=!0,T.debug("expanding tree-root",B._treeRootId),L[B._treeRootId].treeNode.setExpanded(!0)):(T.error("Specified tree-root "+B._treeRootId+" did not exist in model - falling back on root-node."),i.deleteNode(L[B._treeRootId].treeNode),B._treeRootId=n.PROJECT_ROOT_ID,L={},P()))}),P()):(T.debug("rootNode not avaliable at initialize"),setTimeout(w,500))},N=function(t,e){var i,o=t.getId();return i=o===n.PROJECT_ROOT_ID?g:t.isLibraryRoot()?f:t.getCrosscutsInfo().length>0||t.getValidSetNames().length>0?e?b:u:t.isConnection()?e?v:p:t.getChildrenIds().length>0?e?y:d:e?m:h},O=function(t){var n;return t.isLibraryRoot()?(n=e.getLibraryInfo(t.getFullyQualifiedName()),n?"origin: "+n.projectId+" : "+(n.branchName?n.branchName+"@"+n.commitHash:n.commitHash):null):null},i.onNodeOpen=function(t){var n,o,r,s,a,l,d,h,p=e.getNode(t),g=[];if(p){for(r=L[t].treeNode,s=p.getChildrenIds(),a=0;a<s.length;a+=1)l=s[a],d=e.getNode(l),h=null,d?(n=B.getMetaInfo(d),g.push({id:l,name:d.getFullyQualifiedName(),hasChildren:d.getChildrenIds().length>0,"class":N(d,n.isMetaNode),icon:B.getIcon(d),isConnection:d.isConnection(),isAbstract:d.isAbstract(),isLibrary:d.isLibraryRoot()||d.isLibraryElement(),isLibraryRoot:d.isLibraryRoot(),isMetaNode:n.isMetaNode,metaType:n.name,libraryInfo:O(d),STATE:R,CHILDREN:d.getChildrenIds()})):g.push({id:l,name:"Loading...",hasChildren:!1,"class":c,STATE:S,CHILDREN:[]});for(o=i.createNodes(r,g),a=0;a<g.length;a+=1)L[g[a].id]={treeNode:o[a],children:g[a].CHILDREN,state:g[a].STATE};i.updateNode(r,{icon:B.getIcon(p,!0)}),i.applyFilters()}M[t]={children:1},e.updateTerritory(A,M)},i.onNodeClose=function(t){var n,o=[];n=function(t,e){var i;if(L[t]){for(i=0;i<L[t].children.length;i+=1)n(L[t].children[i],!0);e===!0&&(delete L[t],M[t]&&(o.push({nodeid:t}),delete M[t]))}},n(t,!1),i.updateNode(L[t].treeNode,{icon:B.getIcon(t)}),o.length>0&&e.updateTerritory(A,M)},i.onNodeCopy=function(t){e.copyNodes(t)},i.onNodeDoubleClicked=function(t){T.debug("Firing onNodeDoubleClicked with nodeId: "+t),WebGMEGlobal.State.registerActiveObject(t)},i.onExtendMenuItems=function(t,i){var o,r,l=B._getValidChildrenTypesFlattened(t),c=B._treeBrowser.getSelectedIDs()||[],d=1===c.length,h=B._client.getNode(t),p=function(e){B._createChild(t,e)};if(h){if(d&&l["has.children"]===!0&&!h.isReadOnly())for(i.create={name:"Create child",icon:"add",items:{}},delete l["has.children"],o=Object.keys(l),o.sort(),r=0;r<o.length;r+=1)i.create.items[l[o[r]]]={name:o[r],callback:p};(h.isReadOnly()||t===n.PROJECT_ROOT_ID)&&delete i["delete"],(e.isReadOnly()||h.isLibraryElement())&&delete i.rename,i["delete"]||i.rename||i.create?i.separatorOperationsEnd="-":delete i.separatorOperationsStart,t===n.PROJECT_ROOT_ID&&(e.isReadOnly()===!1&&(i.addLibrary={name:"Add Library ...",callback:function(){B._libraryManager.add()},icon:!1}),i.exportProject={name:"Export project",icon:!1,items:{assetfull:{name:"with assets",callback:function(){a.exportProject(B._client,B._logger,null,!0)},icon:!1},assetless:{name:"without assets",callback:function(){a.exportProject(B._client,B._logger,null,!1)},icon:!1}}}),(-1===c.indexOf(n.PROJECT_ROOT_ID)||1===c.length)&&(-1===c.indexOf(n.PROJECT_ROOT_ID)&&(i.exportModel={name:"Export models",icon:!1,items:{assetfull:{name:"with assets",callback:function(){a.exportModels(B._client,B._logger,c,!0)},icon:!1},assetless:{name:"without assets",callback:function(){a.exportModels(B._client,B._logger,c,!1)},icon:!1}}},1===c.length&&(i.exportModel.name="Export model")),1===c.length&&h.isReadOnly()===!1&&(i.importModel={name:"Import models ...",icon:!1,callback:function(){var e=new s(B._client,B._logger.fork("ImportModel"));e.show(t)}})),h.isLibraryRoot()&&!h.isLibraryElement()&&(delete i.exportModel,delete i.importModel,i.library={name:"Library",items:{viewLibrary:{name:"View commit of library",callback:function(){B._client.openLibraryOriginInNewWindow(t)},icon:!1},followLibrary:{name:"View branch of library",callback:function(){B._client.openLibraryOriginInNewWindow(t,!0)},icon:!1}},icon:!1},e.isReadOnly()===!1&&(i.library.items.libraryEditSepararator="-",i.library.items.refreshLibrary={name:"Update library ...",callback:function(){B._libraryManager.update(t)},icon:!1},i.library.items.removeLibrary={name:"Remove library ...",callback:function(){B._libraryManager.remove(t)},icon:"delete"},i.rename.callback=function(){B._libraryManager.rename(t)},i.rename.name="Rename ...")),(h.getCrosscutsInfo().length>0||h.getValidSetNames().length>0)&&(i.open={name:"Open in visualizer",items:{defaultViz:i.open},icon:"paste"},i.open.items.defaultViz.name="Default visualizer",i.open.items.defaultViz.icon=!1,h.getCrosscutsInfo().length>0&&(i.open.items.crosscut={name:"Crosscuts",callback:function(){var e={};e[n.STATE_ACTIVE_OBJECT]=t,e[n.STATE_ACTIVE_VISUALIZER]=C,WebGMEGlobal.State.set(e,{suppressVisualizerFromNode:!0})},icon:!1}),h.getValidSetNames().length>0&&(i.open.items.set={name:"Set membership",callback:function(){var e={};e[n.STATE_ACTIVE_OBJECT]=t,e[n.STATE_ACTIVE_VISUALIZER]=E,WebGMEGlobal.State.set(e,{suppressVisualizerFromNode:!0})},icon:!1}))}},x=function(t,o){var r,s,a,l,d,h,p,g,u,f,m,b=null,y=null,v=0;if(T.debug("Refresh event '"+t+"', with objectId: '"+o+"'"),"insert"===t&&L[o]&&L[o].state===S&&(t="update"),("update"===t||"unload"===t)&&(r=[],L[o]&&(T.debug("Update object with id: "+o),s=e.getNode(o))))if(d=s.getChildrenIds(),L[o].state===S)f=B.getMetaInfo(s),a=N(s,f.isMetaNode),b={name:s.getFullyQualifiedName(),hasChildren:d.length>0,"class":a,icon:B.getIcon(s),isConnection:s.isConnection(),isAbstract:s.isAbstract(),isLibrary:s.isLibraryRoot()||s.isLibraryElement(),isLibraryRoot:s.isLibraryRoot(),libraryInfo:O(s),isMetaNode:f.isMetaNode,metaType:f.name},i.updateNode(L[o].treeNode,b),L[o].children=d,L[o].state=R;else{if(f=B.getMetaInfo(s),a=N(s,f.isMetaNode),b={name:s.getFullyQualifiedName(),hasChildren:d.length>0,"class":a,icon:B.getIcon(s),isConnection:s.isConnection(),isAbstract:s.isAbstract(),isLibrary:s.isLibraryRoot()||s.isLibraryElement(),isLibraryRoot:s.isLibraryRoot(),libraryInfo:O(s),isMetaNode:f.isMetaNode,metaType:f.name},l=L[o].children,i.isExpanded(L[o].treeNode))for(b.icon=B.getIcon(s,!0),h=_.difference(l,d),p=function(t){var e;if(L[t]){for(e=0;e<L[t].children.length;e+=1)p(L[t].children[e]);delete L[t],M[t]&&(r.push({nodeid:t}),delete M[t])}},v=0;v<h.length;v+=1)y=h[v],L[y]&&(i.deleteNode(L[y].treeNode),p(y));if(i.isExpanded(L[o].treeNode))for(g=_.difference(d,l),v=0;v<g.length;v+=1)y=g[v],u=e.getNode(y),f=B.getMetaInfo(u),m=null,u?(m=i.createNode(L[o].treeNode,{id:y,name:u.getFullyQualifiedName(),hasChildren:u.getChildrenIds().length>0,"class":N(u,f.isMetaNode),icon:B.getIcon(u),isConnection:u.isConnection(),isAbstract:u.isAbstract(),isLibrary:u.isLibraryRoot()||u.isLibraryElement(),isLibraryRoot:u.isLibraryRoot(),libraryInfo:O(u),isMetaNode:f.isMetaNode,metaType:f.name}),L[y]={treeNode:m,children:u.getChildrenIds(),state:R}):(m=i.createNode(L[o].treeNode,{id:y,name:"Loading...",hasChildren:!1,"class":c}),L[y]={treeNode:m,children:[],state:S});L[o].children=d,i.updateNode(L[o].treeNode,b),L[o].state=R,o!==n.PROJECT_ROOT_ID&&M[o]&&0===d.length&&(r.push({nodeid:o}),delete M[o]),r.length>0&&e.updateTerritory(A,M)}},this._eventCallback=function(t){var e,n=!1,o=t.length;for(e=0;o>e;e+=1)"complete"===t[e].etype||("update"===t[e].etype?(x("update",t[e].eid),
n=!0):"load"===t[e].etype?(x("insert",t[e].eid),n=!0):"unload"===t[e].etype?(x("unload",t[e].eid),n=!0):T.debug("unknown event type '"+t[e].etype+"' received"));n&&i.applyFilters()},this.locateNode=function(t){for(var e,n=t;;){if(L.hasOwnProperty(n)&&L[n].treeNode["class"]!==c){e=L[n].treeNode,e.tree.activateKey(e.key),i._deselectSelectedNodes(),L[n].treeNode.setSelected(!0),n!==t&&e.setExpanded(!0),e.tree.setFocus(!0);break}if(!n)break;n=n.substring(0,n.lastIndexOf("/"))}},this.reLaunch=function(){T.debug("reLaunch from client..."),e.removeUI(A),i.deleteNode(L[B._treeRootId].treeNode),M={},L={},k=!1,w()},this.destroy=function(){$(document).find('link[href*="css/Panels/ObjectBrowser/TreeBrowserControl.css"]').remove()},setTimeout(w,250)}var c="node-progress",d="gme-model",h="gme-atom",p="gme-connection",g="gme-root",u="gme-aspect",f="gme-library",m="gme-meta-atom",b="gme-meta-set",y="gme-meta-model",v="gme-meta-connection",C="Crosscut",E="SetEditor",D=n.PROJECT_ROOT_ID;return l.prototype=Object.create(o.prototype),l.prototype.constructor=l,l.getDefaultConfig=function(){return{treeRoot:"",filters:{toggled:{hideConnections:!1,hideAbstracts:!1,hideLeaves:!1,hideLibraries:!1,hideMetaNodes:!1}},byProjectName:{treeRoot:{}},byProjectId:{treeRoot:{}}}},l.getComponentId=function(){return"GenericUITreeBrowserControl"},l.prototype._getValidChildrenTypes=function(t){var e,n,i,o,r,s,a,l={},c=this._client.getNode(t),d={};c&&(d=c.getValidChildrenTypesDetailed()),e=Object.keys(d||{});for(n in d)if(l["has.children"]=!0,s=this._client.getNode(n)){for(o=s.getFullyQualifiedName().split("."),r=o.pop(),i=l,a=0;a<o.length;a+=1)i[o[a]]=i[o[a]]||{},i=i[o[a]];i[r]=i[r]||{},i[r]["own.id"]=n,i[r]["own.title"]=r}return l},l.prototype._getValidChildrenTypesFlattened=function(t){var e,n,i,o,r={},s=this._client.getNode(t),a={};s&&(a=s.getValidChildrenTypesDetailed()),e=Object.keys(a||{});for(n in a)r["has.children"]=!0,o=this._client.getNode(n),o&&(i=o.getFullyQualifiedName(),r[i]=n);return r},l.prototype._createChild=function(t,e){var n=this._client,o={parentId:t};o[e]={registry:{}},o[e].registry[i.POSITION]={x:100,y:100},n.createChildren(o)},l}),define("js/Panels/ObjectBrowser/InheritanceBrowserControl",["js/logger","js/Utils/GMEConcepts","js/NodePropertyNames","js/Constants","./ObjectBrowserControlBase"],function(t,e,n,i,o){"use strict";var r="node-progress",s="gme-atom",a="gme-meta-atom",l="ModelEditor",c=0,d=1,h=function(e,n){var i=this;i._logger=t.create("gme:Panels:ObjectBrowser:InheritanceBrowserControl",WebGMEGlobal.gmeConfig.client.log),o.call(i,e,n,i._logger),i._fcoId=this._getRootId(),i._treeBrowser._enableNodeRename=!1,setTimeout(function(){i._initialize()},250)};return h.prototype=Object.create(o.prototype),h.prototype.constructor=h,h.prototype.destroy=function(){this._logger.debug("destroyed"),this._territoryId&&(this._client.removeUI(this._territoryId),this._territoryId=void 0),this._treeBrowser.deleteNode(this._nodes[this._fcoId].treeNode)},h.prototype.reLaunch=function(){this._logger.debug("reLaunch from client..."),this._territoryId&&(this._client.removeUI(this._territoryId),this._territoryId=void 0),this._treeBrowser.deleteNode(this._nodes[this._fcoId].treeNode),this._initialize()},h.prototype._initialize=function(){var t=this;if(this._fcoId=this._getRootId(),this._selfPatterns={},this._nodes={},this._fcoId){var e;this._territoryId=this._client.addUI(this,function(e){t._eventCallback(e)}),e=this._treeBrowser.createNode(null,{id:this._fcoId,name:"Initializing tree...",hasChildren:!1,"class":r}),this._nodes[this._fcoId]={treeNode:e,inheritance:[],state:c},this._selfPatterns[this._fcoId]={children:0},this._client.updateTerritory(this._territoryId,this._selfPatterns)}else setTimeout(function(){t._initialize()},500);this._treeBrowser.onNodeOpen=function(e){t._onNodeOpen(e)},this._treeBrowser.onNodeClose=function(e){t._onNodeClose(e)},this._treeBrowser.onNodeDoubleClicked=function(e){t._onNodeDoubleClicked(e)}},h.prototype._getRootId=function(){return e.getFCOId()},h.prototype._onNodeOpen=function(t){var e,n,i,o,s,a,l,h,p=this._client.getNode(t),g=[];if(p){for(i=this._nodes[t].treeNode,o=p.getInstancePaths(),this._treeBrowser.enableUpdate(!1),s=0;s<o.length;s+=1)a=o[s],l=this._client.getNode(a),h=null,l?(e=this.getMetaInfo(l),g.push({id:a,name:l.getFullyQualifiedName(),hasChildren:l.getInstancePaths().length>0,"class":this._getNodeClass(l,e.isMetaNode),icon:this.getIcon(l),STATE:d,INHERITANCE:l.getInstancePaths()})):(g.push({id:a,name:"Loading...",hasChildren:!1,"class":r,STATE:c,INHERITANCE:[]}),this._selfPatterns[a]={children:0});for(n=this._treeBrowser.createNodes(i,g),s=0;s<g.length;s+=1)this._nodes[g[s].id]={treeNode:n[s],inheritance:g[s].INHERITANCE,state:g[s].STATE};this._treeBrowser.updateNode(i,{icon:this.getIcon(p,!0)})}this._client.updateTerritory(this._territoryId,this._selfPatterns)},h.prototype._onNodeClose=function(t){var e,n=[],i=this;e=function(t,o){var r;if(i._nodes[t]){for(r=0;r<i._nodes[t].inheritance.length;r+=1)e(i._nodes[t].inheritance[r],!0);o===!0&&(delete i._nodes[t],n.push(t),delete i._selfPatterns[t])}},e(t,!1),this._treeBrowser.updateNode(this._nodes[t].treeNode,{icon:this.getIcon(t)}),n.length>0&&this._client.updateTerritory(this._territoryId,this._selfPatterns)},h.prototype._onNodeDoubleClicked=function(t){this._logger.debug("_onNodeDoubleClicked with nodeId: "+t);var e,n={},o=this._client.getNode(t);o&&(e=o.getParentId()),e||e===i.PROJECT_ROOT_ID?(n[i.STATE_ACTIVE_OBJECT]=e,n[i.STATE_ACTIVE_SELECTION]=[t]):n[i.STATE_ACTIVE_OBJECT]=t,n[i.STATE_ACTIVE_VISUALIZER]=l,WebGMEGlobal.State.set(n)},h.prototype._getNodeClass=function(t,e){return e?a:s},h.prototype._eventCallback=function(t){var e,n=t.length;for(e=0;n>e;e+=1)"load"===t[e].etype?this._refresh("insert",t[e].eid):"update"===t[e].etype?this._refresh("update",t[e].eid):"unload"===t[e].etype?this._refresh("unload",t[e].eid):this._logger.debug("unknown event type '"+t[e].etype+"' ignored")},h.prototype._refresh=function(t,e){var n,i,o,s,a,l,h,p,g,u,f,m,b=null,y=null,v=0,C=this._client,E=this;if(this._logger.debug("Refresh event '"+t+"', with objectId: '"+e+"'"),"insert"===t&&this._nodes[e]&&this._nodes[e].state===c&&(t="update"),("update"===t||"unload"===t)&&(n=[],this._nodes[e]&&(this._logger.debug("Update object with id: "+e),i=C.getNode(e))))if(this._nodes[e].state===c)f=this.getMetaInfo(i),o=this._getNodeClass(i,f.isMetaNode),b={name:i.getFullyQualifiedName(),hasChildren:i.getInstancePaths().length>0,"class":o,icon:E.getIcon(i)},this._treeBrowser.updateNode(this._nodes[e].treeNode,b),this._nodes[e].inheritance=i.getInstancePaths(),this._nodes[e].state=d;else{if(f=this.getMetaInfo(i),o=this._getNodeClass(i,f),b={name:i.getFullyQualifiedName(),hasChildren:i.getInstancePaths().length>0,"class":o,icon:E.getIcon(i)},s=this._nodes[e].inheritance,a=i.getInstancePaths(),this._treeBrowser.isExpanded(this._nodes[e].treeNode))for(b.icon=E.getIcon(i,!0),l=_.difference(s,a),h=function(t){if(E._nodes[t]){for(m=0;m<E._nodes[t].inheritance.length;m+=1)h(E._nodes[t].inheritance[m]);delete E._nodes[t],n.push(t),delete E._selfPatterns[t]}},v=0;v<l.length;v+=1)y=l[v],this._nodes[y]&&(this._treeBrowser.deleteNode(this._nodes[y].treeNode),h(y));if(this._treeBrowser.isExpanded(this._nodes[e].treeNode))for(p=_.difference(a,s),v=0;v<p.length;v+=1)y=p[v],g=C.getNode(y),f=this.getMetaInfo(i),o=this._getNodeClass(i,f),u=null,g?(u=this._treeBrowser.createNode(this._nodes[e].treeNode,{id:y,name:g.getFullyQualifiedName(),hasChildren:g.getInstancePaths().length>0,"class":o,icon:this.getIcon(g)}),this._nodes[y]={treeNode:u,inheritance:g.getInstancePaths(),state:d}):(u=this._treeBrowser.createNode(this._nodes[e].treeNode,{id:y,name:"Loading...",hasChildren:!1,"class":r}),this._nodes[y]={treeNode:u,inheritance:[],state:c});this._nodes[e].inheritance=i.getInstancePaths(),this._treeBrowser.updateNode(this._nodes[e].treeNode,b),this._nodes[e].state=d,n.length>0&&C.updateTerritory(this._territoryId,this._selfPatterns)}},h}),define("js/Panels/ObjectBrowser/CrosscutBrowserControl",["js/logger","js/Utils/GMEConcepts","js/NodePropertyNames","js/Constants","./ObjectBrowserControlBase"],function(t,e,n,i,o){"use strict";var r="node-progress",s="gme-model",a="gme-atom",l=i.PROJECT_ROOT_ID,c="Crosscut",d="CrossCuts",h=function(e,n){var i=this;this._logger=t.create("gme:Panels:ObjectBrowser:CrosscutBrowserControl",WebGMEGlobal.gmeConfig.client.log),o.call(this,e,n,this._logger),setTimeout(function(){i._initialize()},250)};return h.prototype=Object.create(o.prototype),h.prototype.constructor=h,h.prototype.destroy=function(){},h.prototype.reLaunch=function(){this._logger.debug("reLaunch from client..."),this._territoryId&&(this._client.removeUI(this._territoryId),this._territoryId=void 0),this._treeBrowser.deleteNode(this._treeNodes[l]),this._initialize()},h.prototype._initialize=function(){var t=this;this._selfPatterns={},this._nodes={},this._crosscuts={},this._treeNodes={},this._crosscutTreeNodes={},this._treeBrowser.onNodeOpen=function(e){t._onNodeOpen(e)},this._treeBrowser.onNodeClose=function(e){t._onNodeClose(e)},this._treeBrowser.onNodeDoubleClicked=function(e){t._onNodeDoubleClicked(e)},this._territoryId=this._client.addUI(this,function(e){t._territoryCallback(e)}),this._treeNodes[l]=this._treeBrowser.createNode(null,{id:l,name:"Initializing tree...",hasChildren:!1,"class":r}),this._selfPatterns[l]={children:1},this._client.updateTerritory(this._territoryId,this._selfPatterns)},h.prototype._getNodeDescBase=function(){return{children:[],crosscuts:[]}},h.prototype._territoryCallback=function(t){var e,n=t.length;for(e=0;n>e;e+=1)switch(t[e].etype){case i.TERRITORY_EVENT_LOAD:this._insertOrUpdate(t[e].eid);break;case i.TERRITORY_EVENT_UPDATE:this._insertOrUpdate(t[e].eid);break;case i.TERRITORY_EVENT_UNLOAD:this._removeTreeNode(t[e].eid)}},h.prototype._insertOrUpdate=function(t,e){var n=this._needsToBeInTree(t),i=!1;return n?this._treeNodes[t]?this._updateTreeNode(t):i=this._createTreeNode(t,e):this._treeNodes[t]&&this._removeTreeNode(t),i},h.prototype._createTreeNode=function(t,e){var n,i=this._client.getNode(t),o=i.getParentId(),s=!1;return this._treeNodes[o]&&(this._treeNodes[o].isExpanded()||e===!0)&&(n=this._treeNodes[o],this._treeNodes[t]=this._treeBrowser.createNode(n,{id:t,name:"Loading...",hasChildren:!1,"class":r}),this._updateTreeNode(t),s=!0),s},h.prototype._updateTreeNode=function(t){var e,n=this._client.getNode(t);e={name:n.getFullyQualifiedName(),hasChildren:this._isExpandable(t),"class":s},this._treeNodes[t].isExpanded()?(e.icon=this.getIcon(t,!0),this._treeBrowser.updateNode(this._treeNodes[t],e),this._updateExpandedTreeNode(t)):(e.icon=this.getIcon(t),this._treeBrowser.updateNode(this._treeNodes[t],e))},h.prototype._updateExpandedTreeNode=function(t){var n,i,o,r,s=e.getCrosscuts(t),a=[],l=this._nodes[t].crosscuts.slice(0);for(_.each(s,function(t){a.push(t.SetID)}),n=_.difference(l,a),i=n.length;i--;)this._removeXCutTreeNode(t,n[i]);for(n=_.difference(a,l),i=n.length;i--;){for(r=s.length,o=void 0;r--;)if(s[r].SetID===n[i]){o=s[r];break}this._createXCutTreeNode(t,o)}for(n=_.intersection(l,a),i=n.length;i--;){for(r=s.length,o=void 0;r--;)if(s[r].SetID===n[i]){o=s[r];break}this._updateXCutTreeNode(t,o)}this._nodes[t].crosscuts=a.slice(0)},h.prototype._needsToBeInTree=function(t){var n=!1,i=this._client.getNode(t);return t===l?n=!0:i&&(n=i.getChildrenIds().length>0||e.getCrosscuts(t).length>0),n},h.prototype._onNodeOpen=function(t){var n,i,o,r=this._client.getNode(t),s=this;if(r){for(this._nodes[t]=this._getNodeDescBase(),n=r.getChildrenIds(),i=0;i<n.length;i+=1)o=n[i],this._insertOrUpdate(o,!0)&&(this._selfPatterns[o]={children:1},this._nodes[t].children.push(o));_.each(e.getCrosscuts(t),function(e){s._createXCutTreeNode(t,e,!0)}),this._treeBrowser.updateNode(this._treeNodes[t],{icon:this.getIcon(r,!0)})}this._client.updateTerritory(this._territoryId,this._selfPatterns)},h.prototype._createXCutTreeNode=function(t,e,n){var i,o=e.SetID,r=this._getFullCrosscutID(t,o);this._treeNodes[t]&&(this._treeNodes[t].isExpanded()||n===!0)&&(i=this._treeNodes[t],this._nodes[t].crosscuts.push(o),this._crosscutTreeNodes[r]=this._treeBrowser.createNode(i,{id:r,name:e.title,hasChildren:!1,"class":a}),this._crosscuts[r]=t)},h.prototype._getFullCrosscutID=function(t,e){return t+"_"+e},h.prototype._getCrosscutID=function(t,e){return t.substr(e.length+1)},h.prototype._onNodeClose=function(t){var e,n=[],i=this,o=this._selfPatterns;e=function(t,r){var s,a;if(i._nodes[t]){for(s=0;s<i._nodes[t].children.length;s+=1)e(i._nodes[t].children[s],!0);for(s=0;s<i._nodes[t].crosscuts.length;s+=1)a=i._getFullCrosscutID(t,i._nodes[t].crosscuts[s]),delete i._crosscuts[a],delete i._crosscutTreeNodes[a]}r===!0&&(delete i._nodes[t],delete i._treeNodes[t],n.push(t),delete o[t])},e(t,!1),this._nodes[t].crosscuts=[],this._nodes[t].children=[],this._treeBrowser.updateNode(this._treeNodes[t],{icon:this.getIcon(t)}),n.length>0&&this._client.updateTerritory(this._territoryId,o)},h.prototype._onNodeDoubleClicked=function(t){this._logger.debug("_onNodeDoubleClicked with nodeId: "+t);var e={},n=this,o=function(){var e,i,o=n._client.getNode(n._crosscuts[t]);if(o&&(e=o.getRegistry(d),e&&e.length>0))for(i=0;i<e.length;i+=1)if(e[i].SetID===n._getCrosscutID(t,n._crosscuts[t]))return e[i].order;return 0};this._crosscuts.hasOwnProperty(t)?(e[i.STATE_ACTIVE_OBJECT]=this._crosscuts[t],e[i.STATE_ACTIVE_TAB]=o()):(e[i.STATE_ACTIVE_OBJECT]=t,e[i.STATE_ACTIVE_TAB]=0),e[i.STATE_ACTIVE_VISUALIZER]=c,WebGMEGlobal.State.set(e)},h.prototype._isExpandable=function(t){var n=!1,i=this._client.getNode(t);return i&&(n=i.getChildrenIds().length>0||e.getCrosscuts(t).length>0),n},h.prototype._removeTreeNode=function(t){var e=this._treeNodes[t];e&&(e.isExpanded()&&this._onNodeClose(t),this._treeBrowser.deleteNode(e),delete this._nodes[t],delete this._treeNodes[t],delete this._selfPatterns[t],this._client.updateTerritory(this._territoryId,this._selfPatterns))},h.prototype._removeXCutTreeNode=function(t,e){var n,i=this._getFullCrosscutID(t,e);this._crosscutTreeNodes[i]&&(n=this._nodes[t].crosscuts.indexOf(e),this._nodes[t].crosscuts.splice(n,1),this._treeBrowser.deleteNode(this._crosscutTreeNodes[i]),delete this._crosscutTreeNodes[i],delete this._crosscuts[i])},h.prototype._updateXCutTreeNode=function(t,e){var n=e.SetID,i=this._getFullCrosscutID(t,n);this._crosscutTreeNodes[i]&&this._treeBrowser.updateNode(this._crosscutTreeNodes[i],{id:i,name:e.title})},h}),define("js/KeyboardManager/IKeyTarget",[],function(){"use strict";var t;return t=function(){},t.prototype.onKeyDown=function(t){this.logger.warn("IKeyTarget.prototype.onKeyDown IS NOT IMPLEMENTED!!! eventArgs: "+JSON.stringify(t))},t.prototype.onKeyUp=function(t){this.logger.warn("IKeyTarget.prototype.onKeyUp IS NOT IMPLEMENTED!!! eventArgs: "+JSON.stringify(t))},t}),define("js/Widgets/TreeBrowser/TreeBrowserWidget.Keyboard",["js/KeyboardManager/IKeyTarget"],function(t){"use strict";var e;return e=function(){this.selectionStartNode=null,this.prevFocused=null},_.extend(e.prototype,t.prototype),e.prototype._dropSelectionStateWithShift=function(){this.selectionStartNode=null},e.prototype._registerKeyboardListener=function(){WebGMEGlobal.KeyboardManager.setListener(this)},e.prototype._unregisterKeyboardListener=function(){WebGMEGlobal.KeyboardManager.setListener(void 0)},e.prototype.onKeyDown=function(t){var e,n,i,o,r,s,a=!0,l=this._treeInstance.getSelectedNodes(),c=this._treeInstance.getFocusNode(),d=null;switch(c||(c=this._treeInstance.getSelectedNodes(),c.length>0?c=c[0]:(c=this._treeInstance.getRootNode().getChildren(),c&&c.length>0&&(c=c[0]))),this.prevFocused=this._treeInstance.getFocusNode(),t.combo){case"del":this._dropSelectionStateWithShift(),this._nodeDelete(c),a=!1;break;case"return":this._dropSelectionStateWithShift(),this.onNodeDoubleClicked(c.key),a=!1;break;case"f2":this._dropSelectionStateWithShift(),setTimeout(function(){c.editStart()}),a=!1;break;case"up":case"shift+up":for(t.shiftKey!==!0&&this._deselectSelectedNodes(),d=c.getPrevSibling();d&&d.isExpanded()&&d.getChildren();)i=d.getChildren(),d=i[i.length-1];n=c.getParent(),!d&&n&&n.getParent()&&(d=n),d&&(d.setFocus(!0),d.setSelected(!0),t.shiftKey&&(l=this._treeInstance.getSelectedNodes(),this.selectionStartNode=this.selectionStartNode||this.prevFocused,r=l.indexOf(this.selectionStartNode),s=l.indexOf(d),s>=r&&this.prevFocused&&this.prevFocused.setSelected(!1))),a=!1;break;case"down":case"shift+down":if(t.shiftKey!==!0&&this._deselectSelectedNodes(),i=c.getChildren(),c.isExpanded()&&i)d=i[0];else for(e=c.getParentList(!1,!0),o=e.length-1;o>=0&&!(d=e[o].getNextSibling());o-=1);d&&(d.setFocus(!0),d.setSelected(!0),l=this._treeInstance.getSelectedNodes(),t.shiftKey&&(this.selectionStartNode=this.selectionStartNode||this.prevFocused,r=l.indexOf(this.selectionStartNode),s=l.indexOf(d),r>=s&&this.prevFocused&&this.prevFocused.setSelected(!1))),a=!1;break;case"left":this._dropSelectionStateWithShift(),c.isExpanded()&&(c.toggleExpanded(),c.setFocus(!0),c.setSelected(!0)),a=!1;break;case"right":this._dropSelectionStateWithShift(),c.isExpanded()||!c.getChildren()&&!c.isLazy()||(c.toggleExpanded(),c.setFocus(!0),c.setSelected(!0)),a=!1;break;case"ctrl+c":this._dropSelectionStateWithShift(),this._nodeCopy(),a=!1;break;case"ctrl+v":this._dropSelectionStateWithShift(),this._nodePaste(c),a=!1}return this.prevFocused=this._treeInstance.getFocusNode(),this.selectionStartNode=this.selectionStartNode||this.prevFocused,a},e.prototype.onKeyUp=function(){},e}),define("css!js/Widgets/TreeBrowser/styles/TreeBrowserWidget",[],function(){}),define("js/Widgets/TreeBrowser/TreeBrowserWidget",["js/logger","js/Constants","./TreeBrowserWidget.Keyboard","js/DragDrop/DragSource","jquery-fancytree","jquery-contextMenu","css!./styles/TreeBrowserWidget.css"],function(t,e,n,i){"use strict";function o(e,n){this._logger=t.create("gme:Widgets:TreeBrowser:TreeBrowserWidget",WebGMEGlobal.gmeConfig.client.log),n=n||{},this._el=e,this._isReadOnly=!1,this._initialize(n),this._logger.debug("Ctor finished...")}var r="node-progress",s="tree-browser";return o.prototype._initialize=function(t){var e,n,i=this;this._el.html(""),this._el.addClass(s),this._treeEl=$("<div/>",{}),this._initializeFilters(t),this._el.append(this._treeEl),n=function(t){return i._createContextMenu(t)},this._treeEl.contextMenu({selector:".fancytree-node",position:function(t){var e=t.$trigger.find(".fancytree-title").offset();t.$menu.css({top:e.top+10,left:e.left-10})},build:function(t){return{callback:function(t,e){var n=$.ui.fancytree.getNode(e.$trigger),i="clicked: '"+t+"' on '"+n.title+" ("+n.key+")'";alert(i)},items:n(t)}}}),this._treeEl.fancytree({source:[],toggleEffect:!1,checkbox:!1,selectMode:2,minExpandLevel:1,keyboard:!1,autoScroll:!0,imagePath:"/",debugLevel:0,quicksearch:!0,lazyLoad:function(t,e){i._logger.debug("onLazyRead node:"+e.node.key),i.onNodeOpen.call(i,e.node.key),t.preventDefault(),t.stopPropagation()},beforeActivate:function(t,e){i._logger.debug("### beforeActivate",e.node.title,t,e)},onActivate:function(t,e){i._logger.debug("### onActivate",e.node.title,t,e)},deactivate:function(t,e){i._logger.debug("### deactivate",e.node.title,t,e)},beforeSelect:function(t,e){i._logger.debug("### beforeSelect",e.node.title,t,e)},select:function(t,e){i._logger.debug("### select",e.node.title,t,e)},focus:function(t,e){i._logger.debug("### focus",t,e),i._registerKeyboardListener()},click:function(t,e){return i._logger.debug("### click",e.node.title,t,e),t.ctrlKey===!0||t.metaKey===!0?(e.node.isSelected()===!0?e.node.setFocus(!1):e.node.setFocus(!0),e.node.toggleSelected()):e.node.isSelected()===!1?(i._deselectSelectedNodes(),e.node.setSelected(!0),e.node.setFocus(!0)):e.node.setFocus(!1),"expander"!==e.targetType?void t.preventDefault():void 0},collapse:function(t,e){i._logger.debug("Collapsing node:"+e.node.key),e.node.resetLazy(),i.onNodeClose.call(i,e.node.key)},focusTree:function(t,e){i._logger.debug("### focusTree",t,e),i._registerKeyboardListener()},blurTree:function(t,e){i._logger.debug("### blurTree",t,e)},dblclick:function(t,n){return i._logger.debug("Node double-click: "+n.node.key),t.ctrlKey===!0||t.metaKey===!0?void t.preventDefault():"expander"===n.targetType?void t.preventDefault():(i._deselectSelectedNodes(),n.node.setSelected(!0),e=n.node,void($.isFunction(i.onNodeDoubleClicked)&&(i._logger.debug("default double-click handler: "+n.node.key),i.onNodeDoubleClicked.call(i,n.node.key),t.preventDefault())))},createNode:function(t,e){i._makeNodeDraggable(e.node)},removeNode:function(t,e){i._destroyDraggable(e.node)},extensions:["edit","filter"],edit:{adjustWidthOfs:4,allowEmpty:!0,inputCss:{minWidth:"3em"},triggerCancel:["enter"],triggerStart:[],beforeEdit:function(t,e){return i._logger.debug("beforeEdit",t,e),e.node.extraClasses===r||i._isReadOnly?!1:void 0},edit:function(t,e){i._logger.debug("edit",t,e)},beforeClose:function(t,e){i._logger.debug("beforeClose",t,e)},save:function(t,e){i._logger.debug("save",t,e)},close:function(t,e){i._logger.debug("close",t,e),e.dirty===!0&&i.onNodeTitleChanged(e.node.key,e.orgTitle,e.node.title),i._registerKeyboardListener()}},filter:{autoApply:!0,counter:!1,hideExpandedCounter:!0,mode:"hide",highlight:!1}}),this._treeInstance=this._treeEl.fancytree("getTree"),this._treeEl.append(this._noFilterMatchesEl)},o.prototype.enableUpdate=function(){this._logger.warn("TreeBrowserWidget.enableUpdate not valid with fancy tree. Use TreeBrowserWidgetcreateNodes instead!")},o.prototype.setReadOnly=function(t){this._isReadOnly=t},o.prototype.createNodes=function(t,e){var n,i,o,r=[];for(null===t&&(t=this._treeInstance.getRootNode()),t.getChildren()&&(n={},t.getChildren().forEach(function(t){n[t.key]=!0})),o=0;o<e.length;o+=1)r.push({title:e[o].name,tooltip:e[o].libraryInfo?e[o].libraryInfo:e[o].metaType?"<<"+e[o].metaType+">>":"",key:e[o].id,folder:!1,lazy:e[o].hasChildren,extraClasses:e[o]["class"]||"",icon:e[o].icon||null,isConnection:e[o].isConnection,isAbstract:e[o].isAbstract,isLibrary:e[o].isLibrary,isLibraryRoot:e[o].isLibraryRoot,libraryInfo:e[o].libraryInfo,metaType:e[o].metaType,isMetaNode:e[o].isMetaNode});if(r.length>0?(t.addChildren(r),i=t.getChildren().slice(),this.sortChildren(t,!1),this._logger.debug("nodes created",i)):(i=[],this._logger.debug("no new nodes created")),n)for(o=i.length-1;o>=0;o-=1)n[i[o].key]===!0&&i.splice(o,1);return i},o.prototype.createNode=function(t,e){var n,i,o,r;if(e.name=e.name||"",null===t&&(t=this._treeInstance.getRootNode()),n=null,i=t.getChildren())for(o=i.length-1;o>=0&&e.name.toLowerCase()<i[o].title.toLowerCase();o-=1)n=i[o];return r=t.addChildren({title:e.name,tooltip:e.libraryInfo?e.libraryInfo:e.metaType?"<<"+e.metaType+">>":"",key:e.id,folder:!1,lazy:e.hasChildren,extraClasses:e["class"]||"",icon:e.icon||null,isConnection:e.isConnection,isAbstract:e.isAbstract,isLibrary:e.isLibrary,isLibraryRoot:e.isLibraryRoot,libraryInfo:e.libraryInfo,metaType:e.metaType,isMetaNode:e.isMetaNode},n),this.sortChildren(t,!1),this._logger.debug("New node created: "+r.key),r},o.prototype.deleteNode=function(t){t&&(t.remove(),this._logger.debug("Node deleted: "+t.key))},o.prototype.updateNode=function(t,e){var n,i,o=!1,r=!1;t&&(e.hasOwnProperty("name")&&t.title!==e.name&&(n=e.name,t.setTitle(n),r=!0),(e.hasChildren===!0||e.hasChildren===!1)&&e.hasChildren!==t.isFolder()&&(t.folder=e.hasChildren,t.isExpanded()||e.hasChildren!==!0?e.hasChildren===!1&&(t.lazy=!1):t.resetLazy(),o=!0),e["class"]&&t.extraClasses!==e["class"]&&(t.extraClasses=e["class"],o=!0),e.icon&&t.icon!==e.icon&&(t.icon=e.icon,o=!0),e.hasOwnProperty("isAbstract")&&e.isAbstract!==t.data.isAbstract&&(t.data.isAbstract=e.isAbstract,o=!0),e.hasOwnProperty("isConnection")&&e.isConnection!==t.data.isConnection&&(t.data.isConnection=e.isConnection,o=!0),e.hasOwnProperty("metaType")&&e.metaType!==t.data.metaType&&(t.data.metaType=e.metaType,t.tooltip="<<"+e.metaType+">>",o=!0),e.hasOwnProperty("isMetaNode")&&e.isMetaNode!==t.data.isMetaNode&&(t.data.isMetaNode=e.isMetaNode,o=!0),e.hasOwnProperty("libraryInfo")&&"string"==typeof e.librayInfo&&e.libraryInfo!==t.data.libraryInfo&&(t.data.libraryInfo=e.libraryInfo,t.tooltip=e.libraryInfo,o=!0),e.hasOwnProperty("isLibrary")&&e.isLibrary!==t.data.isLibrary&&(t.data.isLibrary=e.isLibrary,o=!0),e.hasOwnProperty("isLibraryRoot")&&e.isLibraryRoot!==t.data.isLibraryRoot&&(t.data.isLibraryRoot=e.isLibraryRoot,o=!0),o===!0&&(t.render(!0),this._logger.debug("Node updated: "+t.key)),r===!0&&(i=t.getParent(),i&&this.sortChildren(i,!1)),o&&e.hasChildren===!0&&this.sortChildren(t,!1))},o.prototype.onNodeOpen=function(t){this._logger.warn("Default onNodeOpen for node "+t+" called, doing nothing. Please override onNodeOpen(nodeId)")},o.prototype.onNodeClose=function(t){this._logger.warn("Default onNodeClose for node "+t+" called, doing nothing. Please override onNodeClose(nodeId)")},o.prototype.onNodeTitleChanged=function(t,e,n){return this._logger.warn("Default onNodeTitleChanged for node "+t+" called, doing nothing.Please override onNodeTitleChanged(nodeId, oldText, newText)",e,n),!0},o.prototype.collapse=function(t){t.setExpanded(!1)},o.prototype.expand=function(t){t.setExpanded(!0)},o.prototype.isExpanded=function(t){return null===t?!0:t.isExpanded()},o.prototype._makeNodeDraggable=function(t){var e=$(t.span),n=this;i.makeDraggable(e,{helper:function(t){return n._dragHelper(this,t)},dragItems:function(e){return t.isSelected()===!1&&(n._deselectSelectedNodes(),t.setSelected(!0),t.setFocus(!0)),n.getDragItems(e)},dragEffects:function(t){return n.getDragEffects(t)},dragParams:function(t){return n.getDragParams(t)}})},o.prototype._destroyDraggable=function(t){var e=$(t.span);i.destroyDraggable(e)},o.prototype._dragHelper=function(t){var e,n,i,o,a=t.clone(),l=$('<div class="'+s+'"><ul class="fancytree-container"><li></li></ul></div>'),c=["fancytree-selected","fancytree-focus","fancytree-has-children","fancytree-lazy","fancytree-lastsib","fancytree-exp-cdl","fancytree-ico-c"];for(a.children().first().remove(),a.removeClass(c.join(" ")),l.find("li").append(a),a=l,e=[],n=this._treeInstance.getSelectedNodes(),i=0;i<n.length;i+=1)n[i].extraClasses!==r&&e.push(n[i].key);return e.length>1&&(o=a.find(".fancytree-title").text(),a.find(".fancytree-title").text(o+" (+"+(e.length-1)+")")),a},o.prototype.getDragItems=function(){return this._logger.warn("TreeBrowserWidget.getDragItems is not overridden in the controller!!!"),[]},o.prototype.getDragEffects=function(){return this._logger.warn("TreeBrowserWidget.getDragEffects is not overridden in the controller!!!"),[]},o.prototype.getDragParams=function(){return void this._logger.debug("TreeBrowserWidget.getDragParams is not overridden in the controller!!!")},o.prototype.DRAG_EFFECTS=i.DRAG_EFFECTS,o.prototype._nodeCopy=function(){var t,e,n=[];for(t=this._treeInstance.getSelectedNodes(),e=0;e<t.length;e+=1)t[e].extraClasses!==r&&n.push(t[e].key);this._logger.debug("Copy "+n),$.isFunction(this.onNodeCopy)&&this.onNodeCopy(n)},o.prototype._nodePaste=function(t){t.extraClasses!==r&&(this._logger.debug("Paste "+t.key),$.isFunction(this.onNodePaste)&&this.onNodePaste(t.key))},o.prototype._nodeDelete=function(t){var e,n,i;if(t.extraClasses!==r){for(e=[],n=this._treeInstance.getSelectedNodes(),i=0;i<n.length;i+=1)n[i].extraClasses!==r&&e.push(n[i].key);this._logger.debug("Delete "+e),$.isFunction(this.onNodeDelete)&&this.onNodeDelete(e)}},o.prototype._deselectSelectedNodes=function(){var t,e;for(e=this._treeInstance.getSelectedNodes(),t=0;t<e.length;t+=1)e[t].setSelected(!1);this._dropSelectionStateWithShift()},o.prototype._createContextMenu=function(t){var e,n=$.ui.fancytree.getNode(t),i={},o=this;return t.hasClass(r)!==!0?(n.isSelected()===!1&&(o._deselectSelectedNodes(),n.setSelected(!0)),n.setFocus(!0),e=o.getSelectedIDs().length>1,i={toggleNode:{name:"Expand",callback:function(){n.toggleExpanded()},icon:!1},selectNode:{name:"Select node",callback:function(){o.onMakeNodeSelected.call(o,n.key)},icon:!1},open:{name:"Open in visualizer",callback:function(){o.onNodeDoubleClicked.call(o,n.key)},icon:"paste"}},i.separatorOperationsStart="-",i.rename={name:"Rename",callback:function(){n.editStart()},icon:"edit"},i["delete"]={name:e?"Delete selection":"Delete",callback:function(){o._nodeDelete(n)},icon:"delete"},t.hasClass("fancytree-has-children")===!0?n.isExpanded()&&(i.toggleNode.name="Collapse"):delete i.toggleNode,o.onExtendMenuItems(n.key,i)):i={loading:{name:"Node is loading...",callback:function(){},icon:!1}},i},o.prototype.getSelectedIDs=function(){var t,e,n=[];for(t=this._treeInstance.getSelectedNodes(),e=0;e<t.length;e+=1)t[e].extraClasses!==r&&n.push(t[e].key);return n},o.prototype.onExtendMenuItems=function(t){this._logger.debug('onExtendMenuItems is not overridden for node with ID: "'+t+'".')},o.prototype.onCreatingContextMenu=function(t,e){this._logger.debug('onCreatingContextMenu is not overridden for node with ID: "'+t+'", contextMenuOptions: '+JSON.stringify(e))},o.prototype._initializeFilters=function(t){function e(t,e){var n,i,o,r=$('<div class="input-group input-group-sm filter-input-form">'),c=$('<input type="text" class="form-control" placeholder="'+e+'"aria-describedby="sizing-addon3">'),d=$('<span class="input-group-btn"><button class="btn btn-default btn-clear-filter" type="button"><i class="glyphicon glyphicon-remove-circle"/></button></span>');s||(s=$('<span class="btn-group input-filter-type" data-toggle="buttons"><label class="btn btn-default btn-xs btn-case-insensitive" title="Case insensitive"><input type="radio"/>AA</label><label class="btn btn-default btn-xs btn-case-sensitive" title="Case sensitive"><input type="radio">Aa</label><label class="btn btn-default btn-xs btn-regex" title="Regular expression"><input type="radio">.*</label></span>'),n=s.find(".btn-case-insensitive"),i=s.find(".btn-case-sensitive"),o=s.find(".btn-regex"),"caseInsensitive"===a._currentFilters[t].type?n.addClass("active"):"caseSensitive"===a._currentFilters[t].type?i.addClass("active"):"regex"===a._currentFilters[t].type&&o.addClass("active"),n.click(function(){a._currentFilters.hasOwnProperty("titleFilter")&&(a._currentFilters.titleFilter.type="caseInsensitive"),a._currentFilters.hasOwnProperty("metaTypeFilter")&&(a._currentFilters.metaTypeFilter.type="caseInsensitive"),a.applyFilters()}),i.click(function(){a._currentFilters.hasOwnProperty("titleFilter")&&(a._currentFilters.titleFilter.type="caseSensitive"),a._currentFilters.hasOwnProperty("metaTypeFilter")&&(a._currentFilters.metaTypeFilter.type="caseSensitive"),a.applyFilters()}),o.click(function(){a._currentFilters.hasOwnProperty("titleFilter")&&(a._currentFilters.titleFilter.type="regex"),a._currentFilters.hasOwnProperty("metaTypeFilter")&&(a._currentFilters.metaTypeFilter.type="regex"),a.applyFilters()}),l.append(s)),c.keyup(function(){a._currentFilters[t].text=c.val(),a.applyFilters()}),d.find("button.btn-clear-filter").click(function(){c.val(""),a._currentFilters[t].text=c.val(),a.applyFilters()}),r.append(c),r.append(d),l.append(r)}function n(t,e,n){var i=$('<button class="btn btn-default btn-xs" type="checkbox">'+n+"</button>");r=r||$('<span class="btn-group filter-toggle-buttons" data-toggle="buttons"/>'),a._currentFilters[t]===!0?(i.addClass("active"),i.prop("title","Show "+e)):i.prop("title","Hide "+e),i.click(function(){var n=$(this);n.hasClass("active")?(n.prop("title","Hide "+e),n.removeClass("active")):(n.prop("title","Show "+e),n.addClass("active")),a._currentFilters[t]=!a._currentFilters[t],a.applyFilters()}),r.append(i)}var i,o,r,s,a=this,l=$('<div class="filter-form">');this._filterFunctions=[],this._currentFilters={},"boolean"==typeof t.hideConnections&&(a._currentFilters.hideConnections=t.hideConnections,a._filterFunctions.push(function(t){return a._currentFilters.hideConnections===!0?t.data.isConnection!==!0:!0}),n("hideConnections","connections",'<i class="fa gme-connection"/>')),"boolean"==typeof t.hideAbstracts&&(a._currentFilters.hideAbstracts=t.hideAbstracts,
a._filterFunctions.push(function(t){return a._currentFilters.hideAbstracts===!0?t.data.isAbstract!==!0:!0}),n("hideAbstracts","abstract nodes",'<i class="fa fa-code"/>')),"boolean"==typeof t.hideLeaves&&(a._currentFilters.hideLeaves=t.hideLeaves,a._filterFunctions.push(function(t){return a._currentFilters.hideLeaves===!0?t.isFolder()===!0||t.lazy===!0:!0}),n("hideLeaves","leaf nodes",'<i class="fa gme-atom"/>')),"boolean"==typeof t.hideLibraries&&(a._currentFilters.hideLibraries=t.hideLibraries,a._filterFunctions.push(function(t){return a._currentFilters.hideLibraries===!0?t.data.isLibrary!==!0:!0}),n("hideLibraries","libraries",'<i class="fa gme-library"/>')),"boolean"==typeof t.hideMetaNodes&&(a._currentFilters.hideMetaNodes=t.hideMetaNodes,a._filterFunctions.push(function(t){return a._currentFilters.hideMetaNodes===!0?t.data.isMetaNode!==!0:!0}),n("hideMetaNodes","meta nodes",'<i class="fa gme-meta-node"/>')),r&&l.append(r),t.titleFilter&&(a._currentFilters.titleFilter=t.titleFilter,a._filterFunctions.push(function(t){if(!a._currentFilters.titleFilter.text)return!0;if("caseInsensitive"===a._currentFilters.titleFilter.type)return t.title.toLowerCase().indexOf(a._currentFilters.titleFilter.text.toLowerCase())>-1;if("regex"!==a._currentFilters.titleFilter.type)return t.title.indexOf(a._currentFilters.titleFilter.text)>-1;try{return new RegExp(a._currentFilters.titleFilter.text).test(t.title)}catch(e){return!0}}),e("titleFilter","Filter by name...")),t.metaTypeFilter&&(a._currentFilters.metaTypeFilter=t.metaTypeFilter,a._filterFunctions.push(function(t){if(!a._currentFilters.metaTypeFilter.text)return!0;if("caseInsensitive"===a._currentFilters.metaTypeFilter.type)return(t.data.metaType||"").toLowerCase().indexOf(a._currentFilters.metaTypeFilter.text.toLowerCase())>-1;if("regex"!==a._currentFilters.metaTypeFilter.type)return(t.data.metaType||"").indexOf(a._currentFilters.metaTypeFilter.text)>-1;try{return new RegExp(a._currentFilters.metaTypeFilter.text).test(t.data.metaType||"")}catch(e){return!0}}),e("metaTypeFilter","Filter by meta type...")),i=$('<div class="filter-container collapsed"/>'),o=$('<button class="btn btn-default btn-xs btn-hide-show-filters pull-right" type="button"title="Show filters..."><i class="fa fa-angle-left expand-filter"/><i class="fa fa-angle-right collapse-filter"/><i class="glyphicon glyphicon-filter filter-icon"/></button>'),o.click(function(){var t=$(this);i.hasClass("collapsed")?(i.removeClass("collapsed"),t.prop("title","Hide filters...")):(i.addClass("collapsed"),t.prop("title","Show filters..."))}),i.append(o),i.append(l),this._treeEl.append(i),this._noFilterMatchesEl=$('<span class="all-filtered-out hidden">No matches...</span>')},o.prototype.applyFilters=function(t){var e,n,i=this;this._currentFilters=t||this._currentFilters,n=function(t){var e;for(e=0;e<i._filterFunctions.length;e+=1)if(i._filterFunctions[e](t)===!1)return!1;return!0},e=this._treeInstance.filterNodes(n),0===e?this._noFilterMatchesEl.removeClass("hidden"):this._noFilterMatchesEl.addClass("hidden")},o.prototype.clearFilters=function(){this._treeInstance.clearFilter()},o.prototype.sortChildren=function(t,e){var n=function(t,e){return t.data.isConnection!==!0||e.data.isConnection?(e.data.isConnection!==!0||t.data.isConnection)&&(t.data.isLibraryRoot!==!0||e.data.isLibraryRoot)?e.data.isLibraryRoot!==!0||t.data.isLibraryRoot?t.title.toLowerCase()>e.title.toLowerCase()?1:t.title.toLowerCase()<e.title.toLowerCase()?-1:0:1:-1:1};t.sortChildren(n,e)},_.extend(o.prototype,n.prototype),o}),define("css!js/Panels/ObjectBrowser/styles/ObjectBrowserPanel",[],function(){}),define("js/Panels/ObjectBrowser/ObjectBrowserPanel",["js/PanelBase/PanelBaseWithHeader","js/Constants","./TreeBrowserControl","./InheritanceBrowserControl","./CrosscutBrowserControl","js/Widgets/TreeBrowser/TreeBrowserWidget","js/Utils/ComponentSettings","js/UIEvents","css!./styles/ObjectBrowserPanel.css"],function(t,e,n,i,o,r,s,a){"use strict";var l,c=t,d="object-browser";return l=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="ObjectBrowserPanel",i[t.OPTIONS.HEADER_TITLE]=!0,c.apply(this,[i,e]),this._client=n.client,this._initialize(),this.logger.debug("ObjectBrowserPanel ctor finished")},_.extend(l.prototype,c.prototype),l.prototype._initialize=function(){var t,e,l,c,h,p,g,u,f,m=this;this.$el.addClass(d),this.$el.html('<ul class="nav nav-tabs"><li class="composition active"><a class="composition-anchor" href="#composition" data-toggle="tab">Composition</a></li><li class="inheritance"><a href="#inheritance" data-toggle="tab">Inheritance</a></li><li class="crosscut"><a href="#crosscut" data-toggle="tab">Crosscut</a></li></ul><div class="tab-content"><div class="tab-pane active" id="composition">composition</div><div class="tab-pane" id="inheritance">inheritance</div><div class="tab-pane" id="crosscut">crosscut</div></div>'),f=this.$el.find("a.composition-anchor"),this.setTitle("Object Browser"),u=n.getDefaultConfig(),s.resolveWithWebGMEGlobal(u,n.getComponentId()),e=new r(this.$el.find("div#composition").first(),{hideConnections:u.filters.toggled.hideConnections,hideAbstracts:u.filters.toggled.hideAbstracts,hideLeaves:u.filters.toggled.hideLeaves,hideLibraries:u.filters.toggled.hideLibraries,hideMetaNodes:u.filters.toggled.hideMetaNodes,titleFilter:{text:"",type:"caseInsensitive"},metaTypeFilter:{text:"",type:"caseInsensitive"}}),l=new n(this._client,e,u),c=new r(this.$el.find("div#inheritance").first(),{titleFilter:{text:"",type:"caseInsensitive"}}),h=new i(this._client,c),p=new r(this.$el.find("div#crosscut").first(),{titleFilter:{text:"",type:"caseInsensitive"}}),g=new o(this._client,p),t=WebGMEGlobal.Toolbar,t&&(t.addSeparator(),t.addButton({title:"Locate in tree browser",icon:"glyphicon glyphicon-screenshot",data:{},clickFn:function(){var t=WebGMEGlobal.State.getActiveObject(),e=WebGMEGlobal.State.getActiveSelection();e&&e.length>0&&(t=e[0]),"string"==typeof t&&m._client.dispatchEvent(a.LOCATE_NODE,{nodeId:t})}})),this._client.addEventListener(a.LOCATE_NODE,function(t,e){f.click(),"string"==typeof e.nodeId&&l.locateNode(e.nodeId)})},l}),define("css!js/Loader/styles/LoaderProgressBar",[],function(){}),define("js/Loader/LoaderProgressBar",["css!js/Loader/styles/LoaderProgressBar.css"],function(){"use strict";var t;return t=function(t){if(this._el=t.containerElement,0===this._el.length)throw"LoaderProgressBar's container control with id:\""+t.containerElement+'" could not be found'},t.prototype._initialize=function(){this._createElements()},t.prototype._removeElements=function(){this._loaderDiv&&this._loaderDiv.remove(),this._loaderDiv=null},t.prototype._createElements=function(){this._loaderDiv||(this._loaderDiv=$("<div/>",{"class":"loader-progressbar"}),this._el.append(this._loaderDiv),this._el.width())},t.prototype.destroy=function(){this._removeElements()},t.prototype.stop=function(){this._removeElements()},t.prototype.start=function(){this._createElements()},t}),define("css!js/Panels/SplitPanel/styles/SplitPanel",[],function(){}),define("js/Panels/SplitPanel/SplitPanel",["js/PanelBase/PanelBase","css!./styles/SplitPanel.css"],function(t){"use strict";var e,n="split-panel",i="p1",o="p2",r="splitter",s=4,a="vertical",l="horizontal",c="resize",d=50,h=25,p=2;return e=function(){var e={};e[t.OPTIONS.LOGGER_INSTANCE_NAME]="SplitPanel",t.apply(this,[e]),this._panel1=void 0,this._panel2=void 0,this._readOnly=!1,this._splitterPos=.5,this._initialize(),this.logger.debug("SplitPanel ctor finished")},_.extend(e.prototype,t.prototype),e.prototype.onResize=function(t,e){this.logger.debug("onResize --> width: "+t+", height: "+e),this._width=t,this._height=e,this.$el.width(this._width),this.$el.height(this._height),this._updateUI()},e.prototype._initialize=function(){var t=this;this.$el.addClass(n),this._panel1Container=$("<div/>",{"class":i}),this.$el.append(this._panel1Container),this._splitter=$("<div/>",{"class":r}),this.$el.append(this._splitter),this._panel2Container=$("<div/>",{"class":o}),this.$el.append(this._panel2Container),this._panel1Container.on("mousedown",function(e){t._setActivePanel(0)}),this._panel2Container.on("mousedown",function(e){t._setActivePanel(1)}),this._splitter.on("mousedown",function(e){t._startPanelResize(e),e.stopPropagation(),e.preventDefault()}),this._updateUI()},e.prototype._updateUI=function(){var t=this._width>this._height,e=this._width,n=this._height,i=this._width,o=this._height,r=s,c=s,d=0,h=0,p=0,g=0,u=0,f=0,m=void 0!==this._panel2;m?(this._splitter.show(),this._panel2Container.show(),this._splitter.removeClass([a,l].join(" "))):(this._splitter.hide(),this._panel2Container.hide()),m?(t?(c=this._height,e=Math.floor((this._width-r)*this._splitterPos),i=this._width-e-r,this._splitter.addClass(a),h=0,g=e,f=e+r):(r=this._width,n=Math.floor((this._height-c)*this._splitterPos),o=this._height-n-c,this._splitter.addClass(l),d=0,p=n,u=n+c),this._splitter.css({width:r,height:c,top:p,left:g}),this._panel1Container.css({width:e,height:n,top:d,left:h}),this._panel2Container.css({width:i,height:o,top:u,left:f}),this._panel1&&this._panel1.setSize(e,n),this._panel2&&this._panel2.setSize(i,o)):(this._panel1Container.css({width:e,height:n,top:d,left:h}),this._panel1&&this._panel1.setSize(e,n),this._splitterPos=.5)},e.prototype.setPanel=function(t,e){"p1"===e?(this._panel1Container.empty(),this._panel1=t,this._panel1Container.append(this._panel1.$pEl),this._panel1.afterAppend(),this._setActivePanel(0)):(this._panel2Container.empty(),this._panel2=t,this._panel2Container.append(this._panel2.$pEl),this._panel2.afterAppend(),this._setActivePanel(1)),this.onReadOnlyChanged(this._readOnly),this._updateUI()},e.prototype.deletePanel=function(t){"p1"===t?(this._panel1Container.empty(),this._panel1=void 0,this._setActivePanel(1)):(this._panel2Container.empty(),this._panel2=void 0,this._setActivePanel(0)),this._updateUI()},e.prototype.onReadOnlyChanged=function(e){t.prototype.onReadOnlyChanged.call(this,e),this._readOnly=e,this._panel1&&this._panel1.onReadOnlyChanged(e),this._panel2&&this._panel2.onReadOnlyChanged(e)},e.prototype._setActivePanel=function(t){0===t&&WebGMEGlobal.PanelManager.setActivePanel(this._panel1),1===t&&WebGMEGlobal.PanelManager.setActivePanel(this._panel2)},e.prototype._startPanelResize=function(t){var e=this,n=this._width>this._height;this._splitterResize=this._splitter.clone().addClass(c),this.$el.append(this._splitterResize),this._splitterResizePos=this._splitterPos,this._splitStartMousePos=n?t.pageX:t.pageY,$(document).on("mousemove.SplitPanel",function(t){e._onMouseMove(t)}),$(document).on("mouseup.SplitPanel",function(t){e._onMouseUp(t)})},e.prototype._onMouseMove=function(t){var e=this._width>this._height,n=e?t.pageX:t.pageY,i=n-this._splitStartMousePos,o=e?this._width:this._height,r=i/o,s=h/o,a=d/o;this._splitterResizePos=this._splitterPos+r,this._splitterResizePos>=.5-s&&this._splitterResizePos<=.5+s&&(this._splitterResizePos=.5),this._splitterResizePos<a&&(this._splitterResizePos=a),this._splitterResizePos>1-a&&(this._splitterResizePos=1-a),this._updateSplitterResize()},e.prototype._updateSplitterResize=function(){var t,e,n=this._width>this._height,i=s+2*p,o=s+2*p;n?(o=this._height,t=Math.floor((this._width-i)*this._splitterResizePos)):(i=this._width,e=Math.floor((this._height-o)*this._splitterResizePos)),this._splitterResize.css({width:i,height:o,top:e,left:t})},e.prototype._onMouseUp=function(t){$(document).off("mousemove.SplitPanel"),$(document).off("mouseup.SplitPanel"),this._splitterPos=this._splitterResizePos,this._splitterResize.remove(),this._splitterResize=void 0,this._splitterResizePos=void 0,this._updateUI()},e}),define("css!js/Panels/Visualizer/styles/VisualizerPanel",[],function(){}),define("js/Panels/Visualizer/VisualizerPanel",["js/logger","js/Loader/LoaderProgressBar","js/Constants","js/RegistryKeys","js/PanelBase/PanelBaseWithHeader","js/Panels/SplitPanel/SplitPanel","css!./styles/VisualizerPanel.css"],function(t,e,n,i,o,r){"use strict";var s,a=WebGMEGlobal.allVisualizers;return s=function(t,e){var n={};n[o.OPTIONS.LOGGER_INSTANCE_NAME]="Visualizer",n[o.OPTIONS.HEADER_TITLE]=!1,o.apply(this,[n]),this._client=e.client,this._layoutManager=t,this._initialize(),this._activePanel={},this._activeVisualizer={},this._currentNodeID=null,this._visualizers={},this._validVisualizers=null,this.defaultVisualizer=a[0]||null,this._loadVisualizers(),this.logger.debug("VisualizerPanel ctor finished")},_.extend(s.prototype,o.prototype),s.prototype._isAvailableVisualizer=function(t){var e;for(e=0;e<a.length;e+=1)if(t===a[e].id)return!0;return!1},s.prototype._initialize=function(){var t=this,e=WebGMEGlobal.Toolbar,i=$("<i/>");this.setTitle("Visualizer"),this.$el.addClass("visualizer-panel"),e.addSeparator(),e.addToggleButton({title:"Split view ON/OFF",icon:i.clone().addClass("gme icon-gme_split-panels"),clickFn:function(e,n){t._p2Editor(n)}}),this._panel1VisContainer=$("<div/>"),this._ul1=$('<ul class="nav nav-pills nav-stacked">'),this._ul1.attr("data-id","p1"),this._panel1VisContainer.append($('<div class="pp">Panel 1:</div>')),this._panel1VisContainer.append(this._ul1),this.$el.append(this._panel1VisContainer),this.$el.on("click","ul > li:not(.active)",function(e){var n=$(this).attr("data-id"),i=$(this).parent();t._setActiveVisualizer(n,i),e.stopPropagation(),e.preventDefault()}),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_OBJECT,function(e,n,i){t.selectedObjectChanged(n,i)}),this._client.addEventListener(n.CLIENT.PROJECT_CLOSED,function(){t._p2Editor(!1),t._validVisualizers=null}),this._client.addEventListener(n.CLIENT.PROJECT_OPENED,function(){t._p2Editor(!1),t._validVisualizers=null}),this._client.addEventListener(n.CLIENT.BRANCH_CHANGED,function(){t._p2Editor(!1),t._validVisualizers=null}),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_VISUALIZER,function(e,n,i){i.invoker!==t&&t.setActiveVisualizer(n)}),this._splitPanel=new r,this._layoutManager.addPanel("visualizerSplitPanel",this._splitPanel,"center")},s.prototype._loadVisualizers=function(){for(var t=this,e=a.length;e--;)a[e]["default"]&&(t.defaultVisualizer=a[e]);this.addRange(a,function(){t._setActiveVisualizer(t.defaultVisualizer.id,t._ul1)})},s.prototype._setActiveVisualizer=function(t,e){var i,o=e.attr("data-id");this._activeVisualizer[o]!==t&&this._visualizers.hasOwnProperty(t)&&(this._activePanel[o]&&this._activePanel[o].destroy(),this._activeVisualizer[o]=t,e.find("> li").removeClass("active"),e.find('> li[data-id="'+t+'"]').addClass("active"),this._activePanel[o]=null,this._visualizers[t]&&(i=this._visualizers[t].panel,i&&(this._activePanel[o]=new i(this._layoutManager,{client:this._client}),this._activePanel[o][n.VISUALIZER_PANEL_IDENTIFIER]=this._visualizers[t].id,this._splitPanel.setPanel(this._activePanel[o],o)),(this._currentNodeID||this._currentNodeID===n.PROJECT_ROOT_ID)&&this._activePanel[o]&&this._activePanel[o].control&&_.isFunction(this._activePanel[o].control.selectedObjectChanged)&&this._activePanel[o].control.selectedObjectChanged(this._currentNodeID)),WebGMEGlobal.State.registerActiveVisualizer(t,{invoker:this}))},s.prototype._updateValidVisualizers=function(t){var e,o;if(t||t===n.PROJECT_ROOT_ID)if(e=this._client.getNode(t)){if(o=e.getRegistry(i.VALID_VISUALIZERS))return void(this._validVisualizers=o.split(" "))}else this.logger.error("could not load node in _updateValidVisualizers",t);else this.logger.debug("nodePath not given");this._validVisualizers=null},s.prototype._getActivePanelElem=function(){var t=WebGMEGlobal.PanelManager.getActivePanel()===this._activePanel.p1?"p1":"p2";return"p1"===t?this._ul1:this._ul2},s.prototype._updateListedVisualizers=function(t){var e,i,o,r=this,s=this._getActivePanelElem(),a=r._client.getNode(r._currentNodeID),l={},c=!1;if(a&&(c=a.isLibraryRoot()),s.children("li").each(function(t,e){var n=$(e),i=n.attr("data-id");null===r._validVisualizers?c&&"SetEditor"===i?n.hide():n.show():(r._validVisualizers.indexOf(i)>-1&&(!c||c&&"SetEditor"!==i)?n.show():n.hide(),l[i]=n.detach())}),null!==r._validVisualizers){for(i=0;i<r._validVisualizers.length;i+=1)o=r._validVisualizers[i],l.hasOwnProperty(o)&&(s.append(l[o]),l[o]=null);for(o in l)null!==l[o]&&s.append(l[o])}this.updateContainerSize(),r._validVisualizers?(e=r._validVisualizers[0],r._isAvailableVisualizer(e)||(e=r.defaultVisualizer.id)):e=r.defaultVisualizer.id,r._isAvailableVisualizer(e)||(e=r._isAvailableVisualizer(n.DEFAULT_VISUALIZER)?n.DEFAULT_VISUALIZER:null),t&&e&&setTimeout(function(){r._setActiveVisualizer(e,s)},0)},s.prototype.setActiveVisualizer=function(t){this._setActiveVisualizer(t,this._getActivePanelElem())},s.prototype._removeLoader=function(t,e){t.loader&&(t.loader.stop(),t.loader.destroy(),delete t.loader),e.remove()},s.prototype.add=function(t,n){var i,o,r=$('<li class="center pointer"><a class="btn-env" id=""></a></li>'),s=r.find("> a"),a=this;return o=function(){n&&n()},t.DEBUG_ONLY===!0&&DEBUG!==!0?void o():void(this._visualizers[t.id]?(this.logger.warn('A visualizer with the ID "'+t.id+'" already exists...'),o()):(r.attr("data-id",t.id),s.text(t.title),this._ul1.append(r),t.panel?(i=$("<div/>",{"class":"vis-loader"}),r.loader=new e({containerElement:i}),r.loader.start(),s.append(i),require([t.panel],function(e){a.logger.debug("downloaded: "+t.panel),a._visualizers[t.id]={panel:e,id:t.id},a._removeLoader(r,i),o()},function(t){var e='Failed to download "'+t.requireModules[0]+'"';a.logger.error(e),s.append(' <i class="glyphicon glyphicon-warning-sign" title="'+e+'"></i>'),a._removeLoader(r,i),o()})):(s.append(' <i class="glyphicon glyphicon-warning-sign"></i>'),this.logger.warn('The visualizer with the ID "'+t.id+'" is missing "panel" or "control"'),o())))},s.prototype.addRange=function(t,e){var n,i,o=0,r=t.length;for(e&&(i=function(){o-=1,0===o&&e()}),n=0;r>n;n+=1)o+=1,this.add(t[n],i)},s.prototype.selectedObjectChanged=function(t,e){this._currentNodeID=t,this._updateValidVisualizers(t),this._updateListedVisualizers(!e.suppressVisualizerFromNode)},s.prototype._p2Editor=function(t){var e,n,i,o;t?(this._panel2VisContainer=this._panel1VisContainer.clone(),this._ul2=this._panel2VisContainer.find("ul"),this._ul2.attr("data-id","p2"),this._panel2VisContainer.find(".pp").text("Panel 2:"),this.$el.append(this._panel2VisContainer),e=this._panel2VisContainer.find("ul > li.active"),n=e.attr("data-id"),i=e.parent(),this._setActiveVisualizer(n,i)):(o="p2",this._activePanel[o]&&this._activePanel[o].destroy&&this._activePanel[o].destroy(),this._activePanel[o]=null,this._activeVisualizer[o]=null,this._panel2VisContainer&&(this._panel2VisContainer.remove(),this._panel2VisContainer=void 0,this._splitPanel.deletePanel("p2"),delete this._ul2),"string"==typeof this._currentNodeID&&WebGMEGlobal.State.registerActiveObject(this._currentNodeID)),this.updateContainerSize()},s}),define("css!js/Widgets/PartBrowser/styles/PartBrowserWidget",[],function(){}),define("js/Widgets/PartBrowser/PartBrowserWidget",["js/logger","js/Constants","js/DragDrop/DragSource","js/Toolbar/ToolbarDropDownButton","js/Toolbar/ToolbarRadioButtonGroup","css!./styles/PartBrowserWidget.css"],function(t,e,n,i,o){"use strict";var r,s="ALL",a="Exclude Libraries",l="part-browser",c="part",d="name-part";return r=function(e){this._logger=t.create("gme:Widgets:PartBrowser:PartBrowserWidget.DecoratorBase",WebGMEGlobal.gmeConfig.client.log),this._el=e,this._initialize(),this._logger.debug("PartBrowserWidget ctor finished")},r.prototype._initialize=function(){var t=this;this._showNamesOnly=!0,this._container=$("<div/>"),this._container.css({width:"100%",height:"100%"}),this._toolbar=$("<div/>"),this._partsContainer=$("<div/>"),this._partsContainer.css({width:"100%",height:"100%"}),this._partsContainer.addClass(l),this._list=$("<ul/>"),this._list.addClass(c),this._namelist=$("<ul/>"),this._namelist.addClass(d),this._listSwitcher=new o(function(e){e.isList?(t._showNamesOnly=!0,t._list.hide(),t._namelist.show()):(t._showNamesOnly=!1,t._list.show(),t._namelist.hide())}),this._listSwitcher.addButton({title:"Decorated part list",icon:"glyphicon glyphicon-th-large",data:{isList:!1}}),this._listSwitcher.addButton({title:"Only part name list",icon:"glyphicon glyphicon-list",data:{isList:!0}}),this._selector=new i({title:"Namespace selector",showSelected:!0,limitTxtLength:8}),this._toolbar.append(this._listSwitcher.el),this._toolbar.append(this._selector.el),this._partsContainer.append(this._list),this._partsContainer.append(this._namelist),this._parts={},this._partDraggableEl={},this._container.append(this._toolbar),this._container.append(this._partsContainer),this._el.append(this._container),this._list.show(),this._namelist.hide()},r.prototype.clear=function(){for(var t in this._parts)this._parts.hasOwnProperty(t)&&this.removePart(t);this._list.empty(),this._namelist.empty()},r.prototype.$_DOMBase=$("<div/>").attr({"class":c}),r.prototype.$_DOMBaseForName=$("<div/>").attr({"class":d}),r.prototype.addPart=function(t,e){var n,i=this._getPartDiv(t),o={decorated:$("<li />",{"class":"decorated-list-item"}),onlyName:$("<li />",{"class":"name-list-item"})},r=e.decoratorClass;return i.decorated.length>0?this.updatePart(t,e):(i={decorated:null,onlyName:null},n=new r({preferencesHelper:e.preferencesHelper,aspect:e.aspect}),n.setControl(e.control),n.setMetaInfo(e.metaInfo),i.decorated=this.$_DOMBase.clone(),i.decorated.attr({id:t}),i.onlyName=this.$_DOMBaseForName.clone(),i.onlyName.attr({id:t,title:e.name}),i.onlyName.append(e.name),n.beforeAppend(),i.decorated.append(n.$el),this._partDraggableEl[t]=i,this._list.append(o.decorated.append(i.decorated)),this._namelist.append(o.onlyName.append(i.onlyName)),n.afterAppend(),this._makeDraggable({el:i.decorated,partDesc:e,partId:t}),this._makeDraggable({el:i.onlyName,partDesc:e,partId:t,realDragTarget:i.decorated}),this._parts[t]={decoratorInstance:n,decoratorClass:e.decoratorClass,filtered:!1},n)},r.prototype._makeDraggable=function(t){var e=t.el,i=this,o={dragItems:function(t){return i.getDragItems(t)},dragEffects:function(t){return i.getDragEffects(t)},dragParams:function(t){return i.getDragParams(t)}};t.realDragTarget&&(o.helper=function(){return t.realDragTarget.clone()}),n.makeDraggable(e,o)},r.prototype.getDragItems=function(){return this._logger.warn("PartBrowserWidget.getDragItems is not overridden in the controller!!!"),[]},r.prototype.getDragEffects=function(){return this._logger.warn("PartBrowserWidget.getDragEffects is not overridden in the controller!!!"),[]},r.prototype.getDragParams=function(){return void this._logger.debug("PartBrowserWidget.getDragParams is not overridden in the controller!!!")},r.prototype.DRAG_EFFECTS=n.DRAG_EFFECTS,r.prototype._getPartDiv=function(t){var e={decorated:null,onlyName:null};return e.decorated=this._list.find("div."+c+'[id="'+t+'"]'),e.onlyName=this._namelist.find("div."+d+'[id="'+t+'"]'),e},r.prototype.removePart=function(t){var e=this._getPartDiv(t);e&&e.decorated.length>0&&(n.destroyDraggable(e.decorated),n.destroyDraggable(e.onlyName),e.decorated=e.decorated.parent(),e.decorated.remove(),e.decorated.empty(),e.onlyName=e.onlyName.parent(),e.onlyName.remove(),e.onlyName.empty(),delete this._parts[t],delete this._partDraggableEl[t])},r.prototype.updatePart=function(t,e){var n=this._parts[t]?this._parts[t].decoratorInstance:void 0,i=e.decoratorClass,o=this._getPartDiv(t);if(n){if(e.decoratorClass&&n.DECORATORID!==e.decoratorClass.prototype.DECORATORID){this._logger.debug('decorator update: "'+n.DECORATORID+'" --> "'+e.decoratorClass.prototype.DECORATORID+'"...');var r=n.getControl(),s=n.getMetaInfo();return n.$el.remove(),n.destroy(),n=new i({preferencesHelper:e.preferencesHelper,aspect:e.aspect}),n.setControl(r),n.setMetaInfo(s),n.beforeAppend(),o.decorated.append(n.$el),n.afterAppend(),o.onlyName.empty(),o.onlyName.append(e.name),this._parts[t].decoratorInstance=n,this._parts[t].decoratorClass=e.decoratorClass,this._logger.debug("DesignerItem's [\""+this.id+'"] decorator  has been updated.'),n}return n.update(),o.onlyName.empty(),o.onlyName.append(e.name),n}return 0===o.decorated.length?this.addPart(t,e):void 0},r.prototype.setReadOnly=function(t){for(var e=this._list.find("."+c),i=e.length;i--;)n.enableDraggable($(e[i]),!t)},r.prototype.notifyPart=function(t,e){var n=this._parts[t]?this._parts[t].decoratorInstance:void 0;n&&n.notifyComponentEvent(e)},r.prototype.setEnabled=function(t,e){var i=this._partDraggableEl[t]?this._partDraggableEl[t]:void 0;i&&(n.enableDraggable(i.decorated,e),n.enableDraggable(i.onlyName,e),e?(i.decorated.fadeTo(1,1),i.onlyName.fadeTo(1,1)):(i.decorated.fadeTo(1,.3),i.onlyName.fadeTo(1,.3)))},r.prototype.hidePart=function(t,e){var n=this._getPartDiv(t);n&&n.decorated&&n.onlyName?(n.decorated.hide(),n.onlyName.hide()):this._logger.warn("Unknown partId ["+t+"] to hide.")},r.prototype.showPart=function(t){var e=this._getPartDiv(t);e&&e.decorated&&e.onlyName?(e.decorated.show(),e.onlyName.show()):this._logger.warn("Unknown partId ["+t+"] to show.")},r.prototype.getCurrentSelectorValue=function(){return this._selector.el.is(":hidden")?"":this._selector.dropDownText()||""},r.prototype.updateSelectorInfo=function(t){var e,n,i=this,o=i.getCurrentSelectorValue(),r=function(t){i._selector.dropDownText()!==t.value&&(i._selector.dropDownText(t.value),i.onSelectorChanged(t.value))};for(i._selector.clear(),e=0;e<t.length;e+=1)"-"===t[e]?i._selector.addDivider():(n=t[e]===s?"Show all available meta nodes.":t[e]===a?"Exclude meta nodes defined in attached libraries.":'Show meta nodes from the library/namespace "'+t[e]+'".',i._selector.addButton({title:n,text:t[e],clickFn:r,data:{value:t[e]}}));0===t.length?i._selector.hide():(i._selector.show(),-1===t.indexOf(o)&&(i._selector.dropDownText(t[0]),i.onSelectorChanged(t[0])))},r.prototype.onSelectorChanged=function(t){this._logger.error("onSelectorChanged function should be overwritten for proper usage!",t)},r}),define("js/Panels/PartBrowser/PartBrowserPanelControl",["js/logger","js/Constants","js/Utils/GMEConcepts","js/NodePropertyNames","js/RegistryKeys","js/Utils/PreferencesHelper"],function(t,e,n,i,o,r){"use strict";var s,a="ALL",l="Exclude Libraries",c="PartBrowser",d="ModelDecorator";return s=function(n,i){var o=this;this._client=n,this._partBrowserView=i,this._partBrowserView.onSelectorChanged=function(){o._updateDescriptor(o._getPartDescriptorCollection())},this._containerNodeId=WebGMEGlobal.State.getActiveObject()||null,this._componentIDPartIDMap={},this._aspect=null,this._guid="_part_browser_",this._descriptorCollection={},this._partInstances={},this._shortMetaDescriptor={},this._territoryRules={"":{children:0}},this._visualizer=null,this._libraryFilter={},this._initDragDropFeatures(),this._logger=t.create("gme:Panels:PartBrowser:PartBrowserPanelControl",WebGMEGlobal.gmeConfig.client.log),this._logger.debug("Created"),WebGMEGlobal.State.on("change:"+e.STATE_ACTIVE_OBJECT,function(t,e){o._containerNodeId=e;var n=o._client.getNode(e);n&&-1!==n.getValidAspectNames().indexOf(o._aspect)||(o._aspect=null),n&&o._client&&!o._client.isProjectReadOnly()&&o._partBrowserView&&(o._partBrowserView.setReadOnly(n.isLibraryElement()||n.isLibraryRoot()),o.setReadOnly(n.isLibraryElement()||n.isLibraryRoot())),o._updateDescriptor(o._getPartDescriptorCollection())}),WebGMEGlobal.State.on("change:"+e.STATE_ACTIVE_TAB,function(){var t=WebGMEGlobal.State.getActiveAspect();t=t===e.ASPECT_ALL?null:t,o._aspect!==t&&(o._aspect=t,o._updateDescriptor(o._getPartDescriptorCollection()))}),WebGMEGlobal.State.on("change:"+e.STATE_ACTIVE_VISUALIZER,function(t,e){o._visualizer!==e&&(o._visualizer=e,o._updateDescriptor(o._getPartDescriptorCollection()))}),this._nodeEventHandling=function(t){var e,n=!1,i=o._getShortMetaDescriptor();for(e=0;e<t.length;e+=1)if(t[e].eid===o._containerNodeId){n=!0;break}JSON.stringify(o._shortMetaDescriptor)!==JSON.stringify(i)||n?(o._shortMetaDescriptor=i,o._updateLibrarySelector(),o._updateDescriptor(o._getPartDescriptorCollection())):o._updateDecorators()},this._client.addUI(o,o._nodeEventHandling,this._guid),this._client.updateTerritory(this._guid,this._territoryRules)},s.prototype._defaultCompare=function(t,e){var n=t.name.localeCompare(e.name);return n?n:t.id.localeCompare(e.id)},s.prototype._getShortMetaDescriptor=function(){var t,e,n={},i=this._client.getAllMetaNodes(),o={};for(t=0;t<i.length;t+=1)o[i[t].getGuid()]=t;for(e=Object.keys(o).sort(),t=0;t<e.length;t+=1)n[e[t]]={path:i[o[e[t]]].getId(),name:i[o[e[t]]].getAttribute("name"),meta:this._client.getChildrenMeta(o[e[t]])};return n.libraryNames=this._client.getLibraryNames().sort(),n},s.prototype._updateDescriptor=function(t){var e,n,i,o=t||{},r=this;for(e=Object.keys(t||{}).map(function(t){return o[t]}).sort(r._defaultCompare).map(function(t){return t.id}),n=0;n<e.length;n+=1)this._descriptorCollection[e[n]]?(this._descriptorCollection[e[n]].decorator!==t[e[n]].decorator||this._descriptorCollection[e[n]].name!==t[e[n]].name)&&(this._partInstances[e[n]]=this._partBrowserView.updatePart(e[n],t[e[n]])):this._partInstances[e[n]]=this._partBrowserView.addPart(e[n],t[e[n]]),this._descriptorCollection[e[n]]&&this._descriptorCollection[e[n]].visibility===t[e[n]].visibility||("hidden"===t[e[n]].visibility?this._partBrowserView.hidePart(e[n]):"visible"===t[e[n]].visibility?(this._partBrowserView.showPart(e[n]),this._partBrowserView.setEnabled(e[n],!0)):"filtered"===t[e[n]].visibility?this._partBrowserView.hidePart(e[n]):(this._partBrowserView.showPart(e[n]),this._partBrowserView.setEnabled(e[n],!1)));for(e=Object.keys(this._descriptorCollection),n=0;n<e.length;n+=1)t[e[n]]||(this._partBrowserView.removePart(e[n]),delete this._partInstances[e[n]]);this._descriptorCollection=t,i=this._getTerritoryPatterns(),JSON.stringify(this._territoryRules)!==JSON.stringify(i)?(this._territoryRules=i,setTimeout(function(){r._client.updateTerritory(r._guid,r._territoryRules)},0)):this._updateDecorators()},s.prototype._getPartDescriptorCollection=function(){var t,n,i,o,r=this._client.getNode(this._containerNodeId),s=this._client.getAllMetaNodes(),c={},d=this._partBrowserView.getCurrentSelectorValue(),h=function(t){var e=d;return d===a?!1:(d===l&&(e=""),c[t].namespace!==e)};for(o=0;o<s.length;o+=1)t=this._getPartDescriptor(s[o].getId()),t&&(c[s[o].getId()]=this._getPartDescriptor(s[o].getId()),c[s[o].getId()].visibility="hidden");if(r)for("GraphViz"===this._visualizer?n={}:"SetEditor"===this._visualizer?n={}:"METAAspect"===this._visualizer?(r=this._client.getNode(e.PROJECT_ROOT_ID),n=r.getValidChildrenTypesDetailed(null,!0)):n=r.getValidChildrenTypesDetailed(this._aspect),i=Object.keys(n),o=0;o<i.length;o+=1)n[i[o]]?c[i[o]].visibility="visible":c[i[o]].visibility="grayed",h(i[o])&&(c[i[o]].visibility="filtered");return c},s.prototype._getTerritoryPatterns=function(){var t={"":{children:0}};return this._containerNodeId&&(t[this._containerNodeId]={children:0}),t},s.prototype._getObjectDescriptor=function(t){var e,n=this._client.getNode(t);return n?(e={},e.id=n.getId(),e.decorator=n.getRegistry(o.DECORATOR)||d,e.namespace=n.getNamespace(),e.name=n.getFullyQualifiedName()):this._logger.error("Node not loaded",t),e},s.prototype._getItemDecorator=function(t){var e;return e=this._client.decoratorManager.getDecoratorForWidget(t,c),e||(e=this._client.decoratorManager.getDecoratorForWidget(d,c)),e},s.prototype._getPartDescriptor=function(t){var n=this._getObjectDescriptor(t);return n&&(n.decoratorClass=this._getItemDecorator(n.decorator),n.control=this,n.metaInfo={},n.metaInfo[e.GME_ID]=t,n.preferencesHelper=r.getPreferences(),n.aspect=this._aspect),n},s.prototype.registerComponentIDForPartID=function(t,e){this._componentIDPartIDMap[t]=this._componentIDPartIDMap[t]||[],-1===this._componentIDPartIDMap[t].indexOf(e)&&this._componentIDPartIDMap[t].push(e)},s.prototype.unregisterComponentIDFromPartID=function(t,e){var n;this._componentIDPartIDMap&&this._componentIDPartIDMap[t]&&(n=this._componentIDPartIDMap[t].indexOf(e),-1!==n&&(this._componentIDPartIDMap[t].splice(n,1),0===this._componentIDPartIDMap[t].length&&delete this._componentIDPartIDMap[t]));
},s.prototype._initDragDropFeatures=function(){var t=this._partBrowserView.DRAG_EFFECTS;this._partBrowserView.getDragEffects=function(){return[t.DRAG_CREATE_INSTANCE]},this._partBrowserView.getDragItems=function(t){return[t.attr("id")]}},s.prototype._updateDecorators=function(){var t,e=Object.keys(this._partInstances||{});for(t=0;t<e.length;t+=1)this._descriptorCollection[e[t]]&&"hidden"!==this._descriptorCollection[e[t]].visibility&&this._partInstances[e[t]].update()},s.prototype._updateLibrarySelector=function(){var t=this,e=t._client.getLibraryNames().sort();e.length>0&&(e.unshift("-"),e.unshift(l),e.unshift(a)),t._partBrowserView.updateSelectorInfo(e)},s}),define("js/Panels/PartBrowser/PartBrowserPanel",["js/PanelBase/PanelBaseWithHeader","js/Widgets/PartBrowser/PartBrowserWidget","./PartBrowserPanelControl"],function(t,e,n){"use strict";var i,o=t;return i=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="PartBrowserPanel",i[t.OPTIONS.HEADER_TITLE]=!1,i[t.OPTIONS.NO_SCROLLING]=!0,o.apply(this,[i]),this._client=n.client,this._initialize(),this.logger.debug("PartBrowserPanel ctor finished")},_.extend(i.prototype,o.prototype),i.prototype._initialize=function(){var t=this;this.setTitle("Part Browser"),this._partBrowserWidget=new e(this.$el),this._panelControl=new n(this._client,this._partBrowserWidget),this._panelControl.setReadOnly=function(e){t.setReadOnly(e)}},i.prototype.onReadOnlyChanged=function(t){o.prototype.onReadOnlyChanged.call(this,t),this._partBrowserWidget.setReadOnly(t)},i}),define("css!js/Controls/PropertyGrid/styles/PropertyGridPart",[],function(){}),define("js/Controls/PropertyGrid/PropertyGridPart",["js/Controls/PropertyGrid/PropertyGridWidgetManager","js/Constants","css!./styles/PropertyGridPart.css"],function(t,e){"use strict";var n,i="pgp",o="closed",r="cr",s=$('<i class="glyphicon glyphicon-remove-circle reset-badge btn-reset" title="Reset value"/>'),a=$('<i class="fa fa-exclamation-triangle reset-badge" title="Inherits META-invalid property"/>'),l=$('<i class="glyphicon glyphicon-exclamation-sign reset-badge btn-reset" title="Remove META-invalid property"/>');return n=function(e){e.el&&(this._containerElement=e.el),this._el=$("<div/>",{"class":i}),this.__ul=$("<ul/>",{}),this._el.append(this.__ul),this.__folders={},this.__widgets={},this._closed=!1,this.__onChange=void 0,this.__onFinishChange=void 0,this.__onReset=void 0,this._name=e.name||void 0,this._parent=e.parent,void 0===e.parent?(this._widgetManager=new t,this._containerElement.append(this._el)):(this._addNestedGUI(e),this._widgetManager=e.parent._widgetManager)},n.prototype._addNestedGUI=function(t){var e,n=this._addRow(this,$(document.createTextNode(t.text||t.name))),i=this;e=function(t){return t.preventDefault(),t.stopPropagation(),i._toggleClosed(),!1},n.addClass("title"),n.on("click",e)},n.prototype._toggleClosed=function(){this._closed===!0?this.open():this.close()},n.prototype._addRow=function(t,e,n){var i=$("<li/>");return e&&i.append(e),n?i.insertBefore(n):this.__ul.append(i),i},n.prototype._change=function(t){this.__onChange&&this.__onChange.call(this,t)},n.prototype._finishChange=function(t){this.__onFinishChange&&this.__onFinishChange.call(this,t)},n.prototype._reset=function(t){this.__onReset&&this.__onReset.call(this,t)},n.prototype._getAccumulatedName=function(){var t=this._parent?this._parent._getAccumulatedName():void 0;return t?t+"."+this._name:this._name},n.prototype.open=function(){this._closed=!1,this.__ul.removeClass(o)},n.prototype.close=function(){this._closed=!0,this.__ul.addClass(o)},n.prototype.add=function(t){var e,n,i,o=$("<div/>"),c=$("<span/>",{"class":"property-name"}),d=$("<div/>",{"class":"p-reset"}),h=this,p={};if(void 0!==this.__widgets[t.name])throw new Error('You already have a widget with the name "'+t.name+'"');return t.id||(t.id=this._getAccumulatedName()+"."+t.name),e=this._widgetManager.getWidgetForProperty(t),this.__widgets[t.name]=e,e.el.addClass("c"),e.onChange(function(t){h._change(t)}),e.onFinishChange(function(t){h._finishChange(t)}),c.text(e.propertyText||e.propertyName),c.attr("title",e.propertyText||e.propertyName),t.options&&(t.options.textColor&&(p.color=t.options.textColor),t.options.textItalic&&(p["font-style"]="italic"),t.options.textBold&&(p["font-weight"]="bold"),c.css(p),t.options.invalidValue===!0&&e.el.addClass("has-invalid-value"),t.options.invalid===!0&&t.options.resetable===!0?i=l.clone():t.options.resetable===!0?i=s.clone():t.options.invalid===!0&&(d.append(a.clone()),c.addClass("p-reset")),i&&(d.append(i),c.addClass("p-reset"),i.on("click",function(e){h.__widgets[t.name]._isReadOnly===!1&&h._reset(t.id),e.stopPropagation(),e.preventDefault()}))),o.append(c).append(d).append(e.el),n=this._addRow(void 0,o,void 0),n.addClass(r),t.valueType?n.addClass(t.valueType):n.addClass(typeof t.value),e},n.prototype.addFolder=function(t,e){var i,o,r={name:t,text:e,parent:this},s=this;if(void 0!==this.__folders[t])throw new Error('You already have a folder with the name "'+t+'"');return i=new n(r),this.__folders[t]=i,i.onChange(function(t){s._change(t)}),i.onFinishChange(function(t){s._finishChange(t)}),i.onReset(function(t){s._reset(t)}),o=this._addRow(this,i._el),o.addClass("folder"),i},n.prototype.onChange=function(t){return this.__onChange=t,this},n.prototype.onFinishChange=function(t){return this.__onFinishChange=t,this},n.prototype.onReset=function(t){return this.__onReset=t,this},n.prototype.clear=function(){var t;this._parent&&(this.__onChange=void 0,this.__onFinishChange=void 0);for(t in this.__widgets)this.__widgets.hasOwnProperty(t)&&(this.__widgets[t].remove(),delete this.__widgets[t]);for(t in this.__folders)this.__folders.hasOwnProperty(t)&&(this.__folders[t].clear(),delete this.__folders[t]);this.__ul.empty()},n.prototype.setReadOnly=function(t){var e;for(e in this.__widgets)this.__widgets.hasOwnProperty(e)&&this.__widgets[e].setReadOnly(t);for(e in this.__folders)this.__folders.hasOwnProperty(e)&&this.__folders[e].setReadOnly(t)},n.prototype.registerWidgetForType=function(t,e){this._widgetManager.registerWidgetForType(t,e)},n}),define("js/Controls/PropertyGrid/PropertyGrid",["js/logger","js/Controls/PropertyGrid/PropertyGridPart"],function(t,e){"use strict";var n;return n=function(){var n=this;this._logger=t.create("gme:Controls:PropertyGrid:PropertyGrid",WebGMEGlobal.gmeConfig.client.log),this.$el=$("<div/>",{"class":"property-list"}),this._propertyList={},this._initDefaultWidgets(),this._isReadOnly=!1,this._ordered=!1,this.__onChange=null,this.__onFinishChange=null,this.__onReset=null,this._gui=new e({el:this.$el}),this._gui.onChange(function(t){n._logger.debug("onChange: "+JSON.stringify(t)),n.__onChange&&n.__onChange.call(n,t)}),this._gui.onFinishChange(function(t){n._logger.debug("onFinishChange: "+JSON.stringify(t)),n.__onFinishChange&&n.__onFinishChange.call(n,t)}),this._gui.onReset(function(t){n._logger.debug("onReset: "+t),n.__onReset&&n.__onReset.call(n,t)}),this._logger.debug("Created")},n.prototype._initDefaultWidgets=function(){},n.prototype.registerWidgetForType=function(t,e){this._gui.registerWidgetForType(t,e)},n.prototype._render=function(){var t,e=[];if(this._folders={},this._widgets={},this._gui.clear(),this._ordered===!0){for(t in this._propertyList)this._propertyList.hasOwnProperty(t)&&(this._propertyList[t].id=t,e.push(t));for(e.sort(),t=0;t<e.length;t+=1)this._addPropertyItem(e[t].split("."),"",this._propertyList[e[t]],this._gui)}else for(t in this._propertyList)this._propertyList.hasOwnProperty(t)&&(this._propertyList[t].id=t,this._addPropertyItem(t.split("."),"",this._propertyList[t],this._gui))},n.prototype._addPropertyItem=function(t,e,n,i){var o,r;t.length>1?(r=t[0],o=""===e?r:e+r,this._folders[o]=this._folders[o]||i.addFolder(r),t.splice(0,1),this._addPropertyItem(t,o+".",n,this._folders[o])):n.isFolder===!0?this._folders[n.name]=i.addFolder(n.name,n.text):this._widgets[n.id]=i.add(n)},n.prototype.setPropertyList=function(t){this._propertyList=t||{},this._render(),this.setReadOnly(this._isReadOnly)},n.prototype.onChange=function(t){this.__onChange=t},n.prototype.onFinishChange=function(t){this.__onFinishChange=t},n.prototype.onReset=function(t){this.__onReset=t},n.prototype.destroy=function(){this._gui.clear()},n.prototype.setOrdered=function(t){this._ordered!==t&&(this._ordered=t,this._render())},n.prototype.setReadOnly=function(t){this._isReadOnly=t,this._gui.setReadOnly(t)},n}),define("text!js/Dialogs/DecoratorSVGExplorer/templates/DecoratorSVGExplorerDialog.html",[],function(){return'<div class="decorator-svg-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-xlg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <i class="glyphicon glyphicon-picture header-icon"></i><span>SVG Icons</span>\n            </div>\n            <div class="pre-body">\n                <div class="tabContainer">\n                    <ul class="nav nav-tabs">\n                        <!--<li class="tab All"><a href="#" data-toggle="tab">All</a></li>-->\n                    </ul>\n                </div>\n            </div>\n            <div class="modal-body">\n\n            </div>\n            <div class="modal-footer">\n                <div class="input-prepend pull-left">\n                    <span class="add-on"><i class="icon-search"></i>\n                    </span><input id="txtFilter" class="input-xlarge" type="text" placeholder="Enter filter...">\n                </div>\n                <a href="#" class="btn btn-primary btn-select disabled">Select</a>\n                <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/DecoratorSVGExplorer/styles/DecoratorSVGExplorerDialog",[],function(){}),define("js/Dialogs/DecoratorSVGExplorer/DecoratorSVGExplorerDialog",["js/Constants","assets/decoratorSVG","text!./templates/DecoratorSVGExplorerDialog.html","css!./styles/DecoratorSVGExplorerDialog.css"],function(t,e,n){"use strict";var i,o=$('<div class="image-container"><img src=""/><div class="desc">description</div></div>'),r='<li class="tab"><a href="#" data-toggle="tab">__GROUP_NAME__</a></li>',s=t.ASSETS_DECORATOR_SVG_FOLDER,a=[""].concat(e.DecoratorSVGIconList.slice(0)),l="data-filename",c="data-normalized-filename",d="data-tab-group",h="tab-group-",p="__UNGROUPED__";return i=function(){},i.prototype.show=function(t,e){var n,i=this;this._fnCallback=t,this._groups={},this._groupNames=null,this._initDialog(),this._dialog.on("hidden.bs.modal",function(){i._dialog.remove(),i._dialog.empty(),i._dialog=void 0}),this._dialog.on("hide.bs.modal",function(){i._fnCallback&&(i.result||""===i.result)&&i._fnCallback(i.result)}),this._dialog.modal("show"),e&&(n=i._modalBody.find("["+l+'="'+e+'"]'),this._setSelected(e,n))},i.prototype.registerResult=function(){this.result=this._selectedSVG},i.prototype._initDialog=function(){var t,e,i,g,u,f,m=this,_=a.length;for(this._dialog=$(n),this._modalBody=this._dialog.find(".modal-body"),this._btnSelect=this._dialog.find(".btn-select"),this._txtFind=this._dialog.find("#txtFilter"),this._groupTabList=this._dialog.find("ul.nav-tabs"),t=0;_>t;t+=1)e=a[t],f=o.clone(),i=e.split("/"),g=i[i.length-1],0===t&&""===e?(f.find("img").remove(),f.find(".desc").text("-- NONE --"),f.find(".desc").attr("title","-- NONE --")):(g=g.substring(0,g.length-".svg".length),f.find("img").attr("src",s+e),f.find("img").attr("title",e),f.find(".desc").text(g),f.find(".desc").attr("title",e)),f.data(l,e),f.attr(l,e),f.attr(c,g.toLowerCase()),f.data(c,g.toLowerCase()),1===i.length?f.addClass(h+p):(f.addClass(h+i[0]),this._groups[i[0]]=!0),this._modalBody.append(f),m._setSelected();for(this._groupNames=Object.keys(this._groups),u=$(r.replace("__GROUP_NAME__","All")),u.addClass("All active"),this._groupTabList.append(u),t=0;t<this._groupNames.length;t+=1)u=$(r.replace("__GROUP_NAME__",this._groupNames[t])),u.data(d,this._groupNames[t]),this._groupTabList.append(u);this._modalBody.on("mousedown","div.image-container",function(){var t=$(this);m._modalBody.find("div.image-container.selected").removeClass("selected"),m._setSelected(t.data(l),t)}),this._modalBody.on("dblclick","div.image-container",function(){m.registerResult(),m._dialog.modal("hide")}),this._btnSelect.on("click",function(){m.registerResult(),m._dialog.modal("hide")}),this._txtFind.on("keyup",function(){m._filter($(this).val())}),this._txtFind.on("keypress",function(t){return 13!==t.keyCode}),this._groupTabList.find("li.tab").on("click",function(){var t,e=$(this);m._setSelected(),e.hasClass("All")?m._modalBody.find("div.image-container").removeClass("not-in-tab-group"):(t=h+e.data(d),m._modalBody.find("div.image-container").each(function(){var e=$(this);e.hasClass(t)?e.removeClass("not-in-tab-group"):e.addClass("not-in-tab-group")}))})},i.prototype._setSelected=function(t,e){this._modalBody.find("div.image-container.selected").removeClass("selected"),e&&e.addClass("selected"),t||""===t?(this._selectedSVG=t,this._btnSelect.disable(!1)):(this._selectedSVG=void 0,this._btnSelect.disable(!0))},i.prototype._filter=function(t){this._setSelected(),t?this._modalBody.find("div.image-container").each(function(){var e=$(this),n=e.data(c);n&&n.indexOf(t.toLowerCase())<0?e.addClass("not-in-filter"):n?e.removeClass("not-in-filter"):e.addClass("not-in-filter")}):this._modalBody.find("div.image-container").removeClass("not-in-filter")},i}),define("text!js/Dialogs/ValidVisualizers/templates/ValidVisualizersDialog.html",[],function(){return'<div class="valid-visualizers-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-md">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <i class="fa fa-list-ul header-icon"></i><span>Valid Visualizers</span>\n            </div>\n            <div class="modal-body">\n                <h5>Edit valid visualizers\n                    <i class="glyphicon glyphicon-info-sign toggle-info-btn"/>\n                </h5>\n                    <span class="info-message hidden">Drag and drop to choose valid visualizers for the selected node.\n                        If changes are persisted you need to navigate away and back to the node for changes to show.\n                        The order of the chosen visualizers (from top to bottom) is respected by the UI and the first\n                        one  will be activated when the node is navigated to.\n                     </span>\n                <span>\n                </span>\n                <div class="visualizers-selection-container">\n                    <h5>\n                        Available:\n                    </h5>\n                    <ul id="available" class="connectedSortable">\n                    </ul>\n                </div>\n                <div class="visualizers-selection-container">\n                    <h5>\n                        Chosen:\n                    </h5>\n                    <ul id="chosen" class="connectedSortable">\n                    </ul>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-primary btn-ok">OK</button>\n                <button class="btn btn-default btn-cancel">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/ValidVisualizers/styles/ValidVisualizersDialog",[],function(){}),define("js/Dialogs/ValidVisualizers/ValidVisualizersDialog",["text!./templates/ValidVisualizersDialog.html","css!./styles/ValidVisualizersDialog.css"],function(t){"use strict";function e(){this._dialog=null,this._okBtn=null,this._cancelBtn=null,this._infoBtn=null,this._infoSpan=null}return e.prototype.show=function(e,n){var i,o=this;this._dialog=$(t),this._infoBtn=this._dialog.find(".toggle-info-btn"),this._infoSpan=this._dialog.find(".info-message"),this._alertDiv=this._dialog.find(".alert"),this._okBtn=this._dialog.find(".btn-ok"),this._cancelBtn=this._dialog.find(".btn-cancel"),this._availableViz=this._dialog.find("#available"),this._chosenViz=this._dialog.find("#chosen"),this.populateLists(WebGMEGlobal.allVisualizers,n?n.split(" "):[]),this._dialog.find("#chosen, #available").sortable({connectWith:".connectedSortable"}).disableSelection(),this._infoBtn.on("click",function(){o._infoSpan.hasClass("hidden")?o._infoSpan.removeClass("hidden"):o._infoSpan.addClass("hidden")}),this._okBtn.on("click",function(t){t.preventDefault(),t.stopPropagation(),i=o.getResult(),o._dialog.modal("hide")}),this._cancelBtn.on("click",function(t){t.preventDefault(),t.stopPropagation(),o._dialog.modal("hide")}),this._dialog.on("hide.bs.modal",function(){o._okBtn.off("click"),o._cancelBtn.off("click"),o._infoBtn.off("click"),o._dialog.remove(),o._dialog.empty(),o._dialog=void 0,e("string"==typeof i?i:n)}),this._dialog.modal("show")},e.prototype.populateLists=function(t,e){var n,i,o,r={};for(o=0;o<t.length;o+=1)r[t[o].id]=t[o];for(o=0;o<e.length;o+=1)n=r[e[o]],n?(delete r[e[o]],n.DEBUG_ONLY?this._chosenViz.append($("<li/>",{"class":"alert alert-warning",text:n.id,title:"Appears as "+n.title+" (only shown in debug mode)."})):this._chosenViz.append($("<li/>",{"class":"alert alert-info",text:n.id,title:"Appears as "+n.title}))):this._chosenViz.append($("<li/>",{"class":"alert alert-danger",text:e[o],title:"No visualizer with id "+e[o]+" available!"}));for(i in r)n=r[i],n.DEBUG_ONLY&&DEBUG?this._availableViz.append($("<li/>",{"class":"alert alert-warning",text:n.id,title:"Appears as "+n.title+" (only shown in debug mode)."})):n.DEBUG_ONLY||this._availableViz.append($("<li/>",{"class":"alert alert-info",text:n.id,title:"Appears as "+n.title}))},e.prototype.getResult=function(){var t=[];return this._chosenViz.children("li").each(function(e,n){t.push($(n).text().trim())}),t.join(" ")},e}),define("js/Panels/PropertyEditor/PropertyEditorPanelController",["js/logger","js/util","js/NodePropertyNames","js/RegistryKeys","js/Constants","assets/line/lineSvgs","js/Utils/GMEConcepts","js/Utils/DisplayFormat","js/Dialogs/DecoratorSVGExplorer/DecoratorSVGExplorerDialog","js/Dialogs/ValidVisualizers/ValidVisualizersDialog","js/Controls/PropertyGrid/PropertyGridWidgets"],function(t,e,n,i,o,r,s,a,l,c,d){"use strict";var h,p="#f89406",g=[i.IS_PORT,i.IS_ABSTRACT,i.VALID_PLUGINS,i.USED_ADDONS,i.VALID_VISUALIZERS,i.VALID_DECORATORS],u="Templating",f=[i.DECORATOR,i.DISPLAY_FORMAT,i.SVG_ICON,i.TREE_ITEM_COLLAPSED_ICON,i.TREE_ITEM_EXPANDED_ICON,i.SVG_ICON,i.PORT_SVG_ICON,i.COLOR,i.TEXT_COLOR,i.BORDER_COLOR,i.LINE_STYLE,i.LINE_START_ARROW,i.LINE_END_ARROW,i.LINE_WIDTH,i.LINE_LABEL_PLACEMENT,i.REPLACEABLE],m=[o.POINTER_BASE];return h=function(e,n,i){this._client=e,this._propertyGrid=n,this._type=i||null,this._logger=t.create("gme:Panels:PropertyEditor:PropertyEditorController",WebGMEGlobal.gmeConfig.client.log),this._propertyGrid.setOrdered(!0),this._propertyGrid.registerWidgetForType("boolean","iCheckBox"),this._initEventHandlers(),this._logger.debug("Created")},h.prototype._initEventHandlers=function(){var t=this;WebGMEGlobal.State.on("change:"+o.STATE_ACTIVE_SELECTION,function(e,n){t._logger.debug("activeSelection changed",n);var i=WebGMEGlobal.State.getActiveObject();n&&n.length>0?t._selectedObjectsChanged(n):t._selectObjectsUsingActiveObject(i)}),WebGMEGlobal.State.on("change:"+o.STATE_ACTIVE_OBJECT,function(e,n){t._logger.debug("active object changed: ",n),t._selectObjectsUsingActiveObject(n)}),this._propertyGrid.onFinishChange(function(e){t._onPropertyChanged(e)}),this._propertyGrid.onReset(function(e){t._onReset(e)})},h.prototype._selectObjectsUsingActiveObject=function(t){t||t===o.PROJECT_ROOT_ID?this._selectedObjectsChanged([t]):this._selectedObjectsChanged([])},h.prototype._selectedObjectsChanged=function(t){var e,n={},i=this;if(this._idList=t,this._territoryId&&this._client.removeUI(this._territoryId),t.length>0){for(e=t.length;e--;)n[t[e]]={children:0};this._territoryId=this._client.addUI(this,function(t){i._logger.debug("about to refresh property list",t),i._refreshPropertyList()}),this._client.updateTerritory(this._territoryId,n)}else this._refreshPropertyList()},h.prototype._refreshPropertyList=function(){var t=this._getCommonPropertiesForSelection(this._idList);this._logger.debug("propList",this._idList,t),this._initializeReadOnlyForSelection(this._idList),this._propertyGrid.setPropertyList(t)},h.prototype._getCommonPropertiesForSelection=function(t){var e,n,r,s,a,l,c,h=this,p={},u=!0,m=[],_={},b={},y={},v={},C={},E=this._client.getNode(o.PROJECT_ROOT_ID),D=null,I=WebGMEGlobal.allDecorators;if(E&&E.getRegistry(i.VALID_DECORATORS)?(D=E.getRegistry(i.VALID_DECORATORS).split(" "),this._logger.debug("validDecorators registered on root-node",D),I=I.filter(function(t){return D.indexOf(t)>-1})):(this._logger.debug("Could not get validDecorators from root-node"),E||this._logger.warn("rootNode was not avaliable")),I.sort(function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:1}),0===t.length)return p;for(r=t.length;--r>=0;)e=this._client.getNode(t[r]),e&&(m.push(e),s=this._getNodeAttributeValues(e),this._buildCommonAttrMeta(C,e,u),this._filterCommon(C,_,s,u),a=this._getNodeRegistryValues(e,f),this._filterCommon(C,b,a,u),l=this._getNodeRegistryValues(e,g),this._filterCommon(C,y,l,u),c=h._getPointerInfo(e),this._filterCommon(C,v,c,u));return 1===t.length&&(p[" ID/Path"]={name:"ID",value:t[0],valueType:"string",isCommon:!0,readOnly:!0,clipboard:!0},e=h._client.getNode(t[0]),e&&(p[" GUID"]={name:"GUID",value:e.getGuid(),valueType:"string",isCommon:!0,readOnly:!0,clipboard:!0},e.isLibraryElement()&&(p[" GUIDl"]={name:"GUID (library)",value:e.getLibraryGuid(),valueType:"string",isCommon:!0,readOnly:!0,clipboard:!0}),n=e.getMetaTypeId(),n&&(p[" Meta Type"]={name:"Meta type",value:n,isCommon:!0,widget:d.META_TYPE_WIDGET,client:h._client}))),(null===h._type||h._type===o.PROPERTY_GROUP_ATTRIBUTES)&&(p[o.PROPERTY_GROUP_ATTRIBUTES]={name:o.PROPERTY_GROUP_ATTRIBUTES,text:o.PROPERTY_GROUP_ATTRIBUTES,value:void 0,isFolder:!0},this._addItemsToResultList(m,C,I,_,o.PROPERTY_GROUP_ATTRIBUTES,p,!0,!1,!1)),(null===h._type||h._type===o.PROPERTY_GROUP_PREFERENCES)&&(p[o.PROPERTY_GROUP_PREFERENCES]={name:o.PROPERTY_GROUP_PREFERENCES,text:o.PROPERTY_GROUP_PREFERENCES,value:void 0,isFolder:!0},v.hasOwnProperty(o.POINTER_CONSTRAINED_BY)&&(b[o.POINTER_CONSTRAINED_BY]=v[o.POINTER_CONSTRAINED_BY],delete v[o.POINTER_CONSTRAINED_BY]),this._addItemsToResultList(m,C,I,b,o.PROPERTY_GROUP_PREFERENCES,p,!1,!0,!1)),(null===h._type||h._type===o.PROPERTY_GROUP_META)&&(p[o.PROPERTY_GROUP_META]={name:o.PROPERTY_GROUP_META,text:o.PROPERTY_GROUP_META,value:void 0,isFolder:!0},this._addItemsToResultList(m,C,I,y,o.PROPERTY_GROUP_META,p,!1,!0,!1)),(null===h._type||h._type===o.PROPERTY_GROUP_POINTERS)&&(p[o.PROPERTY_GROUP_POINTERS]={name:o.PROPERTY_GROUP_POINTERS,text:o.PROPERTY_GROUP_POINTERS,value:void 0,isFolder:!0},this._addItemsToResultList(m,C,I,v,o.PROPERTY_GROUP_POINTERS,p,!1,!1,!0)),p},h.prototype._addItemsToResultList=function(t,e,n,s,a,h,g,f,_){var b,y,v,C,E,D,I,P,T=1===t.length&&t[0].getId()===o.PROJECT_ROOT_ID,A=Object.keys(s);for(""!==a&&(a+="."),C=0;C<A.length;C+=1)y=A[C],y!==o.POINTER_CONSTRAINED_BY&&(g&&e.hasOwnProperty(y)===!1||T&&a===o.PROPERTY_GROUP_PREFERENCES+"."&&y!==i.TREE_ITEM_COLLAPSED_ICON&&y!==i.TREE_ITEM_EXPANDED_ICON||(E=a+y,P=y.split("."),h[E]={name:P[P.length-1],value:s[y].value,valueType:s[y].valueType,options:s[y].options},("position.x"===y||"position.y"===y)&&(h[E].minValue=0,h[E].stepValue=10),(s[y].readOnly===!1||s[y].readOnly===!0)&&(h[E].readOnly=s[y].readOnly),s[y].isCommon===!1&&(h[E].value="",h[E].options={textColor:p}),g===!0?(this._isResettableAttribute(t,P[0])&&(h[E].options=h[E].options||{},h[E].options.resetable=!0),this._isInvalidAttribute(t,P[0])?(h[E].options=h[E].options||{},h[E].options.invalid=!0):this._isInvalidAttributeValue(t,P[0])&&(h[E].options=h[E].options||{},h[E].options.invalidValue=!0),e[y]["enum"]&&e[y]["enum"].length>0&&(h[E].valueItems=e[y]["enum"].slice(0),h[E].valueItems.sort()),("float"===h[E].valueType||"integer"===h[E].valueType)&&(v=this._getAttributeRange(t,P[0]),h[E].minValue=v.min,h[E].maxValue=v.max)):f===!0?(this._isResettableRegistry(t,P[0])&&(h[E].options=h[E].options||{},h[E].options.resetable=!0),a===o.PROPERTY_GROUP_PREFERENCES+"."?y===i.DECORATOR?h[E].valueItems=n:y===i.SVG_ICON||y===i.PORT_SVG_ICON||y===i.TREE_ITEM_COLLAPSED_ICON||y===i.TREE_ITEM_EXPANDED_ICON?(h[E].widget=d.DIALOG_WIDGET,h[E].dialog=l,h[E].value=void 0===h[E].value?"":h[E].value):y===i.COLOR||y===i.BORDER_COLOR||y===i.TEXT_COLOR?h[E].widget=d.COLOR_PICKER:y===i.LINE_STYLE?(h[E].widget=d.SVG_SELECT,h[E].items=r[i.LINE_STYLE],h[E].value=h[E].value||o.LINE_STYLE.PATTERNS.SOLID):y===i.LINE_START_ARROW||y===i.LINE_END_ARROW?(h[E].widget=d.SVG_SELECT,h[E].items=r[i.LINE_END_ARROW],h[E].value=h[E].value||o.LINE_STYLE.LINE_ARROWS.NONE):y===i.LINE_WIDTH?(h[E].widget=d.SVG_SELECT,h[E].items=r[i.LINE_WIDTH],h[E].value=h[E].value||1):y===i.LINE_LABEL_PLACEMENT?(h[E].widget=d.SVG_SELECT,h[E].items=r[i.LINE_LABEL_PLACEMENT],h[E].value=h[E].value||o.LINE_STYLE.LABEL_PLACEMENTS.MIDDLE):y===i.REPLACEABLE?(h[u]={name:u,text:u,value:void 0,isFolder:!0},D=u+"."+y,h[D]=h[E],delete h[E],b=this._canBeReplaceable(t),h[D].value=h[D].value&&b!==!1?!0:!1,h[D].valueType="boolean",b===!1&&(h[D].readOnly=!0,h[D].alwaysReadOnly=!0,h[D].title="Meta nodes or inherited children cannot be templates."),A.indexOf(o.POINTER_CONSTRAINED_BY)>-1&&(I=u+"."+o.POINTER_CONSTRAINED_BY,h[I]={name:o.POINTER_CONSTRAINED_BY,value:s[o.POINTER_CONSTRAINED_BY].value,valueType:s[o.POINTER_CONSTRAINED_BY].valueType,options:s[o.POINTER_CONSTRAINED_BY].options||{},widget:d.POINTER_WIDGET,client:this._client},h[I].options.resetable=this._isResettablePointer(t,o.POINTER_CONSTRAINED_BY),h[I].options.invalid=this._isInvalidPointer(t,o.POINTER_CONSTRAINED_BY),h[D].value!==!1||h[I].options.resetable||h[I].options.invalid||delete h[I])):y===o.POINTER_CONSTRAINED_BY:a===o.PROPERTY_GROUP_META+"."&&(y===i.VALID_VISUALIZERS?(h[E].widget=d.DIALOG_WIDGET,h[E].dialog=c,h[E].value=void 0===h[E].value?"":h[E].value):y===i.VALID_PLUGINS?(h[E].value=void 0===h[E].value?"":h[E].value,h[E].valueItems=WebGMEGlobal.allPlugins,h[E].widget=d.MULTI_SELECT_WIDGET):T&&(y===i.VALID_DECORATORS?(h[E].value=void 0===h[E].value?"":h[E].value,h[E].valueItems=WebGMEGlobal.allDecorators,h[E].widget=d.MULTI_SELECT_WIDGET):y===i.USED_ADDONS&&(h[E].value=void 0===h[E].value?"":h[E].value,h[E].valueItems=WebGMEGlobal.allAddOns,h[E].widget=d.MULTI_SELECT_WIDGET)))):_===!0&&(h[E].options=h[E].options||{},h[E].options.resetable=-1===m.indexOf(P[0])&&this._isResettablePointer(t,P[0]),h[E].options.invalid=this._isInvalidPointer(t,P[0]),h[E].widget=d.POINTER_WIDGET,h[E].client=this._client),h[E]||delete h[E]))},h.prototype._getNodeAttributeValues=function(t){for(var n={},i=_.union(t.getAttributeNames()||[],t.getValidAttributeNames()||[]),o=i.length;--o>=0;)n[i[o]]=t.getAttribute(i[o]);return e.flattenObject(n)},h.prototype._getNodeRegistryValues=function(t,n){for(var i={},o=n.length;--o>=0;)i[n[o]]=t.getRegistry(n[o]);return e.flattenObject(i)},h.prototype._getPointerInfo=function(t){for(var n,i={},r=t.getPointerNames(),s=r.length;s--;)n=r[s]===o.POINTER_BASE?t.getBaseId():t.getPointerId(r[s]),n=null===n?o.CORE.NULLPTR_RELID:n,i[r[s]]=n||"";return e.flattenObject(i)},h.prototype._isInvalidAttribute=function(t,e){for(var n,i,o=t.length;o--;)if(n=t[o],i=t[o].getValidAttributeNames(),-1!==i.indexOf(e))return!1;return!0},h.prototype._isInvalidAttributeValue=function(t,e){var n,i,o=!1;if(1===t.length&&(i=t[0])){if(n=i.getAttribute(e),"undefined"==typeof n)return!1;try{o=!i.isValidAttributeValueOf(e,n)}catch(r){if(!(r.message.indexOf("Invalid regular expression")>-1))throw r;this._logger.error('Invalid regular expression defined in the meta model for attribute "'+e+'"'),o=!0}}return o},h.prototype._getAttributeRange=function(t,e){for(var n,i,o=t.length,r={};o--;)n=t[o],i=n.getAttributeMeta(e)||{},i.hasOwnProperty("min")&&(r.hasOwnProperty("min")?r.min=i.min>r.min?i.min:r.min:r.min=i.min),i.hasOwnProperty("max")&&(r.hasOwnProperty("max")?r.max=i.max<r.max?i.max:r.max:r.max=i.max);return r},h.prototype._isInvalidPointer=function(t,e){for(var n,i,o=t.length;o--;)if(n=t[o],n&&(i=n.getValidPointerNames(),-1!==i.indexOf(e)||-1!==m.indexOf(e)))return!1;return!0},h.prototype._isResettableRegistry=function(t,e){for(var n,i,o,r,s=t.length;s--;)if(o=t[s]){if(r=this._client.getNode(o.getBaseId()),n=o.getOwnRegistryNames(),i=null===r?[]:r.getRegistryNames(),-1===n.indexOf(e))return!1;if(-1===i.indexOf(e))return!1}return!0},h.prototype._isResettableAttribute=function(t,e){for(var n,i,o,r,s,a=t.length;a--;)if(r=t[a]){if(s=this._client.getNode(r.getBaseId()),i=r.getValidAttributeNames(),o=null===s?[]:s.getValidAttributeNames(),n=r.getOwnAttributeNames(),-1===n.indexOf(e))return!1;if(-1===o.indexOf(e)&&-1!==i.indexOf(e))return!1}return!0},h.prototype._isResettablePointer=function(t,e){for(var n,i,o,r,s,a=t.length;a--;)if(i=t[a]){if(s=this._client.getNode(i.getBaseId()),n=i.getOwnPointerNames(),o=i.getValidPointerNames(),r=null===s?[]:s.getValidPointerNames(),-1===n.indexOf(e))return!1;if(-1===r.indexOf(e)&&-1!==o.indexOf(e))return!1}return!0},h.prototype._canBeReplaceable=function(t){for(var e=t.length;e--;)if(!s.canBeReplaceable(t[e].getId()))return!1;return!0},h.prototype._filterCommon=function(t,e,n,i){var o,r,s;if(i===!0)for(s=Object.keys(n),r=0;r<s.length;r+=1)o=s[r],t.hasOwnProperty(o)?e[o]={value:n[o],valueType:t[o].type,isCommon:!0}:e[o]={value:n[o],valueType:typeof n[o],isCommon:!0};else for(s=Object.keys(e),r=0;r<s.length;r+=1)o=s[r],n.hasOwnProperty(o)?e[o].isCommon&&(e[o].isCommon=e[o].value===n[o]):delete e[o]},h.prototype._buildCommonAttrMeta=function(t,e,n){var i,o,r,s,a,l,c,d,h=_.union(e.getAttributeNames()||[],e.getValidAttributeNames()||[]),p=h.length;for(r=Object.keys(t),s=0;s<r.length;s+=1)-1===h.indexOf(r[s])&&delete t[o];for(;p--;)o=h[p],i=e.getAttributeMeta(o)||{type:"string"},t.hasOwnProperty(o)?(a=!0,i&&t[o].type===i.type?(c=t[o]["enum"]&&t[o]["enum"].length>0,d=i["enum"]&&i["enum"].length>0,c&&d?(l=_.intersection(t[o]["enum"],i["enum"]),l.length!==t[o]["enum"].length&&(0===l.length?a=!1:t[o]["enum"]=l.slice(0))):(c||d)&&(a=!1)):a=!1,a||delete t[o]):n&&i&&(t[o]={},_.extend(t[o],i))},h.prototype._onPropertyChanged=function(t){var e,n,r,s,a,l,c,d=this._idList,h=d.length;if(void 0===t.newValue)return void this._onReset(t.id);for(this._client.startTransaction();--h>=0;)if(l=d[h],e=t.id.split("."),n=void 0,r=void 0,e[0]===o.PROPERTY_GROUP_ATTRIBUTES?(n="setAttribute",r="getEditableAttribute"):e[0]===o.PROPERTY_GROUP_PREFERENCES||e[0]===o.PROPERTY_GROUP_META?(n="setRegistry",r="getEditableRegistry"):e[0]===o.PROPERTY_GROUP_POINTERS?this._client.setPointer(l,e[1],t.newValue):e[0]===u&&(e[1]===i.REPLACEABLE?(n="setRegistry",r="getEditableRegistry"):e[1]===o.POINTER_CONSTRAINED_BY&&this._client.setPointer(l,e[1],t.newValue)),n&&r){if(e.splice(0,1),c=e[0],s=this._client.getNode(l)[r](c),a=s,e.splice(0,1),e.length<1)s=t.newValue;else{for(;e.length>1;)a=a[e[0]],e.splice(0,1);a[e[0]]=t.newValue}this._client[n](l,c,s)}this._client.completeTransaction()},h.prototype._onReset=function(t){var e,n,r,s,a=this._idList,l=a.length;for(this._client.startTransaction();--l>=0;)r=a[l],e=t.split("."),n=void 0,e[0]===o.PROPERTY_GROUP_ATTRIBUTES?n="delAttributes":e[0]===o.PROPERTY_GROUP_PREFERENCES||e[0]===o.PROPERTY_GROUP_META?n="delRegistry":e[0]===o.PROPERTY_GROUP_POINTERS?n="delPointer":e[0]===u&&(e[1]===i.REPLACEABLE?n="delRegistry":e[1]===o.POINTER_CONSTRAINED_BY&&(n="delPointer")),n&&(e.splice(0,1),s=e[0],this._client[n](r,s));this._client.completeTransaction()},h.prototype._initializeReadOnlyForSelection=function(t){
var e,n,i=!1;if(this._client.isProjectReadOnly())i=!0;else for(e=0;e<t.length;e+=1)if(n=this._client.getNode(t[e]),n&&(n.isLibraryRoot()||n.isLibraryElement())){i=!0;break}this._propertyGrid.setReadOnly(i),this.setReadOnly(i)},h}),define("js/Panels/PropertyEditor/PropertyEditorPanel",["js/PanelBase/PanelBaseWithHeader","js/Controls/PropertyGrid/PropertyGrid","js/Constants","./PropertyEditorPanelController"],function(t,e,n,i){"use strict";var o,r=t,s="property-editor";return o=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="PropertyEditorPanel",i[t.OPTIONS.HEADER_TITLE]=!0,r.apply(this,[i]),this._client=n.client,this._initialize(),this.logger.debug("PropertyEditorPanel ctor finished")},_.extend(o.prototype,r.prototype),o.prototype._initialize=function(){var t,o,r=this;this.$el.addClass(s),this.$el.html('<ul class="nav nav-tabs"><li class="active"><a href="#attributes" data-toggle="tab">Attributes</a></li><li class=""><a href="#pointers" data-toggle="tab">Pointers</a></li><li class=""><a href="#meta" data-toggle="tab">Meta</a></li><li class=""><a href="#preferences" data-toggle="tab">Preferences</a></li></ul><div class="tab-content"><div class="tab-pane active" id="attributes">attributes</div><div class="tab-pane" id="pointers">pointers</div><div class="tab-pane" id="meta">meta</div><div class="tab-pane" id="preferences">preferences</div></div>'),this.setTitle("Property Editor"),this.propertyGrids=[],o=new e,this.propertyGrids.push(o),this.$el.find("div#attributes").html(o.$el),t=new i(this._client,o,n.PROPERTY_GROUP_ATTRIBUTES),t.setReadOnly=function(t){r.setReadOnly(t)},o=new e,this.propertyGrids.push(o),this.$el.find("div#pointers").html(o.$el),t=new i(this._client,o,n.PROPERTY_GROUP_POINTERS),t.setReadOnly=function(t){r.setReadOnly(t)},o=new e,this.propertyGrids.push(o),this.$el.find("div#meta").html(o.$el),t=new i(this._client,o,n.PROPERTY_GROUP_META),t.setReadOnly=function(t){r.setReadOnly(t)},o=new e,this.propertyGrids.push(o),this.$el.find("div#preferences").html(o.$el),t=new i(this._client,o,n.PROPERTY_GROUP_PREFERENCES),t.setReadOnly=function(t){r.setReadOnly(t)}},o.prototype.onReadOnlyChanged=function(t){var e;for(r.prototype.onReadOnlyChanged.call(this,t),e=0;e<this.propertyGrids.length;e+=1)this.propertyGrids[e].setReadOnly(t)},o}),define("js/PanelManager/IActivePanel",[],function(){"use strict";var t,e="active-panel";return t=function(){},t.prototype.setActive=function(t){t===!0?(this.$pEl.addClass(e),this.onActivate()):(this.$pEl.removeClass(e),this.onDeactivate())},t.prototype.onActivate=function(){this.logger.warn("IActivePanel.prototype.onActivate IS NOT IMPLEMENTED!!!")},t.prototype.onDeactivate=function(){this.logger.warn("IActivePanel.prototype.onDeactivate IS NOT IMPLEMENTED!!!")},t.prototype.getNodeID=function(){return void this.logger.warn("IActivePanel.prototype.getNodeID IS NOT IMPLEMENTED!!!")},t}),define("js/DragDrop/DragHelper",["./DragConstants","./DragEffects"],function(t,e){"use strict";function n(t,e,n){var i=n;return t&&e&&t.hasOwnProperty(e)&&(i=t[e]),i}function i(e){return n(e,t.DRAG_ITEMS,[])}function o(e){return n(e,t.DRAG_EFFECTS,[])}function r(e){return n(e,t.DRAG_PARAMS,void 0)}return{getDragItems:i,getDragEffects:o,getDragParams:r,DRAG_EFFECTS:e}}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants",["js/Constants"],function(t){"use strict";return{SELF:"__SELF__",DESIGNER_ITEM_CLASS:"designer-item",DESIGNER_CONNECTION_CLASS:"designer-connection",CONNECTION_DRAGGABLE_END_CLASS:"c-d-end",CONNECTOR_CLASS:"connector",CONNECTION_END_SRC:"src",CONNECTION_END_DST:"dst",CONNECTION_CONTAINER_SVG_CLASS:"connection-container",PATH_EDIT_SEGMENT_CLASS:"path-edit-segment",PATH_EDIT_SEGMENT_NEW_SEGMENT_POINT_MARKER_CLASS:"new-segment-point-marker",CONNECTION_SEGMENT_POINT_CLASS:"segment-point",SEGMENT_POINT_MOVE_PATH_CLASS:"segment-point-move-path",CONNECTION_SEGMENT_POINT_BEZIER_CONTROL_CLASS:"segment-point-bezier-control",HIGHLIGHT_MODE_CLASS:"highlight-mode",ITEM_HIGHLIGHT_CLASS:"highlighted",DROP_REGION_CLASS:"drop-region",DROP_REGION_ACCEPT_DROPPABLE_CLASS:"accept-droppable",DROP_REGION_REJECT_DROPPABLE_CLASS:"reject-droppable",DATA_ITEM_ID:"data-oid",DATA_SUBCOMPONENT_ID:"data-sid",LINE_WIDTH:t.LINE_STYLE.WIDTH,LINE_COLOR:t.LINE_STYLE.COLOR,LINE_PATTERN:t.LINE_STYLE.PATTERN,LINE_PATTERNS:t.LINE_STYLE.PATTERNS,LINE_TYPE:t.LINE_STYLE.TYPE,LINE_TYPES:t.LINE_STYLE.TYPES,LINE_START_ARROW:t.LINE_STYLE.START_ARROW,LINE_END_ARROW:t.LINE_STYLE.END_ARROW,LINE_POINTS:t.LINE_STYLE.CUSTOM_POINTS,LINE_ARROWS:t.LINE_STYLE.LINE_ARROWS,LINE_LABEL_PLACEMENT:t.LINE_STYLE.LABEL_PLACEMENT,LINE_LABEL_PLACEMENTS:t.LINE_STYLE.LABEL_PLACEMENTS,PATH_SHADOW_ID_PREFIX:"p_",PATH_SHADOW_ARROW_END_ID_PREFIX:"p_e_",ROTATION_RESET:"reset",ROTATION_TOLEFT:"toleft",ROTATION_TORIGHT:"toright",ROTATION_CLEAR:"clear",ALIGN_HORIZON:"ALIGN_HORIZON",ALIGN_VERTICAL:"ALIGN_VERTICAL",MOVE_TO_TOP:"MOVE_TO_TOP",MOVE_TO_BOTTOM:"MOVE_TO_BOTTOM",MOVE_TO_LEFT:"MOVE_TO_LEFT",MOVE_TO_RIGHT:"MOVE_TO_RIGHT",KEY_SHORT_CUT_MOVE_TO_TOP:"shift+up",KEY_SHORT_CUT_MOVE_TO_BOTTOM:"shift+down",KEY_SHORT_CUT_MOVE_TO_LEFT:"shift+left",KEY_SHORT_CUT_MOVE_TO_RIGHT:"shift+right"}}),define("js/Widgets/DiagramDesigner/SelectionManager",["js/logger","js/util","./DiagramDesignerWidget.Constants"],function(t,e,n){"use strict";var i,o=.5,r=15,s=100,a="SelectionManager";i=function(e){var n=e&&e.loggerName||"gme:Widgets:DiagramDesigner:SelectionManager";if(this.logger=e&&e.logger||t.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=e?e.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a SelectionManager without a diagramDesigner..."),"SelectionManager can not be created";this._selectedElements=[],this._rotationEnabled=!0,this._alignEnabled=!0,this._openEnabled=!0,this.logger.debug("SelectionManager ctor finished")},i.prototype.activate=function(){this._activateMouseListeners()},i.prototype.deactivate=function(){this._deactivateMouseListeners(),this._setSelection([])},i.prototype._activateMouseListeners=function(){var t=this;this._diagramDesigner.onItemMouseDown=function(e,n,i){(t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.READ_ONLY||t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.DESIGN)&&t._setSelection([e],t._isMultiSelectionModifierKeyPressed(n),i)},this._diagramDesigner.onConnectionMouseDown=function(e,n){(t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.READ_ONLY||t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.DESIGN)&&t._setSelection([e],t._isMultiSelectionModifierKeyPressed(n))},this._diagramDesigner.onBackgroundMouseDown=function(e){(t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.READ_ONLY||t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.DESIGN)&&t._onBackgroundMouseDown(e)}},i.prototype._deactivateMouseListeners=function(){this._diagramDesigner.onItemMouseDown=void 0,this._diagramDesigner.onConnectionMouseDown=void 0,this._diagramDesigner.onBackgroundMouseDown=void 0},i.prototype.initialize=function(t){var e=this;this.$el=t,this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(t,n){e._onComponentDelete(n)})},i.prototype.getSelectedElements=function(){return this._selectedElements.slice(0)},i.prototype.clear=function(){this._setSelection([])},i.prototype.setSelection=function(t,e){this._setSelection(t,e)},i.prototype.onSelectionCommandClicked=function(t,e){this.logger.warn('SelectionManager.prototype.onSelectionCommandClicked IS NOT OVERRIDDEN IN HOST COMPONENT.  command: "'+t+'", selectedIds: '+e)},i.prototype.onSelectionChanged=function(t){this.logger.warn("SelectionManager.prototype.onSelectionChanged IS NOT OVERRIDDEN IN HOST COMPONENT. selectedIDs: "+t)},i.prototype._isMultiSelectionModifierKeyPressed=function(t){return t.ctrlKey||t.metaKey},i.prototype._onBackgroundMouseDown=function(t){var e={mX:t.mouseX,mY:t.mouseY},n=this,i=t.rightClick!==!0;this.logger.debug("SelectionManager._onBackgroundMouseDown at: "+JSON.stringify(e)),i===!0&&(this._rubberbandSelection={x:e.mX,y:e.mY,x2:e.mX,y2:e.mY,addToExistingSelection:this._isMultiSelectionModifierKeyPressed(t)},this._rubberbandSelection.addToExistingSelection!==!0&&this._setSelection([]),this.$rubberBand=this._createRubberBand(),this.$el.append(this.$rubberBand),this._diagramDesigner.trackMouseMoveMouseUp(function(t){n._onBackgroundMouseMove(t)},function(t){n._onBackgroundMouseUp(t)}))};var l=$("<div/>",{"class":"rubberband"});i.prototype._createRubberBand=function(){var t=l.clone();return t.css({display:"none",position:"absolute"}),t},i.prototype._onBackgroundMouseMove=function(t){var e={mX:t.mouseX,mY:t.mouseY};this._rubberbandSelection&&(this._rubberbandSelection.x2=e.mX,this._rubberbandSelection.y2=e.mY,this._drawSelectionRubberBand())},i.prototype._onBackgroundMouseUp=function(t){var e,n={mX:t.mouseX,mY:t.mouseY};this._rubberbandSelection&&(this._rubberbandSelection.x2=n.mX,this._rubberbandSelection.y2=n.mY,this._drawSelectionRubberBand(),e={addToExistingSelection:this._rubberbandSelection.addToExistingSelection,x:Math.min(this._rubberbandSelection.x,this._rubberbandSelection.x2),x2:Math.max(this._rubberbandSelection.x,this._rubberbandSelection.x2),y:Math.min(this._rubberbandSelection.y,this._rubberbandSelection.y2),y2:Math.max(this._rubberbandSelection.y,this._rubberbandSelection.y2)},this._selectItemsByRubberBand(e),this.$rubberBand.remove(),this.$rubberBand=null,delete this._rubberbandSelection)},i.prototype._drawSelectionRubberBand=function(){var t=2,e=Math.min(this._rubberbandSelection.x,this._rubberbandSelection.x2),n=Math.max(this._rubberbandSelection.x,this._rubberbandSelection.x2),i=Math.min(this._rubberbandSelection.y,this._rubberbandSelection.y2),o=Math.max(this._rubberbandSelection.y,this._rubberbandSelection.y2);t>n-e||t>o-i?this.$rubberBand.hide():this.$rubberBand.show(),this.$rubberBand.css({left:e,top:i,width:n-e,height:o-i})},i.prototype._selectItemsByRubberBand=function(t){var n,i,r={x:t.x,y:t.y,x2:t.x2,y2:t.y2},s=[],a=this._diagramDesigner.items,l=10;if(!(r.x2-r.x<l||r.y2-r.y<l)){this.logger.debug("Select children by rubber band: ["+r.x+","+r.y+"], ["+r.x2+","+r.y2+"]"),i=function(t){var n,i;return t&&e.overlap(r,t)&&(n={x:Math.max(t.x,r.x),y:Math.max(t.y,r.y),x2:Math.min(t.x2,r.x2),y2:Math.min(t.y2,r.y2)},i=(n.x2-n.x)*(n.y2-n.y)/((t.x2-t.x)*(t.y2-t.y)),i>o)?!0:!1};for(n in a)a.hasOwnProperty(n)&&i(a[n].getBoundingBox())&&s.push(n);this._setSelection(s,t.addToExistingSelection)}},i.prototype._clearSelection=function(){for(var t,e,n=this._selectedElements.length,i=this._diagramDesigner.items;n--;)t=this._selectedElements[n],e=i[t],e&&$.isFunction(e.onDeselect)&&e.onDeselect();this._selectedElements=[],this.hideSelectionOutline()},i.prototype._setSelection=function(t,e,n){var i,o,r,s,a=this,l=this._diagramDesigner.items,c=!1,d=t.length,h=function(e){t.indexOf(e.id)>-1&&0===--d&&a.showSelectionOutline()};if(this.logger.debug("setSelection: "+t+", addToExistingSelection: "+e),!n)if(e===!0){for(i=this._selectedElements.length;i--;)r=l[this._selectedElements[i]],$.isFunction(r.onDeselect)&&r.onDeselect(),$.isFunction(r.onSelect)?r.onSelect(!0,h):h(r);for(i=t.length,o=t.length+this._selectedElements.length,d=t.length;i--;)if(s=t[i],-1===this._selectedElements.indexOf(s))this._selectedElements.push(s),r=l[s],$.isFunction(r.onSelect)?r.onSelect(o>1,h):h(r),c=!0;else{var p=this._selectedElements.indexOf(s);this._selectedElements.splice(p,1),r=l[s],$.isFunction(r.onDeselect)?r.onDeselect(h):h(r),c=!0}1===this._selectedElements.length&&(r=l[this._selectedElements[0]],$.isFunction(r.onSelect)?r.onSelect(!1,h):h(r))}else if(t.length>0)for(this._clearSelection(),c=!0,i=t.length;i--;)s=t[i],r=l[s],this._selectedElements.push(s),$.isFunction(r.onSelect)?r.onSelect(t.length>1,h):h(r);else 0!==this._selectedElements.length&&(this._clearSelection(),c=!0);this.logger.debug("selected elements: "+this._selectedElements),c&&this.onSelectionChanged(this._selectedElements)},i.prototype._onComponentDelete=function(t){var e,n=!1;e=this._selectedElements.indexOf(t),-1!==e&&(this._selectedElements.splice(e,1),n=!0),n&&this.onSelectionChanged(this._selectedElements)};var c=$("<div/>",{"class":"selection-outline"});i.prototype.showSelectionOutline=function(){var t=this._getSelectionBoundingBox(),e=this._diagramDesigner._actualSize.w,n=this._diagramDesigner._actualSize.h;t&&t.hasOwnProperty("x")?(t.x-=r,t.y-=r,t.x2+=r,t.y2+=r,t.x<0&&(t.x=0),t.y<0&&(t.y=0),t.x2>e&&(t.x2=e),t.y2>n&&(t.y2=n),t.w=t.x2-t.x,t.h=t.y2-t.y,t.w<s&&(t.x-=(s-t.w)/2,t.x2+=(s-t.w)/2,t.w=t.x2-t.x),this._diagramDesigner.skinParts.$selectionOutline?this._diagramDesigner.skinParts.$selectionOutline.empty():(this._diagramDesigner.skinParts.$selectionOutline=c.clone(),this._diagramDesigner.skinParts.$itemsContainer.prepend(this._diagramDesigner.skinParts.$selectionOutline)),this._diagramDesigner.skinParts.$selectionOutline.css({left:t.x,top:t.y,width:t.w,height:t.h}),this._renderSelectionActions()):this.hideSelectionOutline()},i.prototype.hideSelectionOutline=function(){this._diagramDesigner.skinParts.$selectionOutline&&(this._diagramDesigner.skinParts.$selectionOutline.empty(),this._diagramDesigner.skinParts.$selectionOutline.remove(),this._diagramDesigner.skinParts.$selectionOutline=null)},i.prototype._getSelectionBoundingBox=function(){for(var t,e,n,i=this._selectedElements.length,o=this._diagramDesigner.items;i--;)e=this._selectedElements[i],o[e]&&(t||(t={x:this._diagramDesigner._actualSize.w,y:this._diagramDesigner._actualSize.h,x2:0,y2:0}),n=o[e].getBoundingBox(),n.x<t.x&&(t.x=n.x),n.y<t.y&&(t.y=n.y),n.x2>t.x2&&(t.x2=n.x2),n.y2>t.y2&&(t.y2=n.y2));return t};var d=$("<div/>",{"class":"s-btn delete",command:"delete"});d.html('<i class="glyphicon glyphicon-remove" title="Delete"></i>');var h=$("<div/>",{"class":"s-btn contextmenu",command:"contextmenu"});h.html('<i class="glyphicon glyphicon-list" title="Action Menu"></i>');var p=$("<div/>",{"class":"s-btn move",command:"move"});p.html('<i class="glyphicon glyphicon-move"></i>');var g=$("<div/>",{"class":"s-btn open",command:"open"});g.html('<i class="glyphicon glyphicon-circle-arrow-down" title="Open"></i>');var u=$("<div/>",{"class":"s-btn align",command:"align"});u.html('<i class="glyphicon glyphicon-th" title="Align Menu"></i>'),i.prototype._renderSelectionActions=function(){var t,e,n,i,o=this;this._diagramDesigner.getIsReadOnlyMode()!==!0&&(t=d.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(t),this._alignEnabled===!0&&(i=u.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(i))),this._openBtnEnabled===!0&&1===this._selectedElements.length&&(e=g.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(e)),n=h.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(n),this._diagramDesigner.skinParts.$selectionOutline.off("mousedown").off("click",".s-btn"),this._diagramDesigner.skinParts.$selectionOutline.on("mousedown",function(t){t.stopPropagation()}).on("click",".s-btn",function(t){var e=$(this).attr("command");o.logger.debug('Selection button clicked with command: "'+e+'"'),o.onSelectionCommandClicked(e,o._selectedElements,t),t.stopPropagation(),t.preventDefault()}),this._renderRotateHandlers()};var f=$("<div/>",{"class":"s-btn rotate bottom"});f.html('<i class="glyphicon glyphicon-repeat"><div class="popover right nowrap rotate-options"><div class="arrow"></div><div class="popover-content narrow"><div class="btn-group"><a class="btn btn-small" id="rotate-left" title="Rotate left by 90°"><i class="glyphicon glyphicon-repeat flip-vertical" id="icon-rotate-left"></i></a><a class="btn  btn-small" id="rotate-right" title="Rotate right by 90°"><i class="glyphicon glyphicon-repeat" id="icon-rotate-right"></i></a><a class="btn btn-small" id="rotate-toleft" title="Rotate left to the closest multiple of 90°"><i class="glyphicon glyphicon-retweet flip-vertical" id="icon-rotate-toleft"></i></a><a class="btn  btn-small" id="rotate-toright" title="Rotate right to the closest multiple of 90°"><i class="glyphicon glyphicon-retweet" id="icon-rotate-toright"></i></a><a class="btn  btn-small" id="rotate-reset" title="Set rotation to 0°"><i class="glyphicon glyphicon-minus" id="icon-rotate-reset"></i></a><a class="btn  btn-small" id="rotate-clear" title="Clear rotation information - reset to inherited"><i class="glyphicon glyphicon-remove" id="icon-rotate-clear"></i></a></div></div></div></i>');var m=$("<div/>",{"class":"rotation-deg"});return i.prototype._renderRotateHandlers=function(){var t,e=this,i=!this._diagramDesigner.getIsReadOnlyMode()&&this._rotationEnabled;i&&(t=f.clone(),this._rotationDegree=m.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(t),this._diagramDesigner.skinParts.$selectionOutline.append(this._rotationDegree),this._diagramDesigner.skinParts.$selectionOutline.off("mousedown."+a,".rotate"),this._diagramDesigner.skinParts.$selectionOutline.on("mousedown."+a,".rotate",function(t){var n=$(this);void 0===$(t.target).attr("id")&&(e.logger.debug("selection rotate button mousedown"),e._startSelectionRotate(n,t),t.stopPropagation(),t.preventDefault())}),t.hover(function(){t.find(".popover").show()},function(){t.find(".popover").hide()}),t.on("click",".btn",function(t){var i=$(this).attr("id"),o=0;switch(i.replace("rotate-","")){case"left":o=-90;break;case"right":o=90;break;case n.ROTATION_RESET:o=n.ROTATION_RESET;break;case n.ROTATION_TOLEFT:o=n.ROTATION_TOLEFT;break;case n.ROTATION_TORIGHT:o=n.ROTATION_TORIGHT;break;case n.ROTATION_CLEAR:o=n.ROTATION_CLEAR}e._rotateSelectionBy(o),t.stopPropagation(),t.preventDefault()}))},i.prototype._startSelectionRotate=function(t,e){var n=this._diagramDesigner.getAdjustedMousePos(e),i=this,o=1===e.which;o&&(this._rotateDesc={startX:n.mX,startY:n.mY,oX:parseInt(this._diagramDesigner.skinParts.$selectionOutline.css("left"),10)+parseInt(this._diagramDesigner.skinParts.$selectionOutline.css("width"),10)/2,oY:parseInt(this._diagramDesigner.skinParts.$selectionOutline.css("top"),10)+parseInt(this._diagramDesigner.skinParts.$selectionOutline.css("height"),10)/2,horizontal:t.hasClass("top")},this._rotateAngle=0,$(document).on("mousemove.rotate."+a,function(t){i._onSelectionRotate(t)}),$(document).on("mouseup.rotate."+a,function(t){$(document).off("mousemove.rotate."+a),$(document).off("mouseup.rotate."+a),i._endSelectionRotate(t)}))},i.prototype._onSelectionRotate=function(t){var e=this._diagramDesigner.getAdjustedMousePos(t),n=e.mX-this._rotateDesc.startX,i=e.mY-this._rotateDesc.startY,o=t.shiftKey?10:t.ctrlKey||t.metaKey?45:0,r=this._getRotationDegree(this._rotateDesc.horizontal?n:i,o);this._rotateAngle=r,this._rotationDegree.html((r>=0?"+":"")+r+"&deg;"),this._diagramDesigner.skinParts.$selectionOutline.css({"transform-origin":"50% 50%",transform:"rotate("+r+"deg)"})},i.prototype._endSelectionRotate=function(){this._rotationDegree.html(""),this._diagramDesigner.skinParts.$selectionOutline.css({"transform-origin":"50% 50%",transform:"rotate(0deg)"}),this._rotateSelectionBy(this._rotateAngle)},i.prototype._rotateSelectionBy=function(t){for(var e=[],n=this._selectedElements.length;n--;)-1!==this._diagramDesigner.itemIds.indexOf(this._selectedElements[n])&&e.push(this._selectedElements[n]);e.length>0&&this.onSelectionRotated(t,e)},i.prototype._getRotationDegree=function(t,e){var n=e?Math.round(t/e)*e:t;return Math.floor(n%360)},i.prototype.onSelectionRotated=function(t,e){this.logger.warn('SelectionManager.prototype.onSelectionRotated IS NOT OVERRIDDEN IN HOST COMPONENT. deg: "'+t+'"deg, selectedIds: '+e)},i.prototype.enableRotation=function(t){this._rotationEnabled!==t&&(this._rotationEnabled=t)},i.prototype.enableAlign=function(t){this._alignEnabled!==t&&(this._alignEnabled=t)},i.prototype.enableOpenButton=function(t){this._openBtnEnabled!==t&&(this._openBtnEnabled=t)},i}),define("js/Widgets/DiagramDesigner/DragScroll",["jquery","js/logger"],function(t,e){"use strict";var n;return n=function(t){this._logger=e.create("gme:Widgets:DiagramDesigner:DragScroll",WebGMEGlobal.gmeConfig.client.log),this._containerNode=t},n._SCROLL_STEP=25,n._INTERVAL=50,n.prototype.start=function(){var t=this;this._getContainerBoundaries(),this._onMouseMoveCallBack=function(e){t._onMouseMove(e)},this._onMouseUpCallBack=function(){t._onMouseUp()},$(document).on("mousemove.DragScroll",this._onMouseMoveCallBack),$(document).on("mouseup.DragScroll",this._onMouseUpCallBack)},n.prototype._onMouseUp=function(){$(document).off("mousemove.DragScroll",this._onMouseMoveCallBack),$(document).off("mouseup.DragScroll",this._onMouseUpCallBack),delete this._onMouseMoveCallBack,delete this._onMouseUpCallBack,this._stopScroll()},n.prototype._onMouseMove=function(t){this._isInContainerBounds(t.pageX,t.pageY)?(this._logger.debug("onMouseMove - INSIDE ContainerBounds"),this._stopScroll()):(this._logger.debug("onMouseMove - outside ContainerBounds"),this._scrollDelta=this._calculateScrollDelta(t.pageX,t.pageY),this._startScroll())},n.prototype._startScroll=function(){var t=this;void 0===this._timer&&(this._timer=window.setTimeout(function(){t._doScroll()},n._INTERVAL))},n.prototype._stopScroll=function(){this._timer&&(window.clearTimeout(this._timer),this._timer=void 0)},n.prototype._getContainerBoundaries=function(){var t=this._containerNode.offset();this._containerBoundaries={left:t.left,top:t.top,width:this._containerNode.width(),height:this._containerNode.height()},this._logger.debug("_containerBoundaries: "+JSON.stringify(this._containerBoundaries))},n.prototype._isInContainerBounds=function(t,e){return this._containerBoundaries.left<=t&&this._containerBoundaries.left+this._containerBoundaries.width>=t&&this._containerBoundaries.top<=e&&this._containerBoundaries.top+this._containerBoundaries.height>=e},n.prototype._calculateScrollDelta=function(t,e){var i=0,o=0;return t<this._containerBoundaries.left?i=-n._SCROLL_STEP:t>this._containerBoundaries.left+this._containerBoundaries.width&&(i=n._SCROLL_STEP),e<this._containerBoundaries.top?o=-n._SCROLL_STEP:e>this._containerBoundaries.top+this._containerBoundaries.height&&(o=n._SCROLL_STEP),{x:i,y:o}},n.prototype._doScroll=function(){var t,e;this._logger.debug("doScroll - "+JSON.stringify(this._scrollDelta)),this._timer=void 0,this._scrollDelta&&(0!==this._scrollDelta.x||0!==this._scrollDelta.y?(t=this._containerNode[0].scrollTop,e=this._containerNode[0].scrollLeft,this._containerNode[0].scrollTop+=this._scrollDelta.y,this._containerNode[0].scrollLeft+=this._scrollDelta.x,(0===this._containerNode[0].scrollTop||this._containerNode[0].scrollTop<t+this._scrollDelta.y)&&(this._scrollDelta.y=0),(0===this._containerNode[0].scrollLeft||this._containerNode[0].scrollLeft<e+this._scrollDelta.x)&&(this._scrollDelta.x=0),this._startScroll()):(this._scrollDelta=void 0,this._stopScroll()))},n}),define("js/Widgets/DiagramDesigner/DragManager.Native",["js/logger","js/Widgets/DiagramDesigner/DragScroll","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(t,e,n){"use strict";var i,o="move",r="copy",s=10,a="DragManager",l="mousedown."+a,c="mousemove."+a,d="mouseup."+a;return i=function(e){var n=e&&e.loggerName||"gme:Widgets:DiagramDesigner:DragManager";if(this.logger=e&&e.logger||t.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=e?e.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a DragManager without a canvas..."),"DragManager can not be created";this.logger.debug("DragManager ctor finished")},i.prototype.DRAGMODE_COPY="copy",i.prototype.DRAGMODE_MOVE="move",i.prototype.initialize=function(t){var n=this;this._dragModes={},this.$el=t,this._dragModes[this.DRAGMODE_COPY]=!0,this._dragModes[this.DRAGMODE_MOVE]=!0,this._diagramDesigner.addEventListener(this._diagramDesigner.events.ITEM_POSITION_CHANGED,function(t,e){n._canvasItemPositionChanged(e)}),this._dragScroll=new e(this.$el.parent()),this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(t,e){n._onComponentDelete(e)})},i.prototype.activate=function(){this._activateMouseListeners()},i.prototype.deactivate=function(){this._deactivateMouseListeners()},i.prototype._activateMouseListeners=function(){var t=this;this.$el.on(l,"div."+n.DESIGNER_ITEM_CLASS,function(e){t._onItemMouseDown(e)})},i.prototype._deactivateMouseListeners=function(){this.$el.off(l,"div."+n.DESIGNER_ITEM_CLASS)},i.prototype.enableMode=function(t,e){this._dragModes[t]&&(this._dragModes[t]=e)},i.prototype._onItemMouseDown=function(t){var e=this._diagramDesigner.getAdjustedMousePos(t),n=this,i=1===t.which,o=!this._diagramDesigner.getIsReadOnlyMode();o&&i&&(this.logger.debug("DragManager._onItemMouseDown at: "+JSON.stringify(e)),this._diagramDesigner.mode===this._diagramDesigner.OPERATING_MODES.DESIGN&&(this._initDrag(e.mX,e.mY),this._onBackgroundMouseMoveCallBack=function(t){n._onBackgroundMouseMove(t)},this._onBackgroundMouseUpCallBack=function(t){n._onBackgroundMouseUp(t)},$(document).on(c,this._onBackgroundMouseMoveCallBack),$(document).on(d,this._onBackgroundMouseUpCallBack)),t.stopPropagation(),t.preventDefault())},i.prototype._initDrag=function(t,e){var n=!this._diagramDesigner.getIsReadOnlyMode();n&&this._diagramDesigner.mode===this._diagramDesigner.OPERATING_MODES.DESIGN&&(this._dragDesc={startX:t,startY:e,dX:0,dY:0,params:void 0,mode:void 0,dragging:!1})},i.prototype._onBackgroundMouseMove=function(t){var e=this._diagramDesigner.getAdjustedMousePos(t),n=e.mX-this._dragDesc.startX,i=e.mY-this._dragDesc.startY;e.mX<=0&&e.mX<=0||(this._dragDesc.dragging===!0?(this.logger.debug("already dragging, handle dragged item reposition"),this._doDrag(t)):(Math.abs(n)>=s||Math.abs(i)>=s)&&(this.logger.debug("Mouse delta reached the minimum to handle as a drag"),this._startDrag(t),this._dragScroll.start()))},i.prototype._onBackgroundMouseUp=function(t){$(document).off(c,this._onBackgroundMouseMoveCallBack),$(document).off(d,this._onBackgroundMouseUpCallBack),delete this._onBackgroundMouseMoveCallBack,delete this._onBackgroundMouseUpCallBack,this.logger.debug("DragManager._onBackgroundMouseUp"),this._dragDesc.dragging===!0&&this._endDrag(t),this._dragDesc=void 0},i.prototype._startDrag=function(t){var e=t&&(t.ctrlKey||t.metaKey),n=t&&t.shiftKey,i=this.DRAGMODE_MOVE;this.logger.debug("_startDrag called"),e&&!n&&this._dragModes[this.DRAGMODE_COPY]===!0&&(i=this.DRAGMODE_COPY),this._dragDesc.mode=i,this._dragDesc.params={draggedItemIDs:[],draggedConnectionIDs:[],minStartCoordinates:{x:void 0,y:void 0},originalPositions:[],modeSpecificData:void 0},this._dragDesc.mode===this.DRAGMODE_MOVE?this._startDragModeMove():this._dragDesc.mode===this.DRAGMODE_COPY&&this._startDragModeCopy(),this._calculateMinStartCoordinates(),this._diagramDesigner.onDesignerItemDragStart(void 0,this._dragDesc.params.draggedItemIDs),this._dragDesc.dragging=!0},i.prototype._startDragModeMove=function(){for(var t,e,n=this._diagramDesigner.selectionManager.getSelectedElements(),i=this._diagramDesigner.items,r=this._diagramDesigner.itemIds,s=n.length;s--;)t=n[s],e=i[t],-1!==r.indexOf(t)&&this._diagramDesigner.onDragStartDesignerItemDraggable(t)===!0&&(this._dragDesc.params.draggedItemIDs.push(t),this._dragDesc.params.originalPositions.push({x:e.positionX,y:e.positionY}));this.$el.css("cursor",o)},i.prototype._startDragModeCopy=function(){var t,e,n,i,o,s=this._diagramDesigner.selectionManager.getSelectedElements(),a=this._diagramDesigner.items,l=this._diagramDesigner.itemIds,c=this._diagramDesigner.connectionIds,d=s.length,h=[];for(this._dragDesc.params.modeSpecificData=o={},this._diagramDesigner.beginUpdate();d--;)t=s[d],-1!==l.indexOf(t)&&this._diagramDesigner.onDragStartDesignerItemCopyable(t)===!0&&(i={},e=a[t],i.position={x:e.positionX,y:e.positionY},i.decoratorClass=e._decoratorClass,i.control=e._decoratorInstance.getControl(),i.metaInfo=e._decoratorInstance.getMetaInfo(),n=this._diagramDesigner.createDesignerItem(i),n.moveTo(e.positionX,e.positionY),this._dragDesc.params.draggedItemIDs.push(n.id),this._dragDesc.params.originalPositions.push({x:n.positionX,y:n.positionY}),o[t]={copiedItemId:n.id},h.push(n.id));for(d=s.length;d--;)if(t=s[d],-1!==c.indexOf(t)&&this._diagramDesigner.onDragStartDesignerConnectionCopyable(t)===!0){var p=a[t],g=this._diagramDesigner.connectionEndIDs[t].srcObjId,u=this._diagramDesigner.connectionEndIDs[t].srcSubCompId,f=this._diagramDesigner.connectionEndIDs[t].dstObjId,m=this._diagramDesigner.connectionEndIDs[t].dstSubCompId;-1!==s.indexOf(g)&&(g=o[g].copiedItemId),-1!==s.indexOf(f)&&(f=o[f].copiedItemId),i=_.extend({},p.getConnectionProps()),i.srcObjId=g,i.srcSubCompId=u,i.dstObjId=f,i.dstSubCompId=m;var b=this._diagramDesigner.createConnection(i);this._dragDesc.params.draggedConnectionIDs.push(b.id),o[t]={copiedConnectionId:b.id},h.push(b.id)}this._diagramDesigner.endUpdate(),this._diagramDesigner.selectionManager.setSelection(h,!1),this.$el.css("cursor",r)},i.prototype._doDrag=function(t){var e=this._griddedMouseDelta(t);this._updateDraggedItemPositions(e.dX,e.dY)},i.prototype._endDrag=function(t){var e=this._griddedMouseDelta(t);this._updateDraggedItemPositions(e.dX,e.dY),this._endDragAction()},i.prototype._endDragAction=function(){var t=this._dragDesc.params.draggedItemIDs;this._dragDesc.mode===this.DRAGMODE_MOVE?this._endDragModeMove():this._dragDesc.mode===this.DRAGMODE_COPY&&this._endDragModeCopy(),this._diagramDesigner.onDesignerItemDragStop(void 0,t),this.$el.css("cursor","")},i.prototype._endDragModeMove=function(){var t,e,n=this._dragDesc.params.draggedItemIDs,i=n.length,o=this._diagramDesigner.items,r={};if(n.length>0&&(0!==this._dragDesc.dX||0!==this._dragDesc.dY)){for(;i--;)t=n[i],e=o[t],r[t]={x:e.positionX,y:e.positionY};this._dragDesc=void 0,this._diagramDesigner.onDesignerItemsMove(r)}},i.prototype._endDragModeCopy=function(){var t,e,n=this._dragDesc.params.draggedItemIDs,i=this._dragDesc.params.modeSpecificData,o={items:{},connections:{}};if(n.length>0){for(t in i)i.hasOwnProperty(t)&&(e=i[t],e.hasOwnProperty("copiedItemId")?o.items[e.copiedItemId]={oItemId:t,posX:this._diagramDesigner.items[e.copiedItemId].positionX,posY:this._diagramDesigner.items[e.copiedItemId].positionY}:e.hasOwnProperty("copiedConnectionId")&&(o.connections[e.copiedConnectionId]={oConnectionId:t}));this._dragDesc=void 0}},i.prototype._updateDraggedItemPositions=function(t,e){var n=this._diagramDesigner.gridSize;(t!==this._dragDesc.dX||e!==this._dragDesc.dY)&&(this._dragDesc.dX=t,this._dragDesc.dY=e,this.logger.debug("DragManager._updateDraggedItemPositions [dx,dy]: "+t+","+e),this._dragDesc.params.minStartCoordinates.x+t<n&&(this.logger.debug("dX cleared out otherwise item's position would be negative"),t=n-this._dragDesc.params.minStartCoordinates.x),this._dragDesc.params.minStartCoordinates.y+e<n&&(this.logger.debug("dY cleared out otherwise item's position would be negative"),e=n-this._dragDesc.params.minStartCoordinates.y),this._moveDraggedComponentsBy(t,e),this._diagramDesigner.onDesignerItemDrag(void 0,this._dragDesc.params.draggedItemIDs))},i.prototype._moveDraggedComponentsBy=function(t,e){var n,i,o,r=this._dragDesc.params.draggedItemIDs.length;for(this._movingDraggedComponents=!0;r--;)n=this._dragDesc.params.draggedItemIDs[r],i=this._dragDesc.params.originalPositions[r].x+t,o=this._dragDesc.params.originalPositions[r].y+e,this._diagramDesigner.items[n].moveTo(i,o);this._movingDraggedComponents=!1},i.prototype._griddedMouseDelta=function(t){var e=this._diagramDesigner.getAdjustedMousePos(t),n=e.mX-this._dragDesc.startX,i=e.mY-this._dragDesc.startY,o=this._diagramDesigner.gridSize,r=n-n%o,s=i-i%o;return{dX:r,dY:s}},i.prototype._calculateMinStartCoordinates=function(){var t;if(this._dragDesc)for(t=this._dragDesc.params.originalPositions.length,this._dragDesc.params.minStartCoordinates.x=void 0,this._dragDesc.params.minStartCoordinates.y=void 0;t--;)this._dragDesc.params.minStartCoordinates.x?this._dragDesc.params.minStartCoordinates.x=Math.min(this._dragDesc.params.minStartCoordinates.x,this._dragDesc.params.originalPositions[t].x):this._dragDesc.params.minStartCoordinates.x=this._dragDesc.params.originalPositions[t].x,
this._dragDesc.params.minStartCoordinates.y?this._dragDesc.params.minStartCoordinates.y=Math.min(this._dragDesc.params.minStartCoordinates.y,this._dragDesc.params.originalPositions[t].y):this._dragDesc.params.minStartCoordinates.y=this._dragDesc.params.originalPositions[t].y},i.prototype._onComponentDelete=function(t){var e,n,i,o=!1;if(this._dragDesc){switch(i=this._dragDesc.params.modeSpecificData,this._dragDesc.mode){case this.DRAGMODE_MOVE:e=this._dragDesc.params.draggedItemIDs.indexOf(t),-1!==e&&(this.logger.debug("One of the currently moved items is being deleted: "+t),this._dragDesc.params.draggedItemIDs.splice(e,1),this._dragDesc.params.originalPositions.splice(e,1),o=!0);break;case this.DRAGMODE_COPY:i.hasOwnProperty(t)&&(this.logger.debug("One of the currently copied items is being deleted: "+t),n=i[t].copiedItemId||i[t].copiedConnectionId,delete i[t],e=this._dragDesc.params.draggedItemIDs.indexOf(n),-1!==e&&(this._dragDesc.params.draggedItemIDs.splice(e,1),this._dragDesc.params.originalPositions.splice(e,1),o=!0),e=this._dragDesc.params.draggedConnectionIDs.indexOf(n),-1!==e&&this._dragDesc.params.draggedConnectionIDs.splice(e,1),this._diagramDesigner.deleteComponent(n))}o===!0&&this._calculateMinStartCoordinates(),this._dragDesc&&this._dragDesc.params&&0===this._dragDesc.params.draggedItemIDs.length&&this._cancelDrag()}},i.prototype._cancelDrag=function(){this.logger.debug("Cancelling drag artificially..."),this.$el.trigger("mouseup")},i.prototype._canvasItemPositionChanged=function(t){var e,n,i=t.ID,o=t.x,r=t.y;this._movingDraggedComponents!==!0&&this._dragDesc&&this._dragDesc.params&&this._dragDesc.params.draggedItemIDs&&(e=this._dragDesc.params.draggedItemIDs.indexOf(i),-1!==e&&(n=this._dragDesc.params.originalPositions[e],(o!==n.x+this._dragDesc.dX||r!==n.y+this._dragDesc.dY)&&(n.x=o,n.y=r,o=n.x+this._dragDesc.dX,r=n.y+this._dragDesc.dY,this._movingDraggedComponents=!0,this._diagramDesigner.items[i].moveTo(o,r),this._movingDraggedComponents=!1)))},i}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.OperatingModes",[],function(){"use strict";var t;return t=function(){},t.prototype.OPERATING_MODES={READ_ONLY:0,DESIGN:1,HIGHLIGHT:2},t}),define("js/Decorators/WidgetDecoratorBase",["js/logger"],function(t){"use strict";var e,n="WidgetDecoratorBase";return e=function(e){this.logger=e.logger||t.create("gme:Decorators:"+this.DECORATORID,WebGMEGlobal.gmeConfig.client.log),this.preferencesHelper=e.preferencesHelper,this.decoratorParams={},_.extend(this.decoratorParams,this.DECORATOR_DEFAULT_PARAMS,e.decoratorParams)},e.prototype.DECORATORID=n,e.prototype.DECORATOR_DEFAULT_PARAMS={},e}),define("css!js/Widgets/DiagramDesigner/styles/DiagramDesignerWidget.DecoratorBase.ConnectionArea",[],function(){}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase.ConnectionArea",["js/Constants","js/RegistryKeys","raphaeljs","css!./styles/DiagramDesignerWidget.DecoratorBase.ConnectionArea.css"],function(t,e){"use strict";var n,i="DiagramDesignerWidgetDecoratorBaseConnectionArea",o="decorator-edit",r="conn-area-edit",s="conn-area-edit-bg",a="disabled",l="CONN_AREA_ID",c=8,d=e.DIAGRAM_DESIGNER_WIDGET_DECORATOR_DISABLED_CONNECTION_AREAS;return n=function(){},n.prototype._initializeConnectionAreaUserSelection=function(){var t=this;this.$el.on("mousedown."+i,function(e){var n=3===e.which;n&&t._editConnectionAreas()===!0&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())})},n.prototype._editConnectionAreas=function(){var t,e=this.$el.outerWidth(!0),n=this.$el.outerHeight(!0),d=this,h=c/2;if(this.hostDesignerItem.canvas.getIsReadOnlyMode()===!0)return!1;if(0===this.getConnectionAreas().length)return!1;this._connAreaEditBackground=$("<div/>",{"class":s}),this._connAreaEditBackground.css({left:-h+"px",top:-h+"px"}),this.$el.addClass(o),this._decoratorItem=this.$el.parent(),this._decoratorItem.append(this._connAreaEditBackground),this._connAreaEditBackground.on("mouseup mouseenter mouseleave dblclick",function(t){t.stopPropagation()}),this._connAreaEditBackground.on("mousedown",function(t){t.stopPropagation();var e=3===t.which;e&&d._endEditConnectionAreas()}),this._connAreaEditBackground.on("mousedown."+i,"path."+r,function(t){var e=$(this).attr("class");e===r?$(this).attr({"class":r+" "+a}):$(this).attr({"class":r}),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}),this._svg=Raphael(this._connAreaEditBackground[0],e+c,n+c),this._svg.canvas.className.baseVal=s,this._areas=this.getConnectionAreas();var p=this._getDisabledConnectionAreas();for(t=this._areas.length;t--;){var g=this._areas[t];g.x1+=h,g.y1+=h,g.x2+=h,g.y2+=h,Math.abs(g.x2-g.x1)<c&&Math.abs(g.y2-g.y1)<c&&(g.x2>g.x1?(g.x1-=c/2,g.x2+=c/2):(g.x2-=c/2,g.x1+=c/2));var u=this._svg.path("M "+g.x1+","+g.y1+"L"+g.x2+","+g.y2);$(u.node).data(l,g.id),u.attr({"stroke-width":c}),-1!==p.indexOf(g.id)?$(u.node).attr({"class":r+" "+a}):$(u.node).attr({"class":r})}return!0},n.prototype._endEditConnectionAreas=function(){var t=this._connAreaEditBackground.find("path."+r),e=this.logger,n=[];t.each(function(t,i){i=$(i);var o=i.data(l),s=i.attr("class")===r;e.debug('Connection area: "'+o+'" enabled: '+s),s||n.push(o)}),t.length>0&&t.length!==n.length&&(this.$el.removeClass(o),this._connAreaEditBackground.remove(),this._setDisabledConnectionAreas(n))},n.prototype._getDisabledConnectionAreas=function(){var e=this._metaInfo[t.GME_ID],n=this.DECORATORID,i=[],o=d+n,r=this.preferencesHelper.getRegistry(e,o,!0)||[];return r&&(i=r.slice(0)),i},n.prototype._setDisabledConnectionAreas=function(e){var n=this._metaInfo[t.GME_ID],i=this.DECORATORID,o=d+i;0===e.length?this.preferencesHelper.delRegistry(n,o):this.preferencesHelper.setRegistry(n,o,e.slice(0))},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase",["js/Decorators/WidgetDecoratorBase","./DiagramDesignerWidget.Constants","./DiagramDesignerWidget.DecoratorBase.ConnectionArea"],function(t,e,n){"use strict";var i,o="DiagramDesignerWidgetDecoratorBase";return i=function(e){t.call(this,e),this.hostDesignerItem=e.host,this.skinParts={},this.$sourceConnectors=null,this.$endConnectors=null,this._initialize(),this.logger.debug("Created")},_.extend(i.prototype,t.prototype),_.extend(i.prototype,n.prototype),i.prototype.DECORATORID=o,i.prototype.setControl=function(t){this._control=t},i.prototype.getControl=function(){return this._control},i.prototype.setMetaInfo=function(t){this._metaInfo=t},i.prototype.getMetaInfo=function(){return this._metaInfo},i.prototype.$DOMBase=$(""),i.prototype._initialize=function(){this.$el=this.$DOMBase.clone(),this.initializeConnectors(),this._initializeConnectionAreaUserSelection()},i.prototype.initializeConnectors=function(){this.$sourceConnectors=this.$el.find("."+e.CONNECTOR_CLASS),this.$endConnectors=this.$sourceConnectors,this.hostDesignerItem?this.hostDesignerItem.registerConnectors(this.$sourceConnectors):this.logger.error("Decorator's hostDesignerItem is not set"),this.hideSourceConnectors()},i.prototype.showSourceConnectors=function(t){this.logger.debug("showSourceConnectors: "+JSON.stringify(t)),this.$sourceConnectors.appendTo(this.$el)},i.prototype.hideSourceConnectors=function(){this.$sourceConnectors.detach()},i.prototype.showEndConnectors=function(t){this.logger.debug("showEndConnectors: "+JSON.stringify(t)),this.$endConnectors.appendTo(this.$el)},i.prototype.hideEndConnectors=function(){this.$endConnectors.detach()},i.prototype.on_addTo=function(){},i.prototype.onRenderGetLayoutInfo=function(){this.calculateDimension(),this.renderLayoutInfo={}},i.prototype.onRenderSetLayoutInfo=function(){delete this.renderLayoutInfo},i.prototype.calculateDimension=function(){this.hostDesignerItem&&this.hostDesignerItem.setSize(this.$el.outerWidth(!0),this.$el.outerHeight(!0))},i.prototype.getConnectionAreas=function(){var t=[];return t.push({id:"0",x1:this.hostDesignerItem.getWidth()/2,y1:this.hostDesignerItem.getHeight()/2,x2:this.hostDesignerItem.getWidth()/2,y2:this.hostDesignerItem.getHeight()/2,angle1:270,angle2:270,len:10}),t},i.prototype.destroy=function(){this.logger.debug("DiagramDesignerWidgetDecoratorBase.destroyed")},i.prototype.onMouseEnter=function(){return!1},i.prototype.onMouseLeave=function(){return!1},i.prototype.onMouseDown=function(){return!1},i.prototype.onMouseUp=function(){return!1},i.prototype.onSelect=function(){return!1},i.prototype.onDeselect=function(){return!1},i.prototype.onDoubleClick=function(){return!1},i.prototype.update=function(){},i.prototype.updateSubcomponent=function(){},i.prototype.readOnlyMode=function(){},i.prototype.getConnectorMetaInfo=function(){return void 0},i.prototype.doSearch=function(){return!1},i.prototype.getDrawnConnectionVisualStyle=function(){return null},i.prototype.getTerritoryQuery=function(){return void 0},i.prototype.notifyComponentEvent=function(t){this.logger.warn("notifyComponentEvent not overridden in decorator"+JSON.stringify(t))},i}),define("js/Widgets/DiagramDesigner/ErrorDecorator",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase"],function(t){"use strict";var e,n=t,i=t.prototype,o="ErrorDecorator";return e=function(t){var e=_.extend({},t);n.apply(this,[e]),this.name="",this.logger.debug("ErrorDecorator ctor")},_.extend(e.prototype,i),e.prototype.DECORATORID=o,e.prototype.$DOMBase=$('<div class="error-decorator"><i class="glyphicon glyphicon-warning-sign"></i></div>'),e.prototype.on_addTo=function(){this._renderContent(),i.on_addTo.apply(this,arguments)},e.prototype._renderContent=function(){this.$el.append(this._metaInfo.__missingdecorator__),this.$el.attr("title",'Could not initialize decorator "'+this._metaInfo.__missingdecorator__+'"')},e}),define("js/Widgets/DiagramDesigner/DesignerItem",["js/logger","./DiagramDesignerWidget.Constants","./ErrorDecorator"],function(t,e,n){"use strict";var i,o="DesignerItem",r="hover",s="selectable";return i=function(e,n){this.id=e,this.canvas=n,this.__initialize(),this.logger=t.create("gme:Widgets:DiagramDesigner:DesignerItem_"+this.id,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},i.prototype.__initialize=function(){this._decoratorInstance=null,this._decoratorClass=null,this._decoratorID="",this.selected=!1,this.selectedInMultiSelection=!1,this.positionX=0,this.positionY=0,this.rotation=0,this._width=0,this._height=0,this._initializeUI()},i.prototype.__setDecorator=function(t,e,i,o,r,s,a){void 0===e&&(o=o||{},o.__missingdecorator__=t,e=n),this._decoratorID!==e.prototype.DECORATORID&&(this._decoratorInstance&&(this._callDecoratorMethod("destroy"),this.$el.empty()),this._decoratorID=e.prototype.DECORATORID,this._decoratorClass=e,this._decoratorInstance=new e({host:this,preferencesHelper:r,aspect:s,decoratorParams:a}),this._decoratorInstance.setControl(i),this._decoratorInstance.setMetaInfo(o))},i.prototype.$_DOMBase=$("<div/>").attr({"class":e.DESIGNER_ITEM_CLASS}),i.prototype._initializeUI=function(){this.$el=this.$_DOMBase.clone(),this.$el.attr({id:this.id}),this.$el.css({position:"absolute",left:this.positionX,top:this.positionY}),this._attachUserInteractions(),this.canvas._makeDraggable(this)},i.prototype._attachUserInteractions=function(){var t,e=this;this._events={mouseenter:{fn:"onMouseEnter",stopPropagation:!0,preventDefault:!0,enabledInReadOnlyMode:!0},mouseleave:{fn:"onMouseLeave",stopPropagation:!0,preventDefault:!0,enabledInReadOnlyMode:!0},dblclick:{fn:"onDoubleClick",stopPropagation:!0,preventDefault:!0,enabledInReadOnlyMode:!0}};for(t in this._events)this._events.hasOwnProperty(t)&&this.$el.on(t+"."+o,null,null,function(t){var n=e._events[t.type],i=!1,o=!0;(e.canvas.mode===e.canvas.OPERATING_MODES.READ_ONLY||e.canvas.mode===e.canvas.OPERATING_MODES.DESIGN)&&n&&(e.canvas.mode===e.canvas.OPERATING_MODES.READ_ONLY&&(o=n.enabledInReadOnlyMode),o&&(i=e._callDecoratorMethod(n.fn,t),i!==!0&&(i=e[n.fn].call(e,t)),i!==!0&&(n.stopPropagation===!0&&t.stopPropagation(),n.preventDefault===!0&&t.preventDefault())))})},i.prototype._detachUserInteractions=function(){var t;for(t in this._events)this._events.hasOwnProperty(t)&&this.$el.off(t+"."+o)},i.prototype.addToDocFragment=function(t){this._callDecoratorMethod("on_addTo"),this.$el.append(this._decoratorInstance.$el),t.appendChild(this.$el[0]),this.logger.debug('DesignerItem with id:"'+this.id+'" added to canvas.')},i.prototype.renderGetLayoutInfo=function(){this._callDecoratorMethod("onRenderGetLayoutInfo")},i.prototype.renderSetLayoutInfo=function(){this._callDecoratorMethod("onRenderSetLayoutInfo")},i.prototype._remove=function(){this._containerElement=null,this.$el.remove(),this.$el.empty(),this._detachUserInteractions(),this.$el=null},i.prototype.destroy=function(){this._destroying=!0,this.canvas._destroyDraggable(this),this._callDecoratorMethod("destroy"),this.canvas.unregisterAllSubcomponents(this.id),this._remove(),this.logger.debug("Destroyed")},i.prototype.getBoundingBox=function(){var t={x:this.positionX,y:this.positionY,width:this._width,height:this._height,x2:this.positionX+this._width,y2:this.positionY+this._height};if(0!==this.rotation){var e=this._rotatePoint(0,0),n=this._rotatePoint(this._width,0),i=this._rotatePoint(0,this._height),o=this._rotatePoint(this._width,this._height),r=Math.min(e.x,n.x,i.x,o.x),s=Math.max(e.x,n.x,i.x,o.x),a=Math.min(e.y,n.y,i.y,o.y),l=Math.max(e.y,n.y,i.y,o.y);t.x=this.positionX+r,t.y=this.positionY+a,t.x2=this.positionX+s,t.y2=this.positionY+l,t.width=t.x2-t.x,t.height=t.y2-t.y}return t},i.prototype.onMouseEnter=function(){var t=[];return this.logger.debug("onMouseEnter: "+this.id),t.push(r),t.push(s),this.$el.addClass(t.join(" ")),this.canvas.mode===this.canvas.OPERATING_MODES.DESIGN&&this.canvas.connectionDrawingManager.isDrawInProgress()===!1&&this.selectedInMultiSelection===!1&&this.showSourceConnectors(),!1},i.prototype.onMouseLeave=function(){var t=[r,s];return this.logger.debug("onMouseLeave: "+this.id),this.$el.removeClass(t.join(" ")),this.canvas.connectionDrawingManager.isDrawInProgress()!==!0&&this.hideSourceConnectors(),!1},i.prototype.onDoubleClick=function(t){this.canvas.onDesignerItemDoubleClick(this.id,t)},i.prototype.onSelect=function(t,e){this.selected=!0,this.selectedInMultiSelection=t,this.$el.addClass("selected"),t===!0&&this.hideSourceConnectors(),this._callDecoratorMethod("onSelect"),e(this)},i.prototype.onDeselect=function(t){this.selected=!1,this.selectedInMultiSelection=!1,this.$el.removeClass("selected"),this._callDecoratorMethod("onDeselect"),"function"==typeof t&&t(this)},i.prototype._callDecoratorMethod=function(t,e){var n=null;return this._decoratorInstance?_.isFunction(this._decoratorInstance[t])?n=this._decoratorInstance[t].apply(this._decoratorInstance,e):this.logger.warn('DecoratorInstance "'+$.type(this._decoratorInstance)+'" does not have a method with name "'+t+'"...'):this.logger.error("DecoratorInstance does not exist..."),n},i.prototype.update=function(t){if(t.position&&_.isNumber(t.position.x)&&_.isNumber(t.position.y)&&this.moveTo(t.position.x,t.position.y),_.isNumber(t.rotation)&&this.rotateTo(t.rotation),t.decoratorClass&&this._decoratorID!==t.decoratorClass.prototype.DECORATORID){this.logger.debug('decorator update: "'+this._decoratorID+'" --> "'+t.decoratorClass.prototype.DECORATORID+'"...');var e=this._decoratorInstance.getControl(),n=this._decoratorInstance.getMetaInfo();this.__setDecorator(t.decorator,t.decoratorClass,e,n,t.preferencesHelper,t.aspect,t.decoratorParams),this.$el.html(this._decoratorInstance.$el),this.logger.debug("DesignerItem's [\""+this.id+'"] decorator  has been updated.'),this._callDecoratorMethod("on_addTo")}else t.metaInfo&&this._decoratorInstance.setMetaInfo(t.metaInfo),this._decoratorInstance.update()},i.prototype.getConnectionAreas=function(t,e,n){for(var i,o,r,s=[],a=this._decoratorInstance.getConnectionAreas(t,e,n),l=this._decoratorInstance._getDisabledConnectionAreas(),c=a.length;c--;)o=a[c],r=!0,(void 0===t||null===t||t===this.id)&&(r=-1===l.indexOf(o.id)),r&&(0===this.rotation?(o.x1+=this.positionX,o.y1+=this.positionY,o.x2+=this.positionX,o.y2+=this.positionY):(i=this._rotatePoint(o.x1,o.y1),o.x1=i.x+this.positionX,o.y1=i.y+this.positionY,i=this._rotatePoint(o.x2,o.y2),o.x2=i.x+this.positionX,o.y2=i.y+this.positionY,o.angle1=(o.angle1+this.rotation)%360,o.angle2=(o.angle2+this.rotation)%360),s.push(o));return s},i.prototype.moveTo=function(t,e){var n=!1;_.isNumber(t)&&_.isNumber(e)&&(this.positionX!==t&&(this.positionX=t,n=!0),this.positionY!==e&&(this.positionY=e,n=!0),n&&(this.$el.css({left:this.positionX,top:this.positionY}),this.canvas.dispatchEvent(this.canvas.events.ITEM_POSITION_CHANGED,{ID:this.id,x:this.positionX,y:this.positionY})))},i.prototype.registerSubcomponent=function(t,e){this.logger.debug('registerSubcomponent - ID: "'+this.id+'", SubComponentID: "'+t+'"'),this.canvas.registerSubcomponent(this.id,t,e)},i.prototype.unregisterSubcomponent=function(t){this.logger.debug('unregisterSubcomponent - ID: "'+this.id+'", SubComponentID: "'+t+'"'),this.canvas.unregisterSubcomponent(this.id,t)},i.prototype.registerConnectors=function(t,n){t.attr(e.DATA_ITEM_ID,this.id),void 0!==n&&null!==n&&t.attr(e.DATA_SUBCOMPONENT_ID,n)},i.prototype.updateSubcomponent=function(t){this._decoratorInstance.updateSubcomponent(t)},i.prototype.readOnlyMode=function(t){this._decoratorInstance.readOnlyMode(t)},i.prototype.showSourceConnectors=function(t){this.canvas._enableConnectionDrawing===!0&&this._decoratorInstance.showSourceConnectors(t)},i.prototype.hideSourceConnectors=function(){this._decoratorInstance.hideSourceConnectors()},i.prototype.showEndConnectors=function(t){this.canvas._enableConnectionDrawing===!0&&this._decoratorInstance.showEndConnectors(t)},i.prototype.hideEndConnectors=function(){this._decoratorInstance.hideEndConnectors()},i.prototype.highlight=function(){this.$el.addClass(e.ITEM_HIGHLIGHT_CLASS)},i.prototype.unHighlight=function(){this.$el.removeClass(e.ITEM_HIGHLIGHT_CLASS)},i.prototype.rotateTo=function(t){_.isNumber(t)&&this.rotation!==t&&(this.rotation=t,this.$el.css({"transform-origin":"50% 50%",transform:"rotate("+this.rotation+"deg)"}),this.canvas.dispatchEvent(this.canvas.events.ITEM_ROTATION_CHANGED,{ID:this.id,deg:this.rotation}))},i.prototype._rotatePoint=function(t,e){var n=(this.rotation<0?360+this.rotation:this.rotation)%360,i=n*(Math.PI/180),o=Math.sin(i),r=Math.cos(i),s=t-this._width/2,a=e-this._height/2,l=s*r-a*o,c=s*o+a*r;return{x:l+this._width/2,y:c+this._height/2}},i.prototype.doSearch=function(t){return this._decoratorInstance.doSearch(t)},i.prototype.getDrawnConnectionVisualStyle=function(t){return this._decoratorInstance.getDrawnConnectionVisualStyle(t)},i.prototype.onItemComponentEvents=function(t){this._decoratorInstance.notifyComponentEvent(t)},i.prototype.getWidth=function(){return this._width},i.prototype.getHeight=function(){return this._height},i.prototype.setSize=function(t,e){var n=!1;_.isNumber(t)&&_.isNumber(e)&&(this._width!==t&&(this._width=t,n=!0),this._height!==e&&(this._height=e,n=!0),n===!0&&this.canvas.dispatchEvent(this.canvas.events.ITEM_SIZE_CHANGED,{ID:this.id,w:this._width,h:this._height}))},i}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.DesignerItems",["js/Widgets/DiagramDesigner/DesignerItem"],function(t){"use strict";var e;return e=function(){},e.prototype.createDesignerItem=function(e){var n,i=this._getGuid("I_"),o=_.extend({},e),r=this._alignPositionToGrid(o.position.x,o.position.y);return this.logger.debug('Creating model component with id: "'+i+'"'),o.designerCanvas=this,o.position.x=r.x,o.position.y=r.y,o.guid=i,this._checkPositionOverlap(i,o),this.itemIds.push(i),this._insertedDesignerItemIDs.push(i),n=this.items[i]=new t(i,this),n.moveTo(o.position.x,o.position.y),n.rotateTo(o.rotation),n.__setDecorator(o.decorator,o.decoratorClass,o.control,o.metaInfo,o.preferencesHelper,o.aspect,o.decoratorParams),n.addToDocFragment(this._documentFragment),n},e.prototype.updateDesignerItem=function(t,e){var n;-1!==this.itemIds.indexOf(t)&&(this.logger.debug("Updating model component with parameters: "+e),e.position&&_.isNumber(e.position.x)&&_.isNumber(e.position.y)&&(n=this._alignPositionToGrid(e.position.x,e.position.y),e.position.x=n.x,e.position.y=n.y,this._checkPositionOverlap(t,e)),this._updatedDesignerItemIDs.push(t),this.items[t].update(e))},e.prototype.updateDesignerItemSubComponent=function(t,e){-1!==this.itemIds.indexOf(t)&&(this.logger.debug("Updating model component's ["+t+"] subcomponent: "+e),this._updatedDesignerItemIDs.push(t),this.items[t].updateSubcomponent(e))},e.prototype.deleteDesignerItem=function(t){var e;this.logger.debug('Deleting DesignerItem with ID: "'+t+'"'),this._deletedDesignerItemIDs.push(t),e=this.itemIds.indexOf(t),this.itemIds.splice(e,1),this.items[t].destroy(),delete this.items[t]},e.prototype.onDesignerItemDoubleClick=function(t,e){this.logger.debug('DesignerItem "'+t+'" received double click at pos: ['+e.offsetX+", "+e.offsetY+"]")},e.prototype.notifyItemComponentEvents=function(t,e){-1!==this.itemIds.indexOf(t)&&(this._updatedDesignerItemIDs.push(t),this.items[t].onItemComponentEvents(e))},e}),define("js/Widgets/DiagramDesigner/Connection.EditSegment",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","raphaeljs"],function(t){"use strict";var e,n=5;return e=function(t){this.id=t.id,this.connection=t.connection,this.points=t.points,this.svgPaper=this.connection.paper,this.path=void 0,this.width=Math.max(n,this.connection.designerAttributes.width),this._render()},e.prototype.destroy=function(){this.path&&(this.path.remove(),this.path=void 0),this.circle&&(this.circle.remove(),this.circle=void 0)},e.prototype._render=function(){var e,n=this.points,i=n.length,o=[];for(e=0;i>e;e+=1)0===e?o.push("M"+n[e][0]+","+n[e][1]):this.connection.isBezier?o.push("C"+(n[e-1][0]+n[e-1][2])+","+(n[e-1][1]+n[e-1][3])+" "+(n[e][0]-n[e][2])+","+(n[e][1]-n[e][3])+" "+n[e][0]+","+n[e][1]):o.push("L"+n[e][0]+","+n[e][1]);this.pathDef=o.join(" "),this.path=this.svgPaper.path(this.pathDef),this.path.attr({"stroke-width":this.width}),this.path.node.setAttribute("class",t.PATH_EDIT_SEGMENT_CLASS),this._initMouseHandlers()},e.prototype._initMouseHandlers=function(){var e=this;this.circle=this.svgPaper.circle(0,0,this.width).hide(),this.circle.node.setAttribute("class",t.PATH_EDIT_SEGMENT_NEW_SEGMENT_POINT_MARKER_CLASS),this.path.mouseover(function(t){e.circle&&e.circle.show(),t.stopPropagation(),t.preventDefault()}),this.path.mouseout(function(t){e.circle&&e.circle.hide(),t.stopPropagation(),t.preventDefault()}),this.path.mousemove(function(t){var n=e._getMousePos(t),i=e._getSelectedPathPoint(n.mX,n.mY);i&&e.circle.attr({cx:i.x,cy:i.y}),t.stopPropagation(),t.preventDefault()}),this.path.mousedown(function(t){t.stopPropagation()}),this.path.dblclick(function(t){var n=e._getMousePos(t),i=e._getSelectedPathPoint(n.mX,n.mY);if(i)if(e.connection.isBezier){var o=Raphael.findDotsAtSegment(i.bez[0],i.bez[1],i.bez[2],i.bez[3],i.bez[4],i.bez[5],i.bez[6],i.bez[7],i.t),r=o.n.x-i.x,s=o.n.y-i.y;e.connection.addSegmentPoint(e.id,i.x,i.y,r,s)}else e.connection.addSegmentPoint(e.id,i.x,i.y,0,0);t.stopPropagation(),t.preventDefault()})},e.prototype._getMousePos=function(t){return this.connection.diagramDesigner.getAdjustedMousePos(t)},e.prototype._getSelectedPathPoint=function(t,e){var n,i=this.width+2,o=["M",t-i,e,"L",t+i,e].join(","),r=["M",t,e-i,"L",t,e+i].join(","),s=Raphael.pathIntersection(this.pathDef,o),a=Raphael.pathIntersection(this.pathDef,r),l=1e3,c=1e3;return s.length>0&&(l=Math.abs(t-s[0].x)+Math.abs(e-s[0].y)),a.length>0&&(c=Math.abs(t-a[0].x)+Math.abs(e-a[0].y)),c>l?s.length>0&&(n={x:s[0].x,y:s[0].y,t:s[0].t1,bez:s[0].bez1}):a.length>0&&(n={x:a[0].x,y:a[0].y,t:a[0].t1,bez:a[0].bez1}),n},e}),define("js/Widgets/DiagramDesigner/Connection.SegmentPoint",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","raphaeljs"],function(t){"use strict";var e,n=5,i="ConnectionSegmentPoint",o="mousemove."+i,r="mouseup."+i,s="segment-point",a="control-point",l=10,c="-",d=10,h=1;return e=function(t){this.id=t.id,this.connection=t.connection,this.point=t.point,this.pointAfter=t.pointAfter,this.pointBefore=t.pointBefore,this.svgPaper=this.connection.paper,this.isBezier=this.connection.isBezier,this.width=Math.max(n,this.connection.designerAttributes.width),this._render()},e.prototype.destroy=function(){this._moving===!0&&(this._detachMouseListeners(),this._removeRedrawPath()),this.circle&&(this.circle.remove(),this.circle=void 0),this.isBezier&&(this.cpLine.remove(),this.cpLine=void 0,this.cpBeforeCircle.remove(),this.cpBeforeCircle=void 0,this.cpAfterCircle.remove(),this.cpAfterCircle=void 0)},e.prototype._render=function(){this.isBezier&&(this.cpLine=this.svgPaper.path("M"+(this.point[0]-this.point[2])+","+(this.point[1]-this.point[3])+" L"+(this.point[0]+this.point[2])+","+(this.point[1]+this.point[3]))),this.circle=this.svgPaper.circle(this.point[0],this.point[1],this.width),this.circle.node.setAttribute("class",t.CONNECTION_SEGMENT_POINT_CLASS),this.isBezier&&(this.cpBeforeCircle=this.svgPaper.circle(this.point[0]-this.point[2],this.point[1]-this.point[3],this.width-h),this.cpAfterCircle=this.svgPaper.circle(this.point[0]+this.point[2],this.point[1]+this.point[3],this.width-h),this.cpBeforeCircle.node.setAttribute("class",t.CONNECTION_SEGMENT_POINT_BEZIER_CONTROL_CLASS),this.cpAfterCircle.node.setAttribute("class",t.CONNECTION_SEGMENT_POINT_BEZIER_CONTROL_CLASS)),this._initMouseHandlers()},e.prototype._initMouseHandlers=function(){var t=this;this.circle.mousedown(function(e){var n=t._getMousePos(e);t._startSegmentPointMove(n),t._attachMouseListeners(),e.stopPropagation()}),this.circle.dblclick(function(e){t.connection.removeSegmentPoint(t.id),e.stopPropagation(),e.preventDefault()}),this.isBezier&&(this.cpBeforeCircle.mousedown(function(e){var n=t._getMousePos(e);t._startBezierControlPointMove(n,!0),t._attachBezierControlPointMouseListeners(),e.stopPropagation()}),this.cpAfterCircle.mousedown(function(e){var n=t._getMousePos(e);t._startBezierControlPointMove(n,!1),t._attachBezierControlPointMouseListeners(),e.stopPropagation()}))},e.prototype._getMousePos=function(t){return this.connection.diagramDesigner.getAdjustedMousePos(t)},e.prototype._attachMouseListeners=function(){var t=this;$(document).on(o,function(e){t._onMouseMove(e),e.stopPropagation(),e.preventDefault()}),$(document).on(r,function(e){t._onMouseUp(e),e.stopPropagation(),e.preventDefault()})},e.prototype._detachMouseListeners=function(){$(document).off(o),$(document).off(r)},e.prototype._startSegmentPointMove=function(t){this._startPos=t,this._moveType=s,this._moving=!1},e.prototype._onMouseMove=function(t){var e,n=this._getMousePos(t),i=n.mX-this._startPos.mX,o=n.mY-this._startPos.mY;this._moving!==!0&&(Math.abs(i)>=l||Math.abs(o)>=l)&&(this._moving=!0),this._moving===!0&&(e=this._snapCoordinate([n.mX,n.mY]),this.point[0]=e[0],this.point[1]=e[1],this.circle.attr({cx:this.point[0],cy:this.point[1]}),this.isBezier&&(this.cpLine.attr({path:"M"+(this.point[0]-this.point[2])+","+(this.point[1]-this.point[3])+" L"+(this.point[0]+this.point[2])+","+(this.point[1]+this.point[3])}),this.cpBeforeCircle.attr({cx:this.point[0]-this.point[2],cy:this.point[1]-this.point[3]}),this.cpAfterCircle.attr({cx:this.point[0]+this.point[2],cy:this.point[1]+this.point[3]})),this._redrawMovePath())},e.prototype._onMouseUp=function(t){var e,n=this._getMousePos(t);this._detachMouseListeners(),this._moving===!0&&(this._moveType===s?(e=this._snapCoordinate([n.mX,n.mY]),this.connection.setSegmentPoint(this.id,e[0],e[1],this.point[2],this.point[3])):this._moveType===a&&this.connection.setSegmentPoint(this.id,this.point[0],this.point[1],this.point[2],this.point[3])),this._removeRedrawPath(),this._moving=!1,this._moveType=void 0},e.prototype._removeRedrawPath=function(){this._movePath&&(this._movePath.remove(),this._movePath=void 0)},e.prototype._snapCoordinate=function(t){var e=t[0],n=t[1];return Math.abs(this.pointBefore[0]-e)<d&&(e=this.pointBefore[0]),Math.abs(this.pointBefore[1]-n)<d&&(n=this.pointBefore[1]),Math.abs(this.pointAfter[0]-e)<d&&(e=this.pointAfter[0]),Math.abs(this.pointAfter[1]-n)<d&&(n=this.pointAfter[1]),[e,n]},e.prototype._startBezierControlPointMove=function(t,e){this._startPos=t,this._moveType=a,this._bezierControlBefore=e,this._moving=!1},e.prototype._attachBezierControlPointMouseListeners=function(){var t=this;$(document).on(o,function(e){t._onBezierControlPointMouseMove(e),e.stopPropagation(),e.preventDefault()}),$(document).on(r,function(e){t._onMouseUp(e),e.stopPropagation(),e.preventDefault()})},e.prototype._onBezierControlPointMouseMove=function(t){var e=this._getMousePos(t),n=e.mX-this._startPos.mX,i=e.mY-this._startPos.mY;this._moving!==!0&&(Math.abs(n)>=l||Math.abs(i)>=l)&&(this._moving=!0),this._moving===!0&&(this._bezierControlBefore?(this.point[2]=this.point[0]-e.mX,this.point[3]=this.point[1]-e.mY):(this.point[2]=e.mX-this.point[0],this.point[3]=e.mY-this.point[1]),Math.abs(this.point[2])<d&&(this.point[2]=0),Math.abs(this.point[3])<d&&(this.point[3]=0),this.cpLine.attr({path:"M"+(this.point[0]-this.point[2])+","+(this.point[1]-this.point[3])+" L"+(this.point[0]+this.point[2])+","+(this.point[1]+this.point[3])}),this.cpBeforeCircle.attr({cx:this.point[0]-this.point[2],cy:this.point[1]-this.point[3]}),this.cpAfterCircle.attr({cx:this.point[0]+this.point[2],cy:this.point[1]+this.point[3]}),this._redrawMovePath())},e.prototype._redrawMovePath=function(){var e=[];this.isBezier?(e.push("M"+this.pointBefore[0]+","+this.pointBefore[1]),e.push("C"+(this.pointBefore[0]+this.pointBefore[2])+","+(this.pointBefore[1]+this.pointBefore[3])+" "+(this.point[0]-this.point[2])+","+(this.point[1]-this.point[3])+" "+this.point[0]+","+this.point[1]),e.push("C"+(this.point[0]+this.point[2])+","+(this.point[1]+this.point[3])+" "+(this.pointAfter[0]-this.pointAfter[2])+","+(this.pointAfter[1]-this.pointAfter[3])+" "+this.pointAfter[0]+","+this.pointAfter[1])):(e.push("M"+this.pointBefore[0]+","+this.pointBefore[1]),e.push("L"+this.point[0]+","+this.point[1]),e.push("L"+this.pointAfter[0]+","+this.pointAfter[1])),e=e.join(" "),this._movePath?this._movePath.attr({path:e}):(this._movePath=this.svgPaper.path(this.pathDef),this._movePath.attr({"stroke-width":this.connection.designerAttributes.width,"stroke-dasharray":c}),this._movePath.node.setAttribute("class",t.SEGMENT_POINT_MOVE_PATH_CLASS),this._movePath.node.parentNode.insertBefore(this._movePath.node,$(this.svgPaper.canvas).find("circle."+t.CONNECTION_SEGMENT_POINT_CLASS).first()[0]))},e}),define("js/Widgets/DiagramDesigner/Connection",["js/logger","js/util","./DiagramDesignerWidget.Constants","./DiagramDesignerWidget.OperatingModes","./Connection.EditSegment","./Connection.SegmentPoint"],function(t,e,n,i,o,r){"use strict";var s,a="t_",l=5,c=1,d="#000000",h=n.LINE_PATTERNS.SOLID,p=n.LINE_ARROWS.NONE,g=p,u=0,f=5,m=1,_="#B9DCF7",b=n.LINE_TYPES.NONE,y=3,v=1,C=2,E=3;return s=function(e){this.id=e,this.logger=t.create("gme:Widgets:DiagramDesigner:Connection_"+this.id,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created"),this.sourceCoordinates={x:-1,y:-1},this.endCoordinates={x:-1,y:-1}},s.prototype._initialize=function(t){this.diagramDesigner=t.designerCanvas,this.paper=this.diagramDesigner.skinParts.SVGPaper,this.skinParts={},this.reconnectable=!1,this.selected=!1,this.selectedInMultiSelection=!1,this.onRenderCallback=null,this.designerAttributes={},this._segmentPointMarkers=[],this._editMode=!1,this._readOnly=!1,this._connectionEditSegments=[],this._pathPointsBBox={x:0,y:0,x2:0,y2:0,w:0,h:0},this._initializeConnectionProps(t)},s.prototype._initializeConnectionProps=function(t){if(this.reconnectable=t.reconnectable===!0,this.editable=!!t.editable,this.isBezier=(t[n.LINE_TYPE]||n.LINE_TYPES.NONE).toLowerCase()===n.LINE_TYPES.BEZIER,this.designerAttributes.arrowStart=t[n.LINE_START_ARROW]||g,this.designerAttributes.arrowEnd=t[n.LINE_END_ARROW]||g,this.designerAttributes.color=t[n.LINE_COLOR]||d,this.designerAttributes.width=parseInt(t[n.LINE_WIDTH],10)||c,
this.designerAttributes.pattern=t[n.LINE_PATTERN]||h,this.designerAttributes.shadowWidth=this.designerAttributes.width+f-c,this.designerAttributes.shadowOpacity=u,this.designerAttributes.shadowOpacityWhenSelected=m,this.designerAttributes.shadowColor=_,this.designerAttributes.lineType=t[n.LINE_TYPE]||b,this.designerAttributes.shadowEndArrowWidth=this.designerAttributes.width+y,(-1!==this.designerAttributes.arrowStart.indexOf("-xx")||-1!==this.designerAttributes.arrowEnd.indexOf("-xx")||-1!==this.designerAttributes.arrowStart.indexOf("-x")||-1!==this.designerAttributes.arrowEnd.indexOf("-x"))&&(this.designerAttributes.shadowEndArrowWidth=this.designerAttributes.width+v),this.designerAttributes.shadowArrowStartAdjust=this._raphaelArrowAdjustForSizeToRefSize(this.designerAttributes.arrowStart,this.designerAttributes.shadowEndArrowWidth,this.designerAttributes.width,!1),this.designerAttributes.shadowArrowEndAdjust=this._raphaelArrowAdjustForSizeToRefSize(this.designerAttributes.arrowEnd,this.designerAttributes.shadowEndArrowWidth,this.designerAttributes.width,!0),this.srcText=t.srcText,this.dstText=t.dstText,this.name=t.name,this.nameEdit=t.nameEdit||!1,this.srcTextEdit=t.srcTextEdit||!1,this.dstTextEdit=t.dstTextEdit||!1,this.segmentPoints=[],t[n.LINE_POINTS])for(var e,i,o,r=t[n.LINE_POINTS].length,s=0;r>s;s+=1)e=this._fixXY({x:t[n.LINE_POINTS][s][0],y:t[n.LINE_POINTS][s][1]}),i=t[n.LINE_POINTS][s].length>2?t[n.LINE_POINTS][s][2]:0,o=t[n.LINE_POINTS][s].length>2?t[n.LINE_POINTS][s][3]:0,this.segmentPoints.push([e.x,e.y,i,o])},s.prototype._raphaelArrowAdjustForSizeToRefSize=function(t,e,n,i){for(var o,r=3,s=3,a=t.toLowerCase().split("-"),l="classic",c=a.length;c--;)switch(a[c]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":case"diamond2":case"inheritance":l=a[c];break;case"wide":s=5;break;case"narrow":s=2;break;case"long":r=5;break;case"short":r=2;break;case"xwide":s=9;break;case"xlong":r=9;break;case"xxwide":s=12;break;case"xxlong":r=12}return"none"===l?0:(o=r/2,i?(this.designerAttributes.endArrowMarkerSize=this.designerAttributes.width*r,this.designerAttributes.shadowEndArrowMarkerSize=this.designerAttributes.shadowEndArrowWidth*r):(this.designerAttributes.startArrowMarkerSize=this.designerAttributes.width*r,this.designerAttributes.shadowStartArrowMarkerSize=this.designerAttributes.shadowEndArrowWidth*r),o*(e-n))},s.prototype._raphaelArrowSizeToRefSize=function(t,e){for(var n,i,o=3,r=3,s=t.toLowerCase().split("-"),a="classic",l=s.length;l--;)switch(s[l]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":case"diamond2":case"inheritance":a=s[l];break;case"wide":r=5;break;case"narrow":r=2;break;case"long":o=5;break;case"short":o=2;break;case"xwide":r=9;break;case"xlong":o=9;break;case"xxwide":r=12;break;case"xxlong":o=12}return"none"===a?0:(n=o/2,i=r/2,{w:e*o,h:e*r,refX:n*e,refY:i*e})},s.prototype.getConnectionProps=function(){var t={};return t.reconnectable=this.reconnectable,t.arrowStart=this.designerAttributes.arrowStart,t.arrowEnd=this.designerAttributes.arrowEnd,t.color=this.designerAttributes.color,t.width=this.designerAttributes.width,t.shadowColor=this.designerAttributes.shadowColor,t.lineType=this.designerAttributes.lineType,t.pattern=this.designerAttributes.pattern,t},s.prototype._fixXY=function(t){var e={x:Math.floor(t.x),y:Math.floor(t.y)};return this.designerAttributes.width%2===1&&(e.x+=.5,e.y+=.5),e},s.prototype.setConnectionRenderData=function(t){var e,i,o,r,s,a,c=0,d=[],h={x:NaN,y:NaN},p=[],g=t&&t.length>1;if(this._removeEditModePath(),g)for(c=e=t.length,e--;c--;)t[e-c]&&(i=this._fixXY(t[e-c]),!h||h.x===i.x&&h.y===i.y||(p.push(i),h=i));if(this._simplifyTrivially(p),this.sourceCoordinates={x:-1,y:-1},this.endCoordinates={x:-1,y:-1},e=p.length,g=e>1){for(this._pathPoints=p,i=p[0],o=s=i.x,r=a=i.y,this.sourceCoordinates.x=i.x,this.sourceCoordinates.y=i.y,c=p.length;c--;)i=p[c],o=Math.min(o,i.x),r=Math.min(r,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);this._pathPointsBBox.x=o,this._pathPointsBBox.y=r,this._pathPointsBBox.x2=s,this._pathPointsBBox.y2=a,i=p[p.length-1],this.endCoordinates.x=i.x,this.endCoordinates.y=i.y,d=this._getPathDefFromPoints(p),d=this._jumpOnCrossings(d),d=d.join(" "),this.pathDef!==d&&(this.pathDef=d,this._calculatePathStartEndAngle(),this.skinParts.path?(this.logger.debug('Redrawing connection with ID: "'+this.id+'"'),this.skinParts.path.attr({path:d}),this.skinParts.pathShadow&&this._updatePathShadow(this._pathPoints)):(this.logger.debug('Drawing connection with ID: "'+this.id+'"'),this.skinParts.path=this.paper.path(d),$(this.skinParts.path.node).attr({id:this.id,"class":n.DESIGNER_CONNECTION_CLASS}),this.skinParts.path.attr({"arrow-start":this.designerAttributes.arrowStart,"arrow-end":this.designerAttributes.arrowEnd,stroke:this.designerAttributes.color,"stroke-width":this.designerAttributes.width,"stroke-dasharray":this.designerAttributes.pattern}),this.designerAttributes.width<l&&this._createPathShadow(this._pathPoints),this.selected&&this.onSelect(this.selectedInMultiSelection))),this._editMode===!0&&(this._drawEditModePath(p),this.showEndReconnectors()),this._showConnectionAreaMarker(),this._renderTexts()}else this.pathDef=null,this._removePath(),this._removePathShadow(),this._hideConnectionAreaMarker(),this._hideTexts()},s.prototype._calcRawBoundingBox=function(){var t,e={x:0,y:0,x2:0,y2:0,width:0,height:0};if(this._pathPoints&&this._pathPoints.length>0){for(e.x=e.x2=this._pathPoints[0].x,e.y=e.y2=this._pathPoints[0].y,t=1;t<this._pathPoints.length;t+=1)e.x=this._pathPoints[t].x<e.x?this._pathPoints[t].x:e.x,e.x2=this._pathPoints[t].x>e.x2?this._pathPoints[t].x:e.x2,e.y=this._pathPoints[t].y<e.y?this._pathPoints[t].y:e.y,e.y2=this._pathPoints[t].y>e.y2?this._pathPoints[t].y:e.y2;e.width=e.x2-e.x,e.height=e.y2-e.y}return e},s.prototype.getBoundingBox=function(){var t,e,n,i,o,r,s,a,l=0;if(r=this._calcRawBoundingBox(),this.skinParts.pathShadow?(e=this.designerAttributes.shadowWidth,l=this.designerAttributes.shadowArrowEndAdjust):this.skinParts.path&&(e=this.designerAttributes.width),t={x:r.x,y:r.y,x2:r.x2,y2:r.y2,width:r.width,height:r.height},this.designerAttributes.arrowStart!==p)for(s=this._getRaphaelArrowEndBoundingPoints(this.designerAttributes.arrowStart,e,this._pathStartAngle,!1),n=l*Math.cos(this._pathStartAngle),i=l*Math.sin(this._pathStartAngle),o={x:this.sourceCoordinates.x-n,y:this.sourceCoordinates.y-i,x2:this.sourceCoordinates.x-n,y2:this.sourceCoordinates.y-i},a=s.length;a--;)o.x=Math.min(o.x,this.sourceCoordinates.x-n-s[a].x),o.y=Math.min(o.y,this.sourceCoordinates.y-i-s[a].y),o.x2=Math.max(o.x2,this.sourceCoordinates.x-n-s[a].x),o.y2=Math.max(o.y2,this.sourceCoordinates.y-i-s[a].y);if(this.designerAttributes.arrowEnd!==p)for(s=this._getRaphaelArrowEndBoundingPoints(this.designerAttributes.arrowEnd,e,this._pathEndAngle,!0),n=l*Math.cos(this._pathEndAngle),i=l*Math.sin(this._pathEndAngle),o=o||{x:this.endCoordinates.x+n,y:this.endCoordinates.y+i,x2:this.endCoordinates.x+n,y2:this.endCoordinates.y+i},a=s.length;a--;)o.x=Math.min(o.x,this.endCoordinates.x+n+s[a].x),o.y=Math.min(o.y,this.endCoordinates.y+i+s[a].y),o.x2=Math.max(o.x2,this.endCoordinates.x+n+s[a].x),o.y2=Math.max(o.y2,this.endCoordinates.y+i+s[a].y);return 0===t.height&&0!==t.width?(t.height=e,t.y-=e/2,t.y2+=e/2):0!==t.height&&0===t.width?(t.width=e,t.x-=e/2,t.x2+=e/2):0!==t.height&&0!==t.width&&(Math.abs(t.x-this.sourceCoordinates.x)<Math.abs(t.x-this.endCoordinates.x)?(t.x-=Math.abs(Math.cos(Math.PI/2-this._pathStartAngle)*e/2),t.x2+=Math.abs(Math.cos(Math.PI/2-this._pathEndAngle)*e/2)):(t.x-=Math.abs(Math.cos(Math.PI/2-this._pathEndAngle)*e/2),t.x2+=Math.abs(Math.cos(Math.PI/2-this._pathStartAngle)*e/2)),Math.abs(t.y-this.sourceCoordinates.y)<Math.abs(t.y-this.endCoordinates.y)?(t.y-=Math.abs(Math.sin(Math.PI/2-this._pathStartAngle)*e/2),t.y2+=Math.abs(Math.sin(Math.PI/2-this._pathEndAngle)*e/2)):(t.y-=Math.abs(Math.sin(Math.PI/2-this._pathEndAngle)*e/2),t.y2+=Math.abs(Math.sin(Math.PI/2-this._pathStartAngle)*e/2)),t.width=t.x2-t.x,t.height=t.y2-t.y),o=o||t,t.x=Math.min(t.x,o.x),t.y=Math.min(t.y,o.y),t.x2=Math.max(t.x2,o.x2),t.y2=Math.max(t.y2,o.y2),t.width=t.x2-t.x,t.height=t.y2-t.y,isNaN(t.x)&&(t.x=0),isNaN(t.y)&&(t.y=0),isNaN(t.x2)&&(t.x2=0),isNaN(t.y2)&&(t.y2=0),isNaN(t.width)&&(t.width=0),isNaN(t.height)&&(t.height=0),t},s.prototype._getRaphaelArrowEndBoundingPoints=function(t,e,n,i){for(var o,r,s,a=[],l={x:0,y:0},c={x:0,y:0},d={x:0,y:0},h={x:0,y:0},p={x:0,y:0},g=t.toLowerCase().split("-"),u="classic",f=g.length;f--;)switch(g[f]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":case"diamond2":case"inheritance":u=g[f]}switch(o=this._raphaelArrowSizeToRefSize(t,e,i),r=Math.sqrt(o.w/2*o.w/2+o.h/2*o.h/2),s=Math.atan(o.h/o.w),h.x=Math.cos(n+s)*r,h.y=Math.sin(n+s)*r,c.x=Math.cos(n-s)*r,c.y=Math.sin(n-s)*r,d.x=Math.cos(n-s+Math.PI)*r,d.y=Math.sin(n-s+Math.PI)*r,l.x=Math.cos(n+s+Math.PI)*r,l.y=Math.sin(n+s+Math.PI)*r,p.x=Math.cos(n)*o.refX,p.y=Math.sin(n)*o.refY,u){case"classic":case"block":case"inheritance":a.push({x:-p.x+l.x,y:-p.y+l.y}),a.push({x:(-p.x+c.x+(-p.x+h.x))/2,y:(-p.y+c.y+(-p.y+h.y))/2}),a.push({x:-p.x+d.x,y:-p.y+d.y});break;case"diamond":case"diamond2":a.push({x:(-p.x+l.x+(-p.x+c.x))/2,y:(-p.y+l.y+(-p.y+c.y))/2}),a.push({x:(-p.x+c.x+(-p.x+h.x))/2,y:(-p.y+c.y+(-p.y+h.y))/2}),a.push({x:(-p.x+d.x+(-p.x+h.x))/2,y:(-p.y+d.y+(-p.y+h.y))/2}),a.push({x:(-p.x+d.x+(-p.x+l.x))/2,y:(-p.y+d.y+(-p.y+l.y))/2});break;default:a.push({x:-p.x+l.x,y:-p.y+l.y}),a.push({x:-p.x+c.x,y:-p.y+c.y}),a.push({x:-p.x+h.x,y:-p.y+h.y}),a.push({x:-p.x+d.x,y:-p.y+d.y})}return a},s.prototype.destroy=function(){this._destroying=!0,this._hideSegmentPoints(),this.hideEndReconnectors(),this._removeEditModePath(),this._removePath(),this._removePathShadow(),this._hideConnectionAreaMarker(),this.hideSourceConnectors(),this.hideEndConnectors(),this._hideTexts(),this.logger.debug("Destroyed")},s.prototype.onSelect=function(t,e){this.selected=!0,this.selectedInMultiSelection=t,e=e||this.onRenderCallback,this.skinParts.path?(this._highlightPath(),this.selectedInMultiSelection===!0?this._setEditMode(!1):this.diagramDesigner.mode===this.diagramDesigner.OPERATING_MODES.DESIGN&&this._setEditMode(!0),e(this)):this.onRenderCallback=e},s.prototype.onDeselect=function(t){this.selected=!1,this.selectedInMultiSelection=!1,this.onRenderCallback=null,this._unHighlightPath(),this._setEditMode(!1),"function"==typeof t&&t(this)},s.prototype._highlightPath=function(){this._createPathShadow(this._pathPoints),this.skinParts.pathShadow.attr({opacity:this.designerAttributes.shadowOpacityWhenSelected}),this.skinParts.pathShadowArrowStart&&this.skinParts.pathShadowArrowStart.attr({opacity:this.designerAttributes.shadowOpacityWhenSelected}),this.skinParts.pathShadowArrowEnd&&this.skinParts.pathShadowArrowEnd.attr({opacity:this.designerAttributes.shadowOpacityWhenSelected})},s.prototype._unHighlightPath=function(){this.designerAttributes.width<l?(this.skinParts.pathShadow.attr({opacity:this.designerAttributes.shadowOpacity}),this.skinParts.pathShadowArrowStart&&this.skinParts.pathShadowArrowStart.attr({opacity:this.designerAttributes.shadowOpacity}),this.skinParts.pathShadowArrowEnd&&this.skinParts.pathShadowArrowEnd.attr({opacity:this.designerAttributes.shadowOpacity})):this._removePathShadow()},s.prototype._calculatePathStartEndAngle=function(){var t,e,n;t=this._pathPoints[1].x-this._pathPoints[0].x,e=this._pathPoints[1].y-this._pathPoints[0].y,0===t&&0!==e?this._pathStartAngle=Math.PI/2*Math.abs(e)/e:(this._pathStartAngle=Math.atan(e/t),0>t&&(this._pathStartAngle+=Math.PI)),n=this._pathPoints.length,t=this._pathPoints[n-1].x-this._pathPoints[n-2].x,e=this._pathPoints[n-1].y-this._pathPoints[n-2].y,0===t&&0!==e?this._pathEndAngle=Math.PI/2*Math.abs(e)/e:(this._pathEndAngle=Math.atan(e/t),0>t&&(this._pathEndAngle+=Math.PI))},s.prototype._createPathShadow=function(t){var e,i;(void 0===this.skinParts.pathShadow||null===this.skinParts.pathShadow)&&(this.skinParts.pathShadow=this.paper.path("M0,0 L1,1"),this.skinParts.pathShadow.insertBefore(this.skinParts.path),$(this.skinParts.pathShadow.node).attr({id:n.PATH_SHADOW_ID_PREFIX+this.id,"class":n.DESIGNER_CONNECTION_CLASS}),this.skinParts.pathShadow.attr({stroke:this.designerAttributes.shadowColor,"stroke-width":this.designerAttributes.shadowWidth,opacity:this.designerAttributes.shadowOpacity}),this.designerAttributes.arrowStart!==p?(this.skinParts.pathShadowArrowStart=this.paper.path("M0,0 L1,1"),this.skinParts.pathShadowArrowStart.insertBefore(this.skinParts.path),$(this.skinParts.pathShadowArrowStart.node).attr({id:n.PATH_SHADOW_ARROW_END_ID_PREFIX+this.id,"class":n.DESIGNER_CONNECTION_CLASS})):this.skinParts.pathShadowArrowStart&&(this.skinParts.pathShadowArrowStart.remove(),this.skinParts.pathShadowArrowStart=void 0),this.designerAttributes.arrowEnd!==p?(this.skinParts.pathShadowArrowEnd=this.paper.path("M0,0 L1,1"),this.skinParts.pathShadowArrowEnd.insertBefore(this.skinParts.path),$(this.skinParts.pathShadowArrowEnd.node).attr({id:n.PATH_SHADOW_ARROW_END_ID_PREFIX+this.id,"class":n.DESIGNER_CONNECTION_CLASS})):this.skinParts.pathShadowArrowEnd&&(this.skinParts.pathShadowArrowEnd.remove(),this.skinParts.pathShadowArrowEnd=void 0),this._updatePathShadow(t),this.skinParts.pathShadowArrowStart&&(e=this.designerAttributes.arrowStart.replace("inheritance","block"),this.skinParts.pathShadowArrowStart.attr({stroke:this.designerAttributes.shadowColor,"stroke-width":this.designerAttributes.shadowEndArrowWidth,opacity:this.designerAttributes.shadowOpacity,"arrow-start":e})),this.skinParts.pathShadowArrowEnd&&(i=this.designerAttributes.arrowEnd.replace("inheritance","block"),this.skinParts.pathShadowArrowEnd.attr({stroke:this.designerAttributes.shadowColor,"stroke-width":this.designerAttributes.shadowEndArrowWidth,opacity:this.designerAttributes.shadowOpacity,"arrow-end":i})))},s.prototype._updatePathShadow=function(t){var e,n,i,o,r,s,a,l,c,d,h,g=[],u=[],f=[],m=[];for(s=function(t){return Math.abs(t)<.001?0:t},a=function(t,e,n,i){var o,r,s=e.x<n.x?e.x:n.x,a=e.y<n.y?e.y:n.y,l=e.x>n.x?e.x:n.x,c=e.y>n.y?e.y:n.y,d=[];for(i?(o=0,r=t.length-1):(o=1,r=t.length,d.push({x:t[0].x,y:t[0].y}));r>o;o+=1)t[o].x>=s&&t[o].x<=l&&t[o].y>=a&&t[o].y<=c||d.push({x:t[o].x,y:t[o].y});return i&&d.push({x:t[t.length-1].x,y:t[t.length-1].y}),d},n=t.length,e=0;n>e;e+=1)g.push({x:t[e].x,y:t[e].y}),u.push({x:t[e].x,y:t[e].y});this.designerAttributes.arrowStart!==p&&(o=this.designerAttributes.shadowArrowStartAdjust*Math.cos(this._pathStartAngle),r=this.designerAttributes.shadowArrowStartAdjust*Math.sin(this._pathStartAngle),o=s(o),r=s(r),0!==o&&(l=g[0].x,g[0].x+=this.designerAttributes.startArrowMarkerSize/2*Math.cos(this._pathStartAngle)),0!==r&&(c=g[0].y,g[0].y+=this.designerAttributes.startArrowMarkerSize/2*Math.sin(this._pathStartAngle)),u[0].x-=o,u[0].y-=r,(-1!==this.designerAttributes.arrowStart.indexOf("block")||-1!==this.designerAttributes.arrowStart.indexOf("inheritance"))&&(0!==o&&(u[0].x-=C*(o/Math.abs(o))),0!==r&&(u[0].y-=C*(r/Math.abs(r))))),this.designerAttributes.arrowEnd!==p&&(o=this.designerAttributes.shadowArrowEndAdjust*Math.cos(this._pathEndAngle),r=this.designerAttributes.shadowArrowEndAdjust*Math.sin(this._pathEndAngle),o=s(o),r=s(r),0!==o&&(d=g[n-1].x,g[n-1].x-=this.designerAttributes.endArrowMarkerSize/2*Math.cos(this._pathEndAngle)),0!==r&&(h=g[n-1].y,g[n-1].y-=this.designerAttributes.endArrowMarkerSize/2*Math.sin(this._pathEndAngle)),u[n-1].x+=o,u[n-1].y+=r,(-1!==this.designerAttributes.arrowEnd.indexOf("block")||-1!==this.designerAttributes.arrowEnd.indexOf("inheritance"))&&(0!==o&&(u[n-1].x+=C*(o/Math.abs(o))),0!==r&&(u[n-1].y+=C*(r/Math.abs(r))))),this.designerAttributes.arrowStart!==p&&(g=a(g,{x:l,y:c},{x:g[0].x,y:g[0].y},!1)),this.designerAttributes.arrowEnd!==p&&(n=g.length,g=a(g,{x:d,y:h},{x:g[n-1].x,y:g[n-1].y},!0)),f=this._getPathDefFromPoints(g),f=this._jumpOnCrossings(f),f=f.join(" "),this.skinParts.pathShadow.attr({path:f}),this.skinParts.pathShadowArrowStart&&(m=[],o=this.designerAttributes.shadowStartArrowMarkerSize*Math.cos(this._pathStartAngle),r=this.designerAttributes.shadowStartArrowMarkerSize*Math.sin(this._pathStartAngle),i=u[0],m.push("M"+i.x+","+i.y),m.push("L"+(i.x+o)+","+(i.y+r)),m=m.join(" "),this.skinParts.pathShadowArrowStart.attr({path:m})),this.skinParts.pathShadowArrowEnd&&(n=u.length,m=[],o=this.designerAttributes.shadowEndArrowMarkerSize*Math.cos(this._pathEndAngle),r=this.designerAttributes.shadowEndArrowMarkerSize*Math.sin(this._pathEndAngle),i=u[n-1],m.push("M"+(i.x-o)+","+(i.y-r)),m.push("L"+i.x+","+i.y),m=m.join(" "),this.skinParts.pathShadowArrowEnd.attr({path:m}))},s.prototype._removePath=function(){this.skinParts.path&&(this.skinParts.path.remove(),this.skinParts.path=null)},s.prototype._removePathShadow=function(){this.skinParts.pathShadow&&(this.skinParts.pathShadow.remove(),this.skinParts.pathShadow=void 0),this.skinParts.pathShadowArrowStart&&(this.skinParts.pathShadowArrowStart.remove(),this.skinParts.pathShadowArrowStart=void 0),this.skinParts.pathShadowArrowEnd&&(this.skinParts.pathShadowArrowEnd.remove(),this.skinParts.pathShadowArrowEnd=void 0)},s.prototype.showEndReconnectors=function(){if(this.reconnectable){this.skinParts.srcDragPoint=this.skinParts.srcDragPoint||$("<div/>",{"data-end":n.CONNECTION_END_SRC,"data-id":this.id,"class":n.CONNECTION_DRAGGABLE_END_CLASS+" "+n.CONNECTION_END_SRC}),this.skinParts.srcDragPoint.html("S"),this.skinParts.srcDragPoint.css({position:"absolute",top:this.sourceCoordinates.y,left:this.sourceCoordinates.x}),this.diagramDesigner.skinParts.$itemsContainer.append(this.skinParts.srcDragPoint),this.skinParts.dstDragPoint=this.skinParts.dstDragPoint||$("<div/>",{"data-end":n.CONNECTION_END_DST,"data-id":this.id,"class":n.CONNECTION_DRAGGABLE_END_CLASS+" "+n.CONNECTION_END_DST}),this.skinParts.dstDragPoint.html("D"),this.skinParts.dstDragPoint.css({position:"absolute",top:this.endCoordinates.y,left:this.endCoordinates.x}),this.diagramDesigner.skinParts.$itemsContainer.append(this.skinParts.dstDragPoint);var t=Math.max(1,this.designerAttributes.width/10);this.skinParts.srcDragPoint.css("transform","scale("+t+","+t+")"),this.skinParts.dstDragPoint.css("transform","scale("+t+","+t+")")}else this.hideEndReconnectors()},s.prototype.hideEndReconnectors=function(){this.skinParts.srcDragPoint&&(this.skinParts.srcDragPoint.empty(),this.skinParts.srcDragPoint.remove(),this.skinParts.srcDragPoint=null),this.skinParts.dstDragPoint&&(this.skinParts.dstDragPoint.empty(),this.skinParts.dstDragPoint.remove(),this.skinParts.dstDragPoint=null)},s.prototype.readOnlyMode=function(t){this._readOnly=t,t===!0&&this._setEditMode(!1)},s.prototype._setEditMode=function(t){this._readOnly===!1&&this._editMode!==t&&(this._editMode=t,this.setConnectionRenderData(this._pathPoints),this._editMode===!1&&this.hideEndReconnectors())},s.prototype._drawEditModePath=function(t){var e,n=t.length,i=this.segmentPoints.length,o=0,r=[],s=0;if(this._removeEditModePath(),this.editable===!0){for(e=0;n>e;e+=1)i>o&&this._isSamePoint(t[e],{x:this.segmentPoints[o][0],y:this.segmentPoints[o][1]})?(r.push([this.segmentPoints[o][0],this.segmentPoints[o][1],this.segmentPoints[o][2],this.segmentPoints[o][3]]),this._createEditSegment(r,s),o+=1,s+=1,r=[],r.push([this.segmentPoints[o-1][0],this.segmentPoints[o-1][1],this.segmentPoints[o-1][2],this.segmentPoints[o-1][3]])):r.push([t[e].x,t[e].y,0,0]);this._createEditSegment(r,s),this._showSegmentPoints()}},s.prototype._removeEditModePath=function(){this._hideSegmentPoints(),this._removeConnectionEditSegments()},s.prototype._isSamePoint=function(t,e){return t.x===e.x&&t.y===e.y},s.prototype._removeConnectionEditSegments=function(){for(var t=this._connectionEditSegments.length;t--;)this._connectionEditSegments[t].destroy();this._connectionEditSegments=[]},s.prototype._createEditSegment=function(t,e){var n;this.logger.debug("_createEditSegment: #"+e+", "+JSON.stringify(t)),n=new o({connection:this,id:e,points:t}),this._connectionEditSegments.push(n)},s.prototype.addSegmentPoint=function(t,e,n,i,o){var r=[e,n,i,o],s=this.segmentPoints.slice(0);s.splice(t,0,r),this.diagramDesigner.onConnectionSegmentPointsChange({connectionID:this.id,points:s})},s.prototype.removeSegmentPoint=function(t){var e=this.segmentPoints.slice(0);e.splice(t,1),this.diagramDesigner.onConnectionSegmentPointsChange({connectionID:this.id,points:e})},s.prototype.setSegmentPoint=function(t,e,n,i,o){var r=[e,n,i,o],s=this.segmentPoints.slice(0);s[t]=r,this.diagramDesigner.onConnectionSegmentPointsChange({connectionID:this.id,points:s})},s.prototype._showSegmentPoints=function(){var t,e=this.segmentPoints.length,n=e,i=this._pathPoints.length-1;for(this._hideSegmentPoints();n--;)t=new r({connection:this,id:n,point:this.segmentPoints[n],pointAfter:n===e-1?[this._pathPoints[i].x,this._pathPoints[i].y,0,0]:this.segmentPoints[n+1],pointBefore:0===n?[this._pathPoints[0].x,this._pathPoints[0].y,0,0]:this.segmentPoints[n-1]}),this._segmentPointMarkers.push(t)},s.prototype._hideSegmentPoints=function(){for(var t=this._segmentPointMarkers.length;t--;)this._segmentPointMarkers[t].destroy();this._segmentPointMarkers=[]},s.prototype.highlight=function(){var t=$(this.skinParts.path.node).attr("class").split(" ");-1===t.indexOf(n.ITEM_HIGHLIGHT_CLASS)&&(t.push(n.ITEM_HIGHLIGHT_CLASS),$(this.skinParts.path.node).attr("class",t.join(" "))),this.skinParts.textContainer&&this.skinParts.textContainer.addClass(n.ITEM_HIGHLIGHT_CLASS)},s.prototype.unHighlight=function(){var t=$(this.skinParts.path.node).attr("class").split(" "),e=t.indexOf(n.ITEM_HIGHLIGHT_CLASS);-1!==e&&(t.splice(e,1),$(this.skinParts.path.node).attr("class",t.join(" "))),this.skinParts.textContainer&&this.skinParts.textContainer.removeClass(n.ITEM_HIGHLIGHT_CLASS)},s.prototype.update=function(t){var e,n;this._initializeConnectionProps(t),this.skinParts.path&&this.skinParts.path.attr({"arrow-start":this.designerAttributes.arrowStart,"arrow-end":this.designerAttributes.arrowEnd,stroke:this.designerAttributes.color,"stroke-width":this.designerAttributes.width,"stroke-dasharray":this.designerAttributes.pattern}),this.skinParts.pathShadow&&(this._updatePathShadow(this._pathPoints),this.skinParts.pathShadow.attr({"stroke-width":this.designerAttributes.shadowWidth})),this.skinParts.pathShadowArrowStart&&(e=this.designerAttributes.arrowStart.replace("inheritance","block"),this.skinParts.pathShadowArrowStart.attr({"stroke-width":this.designerAttributes.shadowEndArrowWidth,"arrow-start":e})),this.skinParts.pathShadowArrowEnd&&(n=this.designerAttributes.arrowEnd.replace("inheritance","block"),this.skinParts.pathShadowArrowEnd.attr({"stroke-width":this.designerAttributes.shadowEndArrowWidth,"arrow-end":n})),this.skinParts.name&&this.skinParts.name.css({color:this.designerAttributes.color}),this.skinParts.srcText&&this.skinParts.srcText.css({color:this.designerAttributes.color}),this.skinParts.dstText&&this.skinParts.dstText.css({color:this.designerAttributes.color})},s.prototype.getConnectionAreas=function(){var t,e=[],n=0,i=0,o=0,r=0,s=0;return this.skinParts.path&&(t=this._getMidPoint(),this.positionX=0,this.positionY=0,0===t.alpha||180===t.alpha?(i=n,r=n/2):(90===t.alpha||270===t.alpha)&&(o=n,s=n/2),e.push({id:"0",x1:t.x-r,y1:t.y-s,x2:t.x-r+i,y2:t.y-s+o,angle1:0,angle2:360,len:0})),e},s.prototype.showSourceConnectors=function(){},s.prototype.hideSourceConnectors=function(){},s.prototype.showEndConnectors=function(){this._connectionConnector=this._connectionConnector||$("<div/>",{"class":"connector connection-connector"}),this._connectionConnector.attr(n.DATA_ITEM_ID,this.id),this.diagramDesigner.skinParts.$itemsContainer.append(this._connectionConnector);var t=this._getMidPoint();this._connectionConnector.css({left:t.x,top:t.y})},s.prototype.hideEndConnectors=function(){this._connectionConnector&&(this._connectionConnector.remove(),this._connectionConnector=void 0)},s.prototype._showConnectionAreaMarker=function(){var t=!1;if(this._hideConnectionAreaMarker(),this.diagramDesigner.connectionIDbyEndID.hasOwnProperty(this.id))for(var e in this.diagramDesigner.connectionIDbyEndID[this.id]){if(this.diagramDesigner.connectionIDbyEndID[this.id].hasOwnProperty(e))for(var n in this.diagramDesigner.connectionIDbyEndID[this.id][e])if(this.diagramDesigner.connectionIDbyEndID[this.id][e].hasOwnProperty(n)&&this.diagramDesigner.connectionIDbyEndID[this.id][e][n].length>0){t=!0;break}if(t)break}if(this.skinParts.path&&t){var i=this._getMidPoint();this._connectionAreaMarker=$("<div/>",{"class":"c-area"}),this.diagramDesigner.skinParts.$itemsContainer.append(this._connectionAreaMarker),this._connectionAreaMarker.css({top:i.y,left:i.x})}},s.prototype._hideConnectionAreaMarker=function(){this._connectionAreaMarker&&(this._connectionAreaMarker.remove(),this._connectionAreaMarker=void 0)},s.prototype._textContainer=$('<div class="c-t"></div>'),s.prototype._textNameBase=$('<div class="c-text"><span class="c-name"></span></div>'),s.prototype._textSrcBase=$('<div class="c-text"><span class="c-src"></span></div>'),s.prototype._textDstBase=$('<div class="c-text"><span class="c-dst"></span></div>'),s.prototype._getMidPoint=function(){function t(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}var e,n,i,o=0,r=[],s=0;if(this.isBezier)o=this.skinParts.path.getTotalLength(),n=this.skinParts.path.getPointAtLength(o/2);else{for(n={x:0,y:0,alpha:0},i=0;i<this._pathPoints.length-1;i+=1)o+=t(this._pathPoints[i],this._pathPoints[i+1]),r.push(o);for(s=o/2,i=0;i<r.length;i+=1)if(r[i]>=s){n.alpha=this._calculateSteep(this._pathPoints[i],this._pathPoints[i+1]),e=n.alpha*(Math.PI/180),i>0&&(s-=r[i-1]),n.x=this._pathPoints[i].x+s*Math.cos(e),n.y=this._pathPoints[i].y+s*Math.sin(e);break}}return n},s.prototype._renderTexts=function(){function t(){var t=i._getMidPoint();i.skinParts.name=i._textNameBase.clone(),i.skinParts.name.css({top:t.y-2+i.designerAttributes.width,left:t.x,color:i.designerAttributes.color}),i.skinParts.name.find("span").text(i.name),i.skinParts.textContainer.append(i.skinParts.name),$(i.diagramDesigner.skinParts.$itemsContainer.children()[0]).after(i.skinParts.textContainer),(t.alpha>=45&&t.alpha<=135||t.alpha>=225&&t.alpha<=315)&&i.skinParts.name.find("span").addClass("v"),i.skinParts.name.find("span").on("dblclick.editOnDblClick",null,function(t){i.nameEdit===!0&&i.diagramDesigner.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(t,e){i._onNameChanged(t,e)}}),t.stopPropagation(),t.preventDefault()})}function e(){var t=i._calculateSteep(i._pathPoints[0],i._pathPoints[1]);i.skinParts.srcText=i._textSrcBase.clone(),i.skinParts.srcText.find("span").text(i.srcText),i.skinParts.textContainer.append(i.skinParts.srcText),$(i.diagramDesigner.skinParts.$itemsContainer.children()[0]).after(i.skinParts.textContainer);var e=i.designerAttributes.width,n=i.designerAttributes.width;t>=0&&45>=t?(e=o,n*=-1):t>45&&90>=t?(e=o,n=o):t>90&&135>=t?(e=-1*i.skinParts.srcText.width()-o,n=o):t>135&&180>=t?e=-1*i.skinParts.srcText.width()-o:t>180&&225>=t?(e=-1*i.skinParts.srcText.width()-o,n*=-1):t>225&&270>=t?(e=-1*i.skinParts.srcText.width()-o,n=-4*o):t>270&&315>=t?(e=o,n=-4*o):t>315&&360>=t&&(n=-4*o,e=o),i.skinParts.srcText.css({top:i._pathPoints[0].y+n,left:i._pathPoints[0].x+e,color:i.designerAttributes.color}),i.skinParts.srcText.find("span").on("dblclick.editOnDblClick",null,function(t){i.srcTextEdit===!0&&i.diagramDesigner.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(t,e){i._onSrcTextChanged(t,e)}}),t.stopPropagation(),t.preventDefault()})}function n(){var t=i._pathPoints.length,e=i._calculateSteep(i._pathPoints[t-2],i._pathPoints[t-1]),n=i.designerAttributes.width,r=i.designerAttributes.width;i.skinParts.dstText=i._textDstBase.clone(),i.skinParts.dstText.find("span").text(i.dstText),i.skinParts.textContainer.append(i.skinParts.dstText),$(i.diagramDesigner.skinParts.$itemsContainer.children()[0]).after(i.skinParts.textContainer),0===e?(n=-1*i.skinParts.dstText.width()-o,r*=-1):e>0&&45>=e?(n=-1*i.skinParts.dstText.width()-o,r=-4*o):e>45&&90>=e?(n=-1*i.skinParts.dstText.width()-o,r=-4*o):e>90&&135>=e?(n=o,r=-4*o):e>135&&180>=e?(r=-4*o,n=o):e>180&&225>=e?(n=o,r=-4*o):e>225&&270>=e?(n=o,r*=-1):e>270&&315>=e?(r=o,n=-1*i.skinParts.dstText.width()-o):e>315&&360>=e&&(n=-1*i.skinParts.dstText.width()-o),i.skinParts.dstText.css({top:i._pathPoints[t-1].y+r,left:i._pathPoints[t-1].x+n,color:i.designerAttributes.color}),i.skinParts.dstText.find("span").on("dblclick.editOnDblClick",null,function(t){i.dstTextEdit===!0&&i.diagramDesigner.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(t,e){i._onDstTextChanged(t,e)}}),t.stopPropagation(),t.preventDefault()})}var i=this,o=5;this._hideTexts(),(this.name||this.srcText||this.dstText)&&(this.skinParts.textContainer=this._textContainer.clone(),this.skinParts.textContainer.attr("id",a+this.id),this.name&&t(),this.srcText&&e(),this.dstText&&n())},s.prototype._hideTexts=function(){this.skinParts.textContainer&&this.skinParts.textContainer.remove()},s.prototype._calculateSteep=function(t,e){var n=0,i=e.x-t.x,o=e.y-t.y;return 0===i&&0!==o?n=Math.PI/2*Math.abs(o)/o:(n=Math.atan(o/i),0>i&&(n+=Math.PI)),0>n&&(n+=2*Math.PI),n*=180/Math.PI},s.prototype._onNameChanged=function(t,e){this.diagramDesigner.onConnectionNameChanged(this.id,t,e)},s.prototype._onSrcTextChanged=function(t,e){this.diagramDesigner.onConnectionSrcTextChanged(this.id,t,e)},s.prototype._onDstTextChanged=function(t,e){this.diagramDesigner.onConnectionDstTextChanged(this.id,t,e)},s.prototype.updateTexts=function(t){this.srcText=t.srcText||this.srcText,this.dstText=t.dstText||this.dstText,this.name=t.name||this.name,this.nameEdit=t.nameEdit||this.nameEdit,this.srcTextEdit=t.srcTextEdit||this.srcTextEdit,this.dstTextEdit=t.dstTextEdit||this.dstTextEdit,this._renderTexts()},s.prototype._jumpOnCrossings=function(t){var e,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m,_,b,y,v,C=this.diagramDesigner.items,D={},I=[],P=[],T={};if(this.diagramDesigner._connectionJumpXing!==!0||this.isBezier===!0)return t;for(e=this.diagramDesigner.connectionIds.slice(0).sort(),n=e.indexOf(this.id),e.splice(n),i=e.length;i--;)if(o=C[e[i]],o.isBezier===!1&&(r=this._pathIntersect(o),r&&r.length>0))for(s=0;s<r.length;s+=1)a=r[s],D[a.segment1]=D[a.segment1]||[],D[a.segment1].push({xy:[a.x,a.y],t:a.t1,path:a.path1,length:a.segment1Length,otherWidth:o.designerAttributes.width}),-1===I.indexOf(a.segment1)&&I.push(a.segment1);for(I.sort(function(t,e){return t-e}),i=0;i<I.length;i+=1){for(f=I[i],l=D[f],s=0;s<l.length;s+=1)T[f]=T[f]||{t:[],paths:{},segmentLength:l[s].length,xings:{},sweepFlag:0},_=Math.max(this.designerAttributes.width,l[s].otherWidth)+E,c=l[s].length,d=_/c,g=l[s].t-d,0>g&&(g=0),h=this._getPointAtLength(l[s].path[0],l[s].path[1],l[s].path[2],l[s].path[3],g*c),g=l[s].t+d,g>1&&(g=1),p=this._getPointAtLength(l[s].path[0],l[s].path[1],l[s].path[2],l[s].path[3],g*c),v=l[s].path[3]-l[s].path[1],0!==v&&(v/=Math.abs(v)),y=l[s].path[2]-l[s].path[0],0!==y&&(y/=Math.abs(y)),b=y>0?1:0===y&&v>0?1:0,u="L"+h.x+","+h.y+"A"+_+","+_+" 0 0,"+b+" "+p.x+","+p.y,T[f].t.push(l[s].t),T[f].paths[l[s].t]=u,T[f].xings[l[s].t]={pointBefore:h,pointAfter:p,xRadius:_},T[f].sweepFlag=b;for(T[f].t.sort(function(t,e){return t-e}),c=T[f].segmentLength,b=T[f].sweepFlag,m=0;m<T[f].t.length-1;m+=1){var A=T[f].t[m],x=T[f].t[m+1],w=T[f].xings[A],N=T[f].xings[x];this._checkIntersect(w.pointBefore.x,w.pointBefore.y,w.pointAfter.x,w.pointAfter.y,N.pointBefore.x,N.pointBefore.y,N.pointAfter.x,N.pointAfter.y)&&(_=Math.max(w.xRadius,N.xRadius),u="L"+w.pointBefore.x+","+w.pointBefore.y+"A"+_+","+_+" 0 0,"+b+" "+N.pointAfter.x+","+N.pointAfter.y,T[f].paths[A]=u,T[f].xings[A]={pointBefore:w.pointBefore,pointAfter:N.pointAfter,xRadius:_},T[f].t.splice(m+1,1),m-=1)}}for(P.push(t[0]),i=t.length,s=1;i>s;s+=1){if(f=s.toString(),T.hasOwnProperty(f))for(T[f].t.sort(function(t,e){return t-e}),m=0;m<T[f].t.length;m+=1)P.push(T[f].paths[T[f].t[m]]);
P.push(t[s])}return P},s.prototype._pathIntersect=function(t){var n,i,o,r,s,a,l,c,d=this._pathPoints,h=t._pathPoints,p=d.length,g=h.length,u=[];if(e.overlap(this._pathPointsBBox,t._pathPointsBBox))for(o=0;p-1>o;o+=1)for(n={x1:d[o].x,y1:d[o].y,x2:d[o+1].x,y2:d[o+1].y},a=Math.sqrt((n.x2-n.x1)*(n.x2-n.x1)+(n.y2-n.y1)*(n.y2-n.y1)),r=0;g-1>r;r+=1)i={x1:h[r].x,y1:h[r].y,x2:h[r+1].x,y2:h[r+1].y},l=Math.sqrt((i.x2-i.x1)*(i.x2-i.x1)+(i.y2-i.y1)*(i.y2-i.y1)),s=this._getIntersect(n.x1,n.y1,n.x2,n.y2,i.x1,i.y1,i.x2,i.y2),s&&(s.segment1=o+1,s.segment2=r+1,s.segment1Length=a,s.segment2Length=l,s.path1=[n.x1,n.y1,n.x2,n.y2],s.path2=[i.x1,i.y1,i.x2,i.y2],c=Math.sqrt((s.x-n.x1)*(s.x-n.x1)+(s.y-n.y1)*(s.y-n.y1)),s.t1=c/a,c=Math.sqrt((s.x-i.x1)*(s.x-i.x1)+(s.y-i.y1)*(s.y-i.y1)),s.t2=c/l,u.push(s));return u},s.prototype._getIntersect=function(t,e,n,i,o,r,s,a){var l=Math.max,c=Math.min;if(!(l(t,n)<c(o,s)||c(t,n)>l(o,s)||l(e,i)<c(r,a)||c(e,i)>l(r,a))){var d=(t*i-e*n)*(o-s)-(t-n)*(o*a-r*s),h=(t*i-e*n)*(r-a)-(e-i)*(o*a-r*s),p=(t-n)*(r-a)-(e-i)*(o-s);if(p){var g=d/p,u=h/p,f=+g.toFixed(2),m=+u.toFixed(2);if(!(f<+c(t,n).toFixed(2)||f>+l(t,n).toFixed(2)||f<+c(o,s).toFixed(2)||f>+l(o,s).toFixed(2)||m<+c(e,i).toFixed(2)||m>+l(e,i).toFixed(2)||m<+c(r,a).toFixed(2)||m>+l(r,a).toFixed(2)))return{x:g,y:u}}}},s.prototype._checkIntersect=function(t,e,n,i,o,r,s,a){var l=Math.max,c=Math.min;if(!(l(t,n)<c(o,s)||c(t,n)>l(o,s)||l(e,i)<c(r,a)||c(e,i)>l(r,a)))return!0},s.prototype._getPointAtLength=function(t,e,n,i,o){var r=Math.sqrt((n-t)*(n-t)+(i-e)*(i-e)),s=(n-t)/r,a=(i-e)/r;return{x:t+s*o,y:e+a*o}},s.prototype._simplifyTrivially=function(t){for(var e,n,i,o,r,s,a,l,c,d=1;d<t.length-1;)e=t[d-1],n=t[d],i=t[d+1],o=n.x-e.x,s=n.y-e.y,l=0===o?s>0?Math.PI/2:Math.PI/2*3:Math.atan(s/o),r=i.x-n.x,a=i.y-n.y,c=0===r?a>0?Math.PI/2:Math.PI/2*3:Math.atan(a/r),l===c?t.splice(d,1):d+=1},s.prototype.setMetaInfo=function(t){this._metaInfo=t},s.prototype.getMetaInfo=function(){return this._metaInfo},s.prototype._getPathDefFromPoints=function(t){var e,n,i,o,r=[],s=this.segmentPoints,a=0,l=0,c=0,d=0,h=0;for(e=t[0],r.push("M"+e.x+","+e.y),o=t[0],i=t.length,n=1;i>n;n+=1)e=t[n],this.isBezier===!1?r.push("L"+e.x+","+e.y):(s.length>0&&s.length>a&&this._isSamePoint(e,{x:s[a][0],y:s[a][1]})?(d=s[a][2],h=s[a][3],a+=1):(d=0,h=0),r.push("C"+(o.x+l)+","+(o.y+c)+" "+(e.x-d)+","+(e.y-h)+" "+e.x+","+e.y),o=e,l=d,c=h);return r},s}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Connections",["js/Widgets/DiagramDesigner/Connection","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(t,e){"use strict";var n,i="connection-drawing";return n=function(){},n.prototype.createConnection=function(e){var n,i=this._getGuid("C_"),o=_.extend({},e),r=o.srcObjId,s=o.srcSubCompId,a=o.dstObjId,l=o.dstSubCompId;return this.logger.debug("Creating connection component with parameters: "+JSON.stringify(o)),o.designerCanvas=this,this.connectionIds.push(i),this._insertedConnectionIDs.push(i),this.connectionEndIDs[i]={srcObjId:r,srcSubCompId:s,dstObjId:a,dstSubCompId:l},this._saveConnectionIDbyEndID(i,r,s),this._saveConnectionIDbyEndID(i,a,l),n=this.items[i]=new t(i),n._initialize(o),n},n.prototype.updateConnection=function(t,e){var n=e.srcObjId,i=e.srcSubCompId,o=e.dstObjId,r=e.dstSubCompId;this.logger.debug('Updating connection component with ID: "'+t+'"'),this._updatedConnectionIDs.push(t),(n!==this.connectionEndIDs[t].srcObjId||i!==this.connectionEndIDs[t].srcSubCompId)&&(this._removeConnectionIDfromEnd(t,!0),this._saveConnectionIDbyEndID(t,n,i)),(o!==this.connectionEndIDs[t].dstObjId||r!==this.connectionEndIDs[t].dstSubCompId)&&(this._removeConnectionIDfromEnd(t,!1),this._saveConnectionIDbyEndID(t,o,r)),this.connectionEndIDs[t]={srcObjId:n,srcSubCompId:i,dstObjId:o,dstSubCompId:r},this.items[t].update(e)},n.prototype.updateConnectionTexts=function(t,e){this.logger.debug('Updating connection texts with ID: "'+t+'"'),this.items[t].updateTexts(e)},n.prototype.deleteConnection=function(t){var e;this.logger.debug('Deleting connection component with ID: "'+t+'"'),this._deletedConnectionIDs.push(t),this._removeConnectionIDfromEnd(t,!0),this._removeConnectionIDfromEnd(t,!1),delete this.connectionEndIDs[t],e=this.connectionIds.indexOf(t),this.connectionIds.splice(e,1),this.items[t].destroy(),delete this.items[t]},n.prototype._saveConnectionIDbyEndID=function(t,n,i){i=i||e.SELF,this.connectionIDbyEndID[n]=this.connectionIDbyEndID[n]||{},this.connectionIDbyEndID[n][i]=this.connectionIDbyEndID[n][i]||[],this.connectionIDbyEndID[n][i].push(t)},n.prototype._removeConnectionIDfromEnd=function(t,n){var i,o=n?this.connectionEndIDs[t].srcObjId:this.connectionEndIDs[t].dstObjId,r=n?this.connectionEndIDs[t].srcSubCompId:this.connectionEndIDs[t].dstSubCompId;r=r||e.SELF,i=this.connectionIDbyEndID[o][r].indexOf(t),-1!==i&&this.connectionIDbyEndID[o][r].splice(i,1)},n.prototype.onCreateNewConnection=function(t){this.logger.warn("onCreateNewConnection with parameters: "+JSON.stringify(t))},n.prototype._onModifyConnectionEnd=function(t){var n=_.extend({},this.connectionEndIDs[t.id]),i=_.extend({},this.connectionEndIDs[t.id]);this.logger.debug("Modifying connection with parameters: "+JSON.stringify(t)),t.endPoint===e.CONNECTION_END_SRC?(i.srcObjId=t.endId,i.srcSubCompId=t.endSubCompId):(i.dstObjId=t.endId,i.dstSubCompId=t.endSubCompId),_.isEqual(n,i)===!1&&this.onModifyConnectionEnd({id:t.id,old:n,"new":i})},n.prototype.onModifyConnectionEnd=function(t){this.logger.warn("onModifyConnectionEnd with parameters: "+JSON.stringify(t))},n.prototype._connectionDrawStartAddClass=function(){this.skinParts.$itemsContainer.addClass(i)},n.prototype._connectionDrawEndRemoveClass=function(){this.skinParts.$itemsContainer.removeClass(i)},n.prototype._onEndConnectionDraw=function(){var t;for(this._connectionDrawEndRemoveClass(),t=this.itemIds.length;t--;)this.items[this.itemIds[t]].hideEndConnectors();for(t=this.connectionIds.length;t--;)this.items[this.connectionIds[t]].hideEndConnectors()},n.prototype._onStartConnectionCreate=function(t){var e,n,i,o=t.srcId,r=t.srcSubCompId,s=[],a=this.items[o]._decoratorInstance?this.items[o]._decoratorInstance.getConnectorMetaInfo():void 0,l=r?this.items[o]._decoratorInstance.getConnectorMetaInfo(r):void 0;for(this.selectionManager.setSelection([]),this.items[o].hideSourceConnectors(),e=this.itemIds.length;e--;)s.push({dstItemID:this.itemIds[e],dstSubCompID:void 0});for(n in this._itemSubcomponentsMap)if(this._itemSubcomponentsMap.hasOwnProperty(n))for(e=this._itemSubcomponentsMap[n].length;e--;)s.push({dstItemID:n,dstSubCompID:this._itemSubcomponentsMap[n][e]});if(this._connectToConnection===!0)for(e=this.connectionIds.length;e--;)s.push({dstItemID:this.connectionIds[e],dstSubCompID:void 0});t.availableConnectionEnds=s,i=this.onFilterNewConnectionDroppableEnds(t)||[],this.logger.debug("_onStartConnectionCreate filteredDroppableEnds: "+JSON.stringify(i));for(var c=[],d=[];i.length>0;){e=i.length,n=i[0].dstItemID;var h=[];for(c=[];e--;)n===i[e].dstItemID&&(c.push(e),h.push(i[e].dstSubCompID));for(d.push([n,a,l,h]),c.sort(function(t,e){return t-e}),e=c.length;e--;)i.splice(c[e],1)}for(this.logger.debug("_onStartConnectionCreate decorator update package: "+JSON.stringify(d)),e=d.length;e--;)n=d[e][0],this.items[n].showEndConnectors({srcItemMetaInfo:d[e][1],srcSubCompMetaInfo:d[e][2],connectors:d[e][3]});this._connectionDrawStartAddClass()},n.prototype.onFilterNewConnectionDroppableEnds=function(t){return this.logger.warn("DiagramDesignerWidget.prototype.onFilterNewConnectionDroppableEnds not overridden in controller. params: "+JSON.stringify(t)),t.availableConnectionEnds},n.prototype._onStartConnectionReconnect=function(t){var n,i,o,r,s,a,l,c,d,h,p,g=t.connId,u=t.draggedEnd===e.CONNECTION_END_SRC,f=[],m=[];for(this.selectionManager.hideSelectionOutline(),u===!0?this.connectionEndIDs[g]&&(o=this.connectionEndIDs[g].dstObjId,r=this.connectionEndIDs[g].dstSubCompId,l=this.items[o]._decoratorInstance?this.items[o]._decoratorInstance.getConnectorMetaInfo():void 0,c=r?this.items[o]._decoratorInstance.getConnectorMetaInfo(r):void 0):this.connectionEndIDs[g]&&(n=this.connectionEndIDs[g].srcObjId,i=this.connectionEndIDs[g].srcSubCompId,s=this.items[n]._decoratorInstance?this.items[n]._decoratorInstance.getConnectorMetaInfo():void 0,a=i?this.items[n]._decoratorInstance.getConnectorMetaInfo(i):void 0),d=this.itemIds.length;d--;)u===!0?m.push({srcItemID:this.itemIds[d],srcSubCompID:void 0}):f.push({dstItemID:this.itemIds[d],dstSubCompID:void 0});for(h in this._itemSubcomponentsMap)if(this._itemSubcomponentsMap.hasOwnProperty(h))for(d=this._itemSubcomponentsMap[h].length;d--;)u===!0?m.push({srcItemID:h,srcSubCompID:this._itemSubcomponentsMap[h][d]}):f.push({dstItemID:h,dstSubCompID:this._itemSubcomponentsMap[h][d]});t.availableConnectionEnds=f,t.availableConnectionSources=m,t.srcItemID=n,t.srcSubCompID=i,t.dstItemID=o,t.dstSubCompID=r,p=this.onFilterReconnectionDroppableEnds(t)||[],this.logger.debug("_onStartConnectionReconnect filteredResult:"+JSON.stringify(p));for(var _=[],b=[],y=u?"src":"dst";p.length>0;){d=p.length,h=p[0][y+"ItemID"];var v=[];for(_=[];d--;)h===p[d][y+"ItemID"]&&(_.push(d),v.push(p[d][y+"SubCompID"]));for(b.push([h,u?s:l,u?a:c,v]),_.sort(function(t,e){return t-e}),d=_.length;d--;)p.splice(_[d],1)}for(this.logger.debug("_onStartConnectionReconnect decorator update package: "+JSON.stringify(b)),d=b.length;d--;)h=b[d][0],u?this.items[h].showSourceConnectors({dstItemMetaInfo:b[d][1],dstSubCompMetaInfo:b[d][2],connectors:b[d][3]}):this.items[h].showEndConnectors({srcItemMetaInfo:b[d][1],srcSubCompMetaInfo:b[d][2],connectors:b[d][3]});this._connectionDrawStartAddClass()},n.prototype.onFilterReconnectionDroppableEnds=function(t){var n=t.draggedEnd===e.CONNECTION_END_SRC;return this.logger.warn("DiagramDesignerWidget.prototype.onFilterReconnectionDroppableEnds not overridden in controller. params: "+JSON.stringify(t)),n===!0?t.availableConnectionSources:t.availableConnectionEnds},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Subcomponents",[],function(){"use strict";var t;return t=function(){},t.prototype.registerSubcomponent=function(t,e,n){this._itemSubcomponentsMap[t]=this._itemSubcomponentsMap[t]||[],this._itemSubcomponentsMap[t].push(e),_.isFunction(this.onRegisterSubcomponent)&&this.onRegisterSubcomponent(t,e,n)},t.prototype.unregisterSubcomponent=function(t,e){var n;this.dispatchEvent(this.events.ON_UNREGISTER_SUBCOMPONENT,{objectID:t,subComponentID:e}),n=this._itemSubcomponentsMap[t].indexOf(e),-1!==n&&this._itemSubcomponentsMap[t].splice(n,1),_.isFunction(this.onUnregisterSubcomponent)&&this.onUnregisterSubcomponent(t,e)},t.prototype.unregisterAllSubcomponents=function(t){var e;if(this._itemSubcomponentsMap[t]){for(e=this._itemSubcomponentsMap[t].length;e--;)this.unregisterSubcomponent(t,this._itemSubcomponentsMap[t][e]);delete this._itemSubcomponentsMap[t]}},t}),define("js/Widgets/DiagramDesigner/ConnectionRouteManagerBasic",["js/logger"],function(t){"use strict";var e,n="_x_";return e=function(e){var n=e&&e.loggerName||"gme:Widgets:DiagramDesigner:ConnectionRouteManagerBasic";if(this.logger=e&&e.logger||t.create(n,WebGMEGlobal.gmeConfig.client.log),this.diagramDesigner=e?e.diagramDesigner:null,void 0===this.diagramDesigner||null===this.diagramDesigner)throw this.logger.error("Trying to initialize a ConnectionRouteManagerBasic without a canvas..."),"ConnectionRouteManagerBasic can not be created";this.logger.debug("ConnectionRouteManagerBasic ctor finished")},e.prototype.initialize=function(){},e.prototype.destroy=function(){},e.prototype.redrawConnections=function(t){var e;for(this.logger.debug("Redraw connection request: "+t.length),t=this.diagramDesigner.connectionIds.slice(0),this._updateEndpointInfo(t),e=0;e<t.length;e+=1)this._updateConnectionCoordinates(t[e]);return t},e.prototype._updateEndpointInfo=function(t){var e,n,i,o,r,s,a=t.length,l=this.diagramDesigner;for(this.endpointConnectionAreaInfo={};a--;)e=t[a],n=l.connectionEndIDs[e].srcObjId,i=l.connectionEndIDs[e].srcSubCompId,o=l.connectionEndIDs[e].dstObjId,r=l.connectionEndIDs[e].dstSubCompId,s=l.items[e].getMetaInfo(),this._getEndpointConnectionAreas(n,i,!1,s),this._getEndpointConnectionAreas(o,r,!0,s)},e.prototype._getEndpointConnectionAreas=function(t,e,i,o){var r,s,a,l=e?t+n+e:t,c=this.diagramDesigner;if(this.endpointConnectionAreaInfo.hasOwnProperty(l)===!1&&(this.endpointConnectionAreaInfo[l]=[],void 0===e||void 0!==e&&this.diagramDesigner._itemSubcomponentsMap[t]&&-1!==this.diagramDesigner._itemSubcomponentsMap[t].indexOf(e)))for(a=c.items[t],r=a.getConnectionAreas(e,i,o)||[],s=r.length;s--;)this.endpointConnectionAreaInfo[l].push({x:r[s].x1+(r[s].x2-r[s].x1)/2,y:r[s].y1+(r[s].y2-r[s].y1)/2})},e.prototype._updateConnectionCoordinates=function(t){var e,i,o,r=this.diagramDesigner,s=r.connectionEndIDs[t].srcObjId,a=r.connectionEndIDs[t].srcSubCompId,l=r.connectionEndIDs[t].dstObjId,c=r.connectionEndIDs[t].dstSubCompId,d=a?s+n+a:s,h=c?l+n+c:l,p=r.items[t].segmentPoints,g=this.endpointConnectionAreaInfo[d]||[],u=this.endpointConnectionAreaInfo[h]||[],f=null,m=null,_=[];if(g.length>0&&u.length>0){if(s===l&&a===c?(f=g[0],m=u.length>1?u[1]:u[0]):(e=this._getClosestPoints(g,u,p),f=g[e[0]],m=u[e[1]]),_.push(f),p&&p.length>0)for(i=p.length,o=0;i>o;o+=1)_.push({x:p[o][0],y:p[o][1]});else s===l&&a===c&&(_.push({x:f.x+100,y:f.y-100}),_.push({x:f.x+200,y:f.y}),_.push({x:f.x+100,y:f.y+100}));_.push(m)}r.items[t].setConnectionRenderData(_)},e.prototype._getClosestPoints=function(t,e,n){var i,o,r,s,a,l,c,d=-1;if(n&&n.length>0)for(i=0;i<t.length;i+=1)for(o=0;o<e.length;o+=1)r={src:Math.abs(t[i].x-n[0][1]),tgt:Math.abs(e[o].x-n[n.length-1][0])},s={src:Math.abs(t[i].y-n[0][1]),tgt:Math.abs(e[o].y-n[n.length-1][1])},c=Math.sqrt(r.src*r.src+s.src*s.src)+Math.sqrt(r.tgt*r.tgt+s.tgt*s.tgt),(-1===d||d>c)&&(d=c,a=i,l=o);else for(i=0;i<t.length;i+=1)for(o=0;o<e.length;o+=1)r=Math.abs(t[i].x-e[o].x),s=Math.abs(t[i].y-e[o].y),c=Math.sqrt(r*r+s*s),(-1===d||d>c)&&(d=c,a=i,l=o);return[a,l]},e}),define("js/Widgets/DiagramDesigner/ConnectionRouteManager2",["js/logger"],function(t){"use strict";var e,n="_x_";return e=function(e){var n=e&&e.loggerName||"gme:Widgets:DiagramDesigner:ConnectionRouteManager2";if(this.logger=e&&e.logger||t.create(n,WebGMEGlobal.gmeConfig.client.log),this.diagramDesigner=e?e.diagramDesigner:null,void 0===this.diagramDesigner||null===this.diagramDesigner)throw this.logger.error("Trying to initialize a ConnectionRouteManagerBasic without a canvas..."),"ConnectionRouteManagerBasic can not be created";this.logger.debug("ConnectionRouteManagerBasic ctor finished")},e.prototype.initialize=function(){},e.prototype.destroy=function(){},e.prototype.redrawConnections=function(t){var e,n,i;for(this.logger.debug("Redraw connection request: "+t.length),e=this.diagramDesigner.connectionIds.slice(0);e.length>0;){for(this.endpointConnectionAreaInfo={},this.endpointConnectionAreaConnectionInfo={},this.connectionEndPoints={},i=this._updateEndpointInfo(e),n=e.length;n--;)this._calculateClosestEndpoints(e[n]);for(n=0;n<e.length;n+=1)this._updateConnectionCoordinates(e[n]);e=i}return e=this.diagramDesigner.connectionIds.slice(0)},e.prototype._updateEndpointInfo=function(t){for(var e,n,i,o,r,s,a=t.length,l=this.diagramDesigner,c=[];a--;)e=t[a],n=l.connectionEndIDs[e].srcObjId,i=l.connectionEndIDs[e].srcSubCompId,o=l.connectionEndIDs[e].dstObjId,r=l.connectionEndIDs[e].dstSubCompId,s=l.items[e].getMetaInfo(),this._getEndpointConnectionAreas(e,n,i,!1,s)||-1!==l.connectionIds.indexOf(n)&&c.push(e),this._getEndpointConnectionAreas(e,o,r,!0,s)||-1!==l.connectionIds.indexOf(o)&&c.push(e);return c},e.prototype._getEndPointID=function(t,e,i){var o="";return t&&(o+=t+n),o+=e,i&&(o+=n+i),o},e.prototype._getEndpointConnectionAreas=function(t,e,n,i,o){var r,s,a=this._getEndPointID(t,e,n),l=this._getEndPointID(void 0,e,n),c=[],d=this.diagramDesigner;if(this.endpointConnectionAreaInfo[a]=this.endpointConnectionAreaInfo[a]||[],this.endpointConnectionAreaConnectionInfo[l]=this.endpointConnectionAreaConnectionInfo[l]||{},void 0===n||void 0!==n&&this.diagramDesigner._itemSubcomponentsMap[e]&&-1!==this.diagramDesigner._itemSubcomponentsMap[e].indexOf(n))for(s=d.items[e],c=s.getConnectionAreas(n,i,o)||[],r=c.length;r--;)this.endpointConnectionAreaInfo[a][c[r].id]={x:c[r].x1,y:c[r].y1,angle1:c[r].angle1,angle2:c[r].angle2,len:c[r].len||10,id:c[r].id,w:c[r].x2-c[r].x1,h:c[r].y2-c[r].y1},this.endpointConnectionAreaConnectionInfo[l].hasOwnProperty(c[r].id)||(this.endpointConnectionAreaConnectionInfo[l][c[r].id]=0);return c.length>0},e.prototype._calculateClosestEndpoints=function(t){var e,n,i,o,r=this.diagramDesigner,s=r.connectionEndIDs[t].srcObjId,a=r.connectionEndIDs[t].srcSubCompId,l=r.connectionEndIDs[t].dstObjId,c=r.connectionEndIDs[t].dstSubCompId,d=this._getEndPointID(t,s,a),h=this._getEndPointID(t,l,c),p=this._getEndPointID(void 0,s,a),g=this._getEndPointID(void 0,l,c),u=r.items[t].segmentPoints,f=[],m=[],_=null,b=null;for(n in this.endpointConnectionAreaInfo[d])this.endpointConnectionAreaInfo[d].hasOwnProperty(n)&&(i=this.endpointConnectionAreaInfo[d][n],o={x:i.x+i.w/2,y:i.y+i.h/2,id:i.id},f.push(o));for(n in this.endpointConnectionAreaInfo[h])this.endpointConnectionAreaInfo[h].hasOwnProperty(n)&&(i=this.endpointConnectionAreaInfo[h][n],o={x:i.x+i.w/2,y:i.y+i.h/2,id:i.id},m.push(o));f.length>0&&m.length>0&&(s===l&&a===c?(_=f[0],b=m.length>1?m[1]:m[0]):(e=this._getClosestPoints(f,m,u),_=f[e[0]],b=m[e[1]]),this.endpointConnectionAreaConnectionInfo[p][_.id]+=1,this.endpointConnectionAreaConnectionInfo[g][b.id]+=1,this.connectionEndPoints[t]={source:[d,_.id,this.endpointConnectionAreaConnectionInfo[p][_.id]],target:[h,b.id,this.endpointConnectionAreaConnectionInfo[g][b.id]]})},e.prototype._updateConnectionCoordinates=function(t){var e,n,i,o,r,s,a,l,c,d,h,p=this.diagramDesigner,g=p.connectionEndIDs[t].srcObjId,u=p.connectionEndIDs[t].srcSubCompId,f=p.connectionEndIDs[t].dstObjId,m=p.connectionEndIDs[t].dstSubCompId,_=this._getEndPointID(void 0,g,u),b=this._getEndPointID(void 0,f,m),y=p.items[t].segmentPoints,v=this.connectionEndPoints[t]?this.connectionEndPoints[t].source:void 0,C=this.connectionEndPoints[t]?this.connectionEndPoints[t].target:void 0,E=null,D=null,I=[],P=0;if(v&&C){if(E=this.endpointConnectionAreaInfo[v[0]][v[1]],D=this.endpointConnectionAreaInfo[C[0]][C[1]],a=E.w/(this.endpointConnectionAreaConnectionInfo[_][E.id]+1),l=E.h/(this.endpointConnectionAreaConnectionInfo[_][E.id]+1),I.push({x:E.x+a*v[2],y:E.y+l*v[2]}),0!==E.len&&(s=this._getConnectorDelta(E,this.endpointConnectionAreaConnectionInfo[_][E.id]+1,v[2]),I.push({x:E.x+a*v[2]+s.dx+s.dx*P*(v[2]-1),y:E.y+l*v[2]+s.dy+s.dy*P*(v[2]-1)})),y&&y.length>0)for(i=y.length,n=0;i>n;n+=1)I.push({x:y[n][0],y:y[n][1]});a=D.w/(this.endpointConnectionAreaConnectionInfo[b][D.id]+1),l=D.h/(this.endpointConnectionAreaConnectionInfo[b][D.id]+1),0!==D.len&&(s=this._getConnectorDelta(D,this.endpointConnectionAreaConnectionInfo[b][D.id]+1,C[2]),I.push({x:D.x+a*C[2]+s.dx+s.dx*P*(C[2]-1),y:D.y+l*C[2]+s.dy+s.dy*P*(C[2]-1)})),I.push({x:D.x+a*C[2],y:D.y+l*C[2]})}for(i=I.length;i-->1;)I[i].x===I[i-1].x&&I[i].y===I[i-1].y&&I.splice(i,1);if(0===y.length)if(g===f&&u===m){var T=I.length-1;I[0].x===I[T].x?I[0].y===I[T].y?E.angle1>=0&&E.angle2<90?I.splice(2,0,{x:I[1].x+20,y:I[1].y-20},{x:I[1].x+40,y:I[1].y},{x:I[1].x+20,y:I[1].y+20},{x:I[1].x,y:I[1].y}):E.angle1>=90&&E.angle2<180?I.splice(2,0,{x:I[1].x+20,y:I[1].y+20},{x:I[1].x,y:I[1].y+40},{x:I[1].x-20,y:I[1].y+20},{x:I[1].x,y:I[1].y}):E.angle1>=180&&E.angle2<270?I.splice(2,0,{x:I[1].x-20,y:I[1].y-20},{x:I[1].x-40,y:I[1].y},{x:I[1].x-20,y:I[1].y+20},{x:I[1].x,y:I[1].y}):E.angle1>=270&&E.angle2<360&&I.splice(2,0,{x:I[1].x-20,y:I[1].y-20},{x:I[1].x,y:I[1].y-40},{x:I[1].x+20,y:I[1].y-20},{x:I[1].x,y:I[1].y}):(h=p.items[g].getBoundingBox(),I.splice(2,0,{x:I[1].x+h.width/2+20,y:I[1].y},{x:I[2].x+h.width/2+20,y:I[2].y})):I[0].y===I[T].y?(h=p.items[g].getBoundingBox(),I.splice(2,0,{x:I[1].x,y:I[1].y+h.height/2+20},{x:I[2].x,y:I[2].y+h.height/2+20})):I.splice(2,0,{x:I[2].x,y:I[1].y})}else if(e=I.slice(0),i=e.length,I=[],i>0){for(c=e[0],I.push(c),c=e[1],I.push(c),n=2;i-1>n;n+=1)c=e[n-1],d=e[n],o=d.x-c.x,r=d.y-c.y,0!==o&&0!==r&&(I.push({x:c.x,y:c.y+r/2}),I.push({x:c.x+o,y:c.y+r/2})),I.push(d);c=e[i-2],I.push(c),c=e[i-1],I.push(c)}p.items[t].setConnectionRenderData(I)},e.prototype._getConnectorDelta=function(t,e,n){var i=0,o=0,r=(t.angle1+(t.angle2-t.angle1)/e*n)*(Math.PI/180),s={dx:i,dy:o};if(0!==t.len){var a=Math.sin(r),l=Math.cos(r),c=t.len,d=0,h=c*l-d*a,p=c*a+d*l;s.dx=h,s.dy=p}return s},e.prototype._getClosestPoints=function(t,e,n){var i,o,r,s,a,l,c,d=-1;if(n&&n.length>0)for(i=0;i<t.length;i+=1)for(o=0;o<e.length;o+=1)r={src:Math.abs(t[i].x-n[0][0]),tgt:Math.abs(e[o].x-n[n.length-1][0])},s={src:Math.abs(t[i].y-n[0][1]),tgt:Math.abs(e[o].y-n[n.length-1][1])},c=Math.sqrt(r.src*r.src+s.src*s.src)+Math.sqrt(r.tgt*r.tgt+s.tgt*s.tgt),(-1===d||d>c)&&(d=c,a=i,l=o);else for(i=0;i<t.length;i+=1)for(o=0;o<e.length;o+=1)r=Math.abs(t[i].x-e[o].x),s=Math.abs(t[i].y-e[o].y),c=Math.sqrt(r*r+s*s),(-1===d||d>c)&&(d=c,a=i,l=o);return[a,l]},e}),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("AutoRouterActionApplier",[],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.AutoRouterActionApplier=t()}}(function(){return function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};e[s][0].call(d.exports,function(t){var n=e[s][1][t];return o(n?n:t)},d,d.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){function i(t,e){return g.isUndefined(e)?""+e:g.isNumber(e)&&!isFinite(e)?e.toString():g.isFunction(e)||g.isRegExp(e)?e.toString():e}function o(t,e){return g.isString(t)?t.length<e?t:t.slice(0,e):t}function r(t){return o(JSON.stringify(t.actual,i),128)+" "+t.operator+" "+o(JSON.stringify(t.expected,i),128)}function s(t,e,n,i,o){throw new m.AssertionError({message:n,actual:t,expected:e,operator:i,stackStartFunction:o})}function a(t,e){t||s(t,!0,e,"==",m.ok)}function l(t,e){if(t===e)return!0;if(g.isBuffer(t)&&g.isBuffer(e)){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return g.isDate(t)&&g.isDate(e)?t.getTime()===e.getTime():g.isRegExp(t)&&g.isRegExp(e)?t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase:g.isObject(t)||g.isObject(e)?d(t,e):t==e}function c(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function d(t,e){if(g.isNullOrUndefined(t)||g.isNullOrUndefined(e))return!1;if(t.prototype!==e.prototype)return!1;if(g.isPrimitive(t)||g.isPrimitive(e))return t===e;var n=c(t),i=c(e);if(n&&!i||!n&&i)return!1;if(n)return t=u.call(t),e=u.call(e),l(t,e);var o,r,s=_(t),a=_(e);if(s.length!=a.length)return!1;for(s.sort(),a.sort(),r=s.length-1;r>=0;r--)if(s[r]!=a[r])return!1;for(r=s.length-1;r>=0;r--)if(o=s[r],!l(t[o],e[o]))return!1;return!0}function h(t,e){return t&&e?"[object RegExp]"==Object.prototype.toString.call(e)?e.test(t):t instanceof e?!0:e.call({},t)===!0?!0:!1:!1}function p(t,e,n,i){var o;g.isString(n)&&(i=n,n=null);try{e()}catch(r){o=r}if(i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),t&&!o&&s(o,n,"Missing expected exception"+i),!t&&h(o,n)&&s(o,n,"Got unwanted exception"+i),t&&o&&n&&!h(o,n)||!t&&o)throw o}var g=t("util/"),u=Array.prototype.slice,f=Object.prototype.hasOwnProperty,m=e.exports=a;m.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=r(this),this.generatedMessage=!0);var e=t.stackStartFunction||s;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var n=new Error;if(n.stack){var i=n.stack,o=e.name,a=i.indexOf("\n"+o);if(a>=0){var l=i.indexOf("\n",a+1);i=i.substring(l+1)}this.stack=i}}},g.inherits(m.AssertionError,Error),m.fail=s,m.ok=a,m.equal=function(t,e,n){t!=e&&s(t,e,n,"==",m.equal)},m.notEqual=function(t,e,n){t==e&&s(t,e,n,"!=",m.notEqual)},m.deepEqual=function(t,e,n){l(t,e)||s(t,e,n,"deepEqual",m.deepEqual)},m.notDeepEqual=function(t,e,n){l(t,e)&&s(t,e,n,"notDeepEqual",m.notDeepEqual)},m.strictEqual=function(t,e,n){t!==e&&s(t,e,n,"===",m.strictEqual)},m.notStrictEqual=function(t,e,n){t===e&&s(t,e,n,"!==",m.notStrictEqual)},m["throws"]=function(t,e,n){p.apply(this,[!0].concat(u.call(arguments)))},m.doesNotThrow=function(t,e){p.apply(this,[!1].concat(u.call(arguments)))},m.ifError=function(t){if(t)throw t};var _=Object.keys||function(t){var e=[];for(var n in t)f.call(t,n)&&e.push(n);return e}},{"util/":5}],2:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],3:[function(t,e,n){function i(){d=!1,a.length?c=a.concat(c):h=-1,c.length&&o()}function o(){if(!d){var t=setTimeout(i);d=!0;for(var e=c.length;e;){for(a=c,c=[];++h<e;)a&&a[h].run();h=-1,e=c.length}a=null,d=!1,clearTimeout(t)}}function r(t,e){this.fun=t,this.array=e}function s(){}var a,l=e.exports={},c=[],d=!1,h=-1;l.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new r(t,e)),1!==c.length||d||setTimeout(o,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=s,l.addListener=s,l.once=s,l.off=s,l.removeListener=s,l.removeAllListeners=s,l.emit=s,l.binding=function(t){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(t){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],4:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],5:[function(t,e,n){(function(e,i){function o(t,e){var i={seen:[],stylize:s};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),f(e)?i.showHidden=e:e&&n._extend(i,e),C(i.showHidden)&&(i.showHidden=!1),C(i.depth)&&(i.depth=2),C(i.colors)&&(i.colors=!1),C(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=r),l(i,t,i.depth)}function r(t,e){var n=o.styles[e];return n?"["+o.colors[n][0]+"m"+t+"["+o.colors[n][1]+"m":t}function s(t,e){return t}function a(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}function l(t,e,i){if(t.customInspect&&e&&T(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var o=e.inspect(i,t);return y(o)||(o=l(t,o,i)),o}var r=c(t,e);if(r)return r;var s=Object.keys(e),f=a(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(e)),P(e)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(e);if(0===s.length){if(T(e)){var m=e.name?": "+e.name:"";return t.stylize("[Function"+m+"]","special")}if(E(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(I(e))return t.stylize(Date.prototype.toString.call(e),"date");if(P(e))return d(e)}var _="",b=!1,v=["{","}"];if(u(e)&&(b=!0,v=["[","]"]),T(e)){var C=e.name?": "+e.name:"";_=" [Function"+C+"]"}if(E(e)&&(_=" "+RegExp.prototype.toString.call(e)),I(e)&&(_=" "+Date.prototype.toUTCString.call(e)),P(e)&&(_=" "+d(e)),0===s.length&&(!b||0==e.length))return v[0]+_+v[1];if(0>i)return E(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var D;return D=b?h(t,e,i,f,s):s.map(function(n){return p(t,e,i,f,n,b)}),t.seen.pop(),g(D,_,v)}function c(t,e){if(C(e))return t.stylize("undefined","undefined");if(y(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return b(e)?t.stylize(""+e,"number"):f(e)?t.stylize(""+e,"boolean"):m(e)?t.stylize("null","null"):void 0}function d(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,e,n,i,o){for(var r=[],s=0,a=e.length;a>s;++s)O(e,String(s))?r.push(p(t,e,n,i,String(s),!0)):r.push("");return o.forEach(function(o){o.match(/^\d+$/)||r.push(p(t,e,n,i,o,!0))}),r}function p(t,e,n,i,o,r){var s,a,c;if(c=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]},c.get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),O(i,o)||(s="["+o+"]"),a||(t.seen.indexOf(c.value)<0?(a=m(n)?l(t,c.value,null):l(t,c.value,n-1),a.indexOf("\n")>-1&&(a=r?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n"))):a=t.stylize("[Circular]","special")),C(s)){if(r&&o.match(/^\d+$/))return a;s=JSON.stringify(""+o),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function g(t,e,n){var i=0,o=t.reduce(function(t,e){return i++,e.indexOf("\n")>=0&&i++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function u(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function m(t){return null===t}function _(t){return null==t}function b(t){return"number"==typeof t}function y(t){return"string"==typeof t}function v(t){return"symbol"==typeof t}function C(t){return void 0===t}function E(t){return D(t)&&"[object RegExp]"===x(t)}function D(t){return"object"==typeof t&&null!==t}function I(t){return D(t)&&"[object Date]"===x(t)}function P(t){return D(t)&&("[object Error]"===x(t)||t instanceof Error)}function T(t){return"function"==typeof t}function A(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function x(t){return Object.prototype.toString.call(t)}function w(t){return 10>t?"0"+t.toString(10):t.toString(10)}function N(){var t=new Date,e=[w(t.getHours()),w(t.getMinutes()),w(t.getSeconds())].join(":");return[t.getDate(),L[t.getMonth()],e].join(" ")}function O(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var S=/%[sdj%]/g;n.format=function(t){if(!y(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(o(arguments[n]));return e.join(" ")}for(var n=1,i=arguments,r=i.length,s=String(t).replace(S,function(t){if("%%"===t)return"%";if(n>=r)return t;switch(t){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return t}}),a=i[n];r>n;a=i[++n])s+=m(a)||!D(a)?" "+a:" "+o(a);return s},n.deprecate=function(t,o){function r(){if(!s){if(e.throwDeprecation)throw new Error(o);e.traceDeprecation?console.trace(o):console.error(o),s=!0}return t.apply(this,arguments)}if(C(i.process))return function(){return n.deprecate(t,o).apply(this,arguments)};if(e.noDeprecation===!0)return t;var s=!1;return r};var R,M={};n.debuglog=function(t){if(C(R)&&(R=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!M[t])if(new RegExp("\\b"+t+"\\b","i").test(R)){var i=e.pid;M[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,i,e)}}else M[t]=function(){};return M[t]},n.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey",
"null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=u,n.isBoolean=f,n.isNull=m,n.isNullOrUndefined=_,n.isNumber=b,n.isString=y,n.isSymbol=v,n.isUndefined=C,n.isRegExp=E,n.isObject=D,n.isDate=I,n.isError=P,n.isFunction=T,n.isPrimitive=A,n.isBuffer=t("./support/isBuffer");var L=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",N(),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!D(e))return t;for(var n=Object.keys(e),i=n.length;i--;)t[n[i]]=e[n[i]];return t}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":4,_process:3,inherits:2}],6:[function(t,e,n){function i(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var t=arguments,e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+n.humanize(this.diff),!e)return t;var i="color: "+this.color;t=[t[0],i,"color: inherit"].concat(Array.prototype.slice.call(t,1));var o=0,r=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(r=o))}),t.splice(r,0,i),t}function r(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(t){try{null==t?n.storage.removeItem("debug"):n.storage.debug=t}catch(e){}}function a(){var t;try{t=n.storage.debug}catch(e){}return t}function l(){try{return window.localStorage}catch(t){}}n=e.exports=t("./debug"),n.log=r,n.formatArgs=o,n.save=s,n.load=a,n.useColors=i,n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:l(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(t){return JSON.stringify(t)},n.enable(a())},{"./debug":7}],7:[function(t,e,n){function i(){return n.colors[d++%n.colors.length]}function o(t){function e(){}function o(){var t=o,e=+new Date,r=e-(c||e);t.diff=r,t.prev=c,t.curr=e,c=e,null==t.useColors&&(t.useColors=n.useColors()),null==t.color&&t.useColors&&(t.color=i());var s=Array.prototype.slice.call(arguments);s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(e,i){if("%%"===e)return e;a++;var o=n.formatters[i];if("function"==typeof o){var r=s[a];e=o.call(t,r),s.splice(a,1),a--}return e}),"function"==typeof n.formatArgs&&(s=n.formatArgs.apply(t,s));var l=o.log||n.log||console.log.bind(console);l.apply(t,s)}e.enabled=!1,o.enabled=!0;var r=n.enabled(t)?o:e;return r.namespace=t,r}function r(t){n.save(t);for(var e=(t||"").split(/[\s,]+/),i=e.length,o=0;i>o;o++)e[o]&&(t=e[o].replace(/\*/g,".*?"),"-"===t[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")))}function s(){n.enable("")}function a(t){var e,i;for(e=0,i=n.skips.length;i>e;e++)if(n.skips[e].test(t))return!1;for(e=0,i=n.names.length;i>e;e++)if(n.names[e].test(t))return!0;return!1}function l(t){return t instanceof Error?t.stack||t.message:t}n=e.exports=o,n.coerce=l,n.disable=s,n.enable=r,n.enabled=a,n.humanize=t("ms"),n.names=[],n.skips=[],n.formatters={};var c,d=0},{ms:8}],8:[function(t,e,n){function i(t){if(t=""+t,!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),i=(e[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return n*h;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*l;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function o(t){return t>=d?Math.round(t/d)+"d":t>=c?Math.round(t/c)+"h":t>=l?Math.round(t/l)+"m":t>=a?Math.round(t/a)+"s":t+"ms"}function r(t){return s(t,d,"day")||s(t,c,"hour")||s(t,l,"minute")||s(t,a,"second")||t+" ms"}function s(t,e,n){return e>t?void 0:1.5*e>t?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var a=1e3,l=60*a,c=60*l,d=24*c,h=365.25*d;e.exports=function(t,e){return e=e||{},"string"==typeof t?i(t):e["long"]?r(t):o(t)}},{}],9:[function(t,e,n){var i=t("./AutoRouter"),o=t("./AutoRouter.Utils").assert,r=function(){};r.AutoRouter=i,r.prototype.init=function(){this._portSeparator=this._portSeparator||"_x_",this.autorouter=new i,this.debugActionSequence="[",this._clearRecords()},r.prototype._clearRecords=function(){this._autorouterBoxes={},this._autorouterPorts={},this._autorouterPaths={},this._arPathId2Original={}},r.prototype._lookupItem=function(t,e,n){for(var i,o,r=2;r<arguments.length;r++)i=arguments[r],o=e[i],e[i]=t[o]},r.prototype._fixArgs=function(t,e){var n;switch(t){case"move":this._lookupItem(this._autorouterBoxes,e,0),e[0]=e[0].box;break;case"getPathPoints":this._lookupItem(this._autorouterPaths,e,0);break;case"setPathCustomPoints":n=e[0].path,e[0].path=this._autorouterPaths[n];break;case"setBoxRect":this._lookupItem(this._autorouterBoxes,e,0);break;case"getBoxRect":this._lookupItem(this._autorouterBoxes,e,0),e[0]=e[0].box.id;break;case"updatePort":this._lookupItem(this._autorouterBoxes,e,0);break;case"setComponent":this._lookupItem(this._autorouterBoxes,e,0,1);break;case"addPath":this._fixPortArgs(e[0].src,e[0].dst),e.pop();break;case"remove":var i;n=e[0],this._autorouterBoxes[n]?i=this._autorouterBoxes[n]:this._autorouterPaths[n]&&(i=this._autorouterPaths[n]),e[0]=i;break;case"addBox":e.pop()}},r.prototype._fixPortArgs=function(t,e){for(var n,i,r,s,a,l=arguments.length;l--;){a=arguments[l],i=Object.keys(a);for(var c=i.length;c--;)n=i[c],s=a[n],r=this.autorouter.getPortId(n,this._autorouterBoxes[s]),a[n]=this._autorouterBoxes[s].ports[r],o(this._autorouterBoxes[s].ports[r],"AR Port not found!")}},r.prototype._invokeAutoRouterMethod=function(t,e){try{return this._invokeAutoRouterMethodUnsafe(t,e)}catch(n){this.logger.error("AutoRouter."+t+" failed with error: "+n)}},r.prototype._invokeAutoRouterMethodUnsafe=function(t,e){var n,i=e.slice();return this._recordActions&&this._recordAction(t,e.slice()),this._fixArgs(t,e),n=this.autorouter[t].apply(this.autorouter,e),this._updateRecords(t,i,n),n},r.prototype._updateRecords=function(t,e,n){o(e instanceof Array);var i,r,s=e.slice();switch(t){case"addPath":i=s.pop(),this._autorouterPaths[i]=n,this._arPathId2Original[n]=i;break;case"addBox":i=s.pop(),this._autorouterBoxes[i]=n,this._autorouterPorts[i]=[];var a=Object.keys(n.ports);for(r=a.length;r--;)this._autorouterPorts[i].push(n.ports[a[r]]);break;case"remove":if(i=s[0],this._autorouterBoxes[i]){for(r=this._autorouterPorts[i]?this._autorouterPorts[i].length:0;r--;){var l=i+this._portSeparator+this._autorouterPorts[i][r];delete this._autorouterBoxes[l]}delete this._autorouterBoxes[i],delete this._autorouterPorts[i]}else if(this._autorouterPaths[i]){var c=this._autorouterPaths[i];delete this._autorouterPaths[i],delete this._arPathId2Original[c]}break;case"setComponent":var d,h;i=s[0],d=i.length+this._portSeparator.length,h=s[1].substring(d),-1===this._autorouterPorts[i].indexOf(h)&&this._autorouterPorts[i].push(h);break;case"updatePort":i=s[1].id}},r.prototype._recordAction=function(t,e){var n={action:t,args:e},i=function(t,e){return e&&e.owner?e.id:e};this.debugActionSequence+=JSON.stringify(n,i)+","},r.prototype._getActionSequence=function(){var t=this.debugActionSequence.lastIndexOf(","),e=this.debugActionSequence.substring(0,t)+"]";return e},e.exports=r},{"./AutoRouter":23,"./AutoRouter.Utils":22}],10:[function(t,e,n){var i=t("assert"),o=t("./AutoRouter.Constants"),r=t("./AutoRouter.Utils"),s=t("./AutoRouter.Point"),a=t("./AutoRouter.Rect"),l=t("./AutoRouter.Port"),c=function(){this.owner=null,this.rect=new a,this.atomic=!1,this.selfPoints=[],this.ports=[],this.childBoxes=[],this.parent=null,this.id=null,this.calculateSelfPoints()};c.prototype.calculateSelfPoints=function(){this.selfPoints=[],this.selfPoints.push(new s(this.rect.getTopLeft())),this.selfPoints.push(new s(this.rect.right,this.rect.ceil)),this.selfPoints.push(new s(this.rect.right,this.rect.floor)),this.selfPoints.push(new s(this.rect.left,this.rect.floor))},c.prototype.deleteAllPorts=function(){for(var t=0;t<this.ports.length;t++)this.ports[t].destroy();this.ports=[],this.atomic=!1},c.prototype.hasOwner=function(){return null!==this.owner},c.prototype.createPort=function(){var t=new l;return i(null!==t,"ARBox.createPort: port !== null FAILED"),t},c.prototype.hasNoPort=function(){return 0===this.ports.length},c.prototype.isAtomic=function(){return this.atomic},c.prototype.addPort=function(t){i(null!==t,"ARBox.addPort: port !== null FAILED"),t.owner=this,this.ports.push(t),this.owner&&this.owner._addEdges(t)},c.prototype.deletePort=function(t){if(i(null!==t,"ARBox.deletePort: port !== null FAILED"),null!==t){var e=this.ports.indexOf(t),n=this.owner;i(-1!==e,"ARBox.deletePort: index !== -1 FAILED"),n.deleteEdges(t),this.ports.splice(e,1),this.atomic=!1}},c.prototype.isRectEmpty=function(){return this.rect.isRectEmpty()},c.prototype.setRect=function(t){i(t instanceof a,"Invalthis.id arg in ARBox.setRect. Requires ArRect"),i(t.getWidth()>=3&&t.getHeight()>=3,"ARBox.setRect: r.getWidth() >= 3 && r.getHeight() >= 3 FAILED!"),i(t.getTopLeft().x>=o.ED_MINCOORD&&t.getTopLeft().y>=o.ED_MINCOORD,"ARBox.setRect: r.getTopLeft().x >= CONSTANTS.ED_MINCOORD && r.getTopLeft().y >= CONSTANTS.ED_MAXCOORD FAILED!"),i(t.getBottomRight().x<=o.ED_MAXCOORD&&t.getBottomRight().y<=o.ED_MAXCOORD,"ARBox.setRect:  r.getBottomRight().x <= CONSTANTS.ED_MAXCOORD && r.getBottomRight().y <= CONSTANTS.ED_MAXCOORD FAILED!"),i(0===this.ports.length||this.atomic,"ARBox.setRect: this.ports.length === 0 || this.atomic FAILED!"),this.rect.assign(t),this.calculateSelfPoints(),this.atomic&&(i(1===this.ports.length,"ARBox.setRect: this.ports.length === 1 FAILED!"),this.ports[0].setRect(t))},c.prototype.shiftBy=function(t){this.rect.add(t);for(var e=this.ports.length;e--;)this.ports[e].shiftBy(t);this.calculateSelfPoints()},c.prototype.resetPortAvailability=function(){for(var t=this.ports.length;t--;)this.ports[t].resetAvailableArea()},c.prototype.adjustPortAvailability=function(t){if(!t.hasAncestorWithId(this.id)&&!this.hasAncestorWithId(t.id))for(var e=this.ports.length;e--;)this.ports[e].adjustAvailableArea(t.rect)},c.prototype.addChild=function(t){i(-1===this.childBoxes.indexOf(t),"ARBox.addChild: box already is child of "+this.id),i(t instanceof c,"Child box must be of type AutoRouterBox"),this.childBoxes.push(t),t.parent=this},c.prototype.removeChild=function(t){var e=this.childBoxes.indexOf(t);i(-1!==e,"ARBox.removeChild: box isn't child of "+this.id),this.childBoxes.splice(e,1),t.parent=null},c.prototype.hasAncestorWithId=function(t){for(var e=this;e;){if(e.id===t)return!0;e=e.parent}return!1},c.prototype.getRootBox=function(){for(var t=this;t.parent;)t=t.parent;return t},c.prototype.isBoxAt=function(t,e){return r.isPointIn(t,this.rect,e)},c.prototype.isBoxClip=function(t){return r.isRectClip(this.rect,t)},c.prototype.isBoxIn=function(t){return r.isRectIn(this.rect,t)},c.prototype.destroy=function(){var t=this.childBoxes.length;for(this.parent&&this.parent.removeChild(this),this.owner=null,this.deleteAllPorts();t--;)this.childBoxes[t].destroy()},c.prototype.assertValid=function(){for(var t=this.ports.length;t--;)this.ports[t].assertValid()},e.exports=c},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.Port":19,"./AutoRouter.Rect":20,"./AutoRouter.Utils":22,assert:1}],11:[function(t,e,n){var i=t("./AutoRouter.Point");e.exports={EMPTY_POINT:new i(-1e5,-1e5),ED_MAXCOORD:1e5,ED_MINCOORD:-2,ED_SMALLGAP:15,CONNECTIONCUSTOMIZATIONDATAVERSION:0,EMPTYCONNECTIONCUSTOMIZATIONDATAMAGIC:-1,DEBUG:!1,BUFFER:10,EDLS_S:15,EDLS_R:16,EDLS_D:1e5+2,PathEndOnDefault:0,PathEndOnTop:16,PathEndOnRight:32,PathEndOnBottom:64,PathEndOnLeft:128,PathEndMask:240,PathStartOnDefault:0,PathStartOnTop:256,PathStartOnRight:512,PathStartOnBottom:1024,PathStartOnLeft:2048,PathStartMask:3840,PathHighLighted:2,PathFixed:1,PathDefault:0,PathStateConnected:1,PathStateDefault:0,PortEndOnTop:1,PortEndOnRight:2,PortEndOnBottom:4,PortEndOnLeft:8,PortEndOnAll:15,PortStartOnTop:16,PortStartOnRight:32,PortStartOnBottom:64,PortStartOnLeft:128,PortStartOnAll:240,PortConnectOnAll:255,PortConnectToCenter:256,PortStartEndHorizontal:170,PortStartEndVertical:85,PortDefault:255,DirNone:-1,DirTop:0,DirRight:1,DirBottom:2,DirLeft:3,DirSkew:4,SimpleEdgeDisplacement:"EdgeDisplacement",CustomPointCustomization:"PointCustomization"}},{"./AutoRouter.Point":17}],12:[function(t,e,n){var i=t("assert"),o=t("./AutoRouter.Constants"),r=t("./AutoRouter.Utils"),s=t("./AutoRouter.Point"),a=function(){this.owner=null,this.startpointPrev=null,this.startpoint=null,this.endpoint=null,this.endpointNext=null,this.positionY=0,this.positionX1=0,this.positionX2=0,this.bracketClosing=!1,this.bracketOpening=!1,this.orderPrev=null,this.orderNext=null,this.sectionX1=null,this.sectionX2=null,this.sectionNext=null,this.sectionDown=null,this.edgeFixed=!1,this.edgeCustomFixed=!1,this.edgeCanPassed=!1,this.edgeDirection=null,this.blockPrev=null,this.blockNext=null,this.blockTrace=null,this.closestPrev=null,this.closestNext=null};a.prototype.assign=function(t){return null!==t?(this.owner=t.owner,this.setStartPoint(t.startpoint,!1),this.setEndPoint(t.endpoint,null!==t.endpoint),this.startpointPrev=t.startpointPrev,this.endpointNext=t.endpointNext,this.positionY=t.positionY,this.positionX1=t.positionX1,this.positionX2=t.positionX2,this.bracketClosing=t.bracketClosing,this.bracketOpening=t.bracketOpening,this.orderNext=t.orderNext,this.orderPrev=t.orderPrev,this.sectionX1=t.sectionX1,this.sectionX2=t.sectionX2,this.setSectionNext(t.getSectionNext(!0)),this.setSectionDown(t.getSectionDown(!0)),this.edgeFixed=t.edgeFixed,this.edgeCustomFixed=t.edgeCustomFixed,this.setEdgeCanpassed(t.getEdgeCanpassed()),this.setDirection(t.getDirection()),this.setBlockPrev(t.getBlockPrev()),this.setBlockNext(t.getBlockNext()),this.setBlockTrace(t.getBlockTrace()),this.setClosestPrev(t.getClosestPrev()),this.setClosestNext(t.getClosestNext()),this):null},a.prototype.equals=function(t){return this===t},a.prototype.getStartPointPrev=function(){return null!==this.startpointPrev?this.startpointPrev||this.startpointPrev:null},a.prototype.isStartPointPrevNull=function(){return!this.startpointPrev},a.prototype.getStartPoint=function(){return null!==this.startpoint?new s(this.startpoint instanceof Array?this.startpoint:this.startpoint):o.EMPTY_POINT},a.prototype.isSameStartPoint=function(t){return this.startpoint===t},a.prototype.isStartPointNull=function(){return null===this.startpoint},a.prototype.setStartPoint=function(t,e){this.startpoint=t,e!==!1&&this.recalculateDirection()},a.prototype.setStartPointX=function(t){this.startpoint.x=t},a.prototype.setStartPointY=function(t){this.startpoint.y=t},a.prototype.getEndPoint=function(){return null!==this.endpoint?new s(this.endpoint instanceof Array?this.endpoint:this.endpoint):o.EMPTY_POINT},a.prototype.isEndPointNull=function(){return null===this.endpoint},a.prototype.setEndPoint=function(t,e){this.endpoint=t,e!==!1&&this.recalculateDirection()},a.prototype.setStartAndEndPoint=function(t,e){this.setStartPoint(t,!1),this.setEndPoint(e)},a.prototype.setEndPointX=function(t){this.endpoint.x=t},a.prototype.setEndPointY=function(t){this.endpoint.y=t},a.prototype.isEndPointNextNull=function(){return!this.endpointNext},a.prototype.getSectionNext=function(){return void 0!==this.sectionNext?this.sectionNext[0]:null},a.prototype.getSectionNextPtr=function(){return this.sectionNext&&this.sectionNext[0]||(this.sectionNext=[new a]),this.sectionNext},a.prototype.setSectionNext=function(t){t=t instanceof Array?t[0]:t,this.sectionNext instanceof Array?this.sectionNext[0]=t:this.sectionNext=[t]},a.prototype.getSectionDown=function(){return void 0!==this.sectionDown?this.sectionDown[0]:null},a.prototype.getSectionDownPtr=function(){return this.sectionDown&&this.sectionDown[0]||(this.sectionDown=[new a]),this.sectionDown},a.prototype.setSectionDown=function(t){t=t instanceof Array?t[0]:t,this.sectionDown instanceof Array?this.sectionDown[0]=t:this.sectionDown=[t]},a.prototype.getEdgeCanpassed=function(){return this.edgeCanPassed},a.prototype.setEdgeCanpassed=function(t){this.edgeCanPassed=t},a.prototype.getDirection=function(){return this.edgeDirection},a.prototype.setDirection=function(t){this.edgeDirection=t},a.prototype.recalculateDirection=function(){i(null!==this.startpoint&&null!==this.endpoint,"AREdge.recalculateDirection: this.startpoint !== null && this.endpoint !== null FAILED!"),this.edgeDirection=r.getDir(this.endpoint.minus(this.startpoint))},a.prototype.getBlockPrev=function(){return this.blockPrev},a.prototype.setBlockPrev=function(t){this.blockPrev=t},a.prototype.getBlockNext=function(){return this.blockNext},a.prototype.setBlockNext=function(t){this.blockNext=t},a.prototype.getBlockTrace=function(){return this.blockTrace},a.prototype.setBlockTrace=function(t){this.blockTrace=t},a.prototype.getClosestPrev=function(){return this.closestPrev},a.prototype.setClosestPrev=function(t){this.closestPrev=t},a.prototype.getClosestNext=function(){return this.closestNext},a.prototype.setClosestNext=function(t){this.closestNext=t},e.exports=a},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.Utils":22,assert:1}],13:[function(t,e,n){var i=t("./AutoRouter.Logger"),o=t("assert"),r=t("./AutoRouter.Constants"),s=t("./AutoRouter.Utils"),a=(t("./AutoRouter.Path"),t("./AutoRouter.Port"),t("./AutoRouter.Box")),l=t("./AutoRouter.Edge"),c=new i("AutoRouter.EdgeList"),d=function(t){this.owner=null,this.ishorizontal=t,this.orderFirst=null,this.orderLast=null,this.sectionFirst=null,this.sectionBlocker=null,this.sectionPtr2Blocked=[],this._initOrder(),this._initSection()};d.prototype.contains=function(t,e){for(var n,i,o=this.orderFirst;o;){if(n=o.startpoint,i=o.endpoint,t.equals(n)&&e.equals(i))return!0;o=o.orderNext}return!1},d.prototype.destroy=function(){this.checkOrder(),this.checkSection()},d.prototype.addPathEdges=function(t){o(t.owner===this.owner,"AREdgeList.addEdges: path.owner === owner FAILED!");var e,n,i,a,c,d=t.isAutoRouted(),h=!1,p={},g=[];if(d)for(c=-1;++c<g.length;)h=!0,p[g[c]]=0;else h=!0;var u,f,m,_,b,y,v,C,E,D,I=t.getPointList(),P=I.getTailEdgePtrs(),T=I.length-2,A=P.pos;for(e=P.start,n=P.end;I.length&&A>=0;)i=s.getDir(n.minus(e)),m=i===r.DirNone?!0:!1,_=t.isMoveable(),_||i===r.DirSkew||(f=s.isRightAngle(i),o(f,"AREdgeList.addEdges: Utils.isRightAngle (dir) FAILED!"),f||(m=!0)),!m&&s.isRightAngle(i)&&s.isHorizontal(i)===this.ishorizontal&&(a=new l,a.owner=t,a.setStartAndEndPoint(e,n),a.startpointPrev=I.getPointBeforeEdge(A),a.endpointNext=I.getPointAfterEdge(A),h?(b=!1,d?(u=p.indexOf(T),b=u!==p.length-1):b=!0,a.edgeCustomFixed=b):a.edgeCustomFixed=i===r.DirSkew,y=t.getStartPort(),o(null!==y,"AREdgeList.addEdges: startPort !== null FAILED!"),C=y.isConnectToCenter(),v=t.getEndPort(),o(null!==v,"AREdgeList.addEdges: endPort !== null FAILED!"),E=v.isConnectToCenter(),D=t.isFixed()||!t.isAutoRouted(),a.edgeFixed=a.edgeCustomFixed||D||a.isStartPointPrevNull()&&C||a.isEndPointNextNull()&&E,i!==r.DirSkew?(this._positionLoadY(a),this._positionLoadB(a)):(a.positionY=0,a.bracketOpening=!1,a.bracketClosing=!1),this.insert(a)),P=I.getPrevEdgePtrs(A),A=P.pos,e=P.start,n=P.end,T--;return!0},d.prototype.addPortEdges=function(t){var e,n,i,r,a,c,d,h,p;if(o(t.owner.owner===this.owner,"AREdgeList.addEdges: port.owner === (owner) FAILED!"),!t.isConnectToCenter()&&!t.owner.isAtomic())for(r=t.selfPoints,h=0;4>h;h++)a=r[(h+3)%4],e=r[h],n=r[(h+1)%4],c=r[(h+2)%4],d=s.getDir(n.minus(e)),o(s.isRightAngle(d),"AREdgeList.addEdges: Utils.isRightAngle (dir) FAILED!"),p=t.canHaveStartEndPointHorizontal(this.ishorizontal),s.isHorizontal(d)===this.ishorizontal&&p&&(i=new l,i.owner=t,i.setStartAndEndPoint(e,n),i.startpointPrev=a,i.endpointNext=c,i.edgeFixed=!0,this._positionLoadY(i),this._positionLoadB(i),i.bracketClosing&&i.addToPosition(.999),this.insert(i))},d.prototype.addEdges=function(t){var e,n,i,r,c,d,h,p;if(t instanceof a){var g=t;for(o(g.owner===this.owner,"AREdgeList.addEdges: box.owner === (owner) FAILED!"),e=g.selfPoints,p=0;4>p;p++)i=e[(p+3)%4],n=e[p],c=e[(p+1)%4],r=e[(p+2)%4],h=s.getDir(c.minus(n)),o(s.isRightAngle(h),"AREdgeList.addEdges: Utils.isRightAngle (dir) FAILED!"),s.isHorizontal(h)===this.ishorizontal&&(d=new l,d.owner=g,d.setStartAndEndPoint(n,c),d.startpointPrev=i,d.endpointNext=r,d.edgeFixed=!0,this._positionLoadY(d),this._positionLoadB(d),d.bracketClosing&&d.addToPosition(.999),this.insert(d))}else if(t){var u=t;for(o(u===this.owner,"AREdgeList.addEdges: graph === this.owner FAILED!"),e=u.selfPoints,p=0;4>p;p++)i=e[(p+3)%4],n=e[p],c=e[(p+1)%4],r=e[(p+2)%4],h=s.getDir(c.minus(n)),o(s.isRightAngle(h),"AREdgeList.addEdges: Utils.isRightAngle (dir) FAILED!"),s.isHorizontal(h)===this.ishorizontal&&(d=new l,d.owner=u,d.setStartAndEndPoint(n,c),d.startpointPrev=i,d.endpointNext=r,d.edgeFixed=!0,this._positionLoadY(d),this.insert(d))}},d.prototype.deleteEdges=function(t){for(var e,n=this.orderFirst;null!==n;)n.owner===t?(e=n.orderNext,this.remove(n),n=e):n=n.orderNext},d.prototype.deleteAllEdges=function(){for(;this.orderFirst;)this.remove(this.orderFirst)},d.prototype.getEdge=function(t,e){for(var n=this.orderFirst;null!==n&&!n.isSameStartPoint(e);)n=n.orderNext;return o(null!==n,"AREdgeList.getEdge: edge !== null FAILED!"),n},d.prototype.getEdgeByPointer=function(t){for(var e=this.orderFirst;null!==e&&!e.isSameStartPoint(t);)e=e.orderNext;return o(null!==e,"AREdgeList.getEdgeByPointer: edge !== null FAILED!"),e},d.prototype.setEdgeByPointer=function(t,e){o(e instanceof l,"AREdgeList.setEdgeByPointer: newEdge instanceof AutoRouterEdge FAILED!");for(var n=this.sectionFirst;null!==n&&t!==n;)n=n.getSectionDown();o(null!==n,"AREdgeList.setEdgeByPointer: edge !== null FAILED!"),n=e},d.prototype.getEdgeAt=function(t,e){for(var n=this.orderFirst;n;){if(s.isPointNearLine(t,n.startpoint,n.endpoint,e))return n;n=n.orderNext}return null},d.prototype.dumpEdges=function(t,e){var n=this.orderFirst,i=e||c.debug,o=1;for(i(t);null!==n;)i("	"+n.startpoint.x+", "+n.startpoint.y+"		"+n.endpoint.x+", "+n.endpoint.y+"			("+(n.edgeFixed?"FIXED":"MOVEABLE")+")		"+(n.bracketClosing?"Bracket Closing":n.bracketOpening?"Bracket Opening":"")),n=n.orderNext,o++;i("Total Edges: "+o)},d.prototype.getEdgeCount=function(){for(var t=this.orderFirst,e=1;null!==t;)t=t.orderNext,e++;return e},d.prototype._positionGetRealY=function(t,e){return void 0===e?this.ishorizontal?(o(t.startpoint.y===t.endpoint.y,"AREdgeList.position_GetRealY: edge.startpoint.y === edge.endpoint.y FAILED!"),t.startpoint.y):(o(t.startpoint.x===t.endpoint.x,"AREdgeList.position_GetRealY: edge.startpoint.x === edge.endpoint.x FAILED!"),t.startpoint.x):(o(null!==t&&!t.isStartPointNull()&&!t.isEndPointNull(),"AREdgeList.position_GetRealY: edge !== null && !edge.isStartPointNull() && !edge.isEndPointNull() FAILED!"),void(this.ishorizontal?(o(t.startpoint.y===t.endpoint.y,"AREdgeList.position_GetRealY: edge.startpoint.y === edge.endpoint.y FAILED!"),t.setStartPointY(e),t.setEndPointY(e)):(o(t.startpoint.x===t.endpoint.x,"AREdgeList.position_GetRealY: edge.startpoint.x === edge.endpoint.x FAILED"),t.setStartPointX(e),t.setEndPointX(e))))},d.prototype._positionSetRealY=function(t,e){t instanceof Array&&(t=t[0]),o(null!==t&&!t.isStartPointNull()&&!t.isEndPointNull(),"AREdgeList.position_SetRealY: edge != null && !edge.isStartPointNull() && !edge.isEndPointNull() FAILED"),this.ishorizontal?(o(t.startpoint.y===t.endpoint.y,"AREdgeList.position_SetRealY: edge.startpoint.y === edge.endpoint.y FAILED"),t.setStartPointY(e),t.setEndPointY(e)):(o(t.startpoint.x===t.endpoint.x,"AREdgeList.position_SetRealY: edge.startpoint.x === edge.endpoint.x FAILED"),t.setStartPointX(e),t.setEndPointX(e))},d.prototype._positionGetRealX=function(t){o(null!==t&&!t.isStartPointNull()&&!t.isEndPointNull(),"AREdgeList.position_GetRealX: edge !== null && !edge.isStartPointNull() && !edge.isEndPointNull() FAILED");var e,n;return this.ishorizontal?(o(t.startpoint.y===t.endpoint.y,"AREdgeList.position_GetRealX: edge.startpoint.y === edge.endpoint.y FAILED"),t.startpoint.x<t.endpoint.x?(e=t.startpoint.x,n=t.endpoint.x):(e=t.endpoint.x,n=t.startpoint.x)):(o(t.startpoint.x===t.endpoint.x,"AREdgeList.position_GetRealX: edge.startpoint.x === edge.endpoint.x FAILED"),t.startpoint.y<t.endpoint.y?(e=t.startpoint.y,n=t.endpoint.y):(e=t.endpoint.y,n=t.startpoint.y)),[e,n]},d.prototype._positionGetRealO=function(t){o(null!==t&&!t.isStartPointNull()&&!t.isEndPointNull(),"AREdgeList.position_GetRealO: edge !== null && !edge.isStartPointNull() && !edge.isEndPointNull() FAILED");var e,n;return this.ishorizontal?(o(t.startpoint.y===t.endpoint.y,"AREdgeList.position_GetRealO: edge.startpoint.y === edge.endpoint.y FAILED"),t.startpoint.x<t.endpoint.x?(e=t.isStartPointPrevNull()?0:t.startpointPrev.y-t.startpoint.y,n=t.isEndPointNextNull()?0:t.endpointNext.y-t.endpoint.y):(e=t.isEndPointNextNull()?0:t.endpointNext.y-t.endpoint.y,n=t.isStartPointPrevNull()?0:t.startpointPrev.y-t.startpoint.y)):(o(t.startpoint.x===t.endpoint.x,"AREdgeList.position_GetRealO: edge.startpoint.x === edge.endpoint.x FAILED"),t.startpoint.y<t.endpoint.y?(e=t.isStartPointPrevNull()?0:t.startpointPrev.x-t.startpoint.x,n=t.isEndPointNextNull()?0:t.endpointNext.x-t.endpoint.x):(e=t.isEndPointNextNull()?0:t.endpointNext.x-t.endpoint.x,n=t.isStartPointPrevNull()?0:t.startpointPrev.x-t.startpoint.x)),[e,n]},d.prototype._positionLoadY=function(t){o(null!==t&&null===t.orderNext&&null===t.orderPrev,"AREdgeList.position_LoadY: edge !== null && edge.orderNext === null && edge.orderPrev === null FAILED"),t.positionY=this._positionGetRealY(t)},d.prototype._positionLoadB=function(t){o(null!==t,"AREdgeList.position_LoadB: edge !== null FAILED"),t.bracketOpening=!t.edgeFixed&&this._bracketIsOpening(t),t.bracketClosing=!t.edgeFixed&&this._bracketIsClosing(t)},d.prototype._positionAllStoreY=function(){for(var t=this.orderFirst;t;)this._positionSetRealY(t,t.positionY),t=t.orderNext},d.prototype._positionAllLoadX=function(){for(var t,e=this.orderFirst;e;)t=this._positionGetRealX(e),e.positionX1=t[0],e.positionX2=t[1],e=e.orderNext},d.prototype._initOrder=function(){this.orderFirst=null,this.orderLast=null},d.prototype._checkOrder=function(){o(null===this.orderFirst&&null===this.orderLast,"AREdgeList.checkOrder: this.orderFirst === null && this.orderLast === null FAILED")},d.prototype.insertBefore=function(t,e){o(null!==t&&null!==e&&t!==e,"AREdgeList.insertBefore: edge !== null && before !== null && edge !== before FAILED"),o(null===t.orderNext&&null===t.orderPrev,"AREdgeList.insertBefore: edge.orderNext === null && edge.orderPrev === null FAILED"),t.orderPrev=e.orderPrev,t.orderNext=e,e.orderPrev?(o(e.orderPrev.orderNext===e,"AREdgeList.insertBefore: before.orderPrev.orderNext === before FAILED\nbefore.orderPrev.orderNext is "+e.orderPrev.orderNext+" and before is "+e),e.orderPrev.orderNext=t,o(this.orderFirst!==e,"AREdgeList.insertBefore: this.orderFirst !== before FAILED")):(o(this.orderFirst===e,"AREdgeList.insertBefore: this.orderFirst === before FAILED"),this.orderFirst=t),e.orderPrev=t},d.prototype.insertAfter=function(t,e){o(null!==t&&null!==e&&!t.equals(e),"AREdgeList.insertAfter:  edge !== null && after !== null && !edge.equals(after) FAILED"),o(null===t.orderNext&&null===t.orderPrev,"AREdgeList.insertAfter: edge.orderNext === null && edge.orderPrev === null FAILED "),t.orderNext=e.orderNext,t.orderPrev=e,e.orderNext?(o(e.orderNext.orderPrev.equals(e),"AREdgeList.insertAfter:  after.orderNext.orderPrev.equals(after) FAILED"),e.orderNext.orderPrev=t,o(!this.orderLast.equals(e),"AREdgeList.insertAfter: !orderLast.equals(after) FAILED")):(o(this.orderLast.equals(e),"AREdgeList.insertAfter: this.orderLast.equals(after) FAILED"),this.orderLast=t),e.orderNext=t},d.prototype.insertLast=function(t){o(null!==t,"AREdgeList.insertLast: edge !== null FAILED"),o(null===t.orderPrev&&null===t.orderNext,"AREdgeList.insertLast: edge.orderPrev === null && edge.orderNext === null FAILED"),t.orderPrev=this.orderLast,this.orderLast?(o(null===this.orderLast.orderNext,"AREdgeList.insertLast: this.orderLast.orderNext === null FAILED"),o(null!==this.orderFirst,"AREdgeList.insertLast: this.orderFirst != null FAILED"),this.orderLast.orderNext=t,this.orderLast=t):(o(null===this.orderFirst,"AREdgeList.insertLast:  this.orderFirst === null FAILED"),this.orderFirst=t,this.orderLast=t)},d.prototype.insert=function(t){o(null!==t,"AREdgeList.insert:  edge !== null FAILED"),o(null===t.orderPrev&&null===t.orderNext,"AREdgeList.insert: edge.orderPrev === null && edge.orderNext === null FAILED");var e=t.positionY;o(r.ED_MINCOORD<=e&&e<=r.ED_MAXCOORD,"AREdgeList.insert: CONSTANTS.ED_MINCOORD <= y && y <= CONSTANTS.ED_MAXCOORD FAILED (y is "+e+")");for(var n=this.orderFirst;n&&n.positionY<e;)n=n.orderNext;n?this.insertBefore(t,n):this.insertLast(t)},d.prototype.remove=function(t){o(null!==t,"AREdgeList.remove:  edge !== null FAILED"),this.orderFirst===t&&(this.orderFirst=t.orderNext),t.orderNext&&(t.orderNext.orderPrev=t.orderPrev),this.orderLast===t&&(this.orderLast=t.orderPrev),t.orderPrev&&(t.orderPrev.orderNext=t.orderNext),t.orderNext=null,t.orderPrev=null},d.prototype._slideButNotPassEdges=function(t,e){o(null!==t,"AREdgeList.slideButNotPassEdges: edge != null FAILED"),o(r.ED_MINCOORD<e&&e<r.ED_MAXCOORD,"AREdgeList.slideButNotPassEdges: CONSTANTS.ED_MINCOORD < y && y < CONSTANTS.ED_MAXCOORD FAILED");var n=t.positionY;if(o(r.ED_MINCOORD<n&&n<r.ED_MAXCOORD,"AREdgeList.slideButNotPassEdges: CONSTANTS.ED_MINCOORD < oldy && oldy < CONSTANTS.ED_MAXCOORD FAILED"),n===e)return null;var i=t.positionX1,a=t.positionX2,l=null,c=t;if(e>n){for(;c.orderNext&&(c=c.orderNext,!(e<c.positionY));)if(!c.getEdgeCanpassed()&&s.intersect(i,a,c.positionX1,c.positionX2)){l=c,e=c.positionY;break}t!==c&&c.orderPrev!==t&&(this.remove(t),this.insertBefore(t,c))}else{for(;c.orderPrev&&(c=c.orderPrev,!(e>c.positionY));)if(!c.getEdgeCanpassed()&&s.intersect(i,a,c.positionX1,c.positionX2)){l=c,e=c.positionY;break}t!==c&&c.orderNext!==t&&(this.remove(t),this.insertAfter(t,c))}return t.positionY=e,l},d.prototype._initSection=function(){this.sectionFirst=null,this.sectionBlocker=null,this.sectionPtr2Blocked=null},d.prototype.checkSection=function(){(null!==this.sectionBlocker||null!==this.sectionPtr2Blocked)&&(this._logger.warn("sectionBlocker and this.sectionPtr2Blocked are not null. Assuming last run did not exit cleanly. Fixing..."),this.sectionBlocker=null,this.sectionPtr2Blocked=null)},d.prototype.sectionReset=function(){this.checkSection(),this.sectionFirst=null},d.prototype._sectionBeginScan=function(t){this.checkSection(),this.sectionBlocker=t,this.sectionBlocker.sectionX1=this.sectionBlocker.positionX1,this.sectionBlocker.sectionX2=this.sectionBlocker.positionX2,this.sectionBlocker.setSectionNext(null),this.sectionBlocker.setSectionDown(null)},d.prototype._sectionIsImmediate=function(){o(null!==this.sectionBlocker&&null!==this.sectionPtr2Blocked&&null!==this.sectionPtr2Blocked,"AREdgeList._sectionIsImmediate: this.sectionBlocker != null && this.sectionPtr2Blocked != null && *sectionPtr2Blocked != null FAILED");var t=this.sectionPtr2Blocked[0],e=t.getSectionDown(),n=t.sectionX1,i=t.sectionX2,r=t.positionX1,s=t.positionX2,a=this.sectionBlocker.sectionX1,l=this.sectionBlocker.sectionX2;if(null!==e&&(e=null===e.startpoint||void 0===e.sectionX1?null:e),o(i>=a&&l>=n,"AREdgeList._sectionIsImmediate: b1 <= a2 && a1 <= b2 FAILED"),a>=n){for(;null!==e&&null!==e.startpoint&&e.sectionX2<a;)e=e.getSectionNext();return i>=l?null===e||null===e.startpoint||l<e.sectionX1:(null===e||null===e.startpoint)&&i===s;
}return i>=l?n===r&&(null===e||null===e.startpoint||l<e.sectionX1):(null===e||null===e.startpoint)&&n===r&&i===s};var h=function(t,e){var n;return o(e>t),n=Math.min(t+1,(t+e)/2),n===e&&(n=t),o(e>n),n},p=function(t,e){var n;return o(e>t),n=Math.max(e-1,(t+e)/2),n===t&&(n=e),o(n>t),n};d.prototype._sectionHasBlockedEdge=function(){o(null!==this.sectionBlocker,"AREdgeList._sectionHasBlockedEdge: this.sectionBlocker != null FAILED");var t,e,n,i=this.sectionBlocker.sectionX1,r=this.sectionBlocker.sectionX2;if(o(r>=i,"AREdgeList._sectionHasBlockedEdge: blockerX1 <= blockerX2 FAILED"),null===this.sectionPtr2Blocked)this.sectionFirst=null===this.sectionFirst?[new l]:this.sectionFirst,this.sectionPtr2Blocked=this.sectionFirst;else{var s=this.sectionPtr2Blocked[0];o(null!==s.startpoint,"AREdgeList._sectionHasBlockedEdge: currentEdge.startpoint === null");var a=null;if(n=s.getSectionDownPtr()[0],t=s.sectionX1,e=s.sectionX2,o(e>=t,"AREdgeList._sectionHasBlockedEdge: newSectionX1 <= newSectionX2 FAILED ("+t+" <= "+e+")\nedge is "),o(e>=i&&r>=t,"AREdgeList._sectionHasBlockedEdge: blockerX1 <= newSectionX2 &&  newSectionX1 <= blockerX2 FAILED"),i>t&&e>r)this.sectionPtr2Blocked=s.getSectionDownPtr();else if(t>=i&&r>=e)if(n&&null!==n.startpoint){for(;n.getSectionNext()&&null!==n.getSectionNext().startpoint;)n=n.getSectionNext();n.setSectionNext(s.getSectionNext()),this.sectionPtr2Blocked[0]=s.getSectionDown()}else this.sectionPtr2Blocked[0]=s.getSectionNext();else if(t>=i&&e>r){for(o(r>=t,"AREdgeList._sectionHasBlockedEdge: newSectionX1 <= blockerX2 FAILED"),t=h(r,e);n&&null!==n.startpoint&&n.sectionX1<=t;)o(n.sectionX1<=n.sectionX2,"AREdgeList._sectionHasBlockedEdge: e.sectionX1 <= e.sectionX2 FAILED"),t<=n.sectionX2&&(t=h(n.sectionX2,e)),a=n,n=n.getSectionNext();a&&(this.sectionPtr2Blocked[0]=s.getSectionDownPtr()[0],a.setSectionNext(s),s.setSectionDown(n)),o(t>r,"AREdgeList._sectionHasBlockedEdge: blockerX2 < newSectionX1 FAILED ("+r+" < "+t+") "+s.sectionX2+" is "+e+")"),s.sectionX1=t,o(s.sectionX1<s.sectionX2,"currentEdge.sectionX1 < currentEdge.sectionX2 ("+s.sectionX1+" < "+s.sectionX2+")")}else{for(o(i>t&&e>=i&&r>=e,"AREdgeList._sectionHasBlockedEdge:  newSectionX1 < blockerX1 && blockerX1 <= newSectionX2 && newSectionX2 <= blockerX2 FAILED"),this.sectionPtr2Blocked=s.getSectionDownPtr();n&&null!==n.startpoint;)a=n,n=n.getSectionNext(),a.sectionX2+1<i&&(null===n||null===n.startpoint||a.sectionX2+1<n.sectionX1)&&(this.sectionPtr2Blocked=a.getSectionNextPtr());if(null!==this.sectionPtr2Blocked[0].startpoint){o(null!==a,"AREdgeList._sectionHasBlockedEdge: o != null FAILED"),a.setSectionNext(s.getSectionNext());var c=i;this.sectionPtr2Blocked[0].sectionX1<i&&(c=this.sectionPtr2Blocked[0].sectionX1),s.sectionX2=p(t,c),s.setSectionNext(this.sectionPtr2Blocked[0]),this.sectionPtr2Blocked[0]=new l,this.sectionPtr2Blocked=null}else s.sectionX2=p(t,i);o(s.sectionX1<s.sectionX2,"Expected sectionX1 < sectionX2 but "+s.sectionX1+" is not < "+s.sectionX2),this.sectionPtr2Blocked=s.getSectionNextPtr()}}for(o(null!==this.sectionPtr2Blocked,"AREdgeList._sectionHasBlockedEdge: this.sectionPtr2Blocked != null FAILED");null!==this.sectionPtr2Blocked[0]&&null!==this.sectionPtr2Blocked[0].startpoint;)if(t=this.sectionPtr2Blocked[0].sectionX1,e=this.sectionPtr2Blocked[0].sectionX2,i>e)this.sectionPtr2Blocked=this.sectionPtr2Blocked[0].getSectionNextPtr(),o(null!==this.sectionPtr2Blocked,"AREdgeList._sectionHasBlockedEdge: this.sectionPtr2Blocked != null FAILED");else{if(t>r)break;if(!(i>t&&e>r))return!0;var d=i;for(n=this.sectionPtr2Blocked[0].getSectionDown();;){if(null===n||null===n.startpoint||d<n.sectionX1)return!0;if(d<=n.sectionX2&&(d=n.sectionX2+1,d>r))break;n=n.getSectionNext()}this.sectionPtr2Blocked=this.sectionPtr2Blocked[0].getSectionDownPtr()}return o(null===this.sectionBlocker.getSectionNext()&&(null===this.sectionBlocker.getSectionDown()||null===this.sectionBlocker.getSectionDown().startpoint),"AREdgeList._sectionHasBlockedEdge: this.sectionBlocker.getSectionNext() === null &&this.sectionBlocker.getSectionDown() === null FAILED"),this.sectionBlocker.setSectionNext(this.sectionPtr2Blocked[0]),this.sectionPtr2Blocked[0]=this.sectionBlocker,this.sectionBlocker=null,this.sectionPtr2Blocked=null,!1},d.prototype._sectionGetBlockedEdge=function(){return o(null!==this.sectionBlocker&&null!==this.sectionPtr2Blocked,"AREdgeList.sectionGetBlockedEdge: this.sectionBlocker !== null && this.sectionPtr2Blocked !== null FAILED"),this.sectionPtr2Blocked[0]},d.prototype._bracketIsClosing=function(t){o(null!==t,"AREdgeList._bracketIsClosing: edge !== null FAILED"),o(!t.isStartPointNull()&&!t.isEndPointNull(),"AREdgeList._bracketIsClosing: !edge.isStartPointNull() && !edge.isEndPointNull() FAILED");var e=t.startpoint,n=t.endpoint;return t.isStartPointPrevNull()||t.isEndPointNextNull()?!1:this.ishorizontal?t.startpointPrev.y<e.y&&t.endpointNext.y<n.y:t.startpointPrev.x<e.x&&t.endpointNext.x<n.x},d.prototype._bracketIsOpening=function(t){o(null!==t,"AREdgeList._bracketIsOpening: edge !== null FAILED"),o(!t.isStartPointNull()&&!t.isEndPointNull(),"AREdgeList._bracketIsOpening: !edge.isStartPointNull() && !edge.isEndPointNull() FAILED");var e,n,i=t.startpoint||t.startpoint,r=t.endpoint||t.endpoint;return t.isStartPointPrevNull()||t.isEndPointNextNull()?!1:(n=t.endpointNext||t.endpointNext,e=t.startpointPrev||t.startpointPrev,this.ishorizontal?e.y>i.y&&n.y>r.y:e.x>i.x&&n.x>r.x)},d.prototype._bracketShouldBeSwitched=function(t,e){o(null!==t&&null!==e,"AREdgeList._bracketShouldBeSwitched: edge !== null && next !== null FAILED");var n,i,r=this._positionGetRealX(t),s=r[0],a=r[1],l=this._positionGetRealO(t),c=l[0],d=l[1],h=this._positionGetRealX(e),p=h[0],g=h[1],u=this._positionGetRealO(e),f=u[0],m=u[1];return n=s>p&&g>s&&c>0||p>s&&a>p&&0>f?1:s===p&&0===c&&0===f?0:-9,i=a>p&&g>a&&d>0||g>s&&a>g&&0>m?1:a===g&&0===d&&0===m?0:-9,n+i>0},d.prototype._blockGetF=function(t,e,n){var i=t/(e+n),o=r.EDLS_S,s=r.EDLS_R,a=r.EDLS_D;return 0===e&&i>=s?i+=a-s:i>o&&n>0&&(i=((a-o)*t-o*(a-s)*n)/((a-o)*e+(s-o)*n)),i},d.prototype._blockGetG=function(t,e,n){var i=t/(e+n),o=r.EDLS_S,s=r.EDLS_R,a=r.EDLS_D;return i>o&&e>0&&(i=((s-o)*t+o*(a-s)*e)/((a-o)*e+(s-o)*n)),i},d.prototype._blockPushBackward=function(t,e){var n=!1;o(null!==t&&null!==e,"AREdgeList._blockPushBackward: blocked !== null && blocker !== null FAILED"),o(t.positionY<=e.positionY,"AREdgeList._blockPushBackward: blocked.positionY <= blocker.positionY FAILED"),o(null!==t.getBlockPrev(),"AREdgeList._blockPushBackward: blocked.getBlockPrev() !== null FAILED");var i=0,a=0,l=t,c=e,d=c.positionY-l.positionY;o(d>=0,"AREdgeList._blockPushBackward: d >= 0 FAILED");for(var h,p=l.bracketOpening||c.bracketClosing,g=1-p;l.setBlockTrace(c),c=l,l=l.getBlockPrev(),null!==l;){if(h=c.positionY-l.positionY,o(h>=0,"AREdgeList._blockPushBackward:  d2 >= 0 FAILED"),l.bracketOpening||c.bracketClosing){if(a=this._blockGetG(d,g,p),a>=h){i=this._blockGetF(d,g,p);break}p++}else{if(i=this._blockGetF(d,g,p),i>=h){a=this._blockGetG(d,g,p);break}g++}d+=h}if(g+p>1){null===l&&(i=this._blockGetF(d,g,p),a=this._blockGetG(d,g,p)),o(s.floatEquals(d,i*g+a*p),"AREdgeList._blockPushBackward: floatEquals(d, f*b + g*s) FAILED"),l=c,o(null!==l&&l!==t,"AREdgeList._blockPushBackward: edge !== null && edge !== blocked FAILED");var u=l.positionY;do o(null!==l&&null!==l.getBlockTrace(),"AREdgeList._blockPushBackward: edge !== null && edge.getBlockTrace() !== null FAILED"),c=l.getBlockTrace(),u+=l.bracketOpening||c.bracketClosing?a:i,u=s.roundTrunc(u,10),u+.001<c.positionY&&(n=!0,this._slideButNotPassEdges(c,u)&&c.setBlockPrev(null)),l=c;while(l!==t);r.DEBUG&&o(s.floatEquals(u,e.positionY),"AREdgeList._blockPushBackward: floatEquals(y, blocker.positionY) FAILED")}return n},d.prototype._blockPushForward=function(t,e){var n=!1;o(null!==t&&null!==e,"AREdgeList._blockPushForward: blocked !== null && blocker !== null FAILED"),o(t.positionY>=e.positionY,"AREdgeList._blockPushForward: blocked.positionY >= blocker.positionY FAILED"),o(null!==t.getBlockNext(),"AREdgeList._blockPushForward: blocked.getBlockNext() !== null FAILED");var i=0,r=0,a=t,l=e,c=a.positionY-l.positionY;o(c>=0,"AREdgeList._blockPushForward:  d >= 0 FAILED");for(var d,h=l.bracketOpening||a.bracketClosing,p=1-h;a.setBlockTrace(l),l=a,a=a.getBlockNext(),null!==a;){if(d=a.positionY-l.positionY,o(d>=0,"AREdgeList._blockPushForward: d2 >= 0 FAILED"),l.bracketOpening||a.bracketClosing){if(r=this._blockGetG(c,p,h),r>=d){i=this._blockGetF(c,p,h);break}h++}else{if(i=this._blockGetF(c,p,h),i>=d){r=this._blockGetG(c,p,h);break}p++}c+=d}if(p+h>1){null===a&&(i=this._blockGetF(c,p,h),r=this._blockGetG(c,p,h)),o(s.floatEquals(c,i*p+r*h),"AREdgeList._blockPushForward: floatEquals(d, f*b + g*s) FAILED"),a=l,o(null!==a&&!a.equals(t),"AREdgeList._blockPushForward: edge != null && !edge.equals(blocked) FAILED");var g=a.positionY;do o(null!==a&&null!==a.getBlockTrace(),"AREdgeList._blockPushForward: edge !== null && edge.getBlockTrace() !== null FAILED"),l=a.getBlockTrace(),g-=l.bracketOpening||a.bracketClosing?r:i,l.positionY<g-.001&&(n=!0,this._slideButNotPassEdges(l,g)&&l.setBlockNext(null)),a=l;while(a!==t)}return n},d.prototype.blockScanForward=function(){this._positionAllLoadX();var t=!1;this.sectionReset();for(var e,n,i,s,a,l=this.orderFirst;l;){for(n=null,i=null,s=r.ED_MINCOORD-1,a=r.ED_MINCOORD-1,this._sectionBeginScan(l);this._sectionHasBlockedEdge();)this._sectionIsImmediate()&&(e=this._sectionGetBlockedEdge(),o(null!==e,"AREdgeList._blockPushForward: blocked !== null FAILED"),null!==e.getBlockPrev()&&(t=this._blockPushBackward(e,l)||t),l.edgeFixed||(e.bracketOpening||l.bracketClosing?a<e.positionY&&(a=e.positionY,i=e):s<e.positionY&&(s=e.positionY,n=e)));n?i?(l.setClosestPrev(a>s?i:n),s=l.positionY-s,a=this._blockGetF(l.positionY-a,0,1),l.setBlockPrev(s>a?i:n)):(l.setBlockPrev(n),l.setClosestPrev(n)):(l.setBlockPrev(i),l.setClosestPrev(i)),l=l.orderNext}return this._positionAllStoreY(),t},d.prototype.blockScanBackward=function(){this._positionAllLoadX();var t=!1;this.sectionReset();for(var e,n,i,s,a,l=this.orderLast;l;){for(n=null,i=null,s=r.ED_MAXCOORD+1,a=r.ED_MAXCOORD+1,this._sectionBeginScan(l);this._sectionHasBlockedEdge();)this._sectionIsImmediate()&&(e=this._sectionGetBlockedEdge(),o(null!==e,"AREdgeList.blockScanBackward: blocked !== null FAILED"),null!==e.getBlockNext()&&(t=this._blockPushForward(e,l)||t),l.edgeFixed||(l.bracketOpening||e.bracketClosing?a>e.positionY&&(a=e.positionY,i=e):s>e.positionY&&(s=e.positionY,n=e)));n?i?(l.setClosestNext(s>a?i:n),s-=l.positionY,a=this._blockGetF(a-l.positionY,0,1),l.setBlockNext(s>a?i:n)):(l.setBlockNext(n),l.setClosestNext(n)):(l.setBlockNext(i),l.setClosestNext(i)),l=l.orderPrev}return this._positionAllStoreY(),t},d.prototype.blockSwitchWrongs=function(){var t=!1;this._positionAllLoadX();for(var e,n,i,r,s,a=this.orderFirst;null!==a;){if(null!==a.getClosestPrev()&&a.getClosestPrev().getClosestNext()!==a&&null!==a.getClosestNext()&&a.getClosestNext().getClosestPrev()===a)for(o(!a.edgeFixed,"AREdgeList.blockSwitchWrongs: !second.edgeFixed FAILED"),e=a,n=e.getClosestNext();null!==n&&e===n.getClosestPrev();)if(o(null!==e&&!e.edgeFixed,"AREdgeList.blockSwitchWrongs: edge != null && !edge.edgeFixed FAILED"),o(null!==n&&!n.edgeFixed,"AREdgeList.blockSwitchWrongs: next != null && !next.edgeFixed FAILED"),i=e.positionY,r=n.positionY,o(r>=i,"AREdgeList.blockSwitchWrongs: ey <= ny FAILED"),r>=i+1&&this._bracketShouldBeSwitched(e,n)){if(t=!0,o(!e.getEdgeCanpassed()&&!n.getEdgeCanpassed(),"AREdgeList.blockSwitchWrongs: !edge.getEdgeCanpassed() && !next.getEdgeCanpassed() FAILED"),e.setEdgeCanpassed(!0),n.setEdgeCanpassed(!0),s=null!==this._slideButNotPassEdges(e,(r+i)/2+.001),s=null!==this._slideButNotPassEdges(n,(r+i)/2-.001)||s){e.setClosestPrev(null),e.setClosestNext(null),n.setClosestPrev(null),n.setClosestNext(null),e.setEdgeCanpassed(!1),n.setEdgeCanpassed(!1);break}null!==e.getClosestPrev()&&e.getClosestPrev().getClosestNext()===e&&e.getClosestPrev().setClosestNext(n),null!==n.getClosestNext()&&n.getClosestNext().getClosestPrev()===n&&n.getClosestNext().setClosestPrev(e),e.setClosestNext(n.getClosestNext()),n.setClosestNext(e),n.setClosestPrev(e.getClosestPrev()),e.setClosestPrev(n),e.setEdgeCanpassed(!1),n.setEdgeCanpassed(!1),o(!this._bracketShouldBeSwitched(n,e),"AREdgeList.blockSwitchWrongs: !bracketShouldBeSwitched(next, edge) FAILED"),null!==n.getClosestPrev()&&n.getClosestPrev().getClosestNext()===n?e=n.getClosestPrev():n=e.getClosestNext()}else e=n,n=n.getClosestNext();a=a.orderNext}return t&&this._positionAllStoreY(),t},d.prototype.assertValid=function(){for(var t=this.orderFirst;t;)o(void 0!==t.startpoint.x,"Edge has unrecognized startpoint: "+t.startpoint),o(void 0!==t.endpoint.x,"Edge has unrecognized endpoint: "+t.endpoint),t=t.orderNext},e.exports=d},{"./AutoRouter.Box":10,"./AutoRouter.Constants":11,"./AutoRouter.Edge":12,"./AutoRouter.Logger":15,"./AutoRouter.Path":16,"./AutoRouter.Port":19,"./AutoRouter.Utils":22,assert:1}],14:[function(t,e,n){var i=t("./AutoRouter.Logger"),o=t("assert"),r=t("./AutoRouter.Constants"),s=t("./AutoRouter.Utils"),a=t("./AutoRouter.Point"),l=t("./AutoRouter.PointList"),c=t("./AutoRouter.Rect"),d=t("./AutoRouter.Path"),h=t("./AutoRouter.Port"),p=t("./AutoRouter.Box"),g=(t("./AutoRouter.Edge"),t("./AutoRouter.EdgeList")),u=new i("AutoRouter.Graph"),f=1,m=function(){this.completelyConnected=!0,this.horizontal=new g(!0),this.vertical=new g(!1),this.boxes={},this.paths=[],this.bufferBoxes=[],this.box2bufferBox={},this.horizontal.owner=this,this.vertical.owner=this,this.selfPoints=[new a(r.ED_MINCOORD,r.ED_MINCOORD),new a(r.ED_MAXCOORD,r.ED_MINCOORD),new a(r.ED_MAXCOORD,r.ED_MAXCOORD),new a(r.ED_MINCOORD,r.ED_MAXCOORD)],this._addSelfEdges()};m.prototype._deleteAllBoxes=function(){for(var t=Object.keys(this.boxes),e=t.length;e--;)this.boxes[t[e]].destroy(),delete this.boxes[t[e]];this.bufferBoxes=[],this.box2bufferBox={}},m.prototype._getBoxAt=function(t,e){for(var n=Object.keys(this.boxes),i=n.length;i--;)if(this.boxes[n[i]].isBoxAt(t,e))return this.boxes[n[i]];return null},m.prototype._setPortAttr=function(t,e){this._disconnectPathsFrom(t),t.attributes=e},m.prototype._isRectClipBoxes=function(t){for(var e,n=Object.keys(this.boxes),i=n.length;i--;)if(e=this.boxes[n[i]].rect,s.isRectClip(t,e))return!0;return!1},m.prototype._isRectClipBufferBoxes=function(t){for(var e,n=this.bufferBoxes.length;n--;)for(e=this.bufferBoxes[n].children.length;e--;)if(s.isRectClip(t,this.bufferBoxes[n].children[e]))return!0;return!1},m.prototype._isLineClipBufferBoxes=function(t,e){var n=new c(t,e);return n.normalizeRect(),o(n.left===n.right||n.ceil===n.floor,"ARGraph.this._isLineClipBoxes: rect.left === rect.right || rect.ceil === rect.floor FAILED"),n.left===n.right&&n.right++,n.ceil===n.floor&&n.floor++,this._isRectClipBufferBoxes(n)},m.prototype._isLineClipBoxes=function(t,e){var n=new c(t,e);return n.normalizeRect(),o(n.left===n.right||n.ceil===n.floor,"ARGraph.isLineClipBoxes: rect.left === rect.right || rect.ceil === rect.floor FAILED"),n.left===n.right&&n.right++,n.ceil===n.floor&&n.floor++,this._isRectClipBoxes(n)},m.prototype._canBoxAt=function(t){return!this._isRectClipBoxes.inflatedRect(t,1)},m.prototype._add=function(t){o(null!==t,"ARGraph.add: path !== null FAILED"),o(!t.hasOwner(),"ARGraph.add: !path.hasOwner() FAILED"),t.owner=this,this.paths.push(t),this.horizontal.addPathEdges(t),this.vertical.addPathEdges(t),r.DEBUG&&this._assertValidPath(t)},m.prototype._deleteAllPaths=function(){for(var t=this.paths.length;t--;)this.paths[t].destroy();this.paths=[]},m.prototype._hasNoPath=function(){return 0===this.paths.length},m.prototype._getPathCount=function(){return this.paths.length},m.prototype._getListEdgeAt=function(t,e){var n=this.horizontal.getEdgeAt(t,e);return n?n:this.vertical.getEdgeAt(t,e)},m.prototype._getSurroundRect=function(){var t,e=new c(0,0,0,0),n=Object.keys(this.boxes);for(t=n.length;t--;)e.unionAssign(this.boxes[n[t]].rect);for(t=this.paths.length;t--;)e.unionAssign(this.paths[t].getSurroundRect());return e},m.prototype._getOutOfBox=function(t){var e=this.box2bufferBox[t.box.id],n=e.children,i=e.children.length,a=t.point,l=t.dir,d=new c(t.box.rect);for(d.inflateRect(r.BUFFER),o(s.isRightAngle(l),"ARGraph.getOutOfBox: Utils.isRightAngle (dir) FAILED");d.ptInRect(a);){for(s.isHorizontal(l)?a.x=s.getRectOuterCoord(d,l):a.y=s.getRectOuterCoord(d,l);i--;)if(n[i].ptInRect(a)){d=n[i];break}i=e.children.length}o(!d.ptInRect(a),"ARGraph.getOutOfBox: !boxRect.ptInRect( point) FAILED")},m.prototype._goToNextBufferBox=function(t){var e=t.point,n=t.end,i=t.dir,l=void 0!==t.dir2&&s.isRightAngle(t.dir2)?t.dir2:n instanceof a?s.exGetMajorDir(n.minus(e)):r.DirNone,c=void 0!==t.end?t.end:1===i||2===i?r.ED_MAXCOORD:r.ED_MINCOORD;l===i&&(l=s.isRightAngle(s.exGetMinorDir(n.minus(e)))?s.exGetMinorDir(n.minus(e)):(i+1)%4),n instanceof a&&(c=s.getPointCoord(c,i)),o(s.isRightAngle(i),"ArGraph.goToNextBufferBox: Utils.isRightAngle (dir) FAILED"),o(s.getPointCoord(e,i)!==c,"ArGraph.goToNextBufferBox: Utils.getPointCoord (point, dir) !== stophere FAILED");for(var d,h=null,p=-1;++p<this.bufferBoxes.length;)d=this.bufferBoxes[p].box,!s.isPointInDirFrom(e,d,i)&&s.isPointBetweenSides(e,d,i)&&s.isCoordInDirFrom(c,s.getChildRectOuterCoordFrom(this.bufferBoxes[p],i,e).coord,i)&&(c=s.getChildRectOuterCoordFrom(this.bufferBoxes[p],i,e).coord,h=this.bufferBoxes[p]);return s.isHorizontal(i)?e.x=c:e.y=c,h},m.prototype._hugChildren=function(t,e,n,i,l){o((n+i)%2===1,"ARGraph.hugChildren: One and only one direction must be horizontal");var c,d,h,p=t.children,g=t.box,f=new a(e),m=this._goToNextBox(e,n,1===n||2===n?r.ED_MAXCOORD:r.ED_MINCOORD,p),_=i,b=s.nextClockwiseDir(n)===i?s.nextClockwiseDir:s.prevClockwiseDir,y=[new a(e)],v=!0;for(o(null!==m,"ARGraph.hugChildren: child !== null FAILED"),l=void 0===l?function(t){return!g.ptInRect(t)}:l,u.info("About to hug child boxes to find a path");v&&!l(e,t);)h=new a(e),d=this._goToNextBox(e,_,s.getRectOuterCoord(m,_),p),y[y.length-1].equals(h)||y.push(new a(h)),null===d?_=s.reverseDir(b(_)):s.isCoordInDirFrom(s.getRectOuterCoord(d,s.reverseDir(b(_))),s.getPointCoord(e,s.reverseDir(b(_))),s.reverseDir(b(_)))&&(_=b(_),m=d),void 0===c?c=new a(e):c.equals(h)||(v=!e.equals(c));return y[0].equals(f)&&y.splice(0,1),v||(y=null,e.assign(f)),y},m.prototype._goToNextBox=function(t,e,n,i){var r=n;n instanceof a&&(r=s.getPointCoord(r,e)),o(s.isRightAngle(e),"ArGraph.goToNextBox: Utils.isRightAngle (dir) FAILED"),o(s.getPointCoord(t,e)!==r,"ArGraph.goToNextBox: Utils.getPointCoord (point, dir) !== stophere FAILED");for(var l,c=null,d=i.length;d--;)l=i[d],s.isPointInDirFrom(t,l,s.reverseDir(e))&&s.isPointBetweenSides(t,l,e)&&s.isCoordInDirFrom(r,s.getRectOuterCoord(l,s.reverseDir(e)),e)&&(r=s.getRectOuterCoord(l,s.reverseDir(e)),c=i[d]);return s.isHorizontal(e)?t.x=r:t.y=r,c},m.prototype._getLimitsOfEdge=function(t,e,n,i){var r,s,l,c=new a(t),d=new a(e),h=Object.keys(this.boxes);if(c.y===d.y)for(c.x>d.x&&(r=c.x,c.x=d.x,d.x=r),s=h.length;s--;)l=this.boxes[h[s]].rect,c.x<l.right&&l.left<=d.x&&(l.floor<=c.y&&l.floor>n&&(n=l.floor),l.ceil>c.y&&l.ceil<i&&(i=l.ceil));else for(o(c.x===d.x,"ARGraph.this.getLimitsOfEdge: start.x === end.x FAILED"),c.y>d.y&&(r=c.y,c.y=d.y,d.y=r),s=h.length;s--;)l=this.boxes[h[s]].rect,c.y<l.floor&&l.ceil<=d.y&&(l.right<=c.x&&l.right>n&&(n=l.right),l.left>c.x&&l.left<i&&(i=l.left));return i--,{min:n,max:i}},m.prototype._connect=function(t){var e=t.getStartPort(),n=t.getEndPort(),i=t.startpoint,r=t.endpoint;o(e.hasPoint(i),"ARGraph.connect: startport.hasPoint(startpoint) FAILED"),o(n.hasPoint(r),"ARGraph.connect: endport.hasPoint(endpoint) FAILED");var a=e.owner.getRootBox(),l=n.owner.getRootBox(),c=a.id,d=l.id,h=e.portOnWhichEdge(i),p=n.portOnWhichEdge(r);return i.equals(r)&&s.stepOneInDir(i,s.nextClockwiseDir(h)),t.isAutoRouted()?this.box2bufferBox[c]===this.box2bufferBox[d]&&h===s.reverseDir(p)&&a!==l?this._connectPointsSharingParentBox(t,i,r,h):this._connectPathWithPoints(t,i,r):(t.createCustomPath(),this.horizontal.addPathEdges(t)&&this.vertical.addPathEdges(t))},m.prototype._connectPathWithPoints=function(t,e,n){o(e instanceof a,"ARGraph.connect: startpoint instanceof ArPoint FAILED"),o(null!==t&&t.owner===this,"ARGraph.connect: path !== null && path.owner === self FAILED"),o(!t.isConnected(),"ARGraph.connect: !path.isConnected() FAILED"),o(!e.equals(n),"ARGraph.connect: !startpoint.equals(endpoint) FAILED");var i=t.getStartPort();o(null!==i,"ARGraph.connect: startPort !== null FAILED");var l=i.portOnWhichEdge(e),c=t.getEndPort();o(null!==c,"ARGraph.connect: endPort !== null FAILED");var d=c.portOnWhichEdge(n);o(s.isRightAngle(l)&&s.isRightAngle(d),"ARGraph.connect: Utils.isRightAngle (startdir) && Utils.isRightAngle (enddir) FAILED");var h=new a(e);this._getOutOfBox({point:h,dir:l,end:n,box:i.owner}),o(!h.equals(e),"ARGraph.connect: !start.equals(startpoint) FAILED");var p=new a(n);this._getOutOfBox({point:p,dir:d,end:h,box:c.owner}),o(!p.equals(n),"ARGraph.connect: !end.equals(endpoint) FAILED");var g,u=t.isAutoRouted();return u&&(g=this._connectPoints(h,p,l,d)),t.points=g,t.points.unshift(e),t.points.push(n),u&&(this._simplifyPathCurves(t),t.simplifyTrivially(),this._simplifyPathPoints(t),this._centerStairsInPathPoints(t,l,d)),t.setState(r.PathStateConnected),this.horizontal.addPathEdges(t)&&this.vertical.addPathEdges(t)},m.prototype._connectPointsSharingParentBox=function(t,e,n,i){var o=new a(e),l=n.x-o.x,c=n.y-o.y;return t.deleteAll(),t.addTail(e),0!==l&&0!==c&&(s.isHorizontal(i)?(o.x+=l/2,t.addTail(new a(o)),o.y+=c,t.addTail(new a(o))):(o.y+=c/2,t.addTail(new a(o)),o.x+=l,t.addTail(new a(o)))),t.addTail(n),t.setState(r.PathStateConnected),this.horizontal.addPathEdges(t)&&this.vertical.addPathEdges(t)},m.prototype._connectPoints=function(t,e,n,i,d){for(var h,p,g,f,m,_,b,y,v,C,E,D=new l,I=new a(t),P=function(t,n){return(t.x===e.x||t.y===e.y)&&!s.isLineClipRects(t,e,n.children)},T=function(t,n){return s.getPointCoord(t,f)===s.getRectOuterCoord(n.box,f)||s.isPointInDirFrom(t,e,f)};!t.equals(e);)if(f=s.exGetMajorDir(e.minus(t)),m=s.exGetMinorDir(e.minus(t)),o(f!==r.DirNone,"ARGraph.connectPoints: dir1 !== CONSTANTS.DirNone FAILED"),o(f===s.getMajorDir(e.minus(t)),"ARGraph.connectPoints: dir1 === Utils.getMajorDir(end.minus(start)) FAILED"),o(m===r.DirNone||m===s.getMinorDir(e.minus(t)),"ARGraph.connectPoints: dir2 === CONSTANTS.DirNone || dir2 === Utils.getMinorDir(end.minus(start)) FAILED"),m===n&&m!==r.DirNone&&(m=f,f=n),D.push(new a(t)),_=new a(t),h=this._goToNextBufferBox({point:t,dir:f,dir2:m,end:e}),p=null===h?null:h.box,t.equals(_)){if(o(null!==p,"ARGraph.connectPoints: box !== null FAILED"),g=p instanceof c?p:p.rect,m===r.DirNone&&(m=s.nextClockwiseDir(f)),o(f!==m&&f!==r.DirNone&&m!==r.DirNone,"ARGraph.connectPoints: dir1 !== dir2 && dir1 !== CONSTANTS.DirNone && dir2 !== CONSTANTS.DirNone FAILED"),h.box.ptInRect(e)&&!h.box.ptInRect(t)&&d)s.isHorizontal(f)?t.x=e.x:t.y=e.y;else if(h.box.ptInRect(e))if(d)v=this._hugChildren(h,t,f,m,P),null!==v?(v.length&&(D=D.concat(v)),D.push(new a(t)),t.assign(e)):(o(s.isRightAngle(f),"ARGraph.connectPoints: Utils.isRightAngle (dir1) FAILED"),s.isHorizontal(f)?t.x=e.x:t.y=e.y,D.push(new a(t)),s.isHorizontal(f)?t.y=e.y:t.x=e.x,D.push(new a(t)),o(t.equals(e))),o(!t.equals(_));else{for(u.info("Could not find path from",t,"to",e,". Flipping start and end points"),b=new a(e),y=this._connectPoints(e,t,i,f,!0),E=y.length-1;E-->1;)D.push(y[E]);o(t.equals(e),"ArGraph.connectPoints: start.equals(end) FAILED"),_=r.EMPTY_POINT,t=e=b}else s.isPointInDirFrom(e,g,m)?(o(!s.isPointInDirFrom(t,g,m),"ARGraph.connectPoints: !Utils.isPointInDirFrom(start, rect, dir2) FAILED"),p=this._goToNextBufferBox({point:t,dir:m,dir2:f,end:e}),t.equals(_)&&(v=p.children.length>1?this._hugChildren(p,t,m,f,T):this._hugChildren(h,t,f,m),null!==v?D=D.concat(v):(o(s.isRightAngle(f),"ARGraph.getOutOfBox: Utils.isRightAngle (dir1) FAILED"),s.isHorizontal(f)?t.x=s.getRectOuterCoord(h.box,f):t.y=s.getRectOuterCoord(h.box,f)))):(o(s.isPointBetweenSides(e,g,f),"ARGraph.connectPoints: Utils.isPointBetweenSides(end, rect, dir1) FAILED"),o(!s.isPointIn(e,g),"ARGraph.connectPoints: !Utils.isPointIn(end, rect) FAILED"),C=0,s.reverseDir(m)===i&&s.getChildRectOuterCoordFrom(h,s.reverseDir(m),t)===s.getRectOuterCoord(g,s.reverseDir(m))?C=1:m!==i&&(s.isPointBetweenSides(I,g,f)?s.isPointInDirFrom(g.getTopLeft().plus(g.getBottomRight()),t.plus(e),m)&&(C=1):s.isPointInDirFrom(t,I,m)&&(C=1)),C&&(m=s.reverseDir(m)),1===h.children.length?(s.isHorizontal(m)?t.x=s.getRectOuterCoord(g,m):t.y=s.getRectOuterCoord(g,m),o(!t.equals(_),"ARGraph.connectPoints: !start.equals(old) FAILED"),D.push(new a(t)),_.assign(t),s.isHorizontal(f)?t.x=s.getRectOuterCoord(g,f):t.y=s.getRectOuterCoord(g,f),o(s.isPointInDirFrom(e,t,f),"ARGraph.connectPoints: Utils.isPointInDirFrom(end, start, dir1) FAILED"),s.getPointCoord(t,f)!==s.getPointCoord(e,f)&&this._goToNextBufferBox({point:t,dir:f,end:e})):(v=this._hugChildren(h,t,f,m,T),null!==v?D=D.concat(v):(o(s.isRightAngle(f),"ARGraph.getOutOfBox: Utils.isRightAngle (dir1) FAILED"),s.isHorizontal(f)?t.x=s.getRectOuterCoord(h.box,f):t.y=s.getRectOuterCoord(h.box,f))));o(!t.equals(_),"ARGraph.connectPoints: !start.equals(old) FAILED")}return D.push(e),r.DEBUG&&D.assertValid(),D},m.prototype._disconnectAll=function(){for(var t=this.paths.length;t--;)this.disconnect(this.paths[t])},m.prototype.disconnect=function(t){t.isConnected()&&this.deleteEdges(t),t.deleteAll(),this.completelyConnected=!1},m.prototype._disconnectPathsClipping=function(t){for(var e=this.paths.length;e--;)this.paths[e].isPathClip(t)&&this.disconnect(this.paths[e])},m.prototype._disconnectPathsFrom=function(t){var e,n,i,r=this.paths.length;if(t instanceof p)for(var s,a,l=t;r--;)e=this.paths[r],o(null!==e.startports,"ARGraph.disconnectPathsFrom: startport !== null FAILED"),o(e.startports.length>0,"ARGraph.disconnectPathsFrom: Path has no startports"),o(null!==e.endports,"ARGraph.disconnectPathsFrom: endport !== null FAILED"),o(e.endports.length>0,"ARGraph.disconnectPathsFrom: Path has no endports"),s=e.startports[0].owner,a=e.endports[0].owner,o(null!==s,"ARGraph.disconnectPathsFrom: startbox !== null FAILED"),o(null!==a,"ARGraph.disconnectPathsFrom: endbox !== null FAILED"),(s===l||a===l)&&this.disconnect(e);else for(var c=t;r--;)e=this.paths[r],n=e.getStartPort(),i=e.getEndPort(),(n===c||i===c)&&this.disconnect(e)},m.prototype._addSelfEdges=function(){this.horizontal.addEdges(this),this.vertical.addEdges(this)},m.prototype._addEdges=function(t){o(!(t instanceof d),"No Paths should be here!"),t instanceof h?(this.horizontal.addPortEdges(t),this.vertical.addPortEdges(t)):(this.horizontal.addEdges(t),this.vertical.addEdges(t))},m.prototype.deleteEdges=function(t){this.horizontal.deleteEdges(t),this.vertical.deleteEdges(t)},m.prototype._addAllEdges=function(){o(this.horizontal.isEmpty()&&this.vertical.isEmpty(),"ARGraph.addAllEdges: horizontal.isEmpty() && vertical.isEmpty() FAILED");var t,e=Object.keys(this.boxes);for(t=e.length;t--;)this._addBoxAndPortEdges(this.boxes[e[t]]);for(t=this.paths.length;t--;)this.horizontal.addPathEdges(this.paths[t]),this.vertical.addPathEdges(this.paths[t])},m.prototype._deleteAllEdges=function(){this.horizontal.deleteAllEdges(),this.vertical.deleteAllEdges()},m.prototype._addBoxAndPortEdges=function(t){o(null!==t,"ARGraph.addBoxAndPortEdges: box !== null FAILED"),this._addEdges(t);for(var e=t.ports.length;e--;)this._addEdges(t.ports[e]);this._addToBufferBoxes(t),this._updateBoxPortAvailability(t)},m.prototype._deleteBoxAndPortEdges=function(t){o(null!==t,"ARGraph.deleteBoxAndPortEdges: box !== null FAILED"),this.deleteEdges(t);for(var e=t.ports.length;e--;)this.deleteEdges(t.ports[e]);this._removeFromBufferBoxes(t)},m.prototype._getEdgeList=function(t){return t?this.horizontal:this.vertical},m.prototype._candeleteTwoEdgesAt=function(t,e,n){if(r.DEBUG&&(o(t.owner===this,"ARGraph.candeleteTwoEdgesAt: path.owner === this FAILED"),t.assertValid(),o(t.isConnected(),"ARGraph.candeleteTwoEdgesAt: path.isConnected() FAILED"),e.AssertValidPos(n)),n+2>=e.length||1>n)return!1;var i=n,l=e[n++],c=n,d=e[n++],h=n;n=i,n--;var p=n,g=e[n--],u=n;if(d.equals(l))return!1;o(u<e.length&&p<e.length&&i<e.length&&c<e.length&&h<e.length,"ARGraph.candeleteTwoEdgesAt: pppointpos < points.length && ppointpos < points.length &&pointpos < points.length && npointpos < points.length && nnpointpos < points.length FAILED");var f=s.getDir(d.minus(l));o(s.isRightAngle(f),"ARGraph.candeleteTwoEdgesAt: Utils.isRightAngle (dir) FAILED");var m=s.isHorizontal(f),_=new a;return m?(_.x=s.getPointCoord(d,m),_.y=s.getPointCoord(g,!m)):(_.y=s.getPointCoord(d,m),_.x=s.getPointCoord(g,!m)),o(s.getDir(_.minus(g))===f,"ARGraph.candeleteTwoEdgesAt: Utils.getDir (newpoint.minus(ppoint)) === dir FAILED"),this._isLineClipBoxes(_,d)?!1:this._isLineClipBoxes(_,g)?!1:!0},m.prototype._deleteTwoEdgesAt=function(t,e,n){r.DEBUG&&(o(t.owner===this,"ARGraph.deleteTwoEdgesAt: path.owner === this FAILED"),t.assertValid(),o(t.isConnected(),"ARGraph.deleteTwoEdgesAt: path.isConnected() FAILED"),e.AssertValidPos(n));var i=n,l=e[n++],c=n,d=e[n++],h=n,p=e[n++],g=n;n=i,n--;var u=n,f=e[n--],m=n,_=e[n--];o(m<e.length&&u<e.length&&i<e.length&&c<e.length&&h<e.length,"ARGraph.deleteTwoEdgesAt: pppointpos < points.length && ppointpos < points.length && pointpos < points.length && npointpos < points.length && nnpointpos < points.length FAILED"),o(null!==_&&null!==f&&null!==l&&null!==d&&null!==p,"ARGraph.deleteTwoEdgesAt: pppoint !== null && ppoint !== null && point !== null && npoint !== null && nnpoint !== null FAILED");var b=s.getDir(d.minus(l));o(s.isRightAngle(b),"ARGraph.deleteTwoEdgesAt: Utils.isRightAngle (dir) FAILED");var y=s.isHorizontal(b),v=new a;y?(v.x=s.getPointCoord(d,y),v.y=s.getPointCoord(f,!y)):(v.x=s.getPointCoord(f,!y),v.y=s.getPointCoord(d,y)),o(s.getDir(v.minus(f))===b,"ARGraph.deleteTwoEdgesAt: Utils.getDir (newpoint.minus(ppoint)) === dir FAILED"),o(!this._isLineClipBoxes(v,d),"ARGraph.deleteTwoEdgesAt: !isLineClipBoxes(newpoint, npoint) FAILED"),o(!this._isLineClipBoxes(v,f),"ARGraph.deleteTwoEdgesAt: !isLineClipBoxes(newpoint, ppoint) FAILED");var C=this._getEdgeList(y),E=this._getEdgeList(!y),D=C.getEdgeByPointer(_),I=E.getEdgeByPointer(f),P=C.getEdgeByPointer(l),T=E.getEdgeByPointer(d);if(o(null!==D&&null!==I&&null!==P&&null!==T,"ARGraph.deleteTwoEdgesAt:  ppedge !== null && pedge !== null && nedge !== null && nnedge !== null FAILED"),E.remove(I),C.remove(P),e.splice(u,3,v),D.endpointNext=p,D.endpoint=v,T.startpoint=v,T.startpointPrev=_,g<e.length){var A=C.getEdgeByPointer(p,g);o(null!==A,"ARGraph.deleteTwoEdgesAt: nnnedge !== null FAILED"),o(A.startpointPrev.equals(d)&&A.startpoint.equals(p),"ARGraph.deleteTwoEdgesAt: nnnedge.startpointPrev.equals(npoint)&& nnnedge.startpoint.equals(nnpoint) FAILED"),A.startpointPrev=f}p.equals(v)&&this._deleteSamePointsAt(t,e,u)},m.prototype._deleteSamePointsAt=function(t,e,n){r.DEBUG&&(o(t.owner===this,"ARGraph.deleteSamePointsAt: path.owner === this FAILED"),t.assertValid(),o(t.isConnected(),"ARGraph.deleteSamePointsAt: path.isConnected() FAILED"),e.AssertValidPos(n));var i=n,a=e[n++],l=n,c=e[n++],d=n,h=e[n++],p=n;n=i,n--;var g=n,u=e[n--],f=n,m=n===e.length?null:e[n--];o(g<e.length&&i<e.length&&l<e.length&&d<e.length),o(null!==u&&null!==a&&null!==c&&null!==h,"ARGraph.deleteSamePointsAt: ppoint !== null && point !== null && npoint !== null && nnpoint !== null FAILED"),o(a.equals(c)&&!a.equals(u),"ARGraph.deleteSamePointsAt: point.equals(npoint) && !point.equals(ppoint) FAILED");var _=s.getDir(a.minus(u));o(s.isRightAngle(_),"ARGraph.deleteSamePointsAt: Utils.isRightAngle (dir) FAILED");var b=s.isHorizontal(_),y=this._getEdgeList(b),v=this._getEdgeList(!b),C=y.getEdgeByPointer(u,a),E=v.getEdgeByPointer(a,c),D=y.getEdgeByPointer(c,h);if(o(null!==C&&null!==E&&null!==D,"ARGraph.deleteSamePointsAt: pedge !== null && nedge !== null && nnedge !== null FAILED"),
v.remove(C),y.remove(E),e.splice(i,2),f<e.length){var I=v.getEdgeByPointer(m,u);o(null!==I&&I.endpoint.equals(u)&&I.endpointNext.equals(a),"ARGraph.deleteSamePointsAt: ppedge !== null && ppedge.endpoint.equals(ppoint) && ppedge.endpointNext.equals(point) FAILED"),I.endpointNext=h}if(o(D.startpoint.equals(c)&&D.startpointPrev.equals(a),"ARGraph.deleteSamePointsAt: nnedge.startpoint.equals(npoint) && nnedge.startpointPrev.equals(point) FAILED"),D.setStartPoint(u),D.startpointPrev=m,p<e.length){var P=v.getEdgeByPointer(h,p);o(null!==P&&P.startpointPrev.equals(c)&&P.startpoint.equals(h),"ARGraph.deleteSamePointsAt: nnnedge !== null && nnnedge.startpointPrev.equals(npoint) && nnnedge.startpoint.equals(nnpoint) FAILED"),P.startpointPrev=u}r.DEBUG_DEEP&&t.assertValid()},m.prototype._simplifyPaths=function(){for(var t,e,n,i=!1,o=this.paths.length;o--;)if(t=this.paths[o],t.isAutoRouted())for(e=t.getPointList(),n=0,i=this._fixShortPaths(t)||i;n<e.length;){if(this._candeleteTwoEdgesAt(t,e,n)){this._deleteTwoEdgesAt(t,e,n),i=!0;break}n++}return i},m.prototype._centerStairsInPathPoints=function(t,e,n){o(null!==t,"ARGraph.centerStairsInPathPoints: path !== null FAILED"),o(!t.isConnected(),"ARGraph.centerStairsInPathPoints: !path.isConnected() FAILED");var i=t.getPointList();o(i.length>=2,"ARGraph.centerStairsInPathPoints: pointList.length >= 2 FAILED"),r.DEBUG&&t.assertValidPoints();var l,c,d,h,p=i.length,g=i.length,u=i.length,f=i.length,m=r.DirNone,_=r.DirNone,b=r.DirNone,y=t.getOutOfBoxStartPoint(e),v=t.getOutOfBoxEndPoint(n),C=0;o(C<i.length,"ARGraph.centerStairsInPathPoints pos < pointList.length FAILED"),p=C,l=i[C++];for(var E,D,I,P,T,A,x,w,N;C<i.length;)f=u,u=g,g=p,p=C,h=d,d=c,c=l,l=i[C++],b=_,_=m,g<i.length&&(m=s.getDir(c.minus(l)),r.DEBUG&&(o(s.isRightAngle(m),"ARGraph.centerStairsInPathPoints: Utils.isRightAngle (d12) FAILED"),u!==i.end()&&o(s.areInRightAngle(m,_),"ARGraph.centerStairsInPathPoints: Utils.areInRightAngle (d12, d23) FAILED"))),f<i.length&&m===b&&(o(p<i.length&&g<i.length&&u<i.length&&f<i.length,"ARGraph.centerStairsInPathPoints: p1p < pointList.length && p2p < pointList.length && p3p < pointList.length && p4p < pointList.length FAILED"),E=new a(c),D=new a(d),I=s.isHorizontal(m),P=s.getPointCoord(h,I),T=s.getPointCoord(d,I),A=s.getPointCoord(l,I),P>A&&(w=A,A=P,P=w),T>P&&A>T&&(N=Math.round((P+A)/2),I?(E.x=N,D.x=N):(E.y=N,D.y=N),x=this._getLimitsOfEdge(E,D,P,A),P=x.min,A=x.max,N=Math.round((P+A)/2),I?(E.x=N,D.x=N):(E.y=N,D.y=N),this._isLineClipBoxes(E,D)||this._isLineClipBoxes(p===i.length?v:l,E)||this._isLineClipBoxes(0===f?y:h,D)||(c=E,d=D,i.splice(g,1,c),i.splice(u,1,d))));r.DEBUG&&t.assertValidPoints()},m.prototype._fixShortPaths=function(t){var e=!1,n=t.getStartPort(),i=t.getEndPort(),o=t.getPointList().length;if(4===o){var r,l,c=t.getPointList(),d=c[0],h=c[o-1],p=n.portOnWhichEdge(d),g=i.portOnWhichEdge(h);if(p===s.reverseDir(g)){var u,f,m=s.isHorizontal(p),_=new a(d),b=new a(h),y=n.rect,v=i.rect;if(m){u=Math.min(y.floor,v.floor),f=Math.max(y.ceil,v.ceil);var C=(u+f)/2;_.y=C,b.y=C,r=new a(s.getRectOuterCoord(n.owner.rect,p),_.y),l=new a(s.getRectOuterCoord(i.owner.rect,g),b.y)}else{u=Math.min(y.right,v.right),f=Math.max(y.left,v.left);var E=(u+f)/2;_.x=E,b.x=E,r=new a(_.x,s.getRectOuterCoord(n.owner.rect,p)),l=new a(b.x,s.getRectOuterCoord(i.owner.rect,g))}var D=y.ptInRect(_)&&!y.onCorner(_)&&v.ptInRect(b)&&!v.onCorner(b);if(D&&!this._isLineClipBoxes(r,l)){var I=this._getEdgeList(m),P=this._getEdgeList(!m),T=I.getEdgeByPointer(d),A=P.getEdgeByPointer(c[1]),x=I.getEdgeByPointer(c[2]);P.remove(A),I.remove(x),I.remove(T),d.assign(_),h.assign(b),T.setEndPoint(h),T.startpointPrev=null,T.endpointNext=null,T.positionY=s.getPointCoord(_,s.nextClockwiseDir(p)),I.insert(T),c.splice(1,2),e=!0}}}return e},m.prototype._simplifyPathCurves=function(t){for(var e,n,i,o=t.getPointList(),r=0;r<o.length-3;){for(e=o[r],i=o.length;i-->0;)if(n=o[i],s.isRightAngle(s.getDir(e.minus(n)))&&!this._isLineClipBoxes(e,n)||e.equals(n)){o.splice(r+1,i-r-1);break}++r}},m.prototype._simplifyPathPoints=function(t){o(null!==t,"ARGraph.simplifyPathPoints: path !== null FAILED"),o(!t.isConnected(),"ARGraph.simplifyPathPoints: !path.isConnected() FAILED");var e=t.getPointList();o(e.length>=2,"ARGraph.simplifyPathPoints: pointList.length >= 2 FAILED"),r.DEBUG&&t.assertValidPoints();var n,i,l,c,d,h,p,g,u=e.length,f=e.length,m=e.length,_=e.length,b=e.length,y=0;for(o(y<e.length,"ARGraph.simplifyPathPoints: pos < pointList.length FAILED"),u=y,n=e[y++];y<e.length;)b=_,_=m,m=f,f=u,u=y,d=c,c=l,l=i,i=n,n=e[y++],b<e.length&&(o(u<e.length&&f<e.length&&m<e.length&&_<e.length&&b<e.length,"ARGraph.simplifyPathPoints: p1p < pointList.length && p2p < pointList.length && p3p < pointList.length && p4p < pointList.length && p5p < pointList.length FAILED"),o(!(n.equals(i)||i.equals(l)||l.equals(c)||c.equals(d)),"ARGraph.simplifyPathPoints: !p1.equals(p2) && !p2.equals(p3) && !p3.equals(p4) && !p4.equals(p5) FAILED"),p=s.getDir(i.minus(n)),o(s.isRightAngle(p),"ARGraph.simplifyPathPoints: Utils.isRightAngle (d) FAILED"),g=s.isHorizontal(p),h=new a,g?(h.x=s.getPointCoord(d,g),h.y=s.getPointCoord(n,!g)):(h.x=s.getPointCoord(n,!g),h.y=s.getPointCoord(d,g)),this._isLineClipBoxes(i,h)||this._isLineClipBoxes(h,c)||(e.splice(f,1),e.splice(m,1),e.splice(_,1),h.equals(n)||h.equals(d)||e.splice(_,0,h),u=e.length,f=e.length,m=e.length,_=e.length,y=0));r.DEBUG&&t.assertValidPoints()},m.prototype._connectAllDisconnectedPaths=function(){for(var t,e,n=this.paths.length,i=!1,o=!1;!i&&!o;){for(i=!0,t=n;t--&&i;)e=this.paths[t],e.isConnected()||(i=this._connect(e),i||(e.areTherePathCustomizations()?e.removePathCustomizations():o=!0));i||o||this._disconnectAll()}this.completelyConnected=!0},m.prototype._updateBoxPortAvailability=function(t){var e,n,i,r,s={};e=this.box2bufferBox[t.id],o(e,"Bufferbox not found for "+t.id),n=e.children,i=t;do s[i.id]=!0,i=i.parent;while(i);for(var a=n.length;a--;)r=n[a].id,s[r]||t.rect.touching(n[a])&&(t.adjustPortAvailability(this.boxes[n[a].id]),this.boxes[n[a].id].adjustPortAvailability(t))},m.prototype._addToBufferBoxes=function(t){var e,n,i,s,a,l={rect:new c(t.rect),id:t.id},d=[],h=[],p=[t.id];for(l.rect.inflateRect(r.BUFFER),o(!this.box2bufferBox[t.id],"Can't add box to 2 bufferboxes"),s=this.bufferBoxes.length;s--;)if(l.rect.touching(this.bufferBoxes[s].box))for(a=this.bufferBoxes[s].children.length;a--;)i=this.bufferBoxes[s].children[a],l.rect.touching(i)&&(t.adjustPortAvailability(this.boxes[i.id]),this.boxes[i.id].adjustPortAvailability(t),-1===d.indexOf(s)&&d.push(s));if(n=new c(l.rect),0!==d.length)for(s=0;s<d.length;s++){for(o(d[s]<this.bufferBoxes.length,"ArGraph.addToBufferBoxes: overlapBoxes index out of bounds. ("+d[s]+" < "+this.bufferBoxes.length+")"),e=this.bufferBoxes.splice(d[s],1)[0],a=e.children.length;a--;)h.push(e.children[a]),p.push(e.children[a].id);n.unionAssign(e.box)}for(l.rect.id=t.id,h.push(l.rect),this.bufferBoxes.push({box:n,children:h}),s=p.length;s--;)this.box2bufferBox[p[s]]=this.bufferBoxes[this.bufferBoxes.length-1]},m.prototype._removeFromBufferBoxes=function(t){var e,n,i,r,s,a,l,d=this.box2bufferBox[t.id],h=this.bufferBoxes.indexOf(d),p=d.children,g=[],u=!1;for(o(-1!==h,"ARGraph.removeFromBufferBoxes: Can't find the correct bufferbox."),this.bufferBoxes.splice(h,1),this.box2bufferBox[t.id]=void 0,h=p.length;h--;)if(l=g.length,n=p[h],i=[n],u=!1,this.boxes[n.id].resetPortAvailability(),n.id!==t.id){for(;l--;){for(a=g[l].length;a--;)g[l][a].touching(n)&&(s=g[l][a].id,this.boxes[n.id].adjustPortAvailability(this.boxes[s]),this.boxes[s].adjustPortAvailability(this.boxes[n.id]),u=!0);u&&(i=i.concat(g.splice(l,1)[0]))}g.push(i)}for(h=g.length;h--;){for(a=g[h].length,e=new c(g[h][0]),r=[];a--;)e.unionAssign(g[h][a]),r.push(g[h][a].id);for(this.bufferBoxes.push({box:e,children:g[h]}),a=r.length;a--;)this.box2bufferBox[r[a]]=this.bufferBoxes[this.bufferBoxes.length-1]}},m.prototype.setBuffer=function(t){r.BUFFER=t},m.prototype.calculateSelfPoints=function(){this.selfPoints=[],this.selfPoints.push(new a(r.ED_MINCOORD,r.ED_MINCOORD)),this.selfPoints.push(new a(r.ED_MAXCOORD,r.ED_MINCOORD)),this.selfPoints.push(new a(r.ED_MAXCOORD,r.ED_MAXCOORD)),this.selfPoints.push(new a(r.ED_MINCOORD,r.ED_MAXCOORD))},m.prototype.createBox=function(){var t=new p;return o(null!==t,"ARGraph.createBox: box !== null FAILED"),t},m.prototype.addBox=function(t){o(null!==t,"ARGraph.addBox: box !== null FAILED"),o(t instanceof p,"ARGraph.addBox: box instanceof AutoRouterBox FAILED");var e=t.rect;this._disconnectPathsClipping(e),t.owner=this;for(var n=(f++).toString();n.length<6;)n="0"+n;n="BOX_"+n,t.id=n,this.boxes[n]=t,this._addBoxAndPortEdges(t);for(var i=t.childBoxes,r=i.length;r--;)this.addBox(i[r])},m.prototype.deleteBox=function(t){if(o(null!==t,"ARGraph.deleteBox: box !== null FAILED"),t.hasOwner()){var e=t.parent,n=t.childBoxes,i=n.length;for(e&&e.removeChild(t);i--;)this.deleteBox(n[i]);this._deleteBoxAndPortEdges(t),t.owner=null,o(void 0!==this.boxes[t.id],"ARGraph.remove: Box does not exist"),delete this.boxes[t.id]}t.destroy(),t=null},m.prototype.shiftBoxBy=function(t,e){o(null!==t,"ARGraph.shiftBoxBy: box !== null FAILED"),o(!!this.boxes[t.id],"ARGraph.shiftBoxBy: Box does not exist!");var n=this.box2bufferBox[t.id].box,i=t.childBoxes;this._disconnectPathsClipping(n),this._disconnectPathsFrom(t),this._deleteBoxAndPortEdges(t),t.shiftBy(e),this._addBoxAndPortEdges(t),n=t.rect,this._disconnectPathsClipping(n);for(var r=i.length;r--;)this.shiftBoxBy(i[r],e)},m.prototype.setBoxRect=function(t,e){null!==t&&(this._deleteBoxAndPortEdges(t),t.setRect(e),this._addBoxAndPortEdges(t),this._disconnectPathsClipping(e))},m.prototype.routeSync=function(){var t={finished:!1};for(this._connectAllDisconnectedPaths();!t.finished;)t=this._optimize(t)},m.prototype.routeAsync=function(t){var e=this,n=t.update||s.nop,i=t.first||s.nop,o=t.callback||s.nop,r=t.time||5,a=function(t){return u.info("Async optimization cycle started"),e.completelyConnected?(n(e.paths),t.finished?(u.info("Async routing finished"),o(e.paths)):(t=e._optimize(t),setTimeout(a,r,t))):(u.info("Async optimization interrupted"),setTimeout(l,r))},l=function(){u.info("Async routing started");var t={finished:!1};e._connectAllDisconnectedPaths(),setTimeout(a,r,t)};u.info("Async routing triggered");var c=this._quickConnectDisconnectedPaths();i(c),this._disconnectTempPaths(c),setTimeout(l,r)},m.prototype._quickConnectDisconnectedPaths=function(){for(var t,e=[],n=this.paths.length;n--;)t=this.paths[n],t.isConnected()||(t.calculateStartEndPorts(),t.points=new l(t.startpoint,t.endpoint),e.push(t));return e},m.prototype._disconnectTempPaths=function(t){for(var e=t.length;e--;)t[e].points=new l},m.prototype._optimize=function(t){var e=t.maxOperations||100,n=t.last||0,i=t.dm||10,o=t.d||0,r=function(t){return{finished:t||!e,maxOperations:e,last:n,dm:i,d:o}};if(e>0){if(1===n)return r(!0);e--,this._simplifyPaths()&&(n=1)}if(e>0){if(2===n)return r(!0);if(e--,this.horizontal.blockScanBackward()){do e--;while(e>0&&this.horizontal.blockScanBackward());if(2>n||n>5)o=0;else if(++o>=i)return r(!0);n=2}}if(e>0){if(3===n)return r(!0);if(e--,this.horizontal.blockScanForward()){do e--;while(e>0&&this.horizontal.blockScanForward());if(2>n||n>5)o=0;else if(++o>=i)return r(!0);n=3}}if(e>0){if(4===n)return r(!0);if(e--,this.vertical.blockScanBackward()){do e--;while(e>0&&this.vertical.blockScanBackward());if(2>n||n>5)o=0;else if(++o>=i)return r(!0);n=4}}if(e>0){if(5===n)return r(!0);if(e--,this.vertical.blockScanForward()){do e--;while(e>0&&this.vertical.blockScanForward());if(2>n||n>5)o=0;else if(++o>=i)return r(!0);n=5}}if(e>0){if(6===n)return r(!0);e--,this.horizontal.blockSwitchWrongs()&&(n=6)}if(e>0){if(7===n)return r(!0);e--,this.vertical.blockSwitchWrongs()&&(n=7)}return r(0===n?!0:!1)},m.prototype.deletePath=function(t){if(o(null!==t,"ARGraph.deletePath: path !== null FAILED"),t.hasOwner()){o(t.owner===this,"ARGraph.deletePath: path.owner === this FAILED"),this.deleteEdges(t),t.owner=null;var e=this.paths.indexOf(t);o(e>-1,"ARGraph.remove: Path does not exist"),this.paths.splice(e,1)}t.destroy()},m.prototype.clear=function(t){this._deleteAllPaths(),this._deleteAllBoxes(),this._deleteAllEdges(),t&&this._addSelfEdges()},m.prototype.addPath=function(t,e,n){var i=new d;return i.setAutoRouting(t),i.setStartPorts(e),i.setEndPorts(n),this._add(i),i},m.prototype.isEdgeFixed=function(t,e,n){var i=s.getDir(n.minus(e)),r=s.isHorizontal(i),a=this._getEdgeList(r),l=a.getEdge(t,e,n);return null!==l?l.getEdgeFixed()&&!l.getEdgeCustomFixed():(o(!1,"ARGraph.isEdgeFixed: FAILED"),!0)},m.prototype.destroy=function(){this.deleteAll(!1),this.horizontal.SetOwner(null),this.vertical.SetOwner(null)},m.prototype.assertValid=function(){var t,e=Object.keys(this.boxes);for(t=this.boxes.length;t--;)this.assertValidBox(this.boxes[e[t]]);for(t=this.paths.length;t--;)this._assertValidPath(this.paths[t]);this.horizontal.assertValid(),this.vertical.assertValid()},m.prototype.assertValidBox=function(t){t.assertValid(),o(t.owner===this,"ARGraph.assertValidBox: box.owner === this FAILED"),o(void 0!==this.boxes[t.id],"ARGraph.assertValidBox: this.boxes[box.id] !== undefined FAILED"),o(this._containsRectEdges(t.rect),"Graph does not contain edges for box "+t.id)},m.prototype._containsRectEdges=function(t){var e,n,i,o=t.getTopLeft(),r=t.getBottomRight(),s=[],l=!0;s.push(o),s.push(new a(r.x,o.y)),s.push(r),s.push(new a(o.x,r.y)),e=s.length;for(var c=0;e>c;c++)n=s[c],i=s[(c+1)%e],l=l&&this._containsEdge(n,i);return l},m.prototype._containsEdge=function(t,e){var n;return n=s.getDir(t.minus(e)),o(s.isRightAngle(n),"Edge is invalid: "+s.stringify(t)+" and "+s.stringify(e)),s.isHorizontal(n)?this.horizontal.contains(t,e)||this.horizontal.contains(e,t):this.vertical.contains(t,e)||this.vertical.contains(e,t)},m.prototype._assertValidPath=function(t){o(t.owner===this,"ARGraph.assertValidBox: box.owner === this FAILED"),t.assertValid()},m.prototype.dumpPaths=function(t,e){u.debug("Paths dump pos "+t+", c "+e);for(var n=0;n<this.paths.length;n++)u.debug(n+". Path: "),this.paths[n].getPointList().dumpPoints("DumpPaths")},m.prototype.dumpEdgeLists=function(){this.horizontal.dumpEdges("Horizontal edges:"),this.vertical.dumpEdges("Vertical edges:")},e.exports=m},{"./AutoRouter.Box":10,"./AutoRouter.Constants":11,"./AutoRouter.Edge":12,"./AutoRouter.EdgeList":13,"./AutoRouter.Logger":15,"./AutoRouter.Path":16,"./AutoRouter.Point":17,"./AutoRouter.PointList":18,"./AutoRouter.Port":19,"./AutoRouter.Rect":20,"./AutoRouter.Utils":22,assert:1}],15:[function(t,e,n){"use strict";var i=t("debug"),o=["warn","debug","info"],r=function(t){for(var e=o.length;e--;)this[o[e]]=i(t+":"+o[e])};e.exports=r},{debug:6}],16:[function(t,e,n){var i=t("assert"),o=t("./AutoRouter.Constants"),r=t("./AutoRouter.Utils"),s=t("./AutoRouter.Point"),a=(t("./AutoRouter.Rect"),t("./AutoRouter.PointList")),l=function(){this.id="None",this.owner=null,this.startpoint=null,this.endpoint=null,this.startports=null,this.endports=null,this.startport=null,this.endport=null,this.attributes=o.PathDefault,this.state=o.PathStateDefault,this.isAutoRoutingOn=!0,this.customPathData=[],this.customizationType="Points",this.pathDataToDelete=[],this.points=new a};l.prototype.hasOwner=function(){return null!==this.owner},l.prototype.setStartPorts=function(t){this.startports=t,this.startport&&this.calculateStartPorts()},l.prototype.setEndPorts=function(t){this.endports=t,this.endport&&this.calculateEndPorts()},l.prototype.clearPorts=function(){this.startpoint&&(this.startport.removePoint(this.startpoint),this.startpoint=null),this.endpoint&&(this.endport.removePoint(this.endpoint),this.endpoint=null),this.startport=null,this.endport=null},l.prototype.getStartPort=function(){return i(this.startports.length,"ARPort.getStartPort: Can't retrieve start port. from "+this.id),this.startport||this.calculateStartPorts(),this.startport},l.prototype.getEndPort=function(){return i(this.endports.length,"ARPort.getEndPort: Can't retrieve end port from "+this.id),this.endport||this.calculateEndPorts(),this.endport},l.prototype.removePort=function(t){var e=r.removeFromArrays(t,this.startports,this.endports);i(e,"Port was not removed from path start/end ports"),this.owner.disconnect(this)},l.prototype.calculateStartEndPorts=function(){return{src:this.calculateStartPorts(),dst:this.calculateEndPorts()}},l.prototype.calculateStartPorts=function(){var t,e,n=[];for(i(this.startports.length>0,"ArPath.calculateStartEndPorts: this.startports cannot be empty!"),this.startport&&this.startport.hasPoint(this.startpoint)&&this.startport.removePoint(this.startpoint),e=this.startports.length;e--;)i(this.startports[e].owner,"ARPath.calculateStartEndPorts: port "+this.startports[e].id+" has invalid this.owner!"),this.startports[e].isAvailable()&&n.push(this.startports[e]);if(0===n.length&&(n=this.startports),this.endport&&n.length>1)for(e=n.length;e--;)n[e]===this.endport&&n.splice(e,1);if(this.isAutoRouted()){var a=function(t,e){var n=e.rect.getCenter();return t.x+=n.x,t.y+=n.y,t};t=this.endports.reduce(a,new s(0,0)),t.x/=this.endports.length,t.y/=this.endports.length}else t=this.customPathData[0];this.startport=r.getOptimalPorts(n,t);var l=this.getStartDir(),c=!1,d=!0;return l!==o.DirNone&&(c=this.startport.hasLimitedDirs(),d=this.startport.canHaveStartEndPointOn(l,!0)),(l===o.DirNone||c&&!d)&&(l=this.startport.getStartEndDirTo(t,!0)),this.startpoint=this.startport.createStartEndPointTo(t,l),this.startpoint.owner=this,this.startport},l.prototype.calculateEndPorts=function(){var t,e=[],n=this.endports.length;for(i(this.endports.length>0,"ArPath.calculateStartEndPorts: this.endports cannot be empty!"),this.endport&&this.endport.hasPoint(this.endpoint)&&this.endport.removePoint(this.endpoint);n--;)i(this.endports[n].owner,"ARPath.calculateStartEndPorts: this.endport has invalid this.owner!"),this.endports[n].isAvailable()&&e.push(this.endports[n]);if(0===e.length&&(e=this.endports),this.startport&&e.length>1)for(n=e.length;n--;)e[n]===this.startport&&e.splice(n,1);if(this.isAutoRouted()){var a=function(t,e){var n=e.rect.getCenter();return t.x+=n.x,t.y+=n.y,t};t=this.startports.reduce(a,new s(0,0)),t.x/=this.startports.length,t.y/=this.startports.length}else t=this.customPathData[this.customPathData.length-1];this.endport=r.getOptimalPorts(e,t);var l=this.getEndDir(),c=this.getStartDir(),d=!1,h=!0;return l!==o.DirNone&&(d=this.endport.hasLimitedDirs(),h=this.endport.canHaveStartEndPointOn(l,!1)),(l===o.DirNone||d&&!h)&&(l=this.endport.getStartEndDirTo(t,!1,this.startport===this.endport?c:o.DirNone)),this.endpoint=this.endport.createStartEndPointTo(t,l),this.endpoint.owner=this,this.endport},l.prototype.isConnected=function(){return 0!==(this.state&o.PathStateConnected)},l.prototype.addTail=function(t){i(!this.isConnected(),"ARPath.addTail: !this.isConnected() FAILED"),this.points.push(t)},l.prototype.deleteAll=function(){this.points=new a,this.state=o.PathStateDefault,this.clearPorts()},l.prototype.getStartBox=function(){var t=this.startport||this.startports[0];return t.owner.getRootBox()},l.prototype.getEndBox=function(){var t=this.endport||this.endports[0];return t.owner.getRootBox()},l.prototype.getOutOfBoxStartPoint=function(t){var e=this.getStartBox();i(t!==o.DirSkew,"ARPath.getOutOfBoxStartPoint: hintDir !== CONSTANTS.DirSkew FAILED"),i(this.points.length>=2,"ARPath.getOutOfBoxStartPoint: this.points.length >= 2 FAILED");var n=0,a=new s(this.points[n++]),l=r.getDir(this.points[n].minus(a));return l===o.DirSkew&&(l=t),i(r.isRightAngle(l),"ARPath.getOutOfBoxStartPoint: Utils.isRightAngle (d) FAILED"),r.isHorizontal(l)?a.x=r.getRectOuterCoord(e,l):a.y=r.getRectOuterCoord(e,l),a},l.prototype.getOutOfBoxEndPoint=function(t){var e=this.getEndBox();i(t!==o.DirSkew,"ARPath.getOutOfBoxEndPoint: hintDir !== CONSTANTS.DirSkew FAILED"),i(this.points.length>=2,"ARPath.getOutOfBoxEndPoint: this.points.length >= 2 FAILED");var n=this.points.length-1,a=new s(this.points[n--]),l=r.getDir(this.points[n].minus(a));return l===o.DirSkew&&(l=t),i(r.isRightAngle(l),"ARPath.getOutOfBoxEndPoint: Utils.isRightAngle (d) FAILED"),r.isHorizontal(l)?a.x=r.getRectOuterCoord(e,l):a.y=r.getRectOuterCoord(e,l),a},l.prototype.simplifyTrivially=function(){if(i(!this.isConnected(),"ARPath.simplifyTrivially: !isConnected() FAILED"),!(this.points.length<=2)){var t=0,e=t;i(e!==this.points.length,"ARPath.simplifyTrivially: pos1 !== this.points.length FAILED");var n=this.points[t++],s=t;i(s!==this.points.length,"ARPath.simplifyTrivially: pos2 !== this.points.length FAILED");var a=this.points[t++],l=r.getDir(a.minus(n)),c=t;i(c!==this.points.length,"ARPath.simplifyTrivially: pos3 !== this.points.length FAILED");for(var d=this.points[t++],h=r.getDir(d.minus(a));;){if(l===o.DirNone||h===o.DirNone||l!==o.DirSkew&&h!==o.DirSkew&&(l===h||l===r.reverseDir(h))?(this.points.splice(s,1),t--,c--,l=r.getDir(d.minus(n))):(e=s,n=a,l=h),t===this.points.length)return;s=c,a=d,c=t,d=this.points[t++],h=r.getDir(d.minus(a))}o.DEBUG&&this.assertValidPoints()}},l.prototype.getPointList=function(){return this.points},l.prototype.isPathClip=function(t,e){for(var n=this.points.getTailEdge(),i=n.start,o=n.end,s=n.pos,a=0,l=this.points.length-1;s>=0;){if(!e||0!==a&&a!==l-1){if(r.isLineClipRect(i,o,t))return!0}else if(r.isPointIn(i,t,1)&&r.isPointIn(o,t,1))return!0;n=this.points.getPrevEdge(s,i,o),i=n.start,o=n.end,s=n.pos,a++}return!1},l.prototype.isFixed=function(){return 0!==(this.attributes&o.PathFixed)},l.prototype.isMoveable=function(){return 0===(this.attributes&o.PathFixed)},l.prototype.setState=function(t){i(null!==this.owner,"ARPath.setState: this.owner !== null FAILED"),this.state=t,o.DEBUG&&this.assertValid()},l.prototype.getEndDir=function(){var t=this.attributes&o.PathEndMask;return t&o.PathEndOnTop?o.DirTop:t&o.PathEndOnRight?o.DirRight:t&o.PathEndOnBottom?o.DirBottom:t&o.PathEndOnLeft?o.DirLeft:o.DirNone},l.prototype.getStartDir=function(){var t=this.attributes&o.PathStartMask;return t&o.PathStartOnTop?o.DirTop:t&o.PathStartOnRight?o.DirRight:t&o.PathStartOnBottom?o.DirBottom:t&o.PathStartOnLeft?o.DirLeft:o.DirNone},l.prototype.setEndDir=function(t){this.attributes=(this.attributes&~o.PathEndMask)+t},l.prototype.setStartDir=function(t){this.attributes=(this.attributes&~o.PathStartMask)+t},l.prototype.setCustomPathPoints=function(t){this.customPathData=t,this.calculateStartEndPorts(),this.points=(new a).concat(t),this.points.unshift(this.startpoint),this.points.push(this.endpoint),this.setState(o.PathStateConnected)},l.prototype.createCustomPath=function(){this.points.shift(),this.points.pop(),this.points.unshift(this.startpoint),this.points.push(this.endpoint),this.setState(o.PathStateConnected)},l.prototype.removePathCustomizations=function(){this.customPathData=[]},l.prototype.areTherePathCustomizations=function(){return 0!==this.customPathData.length},l.prototype.isAutoRouted=function(){return this.isAutoRoutingOn},l.prototype.setAutoRouting=function(t){this.isAutoRoutingOn=t},l.prototype.destroy=function(){this.isConnected()&&(this.startport.removePoint(this.startpoint),this.endport.removePoint(this.endpoint))},l.prototype.assertValid=function(){var t;for(i(this.startports.length>0,"Path has no startports!"),i(this.endports.length>0,"Path has no endports!"),t=this.startports.length;t--;)this.startports[t].assertValid();for(t=this.endports.length;t--;)this.endports[t].assertValid();if(this.isAutoRouted()&&this.isConnected()){i(0!==this.points.length,"ARPath.assertValid: this.points.length !== 0 FAILED");var e=this.getPointList();e.assertValid()}this.startpoint&&i(this.startport,"Path has a startpoint without a startport"),this.endpoint&&i(this.endport,"Path has a endpoint without a endport"),i(this.owner,"Path does not have owner!")},l.prototype.assertValidPoints=function(){},e.exports=l},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.PointList":18,"./AutoRouter.Rect":20,"./AutoRouter.Utils":22,assert:1}],17:[function(t,e,n){var i=t("./AutoRouter.Size"),o=function(t,e){void 0===t?(t=0,e=0):void 0===e&&(e=t.y,t=t.x),this.x=t,this.y=e};o.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},o.prototype.shift=function(t){return this.x+=t.dx,this.y+=t.dy,this},o.prototype.add=function(t){t instanceof i?(this.x+=t.cx,this.y+=t.cy):t instanceof o&&(this.x+=t.x,this.y+=t.y)},o.prototype.subtract=function(t){t instanceof i?(this.x-=t.cx,this.y-=t.cy):t instanceof o&&(this.x-=t.x,this.y-=t.y)},o.prototype.plus=function(t){var e=null;return t instanceof i?(e=new o(this),e.add(t)):t instanceof o&&(e=new o(t),e.x+=this.x,e.y+=this.y),e||void 0},o.prototype.minus=function(t){var e=new o(t);return t.cx||t.cy?e.subtract(this):(t.x||t.y)&&(e=new i,e.cx=this.x-t.x,e.cy=this.y-t.y),e},o.prototype.assign=function(t){return this.x=t.x,this.y=t.y,this},o.prototype.toString=function(){return"("+this.x+", "+this.y+")"},e.exports=o},{"./AutoRouter.Size":21}],18:[function(t,e,n){var i=t("./AutoRouter.Logger"),o=t("assert"),r=t("./AutoRouter.Constants"),s=t("./AutoRouter.Utils"),a=new i("AutoRouter.PointList"),l=function(){for(var t=arguments.length;t--;)this.unshift(arguments[t])};l.prototype=[],l.prototype.concat=function(t){var e,n=new l;for(e=0;e<this.length;e++)n.push(this[e]);for(e=0;e<t.length;e++)n.push(t[e]);return n},l.prototype.end=function(){return this[this.length-1]},l.prototype.getTailEdge=function(){if(this.length<2)return this.length;var t=this.length-1,e=this[t--],n=this[t];return{pos:t,start:n,end:e}},l.prototype.getPrevEdge=function(t,e,n){return r.DEBUG&&this.AssertValidPos(t),n=this[t--],t!==this.length&&(e=this[t]),{pos:t,start:e,end:n}},l.prototype.getEdge=function(t,e,n){r.DEBUG&&this.AssertValidPos(t),e=this[t++],o(t<this.length,"ArPointListPath.getEdge: pos < this.length FAILED"),n=this[t]},l.prototype.getTailEdgePtrs=function(){var t,e,n=this.length;return this.length<2?{pos:n}:(o(--n<this.length,"ArPointListPath.getTailEdgePtrs: --pos < this.length FAILED"),e=this[n--],o(n<this.length,"ArPointListPath.getTailEdgePtrs: pos < this.length FAILED"),t=this[n],{pos:n,start:t,end:e})},l.prototype.getPrevEdgePtrs=function(t){var e,n;return r.DEBUG&&this.AssertValidPos(t),n=this[t],t-->0&&(e=this[t]),{pos:t,start:e,end:n}},l.prototype.getStartPoint=function(t){return r.DEBUG&&this.AssertValidPos(t),this[t]},l.prototype.getEndPoint=function(t){return r.DEBUG&&this.AssertValidPos(t),t++,o(t<this.length,"ArPointListPath.getEndPoint: pos < this.length FAILED"),this[t]},l.prototype.getPointBeforeEdge=function(t){return r.DEBUG&&this.AssertValidPos(t),t--,t===this.length?null:this[t]},l.prototype.getPointAfterEdge=function(t){return r.DEBUG&&this.AssertValidPos(t),t++,o(t<this.length,"ArPointListPath.getPointAfterEdge: pos < this.length FAILED"),t++,t===this.length?null:this[t]},l.prototype.assertValid=function(t){t=t||"";for(var e=this.length-1;e>0;e--)o(!!this[e].minus,"Bad value at position "+e+" ("+s.stringify(this[e])+")"),o(!!this[e-1].minus,"Bad value at position "+(e-1)+" ("+s.stringify(this[e-1])+")"),o(s.isRightAngle(s.getDir(this[e-1].minus(this[e]))),t+"\n	ArPointListPath contains skew edge:\n"+s.stringify(this))},l.prototype.assertValidPos=function(t){o(t<this.length,"ArPointListPath.assertValidPos: pos < this.length FAILED")},l.prototype.dumpPoints=function(t){t+=", points dump begin:\n";for(var e,n=0,i=0;n<this.length;)e=this[n++],t+=i+".: ("+e.x+", "+e.y+")\n",i++;return t+="points dump end.",a.debug(t),t},e.exports=l},{"./AutoRouter.Constants":11,"./AutoRouter.Logger":15,"./AutoRouter.Utils":22,assert:1}],19:[function(t,e,n){var i=t("assert"),o=t("./AutoRouter.Constants"),r=t("./AutoRouter.Utils"),s=t("./AutoRouter.Point"),a=t("./AutoRouter.Size"),l=t("./AutoRouter.Rect"),c=function(){this.id=null,this.owner=null,this.limitedDirections=!0,this.rect=new l,this.attributes=o.PortDefault,this.points=[[],[],[],[]],this.selfPoints=[],this.availableArea=[],this.calculateSelfPoints()};c.prototype.calculateSelfPoints=function(){this.selfPoints=[],this.selfPoints.push(new s(this.rect.getTopLeft())),this.selfPoints.push(new s(this.rect.right,this.rect.ceil)),this.selfPoints.push(new s(this.rect.right,this.rect.floor)),this.selfPoints.push(new s(this.rect.left,this.rect.floor)),this.resetAvailableArea()},c.prototype.hasOwner=function(){return null!==this.owner},c.prototype.isRectEmpty=function(){return this.rect.isRectEmpty()},c.prototype.getCenter=function(){return this.rect.getCenterPoint()},c.prototype.setRect=function(t){i(t.getWidth()>=3&&t.getHeight()>=3,"ARPort.setRect: r.getWidth() >= 3 && r.getHeight() >= 3 FAILED!"),this.rect.assign(t),this.calculateSelfPoints(),this.resetAvailableArea()},c.prototype.shiftBy=function(t){i(!this.rect.isRectEmpty(),"ARPort.shiftBy: !this.rect.isRectEmpty() FAILED!"),this.rect.add(t),this.calculateSelfPoints(),this.shiftPoints(t)},c.prototype.isConnectToCenter=function(){return 0!==(this.attributes&o.PortConnectToCenter)},c.prototype.hasLimitedDirs=function(){return this.limitedDirections},c.prototype.setLimitedDirs=function(t){this.limitedDirections=t},c.prototype.portOnWhichEdge=function(t){return r.onWhichEdge(this.rect,t)},c.prototype.canHaveStartEndPointOn=function(t,e){return i(t>=0&&3>=t,"ARPort.canHaveStartEndPointOn: 0 <= dir && dir <= 3 FAILED!"),e&&(t+=4),0!==(this.attributes&1<<t)},c.prototype.canHaveStartEndPoint=function(t){return 0!==(this.attributes&(t?o.PortStartOnAll:o.PortEndOnAll))},c.prototype.canHaveStartEndPointHorizontal=function(t){return 0!==(this.attributes&(t?o.PortStartEndHorizontal:o.PortStartEndVertical))},c.prototype.getStartEndDirTo=function(t,e,n){i(!this.rect.isRectEmpty(),"ARPort.getStartEndDirTo: !this.rect.isRectEmpty() FAILED!"),n=n?n:o.DirNone;var s=t.minus(this.rect.getCenterPoint()),a=r.getMajorDir(s);if(a!==n&&this.canHaveStartEndPointOn(a,e))return a;var l=r.getMinorDir(s);if(l!==n&&this.canHaveStartEndPointOn(l,e))return l;var c=r.reverseDir(l);if(c!==n&&this.canHaveStartEndPointOn(c,e))return c;var d=r.reverseDir(a);return d!==n&&this.canHaveStartEndPointOn(d,e)?d:this.canHaveStartEndPointOn(a,e)?a:this.canHaveStartEndPointOn(l,e)?l:this.canHaveStartEndPointOn(c,e)?c:this.canHaveStartEndPointOn(d,e)?d:o.DirTop},c.prototype.roundToHalfGrid=function(t,e){var n=(t+e)/2;return i(n<Math.max(t,e)&&n>Math.min(t,e),"roundToHalfGrid: btwn variable not between left, right values. Perhaps box/connectionArea is too small?"),n},c.prototype.createStartEndPointTo=function(t,e){var n,a=t.x-this.getCenter().x,l=t.y-this.getCenter().y,c=Math.atan2(-l,a),d=0,h=this.rect.right,p=this.rect.floor,g=this.rect.left,u=this.rect.ceil,f=new s(g,u),m=new s(h,p);switch(r.isHorizontal(e)?(g++,h--):(u++,p--),e){case o.DirTop:c=2*Math.PI-(c+Math.PI/2),m.y=this.rect.ceil;break;case o.DirRight:c=2*Math.PI-c,f.x=this.rect.right;break;case o.DirBottom:c-=Math.PI/2,f.y=this.rect.floor;break;case o.DirLeft:m.x=this.rect.left}for(0>c&&(c+=2*Math.PI),c*=180/Math.PI;d<this.points[e].length&&c>this.points[e][d].pathAngle;)d++;this.points[e].length&&(0===d?m=new s(this.points[e][d]):d!==this.points[e].length?(f=new s(this.points[e][d-1]),m=new s(this.points[e][d])):f=new s(this.points[e][d-1])),n=new s((m.x+f.x)/2,(m.y+f.y)/2),n.pathAngle=c;for(var _,b,y=this.availableArea.length,v=0,C=1/0;y--;){if(_=this.availableArea[y][0],b=this.availableArea[y][1],r.isOnEdge(_,b,n)){v=-1;break}r.distanceFromLine(n,_,b)<C&&(v=y,C=r.distanceFromLine(n,_,b))}if(-1!==v&&this.isAvailable()){var E=r.getDir(this.availableArea[v][0].minus(n));i(r.isRightAngle(E),"AutoRouterPort.createStartEndPointTo: Utils.isRightAngle(dir2) FAILED"),E===o.DirLeft||E===o.DirTop?m=this.availableArea[v][1]:f=this.availableArea[v][0],n=new s((m.x+f.x)/2,(m.y+f.y)/2)}return this.points[e].splice(d,0,n),i(r.isRightAngle(this.portOnWhichEdge(n)),"AutoRouterPort.createStartEndPointTo: Utils.isRightAngle(this.portOnWhichEdge(resultPoint)) FAILED"),n},c.prototype.removePoint=function(t){var e;e=r.removeFromArrays.apply(null,[t].concat(this.points));
},c.prototype.hasPoint=function(t){for(var e,n=0;4>n;){if(e=this.points[n].indexOf(t),e>-1)return!0;n++}return!1},c.prototype.shiftPoints=function(t){for(var e=this.points.length;e--;)for(var n=this.points[e].length;n--;)this.points[e][n].add(t)},c.prototype.getPointCount=function(){for(var t=0,e=0;4>t;)e+=this.points[t++].length;return e},c.prototype.resetAvailableArea=function(){this.availableArea=[],this.canHaveStartEndPointOn(o.DirTop)&&this.availableArea.push([this.rect.getTopLeft(),new s(this.rect.right,this.rect.ceil)]),this.canHaveStartEndPointOn(o.DirRight)&&this.availableArea.push([new s(this.rect.right,this.rect.ceil),this.rect.getBottomRight()]),this.canHaveStartEndPointOn(o.DirBottom)&&this.availableArea.push([new s(this.rect.left,this.rect.floor),this.rect.getBottomRight()]),this.canHaveStartEndPointOn(o.DirLeft)&&this.availableArea.push([this.rect.getTopLeft(),new s(this.rect.left,this.rect.floor)])},c.prototype.adjustAvailableArea=function(t){if(this.rect.touching(t))for(var e,n,i=this.availableArea.length;i--;)r.isLineClipRect(this.availableArea[i][0],this.availableArea[i][1],t)&&(n=this.availableArea.splice(i,1)[0],e=r.getLineClipRectIntersect(n[0],n[1],t),e[0].equals(n[0])||this.availableArea.push([n[0],e[0]]),e[1].equals(n[1])||this.availableArea.push([e[1],n[1]]))},c.prototype.getTotalAvailableArea=function(){for(var t=this.availableArea.length,e=new a;t--;)e.add(this.availableArea[t][1].minus(this.availableArea[t][0]));return i(0===e.cx||0===e.cy,"ARPort.getTotalAvailableArea: length[0] === 0 || length[1] === 0 FAILED"),e.cx||e.cy},c.prototype.isAvailable=function(){return this.availableArea.length>0},c.prototype.assertValid=function(){var t;i(this.owner,"Port "+this.id+" does not have valid owner!");for(var e=this.points.length;e--;)for(var n=this.points[e].length;n--;)t=this.points[e][n],i(r.isRightAngle(this.portOnWhichEdge(t)),"AutoRouterPort.createStartEndPointTo: Utils.isRightAngle(this.portOnWhichEdge(resultPoint)) FAILED")},c.prototype.destroy=function(){this.owner=null;for(var t,e,n=this.points.length;n--;)for(var o=this.points[n].length;o--;)t=this.points[n][o],e=t.owner,i(e,"start/end point does not have an owner!"),e.removePort(this);this.points=[[],[],[],[]]},e.exports=c},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.Rect":20,"./AutoRouter.Size":21,"./AutoRouter.Utils":22,assert:1}],20:[function(t,e,n){var i=(t("debug"),t("./AutoRouter.Point")),o=t("./AutoRouter.Size"),r=t("./AutoRouter.Logger"),s=new r("AutoRouter.Rect"),a=function(t,e,n,r){if(void 0===t)t=0,e=0,n=0,r=0;else if(void 0===e&&t instanceof a)e=t.ceil,n=t.right,r=t.floor,t=t.left;else if(void 0===n&&t instanceof i)if(e instanceof o)n=t.x+e.cx,r=t.y+e.cy,e=t.y,t=t.x;else{if(!(t instanceof i&&e instanceof i))throw new Error("Invalid ArRect Constructor");n=Math.round(e.x),r=Math.round(e.y),e=Math.round(t.y),t=Math.round(t.x)}else if(void 0===r)throw new Error("Invalid ArRect Constructor");this.left=Math.round(t),this.ceil=Math.round(e),this.floor=Math.round(r),this.right=Math.round(n)};a.prototype.getCenter=function(){return{x:(this.left+this.right)/2,y:(this.ceil+this.floor)/2}},a.prototype.getWidth=function(){return this.right-this.left},a.prototype.getHeight=function(){return this.floor-this.ceil},a.prototype.getSize=function(){return new o(this.getWidth(),this.getHeight())},a.prototype.getTopLeft=function(){return new i(this.left,this.ceil)},a.prototype.getBottomRight=function(){return new i(this.right,this.floor)},a.prototype.getCenterPoint=function(){return new i(this.left+this.getWidth()/2,this.ceil+this.getHeight()/2)},a.prototype.isRectEmpty=function(){return this.left>=this.right&&this.ceil>=this.floor?!0:!1},a.prototype.isRectNull=function(){return 0===this.left&&0===this.right&&0===this.ceil&&0===this.floor?!0:!1},a.prototype.ptInRect=function(t){return t instanceof Array&&(t=t[0]),t.x>=this.left&&t.x<=this.right&&t.y>=this.ceil&&t.y<=this.floor?!0:!1},a.prototype.setRect=function(t,e,n,i){void 0===e&&t instanceof a?this.assign(t):void 0===n||void 0===i?s.debug("Invalid args for [ArRect].setRect"):(this.left=t,this.ceil=e,this.right=n,this.floor=i)},a.prototype.setRectEmpty=function(){this.ceil=0,this.right=0,this.floor=0,this.left=0},a.prototype.inflateRect=function(t,e){void 0!==t&&void 0!==t.cx&&void 0!==t.cy?(e=t.cy,t=t.cx):void 0===e&&(e=t),this.left-=t,this.right+=t,this.ceil-=e,this.floor+=e},a.prototype.deflateRect=function(t,e){void 0!==t&&void 0!==t.cx&&void 0!==t.cy&&(e=t.cy,t=t.cx),this.left+=t,this.right-=t,this.ceil+=e,this.floor-=e},a.prototype.normalizeRect=function(){var t;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.ceil>this.floor&&(t=this.ceil,this.ceil=this.floor,this.floor=t)},a.prototype.assign=function(t){this.ceil=t.ceil,this.right=t.right,this.floor=t.floor,this.left=t.left},a.prototype.equals=function(t){return this.left===t.left&&this.right===t.right&&this.ceil===t.ceil&&this.floor===t.floor?!0:!1},a.prototype.add=function(t){var e,n;t instanceof i?(e=t.x,n=t.y):void 0!==t.cx&&void 0!==t.cy?(e=t.cx,n=t.cy):s.debug("Invalid arg for [ArRect].add method"),this.left+=e,this.right+=e,this.ceil+=n,this.floor+=n},a.prototype.subtract=function(t){t instanceof i?this.deflateRect(t.x,t.y):t instanceof o?this.deflateRect(t):t instanceof a?(this.left+=t.left,this.right-=t.right,this.ceil+=t.ceil,this.floor-=t.floor):s.debug("Invalid arg for [ArRect].subtract method")},a.prototype.plus=function(t){var e=new a(this);return e.add(t),e},a.prototype.minus=function(t){var e=new a(this);return e.subtract(t),e},a.prototype.unionAssign=function(t){if(!t.isRectEmpty()){if(this.isRectEmpty())return void this.assign(t);this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.ceil=Math.min(this.ceil,t.ceil),this.floor=Math.max(this.floor,t.floor)}},a.prototype.union=function(t){var e=new a(this);return e.unionAssign(t),e},a.prototype.intersectAssign=function(t,e){return e=e?e:this,this.left=Math.max(t.left,e.left),this.right=Math.min(t.right,e.right),this.ceil=Math.max(t.ceil,e.ceil),this.floor=Math.min(t.floor,e.floor),this.left>=this.right||this.ceil>=this.floor?(this.setRectEmpty(),!1):!0},a.prototype.intersect=function(t){var e=new a(this);return e.intersectAssign(t),e},a.prototype.touching=function(t){return Math.max(t.left,this.left)<=Math.min(t.right,this.right)+1&&Math.max(t.ceil,this.ceil)<=Math.min(t.floor,this.floor)+1},a.prototype.onCorner=function(t){var e,n;return e=t.x===this.left||t.x===this.right,n=t.y===this.ceil||t.y===this.floor,e&&n},a.prototype.toString=function(){return this.getTopLeft().toString()+" "+this.getBottomRight().toString()},e.exports=a},{"./AutoRouter.Logger":15,"./AutoRouter.Point":17,"./AutoRouter.Size":21,debug:6}],21:[function(t,e,n){var i=function(t,e){void 0===t?(t=0,e=0):void 0===e&&(e=t.cy,t=t.cx),this.cx=t,this.cy=e};i.prototype.equals=function(t){return this.cx===t.cx&&this.cy===t.cy?!0:!1},i.prototype.add=function(t){(t.cx||t.cy)&&(this.cx+=t.cx,this.cy+=t.cy),(t.x||t.y)&&(this.cx+=t.x,this.cy+=t.y)},i.prototype.getArray=function(){var t=[];return t.push(this.cx),t.push(this.cy),t},e.exports=i},{}],22:[function(t,e,n){var i=t("./AutoRouter.Constants"),o=t("assert"),r=t("./AutoRouter.Rect"),s=t("./AutoRouter.Point"),a=function(t,e){function n(t,e){var n=0,o=[t.rect.getCenter().x-e.x,t.rect.getCenter().y-e.y],r=t.getPointCount()||1,s=t.getTotalAvailableArea()/r/h||1,a=Math.abs(i[0])>Math.abs(i[1])?0:1,l=(a+1)%2;return o[a]>0==i[a]>0&&0===o[a]==(0===i[a])&&(n=Math.abs(i[a])/Math.abs(i[a]-o[a])*25),o[l]>0==i[l]>0&&0===o[l]==(0===i[l])&&(n+=i[l]!==o[l]?Math.abs(i[l])/Math.abs(i[l]-o[l])*1:0),n*=s}var i,r,a,l,c=new s,d=-(1/0),h=0;for(l=0;l<t.length;l++)a=t[l].rect.getCenter(),c.x+=a.x,c.y+=a.y,h<t[l].getTotalAvailableArea()&&(h=t[l].getTotalAvailableArea());c.x=c.x/t.length,c.y=c.y/t.length,i=e.minus(c).getArray();var p;for(l=0;l<t.length;l++)p=n(t[l],c)||0,p>=d&&(r=t[l],d=p);return o(r.owner,"ARGraph.getOptimalPorts: port has invalid owner"),r},l=function(t,e){return e===!0||P(e)?t.x:t.y},c=function(t,e){var n=t;return n.inflateRect(e,e),n},d=function(t,e,n){return e.x-n<=t.x&&t.x<=e.x+n&&e.y-n<=t.y&&t.y<=e.y+n},h=function(t,e,n){var i=new r(e);return i.inflateRect(n,n),i.ptInRect(t)===!0},p=function(t,e){return e.left<=t.left&&t.right<=e.right&&e.ceil<=t.ceil&&t.floor<=e.floor},g=function(t,e){var n=new r;return n.intersectAssign(t,e)===!0},u=function(t,e,n,i){return o(n>=e,"ArHelper.distanceFromHLine: x1 <= x2 FAILED"),Math.max(Math.abs(t.y-i),Math.max(e-t.x,t.x-n))},f=function(t,e,n,i){return o(n>=e,"ArHelper.distanceFromVLine: y1 <= y2 FAILED"),Math.max(Math.abs(t.x-i),Math.max(e-t.y,t.y-n))},m=function(t,e,n){var i=H(n.minus(e));return P(i)?f(t,e.y,n.y,e.x):u(t,e.x,n.x,e.y)},_=function(t,e,n){if(t.x===e.x){if(e.x===n.x&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y))return!0}else if(t.y===e.y&&t.y===n.y&&n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x))return!0;return!1},b=function(t,e,n,i){if(o(i>=0,"ArHelper.isPointNearLine: 0 <= nearness FAILED"),n.x===e.x&&n.y===e.y)return!1;var r=t;r.subtract(e);var s=n;s.subtract(e);var a=s.x,l=s.y,c=r.x,d=r.y,h=a*c+l*d,p=a*a+l*l;if(0>h||h>p)return!1;var g=a*d-l*c;g*=g;var u=i*i*p;return u>=g},y=function(t,e,n,i,r){if(o(i>=n,"ArHelper.isLineMeetHLine: x1 <= x2 FAILED"),t instanceof Array&&(t=t[0]),e instanceof Array&&(e=e[0]),!(t.y<=r&&r<=e.y||e.y<=r&&r<=t.y))return!1;var a=new s(e);if(a.subtract(t),n-=t.x,i-=t.x,r-=t.y,0===a.y)return 0===r&&(0>=n&&i>=0||n<=a.x&&a.x<=i);var l=a.x/a.y*r;return l>=n&&i>=l},v=function(t,e,n,i,r){if(o(i>=n,"ArHelper.isLineMeetVLine: y1 <= y2  FAILED"),t instanceof Array&&(t=t[0]),e instanceof Array&&(e=e[0]),!(t.x<=r&&r<=e.x||e.x<=r&&r<=t.x))return!1;var a=new s(e);if(a.subtract(t),n-=t.y,i-=t.y,r-=t.x,0===a.x)return 0===r&&(0>=n&&i>=0||n<=a.y&&a.y<=i);var l=a.y/a.x*r;return l>=n&&i>=l},C=function(t,e,n){for(var i=n.length;i--;)if(E(t,e,n[i]))return!0;return!1},E=function(t,e,n){return n.ptInRect(t)||n.ptInRect(e)?!0:y(t,e,n.left,n.right,n.ceil)||y(t,e,n.left,n.right,n.floor)||v(t,e,n.ceil,n.floor,n.left)||v(t,e,n.ceil,n.floor,n.right)},D=function(t,e,n){var r=H(e.minus(t)),a=[new s(t),new s(e)];return E(t,e,n)?(o(A(r),"ArHelper.getLineClipRectIntersect: _isRightAngle(dir) FAILED"),(r===i.DirLeft||r===i.DirTop)&&(r=O(r),a.push(a.splice(0,1)[0])),Y(a[0],n.getTopLeft(),O(r))&&a[0].assign(n.getTopLeft()),Y(a[1],n.getBottomRight(),r)&&a[1].assign(n.getBottomRight()),P(r)?(a[0].y=t.y,a[1].y=e.y):(a[0].x=t.x,a[1].x=e.x),a):null},I=function(t,e,n,i){return Math.min(t,e)<=Math.max(n,i)&&Math.min(n,i)<=Math.max(t,e)},P=function(t){return t===i.DirRight||t===i.DirLeft},T=function(t){return t===i.DirTop||t===i.DirBottom},A=function(t){return i.DirTop<=t&&t<=i.DirLeft},x=function(t,e){return o(A(t)&&A(e),"ArHelper.areInRightAngle: _isRightAngle(dir1) && _isRightAngle(dir2) FAILED"),P(t)===T(e)},w=function(t){return A(t)?(t+1)%4:t},N=function(t){return A(t)?(t+3)%4:t},O=function(t){return A(t)?(t+2)%4:t},S=function(t,e){switch(o(A(e),"ArHelper.stepOnInDir: _isRightAngle(dir) FAILED"),e){case i.DirTop:t.y--;break;case i.DirRight:t.x++;break;case i.DirBottom:t.y++;break;case i.DirLeft:t.x--}},R=function(t,e,n){var i=t.children,r=-1,s=null,a=M(t.box,e);for(o(A(e),"getChildRectOuterCoordFrom: _isRightAngle(inDir) FAILED"),o(!Y(n,t.box,e),"getChildRectOuterCoordFrom: !isPointInDirFrom(point, bufferObject.box.rect, (inDir)) FAILED");++r<i.length;)Y(n,i[r],O(e))&&X(n,i[r],e)&&J(a,M(i[r],O(e)),e)&&(a=M(i[r],O(e)),s=i[r]);return{box:s,coord:a}},M=function(t,e){o(A(e),"Utils.getRectOuterCoord: isRightAngle(dir) FAILED");var n=t.ceil-1,r=t.right+1,s=t.floor+1,a=t.left-1;switch(e){case i.DirTop:return n;case i.DirRight:return r;case i.DirBottom:return s}return a},L=function(t){return 4*(t.cx>=0)+2*(t.cy>=0)+(Math.abs(t.cx)>=Math.abs(t.cy))},k=[i.DirTop,i.DirLeft,i.DirBottom,i.DirLeft,i.DirTop,i.DirRight,i.DirBottom,i.DirRight],B=function(t){return k[L(t)]},j=[i.DirLeft,i.DirTop,i.DirLeft,i.DirBottom,i.DirRight,i.DirTop,i.DirRight,i.DirBottom],G=function(t){return j[L(t)]},F=function(t){var e=t.cx>0?t.cy>0?t.cx>t.cy?6:t.cx<t.cy?8:7:t.cy<0?t.cx>-t.cy?4:t.cx<-t.cy?2:3:5:t.cx<0?t.cy>0?-t.cx>t.cy?12:-t.cx<t.cy?10:11:t.cy<0?t.cx<t.cy?14:t.cx>t.cy?16:15:13:t.cy>0?9:t.cy<0?1:0;return e},W=[i.DirNone,i.DirTop,i.DirTop,i.DirRight,i.DirRight,i.DirRight,i.DirRight,i.DirRight,i.DirBottom,i.DirBottom,i.DirBottom,i.DirLeft,i.DirLeft,i.DirLeft,i.DirLeft,i.DirLeft,i.DirTop],$=function(t){return W[F(t)]},z=[i.DirNone,i.DirNone,i.DirRight,i.DirTop,i.DirTop,i.DirNone,i.DirBottom,i.DirBottom,i.DirRight,i.DirNone,i.DirLeft,i.DirBottom,i.DirBottom,i.DirNone,i.DirTop,i.DirTop,i.DirLeft],V=function(t){return z[F(t)]},H=function(t,e){return 0===t.cx?0===t.cy?e:t.cy<0?i.DirTop:i.DirBottom:0===t.cy?t.cx>0?i.DirRight:i.DirLeft:i.DirSkew},U=function(t,e,n){var i=e.children,r=0;for(o(A(n),"isPointInDirFromChildren: _isRightAngle(dir) FAILED");r<i.length;){if(Y(t,i[r].rect,n))return!0;++r}return!1},Y=function(t,e,n){if(e instanceof r){var s=e;switch(o(A(n),"ArHelper.isPointInDirFrom: _isRightAngle(dir) FAILED"),n){case i.DirTop:return t.y<s.ceil;case i.DirRight:return t.x>=s.right;case i.DirBottom:return t.y>=s.floor;case i.DirLeft:return t.x<s.left}return!1}switch(o(A(n),"ArHelper.isPointInDirFrom: _isRightAngle(dir) FAILED"),n){case i.DirTop:return t.y<=e.y;case i.DirRight:return t.x>=e.x;case i.DirBottom:return t.y>=e.y;case i.DirLeft:return t.x<=e.x}return!1},X=function(t,e,n){return n===!0||P(n)?e.ceil<=t.y&&t.y<e.floor:e.left<=t.x&&t.x<e.right},J=function(t,e,n){return o(A(n),"ArHelper.isCoordInDirFrom: _isRightAngle(dir) FAILED"),e instanceof s&&(e=l(e,n)),n===i.DirTop||n===i.DirLeft?e>=t:t>=e},q=function(t,e){return e.y===t.ceil&&t.left<e.x&&e.x<t.right?i.DirTop:e.y===t.floor&&t.left<e.x&&e.x<t.right?i.DirBottom:e.x===t.left&&t.ceil<e.y&&e.y<t.floor?i.DirLeft:e.x===t.right&&t.ceil<e.y&&e.y<t.floor?i.DirRight:i.DirNone},K=function(t){this.point=t,this.dist1=1/0,this.dist2=1/0};K.prototype.hLine=function(t,e,n){o(e>=t,"ArFindNearestLine.hLine: x1 <= x2  FAILED");var i=u(this.point,t,e,n),r=Math.abs(this.point.y-n);return i<this.dist1||i===this.dist1&&r<this.dist2?(this.dist1=i,this.dist2=r,!0):!1},K.prototype.vLine=function(t,e,n){o(e>=t,"ArFindNearestLine.hLine: y1 <= y2 FAILED");var i=f(this.point,t,e,n),r=Math.abs(this.point.x-n);return i<this.dist1||i===this.dist1&&r<this.dist2?(this.dist1=i,this.dist2=r,!0):!1},K.prototype.was=function(){return this.dist1<1/0&&this.dist2<1/0};var Z=function(t){for(var e,n,i=!1,o=arguments.length-1;o>0;o--)n=arguments[o],e=n.indexOf(t),-1!==e&&(n.splice(e,1),i=!0);return i},Q=function(t){return JSON.stringify(t,function(t,e){return"owner"===t&&e?e.id||typeof e:e})},tt=function(t,e){t=+t;var n=Math.pow(10,+e),i="floor";return 0>t&&(i="ceil"),Math[i](t*n)/n},et=function(t,e){return e>t-.1&&t+.1>e},nt=function(t){for(var e=new Array(t.length||0),n=0;void 0!==t[n];)e[n]=t[n++];return e},it=function(t,e){for(var n={},i=t.length;i--;)n[t[i]]=e[t[i]];return n},ot=function(){},o=function(t,e){if(!t)throw new Error(e||"Assert failed")};e.exports={onWhichEdge:q,isCoordInDirFrom:J,isPointBetweenSides:X,isPointInDirFrom:Y,isPointInDirFromChildren:U,isPointIn:h,isPointNear:d,getDir:H,exGetMinorDir:V,exGetMajorDir:$,exGetDirTableIndex:F,getMinorDir:G,getMajorDir:B,getRectOuterCoord:M,getChildRectOuterCoordFrom:R,stepOneInDir:S,reverseDir:O,prevClockwiseDir:N,nextClockwiseDir:w,areInRightAngle:x,isRightAngle:A,isHorizontal:P,intersect:I,getLineClipRectIntersect:D,isLineClipRect:E,isLineClipRects:C,isPointNearLine:b,isOnEdge:_,distanceFromLine:m,isRectClip:g,isRectIn:p,inflatedRect:c,getPointCoord:l,getOptimalPorts:a,ArFindNearestLine:K,removeFromArrays:Z,stringify:Q,floatEquals:et,roundTrunc:tt,toArray:nt,nop:ot,assert:o,pick:it}},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.Rect":20,assert:1}],23:[function(t,e,n){var i=t("assert"),o=t("./AutoRouter.Constants"),r=t("./AutoRouter.Utils"),s=t("./AutoRouter.Point"),a=t("./AutoRouter.Rect"),l=t("./AutoRouter.Graph"),c=t("./AutoRouter.Box"),d=t("./AutoRouter.Port"),h=t("./AutoRouter.Path"),p=function(){this.paths={},this.ports={},this.pCount=0,this.portId2Path={},this.portId2Box={},this.graph=new l},g=function(t,e){this.box=t,this.ports=e||{}};p.prototype.clear=function(){this.graph.clear(!0),this.paths={},this.portId2Path={},this.ports={}},p.prototype.destroy=function(){this.graph.destroy(),this.graph=null},p.prototype._createBox=function(t){var e=void 0!==t.x1?t.x1:t.x2-t.width,n=void 0!==t.x2?t.x2:t.x1+t.width,o=void 0!==t.y1?t.y1:t.y2-t.height,r=void 0!==t.y2?t.y2:t.y1+t.height,s=this.graph.createBox(),l=new a(e,o,n,r);i(void 0!==e&&void 0!==n&&void 0!==o&&void 0!==r,"Missing size info for box");var c=l.getHeight(),d=l.getWidth(),h=Math.max((3-d)/2,0),p=Math.max((3-c)/2,0);return l.inflateRect(h,p),s.setRect(l),s},p.prototype.addBox=function(t){var e,n=this._createBox(t),i=t.ports||{};e=new g(n),this.graph.addBox(n);for(var o=Object.keys(i),r=o.length;r--;)this.addPort(e,i[o[r]]);return this.portId2Path[n.id]={"in":[],out:[]},e},p.prototype.addPort=function(t,e){var n,i,o,r=t.box;n=this._createPort(e,r);var s=this.getPortId(e.id,t);return n.id=s,this.portId2Path[s]={"in":[],out:[]},this.ports[s]=n,o=new a(n.rect),o.inflateRect(3),i=this._createBox({x1:o.left,x2:o.right,y1:o.ceil,y2:o.floor}),r.addChild(i),i.addPort(n),t.ports[n.id]=n,this.portId2Box[n.id]=t,this.graph.addBox(i),n},p.prototype.getPortId=function(t,e){var n="__",o=this.portId2Box[t]||e,r=o.box.id,s=r+n+t;return i(t.toString,"Invalid Port Id! ("+t+")"),t=t.toString(),-1!==t.indexOf(r+n)?t:s},p.prototype._createPort=function(t,e){var n,r,s,l,c,d,h,p,g,u,f,m,_=t.angles||[],b=0,y="any",v=e.createPort(),C=e.rect,E=t.area,D=17,I=0,P=90,T=180,A=270;return E instanceof Array&&(D=17,"any"!==y&&(D-="start"===y?1:16),c=Math.min(E[0][0],E[1][0]),d=Math.max(E[0][0],E[1][0]),h=Math.min(E[0][1],E[1][1]),p=Math.max(E[0][1],E[1][1]),g=h===p,h===p&&c===d&&(g=Math.min(Math.abs(C.ceil-h),Math.abs(C.floor-p))<Math.min(Math.abs(C.left-c),Math.abs(C.right-d)),g?(c-=1,d+=1):(h-=1,p+=1)),i(g||c===d,"AutoRouter:addBox Connection Area for box must be either horizontal or vertical"),n=c,r=d,s=h,l=p,g?Math.abs(h-C.ceil)<Math.abs(h-C.floor)?(s=h+1,l=h+5,b=o.PortStartOnTop+o.PortEndOnTop):(s=h-5,l=h-1,b=o.PortStartOnBottom+o.PortEndOnBottom):Math.abs(c-C.left)<Math.abs(c-C.right)?(n+=1,r+=5,b=o.PortStartOnLeft+o.PortEndOnLeft):(n-=5,r-=1,b=o.PortStartOnRight+o.PortEndOnRight)),3>r-n&&(n-=2,r+=2),3>l-s&&(s-=2,l+=2),u=new a(n,s,r,l),void 0!==_[0]&&void 0!==_[1]&&(f=_[0],m=_[1],b=0,I>=f&&m>=I&&(b+=o.PortStartOnRight+o.PortEndOnRight),A>=f&&m>=A&&(b+=o.PortStartOnTop+o.PortEndOnTop),T>=f&&m>=T&&(b+=o.PortStartOnLeft+o.PortEndOnLeft),P>=f&&m>=P&&(b+=o.PortStartOnBottom+o.PortEndOnBottom)),v.setLimitedDirs(!1),v.attributes=b,v.setRect(u),v},p.prototype._removePortsMatching=function(t){var e,n=t.id,o=this.portId2Path[n].out,s=this.portId2Path[n]["in"],a="";for(e=o.length;e--;)i(r.removeFromArrays(t,o[e].startports),"Port "+t.id+" not removed from startports"),a+=o[e].id+", ";for(a="",e=s.length;e--;)i(r.removeFromArrays(t,s[e].endports),"Port "+t.id+" not removed from endports"),a+=s[e].id+", ";for(e=this.graph.paths.length;e--;)i(-1===this.graph.paths[e].startports.indexOf(t),"port not removed from path startports! ("+this.graph.paths[e].id+")"),i(-1===this.graph.paths[e].endports.indexOf(t),"port not removed from path endports!")},p.prototype.removePort=function(t){var e=t.owner,n=t.id;i(e.parent,"Port container should have a parent box!"),this.graph.deleteBox(e),this._removePortsMatching(t);var o=this.portId2Box[n];i(void 0!==o,"Box Object not found for port ("+n+")!"),delete o.ports[n],this.ports[n]=void 0,this.portId2Path[n]=void 0,this.portId2Box[n]=void 0},p.prototype.addPath=function(t){for(var e=(this.pCount++).toString();e.length<6;)e="0"+e;return e="PATH_"+e,t.id=e,this._createPath(t),e};var u=function(t){var e=[];if(t instanceof d)e.push(t);else for(var n=Object.keys(t),o=n.length;o--;)i(t[n[o]]instanceof d,"Invalid port option: "+t[o]),e.push(t[n[o]]);return i(e.length>0,"Did not receive valid start or end ports"),e};p.prototype._createPath=function(t){if(!t.src||!t.dst)throw"AutoRouter:_createPath missing source or destination ports";var e,n,i,r,s=t.id,a=t.autoroute||!0,l=t.startDirection||t.start,c=t.endDirection||t.end;if(e=u(t.src),n=u(t.dst),i=this.graph.addPath(a,e,n),l||c){var d=void 0!==l?(-1!==l.indexOf("top")?o.PathStartOnTop:0)+(-1!==l.indexOf("bottom")?o.PathStartOnBottom:0)+(-1!==l.indexOf("left")?o.PathStartOnLeft:0)+(-1!==l.indexOf("right")?o.PathStartOnRight:0)||(-1!==l.indexOf("all")?o.PathDefault:0):o.PathDefault,h=void 0!==c?(-1!==c.indexOf("top")?o.PathEndOnTop:0)+(-1!==c.indexOf("bottom")?o.PathEndOnBottom:0)+(-1!==c.indexOf("left")?o.PathEndOnLeft:0)+(-1!==c.indexOf("right")?o.PathEndOnRight:0)||(-1!==c.indexOf("all")?o.PathDefault:0):o.PathDefault;i.setStartDir(d),i.setEndDir(h)}else i.setStartDir(o.PathDefault),i.setEndDir(o.PathDefault);for(i.id=s,this.paths[s]=i,r=e.length;r--;)this.portId2Path[e[r].id].out.push(i);for(r=n.length;r--;)this.portId2Path[n[r].id]["in"].push(i);return i},p.prototype.routeSync=function(){this.graph.routeSync()},p.prototype.routeAsync=function(t){this.graph.routeAsync(t)},p.prototype.getPathPoints=function(t){i(void 0!==this.paths[t],"AutoRouter:getPath requested path does not match any current paths");var e=this.paths[t];return e.points.map(function(t){return{x:t.x,y:t.y}})},p.prototype.getBoxRect=function(t){i(void 0!==this.graph.boxes[t],"AutoRouter:getBoxRect requested box does not match any current boxes");var e=this.graph.boxes[t].rect;return r.pick(["left","right","ceil","floor"],e)},p.prototype.setBoxRect=function(t,e){var n=t.box,i=void 0!==e.x1?e.x1:e.x2-e.width,o=void 0!==e.x2?e.x2:e.x1+e.width,r=void 0!==e.y1?e.y1:e.y2-e.height,s=void 0!==e.y2?e.y2:e.y1+e.height,l=new a(i,r,o,s);this.graph.setBoxRect(n,l)},p.prototype._changePortId=function(t,e){this.ports[e]=this.ports[t],this.portId2Path[e]=this.portId2Path[t],this.portId2Box[e]=this.portId2Box[t],this.ports[e].id=e,this.ports[t]=void 0,this.portId2Path[t]=void 0,this.portId2Box[t]=void 0},p.prototype.updatePort=function(t,e){var n,i=this.getPortId(e.id,t),o=this.ports[i],r="##TEMP_ID##",s=this.portId2Path[i]["in"],a=this.portId2Path[i].out;this._changePortId(i,r),n=this.addPort(t,e);var l,c;for(c=a.length;c--;)l=a[c],l.startports.push(n),this.graph.disconnect(l),this.portId2Path[i].out.push(l);for(c=s.length;c--;)l=s[c],l.endports.push(n),this.graph.disconnect(l),this.portId2Path[i]["in"].push(l);return this.removePort(o),t.ports[i]=n,n},p.prototype.remove=function(t){i(void 0!==t,"AutoRouter:remove Cannot remove undefined object");var e;if(t.box instanceof c){var n=Object.keys(t.ports);for(e=n.length;e--;)this.portId2Path[n[e]]=void 0;this.graph.deleteBox(t.box)}else{if(void 0===this.paths[t])throw"AutoRouter:remove Unrecognized item type. Must be an AutoRouterBox or an AutoRouterPath ID";if(this.paths[t]instanceof h){var o,r,s,a;for(o=this.paths[t],e=o.startports.length;e--;)r=o.startports[e].id,a=this.portId2Path[r].out.indexOf(o),this.portId2Path[r].out.splice(a,1);for(e=o.endports.length;e--;)s=o.endports[e].id,a=this.portId2Path[s]["in"].indexOf(o),this.portId2Path[s]["in"].splice(a,1);this.graph.deletePath(o)}delete this.paths[t]}},p.prototype.move=function(t,e){t=t instanceof c?t:t.box;var n=void 0!==e.dx?e.dx:Math.round(e.x-t.rect.left),o=void 0!==e.dy?e.dy:Math.round(e.y-t.rect.ceil);i(t instanceof c,"AutoRouter:move First argument must be an AutoRouterBox or ArBoxObject"),this.graph.shiftBoxBy(t,{cx:n,cy:o})},p.prototype.setMinimumGap=function(t){this.graph.setBuffer(Math.floor(t/2))},p.prototype.setComponent=function(t,e){var n=t.box,i=e.box;n.addChild(i)},p.prototype.setPathCustomPoints=function(t){var e,n=this.paths[t.path];if(void 0===n)throw"AutoRouter: Need to have an AutoRouterPath type to set custom path points";t.points.length>0?n.setAutoRouting(!1):n.setAutoRouting(!0),e=t.points.map(function(t){return new s(t[0],t[1])}),n.setCustomPathPoints(e)},p.prototype._assertPortId2PathIsValid=function(){for(var t,e,n,o=this.graph.paths.length;o--;){for(e=this.graph.paths[o],n=e.startports.length;n--;)t=e.startports[n].id,i(-1!==this.portId2Path[t].out.indexOf(e),"Port "+t+" is missing registered startport for "+e.id);for(n=e.endports.length;n--;)t=e.endports[n].id,i(-1!==this.portId2Path[t]["in"].indexOf(e),"Port "+t+" is missing registered endport for "+e.id)}},e.exports=p},{"./AutoRouter.Box":10,"./AutoRouter.Constants":11,"./AutoRouter.Graph":14,"./AutoRouter.Path":16,"./AutoRouter.Point":17,"./AutoRouter.Port":19,"./AutoRouter.Rect":20,"./AutoRouter.Utils":22,assert:1}]},{},[9])(9)}),define("js/Widgets/DiagramDesigner/ConnectionRouteManager3",["js/logger","module","AutoRouterActionApplier","./ConnectionRouteManager2","js/Utils/SaveToDisk"],function(t,e,n,i,o){"use strict";var r,s="_x_",a=!0;return r=function(o){if(window.Worker&&a){this._onItemCreateQueue={},this.workerQueue=[];var r,l=e.id.split("/");l.pop(),l=l.join("/"),r=l+"/AutoRouter.Worker.js",this.worker=new Worker(r),this.worker.postMessage([WebGMEGlobal.gmeConfig.client]),this.worker.onmessage=this._handleWorkerResponse.bind(this)}else this.readyToDownload=!1,window._.extend(this.prototype,n.prototype);this.init();var c=o&&o.loggerName||"gme:Widgets:DiagramDesigner:ConnectionRouteManager3";if(this.logger=o&&o.logger||t.create(c,WebGMEGlobal.gmeConfig.client.log),this.diagramDesigner=o?o.diagramDesigner:null,this.simpleRouter=new i(o),void 0===this.diagramDesigner||null===this.diagramDesigner)throw this.logger.error("Trying to initialize a ConnectionRouteManager3 without a canvas..."),new Error("ConnectionRouteManager3 can not be created");this.logger.debug("ConnectionRouteManager3 ctor finished"),this._portSeparator=s},r.prototype.init=n.prototype._clearRecords,r.prototype._invokeAutoRouterMethod=function(){var t,e=Array.prototype.slice.call(arguments);switch(this.workerReady?this.worker.postMessage(e):this.workerQueue.push(e),e[0]){case"addPath":case"addBox":t=e[1][1],this._onItemCreateQueue[t]=[];break;case"clear":this.init();break;case"remove":t=e[1][1],delete this._onItemCreateQueue[t]}},r.prototype._handleWorkerResponse=function(t){var e=t.data;if("READY"===e)this._processQueue(),this.workerReady=!0;else{var n,i="_autorouterBoxes";switch(e[0]){case"getPathPoints":n=e[1][0];var o=e[2];this._renderConnection(n,o);break;case"routePaths":for(var r=e[1],s=r.length;s--;)this._renderConnection.apply(this,r[s]);break;case"addPath":i="_autorouterPaths";case"addBox":if(n=e[1][1],this[i][n]=e[2],this._onItemCreateQueue[n])for(s=0;s<this._onItemCreateQueue[n].length;s++)this._onItemCreateQueue[n][s].call(this,e[2]);this._onItemCreateQueue[n]=null;break;case"BugReplayList":DEBUG&&this.download("AR_bug_report"+(new Date).getTime()+".json",e[1]),this.readyToDownload=!1}}},r.prototype.initialize=function(){this._clearGraph();var t=this;this._onComponentUpdate=function(e,n){if(-1!==t.diagramDesigner.itemIds.indexOf(n)){if(t.diagramDesigner.items[n].rotation!==t._autorouterBoxRotation[n]){var i=t._resizeItem.bind(t,n);t._modifyItem(n,i)}}else-1!==t.diagramDesigner.connectionIds.indexOf(n)&&(void 0!==t._onItemCreateQueue[n]?(t.deleteItem(n),t.insertConnection(n)):t.logger.warn("Received update event for nonexistent path"))},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_COMPONENT_UPDATE,this._onComponentUpdate),this._onComponentCreate=function(e,n){void 0===t._onItemCreateQueue[n]?-1!==t.diagramDesigner.itemIds.indexOf(n)?t.insertBox(n):-1!==t.diagramDesigner.connectionIds.indexOf(n)&&t.insertConnection(n):t.logger.warn("Received ON_COMPONENT_CREATE event for already created item! ("+n+")")},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_COMPONENT_CREATE,this._onComponentCreate),this._onComponentResize=function(e,n){if(void 0!==t._onItemCreateQueue[n.ID]){var i=t._resizeItem.bind(t,n.ID);t._modifyItem(n.ID,i)}else t.logger.warn("Received ITEM_SIZE_CHANGED event for nonexistent item! ("+n.ID+")"),t.insertBox(n.ID)},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ITEM_SIZE_CHANGED,this._onComponentResize),this._onComponentDelete=function(e,n){void 0!==t._onItemCreateQueue[n]?t.deleteItem(n):t.logger.warn("Received ON_COMPONENT_DELETE event for nonexistent item! ("+n+")")},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_COMPONENT_DELETE,this._onComponentDelete),this._onItemPositionChanged=function(e,n){if(void 0!==t._onItemCreateQueue[n.ID]){var i=t.diagramDesigner.items[n.ID].getBoundingBox().x,o=t.diagramDesigner.items[n.ID].getBoundingBox().y;t._modifyItem(n.ID,t._invokeAutoRouterMethod.bind(t,"move",[n.ID,{x:i,y:o}]))}else t.logger.warn("Received ITEM_POSITION_CHANGED event for nonexistent item! ("+n.ID+")")},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ITEM_POSITION_CHANGED,this._onItemPositionChanged),this._onClear=function(){t._clearGraph()},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_CLEAR,this._onClear),this._onUnregisterSubcomponent=function(e,n){var i=n.objectID+s+n.subComponentID;void 0!==t._onItemCreateQueue[i]?t.deleteItem(i):t.logger.warn("Received UNREGISTER event for nonexistent item! ("+i+")")},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_UNREGISTER_SUBCOMPONENT,this._onUnregisterSubcomponent)},r.prototype.destroy=function(){this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_COMPONENT_CREATE,this._onComponentCreate),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_COMPONENT_UPDATE,this._onComponentUpdate),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ITEM_SIZE_CHANGED,this._onComponentResize),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_COMPONENT_DELETE,this._onComponentDelete),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ITEM_POSITION_CHANGED,this._onItemPositionChanged),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_CLEAR,this._onClear),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_UNREGISTER_SUBCOMPONENT,this._onUnregisterSubcomponent),this.worker&&this.worker.terminate()},r.prototype.redrawConnections=function(t){this.simpleRouter.redrawConnections(t),this._initialized||this._initializeGraph(),this._invokeAutoRouterMethod("routeAsync",[])},r.prototype.renderConnections=function(t){for(var e=t||this.diagramDesigner.connectionIds.slice(0),n=e.length;n--;)this._autorouterPaths[e[n]]&&this._invokeAutoRouterMethod("getPathPoints",[e[n]]);return e},r.prototype._renderConnection=function(t,e){this.diagramDesigner.items[t]&&this.diagramDesigner.items[t].setConnectionRenderData(e)},r.prototype._clearGraph=function(){this._invokeAutoRouterMethod("clear",[]),this._autorouterBoxRotation={},this.endpointConnectionAreaInfo={},this.initialized=!1,this.readyToDownload=!0,this._onItemCreateQueue={}},r.prototype._initializeGraph=function(){for(var t=this.diagramDesigner,e=t.connectionIds,n=t.itemIds,i=n.length;i--;)this.insertBox(n[i]);for(i=e.length;i--;)this.insertConnection(e[i]);this._initialized=!0},r.prototype._processQueue=function(){for(var t=0;t<this.workerQueue.length;t++)this.worker.postMessage(this.workerQueue[t]);this.workerQueue=[]},r.prototype.insertConnection=function(t){var e,n=this.diagramDesigner,i=n.connectionEndIDs[t].srcObjId,o=n.connectionEndIDs[t].srcSubCompId,r=n.connectionEndIDs[t].dstObjId,a=n.connectionEndIDs[t].dstSubCompId,l=o?i+s+o:i,c=a?r+s+a:r,d=n.items[t].getMetaInfo(),h=n.items[i].getConnectionAreas(o,!1,d),p=n.items[r].getConnectionAreas(a,!0,d),g={},u={};for(this._updatePort(i,o),this._updatePort(r,a),e=h.length;e--;)g[h[e].id]=l;for(e=p.length;e--;)u[p[e].id]=c;if(0!==g.length&&0!==u.length&&this._invokeAutoRouterMethod("addPath",[{src:g,dst:u},t]),n.items[t].segmentPoints.length>0){
var f=n.items[t],m=f.segmentPoints.slice();this._invokeAutoRouterMethod("setPathCustomPoints",[{path:t,points:m}])}},r.prototype.insertBox=function(t){var e,n,i,o,r,s=this.diagramDesigner,a=0;for(e=s.items[t],i=e.getBoundingBox(),n=e.getConnectionAreas(t,r)||[],o={x1:i.x,y1:i.y,x2:i.x2,y2:i.y2,ports:[]};a<n.length;)o.ports.push({id:n[a].id,area:[[n[a].x1,n[a].y1],[n[a].x2,n[a].y2]],angles:[n[a].angle1,n[a].angle2]}),a++;this._invokeAutoRouterMethod("addBox",[o,t]),this._autorouterBoxRotation[t]=s.items[t].rotation},r.prototype.deleteItem=function(t){var e=this._invokeAutoRouterMethod.bind(this,"remove",[t]);this._modifyItem(t,e)},r.prototype._resizeItem=function(t){var e,n,i=this.diagramDesigner,o=!0,r=i.items[t],s=r.getBoundingBox(),a={x1:s.x,x2:s.x2,y1:s.y,y2:s.y2},l=[],c=r.getConnectionAreas(t,o,e);for(n=c.length;n--;)l.push({id:c[n].id,area:[[c[n].x1,c[n].y1],[c[n].x2,c[n].y2]],angles:[c[n].angle1,c[n].angle2]});for(this._invokeAutoRouterMethod("setBoxRect",[t,a]),n=l.length;n--;)this._invokeAutoRouterMethod("updatePort",[t,l[n]])},r.prototype._updatePort=function(t,e){var n,i,o=t+s+e;void 0!==e?void 0===this._onItemCreateQueue[o]?this._createPort(t,e):(n=this._createPortInfo(t,e),i=this._invokeAutoRouterMethod.bind(this,"setBoxRect",[o,n]),this._modifyItem(o,i)):this._modifyItem(t,this._updateBoxConnectionAreas.bind(this,t))},r.prototype._modifyItem=function(t,e){null===this._onItemCreateQueue[t]?e():this._onItemCreateQueue[t].push(e)},r.prototype._updateBoxConnectionAreas=function(t){var e,n,i=this.diagramDesigner.items[t].getConnectionAreas()||[],o={},r=[],s=this._autorouterBoxes[t];for(n=i.length;n--;)r.push({id:i[n].id,area:[[i[n].x1,i[n].y1],[i[n].x2,i[n].y2]],angles:[i[n].angle1,i[n].angle2]}),o[i[n].id]=!0;for(n=r.length;n--;)this._invokeAutoRouterMethod("updatePort",[t,r[n]]);if(!s)return void this.logger.error("ConnectionRouteManager3: no boxObject, related to #1289");for(n=s.ports.length;n--;)e=s.ports[n].id,o[e]||this._invokeAutoRouterMethod("removePort",[s.ports[n]])},r.prototype._createPort=function(t,e){var n=t+s+e,i=this._createPortInfo(t,e);this._invokeAutoRouterMethod("addBox",[i,n]),this._invokeAutoRouterMethod("setComponent",[t,n])},r.prototype._createPortInfo=function(t,e){for(var n=this.diagramDesigner,i=null,o=n.items[t].getConnectionAreas(e,!0,i)||[],r=o.length,s={x1:null,x2:null,y1:null,y2:null,ports:[]};r--;){var a=[o[r].angle1,o[r].angle2],l=Math.min(o[r].x1,o[r].x2),c=Math.max(o[r].x1,o[r].x2),d=Math.min(o[r].y1,o[r].y2),h=Math.max(o[r].y1,o[r].y2);if(s.ports.push({id:o[r].id,area:[[l,d],[c,h]],angles:a}),a){var p=a[0],g=a[1],u=0,f=90,m=180,_=270;(p>u||u>g)&&(c+=5),(p>m||m>g)&&(l-=5),(p>_||_>g)&&(d-=5),(p>f||f>g)&&(h+=5)}else 3>c-l&&(c+=3),3>h-d&&(h+=3);s.x2=Math.max(c+1,s.x2)||c+1,s.y1=Math.min(d-1,s.y1)||d-1,s.x1=Math.min(l-1,s.x1)||l-1,s.y2=Math.max(h+1,s.y2)||h+1}return s},r.prototype.download=function(t,e){var n=this;this.readyToDownload&&(t||(t="console.json"),o.saveJsonToDisk(t,e,n.logger,function(t,e){t&&n.logger.error("downloading resource for error handling failed",{metadata:{error:t}}),n.logger.error("Download url for auto-router debug data:",e),n.readyToDownload=!1}))},r}),define("js/Widgets/DiagramDesigner/ConnectionDrawingManager",["js/logger","js/Constants","js/Widgets/DiagramDesigner/DragScroll","./DiagramDesignerWidget.Constants"],function(t,e,n,i){"use strict";var o,r="ConnectionDrawingManager",s="mousedown."+r,a="mousemove."+r,l="mouseup."+r,c="mouseenter."+r,d="mouseleave."+r,h="#FF7800",p="-",g=2,u="none",f="none",m="create",_="reconnect",b=10;return o=function(e){var n=e&&e.loggerName||"gme:Widgets:DiagramDesigner:ConnectionDrawingManager";if(this.logger=t.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=e?e.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a ConnectionDrawingManager without a diagramDesigner..."),"ConnectionDrawingManager can not be created";this.logger.debug("ConnectionDrawingManager ctor finished")},o.prototype.initialize=function(t){var e=this;this._paper=this._diagramDesigner.skinParts.SVGPaper,this._metaInfo=null,this._connectionInDraw=!1,this._connectionPathProps={strokeWidth:g,strokeColor:h,lineType:p,arrowStart:f,arrowEnd:u},this._diagramDesigner.addEventListener(this._diagramDesigner.events.ITEM_POSITION_CHANGED,function(t,n){e._designerItemPositionChanged(n.ID)}),this._diagramDesigner.addEventListener(this._diagramDesigner.events.ITEM_SUBCOMPONENT_POSITION_CHANGED,function(t,n){e._designerItemPositionChanged(n.ItemID)}),this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(t,n){e._onComponentDelete(n)}),this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_UNREGISTER_SUBCOMPONENT,function(t,n){e._onComponentDelete(n.objectID,n.subComponentID)}),this._dragScroll=new n(this._diagramDesigner.skinParts.$diagramDesignerWidgetBody),this._el=t},o.prototype.activate=function(){this._activateMouseListeners()},o.prototype.deactivate=function(){this._deactivateMouseListeners()},o.prototype._activateMouseListeners=function(){var t=this;this._diagramDesigner._enableConnectionDrawing===!0&&(this._el.on(s,"."+i.CONNECTOR_CLASS,function(e){var n=$(this),o=n.attr(i.DATA_ITEM_ID),r=n.attr(i.DATA_SUBCOMPONENT_ID),s=1===e.which;t._diagramDesigner._triggerUIActivity(),s&&(void 0===o||null===o?t.logger.error('MOUSEDOWN on "connector" element but attribute "'+i.DATA_ITEM_ID+'" is not specified'):t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.DESIGN&&(t._startConnectionCreate(o,r,n,t._diagramDesigner.getAdjustedMousePos(e)),t._attachMouseListeners())),e.stopPropagation(),e.preventDefault()}),this._el.on(s,"."+i.CONNECTION_DRAGGABLE_END_CLASS,function(e){var n=$(this),i=n.attr("data-end"),o=n.attr("data-id"),r=1===e.which;r&&t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.DESIGN&&(t._startConnectionReconnect(o,i,t._diagramDesigner.getAdjustedMousePos(e)),t._attachMouseListeners()),e.stopPropagation(),e.preventDefault()}),this._el.on(l,"."+i.CONNECTOR_CLASS,function(){var e=$(this),n=e.attr(i.DATA_ITEM_ID),o=e.attr(i.DATA_SUBCOMPONENT_ID);t._connectionInDraw===!0&&(void 0===n||null===n?t.logger.error('MOUSEUP on "connector" element but attribute "'+i.DATA_ITEM_ID+'" is not specified'):t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.DESIGN&&t._minimalDistanceMet===!0&&t._connectionEndDrop(n,o))}))},o.prototype._deactivateMouseListeners=function(){this._el.off(s,"."+i.CONNECTOR_CLASS),this._el.off(s,"."+i.CONNECTION_DRAGGABLE_END_CLASS),this._el.off(c,"."+i.CONNECTOR_CLASS),this._el.off(d,"."+i.CONNECTOR_CLASS),this._el.off(l,"."+i.CONNECTOR_CLASS)},o.prototype.setConnectionInDrawProperties=function(t){this._connectionPathProps.strokeWidth="string"==typeof t[i.LINE_WIDTH]?t[i.LINE_WIDTH]:this._connectionPathProps.strokeWidth,this._connectionPathProps.strokeColor="string"==typeof t[i.LINE_COLOR]?t[i.LINE_COLOR]:this._connectionPathProps.strokeColor,this._connectionPathProps.arrowStart="string"==typeof t[i.LINE_START_ARROW]?t[i.LINE_START_ARROW]:this._connectionPathProps.arrowStart,this._connectionPathProps.arrowEnd="string"==typeof t[i.LINE_END_ARROW]?t[i.LINE_END_ARROW]:this._connectionPathProps.arrowEnd,this._connectionPathProps.lineType="string"==typeof t[i.LINE_PATTERN]?t[i.LINE_PATTERN]:this._connectionPathProps.lineType},o.prototype.setMetaInfo=function(t){this._metaInfo=t},o.prototype.getMetaInfo=function(){return this._metaInfo},o.prototype._attachMouseListeners=function(){var t=this;$(document).on(a,function(e){t._onBackgroundMouseMove(e),e.stopPropagation(),e.preventDefault()}),$(document).on(l,function(e){t._onBackgroundMouseUp(e),e.stopPropagation(),e.preventDefault()})},o.prototype._detachMouseListeners=function(){$(document).off(a),$(document).off(l)},o.prototype._drawConnection=function(){var t,e=this._connectionDesc.x,n=this._connectionDesc.y,i=this._connectionDesc.x2,o=this._connectionDesc.y2,r=7;if(!(Math.sqrt((i-e)*(i-e)+(o-n)*(o-n))<r)&&(t="M"+e+","+n+"L"+i+","+o,void 0===this._connectionPath?(this._connectionPath=this._paper.path(t),this._connectionPath.attr({"stroke-width":this._connectionPathProps.strokeWidth,stroke:this._connectionPathProps.strokeColor,"stroke-dasharray":this._connectionPathProps.lineType,"arrow-start":this._connectionPathProps.arrowStart,"arrow-end":this._connectionPathProps.arrowEnd})):this._connectionPath.attr({path:t}),this._connectionInDrawProps.type===_)){var s=this._diagramDesigner.items[this._connectionInDrawProps.connId].getConnectionProps();this._connectionPath.attr({"stroke-width":s.width,"arrow-start":s.arrowStart,"arrow-end":s.arrowEnd})}},o.prototype._getClosestConnectionPointCoordinates=function(t,e,n,i){var o,r,s,a,l,c,d,h=this._diagramDesigner.items[t];if(h){for(r=h.getConnectionAreas(e,!1,this._metaInfo)||[],s=r.length;s--;)this.logger.debug(JSON.stringify(r[s]));for(s=r.length,o={x:r[s-1].x1+(r[s-1].x2-r[s-1].x1)/2,y:r[s-1].y1+(r[s-1].y2-r[s-1].y1)/2},a=Math.sqrt((o.x-n)*(o.x-n)+(o.y-i)*(o.y-i)),s-=1;s--;)c=r[s].x1+(r[s].x2-r[s].x1)/2,d=r[s].y1+(r[s].y2-r[s].y1)/2,l=Math.sqrt((c-n)*(c-n)+(d-i)*(d-i)),a>l&&(a=l,o={x:c,y:d})}return o},o.prototype._connectionEndDrop=function(t,n){var o;this.logger.debug('Connection end dropped on item: "'+t+'", sCompId: "'+n+'"'),this._connectionInDrawProps.type===m?(o={src:this._connectionInDrawProps.src,srcSubCompId:this._connectionInDrawProps.sCompId,dst:t,dstSubCompId:n,visualStyle:{}},o[e.META_INFO]=this._metaInfo,this._connectionPathProps.strokeWidth!==g&&(o.visualStyle[i.LINE_WIDTH]=this._connectionPathProps.strokeWidth),this._connectionPathProps.strokeColor!==h&&(o.visualStyle[i.LINE_COLOR]=this._connectionPathProps.strokeColor),this._connectionPathProps.arrowStart!==f&&(o.visualStyle[i.LINE_START_ARROW]=this._connectionPathProps.arrowStart),this._connectionPathProps.arrowEnd!==u&&(o.visualStyle[i.LINE_END_ARROW]=this._connectionPathProps.arrowEnd),this._connectionPathProps.lineType!==p&&(o.visualStyle[i.LINE_PATTERN]=this._connectionPathProps.lineType),this.onCreateNewConnection(o)):this._connectionInDrawProps.type===_&&this.onModifyConnectionEnd({id:this._connectionInDrawProps.connId,endPoint:this._connectionInDrawProps.draggedEnd,endId:t,endSubCompId:n})},o.prototype.onCreateNewConnection=function(t){this.logger.warn("onCreateNewConnection: "+JSON.stringify(t))},o.prototype.onModifyConnectionEnd=function(t){this.logger.warn("onModifyConnectionEnd: "+JSON.stringify(t))},o.prototype._startConnectionCreate=function(t,e,n,i){var o;this.logger.debug('Start connection drawing from DesignerItem: "'+t+'", subcomponent: "'+e+'"'),this._connectionInDraw=!0,this._minimalDistanceMet=!1,this._setTempConnectionInDrawProperties(this._diagramDesigner.items[t].getDrawnConnectionVisualStyle(e)),this._connectionInDrawProps={src:t,sCompId:e,srcEl:n,type:m},o=this._getClosestConnectionPointCoordinates(t,e,i.mX,i.mY),this._connectionDesc={x:o.x,y:o.y,x2:i.mX,y2:i.mY},this._drawConnection(),this._dragScroll.start(),this.onStartConnectionCreate({srcId:t,srcSubCompId:e})},o.prototype.onStartConnectionCreate=function(t){this.logger.warn("onStartConnectionCreate with params: "+JSON.stringify(t))},o.prototype._startConnectionReconnect=function(t,e,n){this.logger.debug("_startConnectionReconnect connectionId:"+t+", draggedEnd:"+e),this._connectionInDraw=!0,this._minimalDistanceMet=!0,this._connectionInDrawProps={connId:t,draggedEnd:e,type:_},this._connectionDesc={x:0,y:0,x2:0,y2:0},this._setConnectionRedrawCoordinates(n),this._drawConnection(),this._dragScroll.start(),this.onStartConnectionReconnect({connId:t,draggedEnd:e})},o.prototype.onStartConnectionReconnect=function(t){this.logger.warn("onStartConnectionReconnect with params: "+JSON.stringify(t))},o.prototype.isDrawInProgress=function(){return this._connectionInDraw===!0},o.prototype._setConnectionRedrawCoordinates=function(t){var e,n=this._connectionInDrawProps.connId,o=this._connectionInDrawProps.draggedEnd===i.CONNECTION_END_SRC;if(n)if(o===!0){if(this._diagramDesigner.connectionEndIDs[n]){var r=this._diagramDesigner.connectionEndIDs[n].dstObjId,s=this._diagramDesigner.connectionEndIDs[n].dstSubCompId;e=this._getClosestConnectionPointCoordinates(r,s,t.mX,t.mY),this._connectionDesc.x=t.mX,this._connectionDesc.y=t.mY,this._connectionDesc.x2=e.x,this._connectionDesc.y2=e.y}}else if(this._diagramDesigner.connectionEndIDs[n]){var a=this._diagramDesigner.connectionEndIDs[n].srcObjId,l=this._diagramDesigner.connectionEndIDs[n].srcSubCompId;e=this._getClosestConnectionPointCoordinates(a,l,t.mX,t.mY),this._connectionDesc.x2=t.mX,this._connectionDesc.y2=t.mY,this._connectionDesc.x=e.x,this._connectionDesc.y=e.y}},o.prototype._setConnectionCreateCoordinates=function(t){var e=this._getClosestConnectionPointCoordinates(this._connectionInDrawProps.src,this._connectionInDrawProps.sCompId,t.mX,t.mY);this._connectionDesc.x=e.x,this._connectionDesc.y=e.y,this._connectionDesc.x2=t.mX,this._connectionDesc.y2=t.mY},o.prototype._onBackgroundMouseMove=function(t){var e=this._diagramDesigner.getAdjustedMousePos(t);if(this._connectionInDraw===!0)if(this._minimalDistanceMet===!0)this._updateDrawnConnection(e);else{var n=e.mX-this._connectionDesc.x2,i=e.mY-this._connectionDesc.y2;(Math.abs(n)>=b||Math.abs(i)>=b)&&(this._minimalDistanceMet=!0,this._updateDrawnConnection(e))}},o.prototype._updateDrawnConnection=function(t){this._connectionInDrawProps.type===m?this._setConnectionCreateCoordinates(t):this._connectionInDrawProps.type===_&&this._setConnectionRedrawCoordinates(t),this._drawConnection()},o.prototype._onBackgroundMouseUp=function(){this.logger.debug("_onBackgroundMouseUp"),this._detachMouseListeners(),this._endConnectionDraw()},o.prototype._endConnectionDraw=function(){this._connectionInDraw=!1,this._connectionPath&&(this._connectionPath.remove(),this._connectionPath=void 0),this._connectionInDrawProps=void 0,this._resetTempConnectionInDrawProperties(),this.onEndConnectionDraw(),this.logger.debug("Stopped connection drawing")},o.prototype.onEndConnectionDraw=function(){this.logger.warn("onEndConnectionDraw NOT OVERRIDDEN")},o.prototype._designerItemPositionChanged=function(t){this._connectionInDraw!==!1&&(this._connectionInDrawProps.type===m?this._connectionInDrawProps.src===t&&(this._setConnectionCreateCoordinates({mX:this._connectionDesc.x2,mY:this._connectionDesc.y2}),this._drawConnection()):this._connectionInDrawProps.type===_&&(this._connectionInDrawProps.draggedEnd===i.CONNECTION_END_SRC?this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].dstObjId===t&&(this._setConnectionRedrawCoordinates({mX:this._connectionDesc.x,mY:this._connectionDesc.y}),this._drawConnection()):this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].srcObjId===t&&(this._setConnectionRedrawCoordinates({mX:this._connectionDesc.x2,mY:this._connectionDesc.y2}),this._drawConnection())))},o.prototype._onComponentDelete=function(t,e){var n=!1;this._connectionInDraw!==!1&&(this._connectionInDrawProps.type===m?void 0===e||null===e?this._connectionInDrawProps.src===t&&(n=!0,this.logger.debug('Connection source "'+t+'" is being deleted. Connection creation canceled.')):this._connectionInDrawProps.src===t&&this._connectionInDrawProps.sCompId===e&&(n=!0,this.logger.debug('Connection source "'+t+'"/"'+e+'" is being deleted. Connection creation canceled.')):this._connectionInDrawProps.type===_&&(t===this._connectionInDrawProps.connId?(n=!0,this.logger.debug('Existing connection currently being redrawn "'+t+'" is being deleted. Connection re-connect canceled.')):void 0===e||null===e?(this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].srcObjId===t||this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].dstObjId===t)&&(n=!0,this.logger.debug('Existing connection endpoint "'+t+'" is being deleted. Connection re-connect canceled.')):(this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].srcObjId===t&&this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].srcSubCompId===e||this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].dstObjId===t&&this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].dstSubCompId===e)&&(n=!0,this.logger.debug('Existing connection endpoint "'+t+'"/"'+e+'" is being deleted. Connection creation canceled.'))),n===!0&&(this._detachMouseListeners(),this._endConnectionDraw()))},o.prototype._setTempConnectionInDrawProperties=function(t){t&&(this._saveTempConnectionInDrawProperties(),this.setConnectionInDrawProperties(t))},o.prototype._resetTempConnectionInDrawProperties=function(){this._savedConnectionProps&&this._revertSavedConnectionInDrawProperties()},o.prototype._saveTempConnectionInDrawProperties=function(){this._savedConnectionProps={};for(var t in this._connectionPathProps)this._connectionPathProps.hasOwnProperty(t)&&(this._savedConnectionProps[t]=this._connectionPathProps[t])},o.prototype._revertSavedConnectionInDrawProperties=function(){for(var t in this._savedConnectionProps)this._savedConnectionProps.hasOwnProperty(t)&&(this._connectionPathProps[t]=this._savedConnectionProps[t]);this._savedConnectionProps=void 0},o}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.EventDispatcher",["common/EventDispatcher"],function(t){"use strict";var e;return e=function(){},e.prototype._addEventDispatcherExtensions=function(){$.extend(this,new t),this.events={ITEM_POSITION_CHANGED:"ITEM_POSITION_CHANGED",ITEM_ROTATION_CHANGED:"ITEM_ROTATION_CHANGED",ITEM_SUBCOMPONENT_POSITION_CHANGED:"ITEM_SUBCOMPONENT_POSITION_CHANGED",ON_COMPONENT_DELETE:"ON_COMPONENT_DELETE",ON_UNREGISTER_SUBCOMPONENT:"ON_UNREGISTER_SUBCOMPONENT",ON_COMPONENT_CREATE:"ON_COMPONENT_CREATE",ON_COMPONENT_UPDATE:"ON_COMPONENT_UPDATE",ON_CLEAR:"ON_CLEAR",ITEM_SIZE_CHANGED:"ITEM_SIZE_CHANGED"}},e}),define("css!js/Widgets/ZoomWidget/styles/ZoomWidget",[],function(){}),define("js/Widgets/ZoomWidget/ZoomWidget",["jquery-csszoom","css!./styles/ZoomWidget.css"],function(){"use strict";function t(t){var e=$('<a tabindex="0" class="btn-zoom btn-zoom-in ui-corner-all ui-state-default"><i class="glyphicon glyphicon-plus"/></a>'),n=$('<a tabindex="0" class="btn-zoom btn-zoom-out ui-corner-all ui-state-default"><i class="glyphicon glyphicon-minus"/></a>'),i=$("<div/>",{"class":"zoom-widget-container "+t["class"]}),o=$("<div/>",{"class":t.sliderClass}),r=$("<label/>",{"class":"zoom-widget-label"});t.zoomValues=t.zoomValues||[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.2,1.4,1.6,1.8,2,2.5,3,3.5,4],i.append(e),i.append(o),i.append(n),i.append(r),o.csszoom({zoomTarget:t.zoomTarget,zoomLevels:t.zoomValues,onZoom:function(e){r.text(e+"x"),"function"==typeof t.onZoom&&t.onZoom(e)}}),t.showSliderAtStart||o.addClass("hidden"),e.on("click",function(){$(this).popover("hide"),o.csszoom("zoomIn")}),n.on("click",function(){$(this).popover("hide"),o.csszoom("zoomOut")}),i.find(".btn-zoom").popover({delay:{show:500,hide:2e3},animation:!1,trigger:"hover",title:"Zoom",content:'<a class="slider-toggle" href=#>slider</a>',html:!0}).on("show.bs.popover",function(){var t=$(this);t.hasClass("btn-zoom-in")?n.popover("hide"):e.popover("hide")}).on("shown.bs.popover",function(){var t=$(this),e=t.width()/2+1,n=o.hasClass("hidden")?"Show slider":"Hide slider",r=i.find("[id="+t.attr("aria-describedby")+"]");t.hasClass("btn-zoom-in")?r.css("top",parseFloat(r.css("top"))+e+"px"):r.css("top",parseFloat(r.css("top"))-e+"px"),i.find("a.slider-toggle").text(n),i.find("a.slider-toggle").on("click",function(){t.popover("hide"),o.hasClass("hidden")?o.removeClass("hidden"):o.addClass("hidden")})}),this.$zoomContainer=i,this.$zoomSlider=o}return t}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Zoom",["js/Widgets/ZoomWidget/ZoomWidget"],function(t){"use strict";var e;return e=function(){},e.prototype._initZoom=function(e){var n=this,i=e.zoomValues,o=new t({"class":"diagram-designer-zoom-container",sliderClass:"diagram-designer-zoom-slider",zoomTarget:this.skinParts.$itemsContainer,zoomValues:i,onZoom:function(t){n._zoomRatio=t,n._resizeItemContainer()}});this._zoomSlider=o.$zoomSlider,this.$el.parent().append(o.$zoomContainer),this._addZoomMouseHandler(this.$el)},e.prototype._addZoomMouseHandler=function(t){var e=this;t.on("mousewheel",function(t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey||n.altKey)&&(n.wheelDelta<0?e._zoomSlider.csszoom("zoomOut"):e._zoomSlider.csszoom("zoomIn"),t.stopPropagation(),t.preventDefault())}),t.on("DOMMouseScroll",function(t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey||n.altKey)&&(n.detail>0?e._zoomSlider.csszoom("zoomOut"):e._zoomSlider.csszoom("zoomIn"),t.stopPropagation(),t.preventDefault())})},e}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Keyboard",["js/KeyboardManager/IKeyTarget"],function(t){"use strict";var e;return e=function(){},_.extend(e.prototype,t.prototype),e.prototype.onKeyDown=function(t){var e=!0;switch(t.combo){case"del":this.onSelectionDelete(this.selectionManager.getSelectedElements()),e=!1;break;case"ctrl+a":this.selectAll(),e=!1;break;case"ctrl+q":this.selectNone(),e=!1;break;case"ctrl+i":this.selectItems(),e=!1;break;case"ctrl+u":this.selectConnections(),e=!1;break;case"ctrl+l":this.selectInvert(),e=!1;break;case"up":this._moveSelection(0,-this.gridSize),e=!1;break;case"down":this._moveSelection(0,this.gridSize),e=!1;break;case"left":this._moveSelection(-this.gridSize,0),e=!1;break;case"right":this._moveSelection(this.gridSize,0),e=!1;break;case this.CONSTANTS.KEY_SHORT_CUT_MOVE_TO_TOP:this.onAlignSelection(this.selectionManager.getSelectedElements(),this.CONSTANTS.MOVE_TO_TOP),e=!1;break;case this.CONSTANTS.KEY_SHORT_CUT_MOVE_TO_BOTTOM:this.onAlignSelection(this.selectionManager.getSelectedElements(),this.CONSTANTS.MOVE_TO_BOTTOM),e=!1;break;case this.CONSTANTS.KEY_SHORT_CUT_MOVE_TO_LEFT:this.onAlignSelection(this.selectionManager.getSelectedElements(),this.CONSTANTS.MOVE_TO_LEFT),e=!1;break;case this.CONSTANTS.KEY_SHORT_CUT_MOVE_TO_RIGHT:this.onAlignSelection(this.selectionManager.getSelectedElements(),this.CONSTANTS.MOVE_TO_RIGHT),e=!1}return e},e.prototype.onKeyUp=function(t){var e=!0;switch(t.combo){case"up":this._endMoveSelection(),e=!1;break;case"down":this._endMoveSelection(),e=!1;break;case"left":this._endMoveSelection(),e=!1;break;case"right":this._endMoveSelection(),e=!1}return e},e.prototype._moveSelection=function(t,e){this._keyMoveDelta||(this._keyMoveDelta={x:0,y:0},this.dragManager._initDrag(0,0),this.dragManager._startDrag(void 0)),this._keyMoveDelta.x+=t,this._keyMoveDelta.y+=e,this.dragManager._updateDraggedItemPositions(this._keyMoveDelta.x,this._keyMoveDelta.y)},e.prototype._endMoveSelection=function(){this._keyMoveDelta&&(this._keyMoveDelta=void 0,this.dragManager._endDragAction())},e}),define("js/Widgets/DiagramDesigner/HighlightManager",["js/logger","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(t,e){"use strict";var n;return n=function(e){var n=e&&e.loggerName||"gme:Widgets:DiagramDesigner:HighlightManager";if(this.logger=e&&e.logger||t.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=e?e.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a HighlightManager without a diagramDesigner..."),"HighlightManager can not be created";this._highlightedElements=[],this.logger.debug("HighlightManager ctor finished")},n.prototype.initialize=function(t){var e=this;this.$el=t,this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(t,n){e._onComponentDelete(n)})},n.prototype.activate=function(){this.$el.addClass(e.HIGHLIGHT_MODE_CLASS),this._activateMouseListeners()},n.prototype.deactivate=function(){this._deactivateMouseListeners(),this.$el.removeClass(e.HIGHLIGHT_MODE_CLASS),this._clear()},n.prototype._activateMouseListeners=function(){var t=this;this._diagramDesigner.onItemMouseDown=function(e,n){t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.HIGHLIGHT&&t._highLight(e,n.rightClick)},this._diagramDesigner.onConnectionMouseDown=function(e){t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.HIGHLIGHT&&t._highLight(e,!0)},this._diagramDesigner.onBackgroundDblClick=function(){t._diagramDesigner.mode===t._diagramDesigner.OPERATING_MODES.HIGHLIGHT&&t._clear()}},n.prototype._deactivateMouseListeners=function(){this._diagramDesigner.onItemMouseDown=void 0,this._diagramDesigner.onConnectionMouseDown=void 0,this._diagramDesigner.onBackgroundDblClick=void 0},n.prototype._highLight=function(t,e){var n,i,o=this._highlightedElements.indexOf(t),r=[];if(this.logger.debug('_highLight, ID: "'+t+'", highlightAssociated: '+e),-1===o){if(r.push(t),e)if(-1!==this._diagramDesigner.itemIds.indexOf(t))for(n=this._diagramDesigner._getConnectionsForItem(t),r=_.union(r,n),i=n.length;i--;)r=_.union(r,this._diagramDesigner._getItemsForConnection(n[i]));else-1!==this._diagramDesigner.connectionIds.indexOf(t)&&(n=this._diagramDesigner._getItemsForConnection(t),r=_.union(r,n));for(i=r.length;i--;)this._highlightedElements.push(r[i]),this._diagramDesigner.items[r[i]].highlight();this.onHighlight(r)}else{if(r.push(t),e)if(-1!==this._diagramDesigner.itemIds.indexOf(t))for(n=this._diagramDesigner._getConnectionsForItem(t),r=_.union(r,n),i=n.length;i--;)r=_.union(r,this._diagramDesigner._getItemsForConnection(n[i]));else-1!==this._diagramDesigner.connectionIds.indexOf(t)&&(n=this._diagramDesigner._getItemsForConnection(t),r=_.union(r,n));for(i=r.length;i--;)o=this._highlightedElements.indexOf(r[i]),this._highlightedElements.splice(o,1),this._diagramDesigner.items[r[i]].unHighlight();this.onUnhighlight(r)}},n.prototype._onComponentDelete=function(t){var e=this._highlightedElements.indexOf(t);-1!==e&&this._highLight(t,!1)},n.prototype._clear=function(){for(var t=this._highlightedElements.length,e=this._highlightedElements.slice(0);t--;)this._diagramDesigner.items[this._highlightedElements[t]].unHighlight();this._highlightedElements=[],this.onUnhighlight(e)},n.prototype.onHighlight=function(t){this.logger.debug("onHighlight idList: "+t)},n.prototype.onUnhighlight=function(t){this.logger.debug("onUnhighlight idList: "+t)},n}),define("js/Widgets/DiagramDesigner/SearchManager",["js/logger","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(t,e){"use strict";var n;return n=function(e){var n=e&&e.loggerName||"gme:Widgets:DiagramDesigner:SearchManager";if(this.logger=e&&e.logger||t.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=e?e.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a SearchManager without a diagramDesigner..."),"SearchManager can not be created";this._highlightedElements=[],this._lastSearchDesc="",this.logger.debug("SearchManager ctor finished")},n.prototype.initialize=function(t){var e=this;this.$el=t,this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(t,n){e._onComponentDelete(n)})},n.prototype.activate=function(){this._diagramDesigner.toolbarItems&&this._diagramDesigner.toolbarItems.filterBox&&(this._diagramDesigner.toolbarItems.filterBox.enabled(!0),this._diagramDesigner.toolbarItems.filterBox.setText("")),this.filterItems("")},n.prototype.deactivate=function(){this._diagramDesigner.toolbarItems&&this._diagramDesigner.toolbarItems.filterBox&&(this._diagramDesigner.toolbarItems.filterBox.setText(""),this._diagramDesigner.toolbarItems.filterBox.enabled(!1)),this.filterItems("")},n.prototype.filterItems=function(t){t&&""!==t?(this.$el.addClass(e.HIGHLIGHT_MODE_CLASS),this._doSearch(t)):(this.$el.removeClass(e.HIGHLIGHT_MODE_CLASS),this._clear())},n.prototype.applyLastSearch=function(){var t=this._lastSearchDesc;this._clear(),this.filterItems(t)},n.prototype._doSearch=function(t){var e,n,i,o,r=[],s=this._diagramDesigner.itemIds,a=this._diagramDesigner.items;for(this._lastSearchDesc=t,e=s.length;e--;)n=s[e],a[n].doSearch(t)&&r.push(n);for(i=_.difference(this._highlightedElements,r),e=i.length;e--;)n=i[e],a[n]&&a[n].unHighlight(),o=this._highlightedElements.indexOf(n),this._highlightedElements.splice(o,1);for(i=_.difference(r,this._highlightedElements),e=i.length;e--;)n=i[e],a[n]&&a[n].highlight(),this._highlightedElements.push(n)},n.prototype._onComponentDelete=function(t){var e=this._highlightedElements.indexOf(t);-1!==e&&this._highlightedElements.splice(e,1)},n.prototype._clear=function(){for(var t=this._highlightedElements.length;t--;)this._diagramDesigner.items.hasOwnProperty(this._highlightedElements[t])&&this._diagramDesigner.items[this._highlightedElements[t]].unHighlight();this._highlightedElements=[],this._lastSearchDesc=""},n}),define("css!js/Controls/styles/ContextMenu",[],function(){}),define("js/Controls/ContextMenu",["jquery","css!./styles/ContextMenu.css"],function(){"use strict";var t,e="context-menu",n="context-menu-layer",i=$('<div id="'+e+'"><div class="dropdown"><ul class="dropdown-menu"></ul></div></div>'),o=$('<div id="'+n+'"></div>'),r=$("body"),s=$('<li><a tabindex="-1" href="#"></a></li>'),a="key",l="doNotHide",c=200,d=100;return t=function(t){this._menuDiv=i.clone(),this._backgroundDiv=o.clone(),this._menuUL=this._menuDiv.find("ul").first(),t&&t.hasOwnProperty("items")&&this.createMenu(t.items),t&&t.callback&&(this._callback=t.callback)},t.prototype.show=function(t){var e,n,i=this,o=this._callback,s=$(window).height(),h=$(window).width();this.hide(),r.append(this._backgroundDiv).append(this._menuDiv),t||(t={x:100,y:100}),e=s-t.y,n=h-t.x,this._menuUL.css({"max-height":e>d?e:d,"max-width":n>c?n:c}),this._menuDiv.css({display:"block",left:n>c?t.x:h-c,top:e>d?t.y:s-d}),o&&(this._menuUL.off("click"),this._menuUL.on("click","li",function(t){var e=$(this),n=e.data(a);t.stopPropagation(),t.preventDefault(),"true"!==e.attr(l)&&i.hide(),o(n)})),this._backgroundDiv.off("mousedown"),this._backgroundDiv.on("mousedown",function(t){t.stopPropagation(),t.preventDefault(),i.hide()})},t.prototype.createMenu=function(t){var e,n;this._menuUL.empty();for(var i in t)t.hasOwnProperty(i)&&(e=s.clone(),e.data(a,i),e.find("a").text(t[i].name),t[i].icon&&(e.find("a").prepend(" "),"string"==typeof t[i].icon?(n=$("<i/>",{"class":t[i].icon}),e.find("a").prepend(n)):e.find("a").prepend($(t[i].icon))),t[i].doNotHide&&e.attr(l,"true"),this._menuUL.append(e))},t.prototype.destroy=function(){this.hide(),this._menuUL.empty()},t.prototype.hide=function(){this._backgroundDiv.detach(),this._menuDiv.detach()},t}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.ContextMenu",["js/Controls/ContextMenu"],function(t){"use strict";var e;return e=function(){},e.prototype.createMenu=function(e,n,i){var o,r=this.logger;o=new t({items:e,callback:function(t){r.debug("DiagramDesignerWidgetContextMenu_clicked: "+t),n&&n(t)}}),i=i||{x:200,y:200},o.show(i)},e}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Droppable",["js/DragDrop/DropTarget","./DiagramDesignerWidget.Constants"],function(t,e){"use strict";var n,i=0;return n=function(){},n.prototype._initDroppable=function(){var n=this;this._acceptDroppable=!1,this.acceptDropTempDisabled=!1,this.skinParts.$dropRegion=$("<div/>",{"class":e.DROP_REGION_CLASS}),this.skinParts.$dropRegion.insertBefore(this.skinParts.$itemsContainer),t.makeDroppable(this.skinParts.$dropRegion,{over:function(t,e){n._onDroppableOver(t,e)},out:function(){n._onDroppableOut()},drop:function(t,e){n._onBackgroundDrop(t,e)},activate:function(){n._onDroppableActivate()},deactivate:function(){n._onDroppableDeactivate()}})},n.prototype._onDroppableActivate=function(){this.mode===this.OPERATING_MODES.DESIGN&&this.skinParts.$dropRegion.css({width:"100%",height:"100%",top:this._scrollPos.top+i,left:this._scrollPos.left+i})},n.prototype._onDroppableDeactivate=function(){this.skinParts.$dropRegion.css({width:"0px",height:"0px",top:"0px",left:"0px"})},n.prototype._onDroppableOver=function(t,e){
this.logger.debug("_onDroppableOver: "+JSON.stringify(e)),e?(this._doAcceptDroppable(this.onBackgroundDroppableAccept(t,e),!0),this._savedAcceptDroppable=this._acceptDroppable):this._doAcceptDroppable(!1,!1)},n.prototype._onDroppableOut=function(){this._doAcceptDroppable(!1,!1)},n.prototype._onBackgroundDrop=function(t,e){var n=this.getAdjustedMousePos(t),i=n.mX,o=n.mY;this.logger.debug("_onBackgroundDrop: "+JSON.stringify(e)),this._acceptDroppable===!0&&(this.acceptDropTempDisabled===!0?this.acceptDropTempDisabled=!1:this.onBackgroundDrop(t,e,{x:i,y:o})),this._doAcceptDroppable(!1,!1)},n.prototype._doAcceptDroppable=function(t,n){this.skinParts.$dropRegion.removeClass(e.DROP_REGION_ACCEPT_DROPPABLE_CLASS),this.skinParts.$dropRegion.removeClass(e.DROP_REGION_REJECT_DROPPABLE_CLASS),t===!0?(this._acceptDroppable=!0,n&&this.skinParts.$dropRegion.addClass(e.DROP_REGION_ACCEPT_DROPPABLE_CLASS)):(this._acceptDroppable=!1,n&&this.skinParts.$dropRegion.addClass(e.DROP_REGION_REJECT_DROPPABLE_CLASS))},n.prototype.onBackgroundDroppableAccept=function(t,e){return this.logger.warn("DiagramDesignerWidget.prototype.onBackgroundDroppableAccept(event, dragInfo) not overridden in controller!!! dragInfo:"+JSON.stringify(e)),!1},n.prototype.onBackgroundDrop=function(t,e,n){this.logger.warn("DiagramDesignerWidget.prototype.onBackgroundDrop(event, dragInfo) not overridden in controller!!! dragInfo:"+JSON.stringify(e)+' , position: "'+JSON.stringify(n)+'"')},n.prototype._enableDroppable=function(e){this.skinParts.$dropRegion&&(e===!0?(t.enableDroppable(this.skinParts.$dropRegion,!0),void 0!==this._savedAcceptDroppable&&this._doAcceptDroppable(this._savedAcceptDroppable,!0)):(t.enableDroppable(this.skinParts.$dropRegion,!1),this._doAcceptDroppable(!1,!1)))},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Draggable",["js/DragDrop/DragSource","js/DragDrop/DragHelper","./DiagramDesignerWidget.Constants"],function(t,e,n){"use strict";var i,o="diagram-designer-drag-outline",r=$("<div/>",{"class":o}),s=$('<i class="glyphicon glyphicon-move"></i>'),a=$('<i class="glyphicon glyphicon-plus"></i>');return i=function(){},i.prototype._makeDraggable=function(e){var i=this;t.makeDraggable(e.$el,{helper:function(t,e){return i._dragHelper(this,t,e)},dragItems:function(){return i.getDragItems(i.selectionManager.getSelectedElements())},dragEffects:function(t,e){return i.getDragEffects(i.selectionManager.getSelectedElements(),e)},dragParams:function(t,e){return i.getDragParams(i.selectionManager.getSelectedElements(),e)},start:function(t){var e=!1;if(i.mode===i.OPERATING_MODES.DESIGN)if(t.originalEvent.target instanceof SVGElement){var o=t.originalEvent.target.getAttribute("class");e=o?-1===o.split(" ").indexOf(n.CONNECTOR_CLASS):!0}else e=!$(t.originalEvent.target).hasClass(n.CONNECTOR_CLASS);return e}})},i.prototype._destroyDraggable=function(e){t.destroyDraggable(e.$el)},i.prototype._dragHelper=function(n,i,o){var l=r.clone(),c=this.selectionManager._getSelectionBoundingBox(),d=this.getAdjustedMousePos(i),h=e.getDragEffects(o);return this.logger.debug("_dragHelper's dragInfo: "+JSON.stringify(o)),c&&(l.css({width:(c.x2-c.x)*this._zoomRatio,height:(c.y2-c.y)*this._zoomRatio,"line-height":(c.y2-c.y)*this._zoomRatio+"px","text-align":"center",border:"2px dashed #666","background-color":"rgba(100, 100, 100, 0.1)","margin-top":(c.y-d.mY+t.DEFAULT_CURSOR_AT.top)*this._zoomRatio,"margin-left":(c.x-d.mX+t.DEFAULT_CURSOR_AT.left)*this._zoomRatio}),1===h.length&&(h[0]===t.DRAG_EFFECTS.DRAG_MOVE?l.append(s.clone()).append(" Move..."):h[0]===t.DRAG_EFFECTS.DRAG_COPY&&l.append(a.clone()).append(" Copy..."))),l},i.prototype.getDragItems=function(t){return this.logger.warn("DiagramDesignerWidgetDraggable.getDragItems is not overridden in the controller!!!selectedElements: "+t),[]},i.prototype.getDragEffects=function(e,n){var i=n.ctrlKey||n.metaKey,o=[t.DRAG_EFFECTS.DRAG_MOVE];return i&&(o=[t.DRAG_EFFECTS.DRAG_COPY]),o},i.prototype.getDragParams=function(t,e){for(var n,i={positions:{}},o=t.length,r=this.getAdjustedMousePos(e);o--;)n=t[o],-1!==this.itemIds.indexOf(n)&&(i.positions[n]={x:this.items[n].positionX-r.mX,y:this.items[n].positionY-r.mY});return i},i.prototype.DRAG_EFFECTS=t.DRAG_EFFECTS,i}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Clipboard",[],function(){"use strict";var t;return t=function(){},t.prototype.onCopy=function(){return void this.logger.warn("DiagramDesignerWidget.onCopy is not overridden in the controller!!!")},t.prototype.onPaste=function(t){this.logger.warn("DiagramDesignerWidget.onPaste is not overridden in the controller!!! data: "+t)},t}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Toolbar",["./DiagramDesignerWidget.OperatingModes","./DiagramDesignerWidget.Constants"],function(t,e){"use strict";var n;return n=function(){},n.prototype._initializeToolbar=function(){var n=WebGMEGlobal.Toolbar,i=this,o=$("<i/>");if(this.toolbarItems={},n){if(this.toolbarItems.beginSeparator=n.addSeparator(),this.toolbarItems.btnGridLayout=n.addButton({title:"Compact Grid Layout",icon:"glyphicon glyphicon-th",data:{mode:"grid"},clickFn:function(t){i.itemAutoLayout(t.mode)}}),this.toolbarItems.btnCozyGridLayout=n.addButton({title:"Sparse Grid Layout",icon:"glyphicon glyphicon-th-large",data:{mode:"cozygrid"},clickFn:function(t){i.itemAutoLayout(t.mode)}}),DEBUG===!0&&(this.toolbarItems.progressText=n.addLabel()),this.toolbarItems.gridSeparator=n.addSeparator(),this._disableConnectionRendering||(this.toolbarItems.radioButtonGroupRouteManager=n.addRadioButtonGroup(function(t){i._onConnectionRouteManagerChanged(t.type)}),this.toolbarItems.radioButtonGroupRouteManager.addButton({title:"Basic route manager",icon:o.clone().addClass("gme icon-gme_diagonal-arrow"),selected:"basic"===this._defaultConnectionRouteManagerType,data:{type:"basic"}}),this.toolbarItems.radioButtonGroupRouteManager.addButton({title:"Basic+ route manager",icon:o.clone().addClass("gme icon-gme_broken-arow"),selected:"basic2"===this._defaultConnectionRouteManagerType,data:{type:"basic2"}}),this._disableAutoRouterOption||this.toolbarItems.radioButtonGroupRouteManager.addButton({title:"AutoRouter",icon:o.clone().addClass("gme icon-gme_broken-arrow-with-box"),selected:"basic3"===this._defaultConnectionRouteManagerType,data:{type:"basic3"}}),this.toolbarItems.routingManagerSeparator=n.addSeparator()),this.toolbarItems.radioButtonGroupOperatingMode=n.addRadioButtonGroup(function(t){i.setOperatingMode(t.mode)}),this.toolbarItems.radioButtonGroupOperatingMode.addButton({icon:"glyphicon glyphicon-lock",title:"Read-only mode",data:{mode:t.prototype.OPERATING_MODES.READ_ONLY}}),this.toolbarItems.radioButtonGroupOperatingMode.addButton({icon:"glyphicon glyphicon-move",title:"Design mode",selected:!0,data:{mode:t.prototype.OPERATING_MODES.DESIGN}}),this.toolbarItems.radioButtonGroupOperatingMode.addButton({icon:"glyphicon glyphicon-eye-open",title:"Highlight mode",data:{mode:t.prototype.OPERATING_MODES.HIGHLIGHT}}),this.toolbarItems.modeSeparator=n.addSeparator(),DEBUG===!0&&(this.toolbarItems.btnXing=n.addToggleButton({icon:o.clone().addClass("gme icon-gme_crossing-lines"),title:"Connection crossing bumps ON/OFF",clickFn:function(t,e){i._setConnectionXingJumpMode(e)}}),this.toolbarItems.crossingLinesSeparator=n.addSeparator()),this._lineStyleControls===!0){this.toolbarItems.ddbtnConnectionArrowStart=n.addDropDownButton({title:"Line start marker",icon:"glyphicon glyphicon-arrow-left",menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionPattern=n.addDropDownButton({title:"Line pattern",icon:"glyphicon glyphicon-minus",menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionArrowEnd=n.addDropDownButton({title:"Line end marker",icon:"glyphicon glyphicon-arrow-right",menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionLabelPlacement=n.addDropDownButton({title:"Line label placement",icon:"fa fa-sliders fa-rotate-90",menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionLineWidth=n.addDropDownButton({title:"Line width",icon:o.clone().addClass("gme icon-gme_lines"),menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionLineType=n.addDropDownButton({title:"Line type",icon:o.clone().addClass("gme  icon-gme_curvy-line"),menuClass:"no-min-width"});var r,s=function(t,n){var o=t===e.LINE_ARROWS.NONE?"":"-xwide-xlong",r=n?null:t+o,s=n?t+o:null;return{title:t,icon:i._createLineStyleMenuItem(null,null,null,r,s),data:{endArrow:s,startArrow:r},clickFn:function(t){var n={};t.endArrow&&(n[e.LINE_END_ARROW]=t.endArrow),t.startArrow&&(n[e.LINE_START_ARROW]=t.startArrow),i._setConnectionProperty(n)}}},a=function(t){return{title:t,icon:i._createLineStyleMenuItem(null,null,e.LINE_PATTERNS[t],null,null),data:{pattern:t},clickFn:function(t){var n={};n[e.LINE_PATTERN]=e.LINE_PATTERNS[t.pattern],i._setConnectionProperty(n)}}};for(r in e.LINE_ARROWS)e.LINE_ARROWS.hasOwnProperty(r)&&(this.toolbarItems.ddbtnConnectionArrowStart.addButton(s(e.LINE_ARROWS[r],!1)),this.toolbarItems.ddbtnConnectionArrowEnd.addButton(s(e.LINE_ARROWS[r],!0)));for(r in e.LINE_PATTERNS)e.LINE_PATTERNS.hasOwnProperty(r)&&this.toolbarItems.ddbtnConnectionPattern.addButton(a(r));this.toolbarItems.ddbtnConnectionLabelPlacement.addButton({title:"In the middle",icon:i._createLineStyleMenuItem(null,null,null,null,null,null,e.LINE_LABEL_PLACEMENTS.MIDDLE),clickFn:function(){var t={};t[e.LINE_LABEL_PLACEMENT]=e.LINE_LABEL_PLACEMENTS.MIDDLE,i._setConnectionProperty(t)}}),this.toolbarItems.ddbtnConnectionLabelPlacement.addButton({title:"Next to source",icon:i._createLineStyleMenuItem(null,null,null,null,null,null,e.LINE_LABEL_PLACEMENTS.SRC),clickFn:function(){var t={};t[e.LINE_LABEL_PLACEMENT]=e.LINE_LABEL_PLACEMENTS.SRC,i._setConnectionProperty(t)}}),this.toolbarItems.ddbtnConnectionLabelPlacement.addButton({title:"Next to destination",icon:i._createLineStyleMenuItem(null,null,null,null,null,null,e.LINE_LABEL_PLACEMENTS.DST),clickFn:function(){var t={};t[e.LINE_LABEL_PLACEMENT]=e.LINE_LABEL_PLACEMENTS.DST,i._setConnectionProperty(t)}}),this.toolbarItems.ddbtnConnectionLineType.addButton({title:"Straight",icon:i._createLineStyleMenuItem(),clickFn:function(){var t={};t[e.LINE_TYPE]=e.LINE_TYPES.NONE,i._setConnectionProperty(t)}}),this.toolbarItems.ddbtnConnectionLineType.addButton({title:"Bezier",icon:i._createLineStyleMenuItem(null,null,null,null,null,e.LINE_TYPES.BEZIER),clickFn:function(){var t={};t[e.LINE_TYPE]=e.LINE_TYPES.BEZIER,i._setConnectionProperty(t)}});var l=function(t){return{title:t,icon:i._createLineStyleMenuItem(t,null,e.LINE_PATTERNS.SOLID,null,null),data:{width:t},clickFn:function(t){var n={};n[e.LINE_WIDTH]=t.width,i._setConnectionProperty(n)}}};for(r=1;10>r;r+=1)this.toolbarItems.ddbtnConnectionLineWidth.addButton(l(r));this.toolbarItems.ddbtnConnectionArrowStart.enabled(!1),this.toolbarItems.ddbtnConnectionPattern.enabled(!1),this.toolbarItems.ddbtnConnectionArrowEnd.enabled(!1),this.toolbarItems.ddbtnConnectionLineType.enabled(!1),this.toolbarItems.ddbtnConnectionLineWidth.enabled(!1),this.toolbarItems.ddbtnConnectionLabelPlacement.enabled(!1)}this.toolbarItems.cpFillColor=n.addColorPicker({icon:"glyphicon glyphicon-tint",title:"Fill color",colorChangedFn:function(t){i.onSelectionFillColorChanged(i.selectionManager.getSelectedElements(),t)}}),this.toolbarItems.cpBorderColor=n.addColorPicker({icon:o.clone().addClass("gme icon-gme_pen"),title:"Border color",colorChangedFn:function(t){i.onSelectionBorderColorChanged(i.selectionManager.getSelectedElements(),t)}}),this.toolbarItems.cpTextColor=n.addColorPicker({icon:"glyphicon glyphicon-font",title:"Text color",colorChangedFn:function(t){i.onSelectionTextColorChanged(i.selectionManager.getSelectedElements(),t)}}),this.toolbarItems.cpFillColor.enabled(!1),this.toolbarItems.cpBorderColor.enabled(!1),this.toolbarItems.cpTextColor.enabled(!1),this._defaultSearchUI===!0&&(this.toolbarItems.filterBox=n.addTextBox({prependContent:'<i class="glyphicon glyphicon-search"></i>&nbsp;',placeholder:"Find...",textChangedFn:function(t,e){i.searchManager.filterItems(e)}}))}this._toolbarInitialized=!0},n.prototype._displayToolbarItems=function(t){if(this._toolbarInitialized!==!0)this._initializeToolbar(t);else for(var e in this.toolbarItems)this.toolbarItems.hasOwnProperty(e)&&this.toolbarItems[e].show()},n.prototype._hideToolbarItems=function(){for(var t in this.toolbarItems)this.toolbarItems.hasOwnProperty(t)&&this.toolbarItems[t].hide()},n.prototype._removeToolbarItems=function(){for(var t in this.toolbarItems)this.toolbarItems.hasOwnProperty(t)&&this.toolbarItems[t].destroy()},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Mouse",["./DiagramDesignerWidget.Constants"],function(t){"use strict";var e,n="DiagramDesignerWidget";return e=function(){},e.prototype.initialize=function(t){this.$el=t,this._activateMouseListeners()},e.prototype._activateMouseListeners=function(){var e=this,i=this.logger;this.$el.on("mousedown."+n,"div."+t.DESIGNER_ITEM_CLASS,function(t){var o=$(this).attr("id"),r=e._processMouseEvent(t,!0,!0,!0,!0),s=!1,a=e.selectionManager.getSelectedElements(),l=-1===a.indexOf(o);l&&e.onItemMouseDown&&e.onItemMouseDown(o,r,s),i.debug("mousedown.item, ItemID: "+o+" eventDetails: "+JSON.stringify(r)),e.$el.on("mousemove."+n,function(){s=!0}),e.$el.on("mouseup."+n,function(){e.$el.off("mousemove."+n),e.$el.off("mouseup."+n),e.onItemMouseDown&&!l?e.onItemMouseDown.call(e,o,r,s):i.warn("onItemMouseDown(itemId, eventDetails) is undefined, ItemID: "+o+" eventDetails: "+JSON.stringify(r)+" mouseMoved: "+s)})}),this.$el.on("mousedown."+n,'path[class~="'+t.DESIGNER_CONNECTION_CLASS+'"]',function(n){var o=$(this).attr("id").replace(t.PATH_SHADOW_ARROW_END_ID_PREFIX,"").replace(t.PATH_SHADOW_ID_PREFIX,""),r=e._processMouseEvent(n,!0,!0,!0,!0);i.debug("mousedown.connection, connId: "+o+" eventDetails: "+JSON.stringify(r)),e.onConnectionMouseDown?e.onConnectionMouseDown.call(e,o,r):i.warn("onConnectionMouseDown(connId, eventDetails) is undefined, connId: "+o+" eventDetails: "+JSON.stringify(r))}),this.$el.on("mousedown."+n,function(t){var n=e._processMouseEvent(t,!0,!0,!0,!0);i.debug("mousedown.background, eventDetails: "+JSON.stringify(n)),e.onBackgroundMouseDown?e.onBackgroundMouseDown.call(e,n):i.warn("onBackgroundMouseDown(eventDetails) is undefined, eventDetails: "+JSON.stringify(n))}),this.$el.on("dblclick."+n,function(t){var n=e._processMouseEvent(t,!0,!0,!0,!0);e.onBackgroundDblClick?e.onBackgroundDblClick.call(e,n):i.warn("onBackgroundDblClick(eventDetails) is undefined, eventDetails: "+JSON.stringify(n)),i.warn("dblclick.background, eventDetails: "+JSON.stringify(n))}),this.$el.on("contextmenu."+n,function(t){t.preventDefault(),t.stopImmediatePropagation()})},e.prototype._processMouseEvent=function(t,e,n,i,o){return e===!0&&this._triggerUIActivity(),n===!0&&t.preventDefault(),i===!0&&t.stopPropagation(),o===!0&&t.stopImmediatePropagation(),this._getMouseEventDetails(t)},e.prototype._getMouseEventDetails=function(t){var e=this.getAdjustedMousePos(t),n={rightClick:3===t.which,ctrlKey:t.ctrlKey,metaKey:t.metaKey,altKey:t.altKey,shiftKey:t.shiftKey,mouseX:e.mX,mouseY:e.mY};return n},e.prototype.trackMouseMoveMouseUp=function(t,e){var i=this;$(document).on("mousemove."+n,function(e){var n=i._processMouseEvent(e,!1,!0,!0,!0);t&&t.call(i,n)}),$(document).on("mouseup."+n,function(t){var o=i._processMouseEvent(t,!1,!0,!0,!0);$(document).off("mousemove."+n),$(document).off("mouseup."+n),e&&e.call(i,o)})},e}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Tabs",["js/Toolbar/ToolbarButton","js/Toolbar/ToolbarDropDownButton"],function(t,e){"use strict";var n,i="diagram-designer-tabs-container",o="add-tab-container",r="tab-list-container",s=200,a="TAB_ID",l="TAB_RENAME",c="w-tabs",d="icon-ok",h=$('<i class="'+d+' glyphicon glyphicon-ok" />'),p=$('<li class=""><a href="#" data-toggle="tab"><div class="tab-title"></div></a></li>'),g=$('<i class="glyphicon glyphicon-remove-circle delete-tab-btn hidden"/>');return n=function(){},n.prototype._initializeTabs=function(){var n=this;this.$tabsContainer=$("<div/>",{"class":i}),this.$el.parent().append(this.$tabsContainer),this.$el.parent().addClass(c),this._tabCounter=0,this._selectedTab=void 0,this.$divAddTab=$("<div/>",{"class":o}),this._addTabs===!0&&(this.$btnAddTab=new t({title:"Add new tab...",icon:"glyphicon glyphicon-plus",clickFn:function(){n.getIsReadOnlyMode()!==!0&&n.onTabAddClicked()}}),this.$divAddTab.append(this.$btnAddTab.el)),this.$ddlTabsList=new e({title:"Tab list",icon:"glyphicon glyphicon-list"}),this.$divAddTab.append(this.$ddlTabsList.el),this.$btnScrollLeft=new t({title:"Scroll left",icon:"glyphicon glyphicon-chevron-left",clickFn:function(){n._tabsScrollLeft()}}),this.$divAddTab.append(this.$btnScrollLeft.el),this.$btnScrollRight=new t({title:"Scroll right",icon:"glyphicon glyphicon-chevron-right",clickFn:function(){n._tabsScrollRight()}}),this.$divAddTab.append(this.$btnScrollRight.el),this.$divTabList=$("<div/>",{"class":r}),this.$ulTabTab=$("<ul/>",{"class":"nav nav-tabs"}),this.$divTabList.append(this.$ulTabTab),this._makeTabsSortable(),this.$tabsContainer.append(this.$divAddTab),this.$tabsContainer.append(this.$divTabList),this._tabScrollValue=0,this.$ulTabTab.on("dblclick.editOnDblClick",".tab-title",function(t){if(n.getIsReadOnlyMode()!==!0){var e=$(this).parentsUntil("li").parent();e.data(l)===!0&&$(this).editInPlace({"class":"",onChange:function(t,e){var i=$(this).parent().parent();n.onTabTitleChanged(i.data(a),t,e)}})}t.stopPropagation(),t.preventDefault()}),this.$ulTabTab.on("click.deleteTabClick","a > i",function(t){var e=$(this).parent().parent();n.getIsReadOnlyMode()!==!0&&e.hasClass("active")&&n.onTabDeleteClicked(e.data(a)),t.stopPropagation(),t.preventDefault()}),this.$ulTabTab.on("click.selectTabClick","li",function(t){n.selectTab($(this).data(a)),t.stopPropagation(),t.preventDefault()})},n.prototype._addTabsButtonEnabled=function(t){this.$btnAddTab&&this.$btnAddTab.enabled(t)},n.prototype.clearTabs=function(){this._destroyTabsSortable(),this.$ulTabTab.empty(),this._makeTabsSortable(),this.$ddlTabsList.clear(),this._tabCounter=0,this._selectedTab=void 0,this._scrollTabListBy(0-this._tabScrollValue)},n.prototype._makeTabsSortable=function(){var t=this;this.getIsReadOnlyMode()!==!0&&this._reorderTabs===!0&&(this.$ulTabTab.hasClass("ui-sortable")||this.$ulTabTab.sortable({dropBehaviour:!0,stop:function(){t._onTabsSortStop()}}))},n.prototype._destroyTabsSortable=function(){this.$ulTabTab&&this.$ulTabTab.hasClass("ui-sortable")&&this.$ulTabTab.sortable("destroy")},n.prototype._addTabDeleteBtn=function(t){var e=g.clone();e.attr("title","Delete tab"),t.find("a").append(e)},n.prototype.addTab=function(t,e,n){var i=this,o=p.clone();return o.find(".tab-title").attr("title",t).text(t),o.data(a,this._tabCounter+""),this._tabCounter+=1,this._deleteTabs===!0&&e===!0&&this._addTabDeleteBtn(o),o.data(l,n),this.$ulTabTab.append(o),this.$ddlTabsList.addButton({title:t,text:t,data:{TAB_ID:o.data(a)},clickFn:function(t){i.selectTab(t.TAB_ID)}}),this._addingMultipleTabs!==!0&&this._refreshTabScrollButtons(),o.data(a)},n.prototype.addMultipleTabsBegin=function(){this._addingMultipleTabs=!0,this.$ulTabTab.hide()},n.prototype.addMultipleTabsEnd=function(){this.$ulTabTab.show(),this._refreshTabScrollButtons(),this._addingMultipleTabs=!1},n.prototype._tabsScrollLeft=function(){this._tabScrollValue<0&&this._scrollTabListBy(Math.min(Math.abs(this._tabScrollValue),s))},n.prototype._tabsScrollRight=function(){var t=this.$ulTabTab.width()-this.$tabsContainer.width()+this.$divAddTab.outerWidth(!0)+this._tabScrollValue;t>0&&(t=Math.min(t,s),this._scrollTabListBy(-t))},n.prototype._scrollTabListBy=function(t){this._tabScrollValue+=t,this.$ulTabTab.css("left",this._tabScrollValue),this._refreshTabScrollButtons()},n.prototype.selectTab=function(t){var e,n,i,o,r=this.$ulTabTab.find("li"),s=this.$ddlTabsList.el.find("li");if(this._selectedTab!==t){for(i=0;i<r.length;i+=1)if(o=$(r[i]),o&&o.data(a)===t){e=o;break}for(e&&(n=this.$ulTabTab.find("li.active"),n.removeClass("active"),n.find(".delete-tab-btn").addClass("hidden"),e.addClass("active"),e.find(".delete-tab-btn").removeClass("hidden"),this._selectedTab=e.data(a),this.setBackgroundText(this.$ulTabTab.find("li.active").first().find(".tab-title").text().toUpperCase())),e=void 0,i=0;i<s.length;i+=1)if(o=$(s[i]).find("a").first(),o&&o.data(a)===t){e=$(s[i]);break}e&&(this.$ddlTabsList.el.find("i."+d).remove(),e.find("a").prepend(h.clone())),this._scrollSelectedTabIntoView(),this.onSelectedTabChanged(this._selectedTab)}},n.prototype._scrollSelectedTabIntoView=function(){var t=this.$ulTabTab.find("li.active").first(),e=t.position(),n=this.$tabsContainer.width()-this.$divAddTab.outerWidth(!0),i=-this._tabScrollValue,o=-this._tabScrollValue+n;e&&(e.left<i?this._scrollTabListBy(i-e.left):e.left+t.width()>o&&this._scrollTabListBy(o-(e.left+t.width())))},n.prototype._refreshTabScrollButtons=function(){var t=this.$ulTabTab.width()-this.$tabsContainer.width()+this.$divAddTab.outerWidth(!0)+this._tabScrollValue;this.$btnScrollLeft.enabled(this._tabScrollValue<0),this.$btnScrollRight.enabled(t>0)},n.prototype._onTabsSortStop=function(){var t,e,n=this.$ulTabTab,i=n.find("li"),o=[];for(t=0;t<i.length;t+=1)e=$(i[t]),o.push(e.data(a));o.length>0&&this.onTabsSorted(o)},n.prototype._refreshTabTabsScrollOnResize=function(){if(this._tabsEnabled===!0){var t=this.$ulTabTab.width()-this.$tabsContainer.width()+this.$divAddTab.outerWidth(!0)+this._tabScrollValue;0>t&&this._scrollTabListBy(-t),this._scrollSelectedTabIntoView(),this._refreshTabScrollButtons()}},n.prototype.onTabDeleteClicked=function(t){this.logger.warn('onTabDeleteClicked not implemented: "'+t+'"')},n.prototype.onTabAddClicked=function(){var t=this.addTab("New tab",!0);this.logger.warn('onTabAddClicked not implemented: "'+t+'"')},n.prototype.onTabTitleChanged=function(t,e,n){this.logger.warn("onTabTitleChanged not implemented: ID: "+t+' "'+e+'" --> "'+n+'"')},n.prototype.onSelectedTabChanged=function(t){this.logger.warn('onSelectedTabChanged not implemented: "'+t+'"')},n.prototype.onTabsSorted=function(t){this.logger.warn('onTabsSorted not implemented: "'+t+'"')},n}),define("css!js/Widgets/DiagramDesigner/styles/DiagramDesignerWidget",[],function(){}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget",["js/logger","js/Constants","raphaeljs","js/Loader/LoaderCircles","js/Widgets/DiagramDesigner/SelectionManager","js/Widgets/DiagramDesigner/DragManager.Native","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","js/Widgets/DiagramDesigner/DiagramDesignerWidget.OperatingModes","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DesignerItems","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Connections","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Subcomponents","js/Widgets/DiagramDesigner/ConnectionRouteManagerBasic","js/Widgets/DiagramDesigner/ConnectionRouteManager2","js/Widgets/DiagramDesigner/ConnectionRouteManager3","js/Widgets/DiagramDesigner/ConnectionDrawingManager","js/Widgets/DiagramDesigner/DiagramDesignerWidget.EventDispatcher","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Zoom","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Keyboard","js/Widgets/DiagramDesigner/HighlightManager","js/Widgets/DiagramDesigner/SearchManager","js/Widgets/DiagramDesigner/DiagramDesignerWidget.ContextMenu","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Droppable","./DiagramDesignerWidget.Draggable","./DiagramDesignerWidget.Clipboard","./DiagramDesignerWidget.Toolbar","./DiagramDesignerWidget.Mouse","./DiagramDesignerWidget.Tabs","js/Utils/ComponentSettings","css!./styles/DiagramDesignerWidget.css"],function(t,e,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m,_,b,y,v,C,E,D,I,P,T,A){"use strict";var x,w=100,N="diagram-designer",O=6,S="#DEDEDE",R=30,M=window.DEBUG,L=window._,k={loggerName:"gme:Widgets:DiagramDesigner:DiagramDesignerWidget",gridSize:10,droppable:!0,zoomUIControls:!0,defaultConnectionRouteManagerType:WebGMEGlobal.gmeConfig.client.defaultConnectionRouter};return x=function(e,n){var i=this,l=x.getDefaultConfig(),c={};this.CONSTANTS=s,A.resolveWithWebGMEGlobal(l,x.getComponentId()),L.extend(c,k,n),c.zoomValues=c.zoomValues||l.zoomValues,this.gmeConfig=WebGMEGlobal.gmeConfig,this.logger=t.create(c.loggerName,this.gmeConfig.client.log),this.$el=e,this._addEventDispatcherExtensions(),this.gridSize=c.gridSize,this._droppable=c.droppable,this._defaultSearchUI=!0,c.hasOwnProperty("defaultSearchUI")&&(this._defaultSearchUI=c.defaultSearchUI),this._lineStyleControls=!0,c.hasOwnProperty("lineStyleControls")&&(this._lineStyleControls=c.lineStyleControls),this._disableConnectionRendering=c.disableConnectionRendering,this._disableAutoRouterOption=c.disableAutoRouterOption,this._tabsEnabled=!1,this._addTabs=!1,this._deleteTabs=!1,this._reorderTabs=!1,c&&c.hasOwnProperty("tabsEnabled")&&(this._tabsEnabled=c.tabsEnabled&&!0),c&&c.hasOwnProperty("addTabs")&&(this._addTabs=c.addTabs&&!0),c&&c.hasOwnProperty("deleteTabs")&&(this._deleteTabs=c.deleteTabs&&!0),c&&c.hasOwnProperty("reorderTabs")&&(this._reorderTabs=c.reorderTabs&&!0),this._enableConnectionDrawing=!0,c&&c.hasOwnProperty("enableConnectionDrawing")&&(this._enableConnectionDrawing=c.enableConnectionDrawing&&!0),this._actualSize={w:0,h:0},this._containerSize={w:0,h:0},this._itemIDCounter=0,this._documentFragment=document.createDocumentFragment(),this._offset={left:0,top:0},this._scrollPos={left:0,top:0},this.mode=this.OPERATING_MODES.READ_ONLY,this._updating=!1,this._initializeCollections(),this._zoomRatio=1,this._connectToConnection=!0,this._connectionJumpXing=!1,this._initializeUI(),this._initZoom(c),this.selectionManager=c.selectionManager||new o({diagramDesigner:this}),this.selectionManager.initialize(this.skinParts.$itemsContainer),this.selectionManager.onSelectionCommandClicked=function(t,e,n){i._onSelectionCommandClicked(t,e,n)},this.selectionManager.onSelectionRotated=function(t,e){i.onSelectionRotated(t,e)},this.selectionManager.onSelectionChanged=function(t){i._onSelectionChanged(t)},this.dragManager=new r({diagramDesigner:this}),this.dragManager.initialize(this.skinParts.$itemsContainer),this._defaultConnectionRouteManagerType=c.defaultConnectionRouteManagerType,c.connectionRouteManager?this.connectionRouteManager=c.connectionRouteManager:"basic"===c.defaultConnectionRouteManagerType?this.connectionRouteManager=new h({diagramDesigner:this}):"basic2"===c.defaultConnectionRouteManagerType?this.connectionRouteManager=new p({diagramDesigner:this}):"basic3"===c.defaultConnectionRouteManagerType&&(this.connectionRouteManager=new g({diagramDesigner:this})),this.connectionRouteManager.initialize(),this.connectionDrawingManager=new u({diagramDesigner:this}),this.connectionDrawingManager.initialize(this.skinParts.$itemsContainer),this.connectionDrawingManager.onStartConnectionCreate=function(t){i._onStartConnectionCreate(t)},this.connectionDrawingManager.onStartConnectionReconnect=function(t){i._onStartConnectionReconnect(t)},this.connectionDrawingManager.onEndConnectionDraw=function(){i._onEndConnectionDraw()},this.connectionDrawingManager.onCreateNewConnection=function(t){i.onCreateNewConnection(t)},this.connectionDrawingManager.onModifyConnectionEnd=function(t){i._onModifyConnectionEnd(t)},this.highlightManager=new b({diagramDesigner:this}),this.highlightManager.initialize(this.skinParts.$itemsContainer),this.highlightManager.onHighlight=function(t){i.onHighlight(t)},this.highlightManager.onUnhighlight=function(t){i.onUnhighlight(t)},this.searchManager=new y({diagramDesigner:this}),this.searchManager.initialize(this.skinParts.$itemsContainer),this._afterManagersInitialized(),this.setOperatingMode(a.prototype.OPERATING_MODES.DESIGN),this._activateMouseListeners(),this.logger.debug("DiagramDesignerWidget ctor finished")},x.prototype._afterManagersInitialized=function(){},x.prototype._initializeCollections=function(){this.items={},this.itemIds=[],this.connectionIds=[],this.connectionEndIDs={},this.connectionIDbyEndID={},this._updating=!1,this._insertedDesignerItemIDs=[],this._updatedDesignerItemIDs=[],this._deletedDesignerItemIDs=[],this._insertedConnectionIDs=[],this._updatedConnectionIDs=[],this._deletedConnectionIDs=[],this._itemSubcomponentsMap={},this._itemIDCounter=0},x.prototype._getGuid=function(t){var e,n=this._itemIDCounter++ +"";for(e=O-n.length;e--;)n="0"+n;return t&&(n=t+n),n},x.prototype.setReadOnly=function(t){this._setReadOnlyMode(t),this.toolbarItems&&(this.toolbarItems.radioButtonGroupOperatingMode&&this.toolbarItems.radioButtonGroupOperatingMode.enabled(!t),this.toolbarItems.btnGridLayout&&this.toolbarItems.btnGridLayout.enabled(!t),this.toolbarItems.btnCozyGridLayout&&this.toolbarItems.btnCozyGridLayout.enabled(!t))},x.prototype.getIsReadOnlyMode=function(){return this.mode!==this.OPERATING_MODES.DESIGN},x.prototype._setReadOnlyMode=function(t){t===!0&&this.mode!==this.OPERATING_MODES.READ_ONLY?this.setOperatingMode(this.OPERATING_MODES.READ_ONLY):t===!1&&this.mode===this.OPERATING_MODES.READ_ONLY&&this.setOperatingMode(this.OPERATING_MODES.DESIGN)},x.prototype.onWidgetContainerResize=function(t,e){this._containerSize.w=t,this._containerSize.h=e,this._resizeItemContainer(),this._refreshTabTabsScrollOnResize()},x.prototype.destroy=function(){this.__loader.destroy(),this._removeToolbarItems(),this.connectionRouteManager.destroy()},x.prototype._initializeUI=function(){this.logger.debug("DiagramDesignerWidget._initializeUI"),this.$el.empty(),this.$el.addClass(N),this._attachScrollHandler(this.$el),this.skinParts={},this.skinParts.$diagramDesignerWidgetBody=this.$el,this.skinParts.$itemsContainer=$("<div/>",{"class":"items"}),this.skinParts.$diagramDesignerWidgetBody.append(this.skinParts.$itemsContainer),this.skinParts.SVGPaper=Raphael(this.skinParts.$itemsContainer[0]),this.skinParts.SVGPaper.canvas.style.pointerEvents="visiblePainted",this.skinParts.SVGPaper.canvas.className.baseVal=s.CONNECTION_CONTAINER_SVG_CLASS,this._containerSize.w=this.$el.width(),this._containerSize.h=this.$el.height(),this._resizeItemContainer(),this._droppable===!0&&this._initDroppable(),this.__loader=new i({containerElement:this.$el.parent()}),this._tabsEnabled===!0&&this._initializeTabs()},x.prototype._createLineStyleMenuItem=function(t,e,n,i,o,r,a){var l,c,d,h=$("<div/>"),p=50,g=20,u=Raphael(h[0],p,g),f=10;return t=t||1,e=e||"#000000",n=n||s.LINE_PATTERNS.SOLID,i=i||s.LINE_ARROWS.NONE,o=o||s.LINE_ARROWS.NONE,r=(r||s.LINE_TYPES.NONE).toLowerCase(),h.attr({style:"height: "+g+"px; width: "+p+"px;"}),l=r===s.LINE_TYPES.BEZIER?u.path("M 5,"+(Math.round(g/2)+.5)+" C"+(5+f)+","+(Math.round(g/2)+.5-2*f)+" "+(p-f)+","+(Math.round(g/2)+.5+2*f)+" "+(p-5)+","+(Math.round(g/2)+.5)):u.path("M 5,"+(Math.round(g/2)+.5)+" L"+(p-5)+","+(Math.round(g/2)+.5)),a&&(c=l.getBBox(),d=a===s.LINE_LABEL_PLACEMENTS.SRC?c.x+2:a===s.LINE_LABEL_PLACEMENTS.DST?c.x+c.width-2:c.x+c.width/2,u.text(d,c.y-1.5,"$").attr({"font-size":8,fill:e})),l.attr({"arrow-start":i,"arrow-end":o,stroke:e,"stroke-width":t,"stroke-dasharray":n}),h},x.prototype._attachScrollHandler=function(t){var e=this;t.on("scroll",function(){e._scrollPos.left=t.scrollLeft(),e._scrollPos.top=t.scrollTop()})},x.prototype._resizeItemContainer=function(){var t,e,n,i=this._containerSize.w/this._zoomRatio,o=this._containerSize.h/this._zoomRatio;this.logger.debug("MinZoomedSize: "+i+", "+o),this.logger.debug("this._actualSize: "+this._actualSize.w+", "+this._actualSize.h),i=Math.max(i,this._actualSize.w),o=Math.max(o,this._actualSize.h),this.skinParts.$itemsContainer.css({width:i,height:o}),this.skinParts.SVGPaper.setSize(i,o),this.skinParts.SVGPaper.setViewBox(0,0,i,o,!1),this._svgPaperSize={w:i,h:o},this._centerBackgroundText(),n=this.skinParts.$diagramDesignerWidgetBody.offset(),e=parseInt(this.skinParts.$diagramDesignerWidgetBody.css("padding-top").replace("px","")),t=parseInt(this.skinParts.$diagramDesignerWidgetBody.css("padding-left").replace("px","")),n.left+=t,n.top+=e,this._offset=n},x.prototype.getAdjustedMousePos=function(t){
var e,n=this._offset,i=this._scrollPos,o=t.pageX-n.left+i.left,r=t.pageY-n.top+i.top;return o/=this._zoomRatio,r/=this._zoomRatio,e={mX:o>0?o:0,mY:r>0?r:0}},x.prototype.getAdjustedOffset=function(t){var e=this._offset,n=(t.left-e.left)/this._zoomRatio+e.left,i=(t.top-e.top)/this._zoomRatio+e.top;return{left:n,top:i}},x.prototype.posToPageXY=function(t,e){var n=this._offset,i=this._scrollPos,o=t*this._zoomRatio,r=e*this._zoomRatio;return o+=n.left-i.left,r+=n.top-i.top,{x:o>0?o:0,y:r>0?r:0}},x.prototype.clear=function(){var t;this.setTitle(""),this.selectionManager.setSelection([]);for(t in this.items)this.items.hasOwnProperty(t)&&this.items[t].destroy();this._initializeCollections(),this._actualSize={w:0,h:0},this._resizeItemContainer(),this.dispatchEvent(this.events.ON_CLEAR)},x.prototype.deleteComponent=function(t){this.dispatchEvent(this.events.ON_COMPONENT_DELETE,t),-1!==this.itemIds.indexOf(t)?this.deleteDesignerItem(t):-1!==this.connectionIds.indexOf(t)&&this.deleteConnection(t)},x.prototype.beginUpdate=function(){this.logger.debug("beginUpdate"),this._updating=!0,this._insertedDesignerItemIDs=[],this._updatedDesignerItemIDs=[],this._deletedDesignerItemIDs=[],this._insertedConnectionIDs=[],this._updatedConnectionIDs=[],this._deletedConnectionIDs=[]},x.prototype.endUpdate=function(){this.logger.debug("endUpdate"),this._updating=!1,this._tryRefreshScreen(),this.searchManager.applyLastSearch()},x.prototype._tryRefreshScreen=function(){var t=0,e=0,n=0,i="";this._updating!==!0&&(t+=this._insertedDesignerItemIDs?this._insertedDesignerItemIDs.length:0,t+=this._insertedConnectionIDs?this._insertedConnectionIDs.length:0,e+=this._updatedDesignerItemIDs?this._updatedDesignerItemIDs.length:0,e+=this._updatedConnectionIDs?this._updatedConnectionIDs.length:0,n+=this._deletedDesignerItemIDs?this._deletedDesignerItemIDs.length:0,n+=this._deletedConnectionIDs?this._deletedConnectionIDs.length:0,i+="I: "+t,i+=" U: "+e,i+=" D: "+n,this.logger.debug(i),M===!0&&this.toolbarItems&&this.toolbarItems.progressText&&this.toolbarItems.progressText.text(i,!0),this._refreshScreen())},x.prototype._refreshScreen=function(){var t,e,n,i,o,r,s,a=0,l=0,c=this.items,d=[],h=this;for(this.logger.debug("_refreshScreen START"),this.skinParts.$itemsContainer[0].appendChild(this._documentFragment),this._documentFragment=document.createDocumentFragment(),o=function(t){for(var e,n,i=t.length;i--;)n=c[t[i]],n.renderGetLayoutInfo(),e=n.getBoundingBox(),a=Math.max(a,e.x2),l=Math.max(l,e.y2)},o(this._insertedDesignerItemIDs),o(this._updatedDesignerItemIDs),r=function(t){for(var e,n=t.length;n--;)e=c[t[n]],e.renderSetLayoutInfo()},r(this._insertedDesignerItemIDs),r(this._updatedDesignerItemIDs),s=function(t,e){for(var n=t.length;n--;)h.dispatchEvent(e,t[n])},s(this._insertedDesignerItemIDs,this.events.ON_COMPONENT_CREATE),s(this._insertedConnectionIDs,this.events.ON_COMPONENT_CREATE),s(this._updatedDesignerItemIDs,this.events.ON_COMPONENT_UPDATE),s(this._updatedConnectionIDs,this.events.ON_COMPONENT_UPDATE),d=this._insertedDesignerItemIDs.concat(this._updatedDesignerItemIDs,this._deletedDesignerItemIDs),e=this._insertedConnectionIDs.concat(this._updatedConnectionIDs,this._getAssociatedConnectionsForItems(d)),e=L.uniq(e).sort(),this.logger.debug("Redraw connection request: "+e.length+"/"+this.connectionIds.length),i=this._redrawConnections(e),this.logger.debug("Redrawn/Requested: "+i.length+"/"+e.length),t=i.length;t--;)n=c[i[t]].getBoundingBox(),a=Math.max(a,n.x2),l=Math.max(l,n.y2);this._actualSize.w=Math.max(this._actualSize.w,a+w),this._actualSize.h=Math.max(this._actualSize.h,l+w),this._resizeItemContainer(),this._insertedDesignerItemIDs=[],this._updatedDesignerItemIDs=[],this._deletedDesignerItemIDs=[],this._insertedConnectionIDs=[],this._updatedConnectionIDs=[],this._deletedConnectionIDs=[],(this.mode===this.OPERATING_MODES.DESIGN||this.mode===this.OPERATING_MODES.READ_ONLY)&&this.selectionManager.showSelectionOutline(),this.logger.debug("_refreshScreen END")},x.prototype._alignPositionToGrid=function(t,e){var n,i;return t<this.gridSize&&(t=this.gridSize),e<this.gridSize&&(e=this.gridSize),this.gridSize>1&&(n=t%this.gridSize,i=e%this.gridSize,(0!==n||0!==i)&&(t+=n<Math.floor(this.gridSize/2)+1?-1*n:this.gridSize-n,e+=i<Math.floor(this.gridSize/2)+1?-1*i:this.gridSize-i)),{x:t,y:e}},x.prototype._checkPositionOverlap=function(t,e){for(var n,i,o,r=!0;r===!0;)for(r=!1,n=this.itemIds.length;n--;)i=this.itemIds[n],i!==t&&(o=this.items[i],e.position.x===o.positionX&&e.position.y===o.positionY&&(e.position.x+=2*this.gridSize,e.position.y+=2*this.gridSize,r=!0))},x.prototype.onDesignerItemDragStart=function(t,e){this.selectionManager.hideSelectionOutline(),this._preDragActualSize={w:this._actualSize.w,h:this._actualSize.h};for(var n=e.length;n--;)this.items[e[n]].hideSourceConnectors()},x.prototype.onDesignerItemDrag=function(t,e){for(var n,i,o,r=e.length,s=0,a=0,l=this.items;r--;)o=l[e[r]].getBoundingBox(),s=Math.max(s,o.x2),a=Math.max(a,o.y2);this._actualSize.w=Math.max(this._preDragActualSize.w,s),this._actualSize.h=Math.max(this._preDragActualSize.h,a),this._resizeItemContainer(),n=this._getAssociatedConnectionsForItems(e).sort(),this.logger.debug("Redraw connection request: "+n.length+"/"+this.connectionIds.length),i=this._redrawConnections(n)||[],this.logger.debug("Redrawn/Requested: "+i.length+"/"+n.length),r=i.len},x.prototype.onDesignerItemDragStop=function(){this.selectionManager.showSelectionOutline(),delete this._preDragActualSize},x.prototype._onSelectionCommandClicked=function(t,e,n){switch(t){case"delete":this.onSelectionDelete(e);break;case"contextmenu":this.onSelectionContextMenu(e,this.getAdjustedMousePos(n));break;case"align":this.onSelectionAlignMenu(e,this.getAdjustedMousePos(n));break;case"open":this.onDesignerItemDoubleClick(e[0])}},x.prototype.onSelectionDelete=function(t){this.logger.warn('DiagramDesignerWidget.onSelectionDelete IS NOT OVERRIDDEN IN A CONTROLLER. ID: "'+t+'"')},x.prototype.onSelectionContextMenu=function(t,e){this.logger.warn('DiagramDesignerWidget.onSelectionContextMenu IS NOT OVERRIDDEN IN A CONTROLLER. ID: "'+t+'", mousePos: '+JSON.stringify(e))},x.prototype.onSelectionAlignMenu=function(t,e){this.logger.warn('DiagramDesignerWidget.onSelectionAlignMenu IS NOT OVERRIDDEN IN A CONTROLLER. ID: "'+t+'", mousePos: '+JSON.stringify(e))},x.prototype.onAlignSelection=function(t,e){this.logger.warn('DiagramDesignerWidget.onAlignSelection IS NOT OVERRIDDEN IN A CONTROLLER. ID: "'+t+'", type: "'+e+'".')},x.prototype._onSelectionChanged=function(t){for(var e=t.length,n=!1;e--;)if(-1!==this.connectionIds.indexOf(t[e])){n=!0;break}this.toolbarItems&&this.getIsReadOnlyMode()===!1&&(t.length>0?(this.toolbarItems.cpFillColor&&this.toolbarItems.cpFillColor.enabled(!0),this.toolbarItems.cpBorderColor&&this.toolbarItems.cpBorderColor.enabled(!n),this.toolbarItems.cpTextColor&&this.toolbarItems.cpTextColor.enabled(!0)):(this.toolbarItems.cpFillColor&&this.toolbarItems.cpFillColor.enabled(!1),this.toolbarItems.cpBorderColor&&this.toolbarItems.cpBorderColor.enabled(!1),this.toolbarItems.cpTextColor&&this.toolbarItems.cpTextColor.enabled(!1))),this.onSelectionChanged(t)},x.prototype.onSelectionChanged=function(){this.logger.debug("DiagramDesignerWidget.onSelectionChanged IS NOT OVERRIDDEN IN A CONTROLLER...")},x.prototype.itemAutoLayout=function(t){var e,n=this.itemIds.length,i=40,o=80,r=20,s=20,a=0,l={};switch(this.beginUpdate(),t){case"diagonal":for(;n--;)e=this.items[this.itemIds[n]].getWidth(),a=Math.max(a,this.items[this.itemIds[n]].getHeight()),this.updateDesignerItem(this.itemIds[n],{position:{x:i,y:o}}),l[this.itemIds[n]]={x:this.items[this.itemIds[n]].positionX,y:this.items[this.itemIds[n]].positionY},i+=e+r,o+=a+s;break;default:for(r=20,s=20,"cozygrid"===t&&(r=100,s=100);n--;)e=this.items[this.itemIds[n]].getWidth(),a=Math.max(a,this.items[this.itemIds[n]].getHeight()),this.updateDesignerItem(this.itemIds[n],{position:{x:i,y:o}}),l[this.itemIds[n]]={x:this.items[this.itemIds[n]].positionX,y:this.items[this.itemIds[n]].positionY},i+=e+r,i>=1e3&&(i=40,o+=a+s,a=0)}this.endUpdate(),this.onDesignerItemsMove(l)},x.prototype._onConnectionRouteManagerChanged=function(t){switch(this.connectionRouteManager&&this.connectionRouteManager.destroy(),t){case"basic":this.connectionRouteManager=new h({diagramDesigner:this});break;case"basic2":this.connectionRouteManager=new p({diagramDesigner:this});break;case"basic3":this.connectionRouteManager=new g({diagramDesigner:this});break;default:this.connectionRouteManager=new h({diagramDesigner:this})}this.connectionRouteManager.initialize(),this._redrawConnections(this.connectionIds.slice(0).sort()||[]),this.selectionManager.showSelectionOutline()},x.prototype._getAssociatedConnectionsForItems=function(t){for(var e=[],n=t.length;n--;)e=e.concat(this._getConnectionsForItem(t[n]));return e=L.uniq(e)},x.prototype._getConnectionsForItem=function(t){var e,n=[];for(e in this.connectionIDbyEndID[t])this.connectionIDbyEndID[t].hasOwnProperty(e)&&(n=n.concat(this.connectionIDbyEndID[t][e]));return n=L.uniq(n)},x.prototype._getItemsForConnection=function(t){var e=[];return this.connectionEndIDs[t]&&(e.push(this.connectionEndIDs[t].srcObjId),e.push(this.connectionEndIDs[t].dstObjId)),e},x.prototype.showProgressbar=function(){this.__loader.start()},x.prototype.hideProgressbar=function(){this.__loader.stop()},x.prototype.setBackgroundText=function(t,e){var n,i={};this._backGroundText?(i.text=t,i.x=this._svgPaperSize.w/2,i.y=this._svgPaperSize.h/2):t?this._backGroundText=this.skinParts.SVGPaper.text(this._svgPaperSize.w/2,this._svgPaperSize.h/2,t):this.logger.error('Invalid parameter "text" for method "setBackgroundText"'),this._backGroundText&&(n=function(t){for(var n=t.length;n--;)e.hasOwnProperty(t[n][0])&&(i[t[n][1]]=e[t[n][0]])},e=e||{},e["font-size"]=e["font-size"]||R,e.color=e.color||S,e&&n([["color","fill"],["font-size","font-size"]]),this._backGroundText.attr(i))},x.prototype._centerBackgroundText=function(){this._backGroundText&&this._backGroundText.attr({x:this._svgPaperSize.w/2,y:this._svgPaperSize.h/2})},x.prototype.setTitle=function(){},x.prototype.enableDragCopy=function(){},x.prototype.enableRotate=function(t){this.selectionManager.enableRotation(t)},x.prototype.enableAlign=function(t){this.selectionManager.enableAlign(t)},x.prototype.enableOpenButton=function(t){this.selectionManager.enableOpenButton(t)},x.prototype.selectAll=function(){this.selectionManager.setSelection(this.itemIds.concat(this.connectionIds),!1)},x.prototype.selectNone=function(){this.selectionManager.clear()},x.prototype.selectInvert=function(){var t=L.difference(this.itemIds.concat(this.connectionIds),this.selectionManager.getSelectedElements());this.selectionManager.setSelection(t,!1)},x.prototype.selectItems=function(){this.selectionManager.setSelection(this.itemIds,!1)},x.prototype.selectConnections=function(){this.selectionManager.setSelection(this.connectionIds,!1)},x.prototype.select=function(t){this.selectionManager.setSelection(t,!1)},x.prototype.onClipboardCopy=function(t){this.logger.warn('DiagramDesignerWidget.prototype.onClipboardCopy not overridden in controller!!!selectedIds: "'+t+'"')},x.prototype.onClipboardPaste=function(){this.logger.warn("DiagramDesignerWidget.prototype.onClipboardPaste not overridden in controller!!!")},x.prototype.onConnectionSegmentPointsChange=function(t){this.logger.warn("DiagramDesignerWidget.prototype.onConnectionSegmentPointsChange not overridden in controller. params: "+JSON.stringify(t))},x.prototype.setOperatingMode=function(t){if(this.mode!==t)switch(this.highlightManager.deactivate(),this.selectionManager.deactivate(),this.connectionDrawingManager.deactivate(),this.searchManager.deactivate(),this._setComponentsReadOnly(!0),this._addTabsButtonEnabled(!1),this._destroyTabsSortable(),t){case a.prototype.OPERATING_MODES.READ_ONLY:this.mode=this.OPERATING_MODES.READ_ONLY,this.selectionManager.activate(),this.searchManager.activate();break;case a.prototype.OPERATING_MODES.DESIGN:this.mode=this.OPERATING_MODES.DESIGN,this.selectionManager.activate(),this.connectionDrawingManager.activate(),this.searchManager.activate(),this._setComponentsReadOnly(!1),this._addTabsButtonEnabled(!0),this._makeTabsSortable();break;case a.prototype.OPERATING_MODES.HIGHLIGHT:this.mode=this.OPERATING_MODES.HIGHLIGHT,this.highlightManager.activate();break;default:this.mode=this.OPERATING_MODES.READ_ONLY,this.selectionManager.activate(),this.searchManager.activate()}},x.prototype._setComponentsReadOnly=function(t){for(var e=this.itemIds.length;e--;)this.items[this.itemIds[e]].readOnlyMode(t);for(e=this.itemIds.length;e--;)this.items[this.itemIds[e]].renderGetLayoutInfo();for(e=this.itemIds.length;e--;)this.items[this.itemIds[e]].renderSetLayoutInfo();for(this._redrawConnections(this.connectionIds.slice(0).sort()||[]),e=this.connectionIds.length;e--;)this.items[this.connectionIds[e]].readOnlyMode(t)},x.prototype.onDragStartDesignerItemDraggable=function(t){return this.logger.warn("DiagramDesignerWidget.prototype.onDesignerItemDraggable not overridden in controller. itemID: "+t),!0},x.prototype.onDragStartDesignerItemCopyable=function(t){return this.logger.warn("DiagramDesignerWidget.prototype.onDragStartDesignerItemCopyable not overridden in controller. itemID: "+t),!0},x.prototype.onDragStartDesignerConnectionCopyable=function(t){return this.logger.warn("DiagramDesignerWidget.prototype.onDragStartDesignerConnectionCopyable not overridden in controller. connectionID: "+t),!0},x.prototype.onHighlight=function(t){this.logger.warn("DiagramDesignerWidget.prototype.onHighlight not overridden in controller. idList: "+t)},x.prototype.onUnhighlight=function(t){this.logger.warn("DiagramDesignerWidget.prototype.onUnhighlight not overridden in controller. idList: "+t)},x.prototype.onSelectionRotated=function(t,e){this.logger.warn('DiagramDesignerWidget.prototype.onSelectionRotated IS NOT OVERRIDDEN IN CONTROLLER. deg: "'+t+'", selectedIds: '+e)},x.prototype.onConnectionNameChanged=function(t,e,n){this.logger.warn('DiagramDesignerWidget.prototype.onConnectionNameChanged IS NOT OVERRIDDEN IN CONTROLLER. connId: "'+t+'", oldValue: "'+e+'", newValue: "'+n+'"')},x.prototype.onConnectionSrcTextChanged=function(t,e,n){this.logger.warn('DiagramDesignerWidget.prototype.onConnectionSrcTextChanged IS NOT OVERRIDDEN IN CONTROLLER.connId: "'+t+'", oldValue: "'+e+'", newValue: "'+n+'"')},x.prototype.onConnectionDstTextChanged=function(t,e,n){this.logger.warn('DiagramDesignerWidget.prototype.onConnectionDstTextChanged IS NOT OVERRIDDEN IN CONTROLLER. connId: "'+t+'", oldValue: "'+e+'", newValue: "'+n+'"')},x.prototype.connectToConnectionEnabled=function(t){this._connectToConnection=t},x.prototype._setConnectionXingJumpMode=function(t){this._connectionJumpXing!==t&&(this._connectionJumpXing=t,this._redrawConnections(this.connectionIds.slice(0).sort()||[]))},x.prototype._setConnectionProperty=function(t){var e=this.selectionManager.getSelectedElements();e.length>0&&this.onSetConnectionProperty({items:e,params:t})},x.prototype.onSetConnectionProperty=function(t){this.logger.warn("DiagramDesignerWidget.prototype.onSetConnectionProperty IS NOT OVERRIDDEN IN CONTROLLER.params: "+JSON.stringify(t))},x.prototype._triggerUIActivity=function(){this.onUIActivity()},x.prototype.onUIActivity=function(){this.logger.warn("DiagramDesignerWidget.prototype.onUIActivity IS NOT OVERRIDDEN...")},x.prototype._redrawConnections=function(t){var e;try{e=this.connectionRouteManager.redrawConnections(t)||[]}catch(n){e=[],this.logger.error("connectionRouteManager.redrawConnections failed with error: "+n.stack)}return e},x.prototype.onActivate=function(){this._displayToolbarItems()},x.prototype.onDeactivate=function(){this._hideToolbarItems()},x.prototype.onSelectionFillColorChanged=function(t,e){this.logger.warn("DiagramDesignerWidget.prototype.onSelectionFillColorChanged(selectedElements, color) IS NOT OVERRIDDEN IN CONTROLLER. color: "+e)},x.prototype.onSelectionBorderColorChanged=function(t,e){this.logger.warn("DiagramDesignerWidget.prototype.onSelectionBorderColorChanged(selectedElements, color) IS NOT OVERRIDDEN IN CONTROLLER. color: "+e)},x.prototype.onSelectionTextColorChanged=function(t,e){this.logger.warn("DiagramDesignerWidget.prototype.onSelectionTextColorChanged(selectedElements, color) IS NOT OVERRIDDEN IN CONTROLLER. color: "+e)},L.extend(x.prototype,a.prototype),L.extend(x.prototype,l.prototype),L.extend(x.prototype,c.prototype),L.extend(x.prototype,d.prototype),L.extend(x.prototype,f.prototype),L.extend(x.prototype,m.prototype),L.extend(x.prototype,_.prototype),L.extend(x.prototype,v.prototype),L.extend(x.prototype,C.prototype),L.extend(x.prototype,D.prototype),L.extend(x.prototype,E.prototype),L.extend(x.prototype,I.prototype),L.extend(x.prototype,P.prototype),L.extend(x.prototype,T.prototype),x.getDefaultConfig=function(){return{zoomValues:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.2,1.4,1.6,1.8,2,2.5,3,3.5,4]}},x.getComponentId=function(){return"GenericUIDiagramDesignerWidget"},x}),define("text!js/Widgets/MetaEditor/templates/MetaEditorPointerNamesDialog.html",[],function(){return'<div class="meta-editor-pointer-names-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Create new pointer</h3>\n            </div>\n            <form class="modal-body" role="form">\n                <div class="row">\n                    <label class="col-sm-4 control-label pick-existing-label">\n                        Pick one of the existing pointers:\n                    </label>\n\n                    <div class="col-sm-4 controls btn-group-existing btn-group btn-group-vertical">\n                    </div>\n                </div>\n                <div class="panel-popular row">\n                    <label class="col-sm-4 control-label">\n                        Or pick a popular one:\n                    </label>\n\n                    <div class="col-sm-4 controls btn-group-popular btn-group btn-group-vertical">\n                    </div>\n                </div>\n            </form>\n            <div class="modal-footer">\n                <div class="panel-create-new form-group">\n                    <label class="col-sm-4 control-label create-new-label">\n                        Or create a new pointer:\n                    </label>\n\n                    <div class="col-sm-8 input-group">\n                        <input type="text" class="txt-pointer-name form-control" placeholder="New pointer name..."/>\n\n                        <div class="input-group-btn">\n                            <button href="#" class="btn btn-primary btn-create">Create</button>\n                        </div>\n                    </div>\n                </div>\n                <div class="alert alert-danger message-badge" role="alert"></div>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Widgets/MetaEditor/styles/MetaEditorPointerNamesDialog",[],function(){}),define("js/Widgets/MetaEditor/MetaEditorPointerNamesDialog",["js/util","js/Constants","common/regexp","text!./templates/MetaEditorPointerNamesDialog.html","css!./styles/MetaEditorPointerNamesDialog.css"],function(t,e,n,i){"use strict";var o,r=[e.POINTER_SOURCE,e.POINTER_TARGET,e.POINTER_CONSTRAINED_BY];return o=function(){},o.prototype.show=function(t,e,n,i){var o=this;this._initDialog(t,e,n,i),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){0===t.length&&o._txtNewPointerName.focus()}),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0})},o.prototype._initDialog=function(o,s,a,l){function c(t,e){var n=t.length-e.length;return n>=0&&t.lastIndexOf(e)===n}function d(t){var i={hasViolation:!1,message:""};return""===t?(i.hasViolation=!0,i.message=(a?"Set":"Pointer")+" must have a non-empty name."):s.indexOf(t)>-1?(i.hasViolation=!0,i.message='Name "'+t+'" is already used for a '+(a?"pointer":"set")+" or an aspect."):n.DOCUMENT_KEY.test(t)===!1?(i.hasViolation=!0,i.message='Name "'+t+'" contains illegal characters, it may not contain "." or start with "$" or "_".'):(c(t,e.CORE.COLLECTION_NAME_SUFFIX)?(i.hasViolation=!0,i.message='Name "'+t+'" ends with "'+e.CORE.COLLECTION_NAME_SUFFIX+'", which could lead to collisions with data stored for inverse pointers.'):t===e.CORE.BASE_POINTER?(i.hasViolation=!0,i.message='Name "'+e.CORE.BASE_POINTER+'" is reserved for base/instance relationship.'):t===e.CORE.MEMBER_RELATION?(i.hasViolation=!0,i.message='Name "'+e.CORE.MEMBER_RELATION+'" is reserved for set membership.'):t===e.CORE.OVERLAYS_PROPERTY&&(i.hasViolation=!0,i.message='Name "'+t+'" is a reserved key word.'),(a&&"src"===t||"dst"===t)&&(i.hasViolation=!0,i.message='Name "'+t+'" can only be used for pointer names and not for sets.')),i}var h,p,g,u=this,f=o.length;if(p=function(t){u._dialog.modal("hide"),l&&l.call(u,t)},this._dialog=$(i),a===!0&&(this._dialog.find(".modal-header > h3").text("Create new set"),this._dialog.find(".pick-existing-label").text("Pick one of the existing sets:"),this._dialog.find(".create-new-label").text("Or create a new set:"),this._dialog.find(".txt-pointer-name").attr("placeholder","New set name...")),this._el=this._dialog.find(".modal-body").first(),this._btnGroup=this._el.find(".btn-group-existing").first(),this._btnGroupPopular=this._dialog.find(".btn-group-popular").first(),this._alertDiv=this._dialog.find(".message-badge").first(),this._hideAlert(),o.sort(),f)for(this._btnGroup.empty(),h=0;f>h;h+=1)o[h]!==e.CORE.BASE_POINTER&&this._btnGroup.append($('<button class="btn btn-default">'+t.toSafeString(o[h])+"</button>"));else a===!0?this._btnGroup.html('<span class="empty-message">No existing sets defined yet...</i>'):this._btnGroup.html('<span class="empty-message">No existing pointers defined yet...</i>');if(g=!1,a!==!0)for(f=r.length,h=0;f>h;h+=1)-1===o.indexOf(r[h])&&(this._btnGroupPopular.append($('<button class="btn btn-default">'+r[h]+"</button>")),g=!0);g||this._dialog.find(".panel-popular").remove(),this._txtNewPointerName=this._dialog.find(".txt-pointer-name"),this._btnCreateNew=this._dialog.find(".btn-create").disable(!0),this._panelCreateNew=this._dialog.find(".panel-create-new"),this._btnGroup.on("click",".btn",function(t){var e=$(this).text();t.stopPropagation(),t.preventDefault(),p(e)}),this._btnGroupPopular.on("click",".btn",function(t){var e=$(this).text();t.stopPropagation(),t.preventDefault(),p(e)}),this._txtNewPointerName.on("keyup",function(){var t=u._txtNewPointerName.val(),e=d(t);e.hasViolation?(u._panelCreateNew.addClass("has-error"),u._showAlert(e.message),u._btnCreateNew.disable(!0)):(u._panelCreateNew.removeClass("has-error"),u._btnCreateNew.disable(!1),u._hideAlert())}),this._txtNewPointerName.on("keydown",function(t){var e=13===t.which,n=u._txtNewPointerName.val();e&&d(n).hasViolation===!1&&(p(n),t.stopPropagation(),t.preventDefault())}),this._btnCreateNew.on("click",function(t){var e=u._txtNewPointerName.val();t.stopPropagation(),t.preventDefault(),$(this).hasClass("disabled")||p(e)})},o.prototype._showAlert=function(t){this._alertDiv.text(t),this._alertDiv.show()},o.prototype._hideAlert=function(){this._alertDiv.hide()},o}),define("css!js/Widgets/MetaEditor/styles/MetaEditorWidget",[],function(){}),define("js/Widgets/MetaEditor/MetaEditorWidget",["js/logger","js/util","js/DragDrop/DragHelper","js/Widgets/DiagramDesigner/DiagramDesignerWidget","js/Controls/iCheckBox","./MetaEditorPointerNamesDialog","css!./styles/MetaEditorWidget.css"],function(t,e,n,i,o,r){"use strict";function s(t,e){e=e||{},e.loggerName="gme:Widgets:MetaEditor:MetaEditorWidget",e.lineStyleControls=!1,e.tabsEnabled=!0,e.addTabs=!0,e.deleteTabs=!0,e.reorderTabs=!0,i.call(this,t,e),this.$el.parent().addClass("meta-editor-widget"),this.logger.debug("MetaEditorWidget ctor")}return _.extend(s.prototype,i.prototype),s.prototype._initializeUI=function(){i.prototype._initializeUI.apply(this,arguments),this.logger.debug("MetaEditorWidget._initializeUI"),this._connectToConnection=!1,this._initializeFilterPanel(),this._initializeMetaConsistencyResult()},s.prototype._afterManagersInitialized=function(){this.enableRotate(!1)},s.prototype._initializeFilterPanel=function(){this.$filterPanel=$("<div/>",{"class":"filterPanel"}),this.$filterPanel.html('<div class="header">FILTER</div><ul class="body"></ul>'),this.$filterHeader=this.$filterPanel.find(".header"),this.$filterUl=this.$filterPanel.find("ul.body"),this.$el.parent().append(this.$filterPanel),this._filterCheckboxes={}},s.prototype._initializeMetaConsistencyResult=function(){this.$metaConsistencyResults=$("<div/>",{"class":"meta-consistency-results"}),this.$el.parent().append(this.$metaConsistencyResults)},s.prototype._checkChanged=function(t,e){this._refreshHeaderText(),this.logger.debug("CheckBox checkChanged: "+t+", checked: "+e),this.onCheckChanged(t,e)},s.prototype.onCheckChanged=function(){this.logger.warn("MetaEditorWidget.onCheckChanged(value, isChecked) is not overridden!")},s.prototype.showMetaConsistencyResults=function(t){var e,n,i,o,r=this,s=!1;for(t.sort(function(t,e){return t.message>e.message?1:t.message<e.message?-1:0}),this.$metaConsistencyResults.find("dd.path-link").off("click"),this.$metaConsistencyResults.find("i.close-result").off("click"),this.$metaConsistencyResults.empty(),i=0;i<t.length;i+=1){if(s=!0,this.$metaConsistencyResults.append($("<div>",{"class":"meta-inconsistency-divider"})),e=$("<div>",{"class":"meta-inconsistency"}),n=$("<dl>",{"class":"dl-horizontal"}),n.append($("<dt>",{text:"Inconsistency"})),n.append($("<dd>",{text:t[i].message})),n.append($("<dt>",{text:"Description"})),n.append($("<dd>",{text:t[i].description})),n.append($("<dt>",{text:"Hint"})),n.append($("<dd>",{text:t[i].hint})),n.append($("<dt>",{text:"Node path"})),n.append($("<dd>",{text:t[i].path,"class":"path-link"}).data("gme-id",t[i].path)),t[i].relatedPaths.length>0)for(n.append($("<dt>",{text:"Related paths"})),o=0;o<t[i].relatedPaths.length;o+=1)n.append($("<dd>",{text:t[i].relatedPaths[o],"class":"path-link"}).data("gme-id",t[i].relatedPaths[o]));e.append(n),this.$metaConsistencyResults.append(e)}s===!0?(this.$metaConsistencyResults.find("dd.path-link").on("click",function(){var t=$(this).data("gme-id");r.onInconsistencyLinkClicked(t)}),this.$metaConsistencyResults.prepend($("<h3>",{text:"Meta-model Inconsistencies","class":"meta-inconsistency-header"}).append($("<i/>",{"class":"fa fa-check-circle-o close-result pull-left",title:"Close result view"}).on("click",function(){r.showMetaConsistencyResults([])}))),this.$metaConsistencyResults.append($("<div>",{"class":"meta-inconsistency-divider"})),this.$el.parent().addClass("show-meta-consistency-results")):this.$el.parent().removeClass("show-meta-consistency-results")},s.prototype.onInconsistencyLinkClicked=function(t){this.logger.warn("MetaEditorWidget.onInconsistencyLinkClicked not overwritten in controller, gmeId:",t)},s.prototype.addFilterItem=function(t,e,n){var i,r=$("<li/>",{"class":"filterItem"}),s=this;return i=new o({checkChangedFn:function(t,n){s._checkChanged(e,n)}}),r.append(n.addClass("inline")),r.append(t),r.append(i.el),this.$filterUl.append(r),this._refreshHeaderText(),this._filterCheckboxes[e]=i,r},s.prototype._refreshHeaderText=function(){var t=this.$filterUl.find(".iCheckBox").length,e=this.$filterUl.find(".iCheckBox.checked").length;this.$filterHeader.html("FILTER"+(t===e?"":" *"))},s.prototype.selectNewPointerName=function(t,e,n,i){(new r).show(t,e,n,i)},s.prototype.setFilterChecked=function(t){this._filterCheckboxes[t]&&!this._filterCheckboxes[t].isChecked()&&this._filterCheckboxes[t].setChecked(!0)},s.prototype.getDragEffects=function(){return[n.DRAG_EFFECTS.DRAG_MOVE]},s.prototype._dragHelper=function(t,e,n){var o=i.prototype._dragHelper.apply(this,[t,e,n]);return o.empty(),o},s}),define("js/Panels/MetaEditor/MetaRelations",["js/Constants","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(t,e){"use strict";function n(t){var n={};switch(n[e.LINE_WIDTH]=1,n[e.LINE_START_ARROW]=h,n[e.LINE_END_ARROW]=h,n[e.LINE_COLOR]="#AAAAAA",n[e.LINE_PATTERN]=e.LINE_PATTERNS.SOLID,t){case p.CONTAINMENT:n[e.LINE_START_ARROW]=r,n[e.LINE_END_ARROW]=h,n[e.LINE_COLOR]="#000000";break;case p.POINTER:n[e.LINE_START_ARROW]=h,n[e.LINE_END_ARROW]=s,n[e.LINE_COLOR]="#0000FF";break;case p.INHERITANCE:n[e.LINE_START_ARROW]=h,n[e.LINE_END_ARROW]=a,n[e.LINE_COLOR]="#FF0000";break;case p.MIXIN:n[e.LINE_START_ARROW]=h,n[e.LINE_END_ARROW]=l,n[e.LINE_COLOR]="#FF0000",n[e.LINE_PATTERN]=e.LINE_PATTERNS.LONGDASH;break;case p.SET:n[e.LINE_START_ARROW]=d,n[e.LINE_END_ARROW]=c,n[e.LINE_COLOR]="#FF00FF"}return n}function i(t){return t===a?t.replace("xwide","wide").replace("xlong","long"):t}function o(t){var o,r,s=$("<div/>"),a=16,l=Raphael(s[0],a,a),c=n(t);return t===p.CONTAINMENT?(c[e.LINE_START_ARROW]=i(c[e.LINE_START_ARROW]),c[e.LINE_END_ARROW]=i(c[e.LINE_END_ARROW])):(r=c[e.LINE_START_ARROW],c[e.LINE_START_ARROW]=c[e.LINE_END_ARROW],c[e.LINE_END_ARROW]=r,t===p.MIXIN&&(c[e.LINE_START_ARROW]=i(c[e.LINE_START_ARROW]))),s.attr({style:"height: "+a+"px; margin-top: 2px; margin-bottom: 2px;"}),o=l.path("M"+(Math.round(a/2)+.5)+",0, L"+(Math.round(a/2)+.5)+","+a),o.attr({"arrow-start":c[e.LINE_START_ARROW],"arrow-end":c[e.LINE_END_ARROW],stroke:c[e.LINE_COLOR],"stroke-width":c[e.LINE_WIDTH],"stroke-dasharray":c[e.LINE_PATTERN]}),s}var r="diamond2-xxwide-xxlong",s="open-xwide-xlong",a="inheritance-xxwide-xxlong",l="open-xxwide-xxlong",c="classic-xwide-xlong",d="oval-wide-long",h="none",p={CONTAINMENT:"containment",POINTER:"pointer",INHERITANCE:"inheritance",MIXIN:"mixin",SET:"set"},g={TYPE:"type"};return{META_RELATIONS:p,getLineVisualDescriptor:n,createButtonIcon:o,CONNECTION_META_INFO:g}}),define("js/Panels/MetaEditor/MetaDocItem",["./MetaEditorConstants","common/util/random"],function(t,e){"use strict";function n(t,e,n,i){this._id=i,this._setName=n,this._nodeId=e,this._client=t,this.update()}var i="Documentation",o="#ececec",r="Edit documentation ...";return n.addNew=function(n,s,a,l){var c,d=n.getNode(s),h=d.getSetRegistryNames(a),p={};h.forEach(function(e){0===e.indexOf(t.META_DOC_REGISTRY_PREFIX)&&(p[e.replace(t.META_DOC_REGISTRY_PREFIX,"")]=!0)}),c=t.META_DOC_REGISTRY_PREFIX+e.generateRelid(p),l=l||{},l.x="number"==typeof l.x?l.x:100,l.y="number"==typeof l.y?l.y:100,n.setSetRegistry(s,a,c,{name:i,position:l,color:o,documentation:r})},n["delete"]=function(t,e,n,i){t.delSetRegistry(e,n,i)},n.prototype.update=function(){var t=this._client.getNode(this._nodeId),e=t.getSetRegistry(this._setName,this._id);this.name=e.name,this.documentation=e.documentation,this.position={},this.position.x=e.position&&"number"==typeof e.position.x?e.position.x:100,this.position.y=e.position&&"number"==typeof e.position.y?e.position.y:100,this.color=e.color,this.borderColor=e.borderColor,this.textColor=e.textColor},n.prototype.getObjectDescriptor=function(t){var e=this,n={position:this.position,decoratorClass:t,metaInfo:{},control:{_client:{getNode:function(){return{getAttribute:function(t){return e[t]},getRegistry:function(t){return e[t]}}},setAttribute:function(t,n,i){("documentation"===n||"name"===n)&&e.setProperty(n,i)}}},preferencesHelper:{getRegistry:function(t,n){return e[n]},setRegistry:function(){},delRegistry:function(){}}};return n},n.prototype.getPersistEntry=function(){var t,e={};for(t in this)this.hasOwnProperty(t)&&0!==t.indexOf("_")&&"undefined"!=typeof this[t]&&(e[t]=this[t]);return e},n.prototype.setProperty=function(t,e){this[t]=e;var n=this.getPersistEntry();this._client.setSetRegistry(this._nodeId,this._setName,this._id,n)},n.prototype.deleteProperty=function(t){delete this[t];var e=this.getPersistEntry();this._client.setSetRegistry(this._nodeId,this._setName,this._id,e)},n.prototype.deleteItem=function(){
this._client.delSetRegistry(this._nodeId,this._setName,this._id)},n}),define("text!js/Controls/templates/Dialog.html",[],function(){return'<div class="commit-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3></h3>\n            </div>\n            <div class="modal-body">\n            </div>\n            <div class="modal-footer">\n                <a href="#" class="btn btn-ok btn-primary">OK</a>\n                <a href="#" class="btn btn-cancel btn-default" data-dismiss="modal">Cancel</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("js/Controls/Dialog",["text!./templates/Dialog.html"],function(t){"use strict";function e(t,e,n,i){var r=!1,s=o.clone(),a=s.find(".modal-header > h3"),l=s.find(".modal-body"),c=s.find(".modal-footer > .btn-ok");a.text(t),l.html(e),i!==!0&&(s.find(".modal-footer > .btn-cancel").remove(),s.find(".modal-header > .close").remove()),s.on("shown.bs.modal",function(){c.focus()}),s.on("hidden.bs.modal",function(){s.remove(),s.empty(),s=void 0,r===!0&&n&&n()}),c.on("click",function(){r=!0,s.modal("hide")}),s.modal("show")}function n(t,n,i){e(t,n,i,!1)}function i(t,n,i){e(t,n,i,!0)}var o=$(t);return{alert:n,confirm:i}}),define("js/Panels/MetaEditor/MetaEditorControl.DiagramDesignerWidgetEventHandlers",["js/logger","js/util","common/util/guid","js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Utils/GMEConcepts","./MetaRelations","./MetaEditorConstants","./MetaDocItem","js/DragDrop/DragHelper","js/Controls/Dialog"],function(t,e,n,i,o,r,s,a,l,c,d,h){"use strict";var p,g="metaContainerID",u="DRAG_PARAMS_ACTIVE_META_ASPECT";return p=function(){this.logger=t.create("gme:Panels:MetaEditor:MetaEditorControl.DiagramDesignerWidgetEventHandlers",WebGMEGlobal.gmeConfig.client.log)},p.prototype.attachDiagramDesignerWidgetEventHandlers=function(){var t=this;this.diagramDesigner.onDesignerItemsMove=function(e){t._onDesignerItemsMove(e)},this.diagramDesigner.onCreateNewConnection=function(e){var n,i,o,r,s=t._ComponentID2GMEID[e.src],l=t._ComponentID2GMEID[e.dst];if(t._connType!==a.META_RELATIONS.INHERITANCE){if(t._connType===a.META_RELATIONS.MIXIN)if(i=t._client.getNode(s)){if(n=i.canSetAsMixin(l),n.isOk===!1)return t.logger.warn("cannot set ["+l+"] as mixin for ["+s+"]",n),void h.alert("Invalid mixin target",n.reason,function(){})}else t.logger.error("cannot edit mixin of an unknown node ["+s+"]");t._onCreateNewConnection(e)}else if(i=t._client.getNode(s)){if(s===l)return void h.alert("Invalid base modification","The base of an object cannot be itself!",function(){});if(l!==i.getBaseId())if(o=t._client.getNode(l),r=t._client.getNode(i.getBaseId()),o&&r){if(o.getChildrenIds().length>0||r.getChildrenIds().length>0)return void h.alert("Invalid base modification","Currently, modification from or to a base which has children is not allowed!",function(){});do{if(o.getId()===s)return void h.alert("Invalid base modification","Change of base node would create circular inheritance!",function(){});o=t._client.getNode(o.getBaseId())}while(o);h.confirm("Confirm base change","Changing a base can cause invalid data in the target node and its descendants!",function(){t._onCreateNewConnection(e)})}else r||h.alert("Invalid base modification","Cannot change the base of the FCO!",function(){});else h.alert("Invalid base modification","Base already set to the new base!",function(){})}else t.logger.error("cannot edit base of an unknown node ["+s+"]")},this.diagramDesigner.onSelectionDelete=function(e){t._onSelectionDelete(e)},this.diagramDesigner.onBackgroundDroppableAccept=function(e,n){return t._onBackgroundDroppableAccept(e,n)},this.diagramDesigner.onBackgroundDrop=function(e,n,i){t._onBackgroundDrop(e,n,i)},this.diagramDesigner.onCheckChanged=function(e,n){t._onConnectionTypeFilterCheckChanged(e,n)},this.diagramDesigner.onConnectionDstTextChanged=function(e,n,i){t._onConnectionDstTextChanged(e,n,i)},this._oGetDragParams=this.diagramDesigner.getDragParams,this.diagramDesigner.getDragParams=function(e,n){return t._getDragParams(e,n)},this.diagramDesigner.getDragItems=function(e){return t._getDragItems(e)},this.diagramDesigner.onSelectionChanged=function(e){t._onSelectionChanged(e)},this.diagramDesigner.onFilterNewConnectionDroppableEnds=function(t){return t.availableConnectionEnds},this.diagramDesigner.onTabAddClicked=function(){t._onTabAddClicked()},this.diagramDesigner.onTabTitleChanged=function(e,n,i){t._onTabTitleChanged(e,n,i)},this.diagramDesigner.onSelectedTabChanged=function(e){t._onSelectedTabChanged(e)},this.diagramDesigner.onTabDeleteClicked=function(e){t._onTabDeleteClicked(e)},this.diagramDesigner.onTabsSorted=function(e){t._onTabsSorted(e)},this.diagramDesigner.onSelectionFillColorChanged=function(e,n){t._onSelectionFillColorChanged(e,n)},this.diagramDesigner.onSelectionBorderColorChanged=function(e,n){t._onSelectionBorderColorChanged(e,n)},this.diagramDesigner.onSelectionTextColorChanged=function(e,n){t._onSelectionTextColorChanged(e,n)},this.diagramDesigner.onSelectionAlignMenu=function(e,n){t._onSelectionAlignMenu(e,n)},this.diagramDesigner.onAlignSelection=function(e,n){t._onAlignSelection(e,n)},this.diagramDesigner.onInconsistencyLinkClicked=function(e){return t._onInconsistencyLinkClicked(e)},this.logger.debug("attachDesignerCanvasEventHandlers finished")},p.prototype.__getDocItem=function(t){return this._metaDocItemsPerSheet[this._selectedMetaAspectSet][t]},p.prototype._onDesignerItemsMove=function(t){var e,n,i,o;this._client.startTransaction();for(e in t)n=t[e].x,i=t[e].y,this._ComponentID2GMEID[e]?this._client.setMemberRegistry(this.metaAspectContainerNodeID,this._ComponentID2GMEID[e],this._selectedMetaAspectSet,r.POSITION,{x:n,y:i}):this._ComponentID2DocItemID[e]&&(o=this.__getDocItem(this._ComponentID2DocItemID[e]),o.setProperty("position",{x:n,y:i}));this._client.completeTransaction()},p.prototype._onBackgroundDroppableAccept=function(t,e){var n,o=d.getDragItems(e),r=d.getDragParams(e),s=d.getDragEffects(e),a=!1;if(this._selectedMetaAspectSet)if(r&&r.hasOwnProperty(g))a=!0;else if(r===l.CREATE_META_DOC)a=!0;else if(1===s.length&&s[0]===d.DRAG_EFFECTS.DRAG_CREATE_INSTANCE)a=!0;else if(o.length>0&&-1===o.indexOf(i.PROJECT_ROOT_ID))for(n=0;n<o.length;n+=1)if(-1===this._metaAspectMembersPerSheet[this._selectedMetaAspectSet].indexOf(o[n])){a=!0;break}return a},p.prototype._onBackgroundDrop=function(t,e,n){var i,s,a,h,p,f,m,_,b,y,v=this._client,C=this.metaAspectContainerNodeID,E=d.getDragItems(e),D=d.getDragParams(e),I=d.getDragEffects(e),P=[];if(D===l.CREATE_META_DOC)this._selectedMetaAspectSet&&(v.startTransaction(),c.addNew(v,C,this._selectedMetaAspectSet,n),setTimeout(function(){v.completeTransaction()},10));else if(D&&D.hasOwnProperty(g)&&D[g]===C&&D[u]===this._selectedMetaAspectSet){v.startTransaction(),this.diagramDesigner.beginUpdate();for(i in D.positions)D.positions.hasOwnProperty(i)&&(h=n.x+D.positions[i].x,p=n.y+D.positions[i].y,this._GMEID2ComponentID[i]?(a=this._GMEID2ComponentID[i],v.setMemberRegistry(C,i,this._selectedMetaAspectSet,r.POSITION,{x:h,y:p})):this._DocItemID2ComponentID[i]&&(a=this._DocItemID2ComponentID[i],m=this.__getDocItem(i),m.setProperty("position",{x:h,y:p})),a&&(P.push(a),this.diagramDesigner.updateDesignerItem(a,{position:{x:h,y:p}})));this.diagramDesigner.endUpdate(),this.diagramDesigner.select(P),setTimeout(function(){v.completeTransaction()},10)}else if(1===I.length&&I[0]===d.DRAG_EFFECTS.DRAG_CREATE_INSTANCE&&1===E.length)v.startTransaction(),a=E[0],f={parentId:C,baseId:a},_=v.createChild(f),_&&(v.setRegistry(_,r.POSITION,{x:n.x,y:n.y}),b=v.getNode(a),b&&(y=b.getAttribute(o.Attributes.name)+"_instance",v.setAttribute(_,o.Attributes.name,y)),v.addMember(C,_,this._selectedMetaAspectSet),v.setMemberRegistry(C,_,this._selectedMetaAspectSet,r.POSITION,{x:n.x,y:n.y}),v.addMember(C,_,l.META_ASPECT_SET_NAME),v.setMemberRegistry(C,_,l.META_ASPECT_SET_NAME,r.POSITION,{x:n.x,y:n.y})),v.completeTransaction();else{if(v.startTransaction(),E.length>0)for(s=0;s<E.length;s+=1)a=E[s],-1===this._metaAspectMembersPerSheet[this._selectedMetaAspectSet].indexOf(a)&&(h=n.x,p=n.y,D&&D.hasOwnProperty(g)&&D[g]===C&&D[u]!==this._selectedMetaAspectSet?(D&&D.positions&&D.positions[a]&&(h+=D.positions[a].x),D&&D.positions&&D.positions[a]&&(p+=D.positions[a].y)):(n.x+=20,n.y+=20),v.addMember(C,a,this._selectedMetaAspectSet),v.setMemberRegistry(C,a,this._selectedMetaAspectSet,r.POSITION,{x:h,y:p}),-1===this._metaAspectMembersAll.indexOf(a)&&(v.addMember(C,a,l.META_ASPECT_SET_NAME),v.setMemberRegistry(C,a,l.META_ASPECT_SET_NAME,r.POSITION,{x:h,y:p})));setTimeout(function(){v.completeTransaction()},10)}},p.prototype._onSelectionDelete=function(t){var e,n,i,r,s,d,p,g,u=this._client,f=this.metaAspectContainerNodeID,m=this,_=[];for(this.logger.debug("_onSelectionDelete",t),r=function(t){var e=m._connectionListByID[t];e.type===a.META_RELATIONS.CONTAINMENT?m._deleteContainmentRelationship(e.GMESrcId,e.GMEDstId):e.type===a.META_RELATIONS.POINTER?m._deletePointerRelationship(e.GMESrcId,e.GMEDstId,e.name,!1):e.type===a.META_RELATIONS.INHERITANCE?m._deleteInheritanceRelationship(e.GMESrcId,e.GMEDstId):e.type===a.META_RELATIONS.MIXIN?m._deleteMixinRelationship(e.GMESrcId,e.GMEDstId):e.type===a.META_RELATIONS.SET&&m._deletePointerRelationship(e.GMESrcId,e.GMEDstId,e.name,!0)},s=function(t){for(u.startTransaction(),e=t.length;e--;)n=m._ComponentID2GMEID[t[e]],!n&&m._ComponentID2DocItemID[t[e]]&&m._selectedMetaAspectSet?c["delete"](u,f,m._selectedMetaAspectSet,m._ComponentID2DocItemID[t[e]]):(i=m._GMENodes.indexOf(n),-1!==i?(u.removeMember(f,n,m._selectedMetaAspectSet),1===m._metaAspectSheetsPerMember[n].length&&(g=u.getNode(n),g&&(g.isLibraryElement()||g.isLibraryRoot())||(u.removeMember(f,n,l.META_ASPECT_SET_NAME),u.setMeta(n,{})))):m._connectionListByID.hasOwnProperty(t[e])&&r(t[e]));u.completeTransaction()},e=t.length;e--;)n=this._ComponentID2GMEID[t[e]],i=this._GMENodes.indexOf(n),-1!==i&&1===this._metaAspectSheetsPerMember[n].length&&(g=u.getNode(n),g&&(g.isLibraryElement()||g.isLibraryRoot())||_.push(n));if(_.length>0){for(d="The following items you are about to delete are not present on any other sheet and will be permanently removed from the META aspect:<br><br>",p=[],e=_.length;e--;)n=_[e],g=u.getNode(n),g?p.push(g.getAttribute(o.Attributes.name)):p.push(n);for(p.sort(),e=0;e<p.length;e+=1)d+="- <b>"+p[e]+"</b>  (all associated meta rules will be deleted for this element)<br>";d+="<br>Are you sure you want to delete?",h.confirm("Confirm delete",d,function(){s(t)})}else s(t)},p.prototype._getDragParams=function(t,e){var n,i=this._oGetDragParams.call(this.diagramDesigner,t,e),o={positions:{}};o[g]=this.metaAspectContainerNodeID,o[u]=this._selectedMetaAspectSet;for(n in i.positions)i.positions.hasOwnProperty(n)&&(o.positions[this._ComponentID2GMEID[n]||this._ComponentID2DocItemID[n]]=i.positions[n]);return o},p.prototype._getDragItems=function(t){var e,n,i=[];for(e=t.length;e--;)n=this._ComponentID2GMEID[t[e]],-1!==this._GMENodes.indexOf(n)?i.push(n):this._ComponentID2DocItemID[t[e]]&&i.push(this._ComponentID2DocItemID[t[e]]);return i},p.prototype._onSelectionChanged=function(t){for(var e,n=[],i=t.length,o=t.length>0;i--;)e=this._ComponentID2GMEID[t[i]],e&&-1!==this.diagramDesigner.itemIds.indexOf(t[i])?(n.push(e),o=o&&s.isConnectionType(e)):o=!1;WebGMEGlobal.State.registerActiveSelection(n,{invoker:this})},p.prototype._onTabAddClicked=function(){var t,e,i,o,s,a,c=this.metaAspectContainerNodeID,d=this._client.getNode(c),h=d.getEditableRegistry(r.META_SHEETS)||[];for(h.sort(function(t,e){return t.order<e.order?-1:1}),e=h.length,t=0;e>t;t+=1)h[t].order=t;if(this._client.startTransaction(),i=l.META_ASPECT_SHEET_NAME_PREFIX+n(),this._client.createSet(c,i),a={SetID:i,order:h.length,title:"New sheet"},h.push(a),1===h.length)for(e=this._metaAspectMembersAll.length,s=100;e--;)o=this._metaAspectMembersAll[e],this._client.addMember(c,o,i),this._metaAspectMembersCoordinatesGlobal[o]?this._client.setMemberRegistry(c,o,i,r.POSITION,{x:this._metaAspectMembersCoordinatesGlobal[o].x,y:this._metaAspectMembersCoordinatesGlobal[o].y}):(this._client.setMemberRegistry(c,o,i,r.POSITION,{x:s,y:s}),s+=30);this._client.setRegistry(c,r.META_SHEETS,h),this._selectedMetaAspectSet=i,this._client.completeTransaction()},p.prototype._onTabTitleChanged=function(t,e,n){var i,o,s,a=this.metaAspectContainerNodeID,l=this._client.getNode(a),c=l.getEditableRegistry(r.META_SHEETS)||[];if(this._sheets[t]){for(s=this._sheets[t],o=c.length,i=0;o>i;i+=1)if(c[i].SetID===s){c[i].title=n;break}this._client.setRegistry(a,r.META_SHEETS,c)}},p.prototype._onSelectedTabChanged=function(t){this._sheets&&t&&this._selectedMetaAspectSet!==this._sheets[t]&&(this._selectedMetaAspectSet=this._sheets[t],this._selectedSheetID=t.toString(),this.logger.debug("selectedAspectChanged: "+this._selectedMetaAspectSet),WebGMEGlobal.State.registerActiveTab(t),this._initializeSelectedSheet(),this.diagramDesigner.selectTab(this._selectedSheetID))},p.prototype._onTabDeleteClicked=function(t){var e,n,i,s,a,c,d,p,g=this._sheets[t],u=this._metaAspectMembersPerSheet[g],f=this.metaAspectContainerNodeID,m=this._client.getNode(f),_=m.getEditableRegistry(r.META_SHEETS)||[],b=[],y=this._client;for(this.logger.debug("_onTabDeleteClicked",t),s=function(){for(y.startTransaction(),e=b.length;e--;)n=b[e],y.removeMember(f,n,l.META_ASPECT_SET_NAME),y.setMeta(n,{});for(e=_.length;e--;)if(_[e].SetID===g){_.splice(e,1);break}for(_.sort(function(t,e){return t.order<e.order?-1:1}),e=_.length,a=0;e>a;a+=1)_[a].order=a;y.setRegistry(f,r.META_SHEETS,_),y.deleteSet(f,g),y.completeTransaction()},e=u.length;e--;)n=u[e],i=this._GMENodes.indexOf(n),-1!==i&&1===this._metaAspectSheetsPerMember[n].length&&(p=y.getNode(n),p&&(p.isLibraryElement()||p.isLibraryRoot())||b.push(n));if(b.length>0){for(c="You are about to delete a sheet that contains the following items that are not present on any other sheet and will be permanently removed from the META aspect:<br><br>",d=[],e=b.length;e--;)n=b[e],p=y.getNode(n),p?d.push(p.getAttribute(o.Attributes.name)):d.push(n);for(d.sort(),e=0;e<d.length;e+=1)c+="- <b>"+d[e]+"</b> (all associated meta rules will be deleted for this element)<br>";c+="<br>Are you sure you want to delete the sheet anyway?",h.confirm("Confirm delete",c,function(){s()})}else c="Are you sure you want to delete this sheet?",h.confirm("Confirm delete",c,function(){s()})},p.prototype._onTabsSorted=function(t){var e,n,i,o=this.metaAspectContainerNodeID,s=this._client.getNode(o),a=s.getEditableRegistry(r.META_SHEETS)||[],l=WebGMEGlobal.State.getActiveTab();for(e=0;e<t.length;e+=1)for(l===t[e]&&WebGMEGlobal.State.registerActiveTab(e),i=this._sheets[t[e]],n=0;n<a.length;n+=1)if(a[n].SetID===i){a[n].order=e;break}a.sort(function(t,e){return t.order<e.order?-1:1}),this._client.setRegistry(o,r.META_SHEETS,a)},p.prototype._onSelectionFillColorChanged=function(t,e){this._onSelectionSetColor(t,e,r.COLOR)},p.prototype._onSelectionBorderColorChanged=function(t,e){this._onSelectionSetColor(t,e,r.BORDER_COLOR)},p.prototype._onSelectionTextColorChanged=function(t,e){this._onSelectionSetColor(t,e,r.TEXT_COLOR)},p.prototype._onSelectionSetColor=function(t,e,n){var i,o,r=t.length;for(this._client.startTransaction();r--;)o=this._ComponentID2GMEID[t[r]],o?e?this._client.setMemberRegistry(this.metaAspectContainerNodeID,o,l.META_ASPECT_SET_NAME,n,e):this._client.delMemberRegistry(this.metaAspectContainerNodeID,o,l.META_ASPECT_SET_NAME,n):this._ComponentID2DocItemID[t[r]]&&(i=this.__getDocItem(this._ComponentID2DocItemID[t[r]]),e?i.setProperty(n,e):i.deleteProperty(n));this._client.completeTransaction()},p.prototype._onSelectionAlignMenu=function(t,e){var n=this.diagramDesigner.posToPageXY(e.mX,e.mY),i=this;this._alignMenu.show(t,n,function(e){i._onAlignSelection(t,e)})},p.prototype._onAlignSelection=function(t,e){var n={client:this._client,modelId:this.metaAspectContainerNodeID,idMap:this._ComponentID2GMEID,setName:this._selectedMetaAspectSet,coordinates:this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet]};n.coordinates&&this._alignMenu.alignSetSelection(n,t,e)},p.prototype._onInconsistencyLinkClicked=function(t){var e=this._GMEID2ComponentID[t],n=!1;return e&&(this.diagramDesigner.select([e]),n=!0),n},p}),define("js/Controls/AlignMenu",["./ContextMenu"],function(t){"use strict";function e(e,n){n=n||{},this.isXAxisType=function(t){return t===e.MOVE_TO_LEFT||t===e.MOVE_TO_RIGHT||t===e.ALIGN_VERTICAL},this.getExtremePosition=function(t,n){var i,o,r={position:null,id:null};for(i=0;i<t.length;i+=1)o=t[i].position,n===e.MOVE_TO_TOP?(null===r.position||r.position.y>o.y)&&(r=t[i]):n===e.MOVE_TO_BOTTOM?(null===r.position||r.position.y<o.y)&&(r=t[i]):n===e.MOVE_TO_RIGHT?(null===r.position||r.position.x<o.x)&&(r=t[i]):n===e.MOVE_TO_LEFT&&(null===r.position||r.position.x>o.x)&&(r=t[i]);return null!==r.position?r:null},this.show=function(n,i,o){var r={};r[e.MOVE_TO_TOP]={name:"Move to top ["+e.KEY_SHORT_CUT_MOVE_TO_TOP+"]",icon:"glyphicon glyphicon-arrow-up"},r[e.MOVE_TO_BOTTOM]={name:"Move to bottom ["+e.KEY_SHORT_CUT_MOVE_TO_BOTTOM+"]",icon:"glyphicon glyphicon-arrow-down"},r[e.MOVE_TO_LEFT]={name:"Move to left ["+e.KEY_SHORT_CUT_MOVE_TO_LEFT+"]",icon:"glyphicon glyphicon-arrow-left"},r[e.MOVE_TO_RIGHT]={name:"Move to right ["+e.KEY_SHORT_CUT_MOVE_TO_RIGHT+"]",icon:"glyphicon glyphicon-arrow-right"},n.length>1&&(r[e.ALIGN_HORIZON]={name:"Align selection horizontally",icon:"fa fa-ellipsis-h"},r[e.ALIGN_VERTICAL]={name:"Align selection vertically",icon:"fa fa-ellipsis-v"});var s=new t({items:r,callback:o});i=i||{x:200,y:200},s.show(i)},this.alignSetSelection=function(t,e,n){var i,o,r=[],s=[],a=t.client,l=t.modelId,c=t.idMap,d=t.coordinates,h=t.setName;e.forEach(function(t){var e=c[t];e&&d[e]&&r.push({id:e,position:{x:d[e].x,y:d[e].y}})}),0!==r.length&&(0===n.indexOf("MOVE_TO_")?(Object.keys(d).forEach(function(t){s.push({id:t,position:{x:d[t].x,y:d[t].y}})}),i=this.getExtremePosition(s,n)):i=r[0],i&&(o=this.isXAxisType(n),a.startTransaction(),r.forEach(function(t){var e=t.position;i.id!==t.id&&(o===!0?e.x=i.position.x:e.y=i.position.y,a.setMemberRegistry(l,t.id,h,"position",e))}),a.completeTransaction()))}}return e}),define("js/Panels/MetaEditor/MetaEditorControl",["js/logger","js/util","js/Constants","js/Utils/GMEConcepts","js/Utils/ComponentSettings","js/NodePropertyNames","js/RegistryKeys","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","./MetaEditorControl.DiagramDesignerWidgetEventHandlers","./MetaRelations","./MetaEditorConstants","./MetaDocItem","js/Utils/PreferencesHelper","js/Controls/AlignMenu"],function(t,e,n,i,o,r,s,a,l,c,d,h,p,g){"use strict";var u,f="MetaDecorator",m="DocumentDecorator",b="DiagramDesigner",y=d.META_ASPECT_CONTAINER_ID;return u=function(e){var n=this;if(this.logger=e.logger||t.create(e.loggerName||"gme:Panels:MetaEditor:MetaEditorControl",WebGMEGlobal.gmeConfig.client.log),this._client=e.client,this._config=u.getDefaultConfig(),o.resolveWithWebGMEGlobal(this._config,u.getComponentId()),this.diagramDesigner=e.widget,this._alignMenu=new g(this.diagramDesigner.CONSTANTS,{}),void 0===this._client)throw this.logger.error("MetaEditorControl's client is not specified..."),"MetaEditorControl can not be created";if(void 0===this.diagramDesigner)throw this.logger.error("MetaEditorControl's DiagramDesigner is not specified..."),"MetaEditorControl can not be created";this.diagramDesigner.enableDragCopy(!1),this._metaAspectMemberPatterns={},this._filteredOutConnTypes=[],this._filteredOutConnectionDescriptors={},this.currentNodeInfo={id:null,members:[]},this._metaAspectMembersAll=[],this._metaAspectMembersPerSheet={},this._metaAspectMembersCoordinatesGlobal={},this._metaAspectMembersCoordinatesPerSheet={},this._selectedMetaAspectSheetMembers=[],this._selectedSheetID=null,this._metaDocItemsPerSheet={},this._ComponentID2DocItemID={},this._DocItemID2ComponentID={},this._GMEID2ComponentID={},this._ComponentID2GMEID={},this._setNewConnectionType(c.META_RELATIONS.CONTAINMENT),this._initFilterPanel(),this.attachDiagramDesignerWidgetEventHandlers(),this._client.decoratorManager.download([f],b,function(){n.logger.debug("MetaEditorControl ctor finished"),setTimeout(function(){n._loadMetaAspectContainerNode()},10)})},u.prototype._loadMetaAspectContainerNode=function(){var t=this;this.metaAspectContainerNodeID=y,this.currentNodeInfo.id=WebGMEGlobal.State.getActiveObject(),this.logger.debug('_loadMetaAspectContainerNode: "'+this.metaAspectContainerNodeID+'"'),this._initializeSelectedSheet(),this._territoryId&&this._client.removeUI(this._territoryId),this._selfPatterns={},this._selfPatterns[this.metaAspectContainerNodeID]={children:0},this._territoryId=this._client.addUI(this,function(e){t._eventCallback(e)}),this._client.updateTerritory(this._territoryId,this._selfPatterns)},u.prototype._eventCallback=function(t){var e,i=t?t.length:0;for(this.logger.debug('_eventCallback "'+i+'" items'),this.diagramDesigner.beginUpdate();i--;)switch(e=t[i],e.etype){case n.TERRITORY_EVENT_LOAD:this._onLoad(e.eid);break;case n.TERRITORY_EVENT_UPDATE:this._onUpdate(e.eid);break;case n.TERRITORY_EVENT_UNLOAD:this._onUnload(e.eid)}this.diagramDesigner.endUpdate(),this.diagramDesigner.hideProgressbar(),this.logger.debug('_eventCallback "'+t.length+'" items - DONE')},u.prototype.destroy=function(){this._detachClientEventListeners(),this._client.removeUI(this._territoryId),this._client.removeUI(this._metaAspectMembersTerritoryId),this.diagramDesigner.clear()},u.prototype._onLoad=function(t){t===this.metaAspectContainerNodeID?this._processMetaAspectContainerNode():this._processNodeLoad(t)},u.prototype._onUpdate=function(t){t===this.metaAspectContainerNodeID?this._processMetaAspectContainerNode():this._processNodeUpdate(t)},u.prototype._onUnload=function(t){var e=this;t===this.metaAspectContainerNodeID?(this.logger.debug('The currently opened aspect has been deleted --- GMEID: "'+this.metaAspectContainerNodeID+'"'),setTimeout(function(){e._loadMetaAspectContainerNode()},10)):this._processNodeUnload(t)},u.prototype._printNodeData=function(){},u.prototype._processMetaAspectContainerNode=function(){var t,e,n,i,o,r,a,l,c,h=this.metaAspectContainerNodeID,p=this._client.getNode(h),g=p.getMemberIds(d.META_ASPECT_SET_NAME),u=!1;for(this._metaAspectMembersAll=g.slice(0),n=this._metaAspectMembersAll.length,this._metaAspectMembersCoordinatesGlobal={};n--;)a=this._metaAspectMembersAll[n],this._metaAspectMembersCoordinatesGlobal[a]=p.getMemberRegistry(d.META_ASPECT_SET_NAME,a,s.POSITION);for(c=this._processMetaAspectSheetsRegistry(),l=this._metaAspectMembersPerSheet[this._selectedMetaAspectSet]||[],i=_.difference(this._selectedMetaAspectSheetMembers,l),n=i.length;n--;)delete this._metaAspectMemberPatterns[i[n]],u=!0;for(i=_.difference(l,this._selectedMetaAspectSheetMembers),n=i.length;n--;)this._metaAspectMemberPatterns[i[n]]={children:0},u=!0;for(i=_.intersection(this._selectedMetaAspectSheetMembers,l),n=i.length;n--;)a=i[n],o={position:{x:100,y:100}},this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][a]&&(o.position.x=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][a].x,o.position.y=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][a].y),this._GMEID2ComponentID.hasOwnProperty(a)&&(r=this._GMEID2ComponentID[a],this.diagramDesigner.updateDesignerItem(r,o));for(this._selectedMetaAspectSheetMembers=l.slice(0),this._processMetaDocItems(),t=this._config.autoCheckMetaConsistency?this._client.checkMetaConsistency():[],e=0;e<t.length;e+=1)this._client.dispatchEvent(this._client.CONSTANTS.NOTIFICATION,t[e]);u===!0&&this._client.updateTerritory(this._metaAspectMembersTerritoryId,this._metaAspectMemberPatterns)},u.prototype._processMetaDocItems=function(){var t,e,n,i,o,r;this.diagramDesigner.beginUpdate(),t=this._selectedMetaAspectSet&&this._metaDocItemsPerSheet[this._selectedMetaAspectSet]?this._metaDocItemsPerSheet[this._selectedMetaAspectSet]:{};for(e in this._DocItemID2ComponentID)t.hasOwnProperty(e)===!1&&(this.diagramDesigner.deleteComponent(this._DocItemID2ComponentID[e]),o=this._DocItemID2ComponentID[e],delete this._ComponentID2DocItemID[o],delete this._DocItemID2ComponentID[e]);for(e in t)this._DocItemID2ComponentID.hasOwnProperty(e)?(r={},r.position=t[e].position,o=this._DocItemID2ComponentID[e],this.diagramDesigner.updateDesignerItem(o,r)):(n=this._client.decoratorManager.getDecoratorForWidget(m,b),r=t[e].getObjectDescriptor(n),i=this.diagramDesigner.createDesignerItem(r),this._DocItemID2ComponentID[e]=i.id,this._ComponentID2DocItemID[i.id]=e);this.diagramDesigner.endUpdate()},u.prototype._processNodeLoad=function(t){var e,i,o;-1===this._GMENodes.indexOf(t)&&(o={position:{x:100,y:100}},this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][t]&&(o.position.x=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][t].x,o.position.y=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][t].y),i=this._client.decoratorManager.getDecoratorForWidget(f,b),o.decoratorClass=i,o.control=this,o.metaInfo={},o.metaInfo[n.GME_ID]=t,o.preferencesHelper=p.getPreferences([{containerID:this.metaAspectContainerNodeID,setID:d.META_ASPECT_SET_NAME}]),e=this.diagramDesigner.createDesignerItem(o),this._GMENodes.push(t),this._GMEID2ComponentID[t]=e.id,this._ComponentID2GMEID[e.id]=t,this._processNodeMetaContainment(t),this._processNodeMetaPointers(t,!1),this._processNodeMetaInheritance(t),this._processNodeMixins(t),this._processNodeMetaPointers(t,!0),this._processConnectionWaitingList(t))},u.prototype._processConnectionWaitingList=function(t){var e,n,i,o,r,s=[];if(i=t,this._connectionWaitingListByDstGMEID&&this._connectionWaitingListByDstGMEID.hasOwnProperty(i)){for(n in this._connectionWaitingListByDstGMEID[i])if(this._connectionWaitingListByDstGMEID[i].hasOwnProperty(n))for(e=this._connectionWaitingListByDstGMEID[i][n].length;e--;)o=this._connectionWaitingListByDstGMEID[i][n][e][0],r=this._connectionWaitingListByDstGMEID[i][n][e][1],s.push({gmeSrcID:n,gmeDstID:i,connType:o,connTexts:r});delete this._connectionWaitingListByDstGMEID[i]}if(n=t,this._connectionWaitingListBySrcGMEID&&this._connectionWaitingListBySrcGMEID.hasOwnProperty(n)){for(i in this._connectionWaitingListBySrcGMEID[n])if(this._connectionWaitingListBySrcGMEID[n].hasOwnProperty(i))for(e=this._connectionWaitingListBySrcGMEID[n][i].length;e--;)o=this._connectionWaitingListBySrcGMEID[n][i][e][0],r=this._connectionWaitingListBySrcGMEID[n][i][e][1],s.push({gmeSrcID:n,gmeDstID:i,connType:o,connTexts:r});delete this._connectionWaitingListBySrcGMEID[n]}for(e=s.length;e--;)n=s[e].gmeSrcID,i=s[e].gmeDstID,o=s[e].connType,r=s[e].connTexts,this._createConnection(n,i,o,r)},u.prototype._processNodeUnload=function(t){var e,n,i,o,r,s,a,l;if(this._GMEID2ComponentID.hasOwnProperty(t)){for(e=this._GMEID2ComponentID[t],i=this._nodeMetaContainment[t].targets.length;i--;)r=this._nodeMetaContainment[t].targets[i],this._removeConnection(t,r,c.META_RELATIONS.CONTAINMENT);for(i=this._nodeMetaPointers[t].combinedNames.length;i--;)s=this._nodeMetaPointers[t].combinedNames[i],r=this._nodeMetaPointers[t][s].target,s=this._nodeMetaPointers[t][s].name,this._removeConnection(t,r,c.META_RELATIONS.POINTER,s);for(this._nodeMetaInheritance[t]&&!_.isEmpty(this._nodeMetaInheritance[t])&&this._removeConnection(this._nodeMetaInheritance[t],t,c.META_RELATIONS.INHERITANCE),o=0;o<this._nodeMixins[t].length;o+=1)this._removeConnection(t,this._nodeMixins[t][o],c.META_RELATIONS.MIXIN);for(i=this._nodeMetaSets[t].combinedNames.length;i--;)s=this._nodeMetaSets[t].combinedNames[i],r=this._nodeMetaSets[t][s].target,s=this._nodeMetaSets[t][s].name,this._removeConnection(t,r,c.META_RELATIONS.SET,s);for(this.diagramDesigner.deleteComponent(e),delete this._ComponentID2GMEID[e],delete this._GMEID2ComponentID[t],n=this._GMENodes.indexOf(t),this._GMENodes.splice(n,1),a=this._getAssociatedConnections(t),i=a.src.length;i--;)l=a.src[i],this._saveConnectionToWaitingList(this._connectionListByID[l].GMESrcId,this._connectionListByID[l].GMEDstId,this._connectionListByID[l].type,this._connectionListByID[l].connTexts),this._removeConnection(this._connectionListByID[l].GMESrcId,this._connectionListByID[l].GMEDstId,this._connectionListByID[l].type);for(i=a.dst.length;i--;)l=a.dst[i],this._connectionListByID[l]&&(this._saveConnectionToWaitingList(this._connectionListByID[l].GMESrcId,this._connectionListByID[l].GMEDstId,this._connectionListByID[l].type,this._connectionListByID[l].connTexts),this._removeConnection(this._connectionListByID[l].GMESrcId,this._connectionListByID[l].GMEDstId,this._connectionListByID[l].type));for(r in this._connectionWaitingListBySrcGMEID)this._connectionWaitingListBySrcGMEID.hasOwnProperty(r)&&(delete this._connectionWaitingListBySrcGMEID[r][t],_.isEmpty(this._connectionWaitingListBySrcGMEID[r])&&delete this._connectionWaitingListBySrcGMEID[r]);for(r in this._connectionWaitingListByDstGMEID)this._connectionWaitingListByDstGMEID.hasOwnProperty(r)&&(delete this._connectionWaitingListByDstGMEID[r][t],_.isEmpty(this._connectionWaitingListByDstGMEID[r])&&delete this._connectionWaitingListByDstGMEID[r]);delete this._nodeMetaContainment[t],delete this._nodeMetaPointers[t],delete this._nodeMetaInheritance[t],delete this._nodeMixins[t],delete this._nodeMetaSets[t]}},u.prototype._createConnection=function(t,e,n,i){var o,r,s;-1!==this._GMENodes.indexOf(t)&&-1!==this._GMENodes.indexOf(e)?-1===this._filteredOutConnTypes.indexOf(n)?(o={srcObjId:this._GMEID2ComponentID[t],srcSubCompId:void 0,dstObjId:this._GMEID2ComponentID[e],dstSubCompId:void 0,reconnectable:!1,name:"",nameEdit:!1},_.extend(o,c.getLineVisualDescriptor(n)),i&&_.extend(o,i),r=this.diagramDesigner.createConnection(o),s={},s[c.CONNECTION_META_INFO.TYPE]=n,r.setMetaInfo(s),this._saveConnection(t,e,n,r.id,i)):this._filteredOutConnectionDescriptors[n].push([t,e,i]):this._saveConnectionToWaitingList(t,e,n,i)},u.prototype._saveConnectionToWaitingList=function(t,e,n,i){-1!==this._GMENodes.indexOf(t)&&-1===this._GMENodes.indexOf(e)?(this._connectionWaitingListByDstGMEID[e]=this._connectionWaitingListByDstGMEID[e]||{},this._connectionWaitingListByDstGMEID[e][t]=this._connectionWaitingListByDstGMEID[e][t]||[],this._connectionWaitingListByDstGMEID[e][t].push([n,i])):-1===this._GMENodes.indexOf(t)&&-1!==this._GMENodes.indexOf(e)?(this._connectionWaitingListBySrcGMEID[t]=this._connectionWaitingListBySrcGMEID[t]||{},this._connectionWaitingListBySrcGMEID[t][e]=this._connectionWaitingListBySrcGMEID[t][e]||[],this._connectionWaitingListBySrcGMEID[t][e].push([n,i])):this.logger.error("_saveConnectionToWaitingList both gmeSrcId and gmeDstId is undefined...")},u.prototype._saveConnection=function(t,e,n,i,o){this._connectionListBySrcGMEID[t]=this._connectionListBySrcGMEID[t]||{},this._connectionListBySrcGMEID[t][e]=this._connectionListBySrcGMEID[t][e]||{},this._connectionListBySrcGMEID[t][e][n]=this._connectionListBySrcGMEID[t][e][n]||[],this._connectionListBySrcGMEID[t][e][n].push(i),this._connectionListByDstGMEID[e]=this._connectionListByDstGMEID[e]||{},this._connectionListByDstGMEID[e][t]=this._connectionListByDstGMEID[e][t]||{},this._connectionListByDstGMEID[e][t][n]=this._connectionListByDstGMEID[e][t][n]||[],this._connectionListByDstGMEID[e][t][n].push(i),this._connectionListByType[n]=this._connectionListByType[n]||[],this._connectionListByType[n].push(i),this._connectionListByID[i]={GMESrcId:t,GMEDstId:e,type:n,name:o&&o.name?o.name:void 0,connTexts:o}},u.prototype._isPointerOrSetAndConnDescDoesNotMatchName=function(t,e,n){return(e===c.META_RELATIONS.POINTER||e===c.META_RELATIONS.SET)&&n&&""!==n&&t.name!==n},u.prototype._removeConnection=function(t,e,n,i){var o,r,s,a=!1;if(this._connectionListBySrcGMEID[t]&&this._connectionListBySrcGMEID[t][e]&&this._connectionListBySrcGMEID[t][e][n]&&(a=!0),
a)for(s=this._connectionListBySrcGMEID[t][e][n].length;s--;)o=this._connectionListBySrcGMEID[t][e][n][s],this._isPointerOrSetAndConnDescDoesNotMatchName(this._connectionListByID[o],n,i)===!0&&(o=void 0),o&&(this.diagramDesigner.deleteComponent(o),delete this._connectionListByID[o],r=this._connectionListByType[n].indexOf(o),this._connectionListByType[n].splice(r,1),r=this._connectionListBySrcGMEID[t][e][n].indexOf(o),this._connectionListBySrcGMEID[t][e][n].splice(r,1),r=this._connectionListByDstGMEID[e][t][n].indexOf(o),this._connectionListByDstGMEID[e][t][n].splice(r,1))},u.prototype._updateConnectionText=function(t,e,n,i){for(var o,r,s,a=this._connectionListBySrcGMEID[t][e][n].length,l=i.name,d=!1;a--;)o=this._connectionListBySrcGMEID[t][e][n][a],this._isPointerOrSetAndConnDescDoesNotMatchName(this._connectionListByID[o],n,l)===!0&&(o=void 0),o&&(this._connectionListByID[o].name=i.name,this._connectionListByID[o].connTexts=i,this.diagramDesigner.updateConnectionTexts(o,i),d=!0);if(!d)if(-1!==this._GMENodes.indexOf(t)&&-1===this._GMENodes.indexOf(e))for(a=this._connectionWaitingListByDstGMEID[e][t].length,r=0;a>r;r+=1)s=this._connectionWaitingListByDstGMEID[e][t][r],s[0]===n&&(n===c.META_RELATIONS.POINTER||n===c.META_RELATIONS.SET?l&&""!==l&&s[1].name===l&&(s[1]=i):s[1]=i);else if(-1===this._GMENodes.indexOf(t)&&-1!==this._GMENodes.indexOf(e))for(a=this._connectionWaitingListBySrcGMEID[t][e].length,r=0;a>r;r+=1)s=this._connectionWaitingListBySrcGMEID[t][e][r],s[0]===n&&(n===c.META_RELATIONS.POINTER||n===c.META_RELATIONS.SET?l&&""!==l&&s[1].name===l&&(s[1]=i):s[1]=i)},u.prototype._processNodeUpdate=function(t){var e,n,i={};this._GMEID2ComponentID.hasOwnProperty(t)&&(e=this._GMEID2ComponentID[t],n=this._client.decoratorManager.getDecoratorForWidget(f,b),i.decoratorClass=n,i.preferencesHelper=p.getPreferences([{containerID:this.metaAspectContainerNodeID,setID:d.META_ASPECT_SET_NAME}]),this.diagramDesigner.updateDesignerItem(e,i),this._processNodeMetaContainment(t),this._processNodeMetaPointers(t,!1),this._processNodeMetaInheritance(t),this._processNodeMixins(t),this._processNodeMetaPointers(t,!0))},u.prototype._processNodeMetaContainment=function(t){var e,n,i,o,r,s=this._client.getValidChildrenItems(t)||[],a=this._client.getOwnValidChildrenTypes(t)||[],l={targets:[]};for(this._nodeMetaContainment[t]=this._nodeMetaContainment[t]||{targets:[]},n=this._nodeMetaContainment[t],e=s.length;e--;)-1!==a.indexOf(s[e].id)&&(l.targets.push(s[e].id),l[s[e].id]={multiplicity:""+(s[e].min||0)+".."+(s[e].max||"*")});for(i=_.intersection(n.targets,l.targets),e=i.length;e--;)o=i[e],n[o].multiplicity!==l[o].multiplicity&&(n[o].multiplicity=l[o].multiplicity,this._updateConnectionText(t,o,c.META_RELATIONS.CONTAINMENT,{dstText:l[o].multiplicity,dstTextEdit:!0}));for(i=_.difference(n.targets,l.targets),e=i.length;e--;)o=i[e],this._removeConnection(t,o,c.META_RELATIONS.CONTAINMENT),r=n.targets.indexOf(o),n.targets.splice(r,1),delete n[o];for(i=_.difference(l.targets,n.targets),e=i.length;e--;)o=i[e],n.targets.push(o),n[o]={multiplicity:l[o].multiplicity},this._createConnection(t,o,c.META_RELATIONS.CONTAINMENT,{dstText:l[o].multiplicity,dstTextEdit:!0})},u.prototype._processNodeMetaPointers=function(t,e){var n,i,o,r,s,a,l,d,h,p,g=this._client.getNode(t),u=e===!0?g.getValidSetNames():g.getValidPointerNames(),f={names:[],combinedNames:[]},m=e===!0?c.META_RELATIONS.SET:c.META_RELATIONS.POINTER;for(e!==!0?(this._nodeMetaPointers[t]=this._nodeMetaPointers[t]||{names:[],combinedNames:[]},r=this._nodeMetaPointers[t]):(this._nodeMetaSets[t]=this._nodeMetaSets[t]||{names:[],combinedNames:[]},r=this._nodeMetaSets[t]),o=u.length;o--;)if(n=this._client.getValidTargetItems(t,u[o]),i=this._client.getOwnValidTargetTypes(t,u[o]),n)for(h=n.length;h--;)-1!==i.indexOf(n[h].id)&&(p=u[o]+"_"+n[h].id,f.names.push(u[o]),f.combinedNames.push(p),f[p]={name:u[o],target:n[h].id},e&&(f[p].multiplicity=""+(n[h].min||0)+".."+(n[h].max||"*")));for(s=_.intersection(r.combinedNames,f.combinedNames),o=s.length;o--;)p=s[o],r[p].multiplicity!==f[p].multiplicity&&(l=r[p].name,a=r[p].target,r[p].multiplicity=f[p].multiplicity,this._updateConnectionText(t,a,m,{name:l,dstText:f[p].multiplicity,dstTextEdit:!0}));for(s=_.difference(r.combinedNames,f.combinedNames),o=s.length;o--;)p=s[o],l=r[p].name,a=r[p].target,this._removeConnection(t,a,m,l),d=r.combinedNames.indexOf(p),r.combinedNames.splice(d,1),delete r[p];for(s=_.difference(f.combinedNames,r.combinedNames),o=s.length;o--;)p=s[o],l=f[p].name,a=f[p].target,r.names.push(l),r.combinedNames.push(p),r[p]={name:f[p].name,target:f[p].target,multiplicity:f[p].multiplicity},this._createConnection(t,a,m,{name:l,dstText:f[p].multiplicity,dstTextEdit:!0})},u.prototype._processNodeMetaInheritance=function(t){var e,n=this._client.getNode(t),i=n.getBaseId();e=this._nodeMetaInheritance[t],e&&e!==i&&(this._removeConnection(t,e,c.META_RELATIONS.INHERITANCE),delete this._nodeMetaInheritance[t]),i&&e!==i&&(this._nodeMetaInheritance[t]=i,this._createConnection(t,i,c.META_RELATIONS.INHERITANCE,void 0))},u.prototype._processNodeMixins=function(t){var e,n,i=this._client.getNode(t),o=i.getMixinPaths();for(this.logger.debug("processing mixins for ["+t+"]"),e=this._nodeMixins[t]||[],n=0;n<e.length;n+=1)-1===o.indexOf(e[n])&&this._removeConnection(t,e[n],c.META_RELATIONS.MIXIN);for(n=0;n<o.length;n+=1)-1===e.indexOf(o[n])&&this._createConnection(t,o[n],c.META_RELATIONS.MIXIN,void 0);this._nodeMixins[t]=o},u.prototype._setNewConnectionType=function(t){var e,n=c.getLineVisualDescriptor(t);this._connType!==t&&(this._connType=t,t===c.META_RELATIONS.CONTAINMENT&&(e=n[a.LINE_START_ARROW],n[a.LINE_START_ARROW]=n[a.LINE_END_ARROW],n[a.LINE_END_ARROW]=e),n[a.LINE_WIDTH]=2,this.diagramDesigner.connectionDrawingManager.setConnectionInDrawProperties(n),this.diagramDesigner.setFilterChecked(this._connType))},u.prototype._onCreateNewConnection=function(t){var e=this._ComponentID2GMEID[t.src],n=this._ComponentID2GMEID[t.dst];switch(this._connType){case c.META_RELATIONS.CONTAINMENT:this._createContainmentRelationship(n,e);break;case c.META_RELATIONS.INHERITANCE:this._createInheritanceRelationship(e,n);break;case c.META_RELATIONS.POINTER:this._createPointerRelationship(e,n,!1);break;case c.META_RELATIONS.SET:this._createPointerRelationship(e,n,!0);break;case c.META_RELATIONS.MIXIN:this._createMixinRelationship(e,n)}},u.prototype._createContainmentRelationship=function(t,e){var n=this._client.getNode(t),i=this._client.getNode(e);n&&i&&this._client.setChildMeta(t,e)},u.prototype._deleteContainmentRelationship=function(t,e){var n=this._client.getNode(t),i=this._client.getNode(e);n&&i&&this._client.delChildMeta(t,e)},u.prototype._createPointerRelationship=function(t,e,n){function i(){return{pointers:c.getValidPointerNames()||[],sets:c.getValidSetNames()||[],aspects:c.getValidAspectNames()||[]}}var o,r,s,a,l=this._client,c=l.getNode(t),d=l.getNode(e);c&&d&&(r=i(),n===!0?(s=r.sets,a=_.union(r.pointers,r.aspects)):(s=r.pointers,a=r.sets),this.diagramDesigner.selectNewPointerName(s,a,n,function(i){l.startTransaction(),o=l.getOwnValidTargetItems(t,i),o?n!==!0?l.setPointerMetaTarget(t,i,e,-1,1):l.setPointerMetaTarget(t,i,e,-1,-1):n!==!0?(l.setPointerMeta(t,i,{min:1,max:1,items:[{id:e,max:1}]}),l.setPointer(t,i,null)):(l.setPointerMeta(t,i,{items:[{id:e}]}),l.createSet(t,i)),l.completeTransaction()}))},u.prototype._deletePointerRelationship=function(t,e,n,i){var o,r=this._client.getNode(t),s=this._client.getNode(e);r&&s&&(this._client.delPointerMetaTarget(t,n,e),o=this._client.getValidTargetItems(t,n),o&&0!==o.length||(i===!1?(this._client.delPointerMeta(t,n),this._client.delPointer(t,n)):(this._client.delPointerMeta(t,n),this._client.deleteSet(t,n))))},u.prototype._createInheritanceRelationship=function(t,e){var n,i=this._client.getNode(e),o=this._client.getNode(t);i&&o&&(n=o.getBaseId(),n&&!_.isEmpty(n)&&this.logger.debug('InheritanceRelationship from "'+o.getAttribute(r.Attributes.name)+'" ('+t+') to parent "'+n+'" already exists, but overwriting to "'+i.getAttribute(r.Attributes.name)+'" ('+e+')"'),this._client.setBase(t,e))},u.prototype._deleteInheritanceRelationship=function(t,e){var n,i,o=this._client.getNode(e);o&&(n=o.getBaseId(),n&&(i=this._client.getNode(n),i&&(n=i.getAttribute(r.Attributes.name)+" ("+n+")"),this.logger.error('Deleting InheritanceRelationship from "'+o.getAttribute(r.Attributes.name)+'" ('+e+') to parent "'+n+'" is not allowed...')))},u.prototype._createMixinRelationship=function(t,e){var n=this._client.getNode(e),i=this._client.getNode(t);n&&i?this._client.addMixin(t,e):this.logger.error("cannot set ["+e+"] as mixin for ["+t+"] because not all node are loaded")},u.prototype._deleteMixinRelationship=function(t,e){var n=this._client.getNode(e),i=this._client.getNode(t);n&&i?this._client.delMixin(t,e):this.logger.error("cannot remove ["+newMixinId+"] mixin from ["+t+"] because not all node are loaded")},u.prototype._initFilterPanel=function(){var t;t=c.createButtonIcon(c.META_RELATIONS.CONTAINMENT),this.diagramDesigner.addFilterItem("Containment",c.META_RELATIONS.CONTAINMENT,t),t=c.createButtonIcon(c.META_RELATIONS.POINTER),this.diagramDesigner.addFilterItem("Pointer",c.META_RELATIONS.POINTER,t),t=c.createButtonIcon(c.META_RELATIONS.INHERITANCE),this.diagramDesigner.addFilterItem("Inheritance",c.META_RELATIONS.INHERITANCE,t),t=c.createButtonIcon(c.META_RELATIONS.MIXIN),this.diagramDesigner.addFilterItem("Mixin",c.META_RELATIONS.MIXIN,t),t=c.createButtonIcon(c.META_RELATIONS.SET),this.diagramDesigner.addFilterItem("Set",c.META_RELATIONS.SET,t)},u.prototype._onConnectionTypeFilterCheckChanged=function(t,e){var n;e===!0?(n=this._filteredOutConnTypes.indexOf(t),this._filteredOutConnTypes.splice(n,1),this._unfilterConnType(t)):(this._filteredOutConnTypes.push(t),this._filterConnType(t))},u.prototype._filterConnType=function(t){var e,n,i,o,r,s=this._connectionListByType&&this._connectionListByType.hasOwnProperty(t)?this._connectionListByType[t].length:0;for(this._filteredOutConnectionDescriptors[t]=[],this.diagramDesigner.beginUpdate();s--;)e=this._connectionListByType[t][s],n=this._connectionListByID[e].GMESrcId,i=this._connectionListByID[e].GMEDstId,o=this._connectionListByID[e].connTexts,(t===c.META_RELATIONS.POINTER||t===c.META_RELATIONS.SET)&&(r=this._connectionListByID[e].name),this._filteredOutConnectionDescriptors[t].push([n,i,o]),this._removeConnection(n,i,t,r);this.diagramDesigner.endUpdate()},u.prototype._unfilterConnType=function(t){var e,n,i,o=this._filteredOutConnectionDescriptors&&this._filteredOutConnectionDescriptors.hasOwnProperty(t)?this._filteredOutConnectionDescriptors[t].length:0;for(this.diagramDesigner.beginUpdate();o--;)e=this._filteredOutConnectionDescriptors[t][o][0],n=this._filteredOutConnectionDescriptors[t][o][1],i=this._filteredOutConnectionDescriptors[t][o][2],this._createConnection(e,n,t,i);delete this._filteredOutConnectionDescriptors[t],this.diagramDesigner.endUpdate()},u.prototype._onConnectionDstTextChanged=function(t,e,n){var i=this._connectionListByID[t];i.type===c.META_RELATIONS.CONTAINMENT?this._containmentRelationshipMultiplicityUpdate(i.GMESrcId,i.GMEDstId,e,n):i.type===c.META_RELATIONS.POINTER?this._pointerRelationshipMultiplicityUpdate(i.GMESrcId,i.GMEDstId,i.name,e,n):i.type===c.META_RELATIONS.INHERITANCE||i.type===c.META_RELATIONS.SET&&this._setRelationshipMultiplicityUpdate(i.GMESrcId,i.GMEDstId,i.name,e,n)},u.prototype._containmentRelationshipMultiplicityUpdate=function(t,e,n,i){var o,r,s=this._client.getNode(t),a=this._client.getNode(e);r=function(t){var e=null,n=/^\d+$/g,i=/^\d+\.\.\d+$/g,o=/^\d+\.\.\*$/g;return n.test(t)?e={min:parseInt(t,10),max:parseInt(t,10)}:i.test(t)?e={min:parseInt(t,10),max:parseInt(t.substring(t.indexOf("..")+2),10)}:o.test(t)&&(e={min:parseInt(t,10),max:-1}),e},s&&a&&(o=r(i),o?this._client.setChildMeta(t,e,o.min,o.max):this._updateConnectionText(t,e,c.META_RELATIONS.CONTAINMENT,{dstText:n,dstTextEdit:!0}))},u.prototype._pointerRelationshipMultiplicityUpdate=function(t,e,n,i,o){var r,s,a=this._client.getNode(t),l=this._client.getNode(e);r=function(t){var e,n="1",i="0..1";return t===n?e={min:1,max:1}:t===i&&(e={min:0,max:1}),e},a&&l&&(s=r(o),s?this._client.setPointerMetaTarget(t,n,e,s.min,s.max):this._updateConnectionText(t,e,c.META_RELATIONS.POINTER,{name:n,dstText:i,dstTextEdit:!0}))},u.prototype._setRelationshipMultiplicityUpdate=function(t,e,n,i,o){var r,s,a=this._client.getNode(t),l=this._client.getNode(e);r=function(t){var e=null,n=/^\d+$/g,i=/^\d+\.\.\d+$/g,o=/^\d+\.\.\*$/g;return n.test(t)?e={min:parseInt(t,10),max:parseInt(t,10)}:i.test(t)?e={min:parseInt(t,10),max:parseInt(t.substring(t.indexOf("..")+2),10)}:o.test(t)&&(e={min:parseInt(t,10),max:-1}),e},a&&l&&(s=r(o),s?this._client.setPointerMetaTarget(t,n,e,s.min,s.max):this._updateConnectionText(t,e,c.META_RELATIONS.SET,{name:n,dstText:i,dstTextEdit:!0}))},u.prototype._stateActiveSelectionChanged=function(t,e,n){var i=[],o=e?e.length:0;if(n.invoker!==this){for(;o--;)this._GMEID2ComponentID.hasOwnProperty(e[o])&&(i=i.concat(this._GMEID2ComponentID[e[o]]));this.diagramDesigner.select(i)}},u.prototype._stateActiveTabChanged=function(t,e){this._onSelectedTabChanged(e)},u.prototype._attachClientEventListeners=function(){this._detachClientEventListeners(),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged,this),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_TAB,this._stateActiveTabChanged,this)},u.prototype._detachClientEventListeners=function(){WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged),WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_TAB,this._stateActiveTabChanged)},u.prototype.onActivate=function(){this._selectedSheetID&&WebGMEGlobal.State.registerActiveTab(this._selectedSheetID),this.currentNodeInfo&&"string"==typeof this.currentNodeInfo.id&&WebGMEGlobal.State.registerActiveObject(this.currentNodeInfo.id,{suppressVisualizerFromNode:!0}),this._attachClientEventListeners(),this._displayToolbarItems()},u.prototype.onDeactivate=function(){this._detachClientEventListeners(),this._hideToolbarItems()},u.prototype._displayToolbarItems=function(){if(this._toolbarInitialized!==!0)this._initializeToolbar();else for(var t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].show()},u.prototype._hideToolbarItems=function(){if(this._toolbarInitialized===!0)for(var t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].hide()},u.prototype._removeToolbarItems=function(){if(this._toolbarInitialized===!0)for(var t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].destroy()},u.prototype._initializeToolbar=function(){var t=WebGMEGlobal.Toolbar,e=this;this._toolbarItems=[],this._radioButtonGroupMetaRelationType=t.addRadioButtonGroup(function(t){e._setNewConnectionType(t.connType)}),this._toolbarItems.push(this._radioButtonGroupMetaRelationType),this._radioButtonGroupMetaRelationType.addButton({title:"Containment",selected:!0,data:{connType:c.META_RELATIONS.CONTAINMENT},icon:c.createButtonIcon(c.META_RELATIONS.CONTAINMENT)}),this._radioButtonGroupMetaRelationType.addButton({title:"Inheritance",selected:!1,data:{connType:c.META_RELATIONS.INHERITANCE},icon:c.createButtonIcon(c.META_RELATIONS.INHERITANCE)}),this._radioButtonGroupMetaRelationType.addButton({title:"Mixin",selected:!1,data:{connType:c.META_RELATIONS.MIXIN},icon:c.createButtonIcon(c.META_RELATIONS.MIXIN)}),this._radioButtonGroupMetaRelationType.addButton({title:"Pointer",selected:!1,data:{connType:c.META_RELATIONS.POINTER},icon:c.createButtonIcon(c.META_RELATIONS.POINTER)}),this._radioButtonGroupMetaRelationType.addButton({title:"Set",selected:!1,data:{connType:c.META_RELATIONS.SET},icon:c.createButtonIcon(c.META_RELATIONS.SET)}),this._toolbarItems.push(t.addSeparator()),this._toolbarItems.push(t.addDragItem({icon:"fa fa-file-text-o",title:"Drag to create Meta Documentation",dragParams:function(){return d.CREATE_META_DOC}})),this._toolbarItems.push(t.addButton({icon:"fa fa-check-circle-o",title:"Check consistency of Meta",clickFn:function(){var t=e._client.checkMetaConsistency();e.diagramDesigner.showMetaConsistencyResults(t),0===t.length&&e._client.dispatchEvent(e._client.CONSTANTS.NOTIFICATION,{severity:"success",message:"No inconsistencies found in meta-model."})}})),this._toolbarInitialized=!0},u.prototype._getAssociatedConnections=function(t){var e,n,i,o={src:[],dst:[]};return i=function(i,o){var r,s;if(i.hasOwnProperty(t))for(r in i[t])if(i[t].hasOwnProperty(r))for(s in i[t][r])if(i[t][r].hasOwnProperty(s))for(e=i[t][r][s].length;e--;)n=i[t][r][s][e],-1===o.indexOf(n)&&o.push(n)},i(this._connectionListBySrcGMEID,o.src),i(this._connectionListByDstGMEID,o.dst),o},u.prototype._processMetaAspectSheetsRegistry=function(){var t,e,i,o,r,a,l,c,p,g,u=this._client.getNode(this.metaAspectContainerNodeID),f=u.getEditableRegistry(s.META_SHEETS)||[],m=this._metaAspectMembersCoordinatesPerSheet;for(this._sheets={},this._metaAspectMembersPerSheet={},this._metaAspectMembersCoordinatesPerSheet={},this.diagramDesigner.clearTabs(),this._metaAspectSheetsPerMember={},e=this._metaDocItemsPerSheet,this._metaDocItemsPerSheet={},f.sort(function(t,e){return t.order<e.order?-1:1}),this.diagramDesigner.addMultipleTabsBegin(),r=f.length,o=0;r>o;o+=1){for(c=f[o].SetID,a=this.diagramDesigner.addTab(f[o].title,!0,!0),this._sheets[a]=c,this._metaAspectMembersPerSheet[c]=u.getMemberIds(c),this._metaDocItemsPerSheet[c]={},i=u.getSetRegistryNames(c),p=0;p<i.length;p+=1)0===i[p].indexOf(d.META_DOC_REGISTRY_PREFIX)&&(e[c]&&e[c][i[p]]?(t=e[c][i[p]],t.update()):t=new h(this._client,u.getId(),c,i[p]),this._metaDocItemsPerSheet[c][i[p]]=t);for(this._metaAspectMembersPerSheet[c].indexOf(n.PROJECT_ROOT_ID)>-1&&this.logger.error("ROOT is in MetaSet: "+c),this._metaAspectMembersCoordinatesPerSheet[c]={},p=this._metaAspectMembersPerSheet[c].length;p--;)g=this._metaAspectMembersPerSheet[c][p],this._metaAspectMembersCoordinatesPerSheet[c][g]=u.getMemberRegistry(c,g,s.POSITION),this._metaAspectSheetsPerMember[g]=this._metaAspectSheetsPerMember[g]||[],this._metaAspectSheetsPerMember[g].push(c);this._selectedMetaAspectSet&&this._selectedMetaAspectSet===f[o].SetID&&(l=a)}this.diagramDesigner.addMultipleTabsEnd();var _=[];if(this._selectedMetaAspectSet){var b=m[this._selectedMetaAspectSet],y=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet];if(b&&y)for(var v in b)b.hasOwnProperty(v)&&y.hasOwnProperty(v)&&(b[v]?(b[v].x!==y[v].x||b[v].y!==y[v].y)&&_.push(v):_.push(v))}if(null!==WebGMEGlobal.State.getActiveTab()&&void 0!==WebGMEGlobal.State.getActiveTab()&&f.length>WebGMEGlobal.State.getActiveTab())if(WebGMEGlobal.PanelManager._activePanel.control===this)l=WebGMEGlobal.State.getActiveTab().toString();else for(l in this._sheets||{})if(this._sheets[l]===this._selectedMetaAspectSet)break;if(!l)for(l in this._sheets)if(this._sheets.hasOwnProperty(l))break;return this._selectedSheetID=l,this.diagramDesigner.selectTab(l),_},u.prototype._initializeSelectedSheet=function(){var t,e=this;for(this.logger.debug("_initializeSelectedSheet"),this.diagramDesigner.clear(),this._GMENodes=[],this._GMEID2ComponentID={},this._ComponentID2GMEID={},this._ComponentID2DocItemID={},this._DocItemID2ComponentID={},this._connectionWaitingListByDstGMEID={},this._connectionWaitingListBySrcGMEID={},this._connectionListBySrcGMEID={},this._connectionListByDstGMEID={},this._connectionListByType={},this._connectionListByID={},this._nodeMetaContainment={},this._nodeMetaPointers={},this._nodeMetaSets={},this._nodeMetaInheritance={},this._nodeMixins=[],this._selectedMetaAspectSheetMembers=[],this._filteredOutConnectionDescriptors={},t=this._filteredOutConnTypes.length;t--;)this._filteredOutConnectionDescriptors[this._filteredOutConnTypes[t]]=[];if(this._metaAspectMembersTerritoryId&&this._client.removeUI(this._metaAspectMembersTerritoryId),this._metaAspectMemberPatterns={},this._selectedMetaAspectSet&&this._metaAspectMembersPerSheet[this._selectedMetaAspectSet])for(t=this._metaAspectMembersPerSheet[this._selectedMetaAspectSet].length,t>0&&this.diagramDesigner.showProgressbar();t--;)this._selectedMetaAspectSheetMembers.push(this._metaAspectMembersPerSheet[this._selectedMetaAspectSet][t]),this._metaAspectMemberPatterns[this._metaAspectMembersPerSheet[this._selectedMetaAspectSet][t]]={children:0};this._processMetaDocItems(),this._metaAspectMembersTerritoryId=this._client.addUI(this,function(t){e._eventCallback(t)}),this._client.updateTerritory(this._metaAspectMembersTerritoryId,this._metaAspectMemberPatterns)},u.prototype.setReadOnly=function(t){this._radioButtonGroupMetaRelationType.enabled(!t)},u.getDefaultConfig=function(){return{autoCheckMetaConsistency:!0}},u.getComponentId=function(){return"GenericUIMetaEditorControl"},_.extend(u.prototype,l.prototype),u}),define("js/Panels/MetaEditor/MetaEditorPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/MetaEditor/MetaEditorWidget","./MetaEditorControl"],function(t,e,n,i){"use strict";var o;return o=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="MetaEditorPanel",i[t.OPTIONS.FLOATING_TITLE]=!0,t.apply(this,[i,e]),this._client=n.client,this._initialize(),this.logger.debug("MetaEditorPanel ctor finished")},_.extend(o.prototype,t.prototype),_.extend(o.prototype,e.prototype),o.prototype._initialize=function(){var t=this;this.$panelHeaderTitle&&this.$panelHeaderTitle.remove(),this.widget=new n(this.$el,{toolBar:this.toolBar}),this.widget.setTitle=function(){},this.widget.onUIActivity=function(){WebGMEGlobal.PanelManager.setActivePanel(t),WebGMEGlobal.KeyboardManager.setListener(t.widget)},this.control=new i({client:this._client,widget:this.widget}),this.onActivate()},o.prototype.onReadOnlyChanged=function(e){t.prototype.onReadOnlyChanged.call(this,e),this.widget.setReadOnly(e),this.control.setReadOnly(e)},o.prototype.onResize=function(t,e){this.logger.debug("onResize --> width: "+t+", height: "+e),this.widget.onWidgetContainerResize(t,e)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),t.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o}),define("js/Widgets/ModelEditor/ModelEditorWidget",["js/DragDrop/DragHelper","js/Widgets/DiagramDesigner/DiagramDesignerWidget"],function(t,e){"use strict";var n;return n=function(t,n){n=n||{},n.loggerName="gme:Widgets:ModelEditor:ModelEditorWidget",n.tabsEnabled=!0,n.addTabs=!1,n.deleteTabs=!1,n.reorderTabs=!1,e.call(this,t,n),this.logger.debug("ModelEditorWidget ctor")},_.extend(n.prototype,e.prototype),n.prototype._afterManagersInitialized=function(){this.enableOpenButton(!0)},n.prototype.getDragEffects=function(n,i){var o=i.ctrlKey||i.metaKey,r=i.altKey,s=i.shiftKey,a=e.prototype.getDragEffects.apply(this,[n,i]);return o||!r||s?o||r||!s||(a=[t.DRAG_EFFECTS.DRAG_CREATE_POINTER]):a=[t.DRAG_EFFECTS.DRAG_CREATE_INSTANCE],a},n.prototype._dragHelper=function(n,i,o){var r=e.prototype._dragHelper.apply(this,[n,i,o]),s=t.getDragEffects(o);return 1===s.length&&(s[0]===t.DRAG_EFFECTS.DRAG_CREATE_INSTANCE?r.html($('<i class="glyphicon glyphicon-share-alt"></i>')).append(" Create instance..."):s[0]===t.DRAG_EFFECTS.DRAG_CREATE_POINTER&&r.html($('<i class="glyphicon glyphicon-share"></i>')).append(" Create pointer...")),r},n}),define("text!js/Dialogs/ReplaceBase/templates/ReplaceBaseDialog.html",[],function(){return'<div class="replace-base-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-md">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <i class="glyphicon glyphicon-transfer header-icon"></i><span>Replace Base</span>\n            </div>\n            <div class="modal-body">\n                <h5>Select new base\n                    <i class="glyphicon glyphicon-info-sign toggle-info-btn"/>\n                </h5>\n                    <span class="info-message hidden">Select a node in the inheritance tree that should replace the\n                        base of the replaceable node. The root of the tree is the either the meta-type of the\n                        replaceable node or, if defined, the target of the "constrainedby" pointer. All displayed nodes\n                        may not be a valid new base. To validate on demand double-click the node in the tree.\n                     </span>\n                <span>\n                </span>\n                <div class="tree-container"></div>\n                <div class="alert alert-info message-badge hidden" role="alert"></div>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-primary btn-ok">OK</button>\n                <button class="btn btn-default btn-cancel">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!js/Dialogs/ReplaceBase/styles/ReplaceBaseDialog",[],function(){}),define("js/Dialogs/ReplaceBase/ReplaceBaseDialog",["js/Panels/ObjectBrowser/InheritanceBrowserControl","js/Widgets/TreeBrowser/TreeBrowserWidget","js/Utils/GMEConcepts","text!./templates/ReplaceBaseDialog.html","css!./styles/ReplaceBaseDialog.css"],function(t,e,n,i){"use strict";function o(){this._dialog=null,this._okBtn=null,this._cancelBtn=null,this._infoBtn=null,this._infoSpan=null,this._alertDiv=null,this._treeWidget=null,this._treeControl=null}return o.prototype.show=function(o){var r=this,s=o.client,a=n.getConstrainedById(o.nodeId);this._dialog=$(i),this._infoBtn=this._dialog.find(".toggle-info-btn"),this._infoSpan=this._dialog.find(".info-message"),this._alertDiv=this._dialog.find(".alert"),this._okBtn=this._dialog.find(".btn-ok"),this._cancelBtn=this._dialog.find(".btn-cancel"),this._treeWidget=new e(this._dialog.find(".tree-container"),{titleFilter:{text:"",type:"caseInsensitive"}}),this._treeWidget._makeNodeDraggable=function(){},this._treeControl=new t(s,this._treeWidget),this._treeControl._getRootId=function(){return a},this._treeControl._onNodeDoubleClicked=function(t){var e=s.getNode(t);n.isValidReplaceableTarget(o.nodeId,t)?r._showAlert(e.getAttribute("name")+" ["+t+"] is valid new base. Press OK to replace the current base with it.","alert-success"):r._showAlert(e.getAttribute("name")+" ["+t+"] is not a valid new base - it would create a loop in containment/inheritance tree.","alert-danger")},this._treeControl._onCreatingContextMenu=function(t,e){e.rename=!1,e["delete"]=!1},this._infoBtn.on("click",function(){r._infoSpan.hasClass("hidden")?r._infoSpan.removeClass("hidden"):r._infoSpan.addClass("hidden")}),this._okBtn.on("click",function(t){var e=r._treeWidget.getSelectedIDs();t.preventDefault(),t.stopPropagation(),1!==e.length?r._showAlert("Please select exactly one node in the tree to replace the current base.","alert-danger"):n.isValidReplaceableTarget(o.nodeId,e[0])===!1?(e=s.getNode(e[0]),r._showAlert(e.getAttribute("name")+" ["+e.getId()+"] is not a valid new base - it would create a loop in containment/inheritance tree.","alert-danger")):(s.setBase(o.nodeId,e[0]),r._dialog.modal("hide"))}),this._cancelBtn.on("click",function(t){t.preventDefault(),t.stopPropagation(),r._dialog.modal("hide")}),this._dialog.on("hide.bs.modal",function(){r._treeControl.destroy(),r._okBtn.off("click"),r._cancelBtn.off("click"),r._infoBtn.off("click"),r._dialog.remove(),r._dialog.empty(),r._dialog=void 0}),this._dialog.modal("show")},o.prototype._showAlert=function(t,e){this._alertDiv.removeClass("alert-success alert-info alert-warning alert-danger hidden"),this._alertDiv.addClass(e),this._alertDiv.text(t)},o.prototype._hideAlert=function(){this._alertDiv.addClass("hidden")},o}),define("js/Panels/ModelEditor/ModelEditorControl.DiagramDesignerWidgetEventHandlers",["js/logger","js/util","js/Constants","js/UIEvents","js/NodePropertyNames","js/RegistryKeys","js/Utils/GMEConcepts","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","js/DragDrop/DragHelper","js/Dialogs/ReplaceBase/ReplaceBaseDialog","js/Utils/Exporters","js/Dialogs/ImportModel/ImportModelDialog"],function(t,e,n,i,o,r,s,a,l,c,d,h){"use strict";var p,g="attributes",u="registry",f=n.POINTER_SOURCE,m=n.POINTER_TARGET;return p=function(){},p.prototype.attachDiagramDesignerWidgetEventHandlers=function(){var t=this;this.designerCanvas.onDesignerItemsMove=function(e){t._onDesignerItemsMove(e)},this.designerCanvas.onCreateNewConnection=function(e){t._onCreateNewConnection(e)},this.designerCanvas.onSelectionDelete=function(e){t._onSelectionDelete(e)},this.designerCanvas.onDesignerItemDoubleClick=function(e,n){t._onDesignerItemDoubleClick(e,n)},this.designerCanvas.onModifyConnectionEnd=function(e){t._onModifyConnectionEnd(e)},this.designerCanvas.onRegisterSubcomponent=function(e,n,i){t._onRegisterSubcomponent(e,n,i)},this.designerCanvas.onUnregisterSubcomponent=function(e,n){t._onUnregisterSubcomponent(e,n)},this.designerCanvas.onBackgroundDroppableAccept=function(e,n){return t._onBackgroundDroppableAccept(e,n)},this.designerCanvas.onBackgroundDrop=function(e,n,i){t._onBackgroundDrop(e,n,i)},this.designerCanvas.onSelectionChanged=function(e){t._onSelectionChanged(e)},this.designerCanvas.onClipboardCopy=function(e){t._onClipboardCopy(e)},this.designerCanvas.onClipboardPaste=function(){t._onClipboardPaste()},this.designerCanvas.onConnectionSegmentPointsChange=function(e){t._onConnectionSegmentPointsChange(e)},this.designerCanvas.onFilterNewConnectionDroppableEnds=function(e){return t._onFilterNewConnectionDroppableEnds(e)},this.designerCanvas.onFilterReconnectionDroppableEnds=function(e){return t._onFilterReconnectionDroppableEnds(e)},this.designerCanvas.onDragStartDesignerItemDraggable=function(e){return t._onDragStartDesignerItemDraggable(e)},this.designerCanvas.onDragStartDesignerItemCopyable=function(e){return t._onDragStartDesignerItemCopyable(e)},this.designerCanvas.onDragStartDesignerConnectionCopyable=function(e){return t._onDragStartDesignerConnectionCopyable(e)},this.designerCanvas.onSelectionRotated=function(e,n){return t._onSelectionRotated(e,n)},this.designerCanvas.onSetConnectionProperty=function(e){t._onSetConnectionProperty(e)},this.designerCanvas.onCopy=function(){return t._onCopy()},this.designerCanvas.onPaste=function(e){return t._onPaste(e)},this.designerCanvas.getDragItems=function(e){return t._getDragItems(e)},this._oGetDragParams=this.designerCanvas.getDragParams,this.designerCanvas.getDragParams=function(e,n){return t._getDragParams(e,n)},this.designerCanvas.onSelectionContextMenu=function(e,n){t._onSelectionContextMenu(e,n)},this.designerCanvas.onSelectionAlignMenu=function(e,n){t._onSelectionAlignMenu(e,n)},this.designerCanvas.onSelectionFillColorChanged=function(e,n){t._onSelectionFillColorChanged(e,n)},this.designerCanvas.onSelectionBorderColorChanged=function(e,n){t._onSelectionBorderColorChanged(e,n)},this.designerCanvas.onSelectionTextColorChanged=function(e,n){t._onSelectionTextColorChanged(e,n)},this.designerCanvas.onSelectedTabChanged=function(e){t._onSelectedTabChanged(e)},this.designerCanvas.onAlignSelection=function(e,n){t._onAlignSelection(e,n)},this.logger.debug("attachDiagramDesignerWidgetEventHandlers finished")},p.prototype._onDesignerItemsMove=function(t){var e,i,o=this.currentNodeInfo.id;this._client.startTransaction();for(e in t)t.hasOwnProperty(e)&&(i={x:t[e].x,y:t[e].y},this._selectedAspect===n.ASPECT_ALL?this._client.setRegistry(this._ComponentID2GMEID[e],r.POSITION,i):(this._client.addMember(o,this._ComponentID2GMEID[e],this._selectedAspect),this._client.setMemberRegistry(o,this._ComponentID2GMEID[e],this._selectedAspect,r.POSITION,i)));
this._client.completeTransaction()},p.prototype._onDesignerItemsCopy=function(t){var e,n,i,o={parentId:this.currentNodeInfo.id};this.designerCanvas.beginUpdate();for(e in t.items)t.items.hasOwnProperty(e)&&(n=t.items[e],i=this._ComponentID2GMEID[n.oItemId],o[i]={},o[i][g]={},o[i][u]={},o[i][u][r.POSITION]={x:n.posX,y:n.posY},this.designerCanvas.deleteComponent(e));for(e in t.connections)t.connections.hasOwnProperty(e)&&(n=t.connections[e],i=this._ComponentID2GMEID[n.oConnectionId],o[i]={},this.designerCanvas.deleteComponent(e));this.designerCanvas.endUpdate(),this._client.intellyPaste(o)},p.prototype._onCreateNewConnection=function(t){var e,i,r,a,l,c,d,h,p=this.currentNodeInfo.id,g=this._client,u=10,f={},m=this._selectedAspect;for(r=function(t){t&&(g.startTransaction(),c=g.createChild({parentId:p,baseId:t}),g.setPointer(c,n.POINTER_SOURCE,e),g.setPointer(c,n.POINTER_TARGET,i),g.completeTransaction())},e=void 0!==t.srcSubCompId?this._Subcomponent2GMEID[t.src][t.srcSubCompId]:this._ComponentID2GMEID[t.src],i=void 0!==t.dstSubCompId?this._Subcomponent2GMEID[t.dst][t.dstSubCompId]:this._ComponentID2GMEID[t.dst],d=s.getValidConnectionTypesInAspect(e,i,p,m),a=d.length;a--;)s.canCreateChild(p,d[a])||d.splice(a,1);if(1===d.length)r(d[0]);else if(d.length>1){for(a=0;a<d.length;a+=1)l=this._client.getNode(d[a]),f[d[a]]={name:"Create type '"+(l?l.getAttribute(o.Attributes.name):d[a])+"'",icon:!1};h=this.designerCanvas.items[t.dst].getBoundingBox(),this.designerCanvas.createMenu(f,function(t){r(t)},this.designerCanvas.posToPageXY(h.x-u,h.y-u))}},p.prototype._onSelectionDelete=function(t){for(var e,n=[],i=t.length;i--;)e=this._ComponentID2GMEID[t[i]],s.canDeleteNode(e)?n.pushUnique(e):this.logger.warn("Can not delete item with ID: "+e+". Possibly it is the ROOT or FCO");n.length>0&&this._client.deleteNodes(n)},p.prototype._onDesignerItemDoubleClick=function(t){var e=this._ComponentID2GMEID[t];e&&(this.logger.debug('Opening model with id "'+e+'"'),WebGMEGlobal.State.registerActiveObject(e))},p.prototype._onModifyConnectionEnd=function(t){var e,n=this._ComponentID2GMEID[t.id],i=t.old,o=t["new"];n&&(this._client.startTransaction(),(i.srcObjId!==o.srcObjId||i.srcSubCompId!==o.srcSubCompId)&&(e=void 0!==o.srcSubCompId?this._Subcomponent2GMEID[o.srcObjId][o.srcSubCompId]:this._ComponentID2GMEID[o.srcObjId],this._client.setPointer(n,f,e)),(i.dstObjId!==o.dstObjId||i.dstSubCompId!==o.dstSubCompId)&&(e=void 0!==o.dstSubCompId?this._Subcomponent2GMEID[o.dstObjId][o.dstSubCompId]:this._ComponentID2GMEID[o.dstObjId],this._client.setPointer(n,m,e)),this._client.completeTransaction())},p.prototype._onRegisterSubcomponent=function(t,e,i){this._GMEID2Subcomponent[i[n.GME_ID]]=this._GMEID2Subcomponent[i[n.GME_ID]]||{},this._GMEID2Subcomponent[i[n.GME_ID]][t]=e,this._Subcomponent2GMEID[t]=this._Subcomponent2GMEID[t]||{},this._Subcomponent2GMEID[t][e]=i[n.GME_ID]},p.prototype._onUnregisterSubcomponent=function(t,e){var n=this._Subcomponent2GMEID[t][e];delete this._Subcomponent2GMEID[t][e],this._GMEID2Subcomponent[n]&&delete this._GMEID2Subcomponent[n][t]},p.prototype._getPossibleDropActions=function(t){var e,n,i,r,a,c=l.getDragItems(t),d=l.getDragEffects(t),h=l.getDragParams(t),p=[],g=this.currentNodeInfo.id,u=!1,f=[],m=this._selectedAspect,_=function(t,e){var n=t.name.toLowerCase(),i=e.name.toLowerCase(),o=t.pointer.toLowerCase(),r=e.pointer.toLowerCase();return r>o?-1:o>r?1:i>n?-1:1};for(e=0;e<c.length;e+=1)if(s.isProjectFCO(c[e])){u=!0;break}if(c.length>0)for(e=d.length;e--;)switch(d[e]){case l.DRAG_EFFECTS.DRAG_MOVE:(h&&h.parentID===g||s.canCreateChildrenInAspect(g,c,m)&&s.canMoveNodeHere(g,c)&&!u)&&(a={dragEffect:d[e]},p.push(a));break;case l.DRAG_EFFECTS.DRAG_COPY:s.canCreateChildrenInAspect(g,c,m)&&!u&&(a={dragEffect:d[e]},p.push(a));break;case l.DRAG_EFFECTS.DRAG_CREATE_INSTANCE:s.canCreateChildrenInAspect(g,c,m)&&(a={dragEffect:d[e]},p.push(a));break;case l.DRAG_EFFECTS.DRAG_CREATE_POINTER:if(1===c.length&&(f=s.getValidPointerTypes(g,c[0]),f.length>0)){for(n=f.length;n--;)i=f[n].baseId,r=this._client.getNode(i),f[n].name=i,r&&(f[n].name=r.getAttribute(o.Attributes.name));for(f.sort(_),n=0;n<f.length;n+=1)a={dragEffect:l.DRAG_EFFECTS.DRAG_CREATE_POINTER,name:f[n].name,baseId:f[n].baseId,pointer:f[n].pointer},p.push(a)}}return this.logger.debug("possibleDropActions: "+JSON.stringify(p)),p},p.prototype._onBackgroundDroppableAccept=function(t,e){var n;return n=this._getPossibleDropActions(e).length>0},p.prototype._onBackgroundDrop=function(t,e,n){var i,o,r,s=this._getPossibleDropActions(e),a=s.length,c=this;if(1===a)o=s[0],this._handleDropAction(o,e,n);else{for(r={},i=0;i<s.length;i+=1)switch(s[i].dragEffect){case l.DRAG_EFFECTS.DRAG_COPY:r[i]={name:"Copy here",icon:"glyphicon glyphicon-plus"};break;case l.DRAG_EFFECTS.DRAG_MOVE:r[i]={name:"Move here",icon:"glyphicon glyphicon-move"};break;case l.DRAG_EFFECTS.DRAG_CREATE_INSTANCE:r[i]={name:"Create instance here",icon:"glyphicon glyphicon-share-alt"};break;case l.DRAG_EFFECTS.DRAG_CREATE_POINTER:r[i]={name:'Create pointer "'+s[i].pointer+'" of type "'+s[i].name+'"',icon:"glyphicon glyphicon-share"}}this.designerCanvas.createMenu(r,function(t){o=s[parseInt(t,10)],c._handleDropAction(o,e,n)},this.designerCanvas.posToPageXY(n.x,n.y))}},p.prototype._handleDropAction=function(t,e,n){var i,s,a,c,d,h,p=t.dragEffect,g=l.getDragItems(e),f=l.getDragParams(e),m=this.currentNodeInfo.id,_=20;switch(this.logger.debug("dropAction: "+JSON.stringify(t)),this.logger.debug("dragInfo: "+JSON.stringify(e)),this.logger.debug("position: "+JSON.stringify(n)),p){case l.DRAG_EFFECTS.DRAG_COPY:for(a={parentId:m},i=g.length;i--;)s=g[i],a[s]={},c=f&&f.positions[s]||{x:0,y:0},a[s][u]={},a[s][u][r.POSITION]={x:n.x+c.x,y:n.y+c.y};this._client.startTransaction(),this._client.copyMoreNodes(a),this._client.completeTransaction();break;case l.DRAG_EFFECTS.DRAG_MOVE:if(f&&f.parentID===m)this._repositionItems(g,f.positions,n);else{for(a={parentId:m},i=g.length;i--;)s=g[i],a[s]={},c=f&&f.positions[s]||{x:0,y:0},a[s][u]={},a[s][u][r.POSITION]={x:n.x+c.x,y:n.y+c.y};this._client.moveMoreNodes(a)}break;case l.DRAG_EFFECTS.DRAG_CREATE_INSTANCE:for(a={parentId:m},i=g.length;i--;)c=f&&f.positions[g[i]]||{x:0,y:0},a[g[i]]={registry:{position:{x:n.x+c.x,y:n.y+c.y}}},f&&f.positions[g[i]]||(n.x+=_,n.y+=_);this._client.createChildren(a);break;case l.DRAG_EFFECTS.DRAG_CREATE_POINTER:a={parentId:m,baseId:t.baseId},this._client.startTransaction(),s=this._client.createChild(a),s&&(c=f&&f.positions[g[0]]||{x:0,y:0},this._client.setRegistry(s,r.POSITION,{x:n.x+c.x,y:n.y+c.y}),this._client.setPointer(s,t.pointer,g[0]),d=this._client.getNode(g[0]),d&&(h=d.getAttribute(o.Attributes.name)+"-"+t.pointer,this._client.setAttribute(s,o.Attributes.name,h))),this._client.completeTransaction()}},p.prototype._repositionItems=function(t,e,n){var i,o,r,s,a=t.length,l=[],c=this;if(e&&!_.isEmpty(e)){for(this.designerCanvas.beginUpdate();a--;)if(r=t[a],i=e[r],i||(i={x:0,y:0}),this._GMEID2ComponentID.hasOwnProperty(r))for(s=this._GMEID2ComponentID[r].length;s--;)o=this._GMEID2ComponentID[r][s],l.push(o),this.designerCanvas.updateDesignerItem(o,{position:{x:n.x+i.x,y:n.y+i.y}});this.designerCanvas.endUpdate(),this.designerCanvas.select(l),setTimeout(function(){c._saveReposition(t,e,n)},10)}},p.prototype._saveReposition=function(t,e,i){var o,s,a,l=this.currentNodeInfo.id,c=this._selectedAspect,d=this._client;for(d.startTransaction(),a=t.length;a--;)o=t[a],s=e[o],s||(s={x:0,y:0}),c===n.ASPECT_ALL?d.setRegistry(o,r.POSITION,{x:i.x+s.x,y:i.y+s.y}):(d.addMember(l,o,c),d.setMemberRegistry(l,o,c,r.POSITION,{x:i.x+s.x,y:i.y+s.y}));d.completeTransaction()},p.prototype._onSelectionChanged=function(t){for(var e,n=[],i=t.length,o=t.length>0;i--;)e=this._ComponentID2GMEID[t[i]],e&&(n.push(e),o=o&&s.isConnectionType(e));o=o&&this.designerCanvas.getIsReadOnlyMode()===!1,this.designerCanvas.toolbarItems.ddbtnConnectionArrowStart.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionPattern.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionArrowEnd.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionLineType.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionLineWidth.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionLabelPlacement.enabled(o),this.$btnConnectionRemoveSegmentPoints.enabled(o),WebGMEGlobal.State.registerActiveSelection(n,{invoker:this})},p.prototype._onClipboardCopy=function(t){for(var e,n=[],i=t.length;i--;)e=this._ComponentID2GMEID[t[i]],e&&n.push(e);0!==n.length&&this._client.copyNodes(n)},p.prototype._onClipboardPaste=function(){this.currentNodeInfo.id&&this._client.pasteNodes(this.currentNodeInfo.id)},p.prototype._onConnectionSegmentPointsChange=function(t){var e,n=t.connectionID,i=t.points,o=this._ComponentID2GMEID[n];o&&(e=this._client.getNode(o),e&&this._client.setRegistry(o,r.LINE_CUSTOM_POINTS,i))},p.prototype._onFilterNewConnectionDroppableEnds=function(t){var e,i,o,r,a,l,c,d=t.availableConnectionEnds,h=[],p=this.currentNodeInfo.id,g=(this._client,this._selectedAspect);for(i=void 0===t.srcSubCompId?this._ComponentID2GMEID[t.srcId]:this._Subcomponent2GMEID[t.srcId][t.srcSubCompId],r=s.getValidConnectionTypesFromSourceInAspect(i,p,g),e=r.length;e--;)s.canCreateChild(p,r[e])||r.splice(e,1);for(e=d.length;e--;)for(c=d[e],o=void 0===c.dstSubCompID?this._ComponentID2GMEID[c.dstItemID]:this._Subcomponent2GMEID[c.dstItemID][c.dstSubCompID],a=r.length,l=this._client.getNode(o);a--;)if(l&&l.isValidTargetOf(r[a],n.POINTER_TARGET)){h.push(d[e]);break}return h},p.prototype._onFilterReconnectionDroppableEnds=function(t){var e,n,i,o=t.connId,r=t.draggedEnd===a.CONNECTION_END_SRC,l=t.srcItemID,c=t.srcSubCompID,d=t.dstItemID,h=t.dstSubCompID,p=t.availableConnectionEnds,g=t.availableConnectionSources,u=[],f=this._ComponentID2GMEID[o];if(r===!0)for(i=void 0!==h?this._Subcomponent2GMEID[d][h]:this._ComponentID2GMEID[d],e=g.length;e--;)l=g[e].srcItemID,c=g[e].srcSubCompID,n=void 0!==c?this._Subcomponent2GMEID[l][c]:this._ComponentID2GMEID[l],s.isValidConnection(n,i,f)===!0&&u.push(g[e]);else for(i=void 0!==c?this._Subcomponent2GMEID[l][c]:this._ComponentID2GMEID[l],e=p.length;e--;)d=p[e].dstItemID,h=p[e].dstSubCompID,n=void 0!==h?this._Subcomponent2GMEID[d][h]:this._ComponentID2GMEID[d],s.isValidConnection(i,n,f)===!0&&u.push(p[e]);return u},p.prototype._onDragStartDesignerItemDraggable=function(){var t=!0;return t},p.prototype._onDragStartDesignerItemCopyable=function(t){var e=this._client.getNode(this._ComponentID2GMEID[t]),n=!0;return e&&(n="false"!==e.getAttribute("copy")),n},p.prototype._onDragStartDesignerConnectionCopyable=function(t){return this._onDragStartDesignerItemCopyable(t)},p.prototype._onSelectionRotated=function(t,e){for(var n,i,o,s,l,c=e.length,d=!0,h=!1;c--;)l=this._ComponentID2GMEID[e[c]],s=this._client.getNode(l),s&&(n=s.getEditableRegistry(r.ROTATION)||0,o=s.getOwnEditableRegistry(r.ROTATION),t===a.ROTATION_RESET?i=0:t===a.ROTATION_TOLEFT?i=n-n%90:t===a.ROTATION_TORIGHT?i=n%90>0?n+90-n%90:n:t===a.ROTATION_CLEAR?d=!1:i=(n+t)%360,d&&i!==o?(h||(h=!0,this._client.startTransaction()),this._client.setRegistry(l,r.ROTATION,i)):d||void 0===o||(h||(h=!0,this._client.startTransaction()),this._client.delRegistry(l,r.ROTATION)));h&&this._client.completeTransaction()},p.prototype._onSetConnectionProperty=function(t){var e,i,o=t.items,s=t.params,a=[],l=o.length,c=this._client;for(i=function(t,e,n){s.hasOwnProperty(e)&&c.setRegistry(t,n,s[e])};l--;)e=this._ComponentID2GMEID[o[l]],e&&a.push(e);if(l=a.length,l>0){for(this._client.startTransaction();l--;)e=a[l],i(e,n.LINE_STYLE.START_ARROW,r.LINE_START_ARROW),i(e,n.LINE_STYLE.END_ARROW,r.LINE_END_ARROW),i(e,n.LINE_STYLE.TYPE,r.LINE_TYPE),i(e,n.LINE_STYLE.PATTERN,r.LINE_STYLE),i(e,n.LINE_STYLE.WIDTH,r.LINE_WIDTH),i(e,n.LINE_STYLE.LABEL_PLACEMENT,r.LINE_LABEL_PLACEMENT);this._client.completeTransaction()}},p.prototype._onCopy=function(){for(var t,e,n,i=[],s=this.designerCanvas.selectionManager.getSelectedElements(),a=s.length,l={project:this._client.getActiveProjectId(),items:[]};a--;)t=this._ComponentID2GMEID[s[a]],e={ID:t,Name:void 0,Position:void 0},n=this._client.getNode(t),n&&(e.Name=n.getAttribute(o.Attributes.name),e.Position=n.getRegistry(r.POSITION)),i.push(e);return l.items=i,l},p.prototype._onPaste=function(t){var e,n,i=this.currentNodeInfo.id,o={parentId:i},r=this._client.getActiveProjectId(),a=[],l=this._selectedAspect;if(i){try{t=JSON.parse(t)}catch(c){this.logger.error('Invalid clipboard data: "'+t+'"'),t=void 0}if(t&&t.project&&t.items)if(r!==t.project)alert("Trying to copy from project '"+t.project+"' to project '"+r+"' which is not supported... Copy&Paste is supported in the same project only.");else if(_.isArray(t.items)){for(t=t.items,e=t.length;e--;)n=t[e],n&&n.ID&&(o[n.ID]={},a.push(n.ID));s.canCreateChildrenInAspect(i,a,l)?(this._client.startTransaction(),this._client.copyMoreNodes(o),this._client.completeTransaction(),this.logger.warn("Pasted "+a.length+" items successfully into node ("+i+")")):this.logger.warn("Can not paste items because not all the items on the clipboard can be created as a child of the currently opened node ("+i+")")}}},p.prototype._getDragItems=function(t){for(var e=[],n=t.length;n--;)e.push(this._ComponentID2GMEID[t[n]]);return e},p.prototype._getDragParams=function(t,e){var n,i=this._oGetDragParams.call(this.designerCanvas,t,e),o={positions:{},parentID:this.currentNodeInfo.id};for(n in i.positions)i.positions.hasOwnProperty(n)&&(o.positions[this._ComponentID2GMEID[n]]=i.positions[n]);return o},p.prototype._onSelectionContextMenu=function(t,e){var n,o,r,a={},l="connode",c="conmodel",p="metaRulesNode",g="metaRulesModel",u="editReplaceable",f="exportModels",m="importModels",_=!1,b=this;if(1===t.length)a[i.LOCATE_NODE]={name:"Locate in tree browser",doNotHide:!0,icon:"glyphicon glyphicon-screenshot"},s.isReplaceable(b._ComponentID2GMEID[t[0]])&&(a[u]={name:"Replace base ...",icon:"glyphicon glyphicon-transfer"}),a[p]={name:"Check Meta rules for node",icon:"glyphicon glyphicon-ok-sign"},a[g]={name:"Check Meta rules for node and its children",icon:"glyphicon glyphicon-ok-sign"},b._client.gmeConfig.core.enableCustomConstraints===!0&&(a[l]={name:"Check Custom Constraints for node",icon:"glyphicon glyphicon-fire"},a[c]={name:"Check Custom Constraints for node and its children",icon:"glyphicon glyphicon-fire"}),n=b._client.getNode(b._ComponentID2GMEID[t[0]]),n.isLibraryElement()===!1&&n.isLibraryRoot()===!1&&(a[f]={name:"Export selected model",icon:"glyphicon glyphicon-export"},a[m]={name:"Import models into",icon:"glyphicon glyphicon-import"});else if(t.length>1){for(a[p]={name:"Check Meta rules for nodes",icon:"glyphicon glyphicon-ok-sign"},a[g]={name:"Check Meta rules for nodes and their children",icon:"glyphicon glyphicon-ok-sign"},b._client.gmeConfig.core.enableCustomConstraints===!0&&(a[l]={name:"Check Custom Constraints for nodes",icon:"glyphicon glyphicon-fire"},a[c]={name:"Check Custom Constraints for nodes and their children",icon:"glyphicon glyphicon-fire"}),o=0;o<t.length;o+=1)if(n=b._client.getNode(b._ComponentID2GMEID[t[o]]),n.isLibraryElement()||n.isLibraryRoot()){_=!0;break}_===!1&&(a[f]={name:"Export selected models",icon:"glyphicon glyphicon-export"})}this.designerCanvas.createMenu(a,function(e){if(e===l)b._nodeConCheck(t,!1);else if(e===c)b._nodeConCheck(t,!0);else if(e===p)b._metaRulesCheck(t,!1);else if(e===g)b._metaRulesCheck(t,!0);else if(e===i.LOCATE_NODE)b._client.dispatchEvent(i.LOCATE_NODE,{nodeId:b._ComponentID2GMEID[t[0]]});else if(e===u)b._replaceBaseDialog(b._ComponentID2GMEID[t[0]]);else if(e===f){for(r=[],o=0;o<t.length;o+=1)r.push(b._ComponentID2GMEID[t[o]]);d.exportModels(b._client,b.logger,r)}else if(e===m){var n=new h(b._client,b.logger.fork("ImportModel"));n.show(b._ComponentID2GMEID[t[0]])}},this.designerCanvas.posToPageXY(e.mX,e.mY))},p.prototype._replaceBaseDialog=function(t){var e;"string"==typeof t&&this._client.getNode(t)&&(e=new c,e.show({client:this._client,nodeId:t}))},p.prototype._onSelectionAlignMenu=function(t,e){var n=this.designerCanvas.posToPageXY(e.mX,e.mY),i=this;this._alignMenu.show(t,n,function(e){i._onAlignSelection(t,e)})},p.prototype._metaRulesCheck=function(t,e){for(var n=t.length,i=[];n--;)i.push(this._ComponentID2GMEID[t[n]]);i.length>0&&this._client.checkMetaRules(i,e)},p.prototype._nodeConCheck=function(t,e){for(var n=t.length,i=[];n--;)i.push(this._ComponentID2GMEID[t[n]]);i.length>0&&this._client.checkCustomConstraints(i,e)},p.prototype._onSelectionFillColorChanged=function(t,e){this._onSelectionSetColor(t,e,r.COLOR)},p.prototype._onSelectionBorderColorChanged=function(t,e){this._onSelectionSetColor(t,e,r.BORDER_COLOR)},p.prototype._onSelectionTextColorChanged=function(t,e){this._onSelectionSetColor(t,e,r.TEXT_COLOR)},p.prototype._onSelectionSetColor=function(t,e,n){var i,o=t.length;for(this._client.startTransaction();o--;)i=this._ComponentID2GMEID[t[o]],e?this._client.setRegistry(i,n,e):this._client.delRegistry(i,n);this._client.completeTransaction()},p.prototype._onSelectedTabChanged=function(t){this._aspects[t]&&this._selectedAspect!==this._aspects[t]&&(this._selectedAspect=this._aspects[t],this.logger.debug("selectedAspectChanged: "+this._selectedAspect),this._initializeSelectedAspect(t))},p.prototype._onAlignSelection=function(t,e){var i,o,s=[],a=[],l=this.currentNodeInfo.id,c=this;t.forEach(function(t){var e,n=c._ComponentID2GMEID[t];c._GMEModels.indexOf(n)>-1&&(e=c._getObjectDescriptor(n),e?s.push(e):c.logger.warn("_onAlignSelection, could not get objectDescriptor for a selectedIds",n))}),0!==s.length&&(0===e.indexOf("MOVE_TO_")?(c._GMEModels.forEach(function(t){var e=c._getObjectDescriptor(t);e?a.push(e):c.logger.warn("_onAlignSelection, could not get objectDescriptor for a _GMEModels",t)}),i=c._alignMenu.getExtremePosition(a,e)):i=s[0],i&&(o=c._alignMenu.isXAxisType(e),this._client.startTransaction(),s.forEach(function(t){var e=t.position;i.id!==t.id&&(o===!0?e.x=i.position.x:e.y=i.position.y,c._selectedAspect===n.ASPECT_ALL?c._client.setRegistry(t.id,r.POSITION,e):(c._client.addMember(l,t.id,c._selectedAspect),c._client.setMemberRegistry(l,t.id,c._selectedAspect,r.POSITION,e)))}),this._client.completeTransaction()))},p}),define("js/Panels/ModelEditor/ModelEditorControl",["js/logger","js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","./ModelEditorControl.DiagramDesignerWidgetEventHandlers","js/Utils/GMEConcepts","js/Utils/GMEVisualConcepts","js/Utils/PreferencesHelper","js/Controls/AlignMenu","js/Utils/ComponentSettings"],function(t,e,n,i,o,r,s,a,l,c,d){"use strict";var h,p="#DEDEDE",g=30,u="ModelDecorator",f="DiagramDesigner",m=e.POINTER_SOURCE,b=e.POINTER_TARGET;return h=function(n,i){if(this.logger=n.logger||t.create(n.loggerName||"gme:Panels:ModelEditor:ModelEditorControl",WebGMEGlobal.gmeConfig.client.log),this._client=n.client,this._config=h.getDefaultConfig(),d.resolveWithWebGMEGlobal(this._config,h.getComponentId()),this._firstLoad=!1,this._topNode=e.PROJECT_ROOT_ID,this.designerCanvas=n.widget,this._alignMenu=new c(this.designerCanvas.CONSTANTS,{}),void 0===this._client)throw this.logger.error("ModelEditorControl's client is not specified..."),"ModelEditorControl can not be created";if(void 0===this.designerCanvas)throw this.logger.error("ModelEditorControl's DesignerCanvas is not specified..."),"ModelEditorControl can not be created";this._selfPatterns={},this._GMEID2ComponentID=this._GmeID2ComponentID={},this._ComponentID2GMEID=this._ComponentID2GmeID={},this.eventQueue=[],this._componentIDPartIDMap={},this.___SLOW_CONN=!1,this.currentNodeInfo={id:null,children:[],parentId:null},this.attachDiagramDesignerWidgetEventHandlers(),this._updateTopNode(),this.logger.debug("ModelEditorControl ctor finished")},h.prototype.selectedObjectChanged=function(t){var n,i,o,r=this;if(this.logger.debug('activeObject "'+t+'"'),this.designerCanvas.clear(),this._GMEModels=[],this._GMEConnections=[],this._GMEID2ComponentID=this._GmeID2ComponentID={},this._ComponentID2GMEID=this._ComponentID2GmeID={},this._GMEID2Subcomponent={},this._Subcomponent2GMEID={},this._territoryId&&this._client.removeUI(this._territoryId),this.currentNodeInfo.id=t,this.currentNodeInfo.parentId=void 0,this._delayedConnections=[],this._selectedAspect=WebGMEGlobal.State.getActiveAspect(),t||t===e.PROJECT_ROOT_ID){if(n=this._getObjectDescriptor(t),i=n&&n.name||" ",n&&(this.currentNodeInfo.parentId=n.parentId),this._refreshBtnModelHierarchyUp(),o=this._client.getNode(t),this._selectedAspect!==e.ASPECT_ALL){var s=o?o.getValidAspectNames():[];-1===s.indexOf(this._selectedAspect)&&(this.logger.warn('The currently selected aspect "'+this._selectedAspect+'" does not exist in the object "'+i+" ("+t+')", falling back to "All"'),this._selectedAspect=e.ASPECT_ALL,WebGMEGlobal.State.registerActiveAspect(e.ASPECT_ALL))}this._selfPatterns={},this._selectedAspect===e.ASPECT_ALL?this._selfPatterns[t]={children:2}:(this._selfPatterns[t]=this._client.getAspectTerritoryPattern(t,this._selectedAspect),this._selfPatterns[t].children=2),this._firstLoad=!0,this.designerCanvas.setTitle(i),this.designerCanvas.setBackgroundText(i,{"font-size":g,color:p}),!o||this._client.isProjectReadOnly()||this._client.isCommitReadOnly()||(this.designerCanvas.setReadOnly(o.isLibraryRoot()||o.isLibraryElement()),this.setReadOnly(o.isLibraryRoot()||o.isLibraryElement())),this.designerCanvas.showProgressbar(),this._territoryId=this._client.addUI(this,function(t){r._eventCallback(t)}),this._client.updateTerritory(this._territoryId,this._selfPatterns)}else this.designerCanvas.setBackgroundText("No object to display",{color:p,"font-size":g})},h.prototype._getObjectDescriptor=function(t){var n,o,r,l,c=this._client.getNode(t),d=0;if(c){if(n={},n.id=c.getId(),n.name=c.getFullyQualifiedName(),n.parentId=c.getParentId(),c.isLibraryRoot())return n;if(t!==this.currentNodeInfo.id)if(s.isConnection(t))n.connectionChanged=this._GMEModels.indexOf(t)>-1&&-1===this._GMEConnections.indexOf(t),n.kind="CONNECTION",n.source=c.getPointer(m).to,n.target=c.getPointer(b).to,_.extend(n,a.getConnectionVisualProperties(t)),(n.srcText||n.dstText)&&delete n.name,r=c.getRegistry(i.LINE_CUSTOM_POINTS),r&&_.isArray(r)&&(n[e.LINE_STYLE.CUSTOM_POINTS]=$.extend(!0,[],r));else{if(n.kind="MODEL",n.connectionChanged=-1===this._GMEModels.indexOf(t)&&this._GMEConnections.indexOf(t)>-1,this._selectedAspect===e.ASPECT_ALL)o=c.getRegistry(i.POSITION);else{l=this._client.getNode(this.currentNodeInfo.id);try{o=l.getMemberRegistry(this._selectedAspect,t,i.POSITION)}catch(h){if("CoreIllegalOperationError"!==h.name)throw h}o=o||c.getRegistry(i.POSITION)}o?n.position={x:o.x,y:o.y}:n.position={x:d,y:d},n.position.hasOwnProperty("x")?n.position.x=this._getDefaultValueForNumber(n.position.x,d):n.position.x=d,n.position.hasOwnProperty("y")?n.position.y=this._getDefaultValueForNumber(n.position.y,d):n.position.y=d,n.decorator=c.getRegistry(i.DECORATOR)||"",n.rotation=parseInt(c.getRegistry(i.ROTATION),10)||0}}return n},h.prototype._getDefaultValueForNumber=function(t,e){return _.isNumber(t)?_.isNaN(t)?e:t:e},h.prototype._eventCallback=function(t){var e,n=t?t.length:0;this.logger.debug('_eventCallback "'+n+'" items'),n>0&&(this.eventQueue.push(t),e=this.processNextInQueue()),this.logger.debug('_eventCallback "'+t.length+'" items - DONE'),e===!0&&this.selectedObjectChanged(this.currentNodeInfo.id)},h.prototype.processNextInQueue=function(){var t,n,i=this.eventQueue.length,o=[u],r=!1,s=this;if(i>0){for(t=this.eventQueue.pop(),i=t.length;i--;)(t[i].etype===e.TERRITORY_EVENT_LOAD||t[i].etype===e.TERRITORY_EVENT_UPDATE)&&(t[i].desc=this._getObjectDescriptor(t[i].eid),r=r||t[i].desc.connectionChanged===!0,n=t[i].desc.decorator,n&&""!==n&&-1===o.indexOf(n)&&o.pushUnique(n));this._client.decoratorManager.download(o,f,function(){s._dispatchEvents(t)})}return r},h.prototype._dispatchEvents=function(t){var n,i,o,r,s,a,l,c,d,h,p,g,u,f,m=t.length,_=!1,b=this,y=999999999;if(this.logger.debug("_dispatchEvents "+t[0].etype),t.shift(),this.logger.debug('_dispatchEvents "'+m+'" items'),i=[],o=[],this._delayedConnections&&this._delayedConnections.length>0)for(m=0;m<this._delayedConnections.length;m+=1)o.push({etype:e.TERRITORY_EVENT_LOAD,eid:this._delayedConnections[m],desc:this._getObjectDescriptor(this._delayedConnections[m])});for(this._delayedConnections=[],r=[],m=t.length;m--;)if(n=t[m],n.etype===e.TERRITORY_EVENT_UNLOAD)r.push(n);else if("MODEL"===n.desc.kind)i.push(n);else if("CONNECTION"===n.desc.kind)if(n.desc.parentId===this.currentNodeInfo.id){for(s=n.desc.source,a=n.desc.target,l=-1,c=-1,d=o.length;d--&&(h=o[d],h.id===s?l=d:h.id===a&&(c=d),-1===l||-1===c););for(p=Math.max(l,c),u=y,f=y,d=o.length;d--&&(h=o[d],n.desc.id===h.desc.source?u=d:n.desc.id===h.desc.target&&(f=d),u===y||f===y););g=Math.min(u,f),-1===p&&g===y?o.push(n):-1!==p&&g===y?o.splice(p+1,0,n):-1===p&&g!==y?o.splice(g,0,n):-1!==p&&g!==y&&o.splice(g,0,n)}else i.push(n);else this.currentNodeInfo.id===n.eid&&i.push(n);for(t=r.concat(i),m=t.length,this._notifyPackage={},this.designerCanvas.beginUpdate(),m=0;m<t.length;m+=1)switch(n=t[m],n.etype){case e.TERRITORY_EVENT_LOAD:_=this._onLoad(n.eid,n.desc)||_;break;case e.TERRITORY_EVENT_UPDATE:this._onUpdate(n.eid,n.desc);break;case e.TERRITORY_EVENT_UNLOAD:_=this._onUnload(n.eid)||_}for(this._handleDecoratorNotification(),t=o,m=t.length,m=0;m<t.length;m+=1)switch(n=t[m],n.etype){case e.TERRITORY_EVENT_LOAD:this._onLoad(n.eid,n.desc);break;case e.TERRITORY_EVENT_UPDATE:this._onUpdate(n.eid,n.desc);break;case e.TERRITORY_EVENT_UNLOAD:this._onUnload(n.eid)}if(this.designerCanvas.endUpdate(),this.designerCanvas.hideProgressbar(),_&&(this.___SLOW_CONN===!0?setTimeout(function(){b.logger.debug("Updating territory with ruleset from decorators: "+JSON.stringify(b._selfPatterns)),b._client.updateTerritory(b._territoryId,b._selfPatterns)},2e3):(this.logger.debug("Updating territory with ruleset from decorators: "+JSON.stringify(this._selfPatterns)),this._client.updateTerritory(this._territoryId,this._selfPatterns))),this._firstLoad===!0){this._firstLoad=!1;var v=WebGMEGlobal.State.getActiveSelection();if(v&&v.length>0){m=v.length;for(var C,E=[];m--;)C=v[m],this._GMEID2ComponentID[C]&&(E=E.concat(this._GMEID2ComponentID[C]));this.designerCanvas.select(E)}}this.logger.debug('_dispatchEvents "'+t.length+'" items - DONE'),this.processNextInQueue()},h.prototype._getItemDecorator=function(t){var e;return e=this._client.decoratorManager.getDecoratorForWidget(t,f),e||(e=this._client.decoratorManager.getDecoratorForWidget(u,f)),e},h.prototype._onLoad=function(t,n){var i,o,r,s,a,c,d,h=[],p=[],g=!1,u=this;if(s=function(t){var e,n;if(t&&(e=t.getTerritoryQuery()))for(n in e)e.hasOwnProperty(n)&&(u._selfPatterns[n]=e[n],g=!0)},this.currentNodeInfo.id!==t){if(n)if(n.parentId===this.currentNodeInfo.id){if(r=_.extend({},n),this._GMEID2ComponentID[t]=[],"MODEL"===r.kind&&(this._GMEModels.push(t),o=this._getItemDecorator(r.decorator),r.decoratorClass=o,r.control=this,r.metaInfo={},r.metaInfo[e.GME_ID]=t,r.preferencesHelper=l.getPreferences(),r.aspect=this._selectedAspect,i=this.designerCanvas.createDesignerItem(r),this._GMEID2ComponentID[t].push(i.id),this._ComponentID2GMEID[i.id]=t,s(i._decoratorInstance)),"CONNECTION"===r.kind)if(this._GMEConnections.push(t),a=this._getAllSourceDestinationPairsForConnection(r.source,r.target),h=a.sources,p=a.destinations,c=h.length,d=p.length,c>0&&d>0)for(;c--;)for(;d--;)r.srcObjId=h[c].objId,r.srcSubCompId=h[c].subCompId,r.dstObjId=p[d].objId,r.dstSubCompId=p[d].subCompId,r.reconnectable=!0,r.editable=!0,delete r.source,delete r.target,_.extend(r,this.getConnectionDescriptor(t)),i=this.designerCanvas.createConnection(r),this.logger.debug("Connection: "+i.id+" for GME object: "+r.id),this._GMEID2ComponentID[t].push(i.id),this._ComponentID2GMEID[i.id]=t;else this._delayedConnections.push(t)}else this._checkComponentDependency(t,e.TERRITORY_EVENT_LOAD)}else this._updateSheetName(n.name),this._updateAspects();return g},h.prototype._onUpdate=function(t,n){var i,o,r,s,a,c,d,h,p;if(t===this.currentNodeInfo.id)this._updateSheetName(n.name),this._updateAspects();else if(n)if(n.parentId===this.currentNodeInfo.id){if("MODEL"===n.kind&&this._GMEID2ComponentID[t])for(o=this._GMEID2ComponentID[t].length;o--;)i=this._GMEID2ComponentID[t][o],r=this._getItemDecorator(n.decorator),n.decoratorClass=r,n.preferencesHelper=l.getPreferences(),n.aspect=this._selectedAspect,this.designerCanvas.updateDesignerItem(i,n);if(-1!==this._GMEConnections.indexOf(t)){for(o=this._GMEID2ComponentID[t].length,s=this._getAllSourceDestinationPairsForConnection(n.source,n.target),a=s.sources,c=s.destinations,d=a.length,h=c.length,o-=1,d=a.length-1;d>=0;d-=1)for(h=c.length-1;h>=0;h-=1)n.srcObjId=a[d].objId,n.srcSubCompId=a[d].subCompId,n.dstObjId=c[h].objId,n.dstSubCompId=c[h].subCompId,n.reconnectable=!0,n.editable=!0,delete n.source,delete n.target,o>=0?(i=this._GMEID2ComponentID[t][o],_.extend(n,this.getConnectionDescriptor(t)),this.designerCanvas.updateConnection(i,n),o-=1):(this.logger.warn("Updating connections...Existing connections are less than the needed src-dst combo..."),_.extend(n,this.getConnectionDescriptor(t)),p=this.designerCanvas.createConnection(n),this.logger.debug("Connection: "+p.id+" for GME object: "+n.id),this._GMEID2ComponentID[t].push(p.id),this._ComponentID2GMEID[p.id]=t);if(o>=0)for(o+=1;o--;)i=this._GMEID2ComponentID[t][o],this.designerCanvas.deleteComponent(i),this._GMEID2ComponentID[t].splice(o,1),delete this._ComponentID2GMEID[i]}}else this._checkComponentDependency(t,e.TERRITORY_EVENT_UPDATE)},h.prototype._updateSheetName=function(t){this.designerCanvas.setTitle(t),this.designerCanvas.setBackgroundText(t,{"font-size":g,color:p})},h.prototype._onUnload=function(t){var n,i,o,r=this,s=!1;if(o=function(t){var e,n;if(t&&(e=t.getTerritoryQuery()))for(n in e)e.hasOwnProperty(n)&&(delete r._selfPatterns[n],s=!0)},t===this.currentNodeInfo.id)this.logger.debug('The previously opened model does not exist... --- GMEID: "'+this.currentNodeInfo.id+'"'),this.designerCanvas.setBackgroundText("The previously opened model does not exist...",{"font-size":g,color:p});else if(this._GMEID2ComponentID.hasOwnProperty(t)){for(i=this._GMEID2ComponentID[t].length;i--;)n=this._GMEID2ComponentID[t][i],-1!==this.designerCanvas.itemIds.indexOf(n)&&o(this.designerCanvas.items[n]._decoratorInstance),this.designerCanvas.deleteComponent(n),delete this._ComponentID2GMEID[n];delete this._GMEID2ComponentID[t]}else this._checkComponentDependency(t,e.TERRITORY_EVENT_UNLOAD);return s},h.prototype.destroy=function(){this._detachClientEventListeners(),this._removeToolbarItems(),this._client.removeUI(this._territoryId)},h.prototype._onModelHierarchyUp=function(){var t=this.currentNodeInfo.id;(this.currentNodeInfo.parentId||this.currentNodeInfo.parentId===e.PROJECT_ROOT_ID)&&(WebGMEGlobal.State.registerActiveObject(this.currentNodeInfo.parentId),WebGMEGlobal.State.registerActiveSelection([t]))},h.prototype._removeConnectionSegmentPoints=function(){var t,e=this.designerCanvas.selectionManager.getSelectedElements(),n=e.length;for(this._client.startTransaction();n--;)-1!==this.designerCanvas.connectionIds.indexOf(e[n])&&(t=this._client.getNode(this._ComponentID2GMEID[e[n]]),t&&this._client.delRegistry(t.getId(),i.LINE_CUSTOM_POINTS));this._client.completeTransaction()},h.prototype._getAllSourceDestinationPairsForConnection=function(t,e){var n,i=[],o=[];if(this._GMEID2ComponentID.hasOwnProperty(t))for(n=this._GMEID2ComponentID[t].length;n--;)i.push({objId:this._GMEID2ComponentID[t][n],subCompId:void 0});else if(this._GMEID2Subcomponent&&this._GMEID2Subcomponent.hasOwnProperty(t))for(n in this._GMEID2Subcomponent[t])this._GMEID2Subcomponent[t].hasOwnProperty(n)&&i.push({objId:n,subCompId:this._GMEID2Subcomponent[t][n]});if(this._GMEID2ComponentID.hasOwnProperty(e))for(n=this._GMEID2ComponentID[e].length;n--;)o.push({objId:this._GMEID2ComponentID[e][n],subCompId:void 0
});else if(this._GMEID2Subcomponent&&this._GMEID2Subcomponent.hasOwnProperty(e))for(n in this._GMEID2Subcomponent[e])this._GMEID2Subcomponent[e].hasOwnProperty(n)&&o.push({objId:n,subCompId:this._GMEID2Subcomponent[e][n]});return{sources:i,destinations:o}},h.prototype.registerComponentIDForPartID=function(t,e){this._componentIDPartIDMap[t]=this._componentIDPartIDMap[t]||[],-1===this._componentIDPartIDMap[t].indexOf(e)&&this._componentIDPartIDMap[t].push(e)},h.prototype.unregisterComponentIDFromPartID=function(t,e){var n;this._componentIDPartIDMap&&this._componentIDPartIDMap[t]&&(n=this._componentIDPartIDMap[t].indexOf(e),-1!==n&&(this._componentIDPartIDMap[t].splice(n,1),0===this._componentIDPartIDMap[t].length&&delete this._componentIDPartIDMap[t]))},h.prototype._checkComponentDependency=function(t,e){var n;if(this._componentIDPartIDMap&&this._componentIDPartIDMap[t])for(n=this._componentIDPartIDMap[t].length;n--;)this._notifyPackage[this._componentIDPartIDMap[t][n]]=this._notifyPackage[this._componentIDPartIDMap[t][n]]||[],this._notifyPackage[this._componentIDPartIDMap[t][n]].push({id:t,event:e})},h.prototype._handleDecoratorNotification=function(){var t,e,n;for(t in this._notifyPackage)if(this._notifyPackage.hasOwnProperty(t)&&(this.logger.debug("NotifyPartDecorator: "+t+", componentIDs: "+JSON.stringify(this._notifyPackage[t])),this._GMEID2ComponentID.hasOwnProperty(t)))for(e=this._GMEID2ComponentID[t].length;e--;)n=this._GMEID2ComponentID[t][e],this.designerCanvas.notifyItemComponentEvents(n,this._notifyPackage[t])},h.prototype._stateActiveObjectChanged=function(t,e){this.currentNodeInfo&&this.currentNodeInfo.id===e?this.logger.debug("Disregarding activeObject changed when it is already the same."):this.selectedObjectChanged(e)},h.prototype._stateActiveSelectionChanged=function(t,e,n){var i=[],o=e?e.length:0;if(n.invoker!==this){for(;o--;)this._GMEID2ComponentID.hasOwnProperty(e[o])&&(i=i.concat(this._GMEID2ComponentID[e[o]]));this.designerCanvas.select(i)}},h.prototype._activeProjectChanged=function(){this._updateTopNode()},h.prototype._updateTopNode=function(){var t,e=this._client.getActiveProjectId();e&&(t=this._client.getActiveProjectName(),this._config.byProjectId.topNode.hasOwnProperty(e)?this._topNode=this._config.byProjectId.topNode[e]:this._config.byProjectName.topNode.hasOwnProperty(t)?this._topNode=this._config.byProjectName.topNode[t]:this._topNode=this._config.topNode)},h.prototype._attachClientEventListeners=function(){this._detachClientEventListeners(),WebGMEGlobal.State.on("change:"+e.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged,this),WebGMEGlobal.State.on("change:"+e.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged,this),WebGMEGlobal.State.on("change:"+e.STATE_ACTIVE_PROJECT_NAME,this._activeProjectChanged,this)},h.prototype._detachClientEventListeners=function(){WebGMEGlobal.State.off("change:"+e.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged),WebGMEGlobal.State.off("change:"+e.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged),WebGMEGlobal.State.off("change:"+e.STATE_ACTIVE_PROJECT_NAME,this._activeProjectChanged)},h.prototype.onActivate=function(){this._attachClientEventListeners(),this._displayToolbarItems(),this._selectedAspect&&WebGMEGlobal.State.registerActiveAspect(this._selectedAspect),this.currentNodeInfo&&"string"==typeof this.currentNodeInfo.id&&WebGMEGlobal.State.registerActiveObject(this.currentNodeInfo.id,{suppressVisualizerFromNode:!0})},h.prototype.onDeactivate=function(){this._detachClientEventListeners(),this._hideToolbarItems()},h.prototype._displayToolbarItems=function(){if(this._toolbarInitialized!==!0)this._initializeToolbar();else for(var t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].show();this._refreshBtnModelHierarchyUp()},h.prototype._hideToolbarItems=function(){if(this._toolbarInitialized===!0)for(var t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].hide()},h.prototype._removeToolbarItems=function(){if(this._toolbarInitialized===!0)for(var t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].destroy()},h.prototype._initializeToolbar=function(){var t=WebGMEGlobal.Toolbar,e=this;this._toolbarItems=[],this.$btnConnectionRemoveSegmentPoints=t.addButton({title:"Remove segment points",icon:"glyphicon glyphicon-remove-circle",clickFn:function(){e._removeConnectionSegmentPoints()}}),this._toolbarItems.push(this.$btnConnectionRemoveSegmentPoints),this.$btnConnectionRemoveSegmentPoints.enabled(!1),this.$btnModelHierarchyUp=t.addButton({title:"Go to parent",icon:"glyphicon glyphicon-circle-arrow-up",clickFn:function(){e._onModelHierarchyUp()}}),this._toolbarItems.push(this.$btnModelHierarchyUp),this.$btnModelHierarchyUp.enabled(!1),this._toolbarInitialized=!0},h.prototype.getNodeID=function(){return this.currentNodeInfo.id},h.prototype._refreshBtnModelHierarchyUp=function(){this.currentNodeInfo.id&&this.currentNodeInfo.id!==this._topNode?this.$btnModelHierarchyUp.enabled(!0):this.$btnModelHierarchyUp.enabled(!1)},h.prototype._updateAspects=function(){var t,n,i,o,r=this.currentNodeInfo.id,s=this._client.getNode(r),a=WebGMEGlobal.PanelManager.getActivePanel();if(this._aspects={},this.designerCanvas.clearTabs(),a&&a.control!==this||(this._selectedAspect=WebGMEGlobal.State.getActiveAspect()),r||r===e.PROJECT_ROOT_ID){for(t=s?s.getValidAspectNames():[],t.sort(function(t,e){var n=t.toLowerCase(),i=e.toLowerCase();return i>n?-1:1}),t.splice(0,0,e.ASPECT_ALL),this.designerCanvas.addMultipleTabsBegin(),i=0;i<t.length;i+=1)n=this.designerCanvas.addTab(t[i]),this._aspects[n]=t[i],this._selectedAspect&&this._selectedAspect===t[i]&&(o=n);this.designerCanvas.addMultipleTabsEnd()}if(!o)for(o in this._aspects)if(this._aspects.hasOwnProperty(o))break;if(this.designerCanvas.selectTab(o.toString()),this._selectedAspect!==e.ASPECT_ALL){var l=this._client.getAspectTerritoryPattern(r,this._selectedAspect),c=!1;this._selfPatterns[r].items&&l.items?(c=_.difference(this._selfPatterns[r].items,l.items).length>0,c===!1&&(c=_.difference(l.items,this._selfPatterns[r].items).length>0)):(this._selfPatterns[r].items||l.items)&&(c=!0),c&&this.selectedObjectChanged(r)}},h.prototype._initializeSelectedAspect=function(t){WebGMEGlobal.State.registerActiveAspect(this._selectedAspect),WebGMEGlobal.State.registerActiveTab(t),this.selectedObjectChanged(this.currentNodeInfo.id)},h.prototype.getConnectionDescriptor=function(){return{}},h.getDefaultConfig=function(){return{topNode:"",byProjectName:{topNode:{}},byProjectId:{topNode:{}}}},h.getComponentId=function(){return"GenericUIModelEditorControl"},_.extend(h.prototype,r.prototype),h}),define("js/Panels/ModelEditor/ModelEditorPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/ModelEditor/ModelEditorWidget","./ModelEditorControl"],function(t,e,n,i){"use strict";var o;return o=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="ModelEditorPanel",i[t.OPTIONS.FLOATING_TITLE]=!0,t.apply(this,[i,e]),this._client=n.client,this._initialize(),this.logger.debug("ModelEditorPanel ctor finished")},_.extend(o.prototype,t.prototype),_.extend(o.prototype,e.prototype),o.prototype._initialize=function(){var t=this;this.widget=new n(this.$el,{toolBar:this.toolBar}),this.widget.setTitle=function(e){t.setTitle(e)},this.widget.onUIActivity=function(){WebGMEGlobal.PanelManager.setActivePanel(t),WebGMEGlobal.KeyboardManager.setListener(t.widget)},this.control=new i({client:this._client,widget:this.widget}),this.control.setReadOnly=function(e){t.setReadOnly(e)},this.onActivate()},o.prototype.onReadOnlyChanged=function(e){t.prototype.onReadOnlyChanged.call(this,e),this.widget.setReadOnly(e)},o.prototype.onResize=function(t,e){this.logger.debug("onResize --> width: "+t+", height: "+e),this.widget.onWidgetContainerResize(t,e)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),t.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.getNodeID=function(){return this.control.getNodeID()},o}),define("css!js/Widgets/SetEditor/styles/SetEditorWidget",[],function(){}),define("js/Widgets/SetEditor/SetEditorWidget",["js/DragDrop/DragHelper","js/Widgets/DiagramDesigner/DiagramDesignerWidget","css!./styles/SetEditorWidget.css"],function(t,e){"use strict";var n,i="#FFCCFF",o=$('<i class="glyphicon glyphicon-exclamation-sign delete-set-tab"/>');return n=function(t,n){n=n||{},n.loggerName="gme:Widgets:SetEditor:SetEditorWidget",n.tabsEnabled=!0,n.addTabs=!1,n.deleteTabs=!0,n.reorderTabs=!1,n.lineStyleControls=!1,n.enableConnectionDrawing=!1,n.defaultConnectionRouteManagerType="basic",n.disableConnectionRendering=!0,e.call(this,t,n),this.logger.debug("SetEditorWidget ctor")},_.extend(n.prototype,e.prototype),n.prototype._initializeUI=function(){e.prototype._initializeUI.apply(this,arguments),this.logger.debug("SetEditorWidget._initializeUI"),this.$el.parent().addClass("set-editor-widget"),this._connectToConnection=!1},n.prototype._afterManagersInitialized=function(){this.enableRotate(!1)},n.prototype.getDragEffects=function(){return[t.DRAG_EFFECTS.DRAG_MOVE]},n.prototype._dragHelper=function(t,n,i){var o=e.prototype._dragHelper.apply(this,[t,n,i]);return o.html(""),o},n.prototype.setBackgroundText=function(t,n){n=n||{},n.color=n.color||i,e.prototype.setBackgroundText.apply(this,[t,n])},n.prototype._addTabDeleteBtn=function(t){var e=o.clone();e.attr("title","Remove meta-invalid set"),t.find("a").append(e)},n}),define("js/Panels/Crosscut/CrosscutConstants",[],function(){"use strict";return{CROSSCUT_NAME_PREFIX:"Crosscut_"}}),define("js/Panels/ControllerBase/DiagramDesignerWidgetMultiTabMemberListControllerBase",["js/logger","common/util/guid","js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Utils/GMEConcepts","js/Utils/GMEVisualConcepts","js/DragDrop/DragHelper","js/Utils/PreferencesHelper","js/Controls/AlignMenu"],function(t,e,n,i,o,r,s,a,l,c){"use strict";var d,h="ModelDecorator",p="DiagramDesigner",g=n.POINTER_SOURCE,u=n.POINTER_TARGET,f="DRAG_PARAMS_MULTI_TAB_MEMBER_LIST_CONTAINER_ID",m=o.POSITION;return d=function(e){var n=e.loggerName||"gme:Panels:ControllerBase:DiagramDesignerWidgetMultiTabMemberListControllerBase";if(this.logger=t.create(n,WebGMEGlobal.gmeConfig.client.log),this._client=e.client,this.disableConnectionRendering=e.disableConnectionRendering,this._widget=e.widget,this._alignMenu=new c(this._widget.CONSTANTS,{}),void 0===this._client)throw this.logger.error("DiagramDesignerWidgetMultiTabMemberListControllerBase's client is not specified..."),"DiagramDesignerWidgetMultiTabMemberListControllerBase can not be created";if(void 0===this._widget)throw this.logger.error("DiagramDesignerWidgetMultiTabMemberListControllerBase's widget is not specified..."),"DiagramDesignerWidgetMultiTabMemberListControllerBase can not be created";this._tabIDMemberListID={},this._memberListMembers={},this._memberListMemberCoordinates={},this._GMEID2ComponentID={},this._ComponentID2GMEID={},this._GMEID2Subcomponent={},this._Subcomponent2GMEID={},this._connectionWaitingListByDstGMEID={},this._connectionWaitingListBySrcGMEID={},this._connectionListBySrcGMEID={},this._connectionListByDstGMEID={},this._connectionListByID={},this._componentIDPartIDMap={},this._selectedMemberListMembers=[],this._delayedConnections=[],this._delayedConnectionsAsItems={},this._selectedMemberListMembersTerritoryPatterns={},this._notifyPackage={},this._attachDiagramDesignerWidgetEventHandlers(),this.logger.debug("DiagramDesignerWidgetMultiTabMemberListControllerBase ctor finished")},d.prototype._attachDiagramDesignerWidgetEventHandlers=function(){var t=this;this._widget.onSelectedTabChanged=function(e){t._onSelectedTabChanged(e)},this._widget.onBackgroundDroppableAccept=function(e,n){return t._onBackgroundDroppableAccept(e,n)},this._widget.onBackgroundDrop=function(e,n,i){t._onBackgroundDrop(e,n,i)},this._widget.getDragItems=function(e){return t._getDragItems(e)},this._oGetDragParams=this._widget.getDragParams,this._widget.getDragParams=function(e,n){return t._getDragParams(e,n)},this._widget.onSelectionDelete=function(e){t._onSelectionDelete(e)},this._widget.onTabTitleChanged=function(e,n,i){t._onTabTitleChanged(e,n,i)},this._widget.onTabsSorted=function(e){t._onTabsSorted(e)},this._widget.onTabDeleteClicked=function(e){t._onTabDeleteClicked(e)},this._widget.onTabAddClicked=function(){t._onTabAddClicked()},this._widget.onSelectionChanged=function(e){t._onSelectionChanged(e)},this._widget.onSelectionFillColorChanged=function(e,n){t._onSelectionSetColor(e,n,o.COLOR)},this._widget.onSelectionBorderColorChanged=function(e,n){t._onSelectionSetColor(e,n,o.BORDER_COLOR)},this._widget.onSelectionTextColorChanged=function(e,n){t._onSelectionSetColor(e,n,o.TEXT_COLOR)},this._widget.onConnectionSegmentPointsChange=function(e){t._onConnectionSegmentPointsChange(e)},this._widget.onRegisterSubcomponent=function(e,n,i){t._onRegisterSubcomponent(e,n,i)},this._widget.onUnregisterSubcomponent=function(e,n){t._onUnregisterSubcomponent(e,n)},this._widget.onSelectionAlignMenu=function(e,n){t._onSelectionAlignMenu(e,n)},this._widget.onAlignSelection=function(e,n){t._onAlignSelection(e,n)},this._widget.onDesignerItemsMove=function(e){t._onDesignerItemsMove(e)}},d.prototype.selectedObjectChanged=function(t){var e,i=this;this.logger.debug('activeObject nodeId "'+t+'"'),this._widget.clear(),this._territoryId&&(this._client.removeUI(this._territoryId),this._selectedMemberListMembersTerritoryId&&this._client.removeUI(this._selectedMemberListMembersTerritoryId),this._widget.clearTabs()),t=this._validateNodeId(t),this._memberListContainerID=t,this._selectedMemberListID=void 0,t||t===n.PROJECT_ROOT_ID?(e={},e[t]={children:0},this._widget.showProgressbar(),this._territoryId=this._client.addUI(this,function(){i._processMemberListContainer(),i._widget.hideProgressbar()}),this._client.updateTerritory(this._territoryId,e)):this._widget.setBackgroundText("No object to display...")},d.prototype._validateNodeId=function(t){return t===n.PROJECT_ROOT_ID&&(t=void 0),t},d.prototype._stateActiveObjectChanged=function(t,e){this._memberListContainerID===e?this.logger.debug("Disregarding activeObject changed when it is already the same."):this.selectedObjectChanged(e)},d.prototype._stateActiveTabChanged=function(t,e){this._tabIDMemberListID&&this._selectedMemberListID!==this._tabIDMemberListID[e]&&this._widget.selectTab(e+"")},d.prototype._stateActiveSelectionChanged=function(t,e,n){var i=[],o=e?e.length:0;if(n.invoker!==this){for(;o--;)this._GMEID2ComponentID.hasOwnProperty(e[o])&&(i=i.concat(this._GMEID2ComponentID[e[o]]));this._widget.select(i)}},d.prototype._attachClientEventListeners=function(){this._detachClientEventListeners(),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged,this),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged,this),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_TAB,this._stateActiveTabChanged,this)},d.prototype._detachClientEventListeners=function(){WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged),WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged),WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_TAB,this._stateActiveTabChanged)},d.prototype.onActivate=function(){this._attachClientEventListeners(),this._displayToolbarItems(),"string"==typeof this._memberListContainerID&&WebGMEGlobal.State.registerActiveObject(this._memberListContainerID,{suppressVisualizerFromNode:!0})},d.prototype.onDeactivate=function(){this._detachClientEventListeners(),this._hideToolbarItems()},d.prototype._displayToolbarItems=function(){var t;if(this._toolbarInitialized===!0)for(t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].show();else this._initializeToolbar()},d.prototype._hideToolbarItems=function(){var t;if(this._toolbarInitialized===!0)for(t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].hide()},d.prototype._removeToolbarItems=function(){var t;if(this._toolbarInitialized===!0)for(t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].destroy()},d.prototype._initializeToolbar=function(){this._toolbarItems=[],this._toolbarInitialized=!0},d.prototype.setReadOnly=function(){},d.prototype.destroy=function(){this._detachClientEventListeners(),this._removeToolbarItems(),this._client.removeUI(this._territoryId),this._selectedMemberListMembersTerritoryId&&this._client.removeUI(this._selectedMemberListMembersTerritoryId)},d.prototype._processMemberListContainer=function(){var t,e,n,i,o,r,s,a,l,c,d=this._client.getNode(this._memberListContainerID);if(this.logger.debug("_processMemberListContainer"),this._widget.clearTabs(),this._tabIDMemberListID={},this._memberListMembers={},this._memberListMemberCoordinates={},d)if(this._displayContainerObjectName(),t=this.getOrderedMemberListInfo(d)||[],t.length>0){for(this._widget.addMultipleTabsBegin(),e=0;e<t.length;e+=1){for(o=t[e].memberListID,r=t[e].title,s=t[e].enableDeleteTab&&!0,a=t[e].enableRenameTab&&!0,n=this._widget.addTab(r,s,a),this._tabIDMemberListID[n]=o,this._memberListMembers[o]=d.getMemberIds(o),this._memberListMemberCoordinates[o]={},l=this._memberListMembers[o].length;l--;)c=this._memberListMembers[o][l],this._memberListMemberCoordinates[o][c]=d.getMemberRegistry(o,c,m);this._selectedMemberListID&&this._selectedMemberListID===o&&(i=n)}if(this._widget.addMultipleTabsEnd(),!i&&null!==WebGMEGlobal.State.getActiveTab()&&void 0!==WebGMEGlobal.State.getActiveTab()&&WebGMEGlobal.State.getActiveTab()<Object.keys(this._tabIDMemberListID).length&&(i=WebGMEGlobal.State.getActiveTab()),!i)for(i in this._tabIDMemberListID)if(this._tabIDMemberListID.hasOwnProperty(i))break;this._widget.selectTab(i),this._updateSelectedMemberListMembersTerritoryPatterns()}else this.displayNoTabMessage()},d.prototype._updateSelectedMemberListMembersTerritoryPatterns=function(){var t,e,n,i,o=(this._selectedMemberListMembers||[]).slice(0),s=(this._memberListMembers[this._selectedMemberListID]||[]).slice(0),a=!1,l=this._selectedMemberListMembersTerritoryId,c=this._selectedMemberListMembersTerritoryPatterns,d=this._client;for(t=_.difference(o,s),e=t.length;e--;)delete c[t[e]],a=!0;for(t=_.difference(s,o),e=t.length;e--;)c[t[e]]={children:0},a=!0;for(t=_.intersection(s,o),e=t.length,this._widget.beginUpdate();e--;)this.disableConnectionRendering||r.isConnection(t[e])===!1?this._onUpdate(t[e],{isConnection:!1}):this._delayedConnectionsAsItems[t[e]]?this._onUpdate(t[e],{isConnection:!1}):(n={isConnection:!0},i=d.getNode(t[e]),i&&(n.srcID=i.getPointer(g).to,n.dstID=i.getPointer(u).to,this._onUpdate(t[e],n)));this._widget.endUpdate(),this._selectedMemberListMembers=s,a&&setTimeout(function(){d.updateTerritory(l,c)},10)},d.prototype.getOrderedMemberListInfo=function(t){return void this.logger.warn('DiagramDesignerWidgetMultiTabMemberListControllerBase.getOrderedMemberListInfo(memberListContainerObject) is not overridden for object "'+t+'", returning default...')},d.prototype.getMemberListSetsRegistryKey=function(){return void this.logger.warn("DiagramDesignerWidgetMultiTabMemberListControllerBase.getMemberListSetsRegistryKey is not overridden, returning default value...")},d.prototype._onSelectedTabChanged=function(t){this._tabIDMemberListID[t]&&this._selectedMemberListID!==this._tabIDMemberListID[t]&&(this._selectedMemberListID=this._tabIDMemberListID[t],this.logger.debug("_selectedMemberListID changed to : "+this._selectedMemberListID),this._initializeSelectedMemberList(),WebGMEGlobal.State.registerActiveTab(t))},d.prototype._getDragParams=function(t,e){var n,i=this._oGetDragParams.call(this._widget,t,e),o={positions:{}};o[f]=this._getDragParamsDataID();for(n in i.positions)i.positions.hasOwnProperty(n)&&(o.positions[this._ComponentID2GMEID[n]]=i.positions[n]);return o},d.prototype._getDragItems=function(t){for(var e=[],n=t.length;n--;)e.push(this._ComponentID2GMEID[t[n]]);return e},d.prototype._getDragParamsDataID=function(){return this._memberListContainerID+this._selectedMemberListID},d.prototype._onBackgroundDroppableAccept=function(t,e){var n,i=a.getDragItems(e),o=a.getDragParams(e),r=a.getDragEffects(e),s=!1;if(this._selectedMemberListID)if(o&&o.hasOwnProperty(f)&&o[f]===this._getDragParamsDataID())s=!0;else if(1===r.length&&r[0]===a.DRAG_EFFECTS.DRAG_CREATE_INSTANCE)s=!1;else if(i.length>0)for(s=!0,n=0;n<i.length;n+=1){if(i[n]===this._memberListContainerID){s=!1;break}if(-1!==this._memberListMembers[this._selectedMemberListID].indexOf(i[n])){s=!1;break}}return s},d.prototype._onBackgroundDrop=function(t,e,n){var i,o,r,s,l=this._client,c=this._memberListContainerID,d=this._selectedMemberListID,h=a.getDragItems(e),p=a.getDragParams(e),g=[];if(p&&p.hasOwnProperty(f)&&p[f]===this._getDragParamsDataID()){l.startTransaction(),this._widget.beginUpdate();for(i in p.positions)p.positions.hasOwnProperty(i)&&(r=n.x+p.positions[i].x,s=n.y+p.positions[i].y,l.setMemberRegistry(c,i,d,m,{x:r,y:s}),o=this._GMEID2ComponentID[i][0],g.push(o),this._widget.updateDesignerItem(o,{position:{x:r,y:s}}));this._widget.endUpdate(),this._widget.select(g),l.completeTransaction()}else{if(l.startTransaction(),h.length>0)for(i=0;i<h.length;i+=1)o=h[i],-1===this._memberListMembers[d].indexOf(o)&&(r=n.x,s=n.y,p&&p.positions&&p.positions[o]?(r+=p.positions[o].x,s+=p.positions[o].y):(n.x+=20,n.y+=20),l.addMember(c,o,d),l.setMemberRegistry(c,o,d,m,{x:r,y:s}));l.completeTransaction()}},d.prototype._onSelectionDelete=function(t){var e,n,i=this._client,o=this._memberListContainerID,r=this._selectedMemberListID;for(i.startTransaction(),e=t.length;e--;)n=this._ComponentID2GMEID[t[e]],i.removeMember(o,n,r);i.completeTransaction()},d.prototype._initializeSelectedMemberList=function(){var t,e=this;if(this.logger.debug("_initializeSelectedMemberList"),this._widget.clear(),this._displayContainerObjectName(),this._GMEID2ComponentID={},this._ComponentID2GMEID={},this._GMEID2Subcomponent={},this._Subcomponent2GMEID={},this._connectionWaitingListByDstGMEID={},this._connectionWaitingListBySrcGMEID={},this._connectionListBySrcGMEID={},this._connectionListByDstGMEID={},this._connectionListByID={},this._componentIDPartIDMap={},this._selectedMemberListMembers=[],this._delayedConnections=[],this._delayedConnectionsAsItems={},this._selectedMemberListMembersTerritoryId&&this._client.removeUI(this._selectedMemberListMembersTerritoryId),this._selectedMemberListMembersTerritoryPatterns={},this._selectedMemberListID&&this._memberListMembers[this._selectedMemberListID])for(t=this._memberListMembers[this._selectedMemberListID].length,t>0&&this._widget.showProgressbar();t--;)this._selectedMemberListMembers.push(this._memberListMembers[this._selectedMemberListID][t]),this._selectedMemberListMembersTerritoryPatterns[this._memberListMembers[this._selectedMemberListID][t]]={children:0};this._selectedMemberListMembersTerritoryId=this._client.addUI(this,function(t){e._memberListTerritoryCallback(t)}),this._client.updateTerritory(this._selectedMemberListMembersTerritoryId,this._selectedMemberListMembersTerritoryPatterns)},d.prototype._memberListTerritoryCallback=function(t){for(var e,i,s=[h],a=t.length,l=this._client,c=this;a--;)(t[a].etype===n.TERRITORY_EVENT_LOAD||t[a].etype===n.TERRITORY_EVENT_UPDATE)&&(e=l.getNode(t[a].eid),t[a].desc={isConnection:!this.disableConnectionRendering&&r.isConnection(t[a].eid)},e&&(t[a].desc.isConnection===!0?(t[a].desc.srcID=e.getPointer(g).to,t[a].desc.dstID=e.getPointer(u).to):(i=e.getRegistry(o.DECORATOR),i&&""!==i||(i=h),-1===s.indexOf(i)&&s.pushUnique(i),t[a].desc.decorator=i)));l.decoratorManager.download(s,p,function(){c._dispatchEvents(t)})},d.prototype._dispatchEvents=function(t){var e,i,o,r,s,a,l,c,d,h,p,g=!1,u=[],f=[],m=999999999,_=m,b=m;for(this.logger.debug('_dispatchEvents "'+t.length+'" items: '+JSON.stringify(t)),this._widget.beginUpdate(),o=Object.keys(this._GMEID2ComponentID||{}),e=0;e<o.length;e+=1)this._widget.items[this._GMEID2ComponentID[o[e]]]&&this._widget.items[this._GMEID2ComponentID[o[e]]]._decoratorInstance&&this._widget.items[this._GMEID2ComponentID[o[e]]]._decoratorInstance.update();if(this._delayedConnections&&this._delayedConnections.length>0){for(e=t.length;e--;)if(i=t[e],i.etype===n.TERRITORY_EVENT_UNLOAD)for(o=this._delayedConnections.length;o--;)this._delayedConnections[o].ID===i.eid&&(this.logger.debug("Removing "+i.eid+" from delayed connections..."),this._delayedConnections.splice(o,1),this._widget.deleteComponent(this._delayedConnectionsAsItems[i.eid]),delete this._delayedConnectionsAsItems[i.eid]);else if(i.etype===n.TERRITORY_EVENT_UPDATE&&i.desc.isConnection===!0)for(o=this._delayedConnections.length;o--;)this._delayedConnections[o].ID===i.eid&&(this.logger.debug("Updating "+i.eid+" in delayed connections..."),this._delayedConnections[o].desc.srcID=i.desc.srcID,this._delayedConnections[o].desc.dstID=i.desc.dstID,t.splice(e,1));for(e=0;e<this._delayedConnections.length;e+=1)this._delayedConnections[e].desc.src&&this._delayedConnections[e].desc.dst&&(f.push({etype:n.TERRITORY_EVENT_LOAD,eid:this._delayedConnections[e].ID,desc:this._delayedConnections[e].desc}),this._widget.deleteComponent(this._delayedConnectionsAsItems[this._delayedConnections[e].ID]),delete this._delayedConnectionsAsItems[this._delayedConnections[e].ID])}for(this._delayedConnections=[],this._delayedConnectionsAsItems={},s=[],e=t.length;e--;)if(i=t[e],i.etype!==n.TERRITORY_EVENT_COMPLETE&&i.etype!==n.TERRITORY_EVENT_INCOMPLETE)if(i.etype===n.TERRITORY_EVENT_UNLOAD)s.push(i);else if(i.desc.isConnection===!1)u.push(i);else if(i.desc.isConnection===!0){for(a=i.desc.srcID,l=i.desc.dstID,c=-1,d=-1,o=f.length;o--&&(r=f[o],r.id===a?c=o:r.id===l&&(d=o),-1===c||-1===d););for(h=Math.max(c,d),o=f.length;o--&&(r=f[o],i.eid===r.desc.srcID?_=o:i.eid===r.desc.dstID&&(b=o),_===m||b===m););p=Math.min(_,b),-1===h&&p===m?f.push(i):-1!==h&&p===m?f.splice(h+1,0,i):-1===h&&p!==m?f.splice(p,0,i):-1!==h&&p!==m&&f.splice(p,0,i)}for(this._notifyPackage={},t=s.concat(u),e=0;e<t.length;e+=1)switch(i=t[e],i.etype){case n.TERRITORY_EVENT_LOAD:g=this._onLoad(i.eid,i.desc)||g;break;case n.TERRITORY_EVENT_UPDATE:this._onUpdate(i.eid,i.desc);break;case n.TERRITORY_EVENT_UNLOAD:g=this._onUnload(i.eid)||g}for(this._handleDecoratorNotification(),t=f,e=0;e<t.length;e+=1)switch(i=t[e],i.etype){case n.TERRITORY_EVENT_LOAD:this._onLoad(i.eid,i.desc);break;case n.TERRITORY_EVENT_UPDATE:this._onUpdate(i.eid,i.desc);break;case n.TERRITORY_EVENT_UNLOAD:this._onUnload(i.eid)}this._widget.endUpdate(),this._widget.hideProgressbar(),g&&(this.logger.debug("Updating territory with ruleset from decorators: "+JSON.stringify(this._selfPatterns)),this._client.updateTerritory(this._selectedMemberListMembersTerritoryId,this._selectedMemberListMembersTerritoryPatterns)),this.logger.debug('_dispatchEvents "'+t.length+'" items - DONE')},d.prototype._updateDecoratorTerritoryQuery=function(t,e){var n,i,o=this._selectedMemberListMembersTerritoryPatterns,r=!1;if(t&&(n=t.getTerritoryQuery()))for(i in n)n.hasOwnProperty(i)&&(e?delete o[i]:o[i]=n[i],r=!0);return r},d.prototype._getItemDecorator=function(t){var e;return e=this._client.decoratorManager.getDecoratorForWidget(t,p),e||(e=this._client.decoratorManager.getDecoratorForWidget(h,p)),e},d.prototype._getAllSourceDestinationPairsForConnection=function(t,e){var n,i=[],o=[];if(this._GMEID2ComponentID.hasOwnProperty(t))for(n=this._GMEID2ComponentID[t].length;n--;)i.push({objId:this._GMEID2ComponentID[t][n],subCompId:void 0});else if(this._GMEID2Subcomponent&&this._GMEID2Subcomponent.hasOwnProperty(t))for(n in this._GMEID2Subcomponent[t])this._GMEID2Subcomponent[t].hasOwnProperty(n)&&i.push({objId:n,subCompId:this._GMEID2Subcomponent[t][n]});if(this._GMEID2ComponentID.hasOwnProperty(e))for(n=this._GMEID2ComponentID[e].length;n--;)o.push({objId:this._GMEID2ComponentID[e][n],subCompId:void 0});else if(this._GMEID2Subcomponent&&this._GMEID2Subcomponent.hasOwnProperty(e))for(n in this._GMEID2Subcomponent[e])this._GMEID2Subcomponent[e].hasOwnProperty(n)&&o.push({objId:n,subCompId:this._GMEID2Subcomponent[e][n]});return{sources:i,destinations:o}},d.prototype._onLoad=function(t,e){var i,o,r,s,a,c,d,h,p={},g=[],u=[],f=!1;if(-1!==this._selectedMemberListMembers.indexOf(t)&&e.decorator)if(e.isConnection===!1)o=this._getItemDecorator(e.decorator),p.decoratorClass=o,p.control=this,p.metaInfo={},p.metaInfo[n.GME_ID]=t,p.position={x:100,y:100},this._memberListMemberCoordinates[this._selectedMemberListID]&&this._memberListMemberCoordinates[this._selectedMemberListID][t]&&(p.position.x=this._memberListMemberCoordinates[this._selectedMemberListID][t].x,p.position.y=this._memberListMemberCoordinates[this._selectedMemberListID][t].y),p.decoratorParams={},e.decoratorParams&&_.extend(p.decoratorParams,e.decoratorParams),p.preferencesHelper=l.getPreferences([{containerID:this._memberListContainerID,setID:this._selectedMemberListID}]),i=this._widget.createDesignerItem(p),this._GMEID2ComponentID[t]=this._GMEID2ComponentID[t]||[],this._GMEID2ComponentID[t].push(i.id),this._ComponentID2GMEID[i.id]=t,f=f||this._updateDecoratorTerritoryQuery(i._decoratorInstance,!1);else if(r=this._getAllSourceDestinationPairsForConnection(e.srcID,e.dstID),g=r.sources,u=r.destinations,s=g.length,a=u.length,c=this._getConnectionVisualProperties(t),s>0&&a>0)for(;s--;)for(;a--;)p={},_.extend(p,c),p.srcObjId=g[s].objId,p.srcSubCompId=g[s].subCompId,p.dstObjId=u[a].objId,p.dstSubCompId=u[a].subCompId,p.reconnectable=void 0===e.reconnectable?!1:e.reconnectable,p.editable=void 0===e.editable?!1:e.editable,delete p.source,delete p.target,i=this._widget.createConnection(p),this.logger.debug("Connection: "+i.id+" for GME object: "+t),this._GMEID2ComponentID[t]=this._GMEID2ComponentID[t]||[],this._GMEID2ComponentID[t].push(i.id),this._ComponentID2GMEID[i.id]=t;else{for(d=!1,h=this._delayedConnections.length;h--;)if(this._delayedConnections[h].ID===t){d=!0;break}d!==!0&&(this._delayedConnections.push({ID:t,desc:e}),this._displayConnectionAsItem(t,e))}return this._checkComponentDependency(t,n.TERRITORY_EVENT_LOAD),f},d.prototype._onUpdate=function(t,e){var i,o,r,s,a,c,d,h,p,g={};if(-1!==this._selectedMemberListMembers.indexOf(t)&&this._GMEID2ComponentID[t])if(e.isConnection===!1)for(o=this._GMEID2ComponentID[t].length;o--;)i=this._GMEID2ComponentID[t][o],g={position:{x:100,y:100}},this._memberListMemberCoordinates[this._selectedMemberListID]&&this._memberListMemberCoordinates[this._selectedMemberListID][t]&&(g.position.x=this._memberListMemberCoordinates[this._selectedMemberListID][t].x,g.position.y=this._memberListMemberCoordinates[this._selectedMemberListID][t].y),e&&e.decorator&&(g.decoratorClass=this._getItemDecorator(e.decorator),g.preferencesHelper=l.getPreferences([{containerID:this._memberListContainerID,setID:this._selectedMemberListID}])),this._widget.updateDesignerItem(i,g);else{for(o=this._GMEID2ComponentID[t].length,r=this._getAllSourceDestinationPairsForConnection(e.srcID,e.dstID),c=r.sources,d=r.destinations,s=c.length,a=d.length,o-=1,h=this._getConnectionVisualProperties(t);s--;)for(;a--;)g={},_.extend(g,h),g.srcObjId=c[s].objId,g.srcSubCompId=c[s].subCompId,g.dstObjId=d[a].objId,g.dstSubCompId=d[a].subCompId,g.reconnectable=void 0===e.reconnectable?!0:e.reconnectable,g.editable=void 0===e.editable?!0:e.editable,delete g.source,delete g.target,o>=0?(i=this._GMEID2ComponentID[t][o],this._widget.updateConnection(i,g),o-=1):(this.logger.warn("Updating connections...Existing connections are less than the needed src-dst combo..."),p=this._widget.createConnection(g),this.logger.debug("Connection: "+p.id+" for GME object: "+t),
this._GMEID2ComponentID[t].push(p.id),this._ComponentID2GMEID[p.id]=t);if(o>=0)for(o+=1;o--;)i=this._GMEID2ComponentID[t][o],0===i.indexOf("C_")&&(this._widget.deleteComponent(i),this._GMEID2ComponentID[t].splice(o,1),delete this._ComponentID2GMEID[i])}else-1===this._selectedMemberListMembers.indexOf(t)&&this._GMEID2ComponentID[t]?this._onUpdatePortToItem(t,!0,e):-1===this._selectedMemberListMembers.indexOf(t)||this._GMEID2ComponentID[t]||this._onUpdatePortToItem(t,!1,e);this._checkComponentDependency(t,n.TERRITORY_EVENT_UPDATE)},d.prototype._onUnload=function(t){var e,i,r,s,a,l,c,d,h,p,f=!1;if(this._GMEID2ComponentID.hasOwnProperty(t)){for(i=this._GMEID2ComponentID[t].length;i--;)if(e=this._GMEID2ComponentID[t][i],-1!==this._widget.itemIds.indexOf(e)&&(f=f||this._updateDecoratorTerritoryQuery(this._widget.items[e]._decoratorInstance,!0)),r=this._widget._getAssociatedConnectionsForItems([e]),this._widget.deleteComponent(e),delete this._ComponentID2GMEID[e],r&&r.length>0)for(s=r.length;s--;){for(e=r[s],a=this._ComponentID2GMEID[e],c=!1,d=0;d<this._delayedConnections.length;d+=1)if(this._delayedConnections[d].ID===a){c=!0;break}c===!1&&(l=this._client.getNode(a),h={isConnection:!0,decorator:l.getRegistry(o.DECORATOR),srcID:l.getPointer(g).to,dstID:l.getPointer(u).to},l&&(this._delayedConnections.push({ID:a,desc:h}),this._displayConnectionAsItem(a,h))),this._widget.deleteComponent(e),delete this._ComponentID2GMEID[e],p=this._GMEID2ComponentID[a].indexOf(e),p>-1&&this._GMEID2ComponentID[a].splice(p,1)}delete this._GMEID2ComponentID[t]}return this._checkComponentDependency(t,n.TERRITORY_EVENT_UNLOAD),f},d.prototype._onUpdatePortToItem=function(t,e,n){var i,o,r,s,a=this._selectedMemberListMembers,l=[];for(i=0;i<a.length;i+=1)o=this._client.getNode(a[i]),o&&o.isConnection()&&(r=o.getPointer(g).to,s=o.getPointer(u).to,(r===t||s===t)&&(this._onUnload.call(this,a[i]),l.push(a[i])));for(e===!0?this._onUnload(t):this._onLoad(t,n),i=0;i<l.length;i+=1)o=this._client.getNode(l[i]),r=o.getPointer(g).to,s=o.getPointer(u).to,this._onLoad.call(this,l[i],{isConnection:!0,srcID:r,dstID:s,reconnectable:!1,editable:!1})},d.prototype.registerComponentIDForPartID=function(t,e){this._componentIDPartIDMap[t]=this._componentIDPartIDMap[t]||[],-1===this._componentIDPartIDMap[t].indexOf(e)&&this._componentIDPartIDMap[t].push(e)},d.prototype.unregisterComponentIDFromPartID=function(t,e){var n;this._componentIDPartIDMap&&this._componentIDPartIDMap[t]&&(n=this._componentIDPartIDMap[t].indexOf(e),-1!==n&&(this._componentIDPartIDMap[t].splice(n,1),0===this._componentIDPartIDMap[t].length&&delete this._componentIDPartIDMap[t]))},d.prototype._checkComponentDependency=function(t,e){var n;if(this._componentIDPartIDMap&&this._componentIDPartIDMap[t])for(n=this._componentIDPartIDMap[t].length;n--;)this._notifyPackage[this._componentIDPartIDMap[t][n]]=this._notifyPackage[this._componentIDPartIDMap[t][n]]||[],this._notifyPackage[this._componentIDPartIDMap[t][n]].push({id:t,event:e})},d.prototype._handleDecoratorNotification=function(){var t,e,n;for(t in this._notifyPackage)if(this._notifyPackage.hasOwnProperty(t)&&(this.logger.debug("NotifyPartDecorator: "+t+", componentIDs: "+JSON.stringify(this._notifyPackage[t])),this._GMEID2ComponentID.hasOwnProperty(t)))for(e=this._GMEID2ComponentID[t].length;e--;)n=this._GMEID2ComponentID[t][e],this._widget.notifyItemComponentEvents(n,this._notifyPackage[t])},d.prototype._onTabTitleChanged=function(t,e,n){var i,o,r,s,a,l,c=this._memberListContainerID,d=this.getMemberListSetsRegistryKey();if(c&&d&&""!==d&&(i=this._client.getNode(c),o=i.getOwnEditableRegistry(d),s=this._client.getNode(i.getBaseId()),void 0!==o||null!==s&&void 0!==s.getRegistry(d)||(o=[]),this._tabIDMemberListID[t]&&o)){for(l=this._tabIDMemberListID[t],a=o.length,r=0;a>r;r+=1)if(o[r].SetID===l){o[r].title=n;break}this._client.setRegistry(c,d,o)}},d.prototype._onTabsSorted=function(t){var e,n,i,o,r,s,a=this._memberListContainerID,l=this.getMemberListSetsRegistryKey(),c=this._tabIDMemberListID,d=WebGMEGlobal.State.getActiveTab();if("string"==typeof a&&l&&""!==l&&(e=this._client.getNode(a),n=e.getOwnEditableRegistry(l),r=this._client.getNode(e.getBaseId()),void 0!==n||null!==r&&void 0!==r.getRegistry(l)||(n=[]),n)){for(this._tabIDMemberListID={},i=0;i<t.length;i+=1)for(d===t[i]&&WebGMEGlobal.State.registerActiveTab(i),s=c[t[i]],this._tabIDMemberListID[i]=s,o=0;o<n.length;o+=1)if(n[o].SetID===s){n[o].order=i;break}n.sort(function(t,e){return t.order<e.order?-1:1}),this._client.setRegistry(a,l,n)}},d.prototype._onTabDeleteClicked=function(t){var e,n,i,o,r,s=this._memberListContainerID,a=this.getMemberListSetsRegistryKey();if("string"==typeof s){if(r=this._tabIDMemberListID[t],this._client.startTransaction(),a&&(e=this._client.getNode(s),n=e.getOwnEditableRegistry(a),o=this._client.getNode(e.getBaseId()),void 0!==n||null!==o&&void 0!==o.getRegistry(a)||(n=[]),n)){for(i=n.length;i--;)if(n[i].SetID===r){n.splice(i,1);break}for(n.sort(function(t,e){return t.order<e.order?-1:1}),i=n.length;i--;)n[i].order=i;this._client.setRegistry(s,a,n)}this._client.deleteSet(s,r),this._client.completeTransaction()}},d.prototype._onTabAddClicked=function(){var t,n,i,o,r,s,a,l=this._memberListContainerID,c=this.getMemberListSetsRegistryKey();if(this._canAddTab()&&c&&""!==c&&(t=this._client.getNode(l),n=t.getOwnEditableRegistry(c),o=this._client.getNode(t.getBaseId()),void 0!==n||null!==o&&void 0!==o.getRegistry(c)||(n=[]),n)){for(n.sort(function(t,e){return t.order<e.order?-1:1}),i=n.length;i--;)n[i].order=i;s=this.getNewSetNamePrefixDesc(),r=s.SetID+e(),a={SetID:r,order:n.length,title:s.Title+n.length},n.push(a),this._client.startTransaction(),this._client.createSet(l,r),this._client.setRegistry(l,c,n),1!==n.length&&(this._selectedMemberListID=r),this._client.completeTransaction()}},d.prototype._canAddTab=function(){var t=this._memberListContainerID;return t&&t!==n.PROJECT_ROOT_ID},d.prototype.getNewSetNamePrefixDesc=function(){var t={SetID:"SET_",Title:"Tab "};return this.logger.warn("DiagramDesignerWidgetMultiTabMemberListControllerBase.getNewSetNamePrefixDesc is not overridden, returning default value: "+JSON.stringify(t)),t},d.prototype._onSelectionChanged=function(t){for(var e,n=[],i=t.length;i--;)e=this._ComponentID2GMEID[t[i]],e&&-1===n.indexOf(e)&&n.push(e);WebGMEGlobal.State.registerActiveSelection(n,{invoker:this})},d.prototype.displayNoTabMessage=function(){this._widget.setBackgroundText("NO TAB TO DISPLAY...")},d.prototype._displayContainerObjectName=function(){var t=this._client.getNode(this._memberListContainerID);t&&this._widget.setTitle(t.getAttribute(i.Attributes.name))},d.prototype._onSelectionSetColor=function(t,e,n){var i,o=t.length,r=this._memberListContainerID,s=this._selectedMemberListID;for(this._client.startTransaction();o--;)i=this._ComponentID2GMEID[t[o]],e?this._client.setMemberRegistry(r,i,s,n,e):this._client.delMemberRegistry(r,i,s,n);this._client.completeTransaction()},d.prototype._getConnectionVisualProperties=function(t){var e,i,r=s.getConnectionVisualProperties(t),a=this._client.getNode(this._memberListContainerID);return null!==a&&-1!==a.getSetNames().indexOf(this._selectedMemberListID)&&(e=a.getMemberIds(this._selectedMemberListID),-1!==e.indexOf(t)&&(i=a.getMemberRegistry(this._selectedMemberListID,t,o.COLOR),i&&(r[n.LINE_STYLE.COLOR]=i),i=a.getMemberRegistry(this._selectedMemberListID,t,o.LINE_CUSTOM_POINTS),i&&_.isArray(i)&&(r[n.LINE_STYLE.CUSTOM_POINTS]=$.extend(!0,[],i)))),r},d.prototype._onConnectionSegmentPointsChange=function(t){var e=t.connectionID,n=t.points,i=this._ComponentID2GMEID[e],r=this._memberListContainerID,s=this._selectedMemberListID,a=o.LINE_CUSTOM_POINTS;i&&(n&&n.length>0?this._client.setMemberRegistry(r,i,s,a,n):this._client.delMemberRegistry(r,i,s,a))},d.prototype._onRegisterSubcomponent=function(t,e,i){this._GMEID2Subcomponent[i[n.GME_ID]]=this._GMEID2Subcomponent[i[n.GME_ID]]||{},this._GMEID2Subcomponent[i[n.GME_ID]][t]=e,this._Subcomponent2GMEID[t]=this._Subcomponent2GMEID[t]||{},this._Subcomponent2GMEID[t][e]=i[n.GME_ID]},d.prototype._onUnregisterSubcomponent=function(t,e){var n=this._Subcomponent2GMEID[t][e];delete this._Subcomponent2GMEID[t][e],this._GMEID2Subcomponent[n]&&delete this._GMEID2Subcomponent[n][t]},d.prototype._displayConnectionAsItem=function(t,e){var i,o,r={};o=this._getItemDecorator(e.decorator),r.decoratorClass=o,r.control=this,r.metaInfo={},r.metaInfo[n.GME_ID]=t,r.position={x:100,y:100},this._memberListMemberCoordinates[this._selectedMemberListID]&&this._memberListMemberCoordinates[this._selectedMemberListID][t]&&(r.position.x=this._memberListMemberCoordinates[this._selectedMemberListID][t].x,r.position.y=this._memberListMemberCoordinates[this._selectedMemberListID][t].y),r.decoratorParams={},e.decoratorParams&&_.extend(r.decoratorParams,e.decoratorParams),r.preferencesHelper=l.getPreferences([{containerID:this._memberListContainerID,setID:this._selectedMemberListID}]),i=this._widget.createDesignerItem(r),this._GMEID2ComponentID[t]=this._GMEID2ComponentID[t]||[],this._GMEID2ComponentID[t].push(i.id),this._ComponentID2GMEID[i.id]=t,this._delayedConnectionsAsItems[t]=i.id},d.prototype._onSelectionAlignMenu=function(t,e){var n=this._widget.posToPageXY(e.mX,e.mY),i=this;this._alignMenu.show(t,n,function(e){i._onAlignSelection(t,e)})},d.prototype._onAlignSelection=function(t,e){var n={client:this._client,modelId:this._memberListContainerID,idMap:this._ComponentID2GMEID,setName:this._selectedMemberListID,coordinates:this._memberListMemberCoordinates[this._selectedMemberListID]};n.coordinates&&this._alignMenu.alignSetSelection(n,t,e)},d.prototype._onDesignerItemsMove=function(t){var e;this._client.startTransaction();for(e in t)t.hasOwnProperty(e)&&this._client.setMemberRegistry(this._memberListContainerID,this._ComponentID2GMEID[e],this._selectedMemberListID,o.POSITION,{x:t[e].x,y:t[e].y});this._client.completeTransaction()},d}),define("js/Panels/SetEditor/SetEditorController",["js/Utils/GMEConcepts","js/DragDrop/DragHelper","js/NodePropertyNames","js/RegistryKeys","./../Crosscut/CrosscutConstants","js/Panels/ControllerBase/DiagramDesignerWidgetMultiTabMemberListControllerBase"],function(t,e,n,i,o,r){"use strict";var s,a="DRAG_PARAMS_MULTI_TAB_MEMBER_LIST_CONTAINER_ID";return s=function(t){t=t||{},t.loggerName="gme:Panels:SetEditor:SetEditorController",t.disableConnectionRendering=!0,r.call(this,t),this.logger.debug("SetEditorController ctor finished")},_.extend(s.prototype,r.prototype),s.prototype.getOrderedMemberListInfo=function(){var e,n,i=[],o=this._memberListContainerID,r=t.getSets(o),s=this._client.getNode(o);for(e=s?s.getValidSetNames():[],n=r.length;n--;)i.push({memberListID:r[n],title:r[n],enableDeleteTab:-1===e.indexOf(r[n]),enableRenameTab:!1});return i.sort(function(t,e){return t.title.toLowerCase()<e.title.toLowerCase()?-1:1}),i},s.prototype._onBackgroundDroppableAccept=function(n,i){var o,s=e.getDragItems(i),l=!1;return r.prototype._onBackgroundDroppableAccept.call(this,n,i)&&(o=e.getDragParams(i),l=o&&o.hasOwnProperty(a)&&o[a]===this._getDragParamsDataID()?!0:t.canAddToSet(this._memberListContainerID,this._selectedMemberListID,s)),l},s.prototype.displayNoTabMessage=function(){var t="The currently selected object does not contain any sets.";this._widget.setBackgroundText(t)},s}),define("js/Panels/SetEditor/SetEditorPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/SetEditor/SetEditorWidget","./SetEditorController"],function(t,e,n,i){"use strict";var o;return o=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="SetEditorPanel",i[t.OPTIONS.FLOATING_TITLE]=!0,t.apply(this,[i,e]),this._client=n.client,this._initialize(),this.logger.debug("SetEditorPanel ctor finished")},_.extend(o.prototype,t.prototype),_.extend(o.prototype,e.prototype),o.prototype._initialize=function(){var t=this;this.widget=new n(this.$el,{toolBar:this.toolBar}),this.widget.setTitle=function(e){t.setTitle(e)},this.widget.onUIActivity=function(){WebGMEGlobal.PanelManager.setActivePanel(t),WebGMEGlobal.KeyboardManager.setListener(t.widget)},this.control=new i({client:this._client,widget:this.widget}),this.onActivate()},o.prototype.onReadOnlyChanged=function(e){t.prototype.onReadOnlyChanged.call(this,e),this.widget.setReadOnly(e),this.control.setReadOnly(e)},o.prototype.onResize=function(t,e){this.logger.debug("onResize --> width: "+t+", height: "+e),this.widget.onWidgetContainerResize(t,e)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),t.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o}),define("js/Widgets/Crosscut/CrosscutWidget",["js/DragDrop/DragHelper","js/Widgets/DiagramDesigner/DiagramDesignerWidget","js/Controls/iCheckBox","jquery","underscore"],function(t,e,n){"use strict";var i,o="#CCCCFF";return i=function(t,n){n=n||{},n.loggerName="gme:Widgets:CrossCut:CrosscutWidget",n.tabsEnabled=!0,n.addTabs=!0,n.deleteTabs=!0,n.reorderTabs=!0,n.lineStyleControls=!1,n.defaultConnectionRouteManagerType="basic2",n.disableAutoRouterOption=!0,e.call(this,t,n),this.logger.debug("CrosscutWidget ctor")},_.extend(i.prototype,e.prototype),i.prototype._initializeUI=function(){e.prototype._initializeUI.apply(this,arguments),this.logger.debug("CrosscutWidget._initializeUI"),this._connectToConnection=!1,this._initializeFilterPanel()},i.prototype._afterManagersInitialized=function(){this.enableRotate(!1)},i.prototype.getDragEffects=function(){return[t.DRAG_EFFECTS.DRAG_MOVE]},i.prototype._dragHelper=function(t,n,i){var o=e.prototype._dragHelper.apply(this,[t,n,i]);return o.html(""),o},i.prototype.setBackgroundText=function(t,n){n=n||{},n.color=n.color||o,e.prototype.setBackgroundText.apply(this,[t,n])},i.prototype._initializeFilterPanel=function(){this.$filterPanel=$("<div/>",{"class":"filterPanel"}),this.$filterPanel.html('<div class="header">FILTER</div><ul class="body"></ul>'),this.$filterHeader=this.$filterPanel.find(".header"),this.$filterUl=this.$filterPanel.find("ul.body"),this.$el.parent().append(this.$filterPanel),this._filterCheckboxes={}},i.prototype.addFilterItem=function(t,e,i){var o,r=$("<li/>",{"class":"filterItem"}),s=this;return o=new n({checkChangedFn:function(t,n){s._checkChanged(e,n)}}),r.append(i.addClass("inline")),r.append(t),r.append(o.el),this.$filterUl.append(r),this._refreshHeaderText(),this._filterCheckboxes[e]=o,r},i.prototype._refreshHeaderText=function(){var t=this.$filterUl.find(".iCheckBox").length,e=this.$filterUl.find(".iCheckBox.checked").length;this.$filterHeader.html("FILTER"+(t===e?"":" *"))},i.prototype._checkChanged=function(t,e){this._refreshHeaderText(),this.logger.debug("CheckBox checkChanged: "+t+", checked: "+e),this.onCheckChanged(t,e)},i.prototype.setChecked=function(t,e){this._filterCheckboxes[t]&&this._filterCheckboxes[t].setChecked(e)},i.prototype.onCheckChanged=function(){this.logger.warn("CrosscutWidget.onCheckChanged(value, isChecked) is not overridden!")},i}),define("js/Panels/Crosscut/CrosscutController",["js/logger","js/RegistryKeys","js/Constants","./CrosscutConstants","js/DragDrop/DragHelper","js/Utils/GMEConcepts","js/Panels/ControllerBase/DiagramDesignerWidgetMultiTabMemberListControllerBase","js/Panels/MetaEditor/MetaRelations","js/NodePropertyNames","js/Utils/ComponentSettings"],function(t,e,n,i,o,r,s,a,l,c){"use strict";var d,h="ModelDecorator",p="DiagramDesigner";return d=function(t){t=t||{},t.loggerName="gme:Panels:CrossCut:CrosscutController",this._config=d.getDefaultConfig(),c.resolveWithWebGMEGlobal(this._config,d.getComponentId()),s.call(this,t),this._filteredOutConnTypes=[],this._filteredOutConnectionDescriptors={},this._activeCrosscutId=null,this._initActiveTab=!1,this._tabsHasBeenRequested=!1,this._autoCreateCrosscut=this._config.autoCreateCrosscut===!0,this._initFilterPanel(),this.logger.debug("CrosscutController ctor finished")},_.extend(d.prototype,s.prototype),d.prototype._attachDiagramDesignerWidgetEventHandlers=function(){var t,e=this;s.prototype._attachDiagramDesignerWidgetEventHandlers.call(this),this._widget.onFilterNewConnectionDroppableEnds=function(t){return e._onFilterNewConnectionDroppableEnds(t)},this._widget.onCreateNewConnection=function(t){e._onCreateNewConnection(t)},this._widget.onModifyConnectionEnd=function(t){e._onModifyConnectionEnd(t)},this._widget.onCheckChanged=function(t,n){e._onConnectionTypeFilterCheckChanged(t,n)},t=this._widget.onSelectedTabChanged,this._widget.onSelectedTabChanged=function(n){t(n),e._selectedTabChanged(n)}},d.prototype._validateNodeId=function(t){return t},d.prototype._canAddTab=function(){var t=this._memberListContainerID;return t||t===n.PROJECT_ROOT_ID},d.prototype._updateSelectedMemberListMembersTerritoryPatterns=function(){var t,e,n=(this._selectedMemberListMembers||[]).slice(0),i=(this._memberListMembers[this._selectedMemberListID]||[]).slice(0),o=!1,r=this._selectedMemberListMembersTerritoryId,s=this._selectedMemberListMembersTerritoryPatterns,a=this._client,l=function(t){var e,n,i=[],o=[];for(e=0;e<t.length;e+=1)n=a.getNode(t[e]),n&&n.isConnection()?o.push(t[e]):i.push(t[e]);return o.concat(i)};for(t=l(_.difference(n,i)),e=t.length;e--;)delete s[t[e]],o=!0;for(t=l(_.difference(i,n)),e=t.length;e--;)s[t[e]]={children:0},o=!0;this._selectedMemberListMembers=i,o&&setTimeout(function(){a.updateTerritory(r,s)},10)},d.prototype._initializeSelectedMemberList=function(){this._nodePointers={},this._nodeSets={},this._connectionListByType={},this._filteredOutConnectionDescriptors={},this._connectionWaitingListByDstGMEID={},this._connectionWaitingListBySrcGMEID={},s.prototype._initializeSelectedMemberList.call(this)},d.prototype._memberListTerritoryCallback=function(t){for(var i,o,s=[h],a=t.length,l=[],c=this._client,d=this;a--;)(t[a].etype===n.TERRITORY_EVENT_LOAD||t[a].etype===n.TERRITORY_EVENT_UPDATE)&&(i=c.getNode(t[a].eid),t[a].desc={isConnection:r.isConnection(t[a].eid)},i&&(t[a].desc.isConnection===!0?(t[a].desc.srcID=i.getPointer(n.POINTER_SOURCE).to,t[a].desc.dstID=i.getPointer(n.POINTER_TARGET).to,t[a].desc.reconnectable=!0,t[a].desc.editable=!0):o=i.getRegistry(e.DECORATOR),o&&""!==o||(o=h),-1===s.indexOf(o)&&s.pushUnique(o),t[a].desc.decorator=o,t[a].desc.isConnection&&(l.push(t[a]),t.splice(a,1))));c.decoratorManager.download(s,p,function(){t=t.concat(l),d._dispatchEvents(t)})},d.prototype.getOrderedMemberListInfo=function(){var t=[],e=this._memberListContainerID,n=r.getCrosscuts(e),i=n.length;for(this._autoCreateCrosscut===!0&&0===i&&this._tabsHasBeenRequested===!1&&(this._onTabAddClicked(),e=this._memberListContainerID,n=r.getCrosscuts(e),i=n.length),this._tabsHasBeenRequested=!0;i--;)t.push({memberListID:n[i].SetID,title:n[i].title,filterInfo:n[i].filter||{},enableDeleteTab:!0,enableRenameTab:!0});return t.sort(function(t,e){return t.order<e.order?-1:1}),t},d.prototype.getMemberListSetsRegistryKey=function(){return e.CROSSCUTS},d.prototype.getNewSetNamePrefixDesc=function(){return{SetID:i.CROSSCUT_NAME_PREFIX,Title:"Crosscut "}},d.prototype.displayNoTabMessage=function(){this._widget.setBackgroundText("No crosscuts defined yet. Press the + button in the top-left corner to create one...")},d.prototype._onBackgroundDroppableAccept=function(t,e){var n=o.getDragItems(e),i=s.prototype._onBackgroundDroppableAccept.call(this,t,e);return i===!0&&(i=r.isValidChildrenTypeInCrossCut(this._memberListContainerID,n)),i},d.prototype._onLoad=function(t,e){var n;return n=s.prototype._onLoad.call(this,t,e),this._processNodePointers(t,!1),this._processNodePointers(t,!0),this._processConnectionWaitingList(t),n},d.prototype._onUpdate=function(t,e){var i=this._client.getNode(t);if(e=e||{},i&&i.isConnection()?(e.isConnection=!0,e.srcID=i.getPointer(n.POINTER_SOURCE).to,e.dstID=i.getPointer(n.POINTER_TARGET).to,e.reconnectable=!0,e.editable=!0):e.isConnection=!1,-1!==this._selectedMemberListMembers.indexOf(t)&&this._GMEID2ComponentID[t]){if(e.isConnection){if(this._GMEID2ComponentID[t].length>0&&0===this._GMEID2ComponentID[t][0].indexOf("C_")&&(!e.srcID||!e.dstID))return this._onUnload(t),void this._onLoad(t,e);if(this._GMEID2ComponentID[t].length>0&&0!==this._GMEID2ComponentID[t][0].indexOf("C_")&&e.srcID&&e.dstID)return this._onUnload(t),void this._onLoad(t,e)}s.prototype._onUpdate.call(this,t,e),this._processNodePointers(t,!1),this._processNodePointers(t,!0),this._processConnectionWaitingList(t)}else-1===this._selectedMemberListMembers.indexOf(t)&&this._GMEID2ComponentID[t]?this._onUpdatePortToItem(t,!0,e):-1===this._selectedMemberListMembers.indexOf(t)||this._GMEID2ComponentID[t]||this._onUpdatePortToItem(t,!1,e)},d.prototype._onUnload=function(t){var e,i,o,r,s,l,c=!1;if(this._GMEID2ComponentID.hasOwnProperty(t)){for(i=this._nodePointers[t].combinedNames.length;i--;)s=this._nodePointers[t].combinedNames[i],l=this._nodePointers[t][s].target,s=this._nodePointers[t][s].name,this._removeConnection(t,l,a.META_RELATIONS.POINTER,s);for(i=this._nodeSets[t].combinedNames.length;i--;)s=this._nodeSets[t].combinedNames[i],l=this._nodeSets[t][s].target,s=this._nodeSets[t][s].name,this._removeConnection(t,l,a.META_RELATIONS.SET,s);for(i=this._GMEID2ComponentID[t].length;i--;)e=this._GMEID2ComponentID[t][i],-1!==this._widget.itemIds.indexOf(e)&&(c=c||this._updateDecoratorTerritoryQuery(this._widget.items[e]._decoratorInstance,!0)),this._widget.deleteComponent(e),delete this._ComponentID2GMEID[e];delete this._GMEID2ComponentID[t]}for(this._checkComponentDependency(t,n.TERRITORY_EVENT_UNLOAD),o=this._getAssociatedConnections(t),i=o.src.length;i--;)r=o.src[i],this._saveConnectionToWaitingList(this._connectionListByID[r].GMESrcId,this._connectionListByID[r].GMEDstId,this._connectionListByID[r].type,this._connectionListByID[r].connTexts),this._removeConnection(this._connectionListByID[r].GMESrcId,this._connectionListByID[r].GMEDstId,this._connectionListByID[r].type);for(i=o.dst.length;i--;)r=o.dst[i],this._connectionListByID[r]&&(this._saveConnectionToWaitingList(this._connectionListByID[r].GMESrcId,this._connectionListByID[r].GMEDstId,this._connectionListByID[r].type,this._connectionListByID[r].connTexts),this._removeConnection(this._connectionListByID[r].GMESrcId,this._connectionListByID[r].GMEDstId,this._connectionListByID[r].type));for(l in this._connectionWaitingListBySrcGMEID)this._connectionWaitingListBySrcGMEID.hasOwnProperty(l)&&(delete this._connectionWaitingListBySrcGMEID[l][t],_.isEmpty(this._connectionWaitingListBySrcGMEID[l])&&delete this._connectionWaitingListBySrcGMEID[l]);for(l in this._connectionWaitingListByDstGMEID)this._connectionWaitingListByDstGMEID.hasOwnProperty(l)&&(delete this._connectionWaitingListByDstGMEID[l][t],_.isEmpty(this._connectionWaitingListByDstGMEID[l])&&delete this._connectionWaitingListByDstGMEID[l]);return delete this._nodePointers[t],delete this._nodeSets[t],c},d.prototype._getAssociatedConnections=function(t){var e,n,i,o,r,s={src:[],dst:[]};return r=function(r,s){if(r.hasOwnProperty(t))for(e in r[t])if(r[t].hasOwnProperty(e))for(n in r[t][e])if(r[t][e].hasOwnProperty(n))for(i=r[t][e][n].length;i--;)o=r[t][e][n][i],-1===s.indexOf(o)&&s.push(o)},r(this._connectionListBySrcGMEID,s.src),r(this._connectionListByDstGMEID,s.dst),s},d.prototype._processNodePointers=function(t,e){var i,o,s,l,c,d,h,p,g,u,f=this._client.getNode(t),m=null===f?[]:e===!0?r.getSets(t):f.getPointerNames(),b={names:[],combinedNames:[]},y=null===f?!1:f.isConnection();for(e===!0?(this._nodeSets[t]=this._nodeSets[t]||{names:[],combinedNames:[]},s=this._nodeSets[t]):(this._nodePointers[t]=this._nodePointers[t]||{names:[],combinedNames:[]},s=this._nodePointers[t]),o=m.length;o--;)if(e)for(g=f.getMemberIds(m[o]),u=g.pop(),"string"==typeof u&&b.names.push(m[o]);"string"==typeof u;)p=t+"_"+m[o]+"_"+u,b.combinedNames.push(p),b[p]={name:m[o],target:u,type:a.META_RELATIONS.SET},u=g.pop();else m[o]===n.POINTER_BASE||y&&(m[o]===n.POINTER_SOURCE||m[o]===n.POINTER_TARGET)||(i=f.getPointer(m[o]).to,i&&(p=t+"_"+m[o]+"_"+i,b.names.push(m[o]),b.combinedNames.push(p),b[p]={name:m[o],target:i,type:a.META_RELATIONS.POINTER}));for(!e&&f&&(i=f.getParentId(),"string"==typeof i&&(p=t+"_"+n.RELATION_CONTAINMENT+"_"+i,b.names.push(n.RELATION_CONTAINMENT),b.combinedNames.push(p),b[p]={name:n.RELATION_CONTAINMENT,target:i,type:a.META_RELATIONS.CONTAINMENT}),i=f.getBaseId(),"string"==typeof i&&(p=t+"_"+n.POINTER_BASE+"_"+i,b.names.push(n.POINTER_BASE),b.combinedNames.push(p),b[p]={name:n.POINTER_BASE,target:i,type:a.META_RELATIONS.INHERITANCE})),l=_.difference(s.combinedNames,b.combinedNames),o=l.length;o--;)p=l[o],d=s[p].name,c=s[p].target,this._removeConnection(t,c,s[p].type,d),h=s.combinedNames.indexOf(p),s.combinedNames.splice(h,1),delete s[p];for(l=_.difference(b.combinedNames,s.combinedNames),o=l.length;o--;)p=l[o],d=b[p].name,c=b[p].target,s.names.push(d),s.combinedNames.push(p),s[p]={name:b[p].name,target:b[p].target,type:b[p].type},this._createConnection(t,c,b[p].type,{name:d})},d.prototype._processConnectionWaitingList=function(t){var e,n,i,o,r,s=[];if(i=t,this._connectionWaitingListByDstGMEID&&this._connectionWaitingListByDstGMEID.hasOwnProperty(i)){for(n in this._connectionWaitingListByDstGMEID[i])if(this._connectionWaitingListByDstGMEID[i].hasOwnProperty(n))for(e=this._connectionWaitingListByDstGMEID[i][n].length;e--;)o=this._connectionWaitingListByDstGMEID[i][n][e][0],r=this._connectionWaitingListByDstGMEID[i][n][e][1],s.push({gmeSrcID:n,gmeDstID:i,connType:o,connTexts:r});delete this._connectionWaitingListByDstGMEID[i]}if(n=t,this._connectionWaitingListBySrcGMEID&&this._connectionWaitingListBySrcGMEID.hasOwnProperty(n)){for(i in this._connectionWaitingListBySrcGMEID[n])if(this._connectionWaitingListBySrcGMEID[n].hasOwnProperty(i))for(e=this._connectionWaitingListBySrcGMEID[n][i].length;e--;)o=this._connectionWaitingListBySrcGMEID[n][i][e][0],r=this._connectionWaitingListBySrcGMEID[n][i][e][1],s.push({gmeSrcID:n,gmeDstID:i,connType:o,connTexts:r});delete this._connectionWaitingListBySrcGMEID[n]}for(e=s.length;e--;)n=s[e].gmeSrcID,i=s[e].gmeDstID,o=s[e].connType,r=s[e].connTexts,this._createConnection(n,i,o,r)},d.prototype._createConnection=function(t,e,i,o){var r,s,l;if(this._GMEID2ComponentID[t]&&this._GMEID2ComponentID[t].length>0&&this._GMEID2ComponentID[e]&&this._GMEID2ComponentID[e].length>0)if(-1===this._filteredOutConnTypes.indexOf(i)){if(r={srcObjId:this._GMEID2ComponentID[t][0],srcSubCompId:void 0,dstObjId:this._GMEID2ComponentID[e][0],dstSubCompId:void 0,reconnectable:!1,name:"",nameEdit:!1},l=i,o)switch(o.name){case n.POINTER_BASE:l=a.META_RELATIONS.INHERITANCE;break;case n.RELATION_CONTAINMENT:l=a.META_RELATIONS.CONTAINMENT,r.srcObjId=this._GMEID2ComponentID[e][0],r.dstObjId=this._GMEID2ComponentID[t][0]}_.extend(r,a.getLineVisualDescriptor(l)),o&&_.extend(r,o),s=this._widget.createConnection(r),this._saveConnection(t,e,i,s.id,o)}else this._filteredOutConnectionDescriptors[i]=this._filteredOutConnectionDescriptors[i]||[],this._filteredOutConnectionDescriptors[i].push([t,e,o]);else this._saveConnectionToWaitingList(t,e,i,o)},d.prototype._saveConnectionToWaitingList=function(t,e,n,i){var o=this._GMEID2ComponentID[t]&&this._GMEID2ComponentID[t].length>0,r=this._GMEID2ComponentID[e]&&this._GMEID2ComponentID[e].length>0;o&&!r?(this._connectionWaitingListByDstGMEID[e]=this._connectionWaitingListByDstGMEID[e]||{},this._connectionWaitingListByDstGMEID[e][t]=this._connectionWaitingListByDstGMEID[e][t]||[],this._connectionWaitingListByDstGMEID[e][t].push([n,i])):!o&&r&&(this._connectionWaitingListBySrcGMEID[t]=this._connectionWaitingListBySrcGMEID[t]||{},this._connectionWaitingListBySrcGMEID[t][e]=this._connectionWaitingListBySrcGMEID[t][e]||[],this._connectionWaitingListBySrcGMEID[t][e].push([n,i]))},d.prototype._saveConnection=function(t,e,n,i,o){this._connectionListBySrcGMEID[t]=this._connectionListBySrcGMEID[t]||{},this._connectionListBySrcGMEID[t][e]=this._connectionListBySrcGMEID[t][e]||{},this._connectionListBySrcGMEID[t][e][n]=this._connectionListBySrcGMEID[t][e][n]||[],this._connectionListBySrcGMEID[t][e][n].push(i),this._connectionListByDstGMEID[e]=this._connectionListByDstGMEID[e]||{},this._connectionListByDstGMEID[e][t]=this._connectionListByDstGMEID[e][t]||{},this._connectionListByDstGMEID[e][t][n]=this._connectionListByDstGMEID[e][t][n]||[],this._connectionListByDstGMEID[e][t][n].push(i),this._connectionListByType[n]=this._connectionListByType[n]||[],this._connectionListByType[n].push(i),this._connectionListByID[i]={GMESrcId:t,GMEDstId:e,type:n,name:o&&o.name?o.name:void 0,connTexts:o}},d.prototype._removeConnection=function(t,e,n,i){var o,r,s,l=!1;if(this._connectionListBySrcGMEID[t]&&this._connectionListBySrcGMEID[t][e]&&this._connectionListBySrcGMEID[t][e][n]&&(l=!0),l)for(s=this._connectionListBySrcGMEID[t][e][n].length;s--;)o=this._connectionListBySrcGMEID[t][e][n][s],n===a.META_RELATIONS.POINTER&&i&&""!==i&&this._connectionListByID[o].name!==i&&(o=void 0),o&&(this._widget.deleteComponent(o),delete this._connectionListByID[o],r=this._connectionListByType[n].indexOf(o),this._connectionListByType[n].splice(r,1),r=this._connectionListBySrcGMEID[t][e][n].indexOf(o),this._connectionListBySrcGMEID[t][e][n].splice(r,1),r=this._connectionListByDstGMEID[e][t][n].indexOf(o),this._connectionListByDstGMEID[e][t][n].splice(r,1))},d.prototype._onSelectionDelete=function(t){var e,i,o,s,l,c,d=this._client,h=this._memberListContainerID,p=this._selectedMemberListID,g=[n.POINTER_SOURCE,n.POINTER_TARGET,n.POINTER_BASE],u=this.logger;for(d.startTransaction(),e=t.length;e--;)s=t[e],i=this._ComponentID2GMEID[s],i?(u.debug("removeMember memberListContainerID: "+h+", gmeID: "+i+", memberListToRemoveFrom: "+p),o=d.getNode(i),r.isConnection(i)&&o.getParentId()===h&&r.canDeleteNode(i)?(u.debug("deleting connection from crosscut hierarchy too gmeID: "+i),d.deleteNodes([i])):d.removeMember(h,i,p)):(l=this._connectionListByID[s],l&&(c=!0,l.type===a.META_RELATIONS.POINTER&&-1!==g.indexOf(l.name)&&(c=!1),c?(u.debug("deleting pointer from: "+l.GMESrcId+", type: "+l.name),d.delPointer(l.GMESrcId,l.name)):u.warn("can not delete pointer from: "+l.GMESrcId+", type: "+l.name)));d.completeTransaction()},d.prototype._onFilterNewConnectionDroppableEnds=function(t){var e,i,o,s,a,l,c,d,h,p,g,u=t.availableConnectionEnds,f=[],m=this._client,b=this._memberListContainerID;for(i=void 0===t.srcSubCompId?this._ComponentID2GMEID[t.srcId]:this._Subcomponent2GMEID[t.srcId][t.srcSubCompId],a=r.getValidPointerTargetTypesFromSource(i,!1),l=r.getValidPointerTargetTypesFromSource(i,!0),d=r.getValidConnectionTypesFromSourceInAspect(i,b,n.ASPECT_ALL),c=[],e=d.length;e--;)if(r.canCreateChild(b,d[e])&&(p=this._client.getValidTargetItems(d[e],n.POINTER_TARGET),p&&p.length>0))for(s=p.length;s--;)-1===c.indexOf(p[s].id)&&c.push(p[s].id);for(h=_.union(a,l,c),this.logger.debug("validEndTypes: "+h),e=u.length;e--;)for(g=u[e],o=void 0===g.dstSubCompID?this._ComponentID2GMEID[g.dstItemID]:this._Subcomponent2GMEID[g.dstItemID][g.dstSubCompID],s=h.length;s--;)if(m.isTypeOf(o,h[s])){f.push(u[e]);break}return f},d.prototype._onCreateNewConnection=function(t){function i(t,e,n){D.debug("createPointer srcId: "+t+", dstId: "+e+", ptrName: "+n),C.setPointer(t,n,e)}function o(t,e,n){D.debug("addToSet containerId: "+t+", objId: "+e+", ptrName: "+n),C.addMember(t,e,n)}function s(t,i,o){var r,s,a;D.debug("createConnection srcId: "+t+", dstId: "+i+", connType: "+o),C.startTransaction(),r=C.createChild({parentId:v,baseId:o}),C.setPointer(r,n.POINTER_SOURCE,t),C.setPointer(r,n.POINTER_TARGET,i),C.addMember(v,r,I),s=P.x-T.x,a=P.y-T.y,s=T.x+s/2,a=T.y+a/2,C.setMemberRegistry(v,r,I,e.POSITION,{x:s,y:a}),C.completeTransaction();
}function a(t){var e,n={};n[t]={children:0},e=C.addUI(null,function(n){var i,o;for(o=0;o<n.length;o+=1)if(n[o].eid===t&&"load"===n[o].etype){i=C.getNode(t),i&&WebGMEGlobal.State.registerActiveObject(t);break}C.removeUI(e)}),C.updateTerritory(e,n)}function c(){var t,e,n,r=p.getAttribute(l.Attributes.name),c=g.getAttribute(l.Attributes.name),_=10,v="PTR",D="SET",I="CONN",T="FOLLOW_CONN";for(e=0;e<u.length;e+=1)E[v+u[e]]={name:"Create pointer '"+u[e]+"' from '"+r+"' to '"+c+"'",icon:"glyphicon glyphicon-share",action:v,type:u[e]};for(e=0;e<f.length;e+=1)E[D+f[e]]={name:"Add '"+c+"' to set '"+f[e]+"' of '"+r+"'",icon:!1,action:D,type:f[e]};for(n="",e=0;e<m.length;e+=1)t=C.getNode(m[e]),n=t?t.getAttribute(l.Attributes.name):m[e],E[I+m[e]]={name:"Create connection '"+n+"' from '"+r+"' to '"+c+"'",icon:"glyphicon glyphicon-resize-horizontal",action:I,type:m[e]};if(m.length>0)for(e=0;e<b.length;e+=1)E[T+b[e]]={name:"Open existing connection ["+b[e]+"] from '"+r+"' to '"+c+"'",icon:"glyphicon glyphicon-share",action:T,type:b[e]};y._widget.createMenu(E,function(t){var e=E[t],n=e.type,r=e.action;switch(r){case v:i(d,h,n);break;case D:o(d,h,n);break;case I:s(d,h,n);break;case T:a(n)}},y._widget.posToPageXY(P.x-_,P.y-_))}var d,h,p,g,u,f,m,b,y=this,v=this._memberListContainerID,C=this._client,E={},D=this.logger,I=this._selectedMemberListID,P=this._widget.items[t.dst].getBoundingBox(),T=this._widget.items[t.src].getBoundingBox();d=void 0===t.srcSubCompId?this._ComponentID2GMEID[t.src]:this._Subcomponent2GMEID[t.src][t.srcSubCompId],h=void 0===t.dstSubCompId?this._ComponentID2GMEID[t.dst]:this._Subcomponent2GMEID[t.dst][t.dstSubCompId],u=r.getValidPointerTypesFromSourceToTarget(d,h),f=r.getValidSetTypesFromContainerToMember(d,h),m=r.getValidConnectionTypesInAspect(d,h,v,n.ASPECT_ALL),u.length+f.length+m.length>0&&(p=C.getNode(d),g=C.getNode(h),m.length>0&&(b=_.intersection(p.getCollectionPaths("src"),g.getCollectionPaths("dst"))),u.length+f.length+m.length===1?1===u.length?i(d,h,u[0]):1===f.length?o(d,h,f[0]):1===m.length&&(0===b.length?s(d,h,m[0]):c()):c())},d.prototype._onModifyConnectionEnd=function(t){var e,n=this._ComponentID2GMEID[t.id],i=t.old,o=t["new"];n&&(this._client.startTransaction(),(i.srcObjId!==o.srcObjId||i.srcSubCompId!==o.srcSubCompId)&&(e=void 0!==o.srcSubCompId?this._Subcomponent2GMEID[o.srcObjId][o.srcSubCompId]:this._ComponentID2GMEID[o.srcObjId],this._client.setPointer(n,"src",e)),(i.dstObjId!==o.dstObjId||i.dstSubCompId!==o.dstSubCompId)&&(e=void 0!==o.dstSubCompId?this._Subcomponent2GMEID[o.dstObjId][o.dstSubCompId]:this._ComponentID2GMEID[o.dstObjId],this._client.setPointer(n,"dst",e)),this._client.completeTransaction())},d.prototype._getDragItems=function(t){for(var e=[],n=t.length;n--;)this._ComponentID2GMEID[t[n]]&&e.push(this._ComponentID2GMEID[t[n]]);return e},d.prototype._attachClientEventListeners=function(){s.prototype._attachClientEventListeners.call(this)},d.prototype._detachClientEventListeners=function(){s.prototype._detachClientEventListeners.call(this)},d.prototype._initFilterPanel=function(){var t;t=a.createButtonIcon(a.META_RELATIONS.CONTAINMENT),this._widget.addFilterItem("Containment",a.META_RELATIONS.CONTAINMENT,t),t=a.createButtonIcon(a.META_RELATIONS.POINTER),this._widget.addFilterItem("Pointer",a.META_RELATIONS.POINTER,t),t=a.createButtonIcon(a.META_RELATIONS.INHERITANCE),this._widget.addFilterItem("Inheritance",a.META_RELATIONS.INHERITANCE,t),t=a.createButtonIcon(a.META_RELATIONS.SET),this._widget.addFilterItem("Set",a.META_RELATIONS.SET,t)},d.prototype._onConnectionTypeFilterCheckChanged=function(t,e){var n;e===!0?(n=this._filteredOutConnTypes.indexOf(t),this._filteredOutConnTypes.splice(n,1),this._unfilterConnType(t)):(this._filteredOutConnTypes.push(t),this._filterConnType(t)),this._initActiveTab||this._updateCrosscutRegistry()},d.prototype._filterConnType=function(t){var e,n,i,o,r,s=this._connectionListByType&&this._connectionListByType.hasOwnProperty(t)?this._connectionListByType[t].length:0;for(this._filteredOutConnectionDescriptors[t]=[],this._widget.beginUpdate();s--;)e=this._connectionListByType[t][s],n=this._connectionListByID[e].GMESrcId,i=this._connectionListByID[e].GMEDstId,o=this._connectionListByID[e].connTexts,t===a.META_RELATIONS.POINTER&&(r=this._connectionListByID[e].name),this._filteredOutConnectionDescriptors[t].push([n,i,o]),this._removeConnection(n,i,t,r);this._widget.endUpdate()},d.prototype._unfilterConnType=function(t){var e,n,i,o=this._filteredOutConnectionDescriptors&&this._filteredOutConnectionDescriptors.hasOwnProperty(t)?this._filteredOutConnectionDescriptors[t].length:0;for(this._widget.beginUpdate();o--;)e=this._filteredOutConnectionDescriptors[t][o][0],n=this._filteredOutConnectionDescriptors[t][o][1],i=this._filteredOutConnectionDescriptors[t][o][2],this._createConnection(e,n,t,i);delete this._filteredOutConnectionDescriptors[t],this._widget.endUpdate()},d.prototype._updateCrosscutRegistry=function(){var t,n,i=this._client.getNode(this._memberListContainerID),o=i.getOwnEditableRegistry(e.CROSSCUTS),r=Number(this._activeCrosscutId);if(n=this._client.getNode(i.getBaseId()),void 0!==o||null!==n&&void 0!==n.getRegistry(e.CROSSCUTS)||(o=[]),o){for(t=0;t<o.length;t+=1)o[t].order===r&&(o[t].filter=this._filteredOutConnTypes);this._client.setRegistry(this._memberListContainerID,e.CROSSCUTS,o)}},d.prototype._selectedTabChanged=function(t){if(t!==this._activeCrosscutId){this._activeCrosscutId=t,this._initActiveTab=!0;var n,i=this._client.getNode(this._memberListContainerID),o=i?i.getEditableRegistry(e.CROSSCUTS):[],r=Number(this._activeCrosscutId),s=[];for(n=0;n<o.length;n+=1)o[n].order===r&&(s=o[n].filter||[]);for(this._widget._filterCheckboxes[a.META_RELATIONS.CONTAINMENT]&&this._widget.setChecked(a.META_RELATIONS.CONTAINMENT,!0),this._widget._filterCheckboxes[a.META_RELATIONS.POINTER]&&this._widget.setChecked(a.META_RELATIONS.POINTER,!0),this._widget._filterCheckboxes[a.META_RELATIONS.INHERITANCE]&&this._widget.setChecked(a.META_RELATIONS.INHERITANCE,!0),this._widget._filterCheckboxes[a.META_RELATIONS.SET]&&this._widget.setChecked(a.META_RELATIONS.SET,!0),n=0;n<s.length;n+=1)this._widget.setChecked(s[n],!1);this._initActiveTab=!1}},d.getDefaultConfig=function(){return{autoCreateCrosscut:!1}},d.getComponentId=function(){return"GenericUICrosscutController"},d}),define("js/Panels/Crosscut/CrosscutPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/Crosscut/CrosscutWidget","./CrosscutController"],function(t,e,n,i){"use strict";var o;return o=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="CrosscutPanel",i[t.OPTIONS.FLOATING_TITLE]=!0,t.apply(this,[i,e]),this._client=n.client,this._initialize(),this.logger.debug("CrosscutPanel ctor finished")},_.extend(o.prototype,t.prototype),_.extend(o.prototype,e.prototype),o.prototype._initialize=function(){var t=this;this.widget=new n(this.$el,{toolBar:this.toolBar}),this.widget.setTitle=function(e){t.setTitle(e)},this.widget.onUIActivity=function(){WebGMEGlobal.PanelManager.setActivePanel(t),WebGMEGlobal.KeyboardManager.setListener(t.widget)},this.control=new i({client:this._client,widget:this.widget}),this.control.setReadOnly=function(e){t.setReadOnly(e)},this.onActivate()},o.prototype.onReadOnlyChanged=function(e){t.prototype.onReadOnlyChanged.call(this,e),this.widget.setReadOnly(e),this.control.setReadOnly(e)},o.prototype.onResize=function(t,e){this.logger.debug("onResize --> width: "+t+", height: "+e),this.widget.onWidgetContainerResize(t,e)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),t.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o}),define("js/Widgets/GraphViz/GraphVizWidget.Zoom",["js/Widgets/ZoomWidget/ZoomWidget"],function(t){"use strict";var e;return e=function(){},e.prototype._initZoom=function(e){e=e||{};var n=new t({zoomValues:e.zoomValues,"class":"graph-viz-zoom-container",sliderClass:"graph-viz-zoom-slider",zoomTarget:this._el.find("svg")});this._zoomSlider=n.$zoomSlider,this._el.parent().append(n.$zoomContainer),this._addZoomMouseHandler(this._el)},e.prototype._addZoomMouseHandler=function(t){var e=this;t.attr("tabindex",0),t.mouseenter(function(){$(this).focus()}),t.on("mousewheel",function(t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey||n.altKey)&&(n.wheelDelta<0?e._zoomSlider.csszoom("zoomOut"):e._zoomSlider.csszoom("zoomIn"),t.stopPropagation(),t.preventDefault())}),t.on("DOMMouseScroll",function(t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey||n.altKey)&&(n.detail>0?e._zoomSlider.csszoom("zoomOut"):e._zoomSlider.csszoom("zoomIn"),t.stopPropagation(),t.preventDefault())})},e}),define("css!js/Widgets/GraphViz/styles/GraphVizWidget",[],function(){}),define("js/Widgets/GraphViz/GraphVizWidget",["js/logger","js/Widgets/GraphViz/GraphVizWidget.Zoom","js/Utils/ComponentSettings","d3","css!./styles/GraphVizWidget.css"],function(t,e,n){"use strict";var i,o="graph-viz",r=750,s=20,a=0,l="closed",c="open",d="LEAF",h="opening",p="CLOSING",g=15,u=180;return i=function(e){var o=i.getDefaultConfig();this._logger=t.create("gme:Widgets:GraphViz:GraphVizWidget",WebGMEGlobal.gmeConfig.client.log),n.resolveWithWebGMEGlobal(o,i.getComponentId()),this._el=e,this._initialize(),this._initZoom(o),this._logger.debug("GraphVizWidget ctor finished")},i.prototype._initialize=function(){var t=this._el.width(),e=this._el.height(),n=this;this._el.addClass(o),this._root=void 0,this._tree=d3.layout.tree().sort(function(t,e){return t.name<e.name?-1:t.name>e.name?1:0}),this.__svg=d3.select(this._el[0]).append("svg"),this._resizeD3Tree(t,e),this._svg=this.__svg.append("g").attr("transform","translate("+s+","+s+")"),this._el.on("dblclick",function(t){t.stopPropagation(),t.preventDefault(),n.onBackgroundDblClick()})},i.prototype.onWidgetContainerResize=function(t,e){this._resizeD3Tree(t,e),this._root&&this._update(void 0)},i.prototype._resizeD3Tree=function(t,e){var n=this._el.width(),i=this._el.height();t=Math.max(n,t),e=Math.max(i,e),this._tree.size([e-2*s,t-2*s]),this.__svg.attr("width",t).attr("height",e)},i.prototype._update=function(t){var e=this,n=this._tree.nodes(this._root).reverse(),i=this._tree.links(n),o=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),s=function(t){var e=d;return t.childrenNum>0&&(e=l,t.children&&t.children.length===t.childrenNum&&(e=c)),e};n.forEach(function(t){t.y=t.depth*u,t.status=t.status||s(t)});var f=this._svg.selectAll("g.node").data(n,function(t){return t.id||(t.id=++a)}),m=function(t){var e=t.name;return t.childrenNum>0&&(e+=" ["+t.childrenNum+"]"),e},_=f.enter().append("g").attr("class","node").attr("transform",function(t){return t.parent?"translate("+t.parent.y0+","+t.parent.x0+")":"translate("+t.y+","+t.x+")"}).on("click",function(t){d3.event.stopPropagation(),d3.event.preventDefault(),e._onNodeClick(t)}).on("dblclick",function(t){d3.event.preventDefault(),d3.event.stopPropagation(),e._onNodeDblClick(t)});_.append("circle").attr("r",1e-6),_.append("text").attr("dy",".35em").style("fill-opacity",1e-6);var b=f.transition().duration(r).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});b.select("circle").attr("r",4.5),b.select("circle").style("fill",function(t){var e=t.status,n="#FFFFFF";return e===l?n="lightsteelblue":e===h?n="#ff0000":e===c?n="#ffFFFF":e===d?n="#ffFFFF":e===p&&(n="#00FF00"),n}),b.select("text").attr("x",function(t){return t.children&&t.children.length>0?-10:10}).attr("text-anchor",function(t){return t.children&&t.children.length>0?"end":"start"}).text(function(t){return m(t)}).style("fill-opacity",1);var y=f.exit().transition().duration(r).attr("transform",function(e){return t?"translate("+t.y+","+t.x+")":e.parent?"translate("+e.parent.y+","+e.parent.x+")":"translate("+e.y+","+e.x+")"}).remove();y.select("circle").attr("r",1e-6),y.select("text").style("fill-opacity",1e-6);var v=this._svg.selectAll("path.link").data(i,function(t){return t.target.id});v.enter().insert("path","g").attr("class","link").attr("d",function(t){var e={x:t.source.x0||t.source.y,y:t.source.y0||t.source.y};return o({source:e,target:e})}),v.transition().duration(r).attr("d",o),v.exit().transition().duration(r).attr("d",function(t){var e={x:t.source.x,y:t.source.y};return o({source:e,target:e})}).remove();var C=[];if(n.forEach(function(t){t.x0=t.x,t.y0=t.y,C[t.depth]=C[t.depth]||[],C[t.depth].push(t.x)}),this.__resizing!==!0){var E=C.length,D=[];for(a=1;E>a;a+=1){C[a].sort(function(t,e){return t-e});var I,P=C[a].length;for(I=0;P-1>I;I+=1)if(C[a][I+1]-g<=C[a][I]){D.push([a,P]);break}}this._logger.debug("Collide:"+D);var T=0,A=D.length;if(this.__resizing=!0,A>0)for(;A--;)T+=D[A][1];else T=this._el.height()/g;this._resizeD3Tree(C.length*u,T*g),this._update(),this.__resizing=!1}},i.prototype._onNodeClick=function(t){switch(t.status){case l:t.status=h,this._update(void 0),this.onNodeOpen(t.id);break;case c:t.status=p,t.children=void 0,this._update(t),this.onNodeClose(t.id);break;case h:break;case p:break;case d:}},i.prototype._onNodeDblClick=function(t){this.onNodeDblClick(t.id)},i.prototype.setData=function(t){this.__root=this._root,this._root=$.extend(!0,{},t);var e=function(t,n){var i,o;if(t&&n&&t.id===n.id&&(n.x0=t.x0,n.y0=t.y0,i=t.children?t.children.length:0,i>0))for(;i--;)if(o=n.children?n.children.length:0,o>0)for(;o--;)e(t.children[i],n.children[o])};e(this.__root,this._root),delete this.__root;var n=this._el.width(),i=this._el.height();if(this._resizeD3Tree(n,i),this._update(void 0),this._root&&this._root.name){var o=6*this._root.name.length;this._root.children&&(o=6*(this._root.name+" ["+this._root.children.length+"]").length),this._el.find("svg > g").attr("transform","translate("+(o+s)+","+s+")")}},i.prototype.onNodeOpen=function(){},i.prototype.onNodeClose=function(){},i.prototype.onNodeDblClick=function(){},i.prototype.onBackgroundDblClick=function(){},i.prototype.destroy=function(){},i.prototype.onActivate=function(){},i.prototype.onDeactivate=function(){},_.extend(i.prototype,e.prototype),i.getDefaultConfig=function(){return{zoomValues:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.2,1.4,1.6,1.8,2,2.5,3,3.5,4]}},i.getComponentId=function(){return"GenericUIGraphVizWidget"},i}),define("js/Panels/GraphViz/GraphVizPanelControl",["js/logger","js/util","js/Constants","js/Utils/GMEConcepts","js/NodePropertyNames"],function(t,e,n,i,o){"use strict";var r;return r=function(e){this._logger=t.create("gme:Panels:GraphViz:GraphVizControl",WebGMEGlobal.gmeConfig.client.log),this._client=e.client,this._graphVizWidget=e.widget,this._currentNodeId=null,this._currentNodeParentId=void 0,this._displayModelsOnly=!1,this._initWidgetEventHandlers(),this._logger.debug("Created")},r.prototype._initWidgetEventHandlers=function(){var t=this;this._graphVizWidget.onBackgroundDblClick=function(){t._currentNodeParentId&&WebGMEGlobal.State.registerActiveObject(t._currentNodeParentId)},this._graphVizWidget.onNodeOpen=function(e){t._selfPatterns[e]={children:1},t._client.updateTerritory(t._territoryId,t._selfPatterns)},this._graphVizWidget.onNodeDblClick=function(t){WebGMEGlobal.State.registerActiveObject(t)},this._graphVizWidget.onNodeClose=function(e){var n,i,o,r;n=function(e){if(t._selfPatterns.hasOwnProperty(e)){if(i=t._nodes[e])for(o=i.childrenIDs,r=0;r<o.length;r+=1)n(o[r]);delete t._selfPatterns[e]}},n(e),e===t._currentNodeId&&(t._selfPatterns[e]={children:0}),t._client.updateTerritory(t._territoryId,t._selfPatterns)}},r.prototype.selectedObjectChanged=function(t){var e=this._getObjectDescriptor(t),i=this;this._logger.debug("activeObject nodeId '"+t+"'"),this._currentNodeId&&this._client.removeUI(this._territoryId),this._currentNodeId=t,this._currentNodeParentId=void 0,this._nodes={},(this._currentNodeId||this._currentNodeId===n.PROJECT_ROOT_ID)&&(this._selfPatterns={},this._selfPatterns[t]={children:0},this._graphVizWidget.setTitle(e.name.toUpperCase()),e.parentId||e.parentId===n.PROJECT_ROOT_ID?this.$btnModelHierarchyUp.show():this.$btnModelHierarchyUp.hide(),this._currentNodeParentId=e.parentId,this._territoryId=this._client.addUI(this,function(t){i._eventCallback(t)}),this._client.updateTerritory(this._territoryId,this._selfPatterns),setTimeout(function(){i._selfPatterns[t]={children:1},i._client.updateTerritory(i._territoryId,i._selfPatterns)},1e3))},r.prototype._getObjectDescriptor=function(t){var e,n=this._client.getNode(t);return n&&(e={id:void 0,name:void 0,childrenIDs:void 0,parentId:void 0,isConnection:!1},e.id=n.getId(),e.name=n.getAttribute(o.Attributes.name),e.childrenIDs=n.getChildrenIds(),e.childrenNum=e.childrenIDs.length,e.parentId=n.getParentId(),e.isConnection=i.isConnection(t)),e},r.prototype._eventCallback=function(t){var e,i=t?t.length:0;for(this._logger.debug("_eventCallback '"+i+"' items");i--;)switch(e=t[i],e.etype){case n.TERRITORY_EVENT_LOAD:this._onLoad(e.eid);break;case n.TERRITORY_EVENT_UPDATE:this._onUpdate(e.eid);break;case n.TERRITORY_EVENT_UNLOAD:this._onUnload(e.eid)}this._generateData(),this._logger.debug("_eventCallback '"+t.length+"' items - DONE")},r.prototype._generateData=function(){function t(e){for(var n=e&&e.childrenIDs?e.childrenIDs.length:0;n--;)e.children=e.children||[],i._nodes[e.childrenIDs[n]]&&(i._displayModelsOnly===!0&&i._nodes[e.childrenIDs[n]].isConnection!==!0||i._displayModelsOnly===!1)&&(e.children.push(_.extend({},i._nodes[e.childrenIDs[n]])),t(e.children[e.children.length-1]))}var e,i=this;e=_.extend({},this._currentNodeId||this._currentNodeId===n.PROJECT_ROOT_ID?this._nodes[this._currentNodeId]:{}),t(e),this._graphVizWidget.setData(e)},r.prototype._onLoad=function(t){this._nodes[t]=this._getObjectDescriptor(t)},r.prototype._onUpdate=function(t){this._nodes[t]=this._getObjectDescriptor(t)},r.prototype._onUnload=function(t){delete this._nodes[t]},r.prototype.destroy=function(){this._detachClientEventListeners()},r.prototype._stateActiveObjectChanged=function(t,e){this._currentNodeId===e?this._logger.debug("Disregarding activeObject changed when it is already the same."):this.selectedObjectChanged(e)},r.prototype._attachClientEventListeners=function(){this._detachClientEventListeners(),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged,this)},r.prototype._detachClientEventListeners=function(){WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged)},r.prototype.onActivate=function(){this._attachClientEventListeners(),this._displayToolbarItems(),"string"==typeof this._currentNodeId&&WebGMEGlobal.State.registerActiveObject(this._currentNodeId)},r.prototype.onDeactivate=function(){this._detachClientEventListeners(),this._hideToolbarItems()},r.prototype._displayToolbarItems=function(){var t;if(this._toolbarInitialized===!0)for(t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].show();else this._initializeToolbar()},r.prototype._hideToolbarItems=function(){var t;if(this._toolbarInitialized===!0)for(t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].hide()},r.prototype._removeToolbarItems=function(){var t;if(this._toolbarInitialized===!0)for(t=0;t<this._toolbarItems.length;t++)this._toolbarItems[t].destroy()},r.prototype._initializeToolbar=function(){var t=WebGMEGlobal.Toolbar,e=this;this._toolbarItems=[],this._toolbarItems.push(t.addSeparator()),this.$btnModelHierarchyUp=t.addButton({title:"Go to parent",icon:"glyphicon glyphicon-circle-arrow-up",clickFn:function(){WebGMEGlobal.State.registerActiveObject(e._currentNodeParentId)}}),this._toolbarItems.push(this.$btnModelHierarchyUp),this.$btnModelHierarchyUp.hide(),this.$cbShowConnection=t.addCheckBox({title:"Show connection",icon:"gme icon-gme_diagonal-arrow",checkChangedFn:function(t,n){e._displayModelsOnly=!n,e._generateData()}}),this._toolbarItems.push(this.$cbShowConnection),this._toolbarInitialized=!0},r}),define("js/Panels/GraphViz/GraphVizPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/GraphViz/GraphVizWidget","./GraphVizPanelControl"],function(t,e,n,i){"use strict";var o;return o=function(e,n){var i={};i[t.OPTIONS.LOGGER_INSTANCE_NAME]="GraphVizPanel",i[t.OPTIONS.FLOATING_TITLE]=!0,t.apply(this,[i,e]),this._client=n.client,this._initialize(),this.logger.debug("GraphVizPanel ctor finished")},_.extend(o.prototype,t.prototype),_.extend(o.prototype,e.prototype),o.prototype._initialize=function(){var t=this;this.setTitle(""),this.widget=new n(this.$el),this.widget.setTitle=function(e){t.setTitle(e)},this.control=new i({client:this._client,widget:this.widget}),this.onActivate()},o.prototype.onReadOnlyChanged=function(e){t.prototype.onReadOnlyChanged.call(this,e)},o.prototype.onResize=function(t,e){this.logger.debug("onResize --> width: "+t+", height: "+e),this.widget.onWidgetContainerResize(t,e)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),t.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o}),define("js/Decorators/DecoratorBase",["js/logger"],function(t){"use strict";var e,n="DecoratorBase";return e=function(e){var n="gme:Decorators:DecoratorBase:";n=n+=e.loggerName?e.loggerName:this.DECORATORID,this.logger=t.create(n,WebGMEGlobal.gmeConfig.client.log),this.supportedWidgetMap={},this.initializeSupportedWidgetMap(),this.logger.debug("Created")},e.prototype.DECORATORID=n,e.prototype.initializeSupportedWidgetMap=function(){},e.prototype.getDecoratorForWidget=function(t){return this.supportedWidgetMap[t]},e}),define("decorators/CircleDecorator/Core/CircleDecorator.Core",["js/Constants","js/Utils/DisplayFormat"],function(t,e){"use strict";var n,i=11;return n=function(){},n.prototype.DECORATOR_DEFAULT_PARAMS={displayName:!0},n.prototype._initializeVariables=function(t){this.formattedName="",this.circleSize=i,this._displayConnectors=!1,t&&t.connectors&&(this._displayConnectors=t.connectors)},n.prototype.destroy=function(){},n.prototype.doSearch=function(t){var e=t.toString().toLowerCase();return this.formattedName&&-1!==this.formattedName.toLowerCase().indexOf(e)},n.prototype._renderContent=function(){this.$el.attr({"data-id":this._metaInfo[t.GME_ID]}),this.skinParts.$name=this.$el.find(".name"),this.decoratorParams.displayName===!1&&(this.skinParts.$name.remove(),delete this.skinParts.$name),this._update()},n.prototype._update=function(){this._updateName()},n.prototype._updateName=function(){var n=this._control._client,i=n.getNode(this._metaInfo[t.GME_ID]),o="(N/A)";this.skinParts.$name&&(i?this.formattedName=e.resolve(i):this.formattedName=o,this.skinParts.$name.text(this.formattedName),this.skinParts.$name.attr("title",this.formattedName))},n}),define("text!decorators/CircleDecorator/Core/CircleDecorator.html",[],function(){return'<div class="circle-decorator">\n    <svg width="11" height="11" xmlns="http://www.w3.org/2000/svg">\n        <circle cx="5.5" cy="5.5" r="5" stroke="#000" fill="#000"/>\n    </svg>\n    <div class="circle-shadow"></div>\n    <span class="name"></span>\n\n    <div class=\'connector\'></div>\n</div>'}),define("css!decorators/CircleDecorator/DiagramDesigner/CircleDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/CircleDecorator/DiagramDesigner/CircleDecorator.DiagramDesignerWidget",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase","../Core/CircleDecorator.Core","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/CircleDecorator.html","css!./CircleDecorator.DiagramDesignerWidget.css"],function(t,e,n,i){"use strict";var o,r="CircleDecoratorDiagramDesignerWidget";return o=function(n){var i=_.extend({},n);t.apply(this,[i]),e.apply(this,[i]),this._initializeVariables({connectors:!0}),this.logger.debug("CircleDecoratorDiagramDesignerWidget ctor")},_.extend(o.prototype,t.prototype),_.extend(o.prototype,e.prototype),o.prototype.DECORATORID=r,o.prototype.$DOMBase=$(i),o.prototype.on_addTo=function(){this._renderContent()},o.prototype.update=function(){this._update()},o.prototype.onRenderGetLayoutInfo=function(){t.prototype.onRenderGetLayoutInfo.apply(this,arguments),this.skinParts.$name&&(this.renderLayoutInfo.nameWidth=this.skinParts.$name.outerWidth())},o.prototype.onRenderSetLayoutInfo=function(){if(this.renderLayoutInfo&&this.skinParts.$name){var e=(this.circleSize-this.renderLayoutInfo.nameWidth)/2;this.skinParts.$name.css({left:e})}t.prototype.onRenderSetLayoutInfo.apply(this,arguments)},o.prototype.calculateDimension=function(){var t=this.circleSize;this.hostDesignerItem&&this.hostDesignerItem.setSize(t,t)},o.prototype.getConnectionAreas=function(){var t=[],e=10,n=this.circleSize,i=Math.floor(n/2);return t.push({id:"N",x1:i,y1:0,x2:i,y2:0,angle1:270,angle2:270,len:e}),t.push({id:"S",x1:i,y1:n-1,x2:i,y2:n-1,angle1:90,angle2:90,len:e}),t.push({id:"W",x1:0,y1:i,x2:0,y2:i,angle1:180,angle2:180,len:e}),t.push({id:"E",x1:n-1,y1:i,x2:n-1,y2:i,angle1:0,angle2:0,len:e}),t},o}),define("js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase",["js/logger","js/Decorators/WidgetDecoratorBase"],function(t,e){"use strict";var n,i="PartBrowserWidgetDecoratorBase";return n=function(t){e.call(this,t),this.skinParts={},this._initialize(),this.logger.debug("Created")},_.extend(n.prototype,e.prototype),n.prototype.DECORATORID=i,n.prototype.setControl=function(t){this._control=t},n.prototype.getControl=function(){return this._control},n.prototype.setMetaInfo=function(t){this._metaInfo=t},n.prototype.getMetaInfo=function(){return this._metaInfo},n.prototype.getTerritoryQuery=function(){return void 0},n.prototype.notifyComponentEvent=function(t){this.logger.warn("notifyComponentEvent "+t)},n.prototype._initialize=function(){this.$el=$("<div/>")},n.prototype.beforeAppend=function(){},n.prototype.afterAppend=function(){},n.prototype.destroy=function(){this.logger.debug("PartBrowserWidgetDecoratorBase.destroyed")},n.prototype.update=function(){},n}),define("css!decorators/CircleDecorator/PartBrowser/CircleDecorator.PartBrowserWidget",[],function(){}),define("decorators/CircleDecorator/PartBrowser/CircleDecorator.PartBrowserWidget",["js/Constants","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","../Core/CircleDecorator.Core","text!../Core/CircleDecorator.html","css!./CircleDecorator.PartBrowserWidget.css"],function(t,e,n,i,o,r){"use strict";var s,a="CircleDecoratorPartBrowserWidget";return s=function(t){var e=_.extend({},t);n.apply(this,[e]),o.apply(this,[e]),this._initializeVariables({connectors:!1}),this.logger.debug("CircleDecoratorPartBrowserWidget ctor")},_.extend(s.prototype,n.prototype),_.extend(s.prototype,o.prototype),s.prototype.DECORATORID=a,s.prototype.$DOMBase=function(){var t=$(r);return t.find("."+i.CONNECTOR_CLASS).remove(),t.find(".circle-shadow").remove(),t}(),s.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this._renderContent()},s.prototype.afterAppend=function(){this._update()},s.prototype.update=function(){this._update()},s.prototype._updateName=function(){if(o.prototype._updateName.call(this),this.skinParts.$name){var t=this.skinParts.$name.outerWidth(),e=(this.circleSize-t)/2;this.skinParts.$name.css({left:e})}},s}),define("decorators/CircleDecorator/CircleDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/CircleDecorator.DiagramDesignerWidget","./PartBrowser/CircleDecorator.PartBrowserWidget"],function(t,e,n){"use strict";var i,o="CircleDecorator";return i=function(e){var n=_.extend({loggerName:this.DECORATORID},e);t.apply(this,[n]),this.logger.debug("CircleDecorator ctor")},_.extend(i.prototype,t.prototype),i.prototype.DECORATORID=o,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:e,PartBrowser:n}},i}),define("text!decorators/DefaultDecorator/DiagramDesigner/DefaultDecorator.DiagramDesignerWidget.html",[],function(){return"<div class=\"default-decorator\">\n    <div class=\"name\"></div>\n    <div class='connector bottom'></div>\n    <div class='connector top'></div>\n</div>"}),define("css!decorators/DefaultDecorator/DiagramDesigner/DefaultDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/DefaultDecorator/DiagramDesigner/DefaultDecorator.DiagramDesignerWidget",["js/Constants","js/NodePropertyNames","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase","text!./DefaultDecorator.DiagramDesignerWidget.html","css!./DefaultDecorator.DiagramDesignerWidget.css"],function(t,e,n,i){"use strict";var o,r=n,s=n.prototype,a="DefaultDecorator";return o=function(t){var e=_.extend({},t);r.apply(this,[e]),this.name="",this.logger.debug("DefaultDecorator ctor")},_.extend(o.prototype,s),o.prototype.DECORATORID=a,o.prototype.$DOMBase=$(i),o.prototype.on_addTo=function(){var t=this;this._renderName(),this.skinParts.$name.on("dblclick.editOnDblClick",null,function(e){t.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(e,n){t._onNodeTitleChanged(e,n)}}),e.stopPropagation(),e.preventDefault()}),s.on_addTo.apply(this,arguments)},o.prototype._renderName=function(){var e=this._control._client,n=e.getNode(this._metaInfo[t.GME_ID]);this.$el.attr({"data-id":this._metaInfo[t.GME_ID]}),n&&(this.name=n.getFullyQualifiedName()),this.skinParts.$name=this.$el.find(".name"),this.skinParts.$name.text(this.name)},o.prototype.update=function(){var e=this._control._client,n=e.getNode(this._metaInfo[t.GME_ID]),i="";n&&(i=n.getFullyQualifiedName(),this.name!==i&&(this.name=i,this.skinParts.$name.text(this.name)))},o.prototype.getConnectionAreas=function(t){var e=[],n=10,i=20;return(void 0===t||t===this.hostDesignerItem.id)&&(e.push({id:"0",x1:n,y1:0,x2:this.hostDesignerItem.getWidth()-n,y2:0,angle1:270,angle2:270,len:i}),e.push({id:"1",x1:this.hostDesignerItem.getWidth(),y1:n,x2:this.hostDesignerItem.getWidth(),y2:this.hostDesignerItem.getHeight()-n,angle1:0,angle2:0,len:i}),e.push({id:"2",x1:n,y1:this.hostDesignerItem.getHeight(),x2:this.hostDesignerItem.getWidth()-n,y2:this.hostDesignerItem.getHeight(),angle1:90,angle2:90,len:i}),e.push({id:"3",x1:0,y1:n,x2:0,y2:this.hostDesignerItem.getHeight()-n,angle1:180,angle2:180,len:i})),e},o.prototype._onNodeTitleChanged=function(n,i){var o=this._control._client;o.setAttribute(this._metaInfo[t.GME_ID],e.Attributes.name,i)},o.prototype.doSearch=function(t){var e=t.toString();return this.name&&-1!==this.name.toLowerCase().indexOf(e.toLowerCase())?!0:!1},o}),define("css!decorators/DefaultDecorator/PartBrowser/DefaultDecorator.PartBrowserWidget",[],function(){}),define("decorators/DefaultDecorator/PartBrowser/DefaultDecorator.PartBrowserWidget",["js/Constants","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../DiagramDesigner/DefaultDecorator.DiagramDesignerWidget.html","css!../DiagramDesigner/DefaultDecorator.DiagramDesignerWidget.css","css!./DefaultDecorator.PartBrowserWidget.css"],function(t,e,n,i,o){"use strict";var r,s=n,a="DefaultDecoratorPartBrowserWidget";return r=function(t){var e=_.extend({},t);s.apply(this,[e]),this.logger.debug("DefaultDecoratorPartBrowserWidget ctor")},_.extend(r.prototype,s.prototype),r.prototype.DECORATORID=a,r.prototype.$DOMBase=function(){var t=$(o);return t.find("."+i.CONNECTOR_CLASS).remove(),t}(),r.prototype.beforeAppend=function(){
this.$el=this.$DOMBase.clone(),this.skinParts.$name=this.$el.find(".name"),this._renderContent()},r.prototype.afterAppend=function(){},r.prototype._renderContent=function(){var e=this._control._client,n=e.getNode(this._metaInfo[t.GME_ID]);DEBUG&&this.$el.attr({"data-id":this._metaInfo[t.GME_ID]}),n&&this.skinParts.$name.text(n.getFullyQualifiedName())},r.prototype.update=function(){this._renderContent()},r}),define("decorators/DefaultDecorator/DefaultDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/DefaultDecorator.DiagramDesignerWidget","./PartBrowser/DefaultDecorator.PartBrowserWidget"],function(t,e,n){"use strict";var i,o=t,r=t.prototype,s="DefaultDecorator";return i=function(t){var e=_.extend({loggerName:this.DECORATORID},t);o.apply(this,[e]),this.logger.debug("DefaultDecorator ctor")},_.extend(i.prototype,r),i.prototype.DECORATORID=s,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:e,PartBrowser:n}},i}),define("decorators/DocumentDecorator/Core/DocumentDecorator.Core",["js/RegistryKeys","js/Constants"],function(t,e){"use strict";function n(){}return n.prototype._updateColors=function(t){this._getNodeColorsFromRegistry(),this.fillColor?this.$el.css({"background-color":this.fillColor}):this.$el.css({"background-color":""}),this.textColor?this.$el.css({color:this.textColor}):this.$el.css({color:""}),t||(this.borderColor?(this.$el.css({"border-color":this.borderColor,"box-shadow":"0px 0px 7px 0px "+this.borderColor+" inset"}),this.skinParts.$name.css({"border-color":this.borderColor})):(this.$el.css({"border-color":"","box-shadow":""}),this.skinParts.$name.css({"border-color":""})))},n.prototype._getNodeColorsFromRegistry=function(){var n=this._metaInfo[e.GME_ID];this.fillColor=this.preferencesHelper.getRegistry(n,t.COLOR,!0),this.borderColor=this.preferencesHelper.getRegistry(n,t.BORDER_COLOR,!0),this.textColor=this.preferencesHelper.getRegistry(n,t.TEXT_COLOR,!0)},n}),define("text!decorators/DocumentDecorator/DiagramDesigner/DocumentEditorDialog.html",[],function(){return'<div class="meta-text-editor-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-xlg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Edit Comment Documentation</h3>\n            </div>\n            <form class="modal-body form-horizontal" role="form">\n                <div class="control-group" id="pMeta">\n                    <label class="control-label"></label>\n                    <div class="controls"></div>\n                </div>\n            </form>\n            <div class="modal-footer">\n                <a href="#" class="btn btn-primary btn-save">Save</a>\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("decorators/DocumentDecorator/DiagramDesigner/DocumentEditorDialog",["js/util","epiceditor","text!./DocumentEditorDialog.html"],function(t,e,n){"use strict";var i;return i=function(){this._dialog=$(n),this._dialog.appendTo($(document.body)),this._el=this._dialog.find(".modal-body").first(),this._btnSave=this._dialog.find(".btn-save").first(),this._pMeta=this._el.find("#pMeta").first(),this._content=this._pMeta.find("div.controls").first();var t={container:this._content.get(0),basePath:"bower_components/EpicEditor/epiceditor",autogrow:{minHeight:300},button:{fullscreen:!0},parser:e};this.editor=new EpicEditor(t),this.text=""},i.prototype.initialize=function(t,e){var n=this;this.text=t,this._dialog.modal({show:!1}),this._btnSave.on("click",function(t){e&&e.call(null,n.editor.exportFile()),n._dialog.modal("hide"),t.stopPropagation(),t.preventDefault()}),this._dialog.on("shown.bs.modal",function(){n.editor.is("loaded")||n.editor.load(),n.editor.importFile("epiceditor",n.text)}),this._dialog.on("hidden.bs.modal",function(){n._dialog.empty(),n._dialog.remove(),n.editor.remove()})},i.prototype.updateText=function(t){this.text=t},i.prototype.show=function(){var t=this;t._dialog.modal("show")},i}),define("text!decorators/DocumentDecorator/DiagramDesigner/DocumentDecorator.DiagramDesignerWidget.html",[],function(){return'<div class="Document-decorator">\n    <div class="name"></div>\n    <div class="doc"></div>\n    <div class=\'connector bottom\'></div>\n    <div class=\'connector top\'></div>\n</div>'}),define("css!decorators/DocumentDecorator/DiagramDesigner/DocumentDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/DocumentDecorator/DiagramDesigner/DocumentDecorator.DiagramDesignerWidget",["epiceditor","js/Constants","js/NodePropertyNames","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase","../Core/DocumentDecorator.Core","./DocumentEditorDialog","text!./DocumentDecorator.DiagramDesignerWidget.html","css!./DocumentDecorator.DiagramDesignerWidget.css"],function(t,e,n,i,o,r,s){"use strict";var a,l="DocumentDecorator",c=$('<i class="glyphicon glyphicon-cog text-meta" title="Edit documentation" />');return a=function(e){var n=_.extend({},e);i.apply(this,[n]),o.apply(this,[n]),this.name="",this._skinParts={},this.$doc=this.$el.find(".doc").first(),t.setOptions({gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),this.logger.debug("DocumentDecorator ctor")},_.extend(a.prototype,i.prototype),_.extend(a.prototype,o.prototype),a.prototype.DECORATORID=l,a.prototype.$DOMBase=$(s),a.prototype.on_addTo=function(){var t=this,n=this._control._client,o=n.getNode(this._metaInfo[e.GME_ID]);this._renderName(),this._skinParts.$EditorBtn=c.clone(),this.$el.append(this._skinParts.$EditorBtn),this._skinParts.$EditorBtn.on("click",function(e){t.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&void 0!==o.getAttribute("documentation")&&t._showEditorDialog(),e.stopPropagation(),e.preventDefault()}),this.skinParts.$name.on("dblclick.editOnDblClick",null,function(e){t.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(e,n){t._onNodeTitleChanged(e,n)}}),e.stopPropagation(),e.preventDefault()}),this.skinParts.$name.on("click",function(e){t.skinParts.$name.popover({}),t.skinParts.$name.popover("show"),t.logger.debug(t.skinParts.$name.popover),e.stopPropagation(),e.preventDefault()}),i.prototype.on_addTo.apply(this,arguments),t.update()},a.prototype._renderName=function(){var t=this._control._client,i=t.getNode(this._metaInfo[e.GME_ID]);this.$el.attr({"data-id":this._metaInfo[e.GME_ID]}),i&&(this.name=i.getAttribute(n.Attributes.name)||""),this.skinParts.$name=this.$el.find(".name"),this.skinParts.$name.text(this.name)},a.prototype.update=function(){var i=this._control._client,o=this,r=i.getNode(this._metaInfo[e.GME_ID]),s="",a="";r&&(s=r.getAttribute(n.Attributes.name)||"",a=r.getAttribute("documentation"),this.$doc.empty(),void 0===a?(this.$doc.append('Editor is disabled because attribute "documentation" is not found in Meta-Model'),this._skinParts.$EditorBtn.addClass("not-activated")):(o.hostDesignerItem.canvas.getIsReadOnlyMode()===!1?o._skinParts.$EditorBtn.removeClass("not-activated"):o._skinParts.$EditorBtn.addClass("not-activated"),this.$doc.append($(t(a)))),this.name!==s&&(this.name=s,this.skinParts.$name.text(this.name))),this._updateColors()},a.prototype.getConnectionAreas=function(t){var e=[],n=10,i=20;return(void 0===t||t===this.hostDesignerItem.id)&&(e.push({id:"0",x1:n,y1:0,x2:this.hostDesignerItem.getWidth()-n,y2:0,angle1:270,angle2:270,len:i}),e.push({id:"1",x1:this.hostDesignerItem.getWidth(),y1:n,x2:this.hostDesignerItem.getWidth(),y2:this.hostDesignerItem.getHeight()-n,angle1:0,angle2:0,len:i}),e.push({id:"2",x1:n,y1:this.hostDesignerItem.getHeight(),x2:this.hostDesignerItem.getWidth()-n,y2:this.hostDesignerItem.getHeight(),angle1:90,angle2:90,len:i}),e.push({id:"3",x1:0,y1:n,x2:0,y2:this.hostDesignerItem.getHeight()-n,angle1:180,angle2:180,len:i})),e},a.prototype._onNodeTitleChanged=function(t,i){var o=this._control._client;o.setAttribute(this._metaInfo[e.GME_ID],n.Attributes.name,i)},a.prototype.doSearch=function(t){var e=t.toString();return this.name&&-1!==this.name.toLowerCase().indexOf(e.toLowerCase())?!0:!1},a.prototype._showEditorDialog=function(){var n=this,i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]),s=o.getAttribute("documentation")||"Click to enter documentation.",a=new r;a.initialize(s,function(o){try{i.setAttribute(n._metaInfo[e.GME_ID],"documentation",o),n.$doc.empty(),n.$doc.append($(t(o)))}catch(r){n.logger.error("Saving META failed... Either not JSON object or something else went wrong...")}}),a.show()},a}),define("css!decorators/DocumentDecorator/PartBrowser/DocumentDecorator.PartBrowserWidget",[],function(){}),define("decorators/DocumentDecorator/PartBrowser/DocumentDecorator.PartBrowserWidget",["js/Constants","js/RegistryKeys","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","../Core/DocumentDecorator.Core","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../DiagramDesigner/DocumentDecorator.DiagramDesignerWidget.html","css!../DiagramDesigner/DocumentDecorator.DiagramDesignerWidget.css","css!./DocumentDecorator.PartBrowserWidget.css"],function(t,e,n,i,o,r,s){"use strict";var a,l="DocumentDecoratorPartBrowserWidget",c=$("<img>",{"class":"embeddedsvg"});return a=function(t){var e=_.extend({},t);i.apply(this,[e]),o.apply(this,[e]),this.logger.debug("DocumentDecoratorPartBrowserWidget ctor")},_.extend(a.prototype,i.prototype),_.extend(a.prototype,o.prototype),a.prototype.DECORATORID=l,a.prototype.$DOMBase=function(){var t=$(s);return t.find("."+r.CONNECTOR_CLASS).remove(),t}(),a.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this.skinParts.$name=this.$el.find(".name"),this._renderContent()},a.prototype.afterAppend=function(){},a.prototype.update=function(){this._renderContent()},a.prototype._renderContent=function(){var e=this._control._client,i=e.getNode(this._metaInfo[t.GME_ID]);DEBUG&&this.$el.attr({"data-id":this._metaInfo[t.GME_ID]}),i&&this.skinParts.$name.text(i.getAttribute(n.Attributes.name)||""),this._updateColors(!0),this._updateSVG()},a.prototype._updateSVG=function(){var n,i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]),r="",s=this;o&&(r=o.getRegistry(e.SVG_ICON)),r?(n=t.ASSETS_DECORATOR_SVG_FOLDER+r,this.skinParts.$imgSVG||(this.skinParts.$imgSVG=c.clone(),this.$el.append(this.skinParts.$imgSVG)),this.skinParts.$imgSVG.attr("src")!==n&&(this.skinParts.$imgSVG.on("load",function(){s.skinParts.$imgSVG.css("margin-top","5px"),s.skinParts.$imgSVG.off("load"),s.skinParts.$imgSVG.off("error")}),this.skinParts.$imgSVG.on("error",function(){s.skinParts.$imgSVG.css("margin-top","5px"),s.skinParts.$imgSVG.off("load"),s.skinParts.$imgSVG.off("error")}),this.skinParts.$imgSVG.attr("src",n))):this.skinParts.$imgSVG&&(this.skinParts.$imgSVG.remove(),this.skinParts.$imgSVG=void 0)},a}),define("decorators/DocumentDecorator/DocumentDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/DocumentDecorator.DiagramDesignerWidget","./PartBrowser/DocumentDecorator.PartBrowserWidget"],function(t,e,n){"use strict";var i,o=t,r=t.prototype,s="DocumentDecorator";return i=function(t){var e=_.extend({loggerName:this.DECORATORID},t);o.apply(this,[e]),this.logger.debug("DocumentDecorator ctor")},_.extend(i.prototype,r),i.prototype.DECORATORID=s,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:e,PartBrowser:n}},i}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/MetaDecorator.DiagramDesignerWidget.html",[],function(){return'<div class="meta-decorator">\n    <div class="name"></div>\n    <div class="attributes-title">ATTRIBUTES\n        <div class="add-new-attribute" title="Add attribute...">+</div>\n    </div>\n    <ul class="attributes unstyled"></ul>\n    <div class="constraints-title">CONSTRAINTS\n        <div class="add-new-constraint" title="Add constraint...">+</div>\n    </div>\n    <ul class="constraints unstyled"></ul>\n    <div class="aspects-title">ASPECTS\n        <div class="add-new-aspect" title="Add aspect...">+</div>\n    </div>\n    <ul class="aspects unstyled"></ul>\n    <div class=\'connector bottom\'></div>\n    <div class=\'connector top\'></div>\n</div>'}),define("decorators/MetaDecorator/DiagramDesigner/Attribute",["js/logger"],function(t){"use strict";var e;return e=function(e){this.name=e.name,this.type=e.type,this._render(),this.logger=t.create("gme:decorators:MetaDecorator:DiagramDesigner:Attribute_"+this.name,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},e.prototype._DOMAttributeBase=$('<div class="attr" data-name="__ID__"><span class="n"></span><span class="t"></span></div>'),e.prototype._render=function(){this.$el=this._DOMAttributeBase.clone(),this.$el.attr({"data-name":this.name,title:this.name}),this.$el.find(".n").text(this.name+":"),this.$el.find(".t").text(this.type)},e.prototype.destroy=function(){this.$el&&(this.$el.remove(),this.$el.empty())},e}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/AttributeDetailsDialog.html",[],function(){return'<div class="attribute-details-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Edit attribute parameters...</h3>\n            </div>\n            <form class="modal-body form-horizontal" role="form">\n                <div class="form-group" id="pName">\n                    <label class="col-sm-4 control-label" for="inputName">Name</label>\n\n                    <div class="col-sm-8 controls">\n                        <input type="text" id="inputName" placeholder="Name">\n                    </div>\n                </div>\n                <div class="form-group">\n                    <label class="col-sm-4 control-label" for="inputType">Type</label>\n\n                    <div class="col-sm-8 controls">\n                        <select id="inputType">\n                            <option>string</option>\n                            <option>integer</option>\n                            <option>float</option>\n                            <option>boolean</option>\n                            <option>asset</option>\n                        </select>\n                    </div>\n                </div>\n                <div class="form-group" id="pDefaultValue">\n                    <label class="col-sm-4 control-label" for="inputDefaultValue">Default value</label>\n\n                    <div class="col-sm-8 controls">\n                        <input type="text" id="inputDefaultValue" placeholder="Default value">\n                    </div>\n                </div>\n                <div class="control-group" id="pDefaultValueBoolean">\n                    <label class="col-sm-4 control-label">Default value</label>\n\n                    <div class="col-sm-8 controls">\n                        <label class="radio inline">\n                            <input type="radio" name="rbBoolean" id="rbBooleanTrue" value="true" checked>\n                            TRUE\n                        </label>\n                        <label class="radio inline">\n                            <input type="radio" name="rbBoolean" id="rbBooleanFalse" value="false">\n                            FALSE\n                        </label>\n                    </div>\n                </div>\n                <div class="form-group" id="pRegExp">\n                    <label class="col-sm-4 control-label">Regular Expression</label>\n                    <div class="col-sm-8 controls">\n                        <input type="text" id="inputRegExp" title="No leading and trailing slash needed. Modifiers not allowed!">\n                    </div>\n                </div>\n                <div class="form-group" id="pRange">\n                    <label class="col-sm-4 control-label" for="inputDefaultValue">Inclusive Value Range</label>\n\n                    <div class="col-sm-8 controls">\n                        <input type="number" id="inputMinValue" placeholder="minimum">\n                        <input type="number" id="inputMaxValue" placeholder="maximum">\n                    </div>\n                </div>\n                <div class="form-group" id="pEnum">\n                    <label class="col-sm-4 control-label"></label>\n\n                    <div class="col-sm-8 controls">\n                        <label class="checkbox">\n                            <input type="checkbox" id="cbEnum" value="">\n                            Enumeration\n                        </label>\n                    </div>\n                </div>\n                <div id="pEnumValues" class="form-group">\n                    <label class="col-sm-4 control-label" for="inputEnumValues">Values</label>\n\n                    <div class="col-sm-8 controls">\n                        <textarea rows="3" id="inputEnumValues"\n                                  placeholder="Enter each value in separate line"></textarea>\n                    </div>\n                </div>\n            </form>\n            <div class="modal-footer">\n                <a href="#" class="btn btn-danger btn-delete pull-left">Delete</a>\n                <a href="#" class="btn btn-primary disabled btn-save">Save</a>\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/AttributeDetailsDialog",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/AttributeDetailsDialog",["js/util","common/regexp","text!./templates/AttributeDetailsDialog.html","css!./styles/AttributeDetailsDialog.css"],function(t,e,n){"use strict";var i,o="asset";return i=function(){},i.prototype.show=function(t,e,n,i){var o=this;this._initDialog(t,e,n,i),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){o._inputName.focus().trigger("keyup")}),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0})},i.prototype._initDialog=function(t,i,r,s){function a(t){var e=!0;try{new RegExp(t)}catch(n){e=!1}return e}var l,c,d,h,p,g=this;l=function(){var t,e,n,i,s={name:g._inputName.val(),type:g._inputType.val(),defaultValue:g._inputDefaultValue.val(),isEnum:g._cbEnum.is(":checked")};if(s.isEnum&&(s.enumValues=g._inputEnumValues.val().split("\n")),"integer"===s.type||"float"===s.type){if(s.defaultValue=p(s.defaultValue,s.type),s.enumValues)for(n=s.enumValues.slice(0),s.enumValues=[],e=n.length,t=0;e>t;t+=1)i=p(n[t],s.type),i&&s.enumValues.push(i);p(g._pRangeMax.val(),s.type)&&(s.max=p(g._pRangeMax.val(),s.type)),p(g._pRangeMin.val(),s.type)&&(s.min=p(g._pRangeMin.val(),s.type))}else"boolean"===s.type?(s.defaultValue=g._el.find("#rbBooleanTrue").first().is(":checked"),delete s.isEnum):s.type===o?(s.defaultValue="",delete s.isEnum):"string"===s.type&&g._pRegExpValue.val()&&(s.regexp=g._pRegExpValue.val());g._dialog.modal("hide"),r&&r.call(g,s)},c=function(){g._dialog.modal("hide"),s&&s.call(g)},p=function(t,e){var n;switch(e){case"integer":n=parseInt(t,10),isNaN(n)&&(n=0);break;case"float":n=parseFloat(t,10),isNaN(n)&&(n=0);break;case"boolean":}return n},h=function(t){switch(g._pDefaultValue.show(),g._pEnum.show(),g._cbEnum.is(":checked")&&g._pEnumValues.show(),g._pDefaultValueBoolean.hide(),t){case"integer":g._pRegExp.hide(),g._pRange.show();break;case"float":g._pRange.show(),g._pRegExp.hide();break;case"boolean":g._pDefaultValue.hide(),g._pEnum.hide(),g._pEnumValues.hide(),g._pDefaultValueBoolean.show(),g._pRegExp.hide(),g._pRange.hide();break;case o:g._pDefaultValue.hide(),g._pEnum.hide(),g._pEnumValues.hide(),g._pRegExp.hide(),g._pRange.hide();break;default:g._pRegExp.show(),g._pRange.hide()}},d=function(t){return!(""===t||"name"===t||-1!==i.indexOf(t)||e.DOCUMENT_KEY.test(t)===!1)},this._dialog=$(n),this._el=this._dialog.find(".modal-body").first(),this._cbEnum=this._el.find("#cbEnum").first(),this._pEnum=this._el.find("#pEnum").first(),this._pEnumValues=this._el.find("#pEnumValues").first(),this._pEnumValues.hide(),this._btnSave=this._dialog.find(".btn-save").first(),this._btnDelete=this._dialog.find(".btn-delete").first(),this._inputName=this._el.find("#inputName").first(),this._inputType=this._el.find("#inputType").first(),this._inputDefaultValue=this._el.find("#inputDefaultValue").first(),this._pDefaultValue=this._el.find("#pDefaultValue").first(),this._pDefaultValueBoolean=this._el.find("#pDefaultValueBoolean").first(),this._pDefaultValueBoolean.hide(),this._inputEnumValues=this._el.find("#inputEnumValues").first(),this._pRegExp=this._el.find("#pRegExp"),this._pRegExpValue=this._el.find("#inputRegExp"),this._pRange=this._el.find("#pRange"),this._pRangeMin=this._el.find("#inputMinValue"),this._pRangeMax=this._el.find("#inputMaxValue"),this._inputName.on("keyup",function(){var t=g._inputName.val();d(t)?(g._inputName.removeClass("text-danger"),g._btnSave.disable(!1),g._btnDelete.disable(!1)):(g._inputName.addClass("text-danger"),g._btnSave.disable(!0),g._btnDelete.disable(!0))}),this._pRegExpValue.on("keyup",function(){var t=g._pRegExpValue.val();a(t)?(g._pRegExpValue.removeClass("text-danger"),g._btnSave.disable(!1),g._btnDelete.disable(!1)):(g._pRegExpValue.addClass("text-danger"),g._btnSave.disable(!0),g._btnDelete.disable(!0))}),this._inputName.on("keydown",function(t){var e=13===t.which,n=g._inputName.val();e&&d(n)&&(l(),t.stopPropagation(),t.preventDefault())}),this._cbEnum.on("change",null,function(){var t=$(this).is(":checked");t?(g._pEnumValues.show(),g._pRange.hide(),g._pRangeMax.val(""),g._pRangeMin.val(""),g._pRegExp.hide(),g._pRegExpValue.val("")):(g._pEnumValues.hide(),g._inputEnumValues.val(""),"float"===g._inputType.val()||"integer"===g._inputType.val()?g._pRange.show():"string"===g._inputType.val()&&g._pRegExp.show())}),this._inputType.on("change",null,function(){h(g._inputType.val())}),this._btnSave.on("click",function(t){var e=g._inputName.val();t.stopPropagation(),t.preventDefault(),d(e)&&l()}),s?this._btnDelete.on("click",function(t){t.stopPropagation(),t.preventDefault(),c()}):this._btnDelete.remove(),this._inputName.val(t.name),this._inputType.val(t.type),"boolean"===t.type?(this._pDefaultValue.hide(),this._pEnum.hide(),this._pDefaultValueBoolean.show(),this._pRange.hide(),this._pRegExp.hide(),t.defaultValue!==!0&&this._el.find("#rbBooleanFalse").first().attr("checked","checked")):t.type===o?(this._pDefaultValue.hide(),this._pEnum.hide(),this._pRange.hide(),this._pRegExp.hide()):(this._inputDefaultValue.val(t.defaultValue),t.isEnum&&(this._cbEnum.attr("checked",!0),this._inputEnumValues.val(t.enumValues.join("\n")),this._pEnumValues.show()),"string"===t.type?(this._pRange.hide(),this._pRegExp.show(),t.regexp&&this._pRegExpValue.val(t.regexp)):(this._pRange.show(),this._pRegExp.hide(),t.min&&this._pRangeMin.val(t.min),t.max&&this._pRangeMax.val(t.max)))},i}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/ConstraintDetailsDialog.html",[],function(){return'<div class="constraint-details-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Edit constraint parameters...</h3>\n            </div>\n            <form class="modal-body form-horizontal" role="form">\n                <div class="form-group" id="pName">\n                    <label class="col-sm-4 control-label" for="inputName">Name</label>\n\n                    <div class="col-sm-8 controls">\n                        <input type="text" class="info-input" id="inputName" placeholder="Name">\n                    </div>\n                </div>\n                <div class="form-group" id="pScript">\n                    <label class="col-sm-4 control-label">Script</label>\n\n                    <div class="col-sm-8 controls">\n                    </div>\n                </div>\n                <div class="form-group" id="pMessage">\n                    <label class="col-sm-4 control-label" for="inputMessage">Info</label>\n\n                    <div class="col-sm-8 controls">\n                        <input type="text" class="input-xxlarge info-input" id="inputMessage"\n                               placeholder="Info about the constraint...">\n                    </div>\n                </div>\n                <!--\n                <div class="form-group" id="pPriority">\n                    <label class="col-sm-4 control-label" for="inputPriority">Priority</label>\n                    <div class="col-sm-8 controls">\n                        <input type="text" id="inputPriority" placeholder="Priority">\n                    </div>\n                </div>\n                -->\n            </form>\n            <div class="modal-footer">\n                <a href="#" class="btn btn-danger btn-delete pull-left">Delete</a>\n                <a href="#" class="btn btn-primary disabled btn-save">Save</a>\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/ConstraintDetailsDialog",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/ConstraintDetailsDialog",["js/util","text!./templates/ConstraintDetailsDialog.html","common/regexp","codemirror/lib/codemirror","codemirror/mode/javascript/javascript","css!./styles/ConstraintDetailsDialog.css"],function(t,e,n,i){"use strict";var o;return o=function(){},o.prototype.show=function(t,e,n,i){var o=this;this._initDialog(t,e,n,i),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){o._codeMirror.refresh(),o._inputName.focus().trigger("keyup")}),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0})},o.prototype._initDialog=function(t,o,r,s){var a,l,c,d=this;a=function(){var t={name:d._inputName.val(),script:d._codeMirror.getValue(),priority:d._inputPriority.val(),info:d._inputMessage.val()};d._dialog.modal("hide"),r&&r.call(d,t)},l=function(){d._dialog.modal("hide"),s&&s.call(d)},c=function(t){return!(""===t||-1!==o.indexOf(t)||n.DOCUMENT_KEY.test(t)===!1)},this._dialog=$(e),this._el=this._dialog.find(".modal-body").first(),this._btnSave=this._dialog.find(".btn-save").first(),this._btnDelete=this._dialog.find(".btn-delete").first(),this._pScript=this._el.find("#pScript").first(),this._scriptEditor=this._pScript.find("div.controls").first(),this._inputName=this._el.find("#inputName").first(),this._inputPriority=this._el.find("#inputPriority").first(),this._inputMessage=this._el.find("#inputMessage").first(),this._inputName.on("keyup",function(){var t=d._inputName.val();c(t)?(d._inputName.removeClass("text-danger"),d._btnSave.disable(!1)):(d._inputName.addClass("text-danger"),d._btnSave.disable(!0))}),this._inputName.on("keydown",function(t){var e=13===t.which,n=d._inputName.val();e&&c(n)&&(a(),t.stopPropagation(),t.preventDefault())}),this._btnSave.on("click",function(t){var e=d._inputName.val();t.stopPropagation(),t.preventDefault(),c(e)&&a()}),s?this._btnDelete.on("click",function(t){t.stopPropagation(),t.preventDefault(),l()}):this._btnDelete.remove(),this._inputName.val(t.name).focus(),this._inputMessage.val(t.info),this._codeMirror=i(this._scriptEditor[0],{value:t.script,mode:"javascript"})},o}),define("decorators/MetaDecorator/DiagramDesigner/Constraint",["js/logger"],function(t){"use strict";var e;return e=function(e){this.name=e.name,this.script=e.script,this.info=e.info,this._render(),this.logger=t.create("gme:decorators:MetaDecorator:DiagramDesigner:Constraint_"+this.name,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},e.prototype._DOMConstraintBase=$('<div class="const" data-name="__ID__"><span class="n"></span><span class="t"></span></div>'),e.prototype._render=function(){this.$el=this._DOMConstraintBase.clone(),this.$el.attr({"data-name":this.name,title:this.name+", info: "+this.info}),this.$el.find(".n").text(this.name),this.$el.find(".i").text(this.info)},e.prototype.update=function(t){this.name=t.name,this.script=t.script,this.info=t.info,this._render()},e.prototype.destroy=function(){this.$el&&(this.$el.remove(),this.$el.empty())},e}),define("decorators/MetaDecorator/DiagramDesigner/MetaDecorator.DiagramDesignerWidget.Constraints",["js/Constants","./ConstraintDetailsDialog","./Constraint"],function(t,e,n){"use strict";var i,o=["/**"," * To be called when the constraint has been evaluated."," * @callback constraintCallback"," * @param {string|Error} err - Should be null unless unexpected execution errors."," * @param {object} result - Result of the constraint evaluation."," * @param {boolean} result.hasViolation - Set to true if there were violations."," * @param {string} [result.message] - Message to display in case of violation."," */","","/**"," * The function defining the constraint."," * @param {Core} core - API for retrieving data about the node."," * @param {Node} node - The node being checked."," * @param {constraintCallback} callback"," */","function (core, node, callback) {","    var result = {hasViolation: false, message: ''};","    // Here goes the constraint checking..","    callback(null, result)","}"].join("\n");return i=function(){},i.prototype._renderContentConstraints=function(){var n=this._control._client,i=n.getNode(this._metaInfo[t.GME_ID]),o=this;this._constraintNames=[],this._constraints={},this._skinParts.$constraintsContainer=this.$el.find(".constraints"),this._skinParts.$addConstraintContainer=this.$el.find(".add-new-constraint"),this._skinParts.$constraintsContainer.on("dblclick","li",function(t){if(o.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0){var n=$(this).find(".n").text().replace(":",""),r=o._constraintNames.slice(0),s=new e,a=_.extend({},i.getConstraint(n));a.name=n,r.splice(o._constraintNames.indexOf(n),1),s.show(a,r,function(t){o.saveConstraintDescriptor(n,t)},function(){o.deleteConstraintDescriptor(n)})}t.stopPropagation(),t.preventDefault()}),this._skinParts.$addConstraintContainer.on("click",null,function(t){o.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&o._onNewConstraintClick(),t.stopPropagation(),t.preventDefault()})},i.prototype._onNewConstraintClick=function(){this._onNewClick(this._constraintNames,this._skinParts.$constraintsContainer,this._skinParts.$addConstraintContainer,this._skinParts.$constraintsTitle,this._onNewConstraintCreate)},i.prototype._updateConstraints=function(){var e,n,i,o=this._control._client,r=o.getNode(this._metaInfo[t.GME_ID]),s=r?r.getOwnConstraintNames():[],a=this._constraintNames.slice(0),l=$("<li/>");for(n=_.difference(a,s),e=n.length;e--;)this._removeConstraint(n[e]);for(n=_.difference(s,a),e=n.length;e--;)this._addConstraint(n[e]);for(n=_.intersection(s,a),e=n.length;e--;)this._updateConstraint(n[e]);for(this._constraintNames.sort(),this._skinParts.$constraintsContainer.empty(),e=this._constraintNames.length,i=0;e>i;i+=1)this._skinParts.$constraintsContainer.append(l.clone().append(this._constraints[this._constraintNames[i]].$el))},i.prototype._addConstraint=function(e){var i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]),r=o.getConstraint(e);r&&(r.name=e,this._constraints[e]=new n(r),this._constraintNames.push(e))},i.prototype._updateConstraint=function(e){var n=this._control._client,i=n.getNode(this._metaInfo[t.GME_ID]),o=i.getConstraint(e);o&&(o.name=e,this._constraints[e].update(o))},i.prototype._removeConstraint=function(t){var e=this._constraintNames.indexOf(t);-1!==e&&(this._constraints[t].destroy(),delete this._constraints[t],this._constraintNames.splice(e,1));
},i.prototype._onNewConstraintCreate=function(t){var n,i=this,r=this._constraintNames.slice(0),s=new e;this.logger.debug("_onNewConstraintCreate: "+t),r.splice(this._constraintNames.indexOf(t),1),n={name:t,script:o,info:""},s.show(n,r,function(e){i.saveConstraintDescriptor(t,e)})},i.prototype.saveConstraintDescriptor=function(e,n){var i=this._control._client,o=this._metaInfo[t.GME_ID];i.startTransaction(),e!==n.name&&i.delConstraint(o,e),i.setConstraint(o,n.name,n),i.completeTransaction()},i.prototype.deleteConstraintDescriptor=function(e){var n=this._control._client,i=this._metaInfo[t.GME_ID];n.startTransaction(),n.delConstraint(i,e),n.completeTransaction()},i}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/AspectDetailsDialog.html",[],function(){return'<div class="aspect-details-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3>Edit aspect parameters...</h3>\n            </div>\n            <form class="modal-body form-horizontal" role="form">\n                <div class="form-group" id="pName">\n                    <label class="col-sm-4 control-label" for="inputName">Name</label>\n\n                    <div class="col-sm-8 controls">\n                        <input type="text" id="inputName" placeholder="Name">\n                    </div>\n                </div>\n                <div class="form-group" id="pTypes">\n                    <label class="col-sm-4 control-label">Types</label>\n\n                    <div class="col-sm-8 controls">\n                    </div>\n                </div>\n            </form>\n            <div class="modal-footer">\n                <a href="#" class="btn btn-danger btn-delete pull-left">Delete</a>\n                <a href="#" class="btn btn-primary btn-save">Save</a>\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\n            </div>\n        </div>\n    </div>\n</div>'}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/AspectDetailsDialog",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/AspectDetailsDialog",["js/util","js/Constants","common/regexp","text!./templates/AspectDetailsDialog.html","css!./styles/AspectDetailsDialog.css"],function(t,e,n,i){"use strict";var o,r={name:void 0,items:[]},s=$('<label class="checkbox"><input type="checkbox"></label>'),a="typeid";return o=function(){},o.prototype.show=function(t,e,n,i){var o=this;this._initDialog(t,e,n,i),this._dialog.modal("show"),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0})},o.prototype._initDialog=function(t,o,l,c){function d(){var t={},e=E.find("input[type=checkbox]:checked");_.extend(t,r),t.name=v._inputName.val(),t.items=[],e.each(function(){t.items.push($(this).data(a))}),v._dialog.modal("hide"),l&&l.call(v,t)}function h(){v._dialog.modal("hide"),c&&c.call(v)}function p(t){return!(""===t||-1!==o.indexOf(t)||t.toLowerCase()===e.ASPECT_ALL.toLowerCase()||n.DOCUMENT_KEY.test(t)===!1)}function g(){var t=E.find("input[type=checkbox]:checked");t.length>0&&p(v._inputName.val())?v._btnSave.disable(!1):v._btnSave.disable(!0)}var u,f,m,b,y,v=this,C={};_.extend(C,r),_.extend(C,t),this._dialog=$(i),this._el=this._dialog.find(".modal-body").first(),this._btnSave=this._dialog.find(".btn-save").first(),this._btnDelete=this._dialog.find(".btn-delete").first(),this._pTypes=this._el.find("#pTypes").first();var E=this._pTypes.find(".controls");for(this._inputName=this._el.find("#inputName").first(),this._inputName.on("keyup",function(){var t=v._inputName.val();if(p(t)){v._inputName.removeClass("text-danger");var e=E.find("input[type=checkbox]:checked");e.length>0&&v._btnSave.disable(!1)}else v._inputName.addClass("text-danger"),v._btnSave.disable(!0)}),this._inputName.on("keydown",function(t){var e=13===t.which,n=v._inputName.val();e&&p(n)&&(d(),t.stopPropagation(),t.preventDefault())}),this._btnSave.on("click",function(t){var e=v._inputName.val();t.stopPropagation(),t.preventDefault(),$(this).hasClass("disabled")===!1&&p(e)&&d()}),c?this._btnDelete.on("click",function(t){t.stopPropagation(),t.preventDefault(),h()}):this._btnDelete.remove(),this._inputName.val(t.name).focus(),u=0;u<C.validChildrenTypes.length;u+=1)m=C.validChildrenTypes[u],b=m.name,f=s.clone(),f.append(b),y=f.find("input[type=checkbox]"),y.data(a,m.id),-1!==C.items.indexOf(m.id)&&(y.prop("checked",!0),C.items.splice(C.items.indexOf(m.id),1)),E.append(f);for(u=0;u<C.items.length;u+=1)f=s.clone(),f.append("["+C.items[u]+"] - cannot be contained! Uncheck to clean up.."),y=f.find("input[type=checkbox]"),y.data(a,C.items[u]),f.addClass("invalid-aspect-member-label"),y.addClass("invalid-aspect-member-cb"),y.prop("checked",!0),E.append(f);this._pTypes.on("change","input[type=checkbox]",function(){var t=$(this);t.hasClass("invalid-aspect-member-cb")&&t.prop("disabled",!0),g()}),g()},o}),define("decorators/MetaDecorator/DiagramDesigner/Aspect",["js/logger"],function(t){"use strict";var e;return e=function(e){this.name=e.name,this.itemNum=e.items?e.items.length:0,this._render(),this.logger=t.create("gme:decorators:MetaDecorator:DiagramDesigner:Aspect_"+this.name,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},e.prototype._DOMAspectBase=$('<div class="aspect" data-name="__ID__"><span class="n"></span><span class="t"></span></div>'),e.prototype._render=function(){this.$el=this._DOMAspectBase.clone(),this.$el.attr({"data-name":this.name,title:this.name+", types: "+this.itemNum}),this.$el.find(".n").text(this.name+":"),this.$el.find(".t").text(this.itemNum)},e.prototype.update=function(t){this.name=t.name,this.itemNum=t.items?t.items.length:0,this._render()},e.prototype.destroy=function(){this.$el&&(this.$el.remove(),this.$el.empty())},e}),define("decorators/MetaDecorator/DiagramDesigner/MetaDecorator.DiagramDesignerWidget.Aspects",["js/Constants","js/Utils/GMEConcepts","js/NodePropertyNames","./AspectDetailsDialog","./Aspect"],function(t,e,n,i,o){"use strict";var r;return r=function(){},r.prototype._renderContentAspects=function(){var e=this._control._client,n=this._metaInfo[t.GME_ID],o=this;this._aspectNames=[],this._aspects={},this._skinParts.$aspectsContainer=this.$el.find(".aspects"),this._skinParts.$addAspectContainer=this.$el.find(".add-new-aspect"),this._skinParts.$aspectsContainer.on("dblclick","li",function(t){if(o.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0){var r=$(this).find(".n").text().replace(":",""),s=e.getNode(n),a=s.getSetNames(),l=new i,c={items:s.getAspectMeta(r)};c.name=r,c.validChildrenTypes=o._getAspectDescriptorValidChildrenTypes(),-1!==a.indexOf(r)&&a.splice(a.indexOf(r),1),l.show(c,a,function(t){o.saveAspectDescriptor(r,t)},function(){o.deleteAspectDescriptor(r)})}t.stopPropagation(),t.preventDefault()}),this._skinParts.$addAspectContainer.on("click",null,function(t){o.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&o._onNewAspectClick(),t.stopPropagation(),t.preventDefault()})},r.prototype._onNewAspectClick=function(){var e=this._control._client,n=this._metaInfo[t.GME_ID],i=e.getNode(n),o=[t.ASPECT_ALL,e.CONSTANTS.CORE.OVERLAYS_PROPERTY].concat(i.getValidSetNames()).concat(i.getOwnValidAspectNames());this._onNewClick(o,this._skinParts.$aspectsContainer,this._skinParts.$addAspectContainer,this._skinParts.$aspectsTitle,this._onNewAspectCreate)},r.prototype._updateAspects=function(){var e,n,i,o=this._control._client,r=this._metaInfo[t.GME_ID],s=o.getNode(r),a=s?s.getOwnValidAspectNames():[],l=this._aspectNames.slice(0),c=$("<li/>");for(n=_.difference(l,a),e=n.length;e--;)this._removeAspect(n[e]);for(n=_.difference(a,l),e=n.length;e--;)this._addAspect(n[e]);for(n=_.intersection(a,l),e=n.length;e--;)this._updateAspect(n[e]);for(this._aspectNames.sort(),this._skinParts.$aspectsContainer.empty(),e=this._aspectNames.length,i=0;e>i;i+=1)this._skinParts.$aspectsContainer.append(c.clone().append(this._aspects[this._aspectNames[i]].$el))},r.prototype._addAspect=function(e){var n=this._control._client,i=this._metaInfo[t.GME_ID],r=n.getNode(i),s=r&&r.getAspectMeta(e);s&&(s={items:s},s.name=e,this._aspects[e]=new o(s),this._aspectNames.push(e))},r.prototype._updateAspect=function(e){var n=this._control._client,i=this._metaInfo[t.GME_ID],o=n.getNode(i),r=o&&o.getAspectMeta(e);r&&(r={items:r},r.name=e,this._aspects[e].update(r))},r.prototype._removeAspect=function(t){var e=this._aspectNames.indexOf(t);-1!==e&&(this._aspects[t].destroy(),delete this._aspects[t],this._aspectNames.splice(e,1))},r.prototype._onNewAspectCreate=function(e){var n,o=this,r=this._control._client,s=this._metaInfo[t.GME_ID],a=r.getNode(s),l=a.getSetNames(),c=new i;this.logger.debug("_onNewAspectCreate: "+e),-1!==l.indexOf(e)&&l.splice(l.indexOf(e),1),n={name:e,items:[],validChildrenTypes:this._getAspectDescriptorValidChildrenTypes()},c.show(n,l,function(t){o.saveAspectDescriptor(e,t)})},r.prototype._getAspectDescriptorValidChildrenTypes=function(){var i,o,r,s,a=this._metaInfo[t.GME_ID],l=[],c=this._control._client;for(o=e.getMETAAspectMergedValidChildrenTypes(a),i=o.length;i--;)s={id:o[i],name:o[i]},r=c.getNode(o[i]),r&&(s.name=r.getAttribute(n.Attributes.name)),l.push(s);return l.sort(function(t,e){var n=t.name.toLowerCase(),i=e.name.toLowerCase(),o=t.id,r=e.id;return i>n?-1:n>i?1:r>o?-1:1}),l},r.prototype.saveAspectDescriptor=function(e,n){var i=this._control._client,o=this._metaInfo[t.GME_ID];i.startTransaction(),e!==n.name&&(i.delAspectMeta(o,e),i.deleteSet(o,e)),i.setAspectMetaTargets(o,n.name,n.items||[]),i.createSet(o,n.name),i.completeTransaction()},r.prototype.deleteAspectDescriptor=function(e){var n=this._control._client,i=this._metaInfo[t.GME_ID];n.startTransaction(),n.delAspectMeta(i,e),n.deleteSet(i,e),n.completeTransaction()},r}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/MetaTextEditorDialog.html",[],function(){return'<div class="meta-text-editor-dialog modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">×</button>\n                <h3 id="pHeader"></h3>\n            </div>\n            <div id="pMeta"></div>\n        </div>\n    </div>\n</div>'}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/MetaTextEditorDialog",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/MetaTextEditorDialog",["js/util","text!./templates/MetaTextEditorDialog.html","codemirror/lib/codemirror","codemirror/mode/javascript/javascript","css!./styles/MetaTextEditorDialog.css"],function(t,e,n){"use strict";var i;return i=function(){},i.prototype.show=function(t,e){var n=this;this._initDialog(t,e),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){n._codeMirror.refresh(),n._codeMirror.focus()}),this._dialog.on("hidden.bs.modal",function(){n._dialog.remove(),n._dialog.empty(),n._dialog=void 0})},i.prototype._initDialog=function(t,i){this._dialog=$(e),this._pMeta=this._dialog.find("#pMeta").first(),this._pHeader=this._dialog.find("#pHeader").first(),this._pHeader[0]&&t&&(this._pHeader[0].innerHTML="META definition of ["+t.getAttribute("name")+"]"),this._codeMirror=n(this._pMeta[0],{value:i,mode:"javascript",readOnly:!0})},i}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/MetaDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/MetaDecorator.DiagramDesignerWidget",["js/Constants","js/NodePropertyNames","js/RegistryKeys","../../DefaultDecorator/DiagramDesigner/DefaultDecorator.DiagramDesignerWidget","text!./templates/MetaDecorator.DiagramDesignerWidget.html","./Attribute","./AttributeDetailsDialog","js/Panels/MetaEditor/MetaRelations","./MetaDecorator.DiagramDesignerWidget.Constraints","./MetaDecorator.DiagramDesignerWidget.Aspects","./MetaTextEditorDialog","common/regexp","css!./styles/MetaDecorator.DiagramDesignerWidget.css"],function(t,e,n,i,o,r,s,a,l,c,d,h){"use strict";var p,g="MetaDecorator",u="abstract",f=$('<i class="glyphicon glyphicon-cog text-meta"/>'),m=$('<i class="glyphicon glyphicon-lock meta-lock"/>');return p=function(t){var e=_.extend({},t);i.apply(this,[e]),this.name="",this._attributeNames=[],this._attributes={},this._inLibrary=!1,this._skinParts={$name:void 0,$attributesContainer:void 0,$addAttributeContainer:void 0,$constraintsContainer:void 0,$addConstraintContainer:void 0,$aspectsContainer:void 0,$addAspectContainer:void 0,$attributesTitle:void 0,$constraintsTitle:void 0,$aspectsTitle:void 0},this.logger.debug("MetaDecorator ctor")},_.extend(p.prototype,i.prototype),p.prototype.DECORATORID=g,_.extend(p.prototype,l.prototype),_.extend(p.prototype,c.prototype),p.prototype.$DOMBase=$(o),p.prototype.on_addTo=function(){var e=this,n=e._control._client.getNode(e._metaInfo[t.GME_ID]);n&&(n.isLibraryElement()||n.isLibraryRoot())&&(e._inLibrary=!0),this._renderContent(),e._inLibrary?this.readOnlyMode(!0):this._skinParts.$name.on("dblclick.editOnDblClick",null,function(t){e.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(t,n){e._onNodeTitleChanged(t,n)}}),t.stopPropagation(),t.preventDefault()}),this._skinParts.$addAttributeContainer.on("click",null,function(t){e.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&e._onNewAttributeClick(),t.stopPropagation(),t.preventDefault()})},p.prototype._renderContent=function(){var n=this._control._client,i=this;this.$el.attr({"data-id":this._metaInfo[t.GME_ID]}),this._skinParts.$name=this.$el.find(".name"),this._skinParts.$attributesContainer=this.$el.find(".attributes"),this._skinParts.$addAttributeContainer=this.$el.find(".add-new-attribute"),this._skinParts.$attributesTitle=this.$el.find(".attributes-title"),this._skinParts.$constraintsTitle=this.$el.find(".constraints-title"),this._skinParts.$aspectsTitle=this.$el.find(".aspects-title"),this._skinParts.$attributesContainer.on("dblclick","li",function(o){if(i.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0){var r,a=$(this).find(".n").text().replace(":",""),l=new s,c=n.getNode(i._metaInfo[t.GME_ID]),d=c.getAttributeMeta(a)||{},h=c.getAttribute(a),p=_.extend({},{name:a,type:d.type,defaultValue:h,min:d.min,max:d.max,regexp:d.regexp});if(a===e.Attributes.name)return;if(d["enum"]&&d["enum"].length>0){p.isEnum=!0,p.enumValues=[];for(var g=0;g<d["enum"].length;g++)p.enumValues.push(d["enum"][g])}else p.isMeta=!1;r=c.getOwnValidAttributeNames(),r.splice(r.indexOf(a),1),l.show(p,r,function(t){i.saveAttributeDescriptor(a,t)},function(){i.deleteAttributeDescriptor(a)})}o.stopPropagation(),o.preventDefault()}),this._renderContentConstraints(),this._renderContentAspects(),this._skinParts.$textMetaEditorBtn=f.clone(),this._skinParts.$textMetaLock=m.clone(),this.$el.append(this._skinParts.$textMetaEditorBtn),this._skinParts.$textMetaEditorBtn.on("click",function(t){i.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&i._showMetaTextEditorDialog(),t.stopPropagation(),t.preventDefault()}),this.$el.append(this._skinParts.$textMetaLock),this._skinParts.$textMetaLock.hide(),this.hostDesignerItem.canvas.getIsReadOnlyMode()===!0&&(this._skinParts.$addAttributeContainer.detach(),this._skinParts.$addConstraintContainer.detach(),this._skinParts.$addAspectContainer.detach()),this.update()},p.prototype.update=function(){var e=this._control._client,n=e.getNode(this._metaInfo[t.GME_ID]),i="";n&&(i=n.getFullyQualifiedName(),this.name!==i&&(this.name=i,this._refreshName()),this._updateColors(),this._updateAttributes(),this._updateConstraints(),this._updateAbstract(),this._updateAspects())},p.prototype._updateColors=function(){this._getNodeColorsFromRegistry(),this.fillColor?this.$el.css({"background-color":this.fillColor}):this.$el.css({"background-color":""}),this.borderColor?(this.$el.css({"border-color":this.borderColor}),this._skinParts.$name.css({"border-color":this.borderColor})):(this.$el.css({"border-color":"","box-shadow":""}),this._skinParts.$name.css({"border-color":""})),this.textColor?this.$el.css({color:this.textColor}):this.$el.css({color:""})},p.prototype._getNodeColorsFromRegistry=function(){var e=this._metaInfo[t.GME_ID];this.fillColor=this.preferencesHelper.getRegistry(e,n.COLOR,!1),this.borderColor=this.preferencesHelper.getRegistry(e,n.BORDER_COLOR,!1),this.textColor=this.preferencesHelper.getRegistry(e,n.TEXT_COLOR,!1)},p.prototype._refreshName=function(){this._skinParts.$name.text(this.name),this._skinParts.$name.attr("title",this.name)},p.prototype._updateAbstract=function(){var e=this._control._client,i=e.getNode(this._metaInfo[t.GME_ID]);i&&i.getRegistry(n.IS_ABSTRACT)===!0?this.$el.addClass(u):this.$el.removeClass(u)},p.prototype._updateAttributes=function(){var e,n,i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]),r=o?o.getOwnValidAttributeNames():[],s=this._attributeNames.slice(0),a=$("<li/>");for(e=s.length;e--;)this._removeAttribute(s[e]);for(e=r.length;e--;)this._addAttribute(r[e]);for(this._attributeNames.sort(),this._skinParts.$attributesContainer.empty(),e=this._attributeNames.length,n=0;e>n;n+=1)this._skinParts.$attributesContainer.append(a.clone().append(this._attributes[this._attributeNames[n]].$el))},p.prototype._addAttribute=function(e){var n,i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]);o&&(n=o.getAttributeMeta(e)||{}),n&&(this._attributes[e]=new r({name:e,type:n.type||"null"}),this._attributeNames.push(e))},p.prototype._removeAttribute=function(t){var e=this._attributeNames.indexOf(t);-1!==e&&(this._attributes[t].destroy(),delete this._attributes[t],this._attributeNames.splice(e,1))},p.prototype.destroy=function(){for(var t=this._attributeNames.length;t--;)this._removeAttribute(this._attributeNames[t])},p.prototype._onNodeTitleChanged=function(n,i){var o=this._control._client;o.setAttribute(this._metaInfo[t.GME_ID],e.Attributes.name,i)},p.prototype._onNewAttributeClick=function(){var e=this._control._client,n=this._metaInfo[t.GME_ID],i=e.getNode(n),o=i?i.getOwnValidAttributeNames():[];this._onNewClick(o,this._skinParts.$attributesContainer,this._skinParts.$addAttributeContainer,this._skinParts.$attributesTitle,this._onNewAttributeCreate)},p.prototype._onNewClick=function(t,e,n,i,o){var r,s,a,l,c,d=e.width(),h=this;n.detach(),l=function(){c.remove(),i.append(n)},s=function(){l()},a=function(){var e=r.val();h._isValidName(e,t)&&(_.isFunction(o)&&o.call(h,e),l())},c=$("<div/>",{"class":"control-group"}),r=$("<input/>",{type:"text","class":"new-attr"}),r.outerWidth(d),r.css({"box-sizing":"border-box",margin:"0px"}),c.append(r),c.insertAfter(e),r.focus(),r.keydown(function(t){switch(t.which){case 27:r.val(""),t.preventDefault(),t.stopPropagation(),s();break;case 13:t.preventDefault(),t.stopPropagation(),a();break;case 46:t.stopPropagation()}}).keyup(function(){h._isValidName(r.val(),t)?r.removeClass("text-danger"):r.addClass("text-danger")}).blur(function(){s()}),this.hostDesignerItem.canvas.selectNone()},p.prototype._onNewAttributeCreate=function(t){var e,n=this,i=this._attributeNames.slice(0),o=new s;this.logger.debug("_onNewAttributeCreate: "+t),i.splice(this._attributeNames.indexOf(t),1),e={name:t,type:"string",isEnum:!1},o.show(e,i,function(e){n.saveAttributeDescriptor(t,e)})},p.prototype._isValidName=function(t,e){var n=!0;return(""===t||"string"!=typeof t||"name"===t||-1!==e.indexOf(t)||h.DOCUMENT_KEY.test(t)===!1)&&(n=!1),n},p.prototype.readOnlyMode=function(t){i.prototype.readOnlyMode.call(this,t),this._setReadOnlyMode(t)},p.prototype._setReadOnlyMode=function(t){t===!0||this._inLibrary===!0?(this._skinParts.$addAttributeContainer.detach(),this._skinParts.$addConstraintContainer.detach(),this._skinParts.$addAspectContainer.detach(),this.$el.find("input.new-attr").val("").blur(),this._skinParts.$textMetaLock.show()):(this._skinParts.$attributesTitle.append(this._skinParts.$addAttributeContainer),this._skinParts.$constraintsTitle.append(this._skinParts.$addConstraintContainer),this._skinParts.$aspectsTitle.append(this._skinParts.$addAspectContainer),this._skinParts.$textMetaLock.hide())},p.prototype.saveAttributeDescriptor=function(e,n){var i,o=this._control._client,r=this._metaInfo[t.GME_ID];o.startTransaction(),this.logger.debug("saveAttributeDescriptor: "+e+", attrDesc: "+JSON.stringify(n)),e!==n.name&&(o.delAttributeMeta(r,e),o.delAttribute(r,e)),i={type:n.type,min:n.min,max:n.max,regexp:n.regexp},n.isEnum&&(i["enum"]=n.enumValues),o.setAttributeMeta(r,n.name,i),o.setAttribute(r,n.name,n.defaultValue),o.completeTransaction()},p.prototype.deleteAttributeDescriptor=function(n){var i=this._control._client,o=this._metaInfo[t.GME_ID];i.startTransaction(),n!==e.Attributes.name&&(i.delAttributeMeta(o,n),i.delAttribute(o,n)),i.completeTransaction()},p.prototype.getConnectionAreas=function(t,e,n){var i,o,r,s,l=[],c=10,d=20,h=n&&n[a.CONNECTION_META_INFO.TYPE]?n[a.CONNECTION_META_INFO.TYPE]:null,p=this._getDisabledConnectionAreas();return(void 0===t||t===this.hostDesignerItem.id)&&(i={id:"0",x1:c,y1:0,x2:this.hostDesignerItem.getWidth()-c,y2:0,angle1:270,angle2:270,len:d},o={id:"1",x1:this.hostDesignerItem.getWidth(),y1:c,x2:this.hostDesignerItem.getWidth(),y2:this.hostDesignerItem.getHeight()-c,angle1:0,angle2:0,len:d},s={id:"2",x1:c,y1:this.hostDesignerItem.getHeight(),x2:this.hostDesignerItem.getWidth()-c,y2:this.hostDesignerItem.getHeight(),angle1:90,angle2:90,len:d},r={id:"3",x1:0,y1:c,x2:0,y2:this.hostDesignerItem.getHeight()-c,angle1:180,angle2:180,len:d},!h||h!==a.META_RELATIONS.INHERITANCE&&h!==a.META_RELATIONS.MIXIN?(l.push(i),l.push(o),l.push(s),l.push(r)):e?-1===p.indexOf(s.id)?l.push(s):(l.push(i),l.push(o),l.push(r)):-1===p.indexOf(i.id)?l.push(i):(l.push(o),l.push(s),l.push(r))),l},p.prototype._showMetaTextEditorDialog=function(){var e=this._control._client,n=new d,i=this._metaInfo[t.GME_ID],o=e.getNode(i),r=o.getJsonMeta(i);n.show(e.getNode(i),JSON.stringify(r,void 0,2))},p}),define("decorators/MetaDecorator/MetaDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/MetaDecorator.DiagramDesignerWidget"],function(t,e){"use strict";var n,i=t,o=t.prototype,r="MetaDecorator";return n=function(t){var e=_.extend({loggerName:this.DECORATORID},t);i.apply(this,[e]),this.logger.debug("MetaDecorator ctor")},_.extend(n.prototype,o),n.prototype.DECORATORID=r,n.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:e}},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBaseWithDragPointerHelpers",["./DiagramDesignerWidget.DecoratorBase","js/Constants","js/DragDrop/DragConstants","js/DragDrop/DragHelper"],function(t,e,n,i){"use strict";var o,r="accept-droppable",s="DRAGGABLE";return o=function(e){t.call(this,e)},_.extend(o.prototype,t.prototype),o.prototype._enableDragEvents=function(){var t=this;this.$el.on("mouseenter."+s,null,function(e){t.__onMouseEnter(e)}).on("mouseleave."+s,null,function(e){t.__onMouseLeave(e)}).on("mouseup."+s,null,function(e){t.__onMouseUp(e)})},o.prototype._disableDragEvents=function(){this.$el.off("mouseenter."+s).off("mouseleave."+s).off("mouseup."+s)},o.prototype.__isPotentialDropItem=function(t,n){var o=!0,r=t.length;if(1===r)o=t[0]!==this._metaInfo[e.GME_ID]&&(-1!==n.indexOf(i.DRAG_EFFECTS.DRAG_CREATE_POINTER)||-1!==n.indexOf(i.DRAG_EFFECTS.DRAG_SET_REPLACEABLE)||n.indexOf(-1!==i.DRAG_EFFECTS.DRAG_ADD_MEMBER));else if(r>1&&n.indexOf(-1!==i.DRAG_EFFECTS.DRAG_ADD_MEMBER))for(;r--&&o;)o=t[r]!==this._metaInfo[e.GME_ID];else o=!1;return o},o.prototype.__onBackgroundDroppableOver=function(t){this.__onBackgroundDroppableAccept(t)===!0&&this.__doAcceptDroppable(!0)},o.prototype.__onBackgroundDroppableOut=function(){this.__doAcceptDroppable(!1)},o.prototype.__onBackgroundDrop=function(t){var e=t.data(n.DRAG_INFO),o=i.getDragItems(e),r=i.getDragEffects(e);this.__acceptDroppable===!0&&this.__isPotentialDropItem(o,r)&&(1===o.length?this._setPointerTarget(o[0],t.offset()):this._addMember(o,t.offset())),this.__doAcceptDroppable(!1)},o.prototype.__onBackgroundDroppableAccept=function(t){var e=t.data(n.DRAG_INFO),o=i.getDragItems(e),r=i.getDragEffects(e),s=!1;return this.__isPotentialDropItem(o,r)&&(s=this._getValidPointersForTarget(o[0]).length>0||this._isValidReplaceableTarget(o[0])||this._getValidSetsForTargets(o).length>0),s},o.prototype.__doAcceptDroppable=function(t){t===!0?(this.__acceptDroppable=!0,this.$el.addClass(r)):(this.__acceptDroppable=!1,this.$el.removeClass(r)),this.hostDesignerItem.canvas._enableDroppable(!t)},o.prototype.__onMouseEnter=function(t){this.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$.ui.ddmanager.current&&$.ui.ddmanager.current.helper&&(this.__onDragOver=!0,this.__onBackgroundDroppableOver($.ui.ddmanager.current.helper),t.stopPropagation(),t.preventDefault())},o.prototype.__onMouseLeave=function(t){this.__onDragOver&&(this.__onBackgroundDroppableOut(),this.__onDragOver=!1,t.stopPropagation(),t.preventDefault())},o.prototype.__onMouseUp=function(){this.__onDragOver&&(this.__onBackgroundDrop($.ui.ddmanager.current.helper),this.__onDragOver=!1,this.hostDesignerItem.canvas.acceptDropTempDisabled=!0)},o}),define("text!decorators/ModelDecorator/Core/ModelDecorator.html",[],function(){return'<div class="model-decorator">\n    <div class="name"></div>\n    <div class="ports">\n        <div class="left"></div>\n        <div class="center"></div>\n        <div class="right"></div>\n    </div>\n    <div class=\'connector bottom\'></div>\n    <div class=\'connector top\'></div>\n</div>'}),define("decorators/ModelDecorator/Core/Port",["js/logger","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","js/Constants"],function(t,e,n){"use strict";var i,o=20,r=15,s="w-icon",a=3,l=5;return i=function(e,n){this.id=e,this.title=n.title||"",this.icon=n.svg||"",this.orientation=void 0,this.position={},this.skinParts=[],this.connectionArea={x1:0,y1:0,x2:0,y2:0,angle1:0,angle2:0,len:o},this.decorator=n.decorator,this.logger=t.create("gme:decorators:ModelDecorator:Core:Port_"+this.id,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},i.prototype._DOMPortBase=$('<div  id="__ID__" class="port" data-id="__ID__"></div>'),i.prototype._DOMTitleWrapper=$('<div class="title-wrapper"><span class="title">__NAME__</span></div>'),i.prototype._DOMDot=$('<span class="dot"></span>'),i.prototype._DOMConnector=$('<div class="connector"></div>'),i.prototype._DOMSVGIcon=$('<img class="svg-icon"/>'),i.prototype._DOMBaseLeftTemplate=i.prototype._DOMPortBase.clone().append(i.prototype._DOMDot.clone()).append(i.prototype._DOMConnector.clone()).append(i.prototype._DOMSVGIcon.clone()).append(i.prototype._DOMTitleWrapper.clone()),i.prototype._DOMBaseRightTemplate=i.prototype._DOMPortBase.clone().append(i.prototype._DOMTitleWrapper.clone()).append(i.prototype._DOMSVGIcon.clone()).append(i.prototype._DOMDot.clone()).append(i.prototype._DOMConnector.clone()),i.prototype._initialize=function(){var t="W"===this.orientation?this._DOMBaseLeftTemplate:this._DOMBaseRightTemplate;this.$el=t.clone(),this.$el.attr({id:this.id,"data-id":this.id,title:this.title}),this.$portTitle=this.$el.find(".title"),this._updateTitle(),this.$portTitleWrapper=this.$el.find(".title-wrapper"),this.$portIcon=this.$el.find(".svg-icon"),this._updateIcon(),this.$connectors=this.$el.find("."+e.CONNECTOR_CLASS),this.$portDot=this.$el.find(".dot"),this.decorator._displayConnectors===!0?(this.decorator.hostDesignerItem&&this.decorator.hostDesignerItem.registerConnectors(this.$connectors,this.id),this.hideConnectors()):this.$connectors.remove()},i.prototype.update=function(t){this.title=t.title||"",this.icon=t.svg||"",this._updateTitle(),this._updateIcon()},i.prototype._updateTitle=function(){this.$portTitle.text(this.title),this.$el.attr({title:this.title})},i.prototype._updateIcon=function(){this.icon?(this.$portIcon.attr("src",n.ASSETS_DECORATOR_SVG_FOLDER+this.icon),this.$portIcon.show(),this.$el.addClass(s)):(this.$portIcon.hide(),this.$el.removeClass(s))},i.prototype.updateOrPos=function(t,e){var n=!1;return this.position.x!==e.x&&(this.position.x=e.x,n=!0),this.position.y!==e.y&&(this.position.y=e.y,n=!0),this.orientation!==t&&(this.orientation=t,n=!0,this.$el?(this.$connectors.detach(),this.$portDot.detach(),"E"===this.orientation?this.$el.append(this.$portDot).append(this.$connectors):this.$el.prepend(this.$connectors).prepend(this.$portDot),this.decorator._displayConnectors!==!0&&this.$connectors.remove()):this._initialize()),n},i.prototype.destroy=function(){this.$el&&(this.$el.remove(),this.$el.empty())},i.prototype.showConnectors=function(){this.$connectors.show()},i.prototype.hideConnectors=function(){this.$connectors.hide()},i.prototype.getConnectorArea=function(){var t,e=this.$el.parent().children(),n=e.length;for(t=0;n>t&&e[t]!==this.$el[0];t+=1);return this.connectionArea.x1="W"===this.orientation?0:this.decorator.hostDesignerItem.getWidth(),this.icon?this.connectionArea.x1+=("W"===this.orientation?-1:1)*(l-1):this.connectionArea.x1+=("W"===this.orientation?-1:1)*(a-1),this.connectionArea.x2=this.connectionArea.x1,this.connectionArea.y1=t*r+9,this.connectionArea.y2=this.connectionArea.y1,this.connectionArea.angle1="W"===this.orientation?180:0,this.connectionArea.angle2="W"===this.orientation?180:0,this.connectionArea},i}),define("decorators/ModelDecorator/Core/ModelDecorator.Constants",[],function(){"use strict";return{POINTER_CLASS:"ptr",POINTER_CLASS_NON_SET:"ptr-nonset",PROGRESS_BAR_CLASS:"progress-bar",REPLACEABLE_CLASS:"replaceable",SET_CLASS:"set"}}),define("js/Decorators/DecoratorWithPorts.Base",["js/Constants","js/Utils/GMEConcepts"],function(t,e){"use strict";var n;return n=function(){this.portIDs=[],this.ports={}},n.prototype.getTerritoryQuery=function(){var e={},n=this._metaInfo[t.GME_ID],i=this._control._client,o=i.getNode(n),r=this._aspect&&this._aspect!==t.ASPECT_ALL&&o&&-1!==o.getValidAspectNames().indexOf(this._aspect);return r?(e[n]=i.getAspectTerritoryPattern(n,this._aspect),e[n].children=1):e[n]={children:1},e},n.prototype.registerPortIdForNotification=function(e){var n=this._metaInfo[t.GME_ID];this._control.registerComponentIDForPartID(e,n)},n.prototype.unregisterPortIdForNotification=function(e){var n=this._metaInfo[t.GME_ID];this._control.unregisterComponentIDFromPartID(e,n)},n.prototype.updatePortIDList=function(){var t,e,n=this.getPortIDs(),i=this.portIDs.slice(0);for(e=_.difference(i,n),t=e.length;t--;)this.unregisterPortIdForNotification(e[t]),this.removePort(e[t]);for(e=_.difference(n,i),t=e.length;t--;)this.registerPortIdForNotification(e[t]),this.addPort(e[t])},n.prototype.getPortIDs=function(){var n,i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]),r=[],s=this._metaInfo[t.GME_ID],a=this._aspect&&this._aspect!==t.ASPECT_ALL&&-1!==o.getValidAspectNames().indexOf(this._aspect);if(o){for(r=o.getChildrenIds().slice(0),n=r.length;n--;)e.isPort(r[n])||r.splice(n,1);if(a)for(n=r.length;n--;)e.isValidTypeInAspect(r[n],s,this._aspect)||r.splice(n,1)}return r},n.prototype.isPort=function(t){return e.isPort(t)},n.prototype.addPort=function(t){this.isPort(t)&&(this.ports[t]=this.renderPort(t),this.portIDs.push(t))},n.prototype.renderPort=function(){return{destroy:function(){}}},n.prototype.removePort=function(t){var e=this.portIDs.indexOf(t);-1!==e&&(this.ports[t].destroy(),delete this.ports[t],this.portIDs.splice(e,1))},n}),define("js/Decorators/DecoratorWithPortsAndPointerHelpers.Base",["./DecoratorWithPorts.Base","js/Constants","js/Utils/GMEConcepts","js/Controls/ContextMenu"],function(t,e,n,i){"use strict";var o,r=[e.POINTER_SOURCE,e.POINTER_TARGET,e.POINTER_CONSTRAINED_BY];return o=function(){t.apply(this,[])},_.extend(o.prototype,t.prototype),o.prototype._getPointerNames=function(){var t=this._control._client,n=t.getNode(this._metaInfo[e.GME_ID]),i=[];return n&&(i=_.difference(n.getValidPointerNames(),r)),i},o.prototype._getValidPointersForTarget=function(t){
for(var n,i=this._control._client,o=this._metaInfo[e.GME_ID],r=this._getPointerNames(),s=r.length,a=[],l=i.getNode(t);s--&&l;)n=r[s],l.isValidTargetOf(o,n)&&a.push(n);return a.length>0&&a.sort(function(t,e){var n=t.toLowerCase(),i=e.toLowerCase();return i>n?-1:n>i?1:0}),a},o.prototype._getValidSetsForTargets=function(t){var n,i,o,r,s,a=this._control._client,l=this._metaInfo[e.GME_ID],c=a.getNode(l),d=c.getValidSetNames(),h=[];for(s=0;s<d.length;s+=1){for(r=c.getValidSetMemberTypesDetailed(d[s]),i=t.length,o=!0;o&&i--;)n=a.getNode(t[i]),n?n.isValidTargetOf(l,d[s])===!1&&(o=!1):o=!1;o&&h.push(d[s])}return h},o.prototype._getPointerTargets=function(){var t,n,i,o=[],r=this._control._client,s=r.getNode(this._metaInfo[e.GME_ID]);if(s){for(t=this._getPointerNames(),n=t.length;n--;)i=s.getPointer(t[n]),i&&void 0!==i.to&&null!==i.to&&o.push([t[n],i.to]);o.length>0&&o.sort(function(t,e){var n=t[0].toLowerCase(),i=e[0].toLowerCase();return i>n?-1:n>i?1:0})}return o},o.prototype._setPointerTarget=function(t,e){var n=this._getValidPointersForTarget(t),i=this._getValidSetsForTargets([t]),o=this._isValidReplaceableTarget(t);(n.length>0||o||i.length>0)&&(1!==n.length||o||0!==i.length?this._selectPointerForTarget(n,i,t,e,o):this._setPointer(n[0],t))},o.prototype._setPointer=function(t,n){var i=this._control._client,o=this._metaInfo[e.GME_ID],r=i.getNode(o),s=r.getPointer(t);s!==n&&i.setPointer(o,t,n)},o.prototype._selectPointerForTarget=function(t,e,n,o,r){var s,a,l=this.logger,c=this,d={};for(a=0;a<t.length;a+=1)d[t[a]]={icon:"glyphicon glyphicon-share",name:'Set pointer "'+t[a]+'"'};for(a=0;a<e.length;a+=1)d[e[a]]={icon:"glyphicon glyphicon-list-alt",name:'Add to set "'+e[a]+'"'};r&&(d[""]={icon:"glyphicon glyphicon-transfer",name:"Replace base"}),s=new i({items:d,callback:function(i){i?-1!==t.indexOf(i)?(l.debug("_selectPointerForTarget: "+i),c._setPointer(i,n)):-1!==e.indexOf(i)&&(l.debug("_selectPointerForTarget: "+i+" [set]"),c._addMembersToSet(i,[n])):c._replaceWithTarget(n)}}),s.show({x:o.left,y:o.top})},o.prototype._setPointerTerritory=function(t){var e=this.logger,n=t.length;if(this._selfPatterns={},n>0)for(this._territoryId||(this._territoryId=this._control._client.addUI(this,function(t){e.debug("onEvent: "+JSON.stringify(t))}));n--;)this._selfPatterns[t[n][1]]={children:0};this._selfPatterns&&!_.isEmpty(this._selfPatterns)?this._control._client.updateTerritory(this._territoryId,this._selfPatterns):this._territoryId&&this._control._client.removeUI(this._territoryId)},o.prototype._isReplaceable=function(){return n.isReplaceable(this._metaInfo[e.GME_ID])},o.prototype._isValidReplaceableTarget=function(t){return n.isValidReplaceableTarget(this._metaInfo[e.GME_ID],t)},o.prototype._replaceWithTarget=function(t){this._control._client.setBase(this._metaInfo[e.GME_ID],t)},o.prototype._addMember=function(t,e){var n=this._getValidSetsForTargets(t);n.length>0&&(1===n.length?this._addMembersToSet(n[0],t):this._selectSetForTarget(n,t,e))},o.prototype._addMembersToSet=function(t,n){var i,o=this._control._client,r=this._metaInfo[e.GME_ID];for(o.startTransaction(),i=0;i<n.length;i+=1)o.addMember(r,n[i],t);o.completeTransaction()},o.prototype._selectSetForTargets=function(t,e,n){var o,r,s=this.logger,a=this,l={};for(r=0;r<t.length;r+=1)l[t[r]]={icon:"glyphicon glyphicon-list-alt",name:'Add to set "'+t[r]+'"'};o=new i({items:l,callback:function(n){-1!==t.indexOf(n)&&(s.debug("_selectSetForTargets: "+n),a._addMembersToSet(n,e))}}),o.show({x:n.left,y:n.top})},o}),define("decorators/ModelDecorator/Core/ModelDecorator.Core",["js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Loader/LoaderProgressBar","./Port","./ModelDecorator.Constants","js/Decorators/DecoratorWithPortsAndPointerHelpers.Base","js/Utils/DisplayFormat","js/Utils/GMEConcepts"],function(t,e,n,i,o,r,s,a,l){"use strict";var c,d="abstract",h="embeddedsvg",p="conn-type",g=$("<div/>",{"class":p}),u=$("<img>",{"class":h});return c=function(t){s.apply(this,[]),t&&t.aspect&&(this._aspect=t.aspect)},_.extend(c.prototype,s.prototype),c.prototype._initializeVariables=function(t){this.name="",this.formattedName="",this.portIDs=[],this.ports={},this.skinParts={$name:void 0,$portsContainer:void 0,$portsContainerLeft:void 0,$portsContainerRight:void 0,$portsContainerCenter:void 0,$ptr:void 0,$imgSVG:void 0,$replaceable:void 0},this._displayConnectors=!1,t&&t.connectors&&(this._displayConnectors=t.connectors)},c.prototype.destroy=function(){for(var t=this.portIDs.length;t--;)this.unregisterPortIdForNotification(this.portIDs[t]),this.removePort(this.portIDs[t])},c.prototype.doSearch=function(t){var e=t.toString().toLowerCase();return this.formattedName&&-1!==this.formattedName.toLowerCase().indexOf(e)},c.prototype._renderContent=function(){this.$el.attr({"data-id":this._metaInfo[t.GME_ID]}),this.skinParts.$name=this.$el.find(".name"),this.skinParts.$portsContainer=this.$el.find(".ports"),this.skinParts.$portsContainerLeft=this.skinParts.$portsContainer.find(".left"),this.skinParts.$portsContainerRight=this.skinParts.$portsContainer.find(".right"),this.skinParts.$portsContainerCenter=this.skinParts.$portsContainer.find(".center"),this._update()},c.prototype._update=function(){this._updateColors(),this._updateName(),this._updatePorts(),this._updatePointers(),this._updateAbstract(),this._updateSVG(),this._updateConnectionType(),this._updateIsReplaceable()},c.prototype._updateColors=function(){this._getNodeColorsFromRegistry(),this.fillColor?this.$el.css({"background-color":this.fillColor}):this.$el.css({"background-color":""}),this.borderColor?(this.$el.css({"border-color":this.borderColor,"box-shadow":"0px 0px 7px 0px "+this.borderColor+" inset"}),this.skinParts.$name.css({"border-color":this.borderColor})):(this.$el.css({"border-color":"","box-shadow":""}),this.skinParts.$name.css({"border-color":""})),this.textColor?this.$el.css({color:this.textColor}):this.$el.css({color:""})},c.prototype._getNodeColorsFromRegistry=function(){var e=this._metaInfo[t.GME_ID];this.fillColor=this.preferencesHelper.getRegistry(e,n.COLOR,!0),this.borderColor=this.preferencesHelper.getRegistry(e,n.BORDER_COLOR,!0),this.textColor=this.preferencesHelper.getRegistry(e,n.TEXT_COLOR,!0)},c.prototype._updateName=function(){var e=this._control._client,n=e.getNode(this._metaInfo[t.GME_ID]),i="(N/A)";n?(this.name=n.getFullyQualifiedName(),this.formattedName=a.resolve(n)):(this.name="",this.formattedName=i),this.skinParts.$name.text(this.formattedName),this.skinParts.$name.attr("title",this.formattedName)},c.prototype._updateConnectionType=function(){var e=l.isConnectionType(this._metaInfo[t.GME_ID]);this.skinParts.$name.text(this.formattedName),this.skinParts.$name.attr("title",this.formattedName),e?this.skinParts.$divConnType||(this.skinParts.$divConnType=g.clone(),this.skinParts.$divConnType.insertAfter(this.skinParts.$name),this.skinParts.$divConnType.text("<< Connection >>")):this.skinParts.$divConnType&&(this.skinParts.$divConnType.remove(),delete this.skinParts.$divConnType)},c.prototype._updatePorts=function(){this.updatePortIDList(),this._checkTerritoryReady()},c.prototype.renderPort=function(t){var e=this._control._client,i=e.getNode(t),r=a.resolve(i),s=new o(t,{title:r,decorator:this,svg:i.getRegistry(n.PORT_SVG_ICON)});return this._addPortToContainer(i,s),s},c.prototype._addPortToContainer=function(t,e){var i,o,r=t.getId(),s="W",a=this.skinParts.$portsContainerLeft,l=t.getRegistry(n.POSITION)||{x:0,y:0},c=null;l.x>300&&(s="E",a=this.skinParts.$portsContainerRight),o=e.updateOrPos(s,l);for(i in this.ports)this.ports.hasOwnProperty(i)&&i!==r&&this.ports[i].orientation===e.orientation&&(e.position.y<this.ports[i].position.y||e.position.y===this.ports[i].position.y&&e.title<this.ports[i].title)&&(null===c?c=i:(this.ports[i].position.y<this.ports[c].position.y||this.ports[i].position.y===this.ports[c].position.y&&this.ports[i].title<this.ports[c].title)&&(c=i));null===c?a.append(e.$el):e.$el.insertBefore(this.ports[c].$el),o===!0&&this._portPositionChanged(r)},c.prototype._portPositionChanged=function(){},c.prototype._updatePort=function(t){var e,i=this.portIDs.indexOf(t),o=this._control._client,r=o.getNode(t),s=this.isPort(t);-1!==i?s===!0?(e=a.resolve(r),this.ports[t].update({title:e,svg:r.getRegistry(n.PORT_SVG_ICON)}),this._updatePortPosition(t)):this.removePort(t):this.addPort(t)},c.prototype._updatePortPosition=function(t){var e=this._control._client.getNode(t),i=e.getRegistry(n.POSITION)||{x:0,y:0};(this.ports[t].position.x!==i.x||this.ports[t].position.y!==i.y)&&(this.ports[t].$el.detach(),this._addPortToContainer(e,this.ports[t]))},c.prototype._checkTerritoryReady=function(){var e,n,i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]),r=!0;if(this._aspect===t.ASPECT_ALL)if(o){for(e=o.getChildrenIds(),n=e.length;n--;)if(o=i.getNode(e[n]),!o){r=!1;break}}else r=!1;r===!0?this._hidePortProgressBar():this._showPortProgressBar()},c.prototype._showPortProgressBar=function(){var t=this.$el.find("."+r.PROGRESS_BAR_CLASS);0===t.length&&(t=$("<div/>",{"class":r.PROGRESS_BAR_CLASS}),this.$el.append(t),this._loader=new i({containerElement:t}),this._loader.start())},c.prototype._hidePortProgressBar=function(){this._loader&&(this._loader.stop(),this._loader.destroy(),delete this._loader),this.$el.find("."+r.PROGRESS_BAR_CLASS).remove()},c.prototype._ptrUIDOMBase=$('<div class="'+r.POINTER_CLASS+'" title="Follow the pointer(s) of the node"><i class="glyphicon glyphicon-share"></i></div>'),c.prototype._setUIDOMBase=$('<div class="'+r.SET_CLASS+'" title="See the sets of the node..."><i class="glyphicon glyphicon-list-alt"></i></div>'),c.prototype._replaceableUIDOMBase=$('<div class="'+r.REPLACEABLE_CLASS+'"><i class="glyphicon glyphicon-transfer" title="This node is replaceable"></i></div>'),c.prototype._updatePointers=function(){var e,n=this._control._client,i=n.getNode(this._metaInfo[t.GME_ID]);this._getPointerNames().length>0?(this.skinParts.$ptr=this.$el.find("."+r.POINTER_CLASS),0===this.skinParts.$ptr.length&&(this.skinParts.$ptr=this._ptrUIDOMBase.clone(),this.$el.append(this.skinParts.$ptr)),e=this._getPointerTargets(),e.length>0?this.skinParts.$ptr.removeClass(r.POINTER_CLASS_NON_SET):this.skinParts.$ptr.addClass(r.POINTER_CLASS_NON_SET)):this.skinParts.$ptr&&(this.skinParts.$ptr.remove(),this.skinParts.$ptr=void 0),i&&i.getValidSetNames().length>0?(this.skinParts.$set=this.$el.find("."+r.SET_CLASS),0===this.skinParts.$set.length&&(this.skinParts.$set=this._setUIDOMBase.clone(),this.$el.append(this.skinParts.$set))):this.skinParts.$set&&(this.skinParts.$set.remove(),this.skinParts.$set=void 0)},c.prototype._updateAbstract=function(){var e=this._control._client,i=e.getNode(this._metaInfo[t.GME_ID]);i&&i.getRegistry(n.IS_ABSTRACT)===!0?this.$el.addClass(d):this.$el.removeClass(d)},c.prototype._updateSVG=function(){var e,i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]),r="",s=this;o&&(r=o.getRegistry(n.SVG_ICON)),r?(e=t.ASSETS_DECORATOR_SVG_FOLDER+r,this.skinParts.$imgSVG||(this.skinParts.$imgSVG=u.clone(),this.$el.append(this.skinParts.$imgSVG)),this.skinParts.$imgSVG.attr("src")!==e&&(this.skinParts.$imgSVG.on("load",function(){s._svgReady()}),this.skinParts.$imgSVG.on("error",function(){s._svgReady()}),this.skinParts.$imgSVG.attr("src",e))):this.skinParts.$imgSVG&&(this.skinParts.$imgSVG.remove(),this.skinParts.$imgSVG=void 0)},c.prototype._svgReady=function(){var t=this.skinParts.$portsContainer.outerHeight(),e=5,n=-t+e;if(this.skinParts.$imgSVG.css("margin-top",n),this.skinParts.$imgSVG.off("load"),this.skinParts.$imgSVG.off("error"),_.isFunction(this.onRenderGetLayoutInfo)&&this.onRenderGetLayoutInfo(),this.hostDesignerItem&&this.hostDesignerItem.canvas){var i=this.hostDesignerItem.canvas.selectionManager.getSelectedElements();1===i.length&&i[0]===this.hostDesignerItem.id&&(this.hostDesignerItem.canvas.selectNone(),this.hostDesignerItem.canvas.select([this.hostDesignerItem.id]))}},c.prototype._updateIsReplaceable=function(){this._isReplaceable()?(this.skinParts.$replaceable=this.$el.find("."+r.REPLACEABLE_CLASS),0===this.skinParts.$replaceable.length&&(this.skinParts.$replaceable=this._replaceableUIDOMBase.clone(),this.$el.append(this.skinParts.$replaceable))):this.skinParts.$replaceable&&(this.skinParts.$replaceable.remove(),this.skinParts.$replaceable=void 0)},c}),define("css!decorators/ModelDecorator/DiagramDesigner/ModelDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/ModelDecorator/DiagramDesigner/ModelDecorator.DiagramDesignerWidget",["js/Constants","js/NodePropertyNames","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBaseWithDragPointerHelpers","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/ModelDecorator.html","../Core/ModelDecorator.Core","../Core/ModelDecorator.Constants","js/Controls/ContextMenu","css!./ModelDecorator.DiagramDesignerWidget.css"],function(t,e,n,i,o,r,s,a){"use strict";var l,c="ModelDecoratorDiagramDesignerWidget",d=15;return l=function(t){var e=_.extend({},t);n.apply(this,[e]),r.apply(this,[e]),this._initializeVariables({connectors:!0}),this._selfPatterns={},this.logger.debug("ModelDecoratorDiagramDesignerWidget ctor")},_.extend(l.prototype,n.prototype),_.extend(l.prototype,r.prototype),l.prototype.DECORATORID=c,l.prototype.$DOMBase=$(o),l.prototype.on_addTo=function(){var e=this;this._renderContent(),this.skinParts.$name.on("dblclick.editOnDblClick",null,function(t){e.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",value:e.name,onChange:function(t,n){e.__onNodeTitleChanged(t,n)},onFinish:function(){e.skinParts.$name.text(e.formattedName),e.skinParts.$name.attr("title",e.formattedName)}}),t.stopPropagation(),t.preventDefault()}),this.$el.on("dblclick.ptrDblClick","."+s.POINTER_CLASS,function(t){$(this).hasClass(s.POINTER_CLASS_NON_SET)||e.__onPointerDblClick({x:t.clientX,y:t.clientY}),t.stopPropagation(),t.preventDefault()}),this.$el.on("dblclick.setDblClick","."+s.SET_CLASS,function(t){e.__onSetDblClick({x:t.clientX,y:t.clientY}),t.stopPropagation(),t.preventDefault()}),this.$el.on("dblclick.replDblClick","."+s.REPLACEABLE_CLASS,function(n){e._control._replaceBaseDialog(e._metaInfo[t.GME_ID]),n.stopPropagation(),n.preventDefault()}),this._updateDropArea()},l.prototype.update=function(){this._update(),this._updateDropArea()},l.prototype.onRenderGetLayoutInfo=function(){this._paddingTop=parseInt(this.$el.css("padding-top"),10),this._borderTop=parseInt(this.$el.css("border-top-width"),10),n.prototype.onRenderGetLayoutInfo.call(this)},l.prototype.destroy=function(){this._territoryId&&this._control._client.removeUI(this._territoryId),r.prototype.destroy.call(this)},l.prototype.getConnectionAreas=function(t){var e=[],n=10,i=20;if(void 0===t||t===this.hostDesignerItem.id){e.push({id:"N",x1:n,y1:0,x2:this.hostDesignerItem.getWidth()-n,y2:0,angle1:270,angle2:270,len:i}),e.push({id:"S",x1:n,y1:this.hostDesignerItem.getHeight(),x2:this.hostDesignerItem.getWidth()-n,y2:this.hostDesignerItem.getHeight(),angle1:90,angle2:90,len:i});var o=!0,r=!0;for(var s in this.ports)if(this.ports.hasOwnProperty(s)&&("E"===this.ports[s].orientation&&(o=!1),"W"===this.ports[s].orientation&&(r=!1)),!o&&!r)break;o&&e.push({id:"E",x1:this.hostDesignerItem.getWidth(),y1:n,x2:this.hostDesignerItem.getWidth(),y2:this.hostDesignerItem.getHeight()-n,angle1:0,angle2:0,len:i}),r&&e.push({id:"W",x1:0,y1:n,x2:0,y2:this.hostDesignerItem.getHeight()-n,angle1:180,angle2:180,len:i})}else if(this.ports[t]){var a=this.ports[t].getConnectorArea(),l=this.portIDs.indexOf(t);e.push({id:l,x1:a.x1,y1:a.y1+d+this._paddingTop+this._borderTop,x2:a.x2,y2:a.y2+d+this._paddingTop+this._borderTop,angle1:a.angle1,angle2:a.angle2,len:a.len})}return e},l.prototype.updateSubcomponent=function(t){this._updatePort(t)},l.prototype.showSourceConnectors=function(t){var e,n;if(t)for(e=t.connectors,n=e.length;n--;)void 0===e[n]?this.$sourceConnectors.show():this.ports[e[n]]&&this.ports[e[n]].showConnectors();else if(this.$sourceConnectors.show(),this.portIDs)for(n=this.portIDs.length;n--;)this.ports[this.portIDs[n]].showConnectors()},l.prototype.hideSourceConnectors=function(){var t;if(this.$sourceConnectors.hide(),this.portIDs)for(t=this.portIDs.length;t--;)this.ports[this.portIDs[t]].hideConnectors()},l.prototype.showEndConnectors=function(t){this.showSourceConnectors(t)},l.prototype.hideEndConnectors=function(){this.hideSourceConnectors()},l.prototype.notifyComponentEvent=function(t){for(var e=t.length;e--;)this._updatePort(t[e].id);this._checkTerritoryReady()},l.prototype._portPositionChanged=function(t){this.onRenderGetLayoutInfo(),this.hostDesignerItem.canvas.dispatchEvent(this.hostDesignerItem.canvas.events.ITEM_SUBCOMPONENT_POSITION_CHANGED,{ItemID:this.hostDesignerItem.id,SubComponentID:t})},l.prototype.renderPort=function(t){return this.__registerAsSubcomponent(t),r.prototype.renderPort.call(this,t)},l.prototype.removePort=function(t){var e=this.portIDs.indexOf(t);-1!==e&&this.__unregisterAsSubcomponent(t),r.prototype.removePort.call(this,t)},l.prototype._updateDropArea=function(){var t="inverse-on-hover";this.skinParts.$ptr||this.skinParts.$replaceable||this.skinParts.$set?(this.skinParts.$ptr&&(this.skinParts.$ptr.hasClass(s.POINTER_CLASS_NON_SET)?this.skinParts.$ptr.removeClass(t):this.skinParts.$ptr.addClass(t)),this._enableDragEvents()):this._disableDragEvents(),this._setPointerTerritory(this._getPointerTargets())},l.prototype.__registerAsSubcomponent=function(t){this.hostDesignerItem&&this.hostDesignerItem.registerSubcomponent(t,{GME_ID:t})},l.prototype.__unregisterAsSubcomponent=function(t){this.hostDesignerItem&&this.hostDesignerItem.unregisterSubcomponent(t)},l.prototype.__onNodeTitleChanged=function(n,i){var o=this._control._client;o.setAttribute(this._metaInfo[t.GME_ID],e.Attributes.name,i)},l.prototype.__onPointerDblClick=function(t){var e,n,i=this._getPointerTargets(),o=this,r={},s={};if(i.length>0)if(1===i.length)this._navigateToPointerTarget(i[0][1]);else{for(n=0;n<i.length;n+=1)r[i[n][0]]={name:'Follow pointer "'+i[n][0]+'"'},s[i[n][0]]=i[n][1];e=new a({items:r,callback:function(t){o._navigateToPointerTarget(s[t])}}),e.show(t)}},l.prototype.__onSetDblClick=function(e){var n={};n[t.STATE_ACTIVE_OBJECT]=this._metaInfo[t.GME_ID],n[t.STATE_ACTIVE_VISUALIZER]="SetEditor",WebGMEGlobal.State.set(n,{suppressVisualizerFromNode:!0})},l.prototype._navigateToPointerTarget=function(e){var n,i=this._control._client;n=i.getNode(e),n&&(n.getParentId()||n.getParentId()===t.PROJECT_ROOT_ID?(WebGMEGlobal.State.registerActiveObject(n.getParentId()),WebGMEGlobal.State.registerActiveSelection([e])):(WebGMEGlobal.State.registerActiveObject(t.PROJECT_ROOT_ID),WebGMEGlobal.State.registerActiveSelection([e])))},l}),define("css!decorators/ModelDecorator/PartBrowser/ModelDecorator.PartBrowserWidget",[],function(){}),define("decorators/ModelDecorator/PartBrowser/ModelDecorator.PartBrowserWidget",["js/Constants","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/ModelDecorator.html","../Core/ModelDecorator.Core","css!./ModelDecorator.PartBrowserWidget.css"],function(t,e,n,i,o,r){"use strict";var s,a="ModelDecoratorPartBrowserWidget";return s=function(t){var e=_.extend({},t);n.apply(this,[e]),r.apply(this,[e]),this._initializeVariables({connectors:!1}),this.logger.debug("ModelDecoratorPartBrowserWidget ctor")},_.extend(s.prototype,n.prototype),_.extend(s.prototype,r.prototype),s.prototype.DECORATORID=a,s.prototype.$DOMBase=function(){var t=$(o);return t.find("."+i.CONNECTOR_CLASS).remove(),t}(),s.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this._renderContent()},s.prototype.afterAppend=function(){},s.prototype.update=function(){this._update()},s.prototype.notifyComponentEvent=function(t){for(var e=t.length;e--;)this._updatePort(t[e]);this._checkTerritoryReady()},s}),define("decorators/ModelDecorator/ModelDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/ModelDecorator.DiagramDesignerWidget","./PartBrowser/ModelDecorator.PartBrowserWidget"],function(t,e,n){"use strict";var i,o=t,r=t.prototype,s="ModelDecorator";return i=function(t){var e=_.extend({loggerName:this.DECORATORID},t);o.apply(this,[e]),this.logger.debug("ModelDecorator ctor")},_.extend(i.prototype,r),i.prototype.DECORATORID=s,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:e,PartBrowser:n}},i}),define("text!decorators/SVGDecorator/Core/SVGDecorator.html",[],function(){return'<div class="svg-decorator">\n    <div class="svg-content"></div>\n    <div class="name"></div>\n</div>'}),define("text!decorators/SVGDecorator/Core/default.svg",[],function(){return'<svg width="100" height="50" xmlns="http://www.w3.org/2000/svg">\n <g>\n  <rect fill="#ececec" stroke-width="1" x="0.5" y="0.5" width="99" height="49" stroke="#000"/>\n  <text fill="#191919" stroke-width="0" stroke-opacity="null" x="50" y="25" font-size="10" text-anchor="middle" stroke="#000"></text>\n </g>\n</svg>'}),define("decorators/SVGDecorator/Core/SVGDecorator.Core",["js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Utils/DisplayFormat","js/Decorators/DecoratorWithPortsAndPointerHelpers.Base","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!./default.svg","common/regexp"],function(t,e,n,i,o,r,s,a){"use strict";var l,c="abstract",d=t.ASSETS_DECORATOR_SVG_FOLDER,h="fill-color",p="border-color",g="text-color",u={},f=$(s);return l=function(){o.apply(this,[]),this.svgCache=u},_.extend(l.prototype,o.prototype),l.prototype._initializeVariables=function(t){if(this.name="",this.formattedName="",this.$name=void 0,this.$replaceable=void 0,t.data){this.customData=[];for(var e=t.data.length;e--;)void 0===this[t.data[e]]&&(this.customData.push(t.data[e]),this[t.data[e]]=null)}},l.prototype.doSearch=function(t){var e=t.toString().toLowerCase();return this.formattedName&&-1!==this.formattedName.toLowerCase().indexOf(e)},l.prototype._renderContent=function(){this.$el.attr({"data-id":this._metaInfo[t.GME_ID]}),this.$name=this.$el.find(".name"),this.$svgContent=this.$el.find(".svg-content"),this._update()},l.prototype._update=function(){this._updateSVGFile(),this._updateColors(),this._updateName(),this._updateAbstract(),this._updatePorts(),this._updateIsReplaceable()},l.prototype._updateColors=function(){var t=this.$svgElement,e=t.find("."+h),n=t.find("."+p),i=t.find("."+g);this._getNodeColorsFromRegistry(),this.fillColor?e.css({fill:this.fillColor}):e.css({fill:""}),this.borderColor?n.css({stroke:this.borderColor}):n.css({stroke:""}),this.textColor?(this.$el.css({color:this.textColor}),i.css({fill:this.textColor})):(this.$el.css({color:""}),i.css({fill:""}))},l.prototype._getNodeColorsFromRegistry=function(){var e=this._metaInfo[t.GME_ID];this.fillColor=this.preferencesHelper.getRegistry(e,n.COLOR,!0),this.borderColor=this.preferencesHelper.getRegistry(e,n.BORDER_COLOR,!0),this.textColor=this.preferencesHelper.getRegistry(e,n.TEXT_COLOR,!0)},l.prototype._updateName=function(){var e=this._control._client,n=e.getNode(this._metaInfo[t.GME_ID]),o="(N/A)";n?(this.name=n.getFullyQualifiedName(),this.formattedName=i.resolve(n)):(this.name="",this.formattedName=o),this.$name.text(this.formattedName),this.$name.attr("title",this.formattedName)},l.prototype._updateAbstract=function(){var e=this._control._client,i=e.getNode(this._metaInfo[t.GME_ID]);i&&i.getRegistry(n.IS_ABSTRACT)===!0?this.$el.addClass(c):this.$el.removeClass(c)},l.prototype._updateSVGFile=function(){var e,i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]),r="",s=this,a=this.logger;o&&(r=o.getRegistry(n.SVG_ICON)),r?this._SVGFile!==r&&(this.svgCache[r]?this._updateSVGContent(r):(e=d+r,$.ajax(e,{async:!1}).done(function(t){var e=$(t).find("svg");e.length>0?(s.svgCache[r]={el:e.first(),customConnectionAreas:void 0},s._discoverCustomConnectionAreas(r),s._getCustomDataFromSvg(r),s.processCustomSvgData(),s._updateSVGContent(r)):s._updateSVGContent(void 0)}).fail(function(){a.error("Failed to download SVG file: "+r),s._updateSVGContent(r)})),this._SVGFile=r):""!==r?(a.error('Invalid SVG file: "'+r+'"'),this._updateSVGContent(void 0)):this._updateSVGContent("")},l.prototype._updateSVGContent=function(t){var e;this.$svgContent.empty(),this.$svgContent.removeClass(),this.$svgContent.addClass("svg-content"),this.$svgContent.addClass(t.replace(a.INVALID_CSS_CHARS,"__")),this.$el.find("> ."+r.CONNECTOR_CLASS).remove(),this._defaultSVGUsed=!1,this.svgCache[t]?e=this.svgCache[t].el.clone():(e=f.clone(),""!==t?$(e.find("text")).html("!!! "+t+" !!!"):this._defaultSVGUsed=!0),this.$svgElement=e,this._getCustomConnectionAreas(t),this._generateConnectors(),this.$svgContent.append(e)},l.prototype._getCustomDataFromSvg=function(t){if(this.customData)for(var e,n,i=this.customData.length,o=this.svgCache[t].el;i--;)for(e=this.customData[i],this[e]=o.find("."+e),n=this[e].length;n--;)this[e][n].remove()},l.prototype.processCustomSvgData=function(){},l.prototype.getSVGCustomData=function(t){var e=null;return this.customData&&-1!==this.customData.indexOf(t)&&(this[t]instanceof Array?e=this[t].slice():this[t]instanceof Object&&(e=_.extend({},this[t]))),e},l.prototype._updateExtras=function(){},l.prototype._updatePorts=function(){},l.prototype._fixPortContainerPosition=function(){},l.prototype._discoverCustomConnectionAreas=function(){},l.prototype._getCustomConnectionAreas=function(){},l.prototype._generateConnectors=function(){},l.prototype._updateIsReplaceable=function(){this._isReplaceable()?(this.$replaceable=this.$el.find(".replaceable"),0===this.$replaceable.length&&(this.$replaceable=$('<div class="replaceable"><i class="glyphicon glyphicon-transfer" title="This node is replaceable"></i></div>'),this.$el.append(this.$replaceable))):this.$replaceable&&(this.$replaceable.remove(),this.$replaceable=void 0)},l}),define("decorators/SVGDecorator/Core/SVGDecorator.Connections",[],function(){"use strict";var t,e="connection-area",n="angle",i="angle1",o="angle2",r={};return t=function(){},t.prototype.setConnectionAreaDefaults=function(t){r=t},t.prototype._getCustomConnectionAreas=function(t){var e,n=this.svgCache[t]?this.svgCache[t].customConnectionAreas:null,i=n?n.length:0;if(delete this._customConnectionAreas,i>0)for(this._customConnectionAreas=[];i--;)e={},_.extend(e,n[i]),this._customConnectionAreas.push(e)},t.prototype._discoverCustomConnectionAreas=function(t){var s,a,l,c,d,h,p,g,u,f=this.svgCache[t].el,m=f.find("."+e),b=m.length,y=1;if(b>0){if(p=parseInt(f.attr("width"),10),g=f[0].getAttribute("viewBox")){var v=parseInt(g.split(" ")[0],10),C=parseInt(g.split(" ")[2],10);y=p/(C-v)}for(this.svgCache[t].customConnectionAreas=[],u=this.svgCache[t].customConnectionAreas;b--;)s=$(m[b]),a={id:s.attr("id"),x1:parseInt(s.attr("x1"),10)*y,y1:parseInt(s.attr("y1"),10)*y,x2:parseInt(s.attr("x2"),10)*y,y2:parseInt(s.attr("y2"),10)*y},l=s.data(),_.extend(a,r),_.extend(a,l),l.hasOwnProperty(n)||l.hasOwnProperty(i)&&l.hasOwnProperty(o)||(c=a.x2-a.x1,d=a.y2-a.y1,0!==c&&0!==d?(h=Math.atan(d/c)*(180/Math.PI),c>0?h=270+h:0>c&&(h=90+h)):0===c&&0!==d?h=d>0?0:180:0!==c&&0===d&&(h=c>0?270:90),a.angle1=h,a.angle2=h),u.push(a),s.remove()}},t}),define("decorators/SVGDecorator/Core/SVGDecorator.Connectors",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(t){"use strict";var e,n=$('<div class="'+t.CONNECTOR_CLASS+'"/>');return e=function(){},e.prototype._generateConnectors=function(){var e,i=this.$svgElement,o=i.find("."+t.CONNECTOR_CLASS),r=parseInt(i.attr("width"),10),s=parseInt(i.attr("height"),10);0===o.length&&(e=n.clone(),e.addClass("cn"),e.css({top:0,left:r/2}),this.$el.append(e),e=n.clone(),e.addClass("cs"),e.css({top:s,left:r/2}),this.$el.append(e),e=n.clone(),e.addClass("ce"),e.css({top:s/2,left:r}),this.$el.append(e),e=n.clone(),e.addClass("cw"),e.css({top:s/2,left:0}),this.$el.append(e)),this.initializeConnectors()},e}),define("decorators/SVGDecorator/Core/SVGPort",["js/Constants","js/Utils/DisplayFormat","js/RegistryKeys","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(t,e,n,i){"use strict";var o,r=t.ASSETS_DECORATOR_SVG_FOLDER,s="Port.svg";return o=function(t){this._id=t.id,this._logger=t.logger,this._client=t.client,this._decorator=t.decorator,this._initialize()},o.prototype.destroy=function(){this.hideConnectors(),this.$el&&(this.$el.remove(),this.$el.empty())},o.prototype._initialize=function(){this.$el=$("<div/>",{"class":"port"}),this.$title=$("<div/>",{"class":"title"}),this.$icon=$("<div/>",{"class":"icon"}),this.$connector=$("<div/>",{"class":i.CONNECTOR_CLASS}),this.$imgIcon=$("<img/>"),this.$icon.append(this.$imgIcon),this.$el.append(this.$icon).append(this.$title).append(this.$connector),this._decorator._displayConnectors===!0?(this._decorator.hostDesignerItem&&this._decorator.hostDesignerItem.registerConnectors(this.$connector,this._id),this.hideConnectors()):this.$connector.remove()},o.prototype.update=function(){this._updateCoordinates(),this._updateTitle(),this._updateIcon()},o.prototype._updateCoordinates=function(){var t=this._client.getNode(this._id);this.positionX=parseInt(t.getRegistry(n.POSITION).x,10),this.positionY=parseInt(t.getRegistry(n.POSITION).y,10)},o.prototype._updateTitle=function(){var t=this._client.getNode(this._id),n=e.resolve(t);this.$title.text(n),this.$title.attr("title",n)},o.prototype._updateIcon=function(){var t=this._client.getNode(this._id),e=t.getRegistry(n.PORT_SVG_ICON);e=e&&""!==e?r+e:r+s,this.$imgIcon.attr("src",e)},o.prototype.updateOrientation=function(t){this.isLeft=t},o.prototype.updateTop=function(t){this.$el.css("top",t),this.top=t},o.prototype.showConnectors=function(){this.$connector.show()},o.prototype.hideConnectors=function(){this.$connector.hide()},o}),define("decorators/SVGDecorator/Core/SVGDecorator.Ports",["js/Decorators/DecoratorWithPorts.Base","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","./SVGPort"],function(t,e,n){"use strict";var i,o=13,r=50;return i=function(){t.apply(this,[])},_.extend(i.prototype,t.prototype),i.prototype._initializePortVariables=function(){this._PORT_HEIGHT=o},i.prototype._updatePorts=function(){var t=this.$svgElement,e=parseInt(t.attr("width"),10),n=e/2;this._portContainerWidth=n,this.$leftPorts||(this.$leftPorts=$("<div/>",{"class":"ports ports-l"}),this.$leftPorts.insertAfter(this.$svgContent)),this.$leftPorts.css({width:n}),this.$rightPorts||(this.$rightPorts=$("<div/>",{"class":"ports ports-r"}),this.$rightPorts.insertAfter(this.$svgContent)),this.$rightPorts.css({width:n,left:n}),this.updatePortIDList();for(var i=0;i<this.portIDs.length;i+=1)this.ports[this.portIDs[i]].update();this._updatePortPositions()},i.prototype._fixPortContainerPosition=function(t){this._portContainerXShift=t,this.$leftPorts.css("transform","translateX("+t+"px)"),this.$rightPorts.css("transform","translateX("+t+"px)")},i.prototype.renderPort=function(t){return new n({id:t,logger:this.logger,client:this._control._client,decorator:this})},i.prototype._updatePortPositions=function(){var t,n,i,s,a,l,c,d,h,p=[],g=[],u=300,f=2,m=1,_=this.ports;for(t=0;t<this.portIDs.length;t+=1)this.ports[this.portIDs[t]].positionX>u?g.push(this.portIDs[t]):p.push(this.portIDs[t]);for(n=function(t,e){var n=_[t].positionY,i=_[e].positionY;return n-i},p.sort(n),g.sort(n),t=0;t<p.length;t+=1)i=_[p[t]],this.$leftPorts.append(i.$el),i.updateOrientation(!0),i.updateTop(m+t*o);for(this.$leftPorts.css("height",p.length*o),this.$leftPorts.find(".port > .title").css("left",f),this.$leftPorts.find(".port > .title").css("width",this._portContainerWidth-f),this.$leftPorts.find(".port > .icon").css("left",-o),this.$leftPorts.find(".port > ."+e.CONNECTOR_CLASS).css("left",-o+1),t=0;t<g.length;t+=1)i=_[g[t]],this.$rightPorts.append(i.$el),i.updateOrientation(!1),i.updateTop(m+t*o);this.$rightPorts.css("height",g.length*o),this.$rightPorts.find(".port > .title").css("right",-this._portContainerWidth+f),
this.$rightPorts.find(".port > .title").css("width",this._portContainerWidth-f),this.$rightPorts.find(".port > .icon").css("left",this._portContainerWidth),this.$rightPorts.find(".port > ."+e.CONNECTOR_CLASS).css("left",this._portContainerWidth),this._leftPorts=p.length>0,this._rightPorts=g.length>0,l=Math.max(p.length*o,g.length*o,r),l=Math.max(p.length*o,g.length*o,r),this._defaultSVGUsed===!0&&(s=this.$svgElement,a=s.find("rect"),s.attr("height",l),a.attr("height",l-1),c=this.$el.find("."+e.CONNECTOR_CLASS+".cs"),c.css("top",l)),this._leftPorts&&(d=this.$el.find("."+e.CONNECTOR_CLASS+".cw"),d.css("top",l/2),d.remove()),this._rightPorts&&(h=this.$el.find("."+e.CONNECTOR_CLASS+".ce"),h.css("top",l/2),h.remove())},i.prototype._updatePort=function(t){var e=this.isPort(t);this.ports[t]?e===!0?this.ports[t].update():this.removePort(t):(this.addPort(t),this.ports[t]&&this.ports[t].update()),this._updatePortPositions()},i}),define("decorators/SVGDecorator/DiagramDesigner/SVGDecorator.Core",["../Core/SVGDecorator.Core","../Core/SVGDecorator.Connections","../Core/SVGDecorator.Connectors","../Core/SVGDecorator.Ports"],function(t,e,n,i){"use strict";var o=function(e){var n=_.extend({},e);t.apply(this,[n]),this.setConnectionAreaDefaults({angle1:0,angle2:0,len:20})};return _.extend(o.prototype,t.prototype),_.extend(o.prototype,i.prototype),_.extend(o.prototype,e.prototype),_.extend(o.prototype,n.prototype),o}),define("css!decorators/SVGDecorator/DiagramDesigner/SVGDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/SVGDecorator/DiagramDesigner/SVGDecorator.DiagramDesignerWidget",["js/Constants","js/NodePropertyNames","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBaseWithDragPointerHelpers","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/SVGDecorator.html","./SVGDecorator.Core","css!./SVGDecorator.DiagramDesignerWidget"],function(t,e,n,i,o,r){"use strict";var s,a="SVGDecoratorDiagramDesignerWidget";return s=function(t){var e=_.extend({},t);n.apply(this,[e]),r.apply(this,[e]),this._initializeVariables({connectors:!0}),this._selfPatterns={},this.logger.debug("SVGDecoratorDiagramDesignerWidget ctor")},_.extend(s.prototype,n.prototype),_.extend(s.prototype,r.prototype),s.prototype.DECORATORID=a,s.prototype.$DOMBase=$(o),s.prototype.on_addTo=function(){var t=this;this._renderContent(),this.$name.on("dblclick.editOnDblClick",null,function(e){t.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",value:t.name,onChange:function(e,n){t.__onNodeTitleChanged(e,n)},onFinish:function(){t.$name.text(t.formattedName),t.$name.attr("title",t.formattedName)}}),e.stopPropagation(),e.preventDefault()}),this._updateDropArea()},s.prototype.update=function(){this._update(),this._updateDropArea()},s.prototype.onRenderGetLayoutInfo=function(){this.svgContainerWidth=this.$svgContent.outerWidth(!0),this.svgWidth=this.$svgContent.find("svg").outerWidth(!0),this.svgHeight=this.$svgContent.find("svg").outerHeight(!0),this.svgBorderWidth=parseInt(this.$svgContent.find("svg").css("border-width"),10),n.prototype.onRenderGetLayoutInfo.call(this)},s.prototype.onRenderSetLayoutInfo=function(){var t=Math.ceil((this.svgContainerWidth-this.svgWidth)/2+this.svgBorderWidth),e=this.$el.find("> ."+i.CONNECTOR_CLASS);e.css("transform","translateX("+t+"px)"),this._fixPortContainerPosition(t),n.prototype.onRenderSetLayoutInfo.call(this)},s.prototype.getConnectionAreas=function(t){var e=[],n=10,i=20,o=(this.svgContainerWidth-this.svgWidth)/2;if(void 0===t||t===this.hostDesignerItem.id)if(this._customConnectionAreas&&this._customConnectionAreas.length>0){e=$.extend(!0,[],this._customConnectionAreas);for(var r=e.length;r--;)e[r].x1+=o,e[r].x2+=o}else e.push({id:"N",x1:n+o,y1:0,x2:this.svgWidth-n+o,y2:0,angle1:270,angle2:270,len:i}),e.push({id:"S",x1:n+o,y1:this.svgHeight,x2:this.svgWidth-n+o,y2:this.svgHeight,angle1:90,angle2:90,len:i}),this._rightPorts!==!0&&e.push({id:"E",x1:this.svgWidth+o,y1:n,x2:this.svgWidth+o,y2:this.svgHeight-n,angle1:0,angle2:0,len:i}),this._leftPorts!==!0&&e.push({id:"W",x1:0+o,y1:n,x2:0+o,y2:this.svgHeight-n,angle1:180,angle2:180,len:i});else if(this.ports[t]){var s=this.ports[t].top,a=this.ports[t].isLeft,l=this._portContainerXShift+(a?1:this.svgWidth-1),c=a?180:0;e.push({id:t,x1:l,y1:s+this._PORT_HEIGHT/2,x2:l,y2:s+this._PORT_HEIGHT/2,angle1:c,angle2:c,len:i})}return e},s.prototype.showSourceConnectors=function(t){var e,n;if(t)for(e=t.connectors,n=e.length;n--;)void 0===e[n]?this.$sourceConnectors.show():this.ports[e[n]]&&this.ports[e[n]].showConnectors();else if(this.$sourceConnectors.show(),this.portIDs)for(n=this.portIDs.length;n--;)this.ports[this.portIDs[n]].showConnectors()},s.prototype.hideSourceConnectors=function(){var t;if(this.$sourceConnectors.hide(),this.portIDs)for(t=this.portIDs.length;t--;)this.ports[this.portIDs[t]].hideConnectors()},s.prototype.showEndConnectors=function(t){this.showSourceConnectors(t)},s.prototype.hideEndConnectors=function(){this.hideSourceConnectors()},s.prototype.__onNodeTitleChanged=function(n,i){var o=this._control._client;o.setAttribute(this._metaInfo[t.GME_ID],e.Attributes.name,i)},s.prototype.updateSubcomponent=function(t){this._updatePort(t)},s.prototype.renderPort=function(t){return this.__registerAsSubcomponent(t),r.prototype.renderPort.call(this,t)},s.prototype.removePort=function(t){var e=this.portIDs.indexOf(t);-1!==e&&this.__unregisterAsSubcomponent(t),r.prototype.removePort.call(this,t)},s.prototype.__registerAsSubcomponent=function(t){this.hostDesignerItem&&this.hostDesignerItem.registerSubcomponent(t,{GME_ID:t})},s.prototype.__unregisterAsSubcomponent=function(t){this.hostDesignerItem&&this.hostDesignerItem.unregisterSubcomponent(t)},s.prototype.notifyComponentEvent=function(t){for(var e=t.length;e--;)this._updatePort(t[e].id)},s.prototype._updateDropArea=function(){var e=this._control._client,n=e.getNode(this._metaInfo[t.GME_ID]),i=n.getValidSetNames();this._getPointerNames().length>0||this._isReplaceable()||i.length>0?this._enableDragEvents():this._disableDragEvents()},s}),define("decorators/SVGDecorator/PartBrowser/SVGDecorator.Core",["../Core/SVGDecorator.Core","../Core/SVGDecorator.Connections","../Core/SVGDecorator.Connectors","../Core/SVGDecorator.Ports"],function(t,e,n,i){"use strict";var o=function(e){var n=_.extend({},e);t.apply(this,[n]),this.setConnectionAreaDefaults({angle1:0,angle2:0,len:20})};return _.extend(o.prototype,t.prototype),_.extend(o.prototype,i.prototype),_.extend(o.prototype,e.prototype),o}),define("css!decorators/SVGDecorator/PartBrowser/SVGDecorator.PartBrowserWidget",[],function(){}),define("decorators/SVGDecorator/PartBrowser/SVGDecorator.PartBrowserWidget",["js/Constants","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/SVGDecorator.html","./SVGDecorator.Core","css!./SVGDecorator.PartBrowserWidget"],function(t,e,n,i,o,r){"use strict";var s,a="SVGDecoratorPartBrowserWidget";return s=function(t){var e=_.extend({},t);n.apply(this,[e]),r.apply(this,[e]),this._initializeVariables({connectors:!1}),this.logger.debug("SVGDecoratorPartBrowserWidget ctor")},_.extend(s.prototype,n.prototype),_.extend(s.prototype,r.prototype),s.prototype.DECORATORID=a,s.prototype.$DOMBase=function(){var t=$(o);return t.find("."+i.CONNECTOR_CLASS).remove(),t}(),s.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this._renderContent()},s.prototype.afterAppend=function(){},s.prototype.update=function(){this._update()},s.prototype.afterAppend=function(){this.svgContainerWidth=this.$svgContent.outerWidth(!0),this.svgWidth=this.$svgContent.find("svg").outerWidth(!0),this.svgHeight=this.$svgContent.find("svg").outerHeight(!0);var t=(this.svgContainerWidth-this.svgWidth)/2;this._fixPortContainerPosition(t)},s.prototype.notifyComponentEvent=function(t){for(var e=t.length;e--;)this._updatePort(t[e])},s}),define("decorators/SVGDecorator/SVGDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/SVGDecorator.DiagramDesignerWidget","./PartBrowser/SVGDecorator.PartBrowserWidget"],function(t,e,n){"use strict";var i,o="SVGDecorator";return i=function(e){var n=_.extend({loggerName:this.DECORATORID},e);t.apply(this,[n]),this.logger.debug("SVGDecorator ctor")},_.extend(i.prototype,t.prototype),i.prototype.DECORATORID=o,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:e,PartBrowser:n}},i}),define("../utils/build/dist/includes",["js/jquery.WebGME","js/WebGME","js/util","js/logger","js/Layouts/DefaultLayout/DefaultLayout","js/Panels/Header/HeaderPanel","js/Panels/FooterControls/FooterControlsPanel","js/Panels/ObjectBrowser/ObjectBrowserPanel","js/Panels/Visualizer/VisualizerPanel","js/Panels/PartBrowser/PartBrowserPanel","js/Panels/PropertyEditor/PropertyEditorPanel","js/Panels/MetaEditor/MetaEditorPanel","js/Panels/ModelEditor/ModelEditorPanel","js/Panels/SetEditor/SetEditorPanel","js/Panels/Crosscut/CrosscutPanel","js/Panels/GraphViz/GraphVizPanel","decorators/CircleDecorator/CircleDecorator","decorators/DefaultDecorator/DefaultDecorator","decorators/DocumentDecorator/DocumentDecorator","decorators/MetaDecorator/MetaDecorator","decorators/ModelDecorator/ModelDecorator","decorators/SVGDecorator/SVGDecorator"],function(){}),function(t){var e=document,n="appendChild",i="styleSheet",o=e.createElement("style");o.type="text/css",e.getElementsByTagName("head")[0][n](o),o[i]?o[i].cssText=t:o[n](e.createTextNode(t))}('.loader-bg {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  margin: 0;\n  /*background-color: $loader-bg-background-color;\n  opacity: $loader-bg-opacity;*/\n  z-index: 12000; }\n\n.loader-container {\n  position: absolute;\n  width: 86px;\n  height: 86px;\n  line-height: 86px;\n  text-align: center;\n  border-radius: 10px;\n  top: 50%;\n  left: 50%;\n  margin: -43px 0 0 -43px;\n  background-color: transparent;\n  opacity: 1; }\n  .loader-container .circle-o {\n    background-color: transparent;\n    border: 5px solid rgba(82, 168, 236, 0.9);\n    opacity: 0.9;\n    border-right: 5px solid transparent;\n    border-left: 5px solid transparent;\n    border-radius: 50px;\n    box-shadow: 0 0 36px #52a8ec;\n    width: 50px;\n    height: 50px;\n    margin: 12px auto;\n    -moz-animation: spinPulse 1s infinite linear;\n    -webkit-animation: spinPulse 1s infinite linear;\n    -o-animation: spinPulse 1s infinite linear;\n    animation: spinPulse 1s infinite linear; }\n  .loader-container .circle-i {\n    background-color: transparent;\n    border: 5px solid rgba(82, 168, 236, 0.9);\n    opacity: 0.9;\n    border-left: 5px solid transparent;\n    border-right: 5px solid transparent;\n    border-radius: 30px;\n    box-shadow: 0 0 15px #52a8ec;\n    width: 30px;\n    height: 30px;\n    margin: 0 auto;\n    position: relative;\n    top: -52px;\n    -moz-animation: spinoffPulse 1s infinite linear;\n    -webkit-animation: spinoffPulse 1s infinite linear;\n    -o-animation: spinoffPulse 1s infinite linear;\n    animation: spinoffPulse 1s infinite linear; }\n  .loader-container.stop .circle-o,\n  .loader-container.stop .circle-i {\n    -webkit-animation-play-state: paused;\n    -moz-animation-play-state: paused;\n    -o-animation-play-state: paused;\n    animation-play-state: paused; }\n\n@keyframes spinPulse {\n  0% {\n    transform: rotate(160deg);\n    opacity: 0;\n    box-shadow: 0 0 1px #52a8ec; }\n\n  50% {\n    transform: rotate(145deg);\n    opacity: 1; }\n\n  100% {\n    transform: rotate(-320deg);\n    opacity: 0; } }\n@keyframes spinoffPulse {\n  0% {\n    transform: rotate(0deg); }\n\n  100% {\n    transform: rotate(360deg); } }\n@-moz-keyframes spinPulse {\n  0% {\n    -moz-transform: rotate(160deg);\n    opacity: 0;\n    box-shadow: 0 0 1px #52a8ec; }\n\n  50% {\n    -moz-transform: rotate(145deg);\n    opacity: 1; }\n\n  100% {\n    -moz-transform: rotate(-320deg);\n    opacity: 0; } }\n@-moz-keyframes spinoffPulse {\n  0% {\n    -moz-transform: rotate(0deg); }\n\n  100% {\n    -moz-transform: rotate(360deg); } }\n@-webkit-keyframes spinPulse {\n  0% {\n    -webkit-transform: rotate(160deg);\n    opacity: 0;\n    box-shadow: 0 0 1px #52a8ec; }\n\n  50% {\n    -webkit-transform: rotate(145deg);\n    opacity: 1; }\n\n  100% {\n    -webkit-transform: rotate(-320deg);\n    opacity: 0; } }\n@-webkit-keyframes spinoffPulse {\n  0% {\n    -webkit-transform: rotate(0deg); }\n\n  100% {\n    -webkit-transform: rotate(360deg); } }\n@-o-keyframes spinPulse {\n  0% {\n    -o-transform: rotate(160deg);\n    opacity: 0;\n    box-shadow: 0 0 1px #52a8ec; }\n\n  50% {\n    -o-transform: rotate(145deg);\n    opacity: 1; }\n\n  100% {\n    -o-transform: rotate(-320deg);\n    opacity: 0; } }\n@-o-keyframes spinoffPulse {\n  0% {\n    -o-transform: rotate(0deg); }\n\n  100% {\n    -o-transform: rotate(360deg); } }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\ndiv.asset-widget {\n  height: 25px;\n  line-height: 25px;\n  vertical-align: middle;\n  width: 50%;\n  border-radius: 4px;\n  position: relative;\n  background-color: rgba(0, 0, 0, 0.025);\n  border: 1px dashed #aaaaaa; }\n  div.asset-widget .btn-dialog-open {\n    position: absolute;\n    right: 0;\n    top: 0;\n    padding: 0 3px; }\n  div.asset-widget .upload-progress-bar {\n    width: 0;\n    display: inline-block;\n    height: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    color: #3160ab;\n    background-color: #96e096;\n    font-size: 10px;\n    border-radius: 4px;\n    padding-left: 4px; }\n  div.asset-widget a {\n    white-space: nowrap;\n    display: inline-block;\n    max-width: 100%;\n    padding-right: 20px;\n    padding-left: 1ex;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  div.asset-widget.hover {\n    /*background-color: yellow;*/\n    border-color: rgba(82, 168, 236, 0.8);\n    background-color: rgba(82, 168, 236, 0.1);\n    outline: 0;\n    outline: thin dotted \\9;\n    /* IE6-9 */\n    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n/*\n * @author pmeijer / https://github.com/pmeijer\n */\ndiv.create-new-project-dialog div.modal-content div.modal-header .header-icon {\n  height: 24px;\n  width: 24px;\n  margin-right: 1ex;\n  display: inline-block;\n  vertical-align: middle;\n  background-size: 24px 24px; }\ndiv.create-new-project-dialog div.modal-content div.modal-header span {\n  font-size: 24px;\n  vertical-align: middle; }\ndiv.create-new-project-dialog div.modal-content div.pre-body {\n  padding: 15px 15px 0 15px; }\n  div.create-new-project-dialog div.modal-content div.pre-body .tabContainer ul.nav.nav-tabs {\n    margin-bottom: 0; }\n    div.create-new-project-dialog div.modal-content div.pre-body .tabContainer ul.nav.nav-tabs li {\n      width: 86px;\n      text-align: center; }\n      div.create-new-project-dialog div.modal-content div.pre-body .tabContainer ul.nav.nav-tabs li.disabled-from-config {\n        display: none; }\ndiv.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal {\n  display: none; }\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal.activated {\n    display: inherit; }\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection .selector {\n    display: inline-block;\n    width: 100%;\n    padding: 0; }\n    div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection .selector.widget {\n      border: none; }\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection .asset-widget {\n    width: 100%;\n    height: 100%;\n    padding-top: 0.3ex; }\n    div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection .asset-widget a.btn-dialog-open {\n      font-size: 120%;\n      padding-top: 0.6ex; }\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection.selection-blob {\n    padding: 0; }\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal i.toggle-info-btn {\n    font-size: 65%;\n    vertical-align: top;\n    cursor: pointer;\n    color: #333; }\n    div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal i.toggle-info-btn:hover {\n      color: #2a6496; }\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.type-description {\n    display: inline-block;\n    width: 95%;\n    margin-bottom: 2ex;\n    margin-left: 0.5ex;\n    opacity: 0.90; }\n    div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.type-description.hidden {\n      display: none; }\ndiv.create-new-project-dialog div.modal-content div.modal-footer button.btn-create {\n  display: none; }\n  div.create-new-project-dialog div.modal-content div.modal-footer button.btn-create.activated {\n    display: inline-block; }/*\n * @author pmeijer / https://github.com/pmeijer\n */\ndiv.confirm-dialog .modal-content.info .modal-header .header-icon {\n  color: #2e6da4; }\ndiv.confirm-dialog .modal-content.warning .modal-header .header-icon {\n  color: #f0ad4e; }\ndiv.confirm-dialog .modal-content .question-text {\n  font-size: 14px; }\ndiv.confirm-dialog .modal-content .delete-item {\n  text-align: center;\n  font-size: 20px;\n  margin-top: 14px;\n  font-weight: bold; }\ndiv.confirm-dialog .modal-content .modal-header .header-icon {\n  font-size: 20px;\n  margin-right: 1ex;\n  display: inline-block;\n  color: #d9534f; }\ndiv.confirm-dialog .modal-content .modal-header span {\n  font-size: 24px; }\ndiv.confirm-dialog .modal-footer form .do-not-show {\n  display: none; }\ndiv.confirm-dialog .modal-footer form label {\n  font-weight: lighter; }\n.projects-dialog .modal-content.in-background {\n  opacity: 0; }\n  .projects-dialog .modal-content.in-background * {\n    opacity: 0.4; }\n.projects-dialog .modal-content .modal-header .header-icon {\n  height: 28px;\n  width: 28px;\n  margin-right: 1ex;\n  display: inline-block;\n  vertical-align: middle;\n  background-size: 28px 28px; }\n.projects-dialog .modal-content .modal-header span {\n  font-size: 28px;\n  vertical-align: middle; }\n.projects-dialog .modal-content .pre-body {\n  padding: 15px 15px 0 15px; }\n  .projects-dialog .modal-content .pre-body .tabContainer ul.nav.nav-tabs {\n    margin-bottom: 0; }\n    .projects-dialog .modal-content .pre-body .tabContainer ul.nav.nav-tabs li {\n      width: 86px;\n      text-align: center; }\n.projects-dialog .modal-content .modal-body {\n  min-height: 300px; }\n  .projects-dialog .modal-content .modal-body ul.nav-pills li a span.ro {\n    margin-left: 5px;\n    color: #999999;\n    font-size: 9px; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects .info-hidden {\n    display: none; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects.no-children tr.with-children {\n    display: none; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects.no-children tr.with-no-children {\n    display: inherit; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects.no-children tr.with-no-children th {\n      border-bottom: white;\n      border-top: white;\n      font-style: italic;\n      padding-left: 20px;\n      cursor: default; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects thead th {\n    text-align: left;\n    cursor: pointer;\n    border-bottom-width: 1px; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.reverse-order i.sorted.rev-order {\n      display: inline-block;\n      visibility: visible;\n      font-size: 90%;\n      padding-left: 1px; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.reverse-order i.sorted.in-order {\n      display: none; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.in-order i.sorted.in-order {\n      display: inline-block;\n      visibility: visible;\n      font-size: 90%;\n      padding-left: 1px; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.in-order i.sorted.rev-order {\n      display: none; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th i.sorted {\n      visibility: hidden;\n      display: inline-block; }\n      .projects-dialog .modal-content .modal-body table.table.table-projects thead th i.sorted.rev-order {\n        display: none; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.title-icons {\n      text-align: right;\n      padding: 0; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects thead tr.with-no-children {\n    display: none; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row:hover td {\n    background-color: #f5f5f5; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.active td {\n    background-color: #a5afbe; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.active:hover td {\n    background-color: #a5afbe !important; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.read-only td {\n    opacity: 1; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.read-only td.name span.name-read-only {\n      display: inline-block;\n      color: grey;\n      padding-left: 0.5ex; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.filtered-out {\n    display: none; }\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td {\n    text-align: left;\n    border-top: none; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.name {\n      color: #3160ab; }\n      .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.name span.open-link {\n        cursor: pointer; }\n        .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.name span.open-link:hover {\n          text-decoration: underline;\n          color: #ff7700; }\n      .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.name span.name-read-only {\n        display: none; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.icons {\n      text-align: right; }\n      .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.icons i.delete-project {\n        cursor: pointer;\n        color: darkred; }\n        .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.icons i.delete-project:hover {\n          color: #b30404; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.modified {\n      font-style: italic;\n      color: grey; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.viewed {\n      font-style: italic;\n      color: grey; }\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.created {\n      font-style: italic;\n      color: grey; }\n.projects-dialog .modal-content .modal-footer button.corner-button {\n  margin-top: 0.5ex; }\n.projects-dialog .modal-content .modal-footer ul.dropdown-menu {\n  min-width: 0;\n  text-align: left; }\n  .projects-dialog .modal-content .modal-footer ul.dropdown-menu a {\n    cursor: pointer; }\n\n.txt-project-name {\n  width: 50%; }\ndiv.iCheckBox {\n  width: 70px;\n  height: 18.2px;\n  display: inline-block;\n  border-radius: 3px;\n  position: relative;\n  cursor: pointer;\n  background: -moz-linear-gradient(top, #cbcbcb, white);\n  background: -webkit-linear-gradient(top, #cbcbcb, white);\n  background: -o-linear-gradient(top, #cbcbcb, white);\n  background: linear-gradient(to bottom, #cbcbcb, white);\n  box-shadow: 0 0 2px rgba(0, 0, 0, 0.4), inset 0 0 2px rgba(0, 0, 0, 0.8);\n  transition: opacity .3s; }\n  div.iCheckBox .sw {\n    width: 50%;\n    height: 100%;\n    background: -moz-linear-gradient(top, #d4d4d4, white);\n    background: -webkit-linear-gradient(top, #d4d4d4, white);\n    background: -o-linear-gradient(top, #d4d4d4, white);\n    background: linear-gradient(to bottom, #d4d4d4, white);\n    border-radius: 3px;\n    display: inline-block;\n    position: absolute;\n    border: 1px solid #c4c4c4;\n    text-align: center; }\n    div.iCheckBox .sw [class^="icon-"],\n    div.iCheckBox .sw [class*=" icon-"] {\n      font-size: 130%;\n      position: relative;\n      top: -6%; }\n  div.iCheckBox .txt {\n    width: 36.8px;\n    height: 18.2px;\n    line-height: 18.2px;\n    display: inline-block;\n    position: absolute;\n    left: 33.2px;\n    font-size: 9.1px;\n    font-weight: bold;\n    text-align: center;\n    color: #666666;\n    overflow: hidden; }\n  div.iCheckBox.checked {\n    background: -moz-linear-gradient(top, #3160ab, #082c67);\n    background: -webkit-linear-gradient(top, #3160ab, #082c67);\n    background: -o-linear-gradient(top, #3160ab, #082c67);\n    background: linear-gradient(to bottom, #3160ab, #082c67); }\n    div.iCheckBox.checked .sw {\n      left: 36.8px; }\n    div.iCheckBox.checked .txt {\n      left: 0;\n      color: white; }\n  div.iCheckBox.disabled {\n    opacity: 0.5; }\n\ndiv.iCheckBox:hover {\n  opacity: .8; }\n  div.iCheckBox:hover.disabled {\n    opacity: 0.5; }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.sp-container .sp-palette .sp-thumb-el {\n  width: 13px;\n  height: 13px; }\n.sp-container .sp-thumb-active .sp-thumb-inner {\n  background-size: 15px 15px; }\n.sp-container .sp-clear {\n  cursor: pointer; }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.ptr-widget {\n  height: 25px;\n  line-height: 25px;\n  vertical-align: middle;\n  border-radius: 4px;\n  position: relative;\n  background-color: rgba(0, 0, 0, 0.025);\n  padding-left: 3px; }\n  .ptr-widget.drop-area {\n    border: 1px dashed #aaaaaa; }\n    .ptr-widget.drop-area.accept-drop {\n      background-color: rgba(0, 255, 0, 0.1); }\n    .ptr-widget.drop-area.reject-drop {\n      background-color: rgba(255, 0, 0, 0.1); }\n  .ptr-widget i {\n    margin-top: 6px;\n    position: absolute;\n    right: 2px;\n    cursor: pointer; }\n\nspan.user-select-on.btn-follow-pointer {\n  font-size: 11px;\n  color: #3160ab;\n  padding-left: 0px;\n  padding-right: 0px; }\n  span.user-select-on.btn-follow-pointer:hover {\n    text-decoration: underline;\n    color: #ff7700; }\n\n.property-editor ul.nav {\n  position: relative;\n  margin-bottom: 0;\n  height: 24px;\n  white-space: nowrap; }\n  .property-editor ul.nav.nav-tabs > li {\n    display: inline-block;\n    float: none; }\n    .property-editor ul.nav.nav-tabs > li > a {\n      padding: 5px 3px 5px 3px;\n      line-height: 13px;\n      font-size: 11px; }\n      .property-editor ul.nav.nav-tabs > li > a .tab-title {\n        white-space: nowrap;\n        display: inline-block;\n        max-width: 120px;\n        overflow: hidden;\n        text-overflow: ellipsis; }\n.property-editor .tab-content {\n  overflow: visible; }\n/**\n * @author pmeijer / https://github.com/pmeijer\n */\n.multiselect-widget div.btn-group {\n  width: 100%; }\n  .multiselect-widget div.btn-group button.multiselect {\n    font-size: 11px;\n    padding: 6px 0;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    text-align: left; }\n  .multiselect-widget div.btn-group.open {\n    position: absolute;\n    width: inherit; }\n  .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu {\n    max-height: 200px;\n    min-width: 0;\n    padding: 0;\n    width: calc(100% - 6px); }\n    .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li {\n      font-size: 11px;\n      padding: 0;\n      height: 17px;\n      border-bottom: none; }\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li .checkbox {\n        padding: 0 0 0 17px;\n        height: 17px; }\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li input[type=checkbox] {\n        height: 11px;\n        margin-top: 3px;\n        margin-left: -14px; }\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li label {\n        padding: 0 0 0 0;\n        overflow: hidden;\n        text-overflow: ellipsis; }\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li.multiselect-group {\n        margin-left: 4px;\n        margin-bottom: 8px; }\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li a {\n        background-image: none; }\n/**\n * @author kecso / https://github.com/kecso\n */\n.svgselect-widget {\n  width: 50px; }\n  .svgselect-widget div.btn-group {\n    width: 100%; }\n    .svgselect-widget div.btn-group button.multiselect {\n      font-size: 11px;\n      padding: 6px 0;\n      width: 100%;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      text-align: center; }\n    .svgselect-widget div.btn-group.open {\n      position: absolute;\n      width: inherit; }\n    .svgselect-widget div.btn-group ul.svgselect-container.dropdown-menu {\n      max-height: 200px;\n      min-width: 0;\n      padding: 0;\n      width: calc(100% - 6px); }\n      .svgselect-widget div.btn-group ul.svgselect-container.dropdown-menu li {\n        font-size: 11px;\n        padding: 0;\n        height: 30px;\n        border-bottom: none; }\n        .svgselect-widget div.btn-group ul.svgselect-container.dropdown-menu li a {\n          background-image: none; }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.plugin-config-dialog .modal-header img.plugin-icon {\n  width: 28px;\n  display: inline-block;\n  margin-right: 10px; }\n.plugin-config-dialog .modal-header i.plugin-icon {\n  font-size: 28px;\n  display: inline-block;\n  margin-right: 10px; }\n.plugin-config-dialog .modal-body {\n  padding: 15px; }\n  .plugin-config-dialog .modal-body .global-and-plugin-divider {\n    margin-top: 0;\n    margin-bottom: 10px; }\n.plugin-config-dialog .modal-footer {\n  padding: 10px;\n  margin-top: 5px; }\n.plugin-config-dialog .form-group {\n  margin-bottom: 10px; }\n  .plugin-config-dialog .form-group .row {\n    margin: 0 0; }\n  .plugin-config-dialog .form-group .controls .widget span {\n    margin-top: 5px;\n    font-size: 14px;\n    line-height: 20px;\n    display: block; }\n  .plugin-config-dialog .form-group .controls .widget .iCheckBox {\n    margin-top: 6px; }\n  .plugin-config-dialog .form-group .controls .widget div.color-picker {\n    height: 30px;\n    width: 100%;\n    margin-top: 0;\n    cursor: pointer;\n    border-radius: 4px; }\n  .plugin-config-dialog .form-group .controls .widget div.asset-widget {\n    height: 30px;\n    line-height: 30px;\n    width: 100%;\n    margin-top: 0; }\n    .plugin-config-dialog .form-group .controls .widget div.asset-widget .btn-dialog-open {\n      padding: 3px; }\n  .plugin-config-dialog .form-group .controls .widget input[type="text"] {\n    width: 100%;\n    padding: 0.5ex; }\n  .plugin-config-dialog .form-group div.desc {\n    font-size: 0.9em;\n    color: #444; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.project-title {\n  margin-left: 10px;\n  margin-right: 10px; }\n  .project-title .title {\n    font-size: 20px;\n    font-weight: 200;\n    color: white; }\n  .project-title .readOnlyInfo {\n    display: none;\n    margin-left: 5px;\n    padding-right: 5px;\n    font-size: 12px;\n    font-weight: bold; }\n\n.read-only .project-title {\n  color: #777777; }\n  .read-only .project-title .readOnlyInfo {\n    display: inline-block; }\n/**\n * @author pmeijer / https://github.com/pmeijer\n */\n.connected-users-widget {\n  padding-right: 10px;\n  padding-left: 10px; }\n  .connected-users-widget .user-badge {\n    margin-left: 2px;\n    margin-right: 2px; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n * @author nabana / https://github.com/nabana\n */\n.webgme-toolbar,\n.webgme-toolbar-ext {\n  white-space: nowrap; }\n  .webgme-toolbar .toolbar-button,\n  .webgme-toolbar-ext .toolbar-button {\n    display: inline-block;\n    position: relative; }\n  .webgme-toolbar .toolbar-drag-item,\n  .webgme-toolbar-ext .toolbar-drag-item {\n    display: inline-block;\n    position: relative; }\n  .webgme-toolbar .separator,\n  .webgme-toolbar-ext .separator {\n    margin-left: 0;\n    margin-right: 0;\n    border-right: 1px solid #DADFE7;\n    width: 0;\n    height: 26px;\n    display: inline-block;\n    vertical-align: middle;\n    position: relative; }\n  .webgme-toolbar .btn-group,\n  .webgme-toolbar-ext .btn-group {\n    margin-left: 0;\n    margin-right: 0; }\n  .webgme-toolbar .toolbar-input,\n  .webgme-toolbar-ext .toolbar-input {\n    display: inline-block;\n    margin-left: 2px;\n    position: relative; }\n    .webgme-toolbar .toolbar-input .input-append,\n    .webgme-toolbar .toolbar-input .input-prepend,\n    .webgme-toolbar-ext .toolbar-input .input-append,\n    .webgme-toolbar-ext .toolbar-input .input-prepend {\n      margin-bottom: 0; }\n  .webgme-toolbar .toolbar-label,\n  .webgme-toolbar-ext .toolbar-label {\n    display: inline-block;\n    margin-left: 2px;\n    position: relative;\n    font-size: 12px;\n    line-height: 22px;\n    height: 22px;\n    vertical-align: middle; }\n  .webgme-toolbar .toolbar-checkbox,\n  .webgme-toolbar-ext .toolbar-checkbox {\n    display: inline-block;\n    margin-left: 2px;\n    position: relative;\n    vertical-align: middle; }\n  .webgme-toolbar .dropdown-menu li .iCheckBox,\n  .webgme-toolbar-ext .dropdown-menu li .iCheckBox {\n    top: 1px; }\n  .webgme-toolbar .dropdown-menu li .dropdown-list-button.disabled,\n  .webgme-toolbar-ext .dropdown-menu li .dropdown-list-button.disabled {\n    color: gray;\n    cursor: not-allowed; }\n  .webgme-toolbar .toolbar-colorpicker,\n  .webgme-toolbar-ext .toolbar-colorpicker {\n    display: inline-block; }\n    .webgme-toolbar .toolbar-colorpicker input,\n    .webgme-toolbar-ext .toolbar-colorpicker input {\n      margin: 0;\n      width: 20px;\n      color: transparent !important; }\n    .webgme-toolbar .toolbar-colorpicker.input-append, .webgme-toolbar .toolbar-colorpicker.input-prepend,\n    .webgme-toolbar-ext .toolbar-colorpicker.input-append,\n    .webgme-toolbar-ext .toolbar-colorpicker.input-prepend {\n      margin-bottom: 0 !important; }\n      .webgme-toolbar .toolbar-colorpicker.input-append .add-on i:hover, .webgme-toolbar .toolbar-colorpicker.input-prepend .add-on i:hover,\n      .webgme-toolbar-ext .toolbar-colorpicker.input-append .add-on i:hover,\n      .webgme-toolbar-ext .toolbar-colorpicker.input-prepend .add-on i:hover {\n        cursor: pointer; }\n\n.webgme-toolbar-ext {\n  position: absolute;\n  right: 0;\n  margin-top: 1px;\n  padding: 0 3px 3px 0;\n  background: #F5F5F5;\n  border: 1px solid #bbbbbb;\n  display: none;\n  white-space: normal; }\n  .webgme-toolbar-ext.shown {\n    display: inline-block; }\n  .webgme-toolbar-ext > div {\n    margin-top: 2px; }\n\n.webgme-toolbar-ext-toggle {\n  display: inline-block;\n  position: absolute;\n  right: 2px;\n  top: 2px;\n  background-color: #F5F5F5;\n  height: 22px;\n  width: 7px;\n  cursor: pointer; }\n  .webgme-toolbar-ext-toggle:hover {\n    background-color: #E6E6E6; }\n  .webgme-toolbar-ext-toggle > i {\n    -webkit-transform: scale(0.5, 0.5);\n    -moz-transform: scale(0.5, 0.5);\n    -ms-transform: scale(0.5, 0.5);\n    -o-transform: scale(0.5, 0.5);\n    transform: scale(0.5, 0.5);\n    position: absolute;\n    top: 8px;\n    left: -3px; }\n  .webgme-toolbar-ext-toggle > i:last-child {\n    top: 11px; }\n\ndiv.toolbar-container {\n  position: relative;\n  /*overflow: hidden;*/\n  overflow-x: visible;\n  top: 34px;\n  height: 30px;\n  padding: 0; }\n\ndiv.toolbar-container .btn {\n  border: 1px solid #fff;\n  border-radius: 0;\n  padding: 1px 5px;\n  margin: 3px 5px !important;\n  box-shadow: none; }\n.txt-message {\n  max-width: 100%;\n  max-height: 500px; }\n.selected {\n  font-weight: bold; }\n\n.conflict-item {\n  cursor: pointer; }\n\n.commits {\n  /* Monospace stack */\n  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/* make sure to update commit_WIDTH and commit_HEIGHT in Widgets/ProjectRepository/ProjectRepositoryWidget.js */\n.repository-dialog .modal-header > h3 {\n  margin-top: 0;\n  margin-bottom: 0; }\n\n.project-repository-widget {\n  /********* TABLE LAYOUT STYLES ************/ }\n  .project-repository-widget table.table.commit-list {\n    width: auto; }\n  .project-repository-widget table.no-commits-in-table {\n    display: none; }\n  .project-repository-widget .message-column {\n    width: 100%; }\n  .project-repository-widget .commits {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    top: 53.5px;\n    /*DISABLE OUTER BORDER WHEN FOCUSED*/ }\n    .project-repository-widget .commits:focus {\n      outline: none; }\n    .project-repository-widget .commits .commit {\n      position: absolute;\n      width: 8px;\n      height: 8px;\n      background-color: #000000;\n      border-radius: 5px; }\n      .project-repository-widget .commits .commit.actual {\n        background-color: #FF7800;\n        -moz-box-shadow: 0 0 10px 3px #FF7800;\n        -webkit-box-shadow: 0 0 10px 3px #FF7800;\n        box-shadow: 0 0 10px 3px #FF7800; }\n  .project-repository-widget .show-more {\n    height: 36px;\n    line-height: 36px;\n    background-color: #F7F7F7;\n    border-bottom: 1px solid #3a87ad;\n    border-top: 1px solid #3a87ad;\n    text-align: center;\n    margin-top: 15px;\n    position: relative; }\n    .project-repository-widget .show-more a:hover {\n      text-decoration: none; }\n  .project-repository-widget table tr {\n    height: 25px; }\n    .project-repository-widget table tr.in-selection {\n      background-color: lightskyblue; }\n    .project-repository-widget table tr th,\n    .project-repository-widget table tr td {\n      padding: 0 5px;\n      white-space: nowrap;\n      vertical-align: middle;\n      text-align: center; }\n      .project-repository-widget table tr th.actions,\n      .project-repository-widget table tr td.actions {\n        text-align: left; }\n        .project-repository-widget table tr th.actions button i,\n        .project-repository-widget table tr td.actions button i {\n          color: #404040; }\n        .project-repository-widget table tr th.actions > div.input-group,\n        .project-repository-widget table tr td.actions > div.input-group {\n          margin-bottom: 0;\n          display: inline-flex;\n          display: -webkit-inline-flex; }\n          .project-repository-widget table tr th.actions > div.input-group > input,\n          .project-repository-widget table tr td.actions > div.input-group > input {\n            height: 100%;\n            width: 150px;\n            padding: 3px 5px; }\n      .project-repository-widget table tr th.user-column,\n      .project-repository-widget table tr td.user-column {\n        text-align: right; }\n        .project-repository-widget table tr th.user-column .avatar-container .avatar-image,\n        .project-repository-widget table tr td.user-column .avatar-container .avatar-image {\n          width: 18px;\n          margin-left: 8px; }\n      .project-repository-widget table tr th .commit-badge-container,\n      .project-repository-widget table tr td .commit-badge-container {\n        text-align: center; }\n        .project-repository-widget table tr th .commit-badge-container *:first-child,\n        .project-repository-widget table tr td .commit-badge-container *:first-child {\n          padding-left: 0; }\n        .project-repository-widget table tr th .commit-badge-container *,\n        .project-repository-widget table tr td .commit-badge-container * {\n          padding-left: 5px; }\n      .project-repository-widget table tr th.commit-hash,\n      .project-repository-widget table tr td.commit-hash {\n        font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; }\n        .project-repository-widget table tr th.commit-hash:hover,\n        .project-repository-widget table tr td.commit-hash:hover {\n          cursor: pointer;\n          text-decoration: underline;\n          color: #ff7700; }\n      .project-repository-widget table tr th div.commit-message,\n      .project-repository-widget table tr td div.commit-message {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        text-align: left;\n        min-width: 200px; }\n      .project-repository-widget table tr th .common-label,\n      .project-repository-widget table tr td .common-label {\n        margin-right: 2px; }\n        .project-repository-widget table tr th .common-label i.icon-white,\n        .project-repository-widget table tr td .common-label i.icon-white {\n          margin-left: 2px;\n          font-size: 10px; }\n          .project-repository-widget table tr th .common-label i.icon-white:hover,\n          .project-repository-widget table tr td .common-label i.icon-white:hover {\n            cursor: pointer;\n            color: darkred; }\n        .project-repository-widget table tr th .common-label .select-branch-in-text:hover,\n        .project-repository-widget table tr td .common-label .select-branch-in-text:hover {\n          cursor: pointer;\n          font-weight: bold; }\n        .project-repository-widget table tr th .common-label i.tag-label-icon,\n        .project-repository-widget table tr td .common-label i.tag-label-icon {\n          padding-right: 5px;\n          font-size: 9px; }\n        .project-repository-widget table tr th .common-label.label,\n        .project-repository-widget table tr td .common-label.label {\n          font-size: 11px;\n          font-weight: normal;\n          height: 15px; }\n          .project-repository-widget table tr th .common-label.label.delete-prohibited i.icon-white,\n          .project-repository-widget table tr td .common-label.label.delete-prohibited i.icon-white {\n            display: none; }\n      .project-repository-widget table tr th > .btn,\n      .project-repository-widget table tr td > .btn {\n        margin-left: 2px;\n        margin-right: 2px; }\n      .project-repository-widget table tr th .control-group,\n      .project-repository-widget table tr td .control-group {\n        margin-bottom: 0; }\n  .project-repository-widget table td:first-child {\n    border-top: 1px solid transparent; }\n  .project-repository-widget table.table-hover tbody tr:hover > td, .project-repository-widget table.table-hover tbody tr:hover > th {\n    background-color: rgba(236, 236, 236, 0.5); }\n.repository-dialog .modal-header span.title-container {\n  display: flex; }\n  .repository-dialog .modal-header span.title-container span.project-repository-title {\n    font-size: 24px;\n    white-space: nowrap; }\n  .repository-dialog .modal-header span.title-container select {\n    font-size: 14px;\n    margin-right: 2ex;\n    margin-left: 4ex; }.branches-dialog .pre-body {\n  padding: 15px 15px 0 15px; }\n  .branches-dialog .pre-body .tabContainer ul.nav.nav-tabs {\n    margin-bottom: 0; }\n    .branches-dialog .pre-body .tabContainer ul.nav.nav-tabs li {\n      width: 86px;\n      text-align: center; }\n.branches-dialog .modal-body {\n  min-height: 300px; }\n  .branches-dialog .modal-body ul.nav-pills li a span.ro {\n    margin-left: 5px;\n    color: #999999;\n    font-size: 9px; }\n\n.txt-branch-name {\n  width: 50%; }\n\na.btn-env {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none; }\n/*\n * @author pmeijer / https://github.com/pmeijer\n */\ndiv.multi-tab-dialog .modal-content .modal-header .header-icon {\n  font-size: 20px;\n  margin-right: 1ex;\n  display: inline-block;\n  color: #2e6da4; }\ndiv.multi-tab-dialog .modal-content .modal-header span {\n  font-size: 24px; }\ndiv.multi-tab-dialog .modal-content .pre-body {\n  padding: 15px 15px 0 15px; }\n  div.multi-tab-dialog .modal-content .pre-body .tabContainer ul.nav.nav-tabs {\n    margin-bottom: 0; }\n    div.multi-tab-dialog .modal-content .pre-body .tabContainer ul.nav.nav-tabs li {\n      min-width: 86px;\n      text-align: center; }\ndiv.multi-tab-dialog .modal-content div.modal-body .asset-widget {\n  width: 100%;\n  height: 30px;\n  line-height: 30px; }\n  div.multi-tab-dialog .modal-content div.modal-body .asset-widget a.btn-dialog-open {\n    padding: 3px; }\ndiv.multi-tab-dialog .modal-content div.modal-body .blobhash-widget {\n  width: 100%;\n  height: 30px;\n  line-height: 30px; }\n  div.multi-tab-dialog .modal-content div.modal-body .blobhash-widget input {\n    height: 28px;\n    line-height: 28px;\n    padding: 5px; }\n  div.multi-tab-dialog .modal-content div.modal-body .blobhash-widget a.btn-clear {\n    padding: 3px; }\ndiv.multi-tab-dialog .modal-content div.modal-body form.form-horizontal i.toggle-info-btn {\n  font-size: 65%;\n  vertical-align: top;\n  cursor: pointer;\n  color: #333; }\n  div.multi-tab-dialog .modal-content div.modal-body form.form-horizontal i.toggle-info-btn:hover {\n    color: #2a6496; }\ndiv.multi-tab-dialog .modal-content div.modal-body form.form-horizontal span.info-details {\n  display: inline-block;\n  width: 95%;\n  margin-bottom: 2ex;\n  margin-left: 0.5ex;\n  opacity: 0.90; }\n  div.multi-tab-dialog .modal-content div.modal-body form.form-horizontal span.info-details.hidden {\n    display: none; }\ndiv.multi-tab-dialog .modal-content div.modal-body .error-badge {\n  margin-top: 15px;\n  margin-bottom: 0; }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.plugin-results-dialog .modal-body div.plugin-result {\n  padding: 3px;\n  margin-bottom: 10px;\n  background-color: #f5f5f5;\n  border: 1px solid #ddd; }\n  .plugin-results-dialog .modal-body div.plugin-result.unread {\n    color: #3a87ad;\n    background-color: #d9edf7;\n    border-color: #bce8f1; }\n  .plugin-results-dialog .modal-body div.plugin-result .alert {\n    margin-bottom: 0; }\n  .plugin-results-dialog .modal-body div.plugin-result .title {\n    margin-left: 5px; }\n  .plugin-results-dialog .modal-body div.plugin-result .time {\n    margin-left: 5px;\n    color: #999999;\n    font-size: 9px; }\n  .plugin-results-dialog .modal-body div.plugin-result .messages .msg {\n    margin-bottom: 5px;\n    padding-bottom: 15px; }\n    .plugin-results-dialog .modal-body div.plugin-result .messages .msg .msg-title {\n      margin-top: 5px;\n      font-weight: bold;\n      text-transform: uppercase;\n      color: #999999;\n      border-bottom: 1px solid #999999; }\n    .plugin-results-dialog .modal-body div.plugin-result .messages .msg .btn-node {\n      font-weight: bold;\n      padding-right: 3px;\n      padding-left: 3px;\n      color: #3a87ad; }\n      .plugin-results-dialog .modal-body div.plugin-result .messages .msg .btn-node:hover {\n        text-decoration: underline; }\n  .plugin-results-dialog .modal-body div.plugin-result .artifacts {\n    margin-bottom: 5px; }\n    .plugin-results-dialog .modal-body div.plugin-result .artifacts .artifacts-title {\n      margin-top: 5px;\n      font-weight: bold;\n      text-transform: uppercase;\n      color: #999999;\n      border-bottom: 1px solid #999999; }\n    .plugin-results-dialog .modal-body div.plugin-result .artifacts .artifacts-body a {\n      color: #3a87ad;\n      font-weight: bold;\n      font-size: 10.5px; }\n    .plugin-results-dialog .modal-body div.plugin-result .artifacts.history .btn-commit, .plugin-results-dialog .modal-body div.plugin-result .artifacts.history .btn-branch {\n      font-weight: bold;\n      padding-right: 3px;\n      padding-left: 3px;\n      color: #3a87ad; }\n      .plugin-results-dialog .modal-body div.plugin-result .artifacts.history .btn-commit:hover, .plugin-results-dialog .modal-body div.plugin-result .artifacts.history .btn-branch:hover {\n        text-decoration: underline; }\n\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.constraint-check-results-dialog .modal-body div.constraint-check-result {\n  padding: 3px;\n  margin-bottom: 10px;\n  background-color: #f5f5f5;\n  border: 1px solid #ddd; }\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .result-details.main-details.no-details-available {\n    display: none; }\n  .constraint-check-results-dialog .modal-body div.constraint-check-result.unread {\n    color: #3a87ad;\n    background-color: #d9edf7;\n    border-color: #bce8f1; }\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .alert {\n    margin-bottom: 0; }\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .title {\n    margin-left: 5px; }\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .time {\n    margin-left: 5px;\n    color: #999999;\n    font-size: 9px; }\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .messages .msg {\n    margin-bottom: 5px;\n    padding-bottom: 15px; }\n    .constraint-check-results-dialog .modal-body div.constraint-check-result .messages .msg .msg-title {\n      margin-top: 5px;\n      font-weight: bold;\n      text-transform: uppercase;\n      color: #999999;\n      border-bottom: 1px solid #999999; }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.popover.pobox .popover-content {\n  white-space: nowrap; }\n.popover.pobox.ddwa-warning {\n  background-color: #fcf8e3 !important;\n  color: #c09853 !important; }\n  .popover.pobox.ddwa-warning .arrow:after {\n    border-top-color: #fcf8e3 !important; }\n.popover.pobox.ddwa-success {\n  background-color: #dff0d8 !important;\n  color: #468847 !important; }\n  .popover.pobox.ddwa-success .arrow:after {\n    border-top-color: #dff0d8 !important; }\n.popover.pobox.ddwa-error {\n  background-color: #f2dede !important;\n  color: #b94a48 !important; }\n  .popover.pobox.ddwa-error .arrow:after {\n    border-top-color: #f2dede !important; }\n.popover.pobox.ddwa-info {\n  background-color: #d9edf7 !important;\n  color: #3a87ad !important; }\n  .popover.pobox.ddwa-info .arrow:after {\n    border-top-color: #d9edf7 !important; }\n.notification-widget ul.dropdown-menu {\n  max-height: 60vh;\n  overflow-y: scroll; }\n.notification-widget a.notification-drop-down-menu-item:hover {\n  cursor: default;\n  background-image: none; }\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-success {\n  background-color: #ccffcc; }\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-success:hover {\n    background-color: #99ff99; }\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-info {\n  background-color: #cce5ff; }\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-info:hover {\n    background-color: #99ccff; }\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-warn {\n  background-color: #ffffcc; }\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-warn:hover {\n    background-color: #ffff99; }\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-warning {\n  background-color: #ffffcc; }\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-warning:hover {\n    background-color: #ffff99; }\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-error {\n  background-color: #ffcccc; }\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-error:hover {\n    background-color: #ff9999; }\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-clear {\n  font-weight: bold; }\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-clear:hover {\n    cursor: pointer; }\n    .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-clear:hover i.clear-all-icon {\n      color: #b30404; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.panel-base-wh {\n  box-sizing: border-box; }\n  .panel-base-wh .ro-icon {\n    display: none;\n    margin-right: 2px;\n    position: absolute;\n    top: 2px;\n    left: 2px; }\n  .panel-base-wh .panel-header {\n    background-color: #efefef;\n    border-bottom: 3px solid rgba(0, 0, 0, 0);\n    white-space: nowrap; }\n    .panel-base-wh .panel-header .panel-header-title {\n      font-size: 21px;\n      line-height: 21px;\n      font-weight: 400;\n      display: inline-block;\n      margin-right: 10px;\n      margin-left: 5px;\n      white-space: nowrap;\n      margin-top: 8px; }\n    .panel-base-wh .panel-header .panel-header-toolbar .toolbar-group {\n      margin-left: 10px; }\n      .panel-base-wh .panel-header .panel-header-toolbar .toolbar-group.toolbar-group-small-margin {\n        margin-left: 2px; }\n    .panel-base-wh .panel-header .panel-header-toolbar select,\n    .panel-base-wh .panel-header .panel-header-toolbar textarea,\n    .panel-base-wh .panel-header .panel-header-toolbar input,\n    .panel-base-wh .panel-header .panel-header-toolbar .uneditable-input {\n      margin-bottom: 0; }\n    .panel-base-wh .panel-header .panel-header-toolbar .input-append,\n    .panel-base-wh .panel-header .panel-header-toolbar .input-prepend {\n      margin-bottom: 0; }\n    .panel-base-wh .panel-header .panel-header-toolbar input.no-focus-collapse:not(:focus) {\n      width: 30px; }\n    .panel-base-wh .panel-header .panel-header-toolbar li div.iCheckBox {\n      margin-left: 10px; }\n    .panel-base-wh .panel-header .panel-header-toolbar .iCheckBox {\n      top: 5px;\n      margin-left: 10px; }\n    .panel-base-wh .panel-header .panel-header-toolbar ul.dropdown-menu .iCheckBox {\n      top: 1px; }\n    .panel-base-wh .panel-header.absolute-header {\n      border-bottom-width: 0;\n      position: absolute;\n      top: 0;\n      left: 0; }\n  .panel-base-wh .panel-body {\n    position: relative;\n    background-color: white; }\n  .panel-base-wh .floating-title {\n    position: absolute;\n    top: 0;\n    left: 0;\n    box-shadow: 0;\n    text-shadow: 1.5px 1.5px 0 rgba(0, 0, 0, 0.15);\n    opacity: .65;\n    color: #555555; }\n    .panel-base-wh .floating-title .ro-icon {\n      position: relative;\n      top: -1px;\n      left: 2px;\n      margin-right: 1.2ex; }\n    .panel-base-wh .floating-title .panel-header-title {\n      font-size: 21px;\n      line-height: 21px;\n      font-weight: 400;\n      display: inline-block;\n      margin-right: 10px;\n      margin-left: 5px;\n      white-space: nowrap;\n      margin-top: 8px; }\n      .panel-base-wh .floating-title .panel-header-title:empty {\n        display: none; }\n  .panel-base-wh.read-only .ro-icon {\n    display: inline-block; }\n  .panel-base-wh.read-only .panel-body {\n    background-color: #fbfbfb; }\n  .panel-base-wh .absolute-header {\n    border: 1px solid #d3d8df; }\n  .panel-base-wh.active-panel .panel-header {\n    border-bottom-color: #00235b;\n    background: white; }\n  .panel-base-wh.active-panel .floating-title {\n    opacity: 0.85;\n    color: #00235b; }\n  .panel-base-wh.active-panel .absolute-header {\n    border: 1px solid #00235b; }\n  .panel-base-wh.w-tabs .floating-title {\n    top: 30px; }\n.panel-base-scroll {}\n  .panel-base-scroll .panel-body {\n    overflow: auto;\n  }\n.side-panel .panel-base-wh {\n  position: relative;\n  padding: 0;\n  margin-bottom: 2px;\n  border: 0;\n  -webkit-border-radius: 0;\n  -moz-border-radius: 0;\n  border-radius: 0;\n  background-color: whitesmoke; }\n  .side-panel .panel-base-wh .panel-header {\n    padding: 0 3px;\n    font-size: 0.85em;\n    background-color: whitesmoke;\n    border-bottom: 3px solid rgba(0, 0, 0, 0); }\n    .side-panel .panel-base-wh .panel-header .ro-icon {\n      position: relative;\n      top: 0;\n      left: 0; }\n    .side-panel .panel-base-wh .panel-header .panel-header-title {\n      font-size: 0.85em;\n      line-height: 0.85em;\n      color: #999;\n      text-transform: uppercase;\n      margin-right: 0;\n      margin-left: 0; }\n    .side-panel .panel-base-wh .panel-header .panel-header-toolbar {\n      display: block; }\n  .side-panel .panel-base-wh .panel-body {\n    background-color: whitesmoke;\n    padding: 0; }\n  .side-panel .panel-base-wh.read-only .panel-body {\n    background-color: #fbfbfb; }\n  .side-panel .panel-base-wh.active-panel .panel-header {\n    border-bottom-color: #00235b; }\n.add-or-update-library-dialog .refresh-link {\n  font-size: 18px;\n  cursor: pointer; }\ndiv.blobhash-widget {\n  height: 25px;\n  line-height: 25px;\n  vertical-align: middle;\n  width: 50%;\n  border-radius: 4px;\n  position: relative;\n  background-color: rgba(0, 0, 0, 0.025);\n  border: 1px solid #aaaaaa; }\n  div.blobhash-widget input {\n    position: absolute;\n    left: 0;\n    top: 0;\n    white-space: nowrap;\n    display: inline-block;\n    height: 25px;\n    line-height: 25px;\n    vertical-align: middle;\n    width: 100%;\n    padding-right: 20px;\n    padding-left: 1ex;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    border: none;\n    border-radius: 4px; }\n  div.blobhash-widget .btn-clear {\n    position: absolute;\n    right: 0;\n    top: 0;\n    padding: 0 3px; }\n  div.blobhash-widget a {\n    white-space: nowrap;\n    display: inline-block;\n    max-width: 100%;\n    padding-right: 20px;\n    padding-left: 1ex;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    z-index: 100; }\n/**\n * @author pmeijer / https://github.com/pmeijer\n */\n/*IMPORTS*/\n.tree-browser {\n  /* OWN STYLES */ }\n  .tree-browser .filter-container {\n    margin: 1px;\n    padding-top: 1px; }\n    .tree-browser .filter-container .filter-form .filter-toggle-buttons {\n      margin-right: 3px; }\n      .tree-browser .filter-container .filter-form .filter-toggle-buttons button {\n        line-height: 1; }\n    .tree-browser .filter-container .filter-form .input-filter-type label.btn {\n      font-weight: bold; }\n    .tree-browser .filter-container.collapsed .filter-form {\n      display: none; }\n    .tree-browser .filter-container.collapsed i.collapse-filter {\n      display: none; }\n    .tree-browser .filter-container.collapsed i.expand-filter {\n      display: inline-block; }\n    .tree-browser .filter-container i.collapse-filter {\n      display: inline-block; }\n    .tree-browser .filter-container i.expand-filter {\n      display: none; }\n    .tree-browser .filter-container .btn-hide-show-filters {\n      position: relative;\n      z-index: 1; }\n    .tree-browser .filter-container .btn {\n      margin-bottom: 1px; }\n      .tree-browser .filter-container .btn.btn-hide-show-filters {\n        padding-left: 3px; }\n        .tree-browser .filter-container .btn.btn-hide-show-filters .filter-icon {\n          padding-left: 3px; }\n  .tree-browser span.all-filtered-out {\n    padding: 12px;\n    color: #AAA;\n    font-style: italic; }\n  .tree-browser .fa {\n    line-height: 18px; }/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.object-browser ul.nav {\n  position: relative;\n  margin-bottom: 0;\n  height: 24px;\n  white-space: nowrap; }\n  .object-browser ul.nav.nav-tabs > li {\n    display: inline-block;\n    float: none; }\n    .object-browser ul.nav.nav-tabs > li > a {\n      padding: 5px 3px 5px 3px;\n      line-height: 13px;\n      font-size: 11px; }\n      .object-browser ul.nav.nav-tabs > li > a .tab-title {\n        white-space: nowrap;\n        display: inline-block;\n        max-width: 120px;\n        overflow: hidden;\n        text-overflow: ellipsis; }\n.object-browser .tab-content {\n  overflow: visible; }\ndiv.loader-progressbar {\n  zoom: 1;\n  /* Increase this for a bigger symbol*/\n  width: 16px;\n  height: 16px;\n  background: -webkit-linear-gradient(90deg, #f4f5fa 1px, transparent 0, transparent 8px, #f4f5fa 8px), -webkit-linear-gradient(0deg, #f4f5fa 1px, #f6f9fb 0, #f6f9fb 3px, #f4f5fa 3px), -webkit-linear-gradient(90deg, #ececf5 1px, transparent 0, transparent 8px, #ececf5 8px), -webkit-linear-gradient(0deg, #ececf5 1px, #f2f3f9 0, #f2f3f9 3px, #ececf5 3px), -webkit-linear-gradient(90deg, #e7eaf4 1px, transparent 0, transparent 8px, #e7eaf4 8px), -webkit-linear-gradient(0deg, #e7eaf4 1px, #eef1f8 0, #eef1f8 3px, #e7eaf4 3px), -webkit-linear-gradient(90deg, #b9bedd 1px, transparent 0, transparent 10px, #b9bedd 10px), -webkit-linear-gradient(0deg, #b9bedd 1px, #d0d5e8 0, #d0d5e8 3px, #b9bedd 3px), -webkit-linear-gradient(90deg, #9fa6d2 1px, transparent 0, transparent 15px, #9fa6d2 15px), -webkit-linear-gradient(0deg, #9fa6d2 1px, #c0c5e1 0, #c0c5e1 3px, #9fa6d2 3px), -webkit-linear-gradient(90deg, #8490c6 1px, transparent 0, transparent 15px, #8490c6 15px), -webkit-linear-gradient(0deg, #8490c6 1px, #aeb5da 0, #aeb5da 3px, #8490c6 3px);\n  background: linear-gradient(0deg, #f4f5fa 1px, transparent 0, transparent 8px, #f4f5fa 8px), linear-gradient(90deg, #f4f5fa 1px, #f6f9fb 0, #f6f9fb 3px, #f4f5fa 3px), linear-gradient(0deg, #ececf5 1px, transparent 0, transparent 8px, #ececf5 8px), linear-gradient(90deg, #ececf5 1px, #f2f3f9 0, #f2f3f9 3px, #ececf5 3px), linear-gradient(0deg, #e7eaf4 1px, transparent 0, transparent 8px, #e7eaf4 8px), linear-gradient(90deg, #e7eaf4 1px, #eef1f8 0, #eef1f8 3px, #e7eaf4 3px), linear-gradient(0deg, #b9bedd 1px, transparent 0, transparent 10px, #b9bedd 10px), linear-gradient(90deg, #b9bedd 1px, #d0d5e8 0, #d0d5e8 3px, #b9bedd 3px), linear-gradient(0deg, #9fa6d2 1px, transparent 0, transparent 15px, #9fa6d2 15px), linear-gradient(90deg, #9fa6d2 1px, #c0c5e1 0, #c0c5e1 3px, #9fa6d2 3px), linear-gradient(0deg, #8490c6 1px, transparent 0, transparent 15px, #8490c6 15px), linear-gradient(90deg, #8490c6 1px, #aeb5da 0, #aeb5da 3px, #8490c6 3px);\n  background-repeat: no-repeat;\n  background-size: 4px 9px, 4px 9px, 4px 9px, 4px 9px, 4px 9px, 4px 9px, 4px 11px, 4px 11px, 4px 16px, 4px 16px, 4px 16px, 4px 16px;\n  background-position: -4px 3px, -4px 3px, -4px 3px, -4px 3px, -4px 3px, -4px 3px, -4px 2px, -4px 2px, -4px 0px, -4px 0px, -4px 0px, -4px 0px;\n  -webkit-animation: wait 0.8s steps(1, start) infinite;\n  animation: wait 0.8s steps(1, start) infinite; }\n  div.loader-progressbar.stop {\n    -webkit-animation-play-state: paused;\n    animation-play-state: paused; }\n\n@keyframes wait {\n  12% {\n    background-position: -4px 3px,-4px 3px,   -4px 3px, -4px 3px,  -4px 3px,-4px 3px,  -4px 2px,-4px 2px,  -4px 0px, -4px 0px,  0px 0px, 0px 0px; }\n\n  25% {\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 3px,-4px 3px,  -4px 2px, -4px 2px,   0px 0px,    0px 0px,     6px 0px, 6px 0px; }\n\n  37% {\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  0px 2px,    0px 2px,     6px 0px,  6px 0px,  12px 0px, 12px 0px; }\n\n  50% {\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,   0px 3px,    0px 3px,  6px 2px,  6px 2px,  12px 0px, 12px 0px,  -4px 0px, -4px 0px; }\n\n  62% {\n    background-position: -4px 3px, -4px 3px,   0px 3px,    0px 3px,     6px 3px,  6px 3px,  12px 2px, 12px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\n\n  75% {\n    background-position: 0px 3px,    0px 3px,     6px 3px,  6px 3px,  12px 3px, 12px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\n\n  87% {\n    background-position: 6px 3px,  6px 3px,  12px 3px, 12px 3px,  -4px 3px, -4px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\n\n  100% {\n    background-position: 12px 3px, 12px 3px,  -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; } }\n\n@-webkit-keyframes wait {\n  12% {\n    background-position: -4px 3px,-4px 3px,   -4px 3px, -4px 3px,  -4px 3px,-4px 3px,  -4px 2px,-4px 2px,  -4px 0px, -4px 0px,  0px 0px, 0px 0px; }\n\n  25% {\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 3px,-4px 3px,  -4px 2px, -4px 2px,   0px 0px,    0px 0px,     6px 0px, 6px 0px; }\n\n  37% {\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  0px 2px,    0px 2px,     6px 0px,  6px 0px,  12px 0px, 12px 0px; }\n\n  50% {\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,   0px 3px,    0px 3px,  6px 2px,  6px 2px,  12px 0px, 12px 0px,  -4px 0px, -4px 0px; }\n\n  62% {\n    background-position: -4px 3px, -4px 3px,   0px 3px,    0px 3px,     6px 3px,  6px 3px,  12px 2px, 12px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\n\n  75% {\n    background-position: 0px 3px,    0px 3px,     6px 3px,  6px 3px,  12px 3px, 12px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\n\n  87% {\n    background-position: 6px 3px,  6px 3px,  12px 3px, 12px 3px,  -4px 3px, -4px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\n\n  100% {\n    background-position: 12px 3px, 12px 3px,  -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; } }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.split-panel {\n  position: absolute;\n  top: 0;\n  left: 0;\n  margin: 0; }\n  .split-panel .p1,\n  .split-panel .p2 {\n    position: absolute;\n    overflow: hidden; }\n  .split-panel .splitter {\n    z-index: 1000;\n    background: #DDD;\n    border: 0x solid #BBB;\n    position: absolute;\n    box-sizing: border-box; }\n    .split-panel .splitter.vertical {\n      border-left-width: 1px;\n      border-right-width: 1px;\n      cursor: ew-resize; }\n    .split-panel .splitter.horizontal {\n      border-top-width: 1px;\n      border-bottom-width: 1px;\n      cursor: ns-resize; }\n    .split-panel .splitter.resize {\n      background-color: #C4E1A4; }\n.visualizer-panel .vis-loader {\n  display: inline-block;\n  vertical-align: middle;\n  margin-left: 7px;\n  margin-top: -3px; }\n.visualizer-panel ul.nav {\n  margin-bottom: 0; }\n  .visualizer-panel ul.nav li > a {\n    white-space: nowrap; }\n.visualizer-panel .pp {\n  text-align: left;\n  padding: .5ex 1ex;\n  font-size: 11px;\n  font-weight: bold;\n  line-height: 18px;\n  color: #999;\n  text-transform: uppercase;\n  margin: 0 0 1px 0;\n  background-color: #fff; }\n.part-browser {\n  height: 100%;\n  width: 100%;\n  text-align: center;\n  overflow-x: auto;\n  overflow-y: auto; }\n  .part-browser > ul {\n    list-style-type: none;\n    margin: 0;\n    white-space: nowrap;\n    padding: 0 0 30px 0; }\n    .part-browser > ul > li {\n      list-style-type: none;\n      padding: 0;\n      text-decoration: none;\n      color: black;\n      font-size: 10px; }\n      .part-browser > ul > li.decorated-list-item {\n        margin: 15px 10px 5px 10px; }\n      .part-browser > ul > li.name-list-item {\n        margin: 0 0 0 0; }\n      .part-browser > ul > li div.part {\n        display: inline-block;\n        cursor: pointer; }\n      .part-browser > ul > li div.name-part {\n        display: inline-block;\n        cursor: pointer;\n        font-size: 12px;\n        color: #3160AB;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding: 3px 12px 3px 12px; }\n      .part-browser > ul > li div.name-part:hover {\n        color: #FF7700;\n        background-color: #EEEEEE; }\n  .part-browser > ul.part {\n    text-align: center; }\n  .part-browser > ul.name-part {\n    text-align: left; }.pgp {\n  color: #1a1a1a;\n  font-family: "Helvetica", "Arial", "sans-serif";\n  font-size: 11px;\n  background-color: #e8e8e8; }\n  .pgp ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n    .pgp ul li {\n      -webkit-transition: height 0.1s ease-out;\n      -o-transition: height 0.1s ease-out;\n      -moz-transition: height 0.1s ease-out;\n      transition: height 0.1s ease-out;\n      /* Controller row, <li> */ }\n      .pgp ul li:not(.folder) {\n        border-bottom: 1px solid #fafafa;\n        height: 27px;\n        line-height: 27px;\n        overflow: hidden;\n        padding: 0 3px 0 3px;\n        white-space: nowrap;\n        text-overflow: ellipsis; }\n      .pgp ul li.folder {\n        border-bottom: 0;\n        padding: 0;\n        border-left: 4px solid transparent; }\n      .pgp ul li.title {\n        padding-left: 14px;\n        background: gainsboro url(data:image/gif;base64,R0lGODlhBQAFAPcAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP////X19QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAANgALAAAAAAFAAUAAAgQALEJHEgQgEGD2A4OBCAwIAA7) 4px 10px no-repeat;\n        cursor: pointer;\n        border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n        margin-left: -4px; }\n      .pgp ul li.cr {\n        clear: both;\n        border-left: 3px solid transparent;\n        /** Name-half (left) */\n        /** Controllers */\n        /** Controller-half (right) */ }\n        .pgp ul li.cr.asset {\n          border-left-color: #e8e8e8; }\n        .pgp ul li.cr.boolean {\n          border-left-color: #e8e8e8; }\n        .pgp ul li.cr.integer {\n          border-left-color: #806787; }\n          .pgp ul li.cr.integer input[type=text] {\n            color: #1a1a1a; }\n        .pgp ul li.cr.float {\n          border-left-color: #2FA1D6; }\n          .pgp ul li.cr.float input[type=text] {\n            color: #1a1a1a; }\n        .pgp ul li.cr.number {\n          border-left-color: #2FA1D6; }\n          .pgp ul li.cr.number input[type=text] {\n            color: #2FA1D6; }\n        .pgp ul li.cr.string {\n          border-left-color: #e8e8e8; }\n          .pgp ul li.cr.string input[type=text] {\n            color: #1a1a1a; }\n        .pgp ul li.cr.custom {\n          border-left-color: #FFFF00; }\n        .pgp ul li.cr .property-name {\n          cursor: default;\n          float: left;\n          clear: left;\n          width: 40%;\n          overflow: hidden;\n          text-overflow: ellipsis; }\n          .pgp ul li.cr .property-name.p-reset {\n            width: 30%; }\n        .pgp ul li.cr div.p-reset {\n          width: 10%;\n          text-align: right;\n          float: left; }\n          .pgp ul li.cr div.p-reset i.reset-badge {\n            margin-left: 1px;\n            margin-right: 2px; }\n            .pgp ul li.cr div.p-reset i.reset-badge.btn-reset:hover {\n              cursor: pointer; }\n        .pgp ul li.cr .c {\n          float: left;\n          width: 60%;\n          height: 27px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          /** Controller placement */ }\n          .pgp ul li.cr .c.has-invalid-value {\n            background-color: #f98980; }\n          .pgp ul li.cr .c input {\n            font-size: 12px;\n            height: 19px;\n            line-height: 19px;\n            box-sizing: border-box; }\n          .pgp ul li.cr .c input[type=checkbox] {\n            margin-top: -2px; }\n          .pgp ul li.cr .c input[type=text] {\n            border: 0;\n            margin-top: -2px;\n            margin-bottom: 0;\n            padding: 3px;\n            width: 100%;\n            outline: none; }\n          .pgp ul li.cr .c input[type=number] {\n            border: 0;\n            margin-top: -2px;\n            margin-bottom: 0;\n            padding-left: 2px;\n            padding-bottom: 0;\n            padding-top: 0;\n            width: 100%;\n            outline: none; }\n          .pgp ul li.cr .c input[type=text]:not([disabled]) {\n            background: white; }\n            .pgp ul li.cr .c input[type=text]:not([disabled]):hover {\n              background: white; }\n            .pgp ul li.cr .c input[type=text]:not([disabled]):focus {\n              background: white; }\n          .pgp ul li.cr .c div.iCheckBox {\n            margin-top: 5px; }\n          .pgp ul li.cr .c select {\n            margin-top: 2px;\n            width: 100%;\n            height: 23px;\n            border: 0;\n            padding: 3px;\n            color: #1a1a1a;\n            font-size: 11px; }\n          .pgp ul li.cr .c select:not([disabled]) {\n            background: white; }\n          .pgp ul li.cr .c .btn-dialog-open {\n            margin-top: 2px;\n            position: absolute;\n            right: 2px; }\n          .pgp ul li.cr .c div.color-picker {\n            height: 19px;\n            width: 100%;\n            margin-top: 4px;\n            cursor: pointer;\n            border-radius: 4px;\n            border-style: solid;\n            border-width: 1px;\n            border-color: darkgrey; }\n          .pgp ul li.cr .c div.asset-widget {\n            height: 25px;\n            line-height: 25px;\n            width: 98%; }\n            .pgp ul li.cr .c div.asset-widget .btn-dialog-open {\n              top: -1px;\n              padding: 0 3px; }\n    .pgp ul.closed li:not(.title),\n    .pgp ul.closed ul li,\n    .pgp ul.closed ul li > * {\n      height: 0;\n      overflow: hidden;\n      border: 0; }\n    .pgp ul.closed li.title {\n      background-image: url(data:image/gif;base64,R0lGODlhBQAFAPcAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP////X19QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAANgALAAAAAAFAAUAAAgQALFhAyBQIACCBg8mLIgwIAA7); }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.decorator-svg-dialog .modal-header .header-icon {\n  font-size: 30px;\n  margin-right: 1ex;\n  margin-left: 0.4ex;\n  display: inline-block;\n  color: #2e6da4; }\n.decorator-svg-dialog .modal-header span {\n  font-size: 30px; }\n.decorator-svg-dialog .pre-body {\n  padding: 15px 15px 0 15px; }\n  .decorator-svg-dialog .pre-body .tabContainer ul.nav.nav-tabs {\n    margin-bottom: 0; }\n    .decorator-svg-dialog .pre-body .tabContainer ul.nav.nav-tabs li {\n      text-align: center; }\n.decorator-svg-dialog .image-container {\n  margin: 3px;\n  padding: 5px;\n  border: 1px solid #EFEFEF;\n  height: 100px;\n  width: 112px;\n  float: left;\n  text-align: center;\n  position: relative;\n  cursor: pointer; }\n  .decorator-svg-dialog .image-container.not-in-tab-group {\n    display: none; }\n  .decorator-svg-dialog .image-container.not-in-filter {\n    display: none; }\n  .decorator-svg-dialog .image-container img {\n    display: inline;\n    margin: 0;\n    padding: 3px;\n    max-width: 100%;\n    max-height: 48px; }\n  .decorator-svg-dialog .image-container div.desc {\n    text-align: center;\n    font-weight: normal;\n    line-height: 20px;\n    width: 100%;\n    padding: 0 .5ex;\n    margin: 0;\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .decorator-svg-dialog .image-container:hover {\n    border-color: #ababab;\n    background-color: #efefef; }\n  .decorator-svg-dialog .image-container.selected {\n    border-color: #52a8ec;\n    background-color: #dbeafc;\n    -webkit-box-shadow: 0 0 15px 0 #1276d4 !important;\n    -moz-box-shadow: 0 0 15px 0 #1276d4 !important;\n    box-shadow: 0 0 15px 0 #1276d4 !important; }\n\n.selected > div.desc {\n  -webkit-box-shadow: none;\n  -moz-box-shadow: none;\n  box-shadow: none; }\n/*\n * @author pmeijer / https://github.com/pmeijer\n */\ndiv.valid-visualizers-dialog div.modal-header .header-icon {\n  font-size: 24px;\n  margin-right: 1ex;\n  display: inline-block;\n  color: #333; }\ndiv.valid-visualizers-dialog div.modal-header span {\n  font-size: 24px; }\ndiv.valid-visualizers-dialog .modal-content .toggle-info-btn {\n  font-size: 65%;\n  vertical-align: top;\n  cursor: pointer;\n  color: #333; }\n  div.valid-visualizers-dialog .modal-content .toggle-info-btn:hover {\n    color: #2a6496; }\ndiv.valid-visualizers-dialog .modal-content .info-message {\n  display: inline-block;\n  width: 95%;\n  margin-bottom: 2ex;\n  margin-left: 0.5ex;\n  opacity: 0.90; }\n  div.valid-visualizers-dialog .modal-content .info-message.hidden {\n    display: none; }\ndiv.valid-visualizers-dialog .modal-content .visualizers-selection-container {\n  width: 40%;\n  float: left;\n  margin-right: 10px; }\n  div.valid-visualizers-dialog .modal-content .visualizers-selection-container ul {\n    border: 1px solid #eee;\n    min-height: 30px;\n    list-style-type: none;\n    padding: 5px 0 0 0; }\n  div.valid-visualizers-dialog .modal-content .visualizers-selection-container li {\n    margin: 0 5px 5px 5px;\n    padding: 5px;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    cursor: pointer; }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n.designer-item .decorator-edit {\n  opacity: 0.2; }\n.designer-item .conn-area-edit-bg {\n  position: absolute;\n  top: 0;\n  left: 0; }\n.designer-item path.conn-area-edit {\n  position: absolute;\n  top: 0;\n  left: 0;\n  opacity: 0.5;\n  stroke: lime; }\n  .designer-item path.conn-area-edit:hover {\n    stroke: #009900; }\n  .designer-item path.conn-area-edit.disabled {\n    stroke: red; }\n    .designer-item path.conn-area-edit.disabled:hover {\n      stroke: #990000; }\n.zoom-widget-container .btn-zoom {\n  display: block;\n  width: 14px;\n  height: 14px;\n  margin-left: -5px;\n  text-align: center;\n  cursor: pointer;\n  color: #3160ab;\n  text-decoration: none;\n  outline: none; }\n  .zoom-widget-container .btn-zoom.btn-zoom-in {\n    border-bottom-right-radius: 0;\n    border-bottom-left-radius: 0; }\n  .zoom-widget-container .btn-zoom.btn-zoom-out {\n    border-top-right-radius: 0;\n    border-top-left-radius: 0; }\n  .zoom-widget-container .btn-zoom i {\n    font-size: 9px;\n    display: block; }\n.zoom-widget-container .zoom-widget-label {\n  display: block;\n  margin-left: -5px;\n  margin-top: 2px;\n  font-family: Helvetica Neue, Helvetica, Arial, sans-serif;\n  font-size: 10px;\n  color: black;\n  font-weight: normal; }\n.zoom-widget-container .css-zoom {\n  width: 3px;\n  position: relative;\n  display: block;\n  border-radius: 0; }\n  .zoom-widget-container .css-zoom.hidden {\n    display: none; }\n  .zoom-widget-container .css-zoom .ui-slider-handle {\n    display: block;\n    width: 18px;\n    height: 7px;\n    line-height: 7px;\n    left: -8px;\n    outline: none;\n    margin-top: -1px;\n    margin-bottom: -6px;\n    cursor: pointer; }\n  .zoom-widget-container .css-zoom .css-zoom-label {\n    display: none; }\n.zoom-widget-container .popover {\n  min-width: 88px; }\n  .zoom-widget-container .popover .popover-content {\n    font-size: 10px; }\n  .zoom-widget-container .popover .popover-title {\n    font-size: 12px; }\n/*\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\n * \n * Author: Robert Kereskenyi\n */\n#context-menu-layer {\n  position: absolute;\n  z-index: 1000;\n  top: 0;\n  left: 0;\n  opacity: 0;\n  background-color: black;\n  display: block;\n  width: 100%;\n  height: 100%; }\n\n#context-menu {\n  position: absolute;\n  display: none;\n  z-index: 1000; }\n  #context-menu .dropdown-menu {\n    display: block; }\n    #context-menu .dropdown-menu a {\n      font-size: 14px; }\n      #context-menu .dropdown-menu a i.fa.fa-ellipsis-h {\n        padding-left: 1px;\n        padding-right: 3px; }\n      #context-menu .dropdown-menu a i.fa.fa-ellipsis-v {\n        padding-left: 5px;\n        padding-right: 7px; }\n  #context-menu.show {\n    display: block; }/*error decorator properties*/\n.diagram-designer {\n  outline: none; }\n  .diagram-designer .items {\n    position: absolute; }\n    .diagram-designer .items .designer-item,\n    .diagram-designer .items .designer-connection {\n      cursor: pointer; }\n    .diagram-designer .items .rubberband {\n      background: rgba(219, 234, 252, 0.49);\n      border: #52A8EC solid 1px;\n      z-index: 100000; }\n    .diagram-designer .items .selection-outline {\n      background: rgba(255, 255, 0, 0.05);\n      border: rgba(0, 0, 0, 0.5) dashed 1px;\n      position: absolute;\n      pointer-events: none;\n      z-index: 100;\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075) 0 0 4px rgba(0, 0, 0, 0.3);\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 4px rgba(0, 0, 0, 0.3);\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 4px rgba(0, 0, 0, 0.3); }\n      .diagram-designer .items .selection-outline .s-btn {\n        position: absolute;\n        background-color: #FFFFFF;\n        border: none;\n        line-height: 14px;\n        padding: 3px 4px;\n        border-radius: 4px;\n        pointer-events: all;\n        cursor: pointer;\n        -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075) 0 0 4px rgba(0, 0, 0, 0.3);\n        -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 4px rgba(0, 0, 0, 0.3);\n        box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 4px rgba(0, 0, 0, 0.3);\n        background-color: #000;\n        color: #fff; }\n        .diagram-designer .items .selection-outline .s-btn.delete {\n          top: -13px;\n          right: -13px; }\n        .diagram-designer .items .selection-outline .s-btn.rotate.bottom {\n          left: 50%;\n          margin-left: -13px;\n          bottom: -13px; }\n        .diagram-designer .items .selection-outline .s-btn.contextmenu {\n          bottom: -13px;\n          right: -13px; }\n        .diagram-designer .items .selection-outline .s-btn.align {\n          bottom: -13px;\n          left: -13px; }\n        .diagram-designer .items .selection-outline .s-btn.move {\n          top: -13px;\n          left: -13px;\n          margin-left: -13px; }\n        .diagram-designer .items .selection-outline .s-btn.open {\n          top: -13px;\n          left: -13px; }\n        .diagram-designer .items .selection-outline .s-btn:hover {\n          background-color: #428bca; }\n      .diagram-designer .items .selection-outline .rotation-deg {\n        text-align: center;\n        vertical-align: middle;\n        position: absolute;\n        width: 100%;\n        height: 30px;\n        margin-top: -15px;\n        top: 50%;\n        line-height: 30px;\n        font-size: 30px;\n        color: #666666; }\n    .diagram-designer .items .connection-connector.connector {\n      background-color: #FEFEFE;\n      height: 10px;\n      width: 10px;\n      position: absolute;\n      cursor: pointer;\n      border: 1px solid #0000FF;\n      z-index: 10;\n      background-color: #FFFFFF;\n      border-radius: 12px;\n      margin-left: -6px;\n      margin-top: -6px; }\n      .diagram-designer .items .connection-connector.connector:hover {\n        border-color: rgba(82, 168, 236, 0.8);\n        -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n        -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n        box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n    .diagram-designer .items .c-area {\n      position: absolute;\n      width: 8px;\n      height: 8px;\n      background-color: #000000;\n      border-radius: 4px;\n      margin-top: -4px;\n      margin-left: -4px; }\n    .diagram-designer .items .c-d-end {\n      background-color: #FEFEFE;\n      height: 10px;\n      width: 10px;\n      position: absolute;\n      cursor: pointer;\n      border: 1px solid #0000FF;\n      z-index: 10;\n      margin-top: -6px;\n      margin-left: -6px;\n      line-height: 10px;\n      font-size: 8px;\n      text-align: center;\n      font-weight: bold;\n      font-family: Verdana; }\n      .diagram-designer .items .c-d-end:hover {\n        border-color: rgba(82, 168, 236, 0.8);\n        -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n        -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n        box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n      .diagram-designer .items .c-d-end.src {\n        border-color: #FF0000;\n        color: #FF0000; }\n      .diagram-designer .items .c-d-end.dst {\n        border-color: #0000FF;\n        color: #0000FF; }\n    .diagram-designer .items .error-decorator {\n      background-color: #F2DEDE;\n      padding: 3px;\n      text-align: center;\n      border: 2px solid #000000; }\n    .diagram-designer .items svg.connection-container {\n      z-index: -1; }\n      .diagram-designer .items svg.connection-container .new-segment-point-marker {\n        pointer-events: none;\n        fill: #FFFF00;\n        stroke: #FF0000; }\n      .diagram-designer .items svg.connection-container .path-edit-segment {\n        stroke: transparent;\n        opacity: 0; }\n      .diagram-designer .items svg.connection-container .segment-point {\n        fill: #FFFF00;\n        stroke: #000000;\n        cursor: pointer; }\n        .diagram-designer .items svg.connection-container .segment-point:hover {\n          fill: #FF7800; }\n      .diagram-designer .items svg.connection-container .segment-point-move-path {\n        stroke: #FF7800; }\n      .diagram-designer .items svg.connection-container .segment-point-bezier-control {\n        fill: #FFFFFF;\n        stroke: #000000;\n        cursor: pointer; }\n        .diagram-designer .items svg.connection-container .segment-point-bezier-control:hover {\n          fill: #FF7800; }\n    .diagram-designer .items div.c-t {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 0;\n      height: 0; }\n      .diagram-designer .items div.c-t div.c-text {\n        position: absolute;\n        font-size: 10px;\n        white-space: nowrap; }\n        .diagram-designer .items div.c-t div.c-text .c-name {\n          position: relative;\n          left: -50%;\n          cursor: default; }\n          .diagram-designer .items div.c-t div.c-text .c-name.v {\n            left: 1px; }\n        .diagram-designer .items div.c-t div.c-text input {\n          height: 20px !important;\n          min-width: 50px; }\n    .diagram-designer .items.highlight-mode .designer-item,\n    .diagram-designer .items.highlight-mode .designer-connection,\n    .diagram-designer .items.highlight-mode .c-t {\n      opacity: 0.1;\n      cursor: pointer; }\n    .diagram-designer .items.highlight-mode .designer-item.highlighted,\n    .diagram-designer .items.highlight-mode .designer-connection.highlighted,\n    .diagram-designer .items.highlight-mode .c-t.highlighted {\n      opacity: 1.0; }\n    .diagram-designer .items.connection-drawing .connector:hover {\n      background-color: #00FF00; }\n  .diagram-designer .drop-region {\n    width: 0;\n    height: 0;\n    position: absolute;\n    top: 0;\n    left: 0; }\n    .diagram-designer .drop-region.accept-droppable {\n      background-color: rgba(0, 255, 0, 0.1); }\n    .diagram-designer .drop-region.reject-droppable {\n      background-color: rgba(255, 0, 0, 0.1); }\n\n.diagram-designer-zoom-container {\n  position: absolute;\n  top: 30px;\n  left: 10px; }\n\n.w-tabs .diagram-designer-zoom-container {\n  top: 70px; }\n\ndiv.diagram-designer-drag-outline {\n  white-space: nowrap; }\n\n/* TABS CONTAINER */\n.active-panel .diagram-designer-tabs-container {\n  background-color: #F7FAFF; }\n\n.diagram-designer-tabs-container {\n  position: absolute;\n  top: 3px;\n  width: 100%;\n  height: 26px;\n  background-color: #FDFDFD;\n  padding-top: 1px; }\n  .diagram-designer-tabs-container > div {\n    display: table-cell;\n    vertical-align: middle;\n    white-space: nowrap; }\n  .diagram-designer-tabs-container div.add-tab-container {\n    border-bottom: 1px solid #ddd;\n    padding-left: 3px;\n    padding-right: 3px;\n    padding-bottom: 0; }\n  .diagram-designer-tabs-container div.add-tab-container > div {\n    display: inline-block;\n    margin-right: 3px; }\n  .diagram-designer-tabs-container div.add-tab-container ul.dropdown-menu li a [class^="icon-"],\n  .diagram-designer-tabs-container div.add-tab-container ul.dropdown-menu li a [class*=" icon-"] {\n    margin-left: -17px;\n    margin-right: 3px; }\n  .diagram-designer-tabs-container .btn {\n    padding: 0 12px; }\n  .diagram-designer-tabs-container div.tab-list-container {\n    width: 100%;\n    overflow: hidden; }\n    .diagram-designer-tabs-container div.tab-list-container ul.nav {\n      position: relative;\n      margin-bottom: 0px;\n      height: 24px; }\n      .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li {\n        display: inline-block;\n        float: none; }\n        .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a {\n          padding-top: 5px;\n          padding-bottom: 5px;\n          line-height: 13px; }\n          .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a .tab-title {\n            white-space: nowrap;\n            display: inline-block;\n            max-width: 120px;\n            overflow: hidden;\n            text-overflow: ellipsis; }\n            .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a .tab-title input {\n              min-width: 50px !important; }\n          .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a i.delete-tab-btn {\n            cursor: pointer;\n            font-size: 100%;\n            margin-left: 5px; }\n            .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a i.delete-tab-btn:hover {\n              color: #b30404; }\n          .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a [class^="icon-"],\n          .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a [class*=" icon-"] {\n            margin-top: -2px;\n            margin-left: 2px;\n            cursor: pointer;\n            display: none; }\n        .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li.active > a [class^="icon-"],\n        .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li.active > a [class*=" icon-"] {\n          display: inline-block; }\n      .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs.ui-sortable li.ui-sortable-placeholder {\n        height: 0px !important; }\n      .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs.ui-sortable li.ui-sortable-helper {\n        top: 0px !important;\n        pointer-events: none; }\n\n.read-only .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li.active > a [class^="icon-"],\n.read-only .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li.active > a [class*=" icon-"] {\n  display: none; }\n\n.rotate-options {\n  top: -52px;\n  left: 16px;\n  display: none; }\n/**\n * @author pmeijer / https://github.com/pmeijer\n */\n.meta-editor-pointer-names-dialog .modal-footer .message-badge {\n  text-align: left; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.meta-editor-widget.w-tabs .diagram-designer-zoom-container {\n  top: 45px; }\n.meta-editor-widget.show-meta-consistency-results {\n  display: inline-flex; }\n  .meta-editor-widget.show-meta-consistency-results .panel-body {\n    width: 50%; }\n  .meta-editor-widget.show-meta-consistency-results .meta-consistency-results {\n    width: 50%;\n    overflow-y: scroll;\n    margin-top: 30px;\n    border-left: 1px gray solid; }\n    .meta-editor-widget.show-meta-consistency-results .meta-consistency-results .meta-inconsistency-header {\n      margin-left: 8px; }\n      .meta-editor-widget.show-meta-consistency-results .meta-consistency-results .meta-inconsistency-header i {\n        margin-left: 10px;\n        cursor: pointer; }\n    .meta-editor-widget.show-meta-consistency-results .meta-consistency-results .meta-inconsistency-divider {\n      border-top: 3px lightgray solid;\n      margin: 20px 20px 20px 20px; }\n    .meta-editor-widget.show-meta-consistency-results .meta-consistency-results .meta-inconsistency {\n      margin-left: 10px;\n      margin-right: 10px; }\n      .meta-editor-widget.show-meta-consistency-results .meta-consistency-results .meta-inconsistency dt {\n        width: 100px; }\n      .meta-editor-widget.show-meta-consistency-results .meta-consistency-results .meta-inconsistency dd {\n        margin-left: 120px; }\n        .meta-editor-widget.show-meta-consistency-results .meta-consistency-results .meta-inconsistency dd.path-link {\n          cursor: pointer;\n          color: blue; }\n          .meta-editor-widget.show-meta-consistency-results .meta-consistency-results .meta-inconsistency dd.path-link:hover {\n            color: orange; }\n\ndiv.filterPanel {\n  position: absolute;\n  top: 34px;\n  right: 11px;\n  background-color: #FFFFFF;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  -webkit-border-radius: 6px;\n  -moz-border-radius: 6px;\n  border-radius: 6px;\n  -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);\n  -moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);\n  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);\n  -webkit-background-clip: padding-box;\n  -moz-background-clip: padding;\n  background-clip: padding-box; }\n  div.filterPanel .header {\n    min-width: 100px;\n    text-align: center;\n    margin: 0 5px; }\n  div.filterPanel .body {\n    display: none;\n    list-style: none;\n    padding: 5px;\n    margin: 0; }\n    div.filterPanel .body li.filterItem {\n      margin: 3px 0; }\n      div.filterPanel .body li.filterItem .iCheckBox {\n        float: right;\n        margin-top: 6px;\n        margin-left: 3px; }\n      div.filterPanel .body li.filterItem div > svg {\n        margin-top: 4px; }\n  div.filterPanel:hover .header {\n    border-bottom: 1px solid rgba(0, 0, 0, 0.2); }\n  div.filterPanel:hover .body {\n    display: block; }\n/*\n * @author pmeijer / https://github.com/pmeijer\n */\ndiv.replace-base-dialog div.modal-header .header-icon {\n  font-size: 20px;\n  margin-right: 1ex;\n  display: inline-block;\n  color: #333; }\ndiv.replace-base-dialog div.modal-header span {\n  font-size: 24px; }\ndiv.replace-base-dialog .modal-content .toggle-info-btn {\n  font-size: 65%;\n  vertical-align: top;\n  cursor: pointer;\n  color: #333; }\n  div.replace-base-dialog .modal-content .toggle-info-btn:hover {\n    color: #2a6496; }\ndiv.replace-base-dialog .modal-content .info-message {\n  display: inline-block;\n  width: 95%;\n  margin-bottom: 2ex;\n  margin-left: 0.5ex;\n  opacity: 0.90; }\n  div.replace-base-dialog .modal-content .info-message.hidden {\n    display: none; }\ndiv.replace-base-dialog .modal-content .message-badge {\n  margin-bottom: 0;\n  margin-top: 12px; }\n.set-editor-widget .diagram-designer-tabs-container .tab-list-container .nav.nav-tabs .delete-set-tab {\n  cursor: pointer;\n  font-size: 100%;\n  margin-left: 5px; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.graph-viz {\n  outline: none; }\n  .graph-viz .node {\n    cursor: pointer; }\n  .graph-viz .node circle {\n    fill: #FFF;\n    stroke: steelblue;\n    stroke-width: 1.5px; }\n  .graph-viz .node text {\n    font: 10px sans-serif; }\n  .graph-viz .link {\n    fill: none;\n    stroke: #CCC;\n    stroke-width: 1.5px; }\n\n.graph-viz-zoom-container {\n  position: absolute;\n  top: 40px;\n  left: 10px; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\ndiv.designer-item .circle-decorator {\n  position: relative;\n  width: 11px;\n  height: 11px; }\n  div.designer-item .circle-decorator svg {\n    top: -3px;\n    position: relative; }\n  div.designer-item .circle-decorator .name {\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n    position: relative; }\n  div.designer-item .circle-decorator .circle-shadow {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: none;\n    width: 11px;\n    height: 11px;\n    border-radius: 11px;\n    z-index: -1; }\ndiv.designer-item .circle-decorator .name {\n  top: -10px; }\ndiv.designer-item .circle-decorator .connector {\n  background-color: #FEFEFE;\n  height: 9px;\n  width: 9px;\n  position: absolute;\n  cursor: pointer;\n  border: 1px solid #0000FF;\n  z-index: 10;\n  position: absolute;\n  top: 0;\n  left: 0; }\n  div.designer-item .circle-decorator .connector:hover {\n    border-color: rgba(82, 168, 236, 0.8);\n    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\ndiv.designer-item.selected .circle-decorator svg circle {\n  fill: #DBEAFC; }\ndiv.designer-item.selected .circle-decorator .circle-shadow {\n  display: block; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\ndiv.part .circle-decorator {\n  position: relative;\n  width: 11px;\n  height: 11px; }\n  div.part .circle-decorator svg {\n    top: -3px;\n    position: relative; }\n  div.part .circle-decorator .name {\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n    position: relative; }\n  div.part .circle-decorator .circle-shadow {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: none;\n    width: 11px;\n    height: 11px;\n    border-radius: 11px;\n    z-index: -1; }\ndiv.part .circle-decorator .name {\n  position: absolute;\n  top: 10px; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.default-decorator {\n  min-width: 65px;\n  height: 40px;\n  border: 1px solid #000000;\n  background-color: #DEDEDE;\n  padding: 3px;\n  text-align: center; }\n  .default-decorator .name {\n    margin-top: 10px;\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n    text-align: center; }\n  .default-decorator .connector {\n    background-color: #FEFEFE;\n    height: 10px;\n    width: 10px;\n    position: absolute;\n    cursor: pointer;\n    border: 1px solid #0000FF;\n    z-index: 10;\n    height: 14px;\n    width: 14px;\n    margin-left: -8px;\n    left: 50%; }\n    .default-decorator .connector:hover {\n      border-color: rgba(82, 168, 236, 0.8);\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n    .default-decorator .connector.top {\n      top: -10px; }\n    .default-decorator .connector.bottom {\n      bottom: -10px; }\n\n.selected .default-decorator {\n  border: 1px solid #52A8EC;\n  background-color: #DBEAFC; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.part-browser .default-decorator .name {\n  max-width: 150px;\n  overflow: hidden;\n  text-overflow: ellipsis; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n * @author Qishen Zhang  https://github.com/VictorCoder123\n */\n.Document-decorator {\n  min-width: 65px;\n  max-width: 400px;\n  height: auto;\n  width: auto;\n  border: 1px solid black;\n  background-color: #dedede;\n  padding: 2ex;\n  text-align: center;\n  font-weight: normal; }\n  .Document-decorator i.text-meta:hover {\n    font-weight: bolder; }\n  .Document-decorator i.text-meta.not-activated {\n    cursor: not-allowed; }\n  .Document-decorator .doc {\n    text-align: left; }\n  .Document-decorator .name {\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n    text-align: center; }\n  .Document-decorator .connector {\n    background-color: #fefefe;\n    height: 10px;\n    width: 10px;\n    position: absolute;\n    cursor: pointer;\n    border: 1px solid blue;\n    z-index: 10;\n    margin-left: -6px;\n    left: 50%; }\n    .Document-decorator .connector:hover {\n      border-color: rgba(82, 168, 236, 0.8);\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n    .Document-decorator .connector.top {\n      top: -6px; }\n    .Document-decorator .connector.bottom {\n      bottom: -6px; }\n\n.selected .Document-decorator {\n  border: 1px solid #52a8ec;\n  background-color: #dbeafc; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.part-browser .Document-decorator .name {\n  max-width: 150px;\n  overflow: hidden;\n  text-overflow: ellipsis; }\n.part-browser .Document-decorator .embeddedsvg {\n  width: 40px;\n  position: relative; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.constraint-details-dialog .modal-body {\n  max-height: 500px; }\n  .constraint-details-dialog .modal-body label.control-label {\n    width: 15%; }\n  .constraint-details-dialog .modal-body div.controls {\n    width: 80%; }\n    .constraint-details-dialog .modal-body div.controls input.name-input {\n      width: 30%; }\n    .constraint-details-dialog .modal-body div.controls input.info-input {\n      width: 60%; }/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.aspect-details-dialog .modal-body {\n  max-height: 500px; }\n  .aspect-details-dialog .modal-body label.checkbox.invalid-aspect-member-label {\n    color: red; }\n  .aspect-details-dialog .modal-body label.checkbox input {\n    margin-top: 2px; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.meta-decorator {\n  min-width: 90px;\n  min-height: 40px;\n  border: 1px solid #000000;\n  background-color: #FFFFFF;\n  text-align: center; }\n  .meta-decorator .name {\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n    text-align: center;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    border-bottom: 1px solid #000000;\n    padding: 0 17px 0 17px; }\n    .meta-decorator .name input {\n      height: 16px !important;\n      line-height: 16px !important;\n      font-size: 11px !important; }\n  .meta-decorator .attributes,\n  .meta-decorator .constraints,\n  .meta-decorator .aspects {\n    font-size: 10px;\n    min-height: 1px;\n    margin-bottom: 0;\n    padding: 0 3px 0 3px; }\n    .meta-decorator .attributes li div,\n    .meta-decorator .constraints li div,\n    .meta-decorator .aspects li div {\n      white-space: nowrap;\n      position: relative;\n      height: 16px;\n      line-height: 16px; }\n      .meta-decorator .attributes li div:hover,\n      .meta-decorator .constraints li div:hover,\n      .meta-decorator .aspects li div:hover {\n        cursor: pointer;\n        background-color: #EEE; }\n      .meta-decorator .attributes li div .n,\n      .meta-decorator .constraints li div .n,\n      .meta-decorator .aspects li div .n {\n        float: left;\n        margin-right: 3px;\n        max-width: 90px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        text-align: left; }\n      .meta-decorator .attributes li div .t,\n      .meta-decorator .constraints li div .t,\n      .meta-decorator .aspects li div .t {\n        float: right;\n        text-align: right; }\n  .meta-decorator .add-new-attribute,\n  .meta-decorator .add-new-constraint,\n  .meta-decorator .add-new-aspect {\n    font-size: 10px;\n    cursor: pointer;\n    position: absolute;\n    top: 0;\n    left: 3px; }\n    .meta-decorator .add-new-attribute:hover,\n    .meta-decorator .add-new-constraint:hover,\n    .meta-decorator .add-new-aspect:hover {\n      background-color: #DBEAFC;\n      color: #000000; }\n  .meta-decorator .attributes-title,\n  .meta-decorator .constraints-title,\n  .meta-decorator .aspects-title {\n    font-size: 9px;\n    font-weight: bold;\n    text-transform: uppercase;\n    text-align: center;\n    background-color: #F3F3F3;\n    color: #000000;\n    line-height: 13px;\n    position: relative; }\n  .meta-decorator .constraints-title,\n  .meta-decorator .aspects-title {\n    border-top: 1px dashed #999999; }\n  .meta-decorator input[type=text].new-attr {\n    font-size: 10px; }\n  .meta-decorator .control-group {\n    margin-bottom: 0; }\n  .meta-decorator .connector {\n    background-color: #FEFEFE;\n    height: 10px;\n    width: 10px;\n    position: absolute;\n    cursor: pointer;\n    border: 1px solid #0000FF;\n    z-index: 10;\n    height: 14px;\n    width: 14px;\n    margin-left: -8px;\n    left: 50%; }\n    .meta-decorator .connector:hover {\n      border-color: rgba(82, 168, 236, 0.8);\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n    .meta-decorator .connector.top {\n      top: -10px; }\n    .meta-decorator .connector.bottom {\n      bottom: -10px; }\n  .meta-decorator .text-meta {\n    position: absolute;\n    top: 0;\n    right: 1px;\n    height: 15px;\n    width: 15px;\n    margin-top: 2px;\n    border-radius: 5px; }\n  .meta-decorator .meta-lock {\n    position: absolute;\n    top: 0;\n    left: 1px;\n    height: 15px;\n    width: 15px;\n    margin-top: 2px;\n    border-radius: 5px; }\n  .meta-decorator.abstract .name {\n    font-style: italic;\n    color: #AAAAAA; }\n\n.selected .meta-decorator .add-new-attribute:hover,\n.selected .meta-decorator .add-new-constraint:hover,\n.selected .meta-decorator .add-new-aspect:hover {\n  background-color: #FFFFC0; }\n\n.items.highlight-mode .meta-decorator .attributes li div:hover,\n.items.highlight-mode .meta-decorator .constraints li div:hover,\n.items.highlight-mode .meta-decorator .aspects li div:hover {\n  cursor: default;\n  background-color: #FFFFFF; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.model-decorator {\n  min-width: 65px;\n  min-height: 40px;\n  border: 1px solid #000000;\n  background-color: #ECECEC;\n  padding: 3px;\n  text-align: center;\n  position: relative;\n  -webkit-box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15);\n  -moz-box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15);\n  box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15); }\n  .model-decorator .name {\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n    text-align: center;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 121px;\n    border-bottom: none;\n    height: 16px;\n    line-height: 16px; }\n  .model-decorator div.conn-type {\n    font-size: 9px;\n    line-height: 12px;\n    color: #AAAAAA; }\n  .model-decorator .ports {\n    font-size: 10px;\n    min-height: 1px;\n    width: 121px;\n    position: relative; }\n    .model-decorator .ports .left {\n      display: inline-block;\n      vertical-align: top;\n      width: 50px;\n      min-height: 1px; }\n    .model-decorator .ports .center {\n      display: inline-block;\n      vertical-align: top;\n      width: 15px;\n      height: 1px; }\n    .model-decorator .ports .right {\n      display: inline-block;\n      vertical-align: top;\n      width: 50px;\n      min-height: 1px; }\n    .model-decorator .ports .port {\n      white-space: nowrap;\n      position: relative;\n      height: 15px;\n      line-height: 15px; }\n      .model-decorator .ports .port:hover {\n        cursor: pointer; }\n      .model-decorator .ports .port .title-wrapper {\n        display: inline-block;\n        width: 100%;\n        overflow: hidden;\n        text-overflow: ellipsis; }\n      .model-decorator .ports .port img.svg-icon {\n        height: 11px;\n        width: 5px;\n        position: absolute;\n        display: inline-block;\n        top: 2px; }\n      .model-decorator .ports .port span.dot {\n        position: absolute;\n        display: inline-block;\n        background: #666666;\n        border: 1px solid #666666;\n        width: 3px;\n        height: 7px;\n        top: 4px; }\n      .model-decorator .ports .port.w-icon span.dot {\n        display: none; }\n    .model-decorator .ports .left .port .title-wrapper {\n      text-align: left; }\n    .model-decorator .ports .left .port img.svg-icon {\n      left: -8px; }\n    .model-decorator .ports .left .port span.dot {\n      left: -6px;\n      border-top-left-radius: 5px;\n      border-bottom-left-radius: 5px; }\n    .model-decorator .ports .right .port .title-wrapper {\n      text-align: right; }\n    .model-decorator .ports .right .port img.svg-icon {\n      right: -8px;\n      -webkit-transform: scaleX(-1);\n      -moz-transform: scaleX(-1);\n      -ms-transform: scaleX(-1);\n      -o-transform: scaleX(-1);\n      transform: scaleX(-1); }\n    .model-decorator .ports .right .port span.dot {\n      left: 54px;\n      border-top-right-radius: 5px;\n      border-bottom-right-radius: 5px; }\n  .model-decorator .progress-bar .loader-progressbar {\n    position: relative;\n    left: 50%;\n    margin-left: -8px; }\n  .model-decorator .ptr {\n    position: absolute;\n    top: 0;\n    right: 2px;\n    height: 15px;\n    width: 15px;\n    margin-top: 2px;\n    border-radius: 5px; }\n    .model-decorator .ptr.ptr-nonset {\n      opacity: 0.4; }\n    .model-decorator .ptr.inverse-on-hover:hover {\n      background-color: rgba(82, 168, 236, 0.8);\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n      .model-decorator .ptr.inverse-on-hover:hover [class^="icon-"]:not(.icon-white),\n      .model-decorator .ptr.inverse-on-hover:hover [class*=" icon-"]:not(.icon-white) {\n        background-image: url("../src/client/img/glyphicons-halflings-white.png"); }\n    .model-decorator .ptr [class^="icon-"],\n    .model-decorator .ptr [class*=" icon-"] {\n      margin-top: -2px; }\n  .model-decorator .set {\n    position: absolute;\n    bottom: 0;\n    right: 2px;\n    height: 15px;\n    width: 15px;\n    margin-bottom: 2px;\n    border-radius: 5px; }\n    .model-decorator .set.inverse-on-hover:hover {\n      background-color: rgba(82, 168, 236, 0.8);\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n      .model-decorator .set.inverse-on-hover:hover [class^="icon-"]:not(.icon-white),\n      .model-decorator .set.inverse-on-hover:hover [class*=" icon-"]:not(.icon-white) {\n        background-image: url("../src/client/img/glyphicons-halflings-white.png"); }\n    .model-decorator .set [class^="icon-"],\n    .model-decorator .set [class*=" icon-"] {\n      margin-top: -2px; }\n  .model-decorator.abstract .name {\n    font-style: italic;\n    color: #AAAAAA; }\n  .model-decorator img.embeddedsvg {\n    width: 40px;\n    position: relative; }\n\n.model-decorator .connector {\n  background-color: #FEFEFE;\n  height: 10px;\n  width: 10px;\n  position: absolute;\n  cursor: pointer;\n  border: 1px solid #0000FF;\n  z-index: 10;\n  height: 14px;\n  width: 14px;\n  margin-left: -8px;\n  left: 50%; }\n  .model-decorator .connector:hover {\n    border-color: rgba(82, 168, 236, 0.8);\n    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n  .model-decorator .connector.top {\n    top: -10px; }\n  .model-decorator .connector.bottom {\n    bottom: -9px; }\n.model-decorator .ports .port div.connector {\n  top: 0.5px; }\n.model-decorator .ports .left .port .connector {\n  left: -8px; }\n.model-decorator .ports .right .port .connector {\n  left: 60px; }\n.model-decorator.accept-droppable {\n  background-color: #00FF00 !important;\n  cursor: alias; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n.model-decorator {\n  min-width: 65px;\n  min-height: 40px;\n  border: 1px solid #000000;\n  background-color: #ECECEC;\n  padding: 3px;\n  text-align: center;\n  position: relative;\n  -webkit-box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15);\n  -moz-box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15);\n  box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15); }\n  .model-decorator .name {\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n    text-align: center;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 121px;\n    border-bottom: none;\n    height: 16px;\n    line-height: 16px; }\n  .model-decorator div.conn-type {\n    font-size: 9px;\n    line-height: 12px;\n    color: #AAAAAA; }\n  .model-decorator .ports {\n    font-size: 10px;\n    min-height: 1px;\n    width: 121px;\n    position: relative; }\n    .model-decorator .ports .left {\n      display: inline-block;\n      vertical-align: top;\n      width: 50px;\n      min-height: 1px; }\n    .model-decorator .ports .center {\n      display: inline-block;\n      vertical-align: top;\n      width: 15px;\n      height: 1px; }\n    .model-decorator .ports .right {\n      display: inline-block;\n      vertical-align: top;\n      width: 50px;\n      min-height: 1px; }\n    .model-decorator .ports .port {\n      white-space: nowrap;\n      position: relative;\n      height: 15px;\n      line-height: 15px; }\n      .model-decorator .ports .port:hover {\n        cursor: pointer; }\n      .model-decorator .ports .port .title-wrapper {\n        display: inline-block;\n        width: 100%;\n        overflow: hidden;\n        text-overflow: ellipsis; }\n      .model-decorator .ports .port img.svg-icon {\n        height: 11px;\n        width: 5px;\n        position: absolute;\n        display: inline-block;\n        top: 2px; }\n      .model-decorator .ports .port span.dot {\n        position: absolute;\n        display: inline-block;\n        background: #666666;\n        border: 1px solid #666666;\n        width: 3px;\n        height: 7px;\n        top: 4px; }\n      .model-decorator .ports .port.w-icon span.dot {\n        display: none; }\n    .model-decorator .ports .left .port .title-wrapper {\n      text-align: left; }\n    .model-decorator .ports .left .port img.svg-icon {\n      left: -8px; }\n    .model-decorator .ports .left .port span.dot {\n      left: -6px;\n      border-top-left-radius: 5px;\n      border-bottom-left-radius: 5px; }\n    .model-decorator .ports .right .port .title-wrapper {\n      text-align: right; }\n    .model-decorator .ports .right .port img.svg-icon {\n      right: -8px;\n      -webkit-transform: scaleX(-1);\n      -moz-transform: scaleX(-1);\n      -ms-transform: scaleX(-1);\n      -o-transform: scaleX(-1);\n      transform: scaleX(-1); }\n    .model-decorator .ports .right .port span.dot {\n      left: 54px;\n      border-top-right-radius: 5px;\n      border-bottom-right-radius: 5px; }\n  .model-decorator .progress-bar .loader-progressbar {\n    position: relative;\n    left: 50%;\n    margin-left: -8px; }\n  .model-decorator .ptr {\n    position: absolute;\n    top: 0;\n    right: 2px;\n    height: 15px;\n    width: 15px;\n    margin-top: 2px;\n    border-radius: 5px; }\n    .model-decorator .ptr.ptr-nonset {\n      opacity: 0.4; }\n    .model-decorator .ptr.inverse-on-hover:hover {\n      background-color: rgba(82, 168, 236, 0.8);\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n      .model-decorator .ptr.inverse-on-hover:hover [class^="icon-"]:not(.icon-white),\n      .model-decorator .ptr.inverse-on-hover:hover [class*=" icon-"]:not(.icon-white) {\n        background-image: url("../src/client/img/glyphicons-halflings-white.png"); }\n    .model-decorator .ptr [class^="icon-"],\n    .model-decorator .ptr [class*=" icon-"] {\n      margin-top: -2px; }\n  .model-decorator .set {\n    position: absolute;\n    bottom: 0;\n    right: 2px;\n    height: 15px;\n    width: 15px;\n    margin-bottom: 2px;\n    border-radius: 5px; }\n    .model-decorator .set.inverse-on-hover:hover {\n      background-color: rgba(82, 168, 236, 0.8);\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n      .model-decorator .set.inverse-on-hover:hover [class^="icon-"]:not(.icon-white),\n      .model-decorator .set.inverse-on-hover:hover [class*=" icon-"]:not(.icon-white) {\n        background-image: url("../src/client/img/glyphicons-halflings-white.png"); }\n    .model-decorator .set [class^="icon-"],\n    .model-decorator .set [class*=" icon-"] {\n      margin-top: -2px; }\n  .model-decorator.abstract .name {\n    font-style: italic;\n    color: #AAAAAA; }\n  .model-decorator img.embeddedsvg {\n    width: 40px;\n    position: relative; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github/rkereskenyi\n */\n/*#DBEAFC;*/\n.svg-decorator {\n  text-align: center;\n  position: relative; }\n  .svg-decorator .svg-content svg {\n    vertical-align: top; }\n    .svg-decorator .svg-content svg .connection-area {\n      stroke: #FF0000;\n      stroke-width: 5.5; }\n  .svg-decorator .name {\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n    text-align: center;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    height: 16px;\n    line-height: 16px; }\n  .svg-decorator.abstract .name {\n    font-style: italic;\n    color: #AAAAAA; }\n  .svg-decorator .ports {\n    position: absolute;\n    top: 0;\n    font-size: 10px; }\n    .svg-decorator .ports.ports-l {\n      left: 0px; }\n    .svg-decorator .ports.ports-r {\n      left: 100px; }\n    .svg-decorator .ports .port {\n      position: absolute;\n      height: 13px;\n      line-height: 13px; }\n      .svg-decorator .ports .port .title {\n        position: absolute;\n        overflow: hidden;\n        text-overflow: ellipsis; }\n      .svg-decorator .ports .port .icon {\n        position: absolute; }\n        .svg-decorator .ports .port .icon img {\n          width: 13px;\n          height: 13px; }\n      .svg-decorator .ports .port .connector {\n        margin-left: 0;\n        margin-top: 0; }\n    .svg-decorator .ports.ports-l .port .title {\n      text-align: left; }\n    .svg-decorator .ports.ports-r .port .title {\n      text-align: right; }\n    .svg-decorator .ports.ports-r .port .icon img {\n      -webkit-transform: scaleX(-1);\n      -moz-transform: scaleX(-1);\n      -ms-transform: scaleX(-1);\n      -o-transform: scaleX(-1);\n      transform: scaleX(-1); }\n\n.designer-item .svg-decorator .svg-content svg {\n  border: none; }\n  .designer-item .svg-decorator .svg-content svg .connector {\n    fill: #FEFEFE;\n    stroke: #0000FF;\n    stroke-width: 1px; }\n    .designer-item .svg-decorator .svg-content svg .connector:hover {\n      stroke: rgba(82, 168, 236, 0.8); }\n.designer-item .svg-decorator .connector {\n  background-color: #FEFEFE;\n  height: 10px;\n  width: 10px;\n  position: absolute;\n  cursor: pointer;\n  border: 1px solid #0000FF;\n  z-index: 10;\n  margin-left: -6px;\n  margin-top: -6px; }\n  .designer-item .svg-decorator .connector:hover {\n    border-color: rgba(82, 168, 236, 0.8);\n    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\n.designer-item .svg-decorator.accept-droppable {\n  background-color: #00FF00 !important;\n  cursor: alias; }\n/**\n * @author rkereskenyi / https://github.com/rkereskenyi\n */\n/**\n * @author rkereskenyi / https://github/rkereskenyi\n */\n/*#DBEAFC;*/\n.part .svg-decorator {\n  text-align: center;\n  position: relative; }\n  .part .svg-decorator .svg-content svg {\n    vertical-align: top; }\n    .part .svg-decorator .svg-content svg .connection-area {\n      stroke: #FF0000;\n      stroke-width: 5.5; }\n  .part .svg-decorator .name {\n    white-space: nowrap;\n    font-size: 11px;\n    font-weight: bold;\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\n    text-align: center;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    height: 16px;\n    line-height: 16px; }\n  .part .svg-decorator.abstract .name {\n    font-style: italic;\n    color: #aaaaaa; }\n  .part .svg-decorator .ports {\n    position: absolute;\n    top: 0;\n    font-size: 10px; }\n    .part .svg-decorator .ports.ports-l {\n      left: 0px; }\n    .part .svg-decorator .ports.ports-r {\n      left: 100px; }\n    .part .svg-decorator .ports .port {\n      position: absolute;\n      height: 13px;\n      line-height: 13px; }\n      .part .svg-decorator .ports .port .title {\n        position: absolute;\n        overflow: hidden;\n        text-overflow: ellipsis; }\n      .part .svg-decorator .ports .port .icon {\n        position: absolute; }\n        .part .svg-decorator .ports .port .icon img {\n          width: 13px;\n          height: 13px; }\n      .part .svg-decorator .ports .port .connector {\n        margin-left: 0;\n        margin-top: 0; }\n    .part .svg-decorator .ports.ports-l .port .title {\n      text-align: left; }\n    .part .svg-decorator .ports.ports-r .port .title {\n      text-align: right; }\n    .part .svg-decorator .ports.ports-r .port .icon img {\n      -webkit-transform: scaleX(-1);\n      -moz-transform: scaleX(-1);\n      -ms-transform: scaleX(-1);\n      -o-transform: scaleX(-1);\n      transform: scaleX(-1); }\n');
//# sourceMappingURL=webgme.dist.build.js.map